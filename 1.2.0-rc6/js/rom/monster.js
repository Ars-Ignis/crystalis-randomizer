import { Constraint } from './constraint.js';
import { ObjectData } from './objectdata.js';
export class Monster extends ObjectData {
    constructor(rom, [name, id, scaling, adjustments = {}]) {
        super(rom, id);
        this.constraint = Constraint.ALL;
        this.name = name;
        const expectedLevel = (level(scaling) + this.level) / 2;
        const expectedAttack = expectedLevel + playerSword(scaling, this.elements);
        this.hits = (this.hp + 1) / (expectedAttack - this.def);
        this.sdef = this.def / expectedAttack;
        const expectedPlayerHP = Math.min(255, Math.max(16, 32 + expectedLevel * 16));
        this.satk = (this.atk - expectedPlayerDefense(scaling, this.attackType)) / expectedPlayerHP;
        this.extraDifficulty = adjustments.difficulty || 0;
        this.monsterClass = adjustments.monsterClass;
        const vsExp = processExpReward(this.expReward) / baselineExp(scaling);
        const vsGld = VANILLA_GOLD_DROPS[this.goldDrop] / baselineGold(scaling);
        this.wealth = vsGld && vsGld / (vsExp + vsGld);
    }
    placement() {
        const action = ACTION_SCRIPTS.get(this.action);
        return action && action.placement || 'normal';
    }
    clearance() {
        const action = ACTION_SCRIPTS.get(this.action);
        return action && action.large ? 6 : 3;
    }
    totalDifficulty() {
        return this.toughness() + this.attack() + this.statusDifficulty() +
            this.immunities() + this.movement();
    }
    collectDifficulty(f, r) {
        let result = f(this);
        const child = this.spawnedChild();
        if (child)
            result = r(result, child.collectDifficulty(f, r));
        const death = this.spawnedReplacement();
        if (death)
            result = r(result, death.collectDifficulty(f, r));
        return result;
    }
    toughness() {
        return this.collectDifficulty(m => lookup(m.hits, 0, [2, 1], [3, 2], [5, 3], [7, 4], [10, 5], [13, 6]), Math.max);
    }
    attack() {
        return this.collectDifficulty(m => {
            if (m.attackType && m.statusEffect)
                return 0;
            return lookup(m.satk, 0, [.04, 1], [.08, 2], [.13, 3], [.18, 4], [.25, 5], [.33, 6]);
        }, Math.max);
    }
    addStatusEffects(set) {
        if (this.attackType && this.statusEffect) {
            set.add(this.statusEffect);
        }
        else if (!this.attackType && this.poison) {
            set.add(0);
        }
        const replacement = this.spawnedReplacement();
        if (replacement)
            replacement.addStatusEffects(set);
        const child = this.spawnedChild();
        if (child)
            child.addStatusEffects(set);
    }
    statusDifficulty() {
        const set = new Set();
        this.addStatusEffects(set);
        let result = 0;
        for (const status of set) {
            result += STATUS_DIFFICULTY[status];
        }
        return result;
    }
    immunities() {
        let count = 0;
        let elems = this.elements;
        while (elems) {
            if (elems & 1)
                count++;
            elems >>>= 1;
        }
        return (count && 1 << (count - 1));
    }
    movement() {
        return this.collectDifficulty(m => {
            const actionData = ACTION_SCRIPTS.get(m.action);
            const child = m.spawnedChild();
            let result = m.extraDifficulty;
            if (actionData) {
                result += (actionData.movement || 0);
                if (actionData.large)
                    result++;
                if (child && !child.statusEffect)
                    result += (actionData.projectile || 0);
            }
            if (this.metasprite === 0xa7)
                result += 2;
            return result;
        }, (a, b) => a + b);
    }
    spawnedChild() {
        const data = ACTION_SCRIPTS.get(this.action);
        if (!data || !data.child)
            return undefined;
        const spawn = this.rom.adHocSpawns[this.child];
        const spawnId = spawn && spawn.objectId;
        if (spawnId == null)
            return undefined;
        const obj = this.rom.objects[spawnId];
        return obj instanceof Monster ? obj : undefined;
    }
    spawnedReplacement() {
        if (!this.replacement)
            return undefined;
        const obj = this.rom.objects[this.replacement];
        return obj instanceof Monster ? obj : undefined;
    }
    totalReward() {
        return this.totalDifficulty() / 4;
    }
    normalizedGold() {
        if (!this.wealth)
            return 0;
        const dgld = this.totalDifficulty() * this.wealth * 0.6;
        return Math.max(1, Math.min(15, Math.round(dgld)));
    }
    normalizedExp() {
        if (this.wealth === 1)
            return 0;
        const sexp = 0.488 + this.totalDifficulty() * (1 - this.wealth) * 0.256;
        return Math.max(1, Math.min(255, Math.round(sexp * 32)));
    }
}
function processExpReward(raw) {
    return raw < 128 ? raw : (raw & 0x7f) << 4;
}
function baselineExp(scaling) {
    return 2 ** (scaling / 5 - 1);
}
const STATUS_DIFFICULTY = [
    2,
    1,
    3,
    2,
    4,
];
const VANILLA_GOLD_DROPS = [
    0, 1, 2, 4, 8, 16, 30, 50,
    100, 200, 400, 50, 100, 200, 400, 500,
];
function baselineGold(scaling) {
    return 2 ** (scaling / 7 - 1);
}
export const ACTION_SCRIPTS = new Map([
    [0x10, {}],
    [0x11, {}],
    [0x16, {}],
    [0x17, {}],
    [0x1b, {}],
    [0x1d, {
            child: true,
        }],
    [0x1e, {}],
    [0x1f, {}],
    [0x20, {
            movement: 1,
        }],
    [0x21, {
            child: true,
            large: true,
            movement: 2,
        }],
    [0x22, {
            child: true,
            movement: 3,
        }],
    [0x24, {
            movement: 3,
        }],
    [0x25, {
            movement: 3,
        }],
    [0x26, {
            child: true,
            projectile: 1,
            movement: 3,
        }],
    [0x27, {
            child: true,
            projectile: 1,
            movement: 3,
        }],
    [0x28, {
            child: true,
            projectile: 2,
            movement: 3,
            metasprites: () => [0x65, 0x91],
        }],
    [0x29, {
            child: true,
            movement: 5,
            metasprites: () => [0x6b, 0x68],
        }],
    [0x2a, {
            child: true,
            projectile: 1,
            movement: 4,
            metasprites: (o) => [0, 1, 2, 3].map(x => x + o.data[31]),
        }],
    [0x2b, {
            movement: 4,
        }],
    [0x2c, {
            child: true,
        }],
    [0x2e, {
            child: true,
            large: true,
            projectile: 2,
            movement: 3,
        }],
    [0x2f, {}],
    [0x34, {
            child: true,
        }],
    [0x38, {}],
    [0x3c, {}],
    [0x40, {
            child: true,
            moth: true,
            movement: 4,
            placement: 'moth',
        }],
    [0x41, {
            child: true,
            movement: 3,
        }],
    [0x44, {
            movement: 3,
        }],
    [0x45, {
            child: true,
            bird: true,
            projectile: 2,
            movement: 5,
            placement: 'bird',
        }],
    [0x4c, {
            child: true,
            stationary: true,
            projectile: 3,
            placement: 'plant',
        }],
    [0x4d, {
            child: true,
            stationary: true,
            projectile: 3,
        }],
    [0x4e, {
            child: true,
            stationary: true,
        }],
    [0x57, {}],
    [0x58, {}],
    [0x5c, {
            child: true,
            projectile: 3,
            movement: 1,
        }],
    [0x5d, {
            bird: true,
            movement: 6,
            placement: 'bird',
        }],
    [0x5e, {
            child: true,
            projectile: 1,
            movement: 4,
            metasprites: (o) => [0, 1, 2, 3].map(x => x + o.data[31]),
        }],
    [0x60, {
            boss: true,
        }],
    [0x61, {}],
    [0x63, {
            boss: true,
        }],
    [0x64, {
            boss: true,
        }],
    [0x66, {
            boss: true,
        }],
    [0x67, {
            boss: true,
        }],
    [0x68, {
            boss: true,
        }],
    [0x6a, {
            boss: true,
        }],
    [0x6b, {
            boss: true,
        }],
    [0x70, {
            boss: true,
        }],
    [0x7f, {
            boss: true,
        }],
]);
function level(scaling) {
    return scaling < 24 ? 1 + scaling / 3 : (scaling + 12) / 4;
}
function playerSword(scaling, elements = 0) {
    const bestOwned = scaling < 10 ? 1 : scaling < 18 ? 2 : scaling < 38 ? 4 : 8;
    for (let i = bestOwned; i; i >>>= 1) {
        if (!(i & elements))
            return i << 1;
    }
    return bestOwned << 1;
}
function expectedPlayerDefense(scaling, attackType) {
    return level(scaling) + playerArmor(scaling, attackType);
}
function playerArmor(scaling, attackType) {
    if (!attackType) {
        return lookup(scaling, 2, [6, 6], [18, 10], [25, 14], [30, 18], [40, 24], [46, 32]);
    }
    else {
        return lookup(scaling, 2, [6, 6], [18, 8], [25, 12], [30, 18], [37, 24], [42, 32]);
    }
}
function lookup(x, first, ...table) {
    for (let i = table.length - 1; i >= 0; i--) {
        const [k, v] = table[i];
        if (x >= k)
            return v;
    }
    return first;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uc3Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vbW9uc3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBWTNDLE1BQU0sT0FBTyxPQUFRLFNBQVEsVUFBVTtJQTJCckMsWUFBWSxHQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxXQUFXLEdBQUcsRUFBRSxDQUFjO1FBQ3RFLEtBQUssQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFSakIsZUFBVSxHQUFlLFVBQVUsQ0FBQyxHQUFHLENBQUM7UUFTdEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFTakIsTUFBTSxhQUFhLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN4RCxNQUFNLGNBQWMsR0FBRyxhQUFhLEdBQUcsV0FBVyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0UsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxjQUFjLENBQUM7UUFFdEMsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsYUFBYSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDOUUsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFD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TSxDQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUNwRjtBQUNILENBQUM7QUFFRCxTQUFTLE1BQU0sQ0FBMEIsQ0FBSSxFQUNKLEtBQVEsRUFDUixHQUFHLEtBQXFDO0lBQy9FLEtBQUssSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUMxQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDO1lBQUUsT0FBTyxDQUFDLENBQUM7S0FDdEI7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbnN0cmFpbnR9IGZyb20gJy4vY29uc3RyYWludC5qcyc7XG5pbXBvcnQge09iamVjdERhdGF9IGZyb20gJy4vb2JqZWN0ZGF0YS5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcblxuZXhwb3J0IHR5cGUgTW9uc3RlckRhdGEgPSBbc3RyaW5nLCBudW1iZXIsIG51bWJlciwgQWRqdXN0bWVudHM/XTtcblxuZXhwb3J0IGludGVyZmFjZSBBZGp1c3RtZW50cyB7XG4gIGRpZmZpY3VsdHk/OiBudW1iZXI7XG4gIG1vbnN0ZXJDbGFzcz86IHN0cmluZ1xufVxuXG50eXBlIERpZmZpY3VsdHlGYWN0b3IgPSBudW1iZXIgJiB7X19kaWZmaWN1bHR5X186IG5ldmVyfTtcblxuZXhwb3J0IGNsYXNzIE1vbnN0ZXIgZXh0ZW5kcyBPYmplY3REYXRhIHtcblxuICAvLyAvKiogVmFuaWxsYSBkZWZlbnNlLiBJZiBjaGFuZ2luZyBkZWYgYmVmb3JlIHNjYWxpbmcsIGNoYW5nZSB2ZGVmIGluc3RlYWQuICovXG4gIC8vIHZkZWY6IG51bWJlcjtcbiAgLy8gLyoqIFZhbmlsbGEgaGVhbHRoLiBJZiBjaGFuZ2luZyBocCBiZWZvcmUgc2NhbGluZywgY2hhbmdlIHZocCBpbnN0ZWFkLiAqL1xuICAvLyB2aHA6IG51bWJlcjtcblxuICAvKiogVGFyZ2V0IG51bWJlciBvZiBoaXRzIHRvIGtpbGwgbW9uc3Rlci4gKi9cbiAgaGl0czogbnVtYmVyO1xuICAvKiogVGFyZ2V0IGRlZmVuc2UgYXMgYSBmcmFjdGlvbiBvZiBleHBlY3RlZCBwbGF5ZXIgYXR0YWNrLiAqL1xuICBzZGVmOiBudW1iZXI7XG4gIC8qKiBUYXJnZXQgYXR0YWNrIGFzIGEgZnJhY3Rpb24gb2YgZXhwZWN0ZWQgcGxheWVyIEhQLiAqL1xuICBzYXRrOiBudW1iZXI7XG5cbiAgLyoqIFJlbGF0aXZlIGZyYWN0aW9uIG9mIHJld2FyZCBnaXZlbiBhcyBtb25leS4gKi9cbiAgd2VhbHRoOiBudW1iZXI7XG5cbiAgLyoqIEV4dHJhIGRpZmZpY3VsdHkgZmFjdG9yLiAqL1xuICBleHRyYURpZmZpY3VsdHk6IG51bWJlcjtcblxuICBjb25zdHJhaW50OiBDb25zdHJhaW50ID0gQ29uc3RyYWludC5BTEw7XG4gIHNoaWZ0UGF0dGVybnM/OiBTZXQ8bnVtYmVyPjtcbiAgdXNlZFBhbGV0dGVzPzogcmVhZG9ubHkgbnVtYmVyW107XG4gIHVzZWRQYXR0ZXJucz86IHJlYWRvbmx5IG51bWJlcltdO1xuXG4gIG1vbnN0ZXJDbGFzcz86IHN0cmluZztcblxuICBjb25zdHJ1Y3Rvcihyb206IFJvbSwgW25hbWUsIGlkLCBzY2FsaW5nLCBhZGp1c3RtZW50cyA9IHt9XTogTW9uc3RlckRhdGEpIHtcbiAgICBzdXBlcihyb20sIGlkKTtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuXG4gICAgLy8gTWFrZSB0aGUgc2NhbGluZyBjYWxjdWxhdGlvbnMgaGVyZVxuICAgIC8vIEZpcnN0IGRlcml2ZSB2YWx1ZXMgY29ycmVzcG9uZGluZyB0byB2YW5pbGxhLlxuXG4gICAgLy8gRXhwZWN0ZWQgdmFuaWxsYSBwbGF5ZXIgbGV2ZWwgY29tZXMgZnJvbSBhdmVyYWdpbmcgKDEpIHRoZSBleHBlY3RlZFxuICAgIC8vIGxldmVsIGZyb20gdGhlIG1hbnVhbGx5LXNwZWNpZmllZCAoZXF1aXZhbGVudCkgc2NhbGluZyBsZXZlbCB3aXRoXG4gICAgLy8gKDIpIHRoZSBtaW5pbXVtIGxldmVsIHRvIGRhbWFnZSAoZnJvbSB0aGUgb2JqZWN0IGRhdGEpLiAgVGhpcyBtYXkgYmVcbiAgICAvLyBmcmFjdGlvbmFsLlxuICAgIGNvbnN0IGV4cGVjdGVkTGV2ZWwgPSAobGV2ZWwoc2NhbGluZykgKyB0aGlzLmxldmVsKSAvIDI7XG4gICAgY29uc3QgZXhwZWN0ZWRBdHRhY2sgPSBleHBlY3RlZExldmVsICsgcGxheWVyU3dvcmQoc2NhbGluZywgdGhpcy5lbGVtZW50cyk7XG4gICAgdGhpcy5oaXRzID0gKHRoaXMuaHAgKyAxKSAvIChleHBlY3RlZEF0dGFjayAtIHRoaXMuZGVmKTtcbiAgICB0aGlzLnNkZWYgPSB0aGlzLmRlZiAvIGV4cGVjdGVkQXR0YWNrO1xuXG4gICAgY29uc3QgZXhwZWN0ZWRQbGF5ZXJIUCA9IE1hdGgubWluKDI1NSwgTWF0aC5tYXgoMTYsIDMyICsgZXhwZWN0ZWRMZXZlbCAqIDE2KSk7XG4gICAgdGhpcy5zYXRrID0gKHRoaXMuYXRrIC0gZXhwZWN0ZWRQbGF5ZXJEZWZlbnNlKHNjYWxpbmcsIHRoaXMuYXR0YWNrVHlwZSkpIC8gZXhwZWN0ZWRQbGF5ZXJIUDtcbiAgICB0aGlzLmV4dHJhRGlmZmljdWx0eSA9IGFkanVzdG1lbnRzLmRpZmZpY3VsdHkgfHwgMDtcbiAgICB0aGlzLm1vbnN0ZXJDbGFzcyA9IGFkanVzdG1lbnRzLm1vbnN0ZXJDbGFzcztcblxuICAgIC8vIENvbXB1dGUgdmFuaWxsYSBzY2FsZWQgZXhwIGFuZCBnb2xkLlxuICAgIGNvbnN0IHZzRXhwID0gcHJvY2Vzc0V4cFJld2FyZCh0aGlzLmV4cFJld2FyZCkgLyBiYXNlbGluZUV4cChzY2FsaW5nKTtcbiAgICBjb25zdCB2c0dsZCA9IFZBTklMTEFfR09MRF9EUk9QU1t0aGlzLmdvbGREcm9wXSAvIGJhc2VsaW5lR29sZChzY2FsaW5nKTtcblxuICAgIHRoaXMud2VhbHRoID0gdnNHbGQgJiYgdnNHbGQgLyAodnNFeHAgKyB2c0dsZCk7XG4gIH1cblxuICBwbGFjZW1lbnQoKTogUGxhY2VtZW50IHtcbiAgICBjb25zdCBhY3Rpb24gPSBBQ1RJT05fU0NSSVBUUy5nZXQodGhpcy5hY3Rpb24pO1xuICAgIHJldHVybiBhY3Rpb24gJiYgYWN0aW9uLnBsYWNlbWVudCB8fCAnbm9ybWFsJztcbiAgfVxuXG4gIGNsZWFyYW5jZSgpOiBudW1iZXIge1xuICAgIGNvbnN0IGFjdGlvbiA9IEFDVElPTl9TQ1JJUFRTLmdldCh0aGlzLmFjdGlvbik7XG4gICAgcmV0dXJuIGFjdGlvbiAmJiBhY3Rpb24ubGFyZ2UgPyA2IDogMztcbiAgfVxuXG4gIHRvdGFsRGlmZmljdWx0eSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnRvdWdobmVzcygpICsgdGhpcy5hdHRhY2soKSArIHRoaXMuc3RhdHVzRGlmZmljdWx0eSgpICtcbiAgICAgICAgdGhpcy5pbW11bml0aWVzKCkgKyB0aGlzLm1vdmVtZW50KCk7XG4gIH1cblxuICBjb2xsZWN0RGlmZmljdWx0eShmOiAobTogTW9uc3RlcikgPT4gbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICByOiAoYTogbnVtYmVyLCBiOiBudW1iZXIpID0+IG51bWJlcik6IERpZmZpY3VsdHlGYWN0b3Ige1xuICAgIGxldCByZXN1bHQgPSBmKHRoaXMpO1xuICAgIGNvbnN0IGNoaWxkID0gdGhpcy5zcGF3bmVkQ2hpbGQoKTtcbiAgICBpZiAoY2hpbGQpIHJlc3VsdCA9IHIocmVzdWx0LCBjaGlsZC5jb2xsZWN0RGlmZmljdWx0eShmLCByKSk7XG4gICAgY29uc3QgZGVhdGggPSB0aGlzLnNwYXduZWRSZXBsYWNlbWVudCgpO1xuICAgIGlmIChkZWF0aCkgcmVzdWx0ID0gcihyZXN1bHQsIGRlYXRoLmNvbGxlY3REaWZmaWN1bHR5KGYsIHIpKTtcbiAgICByZXR1cm4gcmVzdWx0IGFzIERpZmZpY3VsdHlGYWN0b3I7XG4gIH1cblxuICAvKiogQmFzaWMgbWVhc3VyZSBvZiBob3cgaGFyZCB0aGUgZW5lbXkgaXMgdG8ga2lsbC4gKi9cbiAgdG91Z2huZXNzKCk6IERpZmZpY3VsdHlGYWN0b3Ige1xuICAgIHJldHVybiB0aGlzLmNvbGxlY3REaWZmaWN1bHR5KFxuICAgICAgICBtID0+IGxvb2t1cChtLmhpdHMsIDAsIFsyLCAxXSwgWzMsIDJdLCBbNSwgM10sIFs3LCA0XSwgWzEwLCA1XSwgWzEzLCA2XSksXG4gICAgICAgIE1hdGgubWF4KTtcbiAgfVxuXG4gIC8qKiBIb3cgaGFyZCB0aGUgbW9uc3RlciBoaXRzLiAqL1xuICBhdHRhY2soKTogRGlmZmljdWx0eUZhY3RvciB7XG4gICAgLy8gaWdub3JlIEFUSyBmb3IgcHJvamVjdGlsZXMgd2l0aCBzdGF0dXNcbiAgICByZXR1cm4gdGhpcy5jb2xsZWN0RGlmZmljdWx0eShcbiAgICAgICAgbSA9PiB7XG4gICAgICAgICAgaWYgKG0uYXR0YWNrVHlwZSAmJiBtLnN0YXR1c0VmZmVjdCkgcmV0dXJuIDA7XG4gICAgICAgICAgcmV0dXJuIGxvb2t1cChtLnNhdGssXG4gICAgICAgICAgICAgICAgICAgICAgICAwLCBbLjA0LCAxXSwgWy4wOCwgMl0sIFsuMTMsIDNdLCBbLjE4LCA0XSwgWy4yNSwgNV0sIFsuMzMsIDZdKTtcbiAgICAgICAgfSwgTWF0aC5tYXgpO1xuICB9XG5cbiAgYWRkU3RhdHVzRWZmZWN0cyhzZXQ6IFNldDxudW1iZXI+KTogdm9pZCB7XG4gICAgLy8gVE9ETyAtIGlmIHdlIGFsbG93IHByb2plY3RpbGUgcG9pc29uIG9yIGJvZHkgcGFyYWx5c2lzLCBhY2NvdW50IGZvciB0aGF0LlxuICAgIGlmICh0aGlzLmF0dGFja1R5cGUgJiYgdGhpcy5zdGF0dXNFZmZlY3QpIHtcbiAgICAgIHNldC5hZGQodGhpcy5zdGF0dXNFZmZlY3QpO1xuICAgIH0gZWxzZSBpZiAoIXRoaXMuYXR0YWNrVHlwZSAmJiB0aGlzLnBvaXNvbikge1xuICAgICAgc2V0LmFkZCgwKTtcbiAgICB9XG4gICAgY29uc3QgcmVwbGFjZW1lbnQgPSB0aGlzLnNwYXduZWRSZXBsYWNlbWVudCgpO1xuICAgIGlmIChyZXBsYWNlbWVudCkgcmVwbGFjZW1lbnQuYWRkU3RhdHVzRWZmZWN0cyhzZXQpO1xuICAgIGNvbnN0IGNoaWxkID0gdGhpcy5zcGF3bmVkQ2hpbGQoKTtcbiAgICBpZiAoY2hpbGQpIGNoaWxkLmFkZFN0YXR1c0VmZmVjdHMoc2V0KTtcbiAgfVxuXG4gIHN0YXR1c0RpZmZpY3VsdHkoKTogRGlmZmljdWx0eUZhY3RvciB7XG4gICAgY29uc3Qgc2V0ID0gbmV3IFNldDxudW1iZXI+KCk7XG4gICAgdGhpcy5hZGRTdGF0dXNFZmZlY3RzKHNldCk7XG4gICAgbGV0IHJlc3VsdCA9IDA7XG4gICAgZm9yIChjb25zdCBzdGF0dXMgb2Ygc2V0KSB7XG4gICAgICByZXN1bHQgKz0gU1RBVFVTX0RJRkZJQ1VMVFlbc3RhdHVzXTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdCBhcyBEaWZmaWN1bHR5RmFjdG9yO1xuICB9XG5cbiAgaW1tdW5pdGllcygpOiBEaWZmaWN1bHR5RmFjdG9yIHtcbiAgICBsZXQgY291bnQgPSAwO1xuICAgIGxldCBlbGVtcyA9IHRoaXMuZWxlbWVudHM7XG4gICAgd2hpbGUgKGVsZW1zKSB7XG4gICAgICBpZiAoZWxlbXMgJiAxKSBjb3VudCsrO1xuICAgICAgZWxlbXMgPj4+PSAxO1xuICAgIH1cbiAgICByZXR1cm4gKGNvdW50ICYmIDEgPDwgKGNvdW50IC0gMSkpIGFzIERpZmZpY3VsdHlGYWN0b3I7XG4gIH1cblxuICBtb3ZlbWVudCgpOiBEaWZmaWN1bHR5RmFjdG9yIHtcbiAgICByZXR1cm4gdGhpcy5jb2xsZWN0RGlmZmljdWx0eShcbiAgICAgICAgbSA9PiB7XG4gICAgICAgICAgY29uc3QgYWN0aW9uRGF0YSA9IEFDVElPTl9TQ1JJUFRTLmdldChtLmFjdGlvbik7XG4gICAgICAgICAgY29uc3QgY2hpbGQgPSBtLnNwYXduZWRDaGlsZCgpO1xuICAgICAgICAgIGxldCByZXN1bHQgPSBtLmV4dHJhRGlmZmljdWx0eTtcbiAgICAgICAgICBpZiAoYWN0aW9uRGF0YSkge1xuICAgICAgICAgICAgcmVzdWx0ICs9IChhY3Rpb25EYXRhLm1vdmVtZW50IHx8IDApO1xuICAgICAgICAgICAgaWYgKGFjdGlvbkRhdGEubGFyZ2UpIHJlc3VsdCsrO1xuICAgICAgICAgICAgLy8gTk9URTogTW90aFJlc2lkdWVTb3VyY2UgaGFzIHN0YXR1c0RpZmZpY3VsdHkgYnV0IG5vdCBzdGF0dXNFZmZlY3QuXG4gICAgICAgICAgICBpZiAoY2hpbGQgJiYgIWNoaWxkLnN0YXR1c0VmZmVjdCkgcmVzdWx0ICs9IChhY3Rpb25EYXRhLnByb2plY3RpbGUgfHwgMCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gU2hhZG93cyBnZXQgKzIsIGFjdGlvbiAkMjYgdHJpZ2dlcnMgdGhpcyBvbiBtZXRhc3ByaXRlICRhN1xuICAgICAgICAgIGlmICh0aGlzLm1ldGFzcHJpdGUgPT09IDB4YTcpIHJlc3VsdCArPSAyO1xuXG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSwgKGEsIGIpID0+IGEgKyBiKTtcbiAgfVxuXG4gIHNwYXduZWRDaGlsZCgpOiBNb25zdGVyIHwgdW5kZWZpbmVkIHtcbiAgICBjb25zdCBkYXRhID0gQUNUSU9OX1NDUklQVFMuZ2V0KHRoaXMuYWN0aW9uKTtcbiAgICBpZiAoIWRhdGEgfHwgIWRhdGEuY2hpbGQpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgY29uc3Qgc3Bhd24gPSB0aGlzLnJvbS5hZEhvY1NwYXduc1t0aGlzLmNoaWxkXTtcbiAgICBjb25zdCBzcGF3bklkID0gc3Bhd24gJiYgc3Bhd24ub2JqZWN0SWQ7XG4gICAgaWYgKHNwYXduSWQgPT0gbnVsbCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICBjb25zdCBvYmogPSB0aGlzLnJvbS5vYmplY3RzW3NwYXduSWRdO1xuICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBNb25zdGVyID8gb2JqIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgc3Bhd25lZFJlcGxhY2VtZW50KCk6IE1vbnN0ZXIgfCB1bmRlZmluZWQge1xuICAgIGlmICghdGhpcy5yZXBsYWNlbWVudCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICBjb25zdCBvYmogPSB0aGlzLnJvbS5vYmplY3RzW3RoaXMucmVwbGFjZW1lbnRdO1xuICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBNb25zdGVyID8gb2JqIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgLy8gUmV0dXJucyBhIG51bWJlciAwLi42IG9yIHNvXG4gIHRvdGFsUmV3YXJkKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMudG90YWxEaWZmaWN1bHR5KCkgLyA0O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBudW1iZXIgZnJvbSAwIHRvIDE1LCByZXByZXNlbnRpbmcgREdMRC8yLCBvciAwIGZvciBubyBnb2xkLlxuICAgKi9cbiAgbm9ybWFsaXplZEdvbGQoKTogbnVtYmVyIHtcbiAgICBpZiAoIXRoaXMud2VhbHRoKSByZXR1cm4gMDtcbiAgICAvLyBBdmVyYWdlIGRpZmZpY3VsdHkgaXMgMTAsIGF2ZXJhZ2Ugd2VhbHRoIGlzIDAuNSA9PiAzIGlzIGF2ZXJhZ2UgZGdsZC5cbiAgICAvLyBNYXggZGlmZmljdWx0eSBvZiAyNSwgd2l0aCB3ZWFsdGggb2YgMSA9PiAxNSBkZ2xkLlxuICAgIGNvbnN0IGRnbGQgPSB0aGlzLnRvdGFsRGlmZmljdWx0eSgpICogdGhpcy53ZWFsdGggKiAwLjY7XG4gICAgcmV0dXJuIE1hdGgubWF4KDEsIE1hdGgubWluKDE1LCBNYXRoLnJvdW5kKGRnbGQpKSk7XG4gIH1cblxuICAvKiogUmV0dXJucyBhIG51bWJlciBmcm9tIDAgdG8gMjU1LCByZXByZXNlbnRpbmcgU0VYUC8zMi4gKi9cbiAgbm9ybWFsaXplZEV4cCgpOiBudW1iZXIge1xuICAgIGlmICh0aGlzLndlYWx0aCA9PT0gMSkgcmV0dXJuIDA7XG4gICAgLy8gQXZnIGRpZmZpY3VsdHkgMTAsIHdlYWx0aCAwLjUgPT4gc2V4cCAxLjc2OFxuICAgIC8vIFNsaW1lIGRpZmZpY3VsdHkgNCwgd2VhbHRoIDAuNSA9PiBzZXhwIDFcbiAgICAvLyBNYXggZGlmZmljdWx0eSAyNSwgd2VhbHRoIDAgPT4gc2V4cCA2Ljg4OCA9PiAyMjAgLyAzMlxuICAgIGNvbnN0IHNleHAgPSAwLjQ4OCArIHRoaXMudG90YWxEaWZmaWN1bHR5KCkgKiAoMSAtIHRoaXMud2VhbHRoKSAqIDAuMjU2O1xuICAgIHJldHVybiBNYXRoLm1heCgxLCBNYXRoLm1pbigyNTUsIE1hdGgucm91bmQoc2V4cCAqIDMyKSkpO1xuICB9XG5cbiAgLy8gLyoqIENvbmZpZ3VyZXMgYSBzcGF3biBiYXNlZCBvbiB0aGUgY2hvc2VuIGJhbmtzIGZvciBhIGxvY2F0aW9uLiAqL1xuICAvLyBjb25maWd1cmUobG9jYXRpb246IExvY2F0aW9uLCBzcGF3bjogU3Bhd24pIHtcbiAgLy8gICBpZiAoIXRoaXMuc2hpZnRQYXR0ZXJucykgcmV0dXJuO1xuICAvLyAgIGlmICh0aGlzLnNoaWZ0UGF0dGVybnMuaGFzKGxvY2F0aW9uLnNwcml0ZVBhbGV0dGVzWzBdKSkgc3Bhd24ucGF0dGVybkJhbmsgPSAwO1xuICAvLyAgIGlmICh0aGlzLnNoaWZ0UGF0dGVybnMuaGFzKGxvY2F0aW9uLnNwcml0ZVBhbGV0dGVzWzFdKSkgc3Bhd24ucGF0dGVybkJhbmsgPSAxO1xuICAvLyB9XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NFeHBSZXdhcmQocmF3OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gcmF3IDwgMTI4ID8gcmF3IDogKHJhdyAmIDB4N2YpIDw8IDQ7XG59XG5cbmZ1bmN0aW9uIGJhc2VsaW5lRXhwKHNjYWxpbmc6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiAyICoqIChzY2FsaW5nIC8gNSAtIDEpO1xufVxuXG5jb25zdCBTVEFUVVNfRElGRklDVUxUWTogbnVtYmVyW10gPSBbXG4gIDIsIC8vIDAgcG9pc29uIChoYW5kbGVkIHNwZWNpYWwpXG4gIDEsIC8vIDEgcGFyYWx5c2lzXG4gIDMsIC8vIDIgc3RvbmVcbiAgMiwgLy8gMyBtcCBkcmFpblxuICA0LCAvLyA0IGN1cnNlXG5dO1xuXG5jb25zdCBWQU5JTExBX0dPTERfRFJPUFMgPSBbXG4gICAgMCwgICAxLCAgIDIsICAgNCwgICA4LCAgMTYsICAzMCwgIDUwLFxuICAxMDAsIDIwMCwgNDAwLCAgNTAsIDEwMCwgMjAwLCA0MDAsIDUwMCxcbl07XG5cbmZ1bmN0aW9uIGJhc2VsaW5lR29sZChzY2FsaW5nOiBudW1iZXIpOiBudW1iZXIge1xuICAvLyBUbyBjb252ZXJ0IGEgc2NhbGluZyBmYWN0b3IgdG8gREdMRCwgbm90ZSB0aGF0IHBhdGNoZWQgZ29sZCBkcm9wcyBzY2FsZSBieVxuICAvLyB0aGUgZ29sZGVuIHJhdGlvICgxLjYxOCkuLi4/XG4gIHJldHVybiAyICoqIChzY2FsaW5nIC8gNyAtIDEpO1xufVxuXG4vLyBHb2xkIGFuZCBFeHBlcmllbmNlIHNjYWxpbmc6XG4vLyAgLSBnb2FsOiBiYXNlIGV4cCBzaG91bGQgYmUgcm91Z2hseSAxIGF0IDAgYW5kIDEwMDAgYXJvdW5kIDQwLTQ4XG4vLyAgICAgICAgICB2YXJpYW5jZSB3aXRoaW4gYSBkaWZmaWN1bHR5IGxldmVsOiBmYWN0b3Igb2YgOD9cbi8vICAgICAgICAgIHNvIGlmIHdlIHdhbnQgdG8gc3RhcnQgc2F0dXJhdGluZyBhcm91bmQgNDQsIHRoZW4gd2Vcbi8vICAgICAgICAgIHNob3VsZCBzaG9vdCBmb3IgYSBiYXNlIG9mIDI1NiBhdCA0NSxcbi8vICAgICAgICAgIE1heWJlIHNsb3cgZG93biB0aGUgZ3Jvd3RoIHRvIDEvNSwgc28gdGhhdCB3ZSdyZSBhdCAwLjUgYXQgMD9cbi8vICAgICAgICAgIGJhc2UgPSAyXihzLzUtMSlcbi8vICAgICAgICAgIHNjYWxlIGZhY3RvciA9IDAuLjggZm9yIHZhcmlvdXMgbm9ybWFsIGVuZW1pZXMsIDE2aXNoIGZvciBib3NzZXMuXG4vLyAgLSBnb2FsOiBiYXNlIGdvbGQgc2hvdWxkIGJlIDAuNSBhdCAwIGFuZCA1MCBhdCA0NyAoaW4gdmFuaWxsYSB1bml0cykuXG4vLyAgICAgICAgICBiYXNlID0gMl4ocy83LTEpXG4vLyBUaGlzIG1ha2VzIHRoZSBhdmVyYWdlIFwid2VhbHRoXCIgKGRlZmluZWQgYXMgc2dsZCAvIChzZXhwICsgc2dsZCkpIHRvXG4vLyBhdmVyYWdlIHJvdWdobHkgMC41IGF0IGFsbCBkaWZmaWN1bHR5IGxldmVscy5cblxuLy8gREVBVEggUkVQTEFDRU1FTlRTLi4uP1xuXG5cbmludGVyZmFjZSBBY3Rpb25TY3JpcHREYXRhIHtcbiAgY2hpbGQ/OiBib29sZWFuO1xuICBsYXJnZT86IGJvb2xlYW47XG4gIGJpcmQ/OiBib29sZWFuO1xuICBtb3RoPzogYm9vbGVhbjtcbiAgc3RhdGlvbmFyeT86IGJvb2xlYW47XG4gIGJvc3M/OiBib29sZWFuO1xuICBwcm9qZWN0aWxlPzogbnVtYmVyO1xuICBtb3ZlbWVudD86IG51bWJlcjtcbiAgbWV0YXNwcml0ZXM/OiAobzogT2JqZWN0RGF0YSkgPT4gcmVhZG9ubHkgbnVtYmVyW107XG4gIHBsYWNlbWVudD86IFBsYWNlbWVudDtcbiAgLy8gVGhpcyBpcyBvbiB0b3Agb2YgYW55IGVmZmVjdCBmcm9tIHNhdGssIHN0YXR1cywgZXRjLlxuICAvLyBkaWZmaWN1bHR5PzogKG86IE1vbnN0ZXIsIGM/OiBNb25zdGVyKSA9PiBEaWZmaWN1bHR5RmFjdG9yO1xuICAvLyBmbHllcj8gc3RhdGlvbmFyeT8gbGFyZ2U/IHJlcXVpcmVkIHNwYWNlP1xufVxuXG50eXBlIFBsYWNlbWVudCA9ICdub3JtYWwnIHwgJ21vdGgnIHwgJ2JpcmQnIHwgJ3BsYW50JztcblxuLy8gU2V0IG9mIGFjdGlvbiBzY3JpcHQgSURzLlxuLy8gV2UgY291bGQgcG9zc2libHkgZG8gYmV0dGVyIHdpdGggYSBxdWljayBjb3ZlcmFnZSBhbmFseXNpcyBvZiB0aGUgYWN0dWFsIGNvZGUuXG4vLyBTZWUgd2hhdCBhZGRyZXNzZXMgYXJlIGhpdCAoYW5kIHJvdXRpbmVzIGNhbGxlZCkgYmVmb3JlIHRoZSBydHMuXG5leHBvcnQgY29uc3QgQUNUSU9OX1NDUklQVFMgPSBuZXcgTWFwPG51bWJlciwgQWN0aW9uU2NyaXB0RGF0YT4oW1xuICBbMHgxMCwgeyAvLyBzdHJhaWdodCBzaG90IChvcHRpb25hbCBib3VuY2UpXG4gIH1dLFxuICBbMHgxMSwgeyAvLyBzdHJhaWdodCBzaG90XG4gIH1dLFxuICBbMHgxNiwgeyAvLyBtYWRvIHNodXJpa2VuXG4gIH1dLFxuICBbMHgxNywgeyAvLyBkZW1vbiB3YWxsIGZpcmVcbiAgfV0sXG4gIFsweDFiLCB7IC8vIGRyYXlnb24yIC8ga2FybWluZSBiYWxsc1xuICB9XSxcbiAgWzB4MWQsIHsgLy8gYnJvd24gcm9ib3QgaGFycG9vbiBzb3VyY2UgKG9iamVjdCAkYmUpXG4gICAgY2hpbGQ6IHRydWUsXG4gIH1dLFxuICBbMHgxZSwgeyAvLyBkcmF5Z29uMiBsYXNlcnNcbiAgfV0sXG4gIFsweDFmLCB7IC8vIHBhcmFseXNpcyBwb3dkZXJcbiAgfV0sXG4gIFsweDIwLCB7IC8vIGJsdWUgc2xpbWUsIGV0YyAocmFuZG9tKVxuICAgIG1vdmVtZW50OiAxLCAvLyBzbG93IHJhbmRvbVxuICB9XSxcbiAgWzB4MjEsIHsgLy8gbWVkdXNhLCBldGMgKHJhbmRvbSBsYXJnZSBzdG9uZXJzKVxuICAgIGNoaWxkOiB0cnVlLFxuICAgIGxhcmdlOiB0cnVlLFxuICAgIG1vdmVtZW50OiAyLCAvLyBmYXN0IHJhbmRvbVxuICB9XSxcbiAgWzB4MjIsIHsgLy8gd3JhaXRoLCB6b21iaWUgKG9wdGlvbmFsKVxuICAgIGNoaWxkOiB0cnVlLFxuICAgIG1vdmVtZW50OiAzLCAvLyBzbG93IGhvbWluZ1xuICB9XSxcbiAgWzB4MjQsIHsgLy8gd2VyZXRpZ2VyLCBub24tc2hvb3Rpbmcgd3l2ZXJucyAoc21hbGwgaG9taW5nKVxuICAgIG1vdmVtZW50OiAzLCAvLyBzbG93IGhvbWluZ1xuICB9XSxcbiAgWzB4MjUsIHsgLy8gbXVzaHJvb20sIGFuZW1vbmVzXG4gICAgbW92ZW1lbnQ6IDMsIC8vIHNsb3cgaG9taW5nXG4gIH1dLFxuICBbMHgyNiwgeyAvLyBvcmMvd3l2ZXJuL3NoYWRvdyAgLT4gZTkvMTAgPTIgIHwgIGUzLzExID0wIChzdGF0dXMpXG4gICAgY2hpbGQ6IHRydWUsXG4gICAgcHJvamVjdGlsZTogMSwgLy8gb25seSBmb3Igbm9uLXN0YXR1cyBvcmNcbiAgICBtb3ZlbWVudDogMywgLy8gc2xvdyBob21pbmdcbiAgfV0sXG4gIFsweDI3LCB7IC8vIHRyb2xsL3NwaWRlci9maXNobWFuL3NhbGFtYW5kZXIvdGFyYW50dWxhL211bW15ICAtPlxuICAgIGNoaWxkOiB0cnVlLFxuICAgIHByb2plY3RpbGU6IDEsXG4gICAgbW92ZW1lbnQ6IDMsIC8vIHNsb3cgaG9taW5nXG4gIH1dLFxuICBbMHgyOCwgeyAvLyBnb2xlbSAgIC0+IGU1LzEwID0zXG4gICAgY2hpbGQ6IHRydWUsXG4gICAgcHJvamVjdGlsZTogMiwgLy8gZGlhZ29uYWxcbiAgICBtb3ZlbWVudDogMywgLy8gc2xvdyBob21pbmdcbiAgICBtZXRhc3ByaXRlczogKCkgPT4gWzB4NjUsIDB4OTFdLFxuICB9XSxcbiAgWzB4MjksIHsgLy8gbGF2YW1hblxuICAgIGNoaWxkOiB0cnVlLFxuICAgIC8vIHByb2plY3RpbGUgZG9lcyBubyBkYW1hZ2VcbiAgICBtb3ZlbWVudDogNSwgLy8gcHVkZGxlXG4gICAgbWV0YXNwcml0ZXM6ICgpID0+IFsweDZiLCAweDY4XSxcbiAgfV0sXG4gIFsweDJhLCB7IC8vIHNvbGRpZXIvYXJjaGVyL2tuaWdodC9icm93biByb2JvdFxuICAgIGNoaWxkOiB0cnVlLFxuICAgIHByb2plY3RpbGU6IDEsXG4gICAgbW92ZW1lbnQ6IDQsIC8vIGZhc3QgaG9taW5nXG4gICAgbWV0YXNwcml0ZXM6IChvKSA9PiBbMCwgMSwgMiwgM10ubWFwKHggPT4geCArIG8uZGF0YVszMV0pLCAvLyBkaXJlY3Rpb25hbCB3YWxrZXJcbiAgfV0sXG4gIFsweDJiLCB7IC8vIG1pbWljXG4gICAgbW92ZW1lbnQ6IDQsIC8vIGZhc3QgaG9taW5nXG4gIH1dLFxuICBbMHgyYywgeyAvLyBtb3RoIHJlc2lkdWUgc291cmNlIChmcm9tIDRkIG9iamVjdCByZXBsYWNlbWVudClcbiAgICBjaGlsZDogdHJ1ZSxcbiAgfV0sXG4gIFsweDJlLCB7IC8vIGZsYWlsIGd1eXNcbiAgICBjaGlsZDogdHJ1ZSxcbiAgICBsYXJnZTogdHJ1ZSxcbiAgICBwcm9qZWN0aWxlOiAyLFxuICAgIG1vdmVtZW50OiAzLCAvLyBzbG93IGhvbWluZ1xuICB9XSxcbiAgWzB4MmYsIHsgLy8gZHluYSBsYXNlclxuICB9XSxcbiAgWzB4MzQsIHsgLy8gZ3VhcmRpYW4gc3RhdHVlXG4gICAgY2hpbGQ6IHRydWUsXG4gIH1dLFxuICBbMHgzOCwgeyAvLyBtb3ZpbmcgcGxhdGZvcm1cbiAgfV0sXG4gIFsweDNjLCB7IC8vIGNydW1ibGluZyBtb3ZpbmcgcGxhdGZvcm1cbiAgICAvLyBUT0RPIC0gd2lsbCBuZWVkIHRvIGNvcHkgdGhlIGhvcml6b3RhbCB2ZXJzaW9uJ3MgZ3JhcGhpY3M/XG4gIH1dLFxuICBbMHg0MCwgeyAvLyBiYXQsIG1vdGhcbiAgICBjaGlsZDogdHJ1ZSxcbiAgICBtb3RoOiB0cnVlLFxuICAgIC8vIHByb2plY3RpbGU6IDIsXG4gICAgbW92ZW1lbnQ6IDQsIC8vIHNsb3cgZmx5ZXJcbiAgICBwbGFjZW1lbnQ6ICdtb3RoJyxcbiAgfV0sXG4gIFsweDQxLCB7IC8vIHNrZWxldG9uIChtcCBkcmFpbiB3ZWIpXG4gICAgY2hpbGQ6IHRydWUsXG4gICAgbW92ZW1lbnQ6IDMsIC8vIHNsb3cgaG9taW5nXG4gIH1dLFxuICBbMHg0NCwgeyAvLyBzd2FtcCB0b21hdG9cbiAgICBtb3ZlbWVudDogMywgLy8gc2xvdyBob21pbmdcbiAgfV0sXG4gIFsweDQ1LCB7IC8vIGluc2VjdHMgKHBhcmFseXNpcyBvciBzaG9vdGluZyksIGJvbWJlciBiaXJkIChvcHRpb25hbCBzaG90KVxuICAgIGNoaWxkOiB0cnVlLFxuICAgIGJpcmQ6IHRydWUsXG4gICAgcHJvamVjdGlsZTogMixcbiAgICBtb3ZlbWVudDogNSwgLy8gZmFzdCBmbHllclxuICAgIHBsYWNlbWVudDogJ2JpcmQnLFxuICB9XSxcbiAgWzB4NGMsIHsgLy8gc3dhbXAgcGxhbnQgLT4gZWEvMTAgPTVcbiAgICBjaGlsZDogdHJ1ZSxcbiAgICBzdGF0aW9uYXJ5OiB0cnVlLFxuICAgIHByb2plY3RpbGU6IDMsXG4gICAgcGxhY2VtZW50OiAncGxhbnQnLFxuICB9XSxcbiAgWzB4NGQsIHsgLy8ga3Jha2VuXG4gICAgY2hpbGQ6IHRydWUsXG4gICAgc3RhdGlvbmFyeTogdHJ1ZSxcbiAgICBwcm9qZWN0aWxlOiAzLFxuICB9XSxcbiAgWzB4NGUsIHsgLy8gYnVydFxuICAgIGNoaWxkOiB0cnVlLFxuICAgIHN0YXRpb25hcnk6IHRydWUsXG4gIH1dLFxuICBbMHg1NywgeyAvLyBkeW5hIHNob3RzXG4gIH1dLFxuICBbMHg1OCwgeyAvLyBzYWJlcmEyIGZpcmVcbiAgfV0sXG4gIFsweDVjLCB7IC8vIHRvd2VyIHNlbnRpbmVsXG4gICAgY2hpbGQ6IHRydWUsXG4gICAgcHJvamVjdGlsZTogMyxcbiAgICBtb3ZlbWVudDogMSxcbiAgfV0sXG4gIFsweDVkLCB7IC8vIGhlbGljb3B0ZXJcbiAgICBiaXJkOiB0cnVlLFxuICAgIG1vdmVtZW50OiA2LFxuICAgIHBsYWNlbWVudDogJ2JpcmQnLFxuICB9XSxcbiAgWzB4NWUsIHsgLy8gd2hpdGUgcm9ib3RcbiAgICBjaGlsZDogdHJ1ZSxcbiAgICBwcm9qZWN0aWxlOiAxLFxuICAgIG1vdmVtZW50OiA0LCAvLyBmYXN0IGhvbWluZ1xuICAgIG1ldGFzcHJpdGVzOiAobykgPT4gWzAsIDEsIDIsIDNdLm1hcCh4ID0+IHggKyBvLmRhdGFbMzFdKSwgLy8gZGlyZWN0aW9uYWwgd2Fsa2VyXG4gIH1dLFxuICBbMHg2MCwgeyAvLyB2YW1waXJlXG4gICAgYm9zczogdHJ1ZSxcbiAgfV0sXG4gIFsweDYxLCB7IC8vIHZhbXBpcmUgYmF0XG4gIH1dLFxuICBbMHg2MywgeyAvLyBrZWxiZXNxdWVcbiAgICBib3NzOiB0cnVlLFxuICB9XSxcbiAgWzB4NjQsIHsgLy8ga2VsYmVzcXVlMSByb2NrXG4gICAgYm9zczogdHJ1ZSxcbiAgfV0sXG4gIFsweDY2LCB7IC8vIHNhYmVyYVxuICAgIGJvc3M6IHRydWUsXG4gIH1dLFxuICBbMHg2NywgeyAvLyBtYWRvXG4gICAgYm9zczogdHJ1ZSxcbiAgfV0sXG4gIFsweDY4LCB7IC8vIGthcm1pbmVcbiAgICBib3NzOiB0cnVlLFxuICB9XSxcbiAgWzB4NmEsIHsgLy8gZHJheWdvbjFcbiAgICBib3NzOiB0cnVlLFxuICB9XSxcbiAgWzB4NmIsIHsgLy8gZHJheWdvbjJcbiAgICBib3NzOiB0cnVlLFxuICB9XSxcbiAgWzB4NzAsIHsgLy8gZHluYSwgZmxhaWxcbiAgICBib3NzOiB0cnVlLFxuICB9XSxcbiAgWzB4N2YsIHsgLy8gaW5zZWN0XG4gICAgYm9zczogdHJ1ZSxcbiAgfV0sXG4gIC8vIFRPRE8gLSBqdXN0IGhhcmRjb2RlIGJvc3MgZGlmZmljdWx0aWVzPyAgZml4IHRoZW0gYXQgbWF4P1xuXSk7XG5cblxuXG4vLyBTY2FsaW5nIGZvcm11bGFzXG5mdW5jdGlvbiBsZXZlbChzY2FsaW5nOiBudW1iZXIpOiBudW1iZXIge1xuICAvLyBUT0RPIC0gbm90IHN1cGVyIHVzZWZ1bC4uLj9cbiAgLy8gU2VlbXMgbGlrZSBJIGFjdHVhbGx5IHdhbnQgdGhlIGxldmVsLCBub3QgdGhlIHNjYWxpbmcuXG4gIC8vIDctb2ZmIGNvbXByZXNzaW9tXG4gIHJldHVybiBzY2FsaW5nIDwgMjQgPyAxICsgc2NhbGluZyAvIDMgOiAoc2NhbGluZyArIDEyKSAvIDQ7XG59XG5cbi8qKiBCZXN0IHN3b3JkIG93bmVkIGJ5IHBsYXllciBhdCBnaXZlbiAodmFuaWxsYSBlcXVpdmFsZW50KSBzY2FsaW5nLiAqL1xuZnVuY3Rpb24gcGxheWVyU3dvcmQoc2NhbGluZzogbnVtYmVyLCBlbGVtZW50czogbnVtYmVyID0gMCk6IG51bWJlciB7XG4gIGNvbnN0IGJlc3RPd25lZCA9IHNjYWxpbmcgPCAxMCA/IDEgOiBzY2FsaW5nIDwgMTggPyAyIDogc2NhbGluZyA8IDM4ID8gNCA6IDg7XG4gIGZvciAobGV0IGkgPSBiZXN0T3duZWQ7IGk7IGkgPj4+PSAxKSB7XG4gICAgaWYgKCEoaSAmIGVsZW1lbnRzKSkgcmV0dXJuIGkgPDwgMTtcbiAgfVxuICByZXR1cm4gYmVzdE93bmVkIDw8IDE7XG59XG5cbi8qKiBFeHBlY3RlZCB0b3RhbCBkZWZlbnNlLiAqL1xuZnVuY3Rpb24gZXhwZWN0ZWRQbGF5ZXJEZWZlbnNlKHNjYWxpbmc6IG51bWJlciwgYXR0YWNrVHlwZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIGxldmVsKHNjYWxpbmcpICsgcGxheWVyQXJtb3Ioc2NhbGluZywgYXR0YWNrVHlwZSk7XG59XG5cbi8qKiBFeHBlY3RlZCBhcm1vci9zaGllbGQgZGVmZW5zZSBhdCBnaXZlbiBzY2FsaW5nLiAqL1xuZnVuY3Rpb24gcGxheWVyQXJtb3Ioc2NhbGluZzogbnVtYmVyLCBhdHRhY2tUeXBlOiBudW1iZXIpOiBudW1iZXIge1xuICBpZiAoIWF0dGFja1R5cGUpIHsgLy8gYm9keSBkYW1hZ2VcbiAgICByZXR1cm4gbG9va3VwKHNjYWxpbmcsIDIsIFs2LCA2XSwgWzE4LCAxMF0sIFsyNSwgMTRdLCBbMzAsIDE4XSwgWzQwLCAyNF0sIFs0NiwgMzJdKTtcbiAgfSBlbHNlIHsgLy8gcHJvamVjdGlsZSBkYW1hZ2VcbiAgICByZXR1cm4gbG9va3VwKHNjYWxpbmcsIDIsIFs2LCA2XSwgWzE4LCA4XSwgWzI1LCAxMl0sIFszMCwgMThdLCBbMzcsIDI0XSwgWzQyLCAzMl0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGxvb2t1cDxLIGV4dGVuZHMgQ29tcGFyYWJsZSwgVj4oeDogSyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Q6IFYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnRhYmxlOiBSZWFkb25seUFycmF5PHJlYWRvbmx5IFtLLCBWXT4pOiBWIHtcbiAgZm9yIChsZXQgaSA9IHRhYmxlLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgY29uc3QgW2ssIHZdID0gdGFibGVbaV07XG4gICAgaWYgKHggPj0gaykgcmV0dXJuIHY7XG4gIH1cbiAgcmV0dXJuIGZpcnN0O1xufVxuXG50eXBlIENvbXBhcmFibGUgPSBudW1iZXIgfCBzdHJpbmc7XG4iXX0=