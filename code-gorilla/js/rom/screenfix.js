import { Spawn } from './locationtables.js';
import { iters } from '../util.js';
export var ScreenFix;
(function (ScreenFix) {
    ScreenFix[ScreenFix["Unknown"] = 0] = "Unknown";
    ScreenFix[ScreenFix["GrassLongGrass"] = 1] = "GrassLongGrass";
    ScreenFix[ScreenFix["GrassLongGrassRemapping"] = 2] = "GrassLongGrassRemapping";
    ScreenFix[ScreenFix["RiverShortGrass"] = 3] = "RiverShortGrass";
    ScreenFix[ScreenFix["SeaCaveEntrance"] = 4] = "SeaCaveEntrance";
    ScreenFix[ScreenFix["SeaRocks"] = 5] = "SeaRocks";
    ScreenFix[ScreenFix["SeaMarsh"] = 6] = "SeaMarsh";
    ScreenFix[ScreenFix["SeaTrees"] = 7] = "SeaTrees";
    ScreenFix[ScreenFix["DesertShortGrass"] = 8] = "DesertShortGrass";
    ScreenFix[ScreenFix["DesertLongGrass"] = 9] = "DesertLongGrass";
    ScreenFix[ScreenFix["DesertMarsh"] = 10] = "DesertMarsh";
    ScreenFix[ScreenFix["DesertRocks"] = 11] = "DesertRocks";
    ScreenFix[ScreenFix["DesertTrees"] = 12] = "DesertTrees";
    ScreenFix[ScreenFix["DesertTownEntrance"] = 13] = "DesertTownEntrance";
    ScreenFix[ScreenFix["LabyrinthParapets"] = 14] = "LabyrinthParapets";
    ScreenFix[ScreenFix["SwampDoors"] = 15] = "SwampDoors";
    ScreenFix[ScreenFix["ExtraSpikes"] = 16] = "ExtraSpikes";
    ScreenFix[ScreenFix["CloseCaves"] = 17] = "CloseCaves";
    ScreenFix[ScreenFix["WideArenaExits"] = 18] = "WideArenaExits";
})(ScreenFix || (ScreenFix = {}));
export function withRequire(requirement, props) {
    for (const key in props) {
        props[key].requires = [requirement];
    }
    return props;
}
export function fixTilesets(rom) {
    const { desert, grass, lime, mountain, mountainRiver, river, sea } = rom.metatilesets;
    const $ = rom.metascreens;
    $.registerFix(ScreenFix.DesertRocks);
    desert.getTile(0x5f).copyFrom(0x5b).replaceIn($.oasisCave, $.oasisLake);
    desert.getTile(0x5a).copyFrom(0x98).setTiles([, , 0x1a, 0x18]);
    desert.getTile(0x5b).copyFrom(0x80).setTiles([0x34, 0x32, ,]);
    desert.getTile(0x5c).copyFrom(0x80).setTiles([, , 0x37, 0x35]);
    desert.getTile(0x5d).copyFrom(0x80).setTiles([, 0x37, , 0x34]);
    desert.getTile(0x5e).copyFrom(0x80).setTiles([0x35, , 0x32,]);
    $.registerFix(ScreenFix.DesertTrees);
    desert.getTile(0x63).copyFrom(0x71);
    desert.getTile(0x68).copyFrom(0x70);
    desert.getTile(0x69).copyFrom(0x60);
    desert.getTile(0x6a).copyFrom(0x65);
    desert.getTile(0x6c).copyFrom(0x70);
    desert.getTile(0x6e).copyFrom(0x76);
    desert.getTile(0x6f).copyFrom(0x78);
    $.registerFix(ScreenFix.GrassLongGrass);
    grass.getTile(0x40).copyFrom(0x51);
    grass.getTile(0x41).copyFrom(0x52);
    grass.getTile(0x42).copyFrom(0x53);
    grass.getTile(0x43).copyFrom(0x54);
    grass.getTile(0x44).copyFrom(0x55);
    grass.getTile(0x45).copyFrom(0x56);
    grass.getTile(0x46).copyFrom(0x58);
    grass.getTile(0x47).copyFrom(0x59);
    $.registerFix(ScreenFix.SeaCaveEntrance);
    sea.getTile(0xad).copyFrom(0x0a)
        .replaceIn($.beachExitN, $.lighthouseEntrance, $.oceanShrine);
    sea.getTile(0x0a).copyFrom(0xa2);
    $.boundaryN_cave.screen.set2d(0x38, [[null, 0x00, 0x00, null],
        [null, 0x0a, 0x0a, null],
        [null, 0xf7, 0xf7, null],
        [0xf8, 0xf8, 0xf8, 0xf8]]);
    $.cornerSE_cave.screen.set2d(0x49, [[null, 0x00, 0x00],
        [null, 0x0a, 0x0a],
        [null, 0xf7, 0xf7],
        [0xf8, 0xf7, 0xf7],
        [null, 0xfd, 0xf7]]);
    $.cornerSE_cave.screen.set2d(0x4a, [[0x00, 0x00],
        [0x0a, 0x0a],
        [0xf7, 0xf7],
        [0xf8, 0xf7],
        [0x80, 0xfd],
        [0x80, 0xff],
        [0xfa, null]]);
    $.registerFix(ScreenFix.CloseCaves);
    river.getTile(0x07).copyFrom(0x01).replaceIn(...river);
    river.getTile(0x0e).copyFrom(0x02).replaceIn(...river);
    river.getTile(0x20).copyFrom(0x03).replaceIn(...river);
    river.getTile(0x21).copyFrom(0x04).replaceIn(...river);
    for (const ts of [desert, sea, mountain, mountainRiver, lime]) {
        ts.getTile(0x68).copyFrom(0x01).replaceIn(...ts);
        ts.getTile(0x83).copyFrom(0x02).replaceIn(...ts);
        ts.getTile(0x88).copyFrom(0x03).replaceIn(...ts);
        ts.getTile(0x89).copyFrom(0x04).replaceIn(...ts);
    }
    for (const ts of [river, desert, sea]) {
        ts.getTile(0x01).copyFrom(0xc1).setAlternative(0x00);
        ts.getTile(0x02).copyFrom(0xc1).setAlternative(0x00);
        ts.getTile(0x03).copyFrom(0xd7).setAlternative(0x0a);
        ts.getTile(0x04).copyFrom(0xd7).setAlternative(0x0a);
    }
    const closedCaves = [
        [$.boundaryE_cave, 0x48], [$.boundaryW_cave, 0x79],
        [$.exitW_cave, 0x38], [$.caveAbovePortoa, 0x56],
    ];
    for (const [scr, pos] of closedCaves) {
        scr.screen.set2d(pos, [[1, 2], [3, 4]]);
        scr.addCustomFlag(true);
    }
    {
        const { locations: { CordelPlainEast, CordelPlainWest, WaterfallValleyNorth }, flags: { OpenedSealedCave, OpenedPrison } } = rom;
        CordelPlainEast.meta.customFlags.set(0x30, OpenedSealedCave);
        CordelPlainWest.meta.customFlags.set(0x30, OpenedSealedCave);
        WaterfallValleyNorth.meta.customFlags.set(0x00, OpenedPrison);
        const explosion = Spawn.of({ y: 0x060, x: 0x060, type: 4, id: 0x2c });
        const keyTrigger = Spawn.of({ y: 0x070, x: 0x070, type: 2, id: 0xad });
        WaterfallValleyNorth.spawns.splice(1, 0, explosion);
        WaterfallValleyNorth.spawns.push(keyTrigger);
    }
}
export function wideArenaExits(rom) {
    var _a;
    function widen(exits) {
        exits.splice(0, exits.length, ...new Set(iters.concat(...exits.map(e => [e, e + 1, e - 1]))));
    }
    const { fortressArena_through, fortressTrap, hallNS, hallNS_arena, hallNS_arenaWall, hallNS_entrance, } = rom.metascreens;
    hallNS_arena.screen.set2d(0x04, [
        [0x97, 0x76, 0x22, 0x23, 0x23, 0x23, 0x4b, 0x95],
        [0x42, 0x48, 0x22, 0x21, 0x23, 0x23, 0x45, 0x42],
        [0x43, 0x49, 0x2e, 0x23, 0x23, 0x21, 0x46, 0x43],
        [0x44, 0x4a, 0x2e, 0x23, 0x21, 0x21, 0x47, 0x44],
    ]);
    hallNS_arena.setGridTile(' c | a | c ');
    widen(hallNS_arena.findExitByType('edge:top').exits);
    hallNS_arenaWall.screen.set2d(0x04, [
        [0x94, 0x4c, 0x22, 0x21, 0x21, 0x21, 0x4b, 0x93],
        [0x97, 0x4f, 0x00, 0x01, 0x01, 0x02, 0x50, 0x95],
    ]);
    hallNS_arenaWall.setGridTile(' c | a | c ');
    widen(hallNS_arenaWall.findExitByType('edge:top').exits);
    const abductionTrigger = rom.locations.ZebuCave.spawns.find(s => s.isTrigger() && s.id === 0x8c);
    if (abductionTrigger)
        abductionTrigger.yt += 4;
    fortressArena_through.screen.set2d(0x05, [
        [0x5f, 0x22, 0x21, 0x21, 0x21, 0x5f],
        [0xb7, 0x22, 0x21, 0x21, 0x21, 0xb5],
        [0xbf, 0x22, 0x21, 0x21, 0x21, 0xa8],
    ]);
    fortressArena_through.setGridTile(' c | a | w ');
    widen(fortressArena_through.findExitByType('edge:top').exits);
    fortressTrap.screen.set2d(0xc4, [
        [0x3c, 0x3d, 0x21, 0x21, 0x21, 0x21, 0x3b, 0x3c],
        [0x92, 0x4c, 0x22, 0x21, 0x21, 0x21, 0x4b, 0x90],
        [0x94, 0x4c, 0x22, 0x21, 0x21, 0x21, 0x4b, 0x93],
    ]);
    fortressTrap.setGridTile('   | x | c ');
    widen(fortressTrap.findExitByType('edge:bottom').exits);
    for (const location of rom.locations) {
        const meta = location.meta;
        for (const pos of meta.allPos()) {
            const scr = meta.get(pos);
            if (scr === hallNS_entrance && ((_a = meta.get(pos + 16)) === null || _a === void 0 ? void 0 : _a.hasFeature('arena'))) {
                meta.set(pos, hallNS);
                const row = location.screens[pos >>> 4];
                if (row)
                    row[pos & 0xf] = hallNS.sid;
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyZWVuZml4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3JvbS9zY3JlZW5maXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRTVDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFHbkMsTUFBTSxDQUFOLElBQVksU0E4RFg7QUE5REQsV0FBWSxTQUFTO0lBQ25CLCtDQUFPLENBQUE7SUFHUCw2REFBYyxDQUFBO0lBS2QsK0VBQXVCLENBQUE7SUFJdkIsK0RBQWUsQ0FBQTtJQUtmLCtEQUFlLENBQUE7SUFNZixpREFBUSxDQUFBO0lBR1IsaURBQVEsQ0FBQTtJQUlSLGlEQUFRLENBQUE7SUFHUixpRUFBZ0IsQ0FBQTtJQUdoQiwrREFBZSxDQUFBO0lBSWYsd0RBQVcsQ0FBQTtJQUdYLHdEQUFXLENBQUE7SUFHWCx3REFBVyxDQUFBO0lBR1gsc0VBQWtCLENBQUE7SUFFbEIsb0VBQWlCLENBQUE7SUFFakIsc0RBQVUsQ0FBQTtJQUVWLHdEQUFXLENBQUE7SUFFWCxzREFBVSxDQUFBO0lBR1YsOERBQWMsQ0FBQTtBQUNoQixDQUFDLEVBOURXLFNBQVMsS0FBVCxTQUFTLFFBOERwQjtBQUdELE1BQU0sVUFBVSxXQUFXLENBQWlCLFdBQXNCLEVBQUUsS0FBUTtJQUMxRSxLQUFLLE1BQU0sR0FBRyxJQUFJLEtBQUssRUFBRTtRQUN2QixLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7S0FDckM7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUM7QUE0Q0QsTUFBTSxVQUFVLFdBQVcsQ0FBQyxHQUFRO0lBQ2xDLE1BQU0sRUFBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFDbkIsUUFBUSxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFDLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQztJQUMvRCxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUMsV0FBVyxDQUFDO0lBSTFCLENBQUMsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3JDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUV4RSxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEFBQUQsRUFBRyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEFBQUQsRUFBSSxDQUFDLENBQUM7SUFDL0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxBQUFELEVBQUcsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDL0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQUFBRCxFQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDL0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxFQUFFLEFBQUQsRUFBRyxJQUFJLEVBQUcsQ0FBQyxDQUFDO0lBRS9ELENBQUMsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ3JDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBSXBDLENBQUMsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ3hDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25DLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBV25DLENBQUMsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQ3pDLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztTQUMzQixTQUFTLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQ2xFLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWpDLENBQUMsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztRQUN4QixDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztRQUN4QixDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztRQUN4QixDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNoRSxDQUFDLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNsQixDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ2xCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUM7UUFDbEIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNsQixDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pELENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7UUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7UUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7UUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7UUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7UUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7UUFDWixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFZbkQsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDcEMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDdkQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDdkQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDdkQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDdkQsS0FBSyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRTtRQUM3RCxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEs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LGVBQWUsV0FBSSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsMENBQUUsVUFBVSxDQUFDLE9BQU8sRUFBQyxFQUFFO2dCQUN0RSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFFdEIsTUFBTSxHQUFHLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3hDLElBQUksR0FBRztvQkFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUM7YUFDdEM7U0FDRjtLQUNGO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuaW1wb3J0IHsgU3Bhd24gfSBmcm9tICcuL2xvY2F0aW9udGFibGVzLmpzJztcbmltcG9ydCB7IE1ldGFzY3JlZW4gfSBmcm9tICcuL21ldGFzY3JlZW4uanMnO1xuaW1wb3J0IHsgaXRlcnMgfSBmcm9tICcuLi91dGlsLmpzJztcblxuLy8gU2ltcGxlIHRpbGVzZXQtb25seSBmaXhlcyB0aGF0IHVubG9jayBzb21lIHNjcmVlbi10aWxlc2V0IGNvbWJpbmF0aW9uc1xuZXhwb3J0IGVudW0gU2NyZWVuRml4IHtcbiAgVW5rbm93bixcbiAgLy8gU3VwcG9ydCBcImxvbmcgZ3Jhc3NcIiByaXZlciBzY3JlZW5zIG9uIHRoZSBncmFzcyB0aWxlc2V0IGJ5IGNvcHlpbmdcbiAgLy8gc29tZSB0aWxlcyBmcm9tIDUxLi41OSBpbnRvIDQwLi40Ny5cbiAgR3Jhc3NMb25nR3Jhc3MsXG4gIC8vIEluIGFkZGl0aW9uIHRvIGp1c3QgbWFraW5nIHRoZSBuZXcgbG9uZyBncmFzcyB0aWxlcywgd2UgbmVlZCB0b1xuICAvLyBhbHNvIHJlbWFwIHRoZSBleGlzdGluZyBvbmVzIGluIHNvbWUgc2l0dWF0aW9ucyB0byBwb2ludCB0byB0aGVcbiAgLy8gbmV3IG9uZXMsIGUuZy4gZm9yIHNjcmVlbnMgMWQsMjkgdG8gd29yayBvbiByaXZlciwgd2UgbmVlZCB0byB1c2VcbiAgLy8gdGhlIDR4IHRpbGVzIGluc3RlYWQgb2YgdGhlIDV4IG9uZXMgdG8gZml4IHRoZSBzdXJyb3VuZGluZy5cbiAgR3Jhc3NMb25nR3Jhc3NSZW1hcHBpbmcsIC8vIFRPRE9cbiAgLy8gUml2ZXIgdGlsZXNldHMgZG9uJ3QgZGVmaW5lIDEwLDEyLDE0LDE2LDE3LDFhLDFiLDFjLDIyLDIzLDI0LDI1LDI2LFxuICAvLyB3aGljaCBhcmUgdXNlZCBmb3IgdGhlIFwic2hvcnQgZ3Jhc3NcIiBpbiB0aGUgZ3Jhc3MgdGlsZXNldC4gIFRoZXNlXG4gIC8vIHdvdWxkIGJlIGVhc3kgdG8gY29weSBmcm9tIHNvbWV3aGVyZSBlbHNlIHRvIG9wZW4gdXAgYSBmZXcgc2NyZWVucy5cbiAgUml2ZXJTaG9ydEdyYXNzLCAvLyBUT0RPXG4gIC8vIEFuZ3J5IHNlYSB1c2VzIDBhIG9kZGx5IGZvciBhIHNpbXBsZSBkaWFnb25hbCBiZWFjaC9tb3VudGFpbiB0aWxlLFxuICAvLyBwcmV2ZW50aW5nIHBhcml0eSB3aXRoIGdyYXNzL3JpdmVyIGNhdmUgZW50cmFuY2UgYm90dG9tcy4gIE1vdmUgdGhpc1xuICAvLyB0aWxlIGVsc2V3aGVyZSAoYWQpIGFuZCBmaXggdGhlIGdyYXBoaWNzL2VmZmVjdHMuICBOb3RlIHRoYXQgdGhlXG4gIC8vIGFjdHVhbCBmaXggaXMgbm90IGVudGlyZWx5IHNhdGlzZnlpbmcuXG4gIFNlYUNhdmVFbnRyYW5jZSxcbiAgLy8gQW5ncnkgc2VhIGRvZXMgbm90IGhhbmRsZSByb2NrcyBjb3JyZWN0bHkuICBGaXggNWEuLjVlIGZvciBwYXJpdHlcbiAgLy8gd2l0aCBncmFzcy9yaXZlciB0aWxlc2V0cy4gIFRPRE8gLSBpbXBsZW1lbnQgdGhlIGZpeCAod2UgY291bGQgbW92ZVxuICAvLyB0aGUgZXhpc3RpbmcgdGlsZXMsIHVzZWQgYnkgbW91bnRhaW4gZ2F0ZXMsIGVsc2V3aGVyZSBwcmV0dHkgZWFzaWx5LFxuICAvLyBvciBhbHRlcm5hdGl2ZWx5IG1vdmUgYWxsIHRoZSA1YS4uNWUgaW4gYWxsIG90aGVyIHRpbGVzZXRzIGludG9cbiAgLy8gODksOGEsOTAsOTksOWQsZDEsZDIgd2hpY2ggYXJlIGZyZWUgaW4gODAsOTAsOTQsOWMpLlxuICBTZWFSb2NrcywgLy8gVE9ET1xuICAvLyBBbGxvdyB0aGUgc2VhIHRvIHN1cHBvcnQgMzQsMzgsM2MuLjNmLCB1c2VkIGFzIG1hcnNoIGluIHJpdmVyIHRpbGVzZXQuXG4gIC8vIFRoZXNlIHdvdWxkIG5lZWQgdG8gbWFwIHRvIHNpbXBsZSBvY2VhbiB0aWxlcy4gIFRPRE8gLSBpbXBsZW1lbnQuXG4gIFNlYU1hcnNoLCAvLyBUT0RPXG4gIC8vIFN1cHBvcnQgNngsN3ggdGlsZXMgKHRyZWVzKSBvbiBhbmdyeSBzZWEuICBQcm9iYWJseSBub3Qgd29ydGggaXQuXG4gIC8vIFdvdWxkIG5lZWQgdG8gbW92ZSAoZS5nLikgTGltZSBUcmVlIExha2UgdG8gYSB0b3RhbGx5IGRpZmZlcmVudCB0aWxlc2V0XG4gIC8vIHRvIGZyZWUgdXAgdGhlIG1ldGF0aWxlcy5cbiAgU2VhVHJlZXMsIC8vIFRPRE9cbiAgLy8gRml4aW5nIFJpdmVyU2hvcnRHcmFzcyBmb3IgZGVzZXJ0IGlzIGEgbG90IGhhcmRlciBiZWNhdXNlIGl0IHRvdWNoZXMgYVxuICAvLyBidW5jaCBvZiB0aWxlcyB1c2VkIGJ5IHRoZSBtb3VudGFpblJpdmVyIHRpbGVzZXQgKDEwLDE0LDJ4KS5cbiAgRGVzZXJ0U2hvcnRHcmFzcywgLy8gVE9ET1xuICAvLyBGaXhpbmcgR3Jhc3NMb25nR3Jhc3MgZm9yIGRlc2VydCBpcyBkaWZmaWN1bHQgYmVjYXVzZSB0aGUgNHggdGlsZXNcbiAgLy8gYXJlIHVzZWQgYnkgbW91bnRhaW5SaXZlci5cbiAgRGVzZXJ0TG9uZ0dyYXNzLCAvLyBUT0RPXG4gIC8vIERlc2VydCBkb2Vzbid0IHN1cHBvcnQgdGhlIDN4IG1hcnNoIHRpbGVzIChjbGFzaCB3aXRoIG1vdW50YWluUml2ZXIpLlxuICAvLyBJdCdzIHByb2JhYmx5IG5vdCBmZWFzaWJsZSB0byBhZGQgc3VwcG9ydCAtIGl0IHdvdWxkIGFsbG93IHNjcmVlbiAzMyxcbiAgLy8gYnV0IHRoZXJlJ3MgYSBzaW1pbGFyIHNvdXRoLWVkZ2UtZXhpdCBzY3JlZW4gd2l0aCBEZXNlcnRUb3duRW50cmFuY2UuXG4gIERlc2VydE1hcnNoLCAvLyBUT0RPXG4gIC8vIEZpeCA1YS4uNWUgdG8gYmUgY29tcGF0aWJsZSB3aXRoIGdyYXNzL3JpdmVyLiAgNWIgaXMgYWxyZWFkeSBpbiB1c2VcbiAgLy8gb24gdGhlIHR3byBvYXNpcyBzY3JlZW5zLCBzbyB0aGF0IHRpbGUgaXMgbW92ZWQgdG8gNWYgdG8gbWFrZSBzcGFjZS5cbiAgRGVzZXJ0Um9ja3MsXG4gIC8vIEFkZCBzb21lIG1pc3NpbmcgdHJlZSB0aWxlcyBpbiA2Myw2OCw2OSw2YSw2Yyw2ZSw2ZiwgcmVxdWlyZWQgZm9yXG4gIC8vIHBhcml0eSB3aXRoIHNvbWUgcml2ZXIgc2NyZWVucy5cbiAgRGVzZXJ0VHJlZXMsXG4gIC8vIFNvdXRoLWZhY2luZyB0b3duIGVudHJhbmNlcyB1c2UgMDcgZm9yIHRoZSB0b3Agb2YgdGhlIHRvd24gd2FsbC5cbiAgLy8gVGhpcyBjb3VsZCBiZSByZXBsYWNlZCB3aXRoIChlLmcuIDhjKSBvciBtYXliZSBzb21ldGhpbmcgYmV0dGVyLlxuICBEZXNlcnRUb3duRW50cmFuY2UsIC8vIFRPRE9cbiAgLy8gTGFieXJpbnRoIHBhcmFwZXRzIGNhbiBiZSBibG9ja2VkL3VuYmxvY2tlZCB3aXRoIGEgZmxhZy5cbiAgTGFieXJpbnRoUGFyYXBldHMsIC8vIFRPRE8gKHNlZSBtYXplL2dvYSlcbiAgLy8gQWRkcyBmbGFnZ2FibGUgZG9vcnMgdG8gdmFyaW91cyBzY3JlZW5zLlxuICBTd2FtcERvb3JzLCAvLyBUT0RPIChzZWUgbWF6ZS9zd2FtcClcbiAgLy8gQWRkcyBzb21lIGV4dHJhIHNwaWtlIHNjcmVlbnMuXG4gIEV4dHJhU3Bpa2VzLCAvLyBUT0RPXG4gIC8vIE1ha2UgY2F2ZXMgY2xvc2VhYmxlLlxuICBDbG9zZUNhdmVzLFxuICAvLyBNYWtlcyB0aGUgdG9wIGV4aXRzIG9mIGFyZW5hcyBmdWxsLXNpemUgcmF0aGVyIHRoYW4gbmFycm93LCBnaXZpbmdcbiAgLy8gbW9yZSBmbGV4aWJpbGl0eSB3aXRoIHdoYXQgY2FuIGdvIHRoZXJlLlxuICBXaWRlQXJlbmFFeGl0cyxcbn1cblxudHlwZSBSZXFzID0gUmVjb3JkPGFueSwge3JlcXVpcmVzPzogU2NyZWVuRml4W119PlxuZXhwb3J0IGZ1bmN0aW9uIHdpdGhSZXF1aXJlPFQgZXh0ZW5kcyBSZXFzPihyZXF1aXJlbWVudDogU2NyZWVuRml4LCBwcm9wczogVCkge1xuICBmb3IgKGNvbnN0IGtleSBpbiBwcm9wcykge1xuICAgIHByb3BzW2tleV0ucmVxdWlyZXMgPSBbcmVxdWlyZW1lbnRdO1xuICB9XG4gIHJldHVybiBwcm9wcztcbn1cblxuXG4gIC8vIC8vIEFkZHMgYWJpbGl0eSB0byBjbG9zZSBjYXZlcy5cbiAgLy8gQ2xvc2VDYXZlcyxcblxuXG4vLyAvKiogQWRkcyBhICdDbG9zZUNhdmVzJyByZXF1aXJlbWVudCBvbiBhbGwgdGhlIHByb3BlcnRpZXMuICovXG4vLyBmdW5jdGlvbiBjbG9zZUNhdmVzPFQgZXh0ZW5kcyBSZWNvcmQ8YW55LCB7cmVxdWlyZXM6IFNjcmVlbkZpeFtdfT4+KHByb3BzOiBUKSB7XG4vLyAgIGZvciAoY29uc3Qga2V5IGluIHByb3BzKSB7XG4vLyAgICAgcHJvcHNba2V5XS5yZXF1aXJlcyA9IFtTY3JlZW5GaXguQ2xvc2VDYXZlc107XG4vLyAgIH1cbi8vICAgcmV0dXJuIHByb3BzO1xuLy8gfVxuXG5cbi8vIE5PVEU6IExpc3RpbmcgZXhwbGljaXQgZmxhZ3MgZG9lc24ndCBxdWl0ZSB3b3JrLlxuLy8gZW51bSBGbGFnIHtcbi8vICAgQWx3YXlzID0gMHgyZjAsXG4vLyAgIFdpbmRtaWxsID0gMHgyZWUsXG4vLyAgIFByaXNvbiA9IDB4MmQ4LFxuLy8gICBDYWxtID0gMHgyODMsXG4vLyAgIFN0eXggPSAweDJiMCxcbi8vICAgRHJheWdvbjEgPSAweDI4Zixcbi8vICAgRHJheWdvbjIgPSAweDI4ZCxcbi8vIH1cblxuLy8gY29uc3QgR1JBU1MgPSAweDgwO1xuLy8gY29uc3QgVE9XTiA9IDB4ODQ7XG4vLyBjb25zdCBDQVZFID0gMHg4ODtcbi8vIGNvbnN0IFBZUkFNSUQgPSAweDhjO1xuLy8gY29uc3QgUklWRVIgPSAweDkwO1xuLy8gY29uc3QgTU9VTlRBSU4gPSAweDk0O1xuLy8gY29uc3QgU0VBID0gMHg5NDtcbi8vIGNvbnN0IFNIUklORSA9IDB4OTg7XG4vLyBjb25zdCBERVNFUlQgPSAweDljO1xuLy8gY29uc3QgTU9VTlRBSU5fUklWRVIgPSAweDljO1xuLy8gY29uc3QgU1dBTVAgPSAweGEwO1xuLy8gY29uc3QgSE9VU0UgPSAweGEwO1xuLy8gY29uc3QgRk9SVFJFU1MgPSAweGE0O1xuLy8gY29uc3QgSUNFX0NBVkUgPSAweGE4O1xuLy8gY29uc3QgVE9XRVIgPSAweGFjO1xuXG4vKiogQXBwbHkgc3RhbmRhcmQgdGlsZXNldCBmaXhlcy4gIE90aGVycyBtYXkgYmUgYXBwbGllZCBsYXRlci4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaXhUaWxlc2V0cyhyb206IFJvbSkge1xuICBjb25zdCB7ZGVzZXJ0LCBncmFzcywgbGltZSxcbiAgICAgICAgIG1vdW50YWluLCBtb3VudGFpblJpdmVyLCByaXZlciwgc2VhfSA9IHJvbS5tZXRhdGlsZXNldHM7XG4gIGNvbnN0ICQgPSByb20ubWV0YXNjcmVlbnM7XG5cbiAgLy8gU2V2ZXJhbCBvZiB0aGUgZ3Jhc3Mvcml2ZXIgc2NyZWVucyB3aXRoIGZvcmVzdCB0aWxlcyBkb24ndCB3b3JrIG9uXG4gIC8vIGRlc2VydC4gIEZpeCB0aGVtIGJ5IG1ha2luZyA1YS4uNmYgd29yayBjb3JyZWN0bHkuXG4gICQucmVnaXN0ZXJGaXgoU2NyZWVuRml4LkRlc2VydFJvY2tzKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg1ZikuY29weUZyb20oMHg1YikucmVwbGFjZUluKCQub2FzaXNDYXZlLCAkLm9hc2lzTGFrZSk7XG5cbiAgZGVzZXJ0LmdldFRpbGUoMHg1YSkuY29weUZyb20oMHg5OCkuc2V0VGlsZXMoWywgLCAweDFhLCAweDE4XSk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NWIpLmNvcHlGcm9tKDB4ODApLnNldFRpbGVzKFsweDM0LCAweDMyLCAsIF0pO1xuICBkZXNlcnQuZ2V0VGlsZSgweDVjKS5jb3B5RnJvbSgweDgwKS5zZXRUaWxlcyhbLCAsIDB4MzcsIDB4MzVdKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg1ZCkuY29weUZyb20oMHg4MCkuc2V0VGlsZXMoWywgMHgzNywgLCAweDM0XSk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NWUpLmNvcHlGcm9tKDB4ODApLnNldFRpbGVzKFsweDM1LCAsIDB4MzIsIF0pO1xuXG4gICQucmVnaXN0ZXJGaXgoU2NyZWVuRml4LkRlc2VydFRyZWVzKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg2MykuY29weUZyb20oMHg3MSk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NjgpLmNvcHlGcm9tKDB4NzApO1xuICBkZXNlcnQuZ2V0VGlsZSgweDY5KS5jb3B5RnJvbSgweDYwKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg2YSkuY29weUZyb20oMHg2NSk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NmMpLmNvcHlGcm9tKDB4NzApO1xuICBkZXNlcnQuZ2V0VGlsZSgweDZlKS5jb3B5RnJvbSgweDc2KTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg2ZikuY29weUZyb20oMHg3OCk7XG5cbiAgLy8gTG9uZyBncmFzcyBzY3JlZW5zIGRvbid0IHdvcmsgb24gZ3Jhc3MgdGlsZXNldHMgYmVjYXVzZSBvZiBhIGZld1xuICAvLyBkaWZmZXJlbnQgdGlsZXMgLSBjb3B5IHRoZW0gd2hlcmUgdGhleSBuZWVkIHRvIGdvLlxuICAkLnJlZ2lzdGVyRml4KFNjcmVlbkZpeC5HcmFzc0xvbmdHcmFzcyk7XG4gIGdyYXNzLmdldFRpbGUoMHg0MCkuY29weUZyb20oMHg1MSk7XG4gIGdyYXNzLmdldFRpbGUoMHg0MSkuY29weUZyb20oMHg1Mik7XG4gIGdyYXNzLmdldFRpbGUoMHg0MikuY29weUZyb20oMHg1Myk7XG4gIGdyYXNzLmdldFRpbGUoMHg0MykuY29weUZyb20oMHg1NCk7XG4gIGdyYXNzLmdldFRpbGUoMHg0NCkuY29weUZyb20oMHg1NSk7XG4gIGdyYXNzLmdldFRpbGUoMHg0NSkuY29weUZyb20oMHg1Nik7XG4gIGdyYXNzLmdldFRpbGUoMHg0NikuY29weUZyb20oMHg1OCk7XG4gIGdyYXNzLmdldFRpbGUoMHg0NykuY29weUZyb20oMHg1OSk7XG5cbiAgLy8gQW5ncnkgc2VhIHRpbGVzZXQgZG9lc24ndCBzdXBwb3J0IHRpbGUgMGEgKHVzZWQgZWxzZXdoZXJlIGZvciB0aGVcbiAgLy8gYm90dG9tIHRpbGUgaW4gY2F2ZSBlbnRyYW5jZXMpIGJlY2F1c2UgaXQncyBhbHJlYWR5IGluIHVzZSAoYnV0XG4gIC8vIG5vdCBhcyBhbiBhbHRlcm5hdGl2ZSkuICBNb3ZlIGl0IHRvIGFkIGFuZCBnZXQgMGEgYmFjay4gIEFsc28gYWRqdXN0XG4gIC8vIHRoZSB0aWxlcyBhcm91bmQgdGhlIGNhdmUgZW50cmFuY2VzIHRvIG5vdCBoYXZlIGRhbWFnZSB0aWxlcyBpbiB0aGVcbiAgLy8gZGVzZXJ0IHRpbGVzZXQuICBUaGlzIGNoYW5nZXMgdGhlIGdyYXBoaWNzIGEgYml0IChmcm9tIGRhcmsgYmx1ZVxuICAvLyB3YXRlciB0byBsaWdodCBibHVlKSwgd2hpY2ggZG9lc24ndCBsb29rIHF1aXRlIGFzIG5pY2UuICBUaGUgb3RoZXJcbiAgLy8gYWx0ZXJuYXRpdmUgaXMgdG8gYWxsb2NhdGUgMyBuZXcgdGlsZXMsIGNvcGllZCBmcm9tIDB4ODAgaW4gc2VhIGJ1dFxuICAvLyBmcm9tIDB4ZjcsIDB4ZjgsIGFuZCAweGZkIGluIGRlc2VydC9yaXZlci9ncmFzcy4gIFRoZW4gc2VhIGNhbiBrZWVwXG4gIC8vIGl0cyBkZWVwIHdhdGVyIGJ1dCBkZXNlcnQgYXZvaWRzIHRoZSBkYW1hZ2UuXG4gICQucmVnaXN0ZXJGaXgoU2NyZWVuRml4LlNlYUNhdmVFbnRyYW5jZSk7XG4gIHNlYS5nZXRUaWxlKDB4YWQpLmNvcHlGcm9tKDB4MGEpXG4gICAgICAucmVwbGFjZUluKCQuYmVhY2hFeGl0TiwgJC5saWdodGhvdXNlRW50cmFuY2UsICQub2NlYW5TaHJpbmUpO1xuICBzZWEuZ2V0VGlsZSgweDBhKS5jb3B5RnJvbSgweGEyKTsgLy8gZG9uJ3QgYm90aGVyIHNldHRpbmcgYW4gYWx0ZXJuYXRpdmUuXG4gIC8vc2VhLmdldFRpbGUoMHgwYSkuc2V0VGlsZXMoWzB4OTEsIDB4OTEsIDB4N2QsIDB4N2RdKS5zZXRBdHRycygyKTtcbiAgJC5ib3VuZGFyeU5fY2F2ZS5zY3JlZW4uc2V0MmQoMHgzOCwgW1tudWxsLCAweDAwLCAweDAwLCBudWxsXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtudWxsLCAweDBhLCAweDBhLCBudWxsXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtudWxsLCAweGY3LCAweGY3LCBudWxsXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsweGY4LCAweGY4LCAweGY4LCAweGY4XV0pO1xuICAkLmNvcm5lclNFX2NhdmUuc2NyZWVuLnNldDJkKDB4NDksIFtbbnVsbCwgMHgwMCwgMHgwMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtudWxsLCAweDBhLCAweDBhXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW251bGwsIDB4ZjcsIDB4ZjddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMHhmOCwgMHhmNywgMHhmN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtudWxsLCAweGZkLCAweGY3XV0pO1xuICAkLmNvcm5lclNFX2NhdmUuc2NyZWVuLnNldDJkKDB4NGEsIFtbMHgwMCwgMHgwMF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsweDBhLCAweDBhXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzB4ZjcsIDB4ZjddLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMHhmOCwgMHhmN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsweDgwLCAweGZkXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzB4ODAsIDB4ZmZdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMHhmYSwgbnVsbF1dKTtcblxuICAgICAvLyAsIFsweGY4LCAweGY4XSwgW251bGwsIDB4ZmRdXSk7XG4gIC8vIHNlYS5zY3JlZW5zLmFkZCgkLmJvdW5kYXJ5V19jYXZlKTtcbiAgLy8gc2VhLnNjcmVlbnMuYWRkKCQuZGVzZXJ0Q2F2ZUVudHJhbmNlKTtcblxuICAvLyBUbyBhbGxvdyBjYXZlcyB0byBiZSBjbG9zZWQsIHdlIGNsZWFyIG91dCBtZXRhdGlsZXMgMDEuLjA0LCB0byBiZSB1c2VkIGFzXG4gIC8vIHRoZSBmb3VyIGNvcm5lcnMgb2YgdGhlIGNhdmU6IFtbMDEsIDAyXSwgWzAzLCAwNF1dLiAgVGhlc2UgYXJlIGNvcGllZCBmcm9tXG4gIC8vIGMxLGMxLGQ3LGQ3LiAgW1RPRE8gLSBzZWVtcyBsaWtlIHdlIGNvdWxkIGp1c3QgdXNlIDIgaW5zdGVhZCBvZiA0IGhlcmVdLlxuICAvLyBTb21lIHRpbGVzZXRzIGFscmVhZHkgaGF2ZSBtZXRhdGlsZXMgaW4gMDEuLjA0IHNvIHdlIG5lZWQgdG8gbW92ZSB0aGVtIHRvXG4gIC8vIHVub2NjdXBpZWQgc3BvdHMgb24gYSBwZXItdGlsZXNldCBiYXNpcyAobm90ZSB0aGF0IHNlYSAoOTQpIGFuZCBkZXNlcnQgKDljKVxuICAvLyBhcmUgZW50YW5nbGVkIGhlcmUpLiAgW1RPRE8gLSBjbGVhbiB1cCAyYyBhbmQgMmQgYXMgd2VsbF1cbiAgJC5yZWdpc3RlckZpeChTY3JlZW5GaXguQ2xvc2VDYXZlcyk7XG4gIHJpdmVyLmdldFRpbGUoMHgwNykuY29weUZyb20oMHgwMSkucmVwbGFjZUluKC4uLnJpdmVyKTtcbiAgcml2ZXIuZ2V0VGlsZSgweDBlKS5jb3B5RnJvbSgweDAyKS5yZXBsYWNlSW4oLi4ucml2ZXIpO1xuICByaXZlci5nZXRUaWxlKDB4MjApLmNvcHlGcm9tKDB4MDMpLnJlcGxhY2VJbiguLi5yaXZlcik7XG4gIHJpdmVyLmdldFRpbGUoMHgyMSkuY29weUZyb20oMHgwNCkucmVwbGFjZUluKC4uLnJpdmVyKTtcbiAgZm9yIChjb25zdCB0cyBvZiBbZGVzZXJ0LCBzZWEsIG1vdW50YWluLCBtb3VudGFpblJpdmVyLCBsaW1lXSkge1xuICAgIHRzLmdldFRpbGUoMHg2OCkuY29weUZyb20oMHgwMSkucmVwbGFjZUluKC4uLnRzKTtcbiAgICB0cy5nZXRUaWxlKDB4ODMpLmNvcHlGcm9tKDB4MDIpLnJlcGxhY2VJbiguLi50cyk7XG4gICAgdHMuZ2V0VGlsZSgweDg4KS5jb3B5RnJvbSgweDAzKS5yZXBsYWNlSW4oLi4udHMpO1xuICAgIHRzLmdldFRpbGUoMHg4OSkuY29weUZyb20oMHgwNCkucmVwbGFjZUluKC4uLnRzKTtcbiAgfVxuICBmb3IgKGNvbnN0IHRzIG9mIFtyaXZlciwgZGVzZXJ0LCBzZWFdKSB7XG4gICAgdHMuZ2V0VGlsZSgweDAxKS5jb3B5RnJvbSgweGMxKS5zZXRBbHRlcm5hdGl2ZSgweDAwKTtcbiAgICB0cy5nZXRUaWxlKDB4MDIpLmNvcHlGcm9tKDB4YzEpLnNldEFsdGVybmF0aXZlKDB4MDApO1xuICAgIHRzLmdldFRpbGUoMHgwMykuY29weUZyb20oMHhkNykuc2V0QWx0ZXJuYXRpdmUoMHgwYSk7XG4gICAgdHMuZ2V0VGlsZSgweDA0KS5jb3B5RnJvbSgweGQ3KS5zZXRBbHRlcm5hdGl2ZSgweDBhKTtcbiAgfVxuICBjb25zdCBjbG9zZWRDYXZlczogQXJyYXk8W01ldGFzY3JlZW4sIG51bWJlcl0+ID0gW1xuICAgIFskLmJvdW5kYXJ5RV9jYXZlLCAweDQ4XSwgWyQuYm91bmRhcnlXX2NhdmUsIDB4NzldLFxuICAgIFskLmV4aXRXX2NhdmUsIDB4MzhdLCBbJC5jYXZlQWJvdmVQb3J0b2EsIDB4NTZdLFxuICBdO1xuICAvLyBpZiAoJC5pc0ZpeGVkKFNjcmVlbkZpeC5TZWFDYXZlRW50cmFuY2VzKSkge1xuICAvLyAgIC8vIFRPRE8gLSBhZGQgJC5ib3VuZGFyeU5fY2F2ZSBhbmQgY29ybmVyU0VfY2F2ZSB0byB0aGUgbGlzdC4uLj9cbiAgLy8gfVxuICBmb3IgKGNvbnN0IFtzY3IsIHBvc10gb2YgY2xvc2VkQ2F2ZXMpIHtcbiAgICBzY3Iuc2NyZWVuLnNldDJkKHBvcywgW1sxLCAyXSwgWzMsIDRdXSk7XG4gICAgc2NyLmFkZEN1c3RvbUZsYWcodHJ1ZSk7XG4gIH1cbiAge1xuICAgIGNvbnN0IHtsb2NhdGlvbnM6IHtDb3JkZWxQbGFpbkVhc3QsIENvcmRlbFBsYWluV2VzdCwgV2F0ZXJmYWxsVmFsbGV5Tm9ydGh9LFxuICAgICAgICAgICBmbGFnczoge09wZW5lZFNlYWxlZENhdmUsIE9wZW5lZFByaXNvbn19ID0gcm9tO1xuICAgIENvcmRlbFBsYWluRWFzdC5tZXRhLmN1c3RvbUZsYWdzLnNldCgweDMwLCBPcGVuZWRTZWFsZWRDYXZlKTtcbiAgICBDb3JkZWxQbGFpbldlc3QubWV0YS5jdXN0b21GbGFncy5zZXQoMHgzMCwgT3BlbmVkU2VhbGVkQ2F2ZSk7XG4gICAgV2F0ZXJmYWxsVmFsbGV5Tm9ydGgubWV0YS5jdXN0b21GbGFncy5zZXQoMHgwMCwgT3BlbmVkUHJpc29uKTtcbiAgICBjb25zdCBleHBsb3Npb24gPSBTcGF3bi5vZih7eTogMHgwNjAsIHg6IDB4MDYwLCB0eXBlOiA0LCBpZDogMHgyY30pO1xuICAgIGNvbnN0IGtleVRyaWdnZXIgPSBTcGF3bi5vZih7eTogMHgwNzAsIHg6IDB4MDcwLCB0eXBlOiAyLCBpZDogMHhhZH0pO1xuICAgIFdhdGVyZmFsbFZhbGxleU5vcnRoLnNwYXducy5zcGxpY2UoMSwgMCwgZXhwbG9zaW9uKTtcbiAgICBXYXRlcmZhbGxWYWxsZXlOb3J0aC5zcGF3bnMucHVzaChrZXlUcmlnZ2VyKTtcbiAgfVxuXG4gIC8vIHNlYS5nZXRUaWxlKDB4MGEpLmNvcHlGcm9tKDB4YTIpLnNldFRpbGVzKFssLDB4OTEsMHg5MV0pLnNldEF0dHJzKDApO1xuICAvLyBUaGlzIGRvZXMgb3BlbiB1cCBzY3JlZW4gJGNlIChkZXNlcnQgY2F2ZSBlbnRyYW5jZSkgZm9yIHVzZSBpbiB0aGUgc2VhLFxuICAvLyB3aGljaCBpcyBpbnRlcmVzdGluZyBiZWNhdXNlIHdoaXJscG9vbHMgY2FuJ3QgYmUgZmxvd24gcGFzdCAtIHdlJ2QgbmVlZFxuICAvLyB0byBhZGQgZmxhZ3MgdG8gY2xlYXIgdGhlIHdoaXJscG9vbHMsIGJ1dCBpdCB3b3VsZCBiZSBhIGNhdmUgdGhhdCdzXG4gIC8vIGJsb2NrZWQgb24gY2FsbWluZyB0aGUgc2VhLi4uXG5cbiAgLy8gV2UgY291bGQgYWRkIGEgbnVtYmVyIG9mIHNjcmVlbnMgdG8gdGhlIHNlYSBpZiB3ZSBjb3VsZCBtb3ZlIDVhLi41ZVxuICAvLyAod2hpY2ggY29sbGlkZXMgd2l0aCBtb3VudGFpbiBnYXRlcykuICA4OSw4YSw5MCw5OSw5ZCxkMSxkMiBhcmUgZnJlZVxuICAvLyBpbiA4MCAoZ3Jhc3MpLCA5MCAocml2ZXIpLCBhbmQgOWMgKGRlc2VydCkuICBUaGUgbWFpbiBwcm9ibGVtIGlzIHRoYXRcbiAgLy8gYXQgbGVhc3QgdGhlIGNhdmUgZW50cmFuY2VzIGRvbid0IHF1aXRlIHdvcmsgZm9yIHRoZXNlIC0gdGhleSBlbmQgdXBcbiAgLy8gaW4gc2hhbGxvdyB3YXRlciwgYXJlIGEgbGl0dGxlIHRvbyBzaG9ydCwgYW5kIGl0IHNlZW1zIHRvIGJlIGltcG9zc2libGVcbiAgLy8gdG8gcGljayBhIHBhbGV0dGUgdGhhdCBpcyBsaWdodCBibHVlIG9uIGJvdHRvbSBhbmQgYmxhY2sgb24gdG9wLlxuICAvL1xuICAvLyBPdGhlciBvcHRpb25zIGZvciB0aGUgc2VhIGFyZSAzNCwzOCwzYy4uM2Ygd2hpY2ggYXJlIG1hcnNoIHRpbGVzIGluXG4gIC8vIHJpdmVyIC0gd291bGQgb3BlbiB1cCBzb21lIG5hcnJvdyBwYXNzYWdlcyAoMzMsIFxuXG5cbiAgLy8gIHJvbS5tZXRhc2NyZWVucztcblxuICAvLyBmb3IgKGNvbnN0IHggb2YgT2JqZWN0LnZhbHVlcyhUSUxFU0VUX0ZJWEVTKSkge1xuICAvLyAgIGNvbnN0IGlkID0geC5pZDtcbiAgLy8gICBjb25zdCB0cyA9IHJvbS50aWxlc2V0c1tpZF07XG4gIC8vICAgY29uc3QgdGUgPSB0cy5lZmZlY3RzKCk7XG4gIC8vICAgZm9yIChjb25zdCB0c3RyIGluIHgpIHtcbiAgLy8gICAgIGNvbnN0IHQgPSBOdW1iZXIodHN0cik7XG4gIC8vICAgICBpZiAoaXNOYU4odCkpIGNvbnRpbnVlO1xuICAvLyAgICAgY29uc3QgeTogbnVtYmVyfHtiYXNlOiBudW1iZXJ9ID0gKHggYXMgYW55KVt0XTtcbiAgLy8gICAgIGNvbnN0IGJhc2UgPSB0eXBlb2YgeSA9PT0gJ251bWJlcicgPyB5IDogKHkgYXMgYW55KS5iYXNlO1xuICAvLyAgICAgY29uc3QgcmVzdDogYW55ID0gdHlwZW9mIHkgPT09ICdudW1iZXInID8ge30gOiB5O1xuICAvLyAgICAgdHMuYXR0cnNbdF0gPSB0cy5hdHRyc1tiYXNlXTtcbiAgLy8gICAgIHRlLmVmZmVjdHNbdF0gPSB0ZS5lZmZlY3RzW2Jhc2VdO1xuICAvLyAgICAgW3Jlc3QudGwsIHJlc3QudHIsIHJlc3QuYmwsIHJlc3QuYnJdLmZvckVhY2goKG0sIGkpID0+IHtcbiAgLy8gICAgICAgdHMudGlsZXNbaV1bdF0gPSB0cy50aWxlc1tpXVttICE9IG51bGwgPyBtIDogYmFzZV07XG4gIC8vICAgICB9KTtcbiAgLy8gICAgIGlmIChyZXN0Lm1vdmUpIHt9XG4gIC8vICAgICAvLyBpZiAocmVzdC50aWxlcykge1xuICAvLyAgICAgLy8gICByZXN0LnRpbGVzLmZvckVhY2goKHM6IG51bWJlciwgaTogbnVtYmVyKSA9PiB2b2lkICh0cy50aWxlc1tpXVt0XSA9IHMpKTtcbiAgLy8gICAgIC8vIH1cbiAgLy8gICB9XG4gIC8vIH1cbn1cblxuXG4vLyBjb25zdCBUSUxFU0VUX0ZJWEVTID0ge1xuLy8gICBncmFzczoge1xuLy8gICAgIGlkOiAweDgwLFxuLy8gICAgIDB4NDA6IDB4NTEsXG4vLyAgICAgMHg0MTogMHg1Mixcbi8vICAgICAweDQyOiAweDUzLFxuLy8gICAgIDB4NDM6IDB4NTQsXG4vLyAgICAgMHg0NDogMHg1NSxcbi8vICAgICAweDQ1OiAweDU2LFxuLy8gICAgIDB4NDY6IDB4NTgsXG4vLyAgICAgMHg0NzogMHg1OSxcbi8vICAgfSxcbi8vICAgZGVzZXJ0OiB7XG4vLyAgICAgaWQ6IDB4OWMsXG4vLyAgICAgMHg1YToge2Jhc2U6IDB4OTgsIGJsOiAweDk0LCBicjogMHg5NH0sXG4vLyAgICAgMHg1Yjoge2Jhc2U6IDB4ODAsIHRsOiAweGZkLCB0cjogMHhmY30sXG4vLyAgICAgMHg1Yzoge2Jhc2U6IDB4ODAsIGJsOiAweGZmLCBicjogMHhmZX0sXG4vLyAgICAgMHg1ZDoge2Jhc2U6IDB4ODAsIHRyOiAweGZmLCBicjogMHhmZH0sXG4vLyAgICAgMHg1ZToge2Jhc2U6IDB4ODAsIHRsOiAweGZlLCBibDogMHhmY30sXG4vLyAgICAgMHg2MzogMHg3MSxcbi8vICAgICAweDY4OiAweDcwLFxuLy8gICAgIDB4Njk6IDB4NjAsXG4vLyAgICAgMHg2YTogMHg2NSxcbi8vICAgICAweDZjOiAweDcwLFxuLy8gICAgIDB4NmU6IDB4NzYsXG4vLyAgICAgMHg2ZjogMHg3OCxcbi8vICAgfSxcbi8vIH0gYXMgY29uc3Q7XG5cbi8vIGNvbnN0IFNDUkVFTl9SRU1BUFMgPSBbXG4vLyAgIHt0aWxlc2V0czogWzB4OWNdLCBzcmM6IDB4NWIsIGRlc3Q6IDB4NWYsIHNjcmVlbnM6IFsweGNmXX0sXG4vLyBdO1xuLy8gY29uc3QgW10gPSBTQ1JFRU5fUkVNQVBTO1xuXG4vLyBUT0RPIC0gY29weSA1ZiA8LSA1YiBpbiA5YywgdGhlbiByZW1hcCBpbiBzY3JlZW4gY2Zcbi8vICAgICAgLSBiZXR0ZXIgbm90YXRpb24/XG4vLyBDb25zaWRlciBkb2luZyB0aGlzIHByb2dyYW1tYXRpY2FsbHksIHRob3VnaCB3ZSdkIHdhbnQgdG8gdXNlXG4vLyB0aGUgX2FjdHVhbF8gc2NyZWVuLXRpbGVzZXQgdXNhZ2VzIHJhdGhlciB0aGFuIGRlY2xhcmVkIG9wdGlvbnNcblxuLy8gY2xhc3MgWCB7XG4vLyAgIHJlYWRvbmx5IG06IE1ldGFzY3JlZW5zO1xuLy8gICBjb25zdHJ1Y3RvcihyOiBSb20pIHtcbi8vICAgICB0aGlzLm0gPSBuZXcgTWV0YXNjcmVlbnMocik7XG4vLyAgIH1cbi8vIH1cblxuLy8gQXBwbGllcyB0aGUgV2lkZUFyZW5hRXhpdHMgc2NyZWVuIGZpeC5cbmV4cG9ydCBmdW5jdGlvbiB3aWRlQXJlbmFFeGl0cyhyb206IFJvbSkge1xuICBmdW5jdGlvbiB3aWRlbihleGl0czogbnVtYmVyW10pIHtcbiAgICBleGl0cy5zcGxpY2UoMCwgZXhpdHMubGVuZ3RoLFxuICAgICAgICAgICAgICAgICAuLi5uZXcgU2V0KGl0ZXJzLmNvbmNhdChcbiAgICAgICAgICAgICAgICAgICAgIC4uLmV4aXRzLm1hcChlID0+IFtlLCBlICsgMSwgZSAtIDFdKSkpKTtcbiAgfVxuXG4gIC8vIFdpZGVuIHRoZSB0b3AgZXhpdHMgb2YgdGhlIHNpbXBsZSBhcmVuYXNcbiAgY29uc3Qge1xuICAgIGZvcnRyZXNzQXJlbmFfdGhyb3VnaCwgZm9ydHJlc3NUcmFwLFxuICAgIGhhbGxOUywgaGFsbE5TX2FyZW5hLCBoYWxsTlNfYXJlbmFXYWxsLCBoYWxsTlNfZW50cmFuY2UsXG4gIH0gPSByb20ubWV0YXNjcmVlbnM7XG4gIGhhbGxOU19hcmVuYS5zY3JlZW4uc2V0MmQoMHgwNCwgW1xuICAgIFsweDk3LCAweDc2LCAweDIyLCAweDIzLCAweDIzLCAweDIzLCAweDRiLCAweDk1XSxcbiAgICBbMHg0MiwgMHg0OCwgMHgyMiwgMHgyMSwgMHgyMywgMHgyMywgMHg0NSwgMHg0Ml0sXG4gICAgWzB4NDMsIDB4NDksIDB4MmUsIDB4MjMsIDB4MjMsIDB4MjEsIDB4NDYsIDB4NDNdLFxuICAgIFsweDQ0LCAweDRhLCAweDJlLCAweDIzLCAweDIxLCAweDIxLCAweDQ3LCAweDQ0XSxcbiAgXSk7XG4gIGhhbGxOU19hcmVuYS5zZXRHcmlkVGlsZSgnIGMgfCBhIHwgYyAnKTsgLy8sICcgYyB8IGEgfCB3ICcpO1xuICB3aWRlbihoYWxsTlNfYXJlbmEuZmluZEV4aXRCeVR5cGUoJ2VkZ2U6dG9wJykuZXhpdHMgYXMgbnVtYmVyW10pO1xuXG4gIGhhbGxOU19hcmVuYVdhbGwuc2NyZWVuLnNldDJkKDB4MDQsIFtcbiAgICBbMHg5NCwgMHg0YywgMHgyMiwgMHgyMSwgMHgyMSwgMHgyMSwgMHg0YiwgMHg5M10sXG4gICAgWzB4OTcsIDB4NGYsIDB4MDAsIDB4MDEsIDB4MDEsIDB4MDIsIDB4NTAsIDB4OTVdLFxuICBdKTtcbiAgaGFsbE5TX2FyZW5hV2FsbC5zZXRHcmlkVGlsZSgnIGMgfCBhIHwgYyAnKTtcbiAgd2lkZW4oaGFsbE5TX2FyZW5hV2FsbC5maW5kRXhpdEJ5VHlwZSgnZWRnZTp0b3AnKS5leGl0cyBhcyBudW1iZXJbXSk7XG5cbiAgLy8gTW92ZSB0aGUgYWJkdWN0aW9uIHRyaWdnZXIgZG93biAzIHRpbGVzIHNvIHlvdSBjYW4ndCB3YWxrIGFyb3VuZCBpdFxuICBjb25zdCBhYmR1Y3Rpb25UcmlnZ2VyID1cbiAgICAgIHJvbS5sb2NhdGlvbnMuWmVidUNhdmUuc3Bhd25zLmZpbmQocyA9PiBzLmlzVHJpZ2dlcigpICYmIHMuaWQgPT09IDB4OGMpO1xuICBpZiAoYWJkdWN0aW9uVHJpZ2dlcikgYWJkdWN0aW9uVHJpZ2dlci55dCArPSA0O1xuXG4gIC8vIFdpZGVuIHRoZSB0b3AgZXhpdHMgb2YgdGhlIGZvcnRyZXNzL3B5cmFtaWQgYXJlbmFzXG4gIGZvcnRyZXNzQXJlbmFfdGhyb3VnaC5zY3JlZW4uc2V0MmQoMHgwNSwgW1xuICAgIFsweDVmLCAweDIyLCAweDIxLCAweDIxLCAweDIxLCAweDVmXSxcbiAgICBbMHhiNywgMHgyMiwgMHgyMSwgMHgyMSwgMHgyMSwgMHhiNV0sXG4gICAgWzB4YmYsIDB4MjIsIDB4MjEsIDB4MjEsIDB4MjEsIDB4YThdLFxuICBdKTtcbiAgZm9ydHJlc3NBcmVuYV90aHJvdWdoLnNldEdyaWRUaWxlKCcgYyB8IGEgfCB3ICcpO1xuICB3aWRlbihmb3J0cmVzc0FyZW5hX3Rocm91Z2guZmluZEV4aXRCeVR5cGUoJ2VkZ2U6dG9wJykuZXhpdHMgYXMgbnVtYmVyW10pO1xuXG4gIC8vIFdpZGVuIHRoZSBib3R0b20gZW50cmFuY2Ugb2Ygc2FiZXJhJ3MgdHJhcFxuICBmb3J0cmVzc1RyYXAuc2NyZWVuLnNldDJkKDB4YzQsIFtcbiAgICBbMHgzYywgMHgzZCwgMHgyMSwgMHgyMSwgMHgyMSwgMHgyMSwgMHgzYiwgMHgzY10sXG4gICAgWzB4OTIsIDB4NGMsIDB4MjIsIDB4MjEsIDB4MjEsIDB4MjEsIDB4NGIsIDB4OTBdLFxuICAgIFsweDk0LCAweDRjLCAweDIyLCAweDIxLCAweDIxLCAweDIxLCAweDRiLCAweDkzXSxcbiAgXSk7XG4gIGZvcnRyZXNzVHJhcC5zZXRHcmlkVGlsZSgnICAgfCB4IHwgYyAnKTtcbiAgd2lkZW4oZm9ydHJlc3NUcmFwLmZpbmRFeGl0QnlUeXBlKCdlZGdlOmJvdHRvbScpLmV4aXRzIGFzIG51bWJlcltdKTtcblxuICAvLyBGaW5kIGNhc2VzIHdoZXJlIGEgbmFycm93IGhhbGx3YXkgd2FzIHVzZWQgb24gdG9wXG4gIC8vIG9mIGFuIGFyZW5hIGFuZCByZXBsYWNlIHdpdGggYSBub3JtYWwgaGFsbHdheVxuICBmb3IgKGNvbnN0IGxvY2F0aW9uIG9mIHJvbS5sb2NhdGlvbnMpIHtcbiAgICBjb25zdCBtZXRhID0gbG9jYXRpb24ubWV0YTtcbiAgICBmb3IgKGNvbnN0IHBvcyBvZiBtZXRhLmFsbFBvcygpKSB7XG4gICAgICBjb25zdCBzY3IgPSBtZXRhLmdldChwb3MpO1xuICAgICAgaWYgKHNjciA9PT0gaGFsbE5TX2VudHJhbmNlICYmIG1ldGEuZ2V0KHBvcyArIDE2KT8uaGFzRmVhdHVyZSgnYXJlbmEnKSkge1xuICAgICAgICBtZXRhLnNldChwb3MsIGhhbGxOUyk7XG4gICAgICAgIC8vIGFsc28gc2V0IHRoZSBub24tbWV0YSB2ZXJzaW9uLCBtYWlubHkgZm9yIG1hcCB2aWV3ZXJcbiAgICAgICAgY29uc3Qgcm93ID0gbG9jYXRpb24uc2NyZWVuc1twb3MgPj4+IDRdO1xuICAgICAgICBpZiAocm93KSByb3dbcG9zICYgMHhmXSA9IGhhbGxOUy5zaWQ7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0=