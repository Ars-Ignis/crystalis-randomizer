export function shuffleGoa(rom, random) {
    const $ = rom.locations;
    const floors = [1, 2, 3, 4];
    random.shuffle(floors);
    const entrances = [
        [$.GoaFortress_Exit, 0, 0],
        [$.GoaFortress_Kelbesque, 0, 0],
        [$.GoaFortress_Sabera, 0, 0],
        [$.GoaFortress_Mado1, 0, 0],
        [$.GoaFortress_Karmine1, 0, 0],
    ];
    const exits = [
        [$.GoaFortress_Entrance, 1, 2],
        [$.GoaFortress_Zebu, 1, 4],
        [$.GoaFortress_Tornel, 1, 2],
        [$.GoaFortress_Asina, 1, 2],
        [$.GoaFortress_Kensu, 5, 10],
    ];
    const last = floors[3];
    if (last !== 4) {
        flipKarmineExit(...exits[4]);
        flipNonKarmineExit(...exits[last]);
    }
    function connect(from, exit, to, entrance) {
        const want = from.exits[exit];
        const found = [];
        for (const e of from.exits) {
            if (e.dest === want.dest && e.entrance === want.entrance)
                found.push(e);
        }
        for (const e of found) {
            e.dest = to.id;
            e.entrance = entrance;
        }
    }
    for (let i = 0; i <= 4; i++) {
        const lower = i === 0 ? 0 : floors[i - 1];
        const upper = i === 4 ? 0 : floors[i];
        const [lowerLoc, lowerIn, lowerOut] = exits[lower];
        const [upperLoc, upperIn, upperOut] = entrances[upper];
        connect(upperLoc, upperOut, lowerLoc, lowerIn);
        connect(lowerLoc, lowerOut, upperLoc, upperIn);
    }
    for (const [l] of exits) {
        if (typeof l.data.music === 'number') {
            l.bgm = l.neighborForEntrance(l.data.music).bgm;
        }
        if (typeof l.data.palette === 'number') {
            const n = l.neighborForEntrance(l.data.palette).tilePalettes;
            l.tilePalettes = [n[0], n[1], n[2]];
        }
    }
}
function flipKarmineExit(l, i, o) {
    l.writeScreens2d(0x01, [[0x9a, 0x80]]);
    l.entrances[i].screen = l.exits[o].screen = l.exits[o + 1].screen = 0x01;
    l.entrances[i].coord = 0xd080;
    l.exits[o].tile = 0xc7;
    l.exits[o + 1].tile = 0xc8;
}
function flipNonKarmineExit(l, i, o) {
    if (l.width < 2)
        l.resizeScreens(0, 0, 0, 1, 0x80);
    l.writeScreens2d(0x00, [[0x83, 0x97]]);
    l.entrances[i].screen = l.exits[o].screen = l.exits[o + 1].screen = 0x01;
    l.entrances[i].coord = 0xaf30;
    l.exits[o].tile = 0xb2;
    l.exits[o + 1].tile = 0xb3;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2h1ZmZsZWdvYS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9wYXNzL3NodWZmbGVnb2EudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBU0EsTUFBTSxVQUFVLFVBQVUsQ0FBQyxHQUFRLEVBQUUsTUFBYztJQUNqRCxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDO0lBQ3hCLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUd2QixNQUFNLFNBQVMsR0FBdUQ7UUFDcEUsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDLGtCQUFrQixFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0tBQy9CLENBQUM7SUFDRixNQUFNLEtBQUssR0FBdUQ7UUFDaEUsQ0FBQyxDQUFDLENBQUMsb0JBQW9CLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDLGtCQUFrQixFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMzQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFD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LENBQUM7SUFDdkMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztJQUN6RSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUM7SUFDOUIsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7QUFDN0IsQ0FBQztBQUVELFNBQVMsa0JBQWtCLENBQUMsQ0FBVyxFQUFFLENBQVMsRUFBRSxDQUFTO0lBQzNELElBQUksQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDO1FBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDbkQsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztJQUN6RSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUM7SUFDOUIsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7QUFDN0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIFNodWZmbGUgZmxvb3JzIG9mIEdvYSBmb3J0cmVzcyBhbW9uZ3N0IGVhY2ggb3RoZXIuXG4vLyBPbmUga2V5IGRpZmZpY3VsdHkgaXMgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZG9vcnMuXG4vLyBUaGUgZG9vciBhdCB0aGUgdG9wIG9mIGthcm1pbmUgcG9pbnRzIGRvd24sIHdoZXJlYXMgYWxsIG90aGVycyBhcmUgdXAuXG4vLyBXZSBuZWVkIGEgd2F5IHRvIGNoYW5nZSB0aGUgZGlyZWN0aW9uIG9mIGVhY2guXG5cbmltcG9ydCB7UmFuZG9tfSBmcm9tICcuLi9yYW5kb20uanMnO1xuaW1wb3J0IHtSb219IGZyb20gJy4uL3JvbS5qcyc7XG5pbXBvcnQge0xvY2F0aW9ufSBmcm9tICcuLi9yb20vbG9jYXRpb24uanMnO1xuXG5leHBvcnQgZnVuY3Rpb24gc2h1ZmZsZUdvYShyb206IFJvbSwgcmFuZG9tOiBSYW5kb20pIHtcbiAgY29uc3QgJCA9IHJvbS5sb2NhdGlvbnM7XG4gIGNvbnN0IGZsb29ycyA9IFsxLCAyLCAzLCA0XTtcbiAgcmFuZG9tLnNodWZmbGUoZmxvb3JzKTtcblxuICAvLyAobG9jYXRpb24sIGVudHJhbmNlIElELCBleGl0IGluZGV4KVxuICBjb25zdCBlbnRyYW5jZXM6IFJlYWRvbmx5QXJyYXk8cmVhZG9ubHkgW0xvY2F0aW9uLCBudW1iZXIsIG51bWJlcl0+ID0gW1xuICAgIFskLkdvYUZvcnRyZXNzX0V4aXQsIDAsIDBdLCAvLyAwIG9yIDRcbiAgICBbJC5Hb2FGb3J0cmVzc19LZWxiZXNxdWUsIDAsIDBdLFxuICAgIFskLkdvYUZvcnRyZXNzX1NhYmVyYSwgMCwgMF0sXG4gICAgWyQuR29hRm9ydHJlc3NfTWFkbzEsIDAsIDBdLFxuICAgIFskLkdvYUZvcnRyZXNzX0thcm1pbmUxLCAwLCAwXSxcbiAgXTtcbiAgY29uc3QgZXhpdHM6IFJlYWRvbmx5QXJyYXk8cmVhZG9ubHkgW0xvY2F0aW9uLCBudW1iZXIsIG51bWJlcl0+ID0gW1xuICAgIFskLkdvYUZvcnRyZXNzX0VudHJhbmNlLCAxLCAyXSwgLy8gMCBvciA0XG4gICAgWyQuR29hRm9ydHJlc3NfWmVidSwgMSwgNF0sXG4gICAgWyQuR29hRm9ydHJlc3NfVG9ybmVsLCAxLCAyXSxcbiAgICBbJC5Hb2FGb3J0cmVzc19Bc2luYSwgMSwgMl0sXG4gICAgWyQuR29hRm9ydHJlc3NfS2Vuc3UsIDUsIDEwXSxcbiAgXTtcblxuICAvLyBVcGRhdGUgdGhlIGV4aXQgcG9zaXRpb24gb2YgS2Vuc3UgYW5kIGV4aXRzW2Zsb290c1s0XV0gaWYgbm90IHNhbWVcbiAgY29uc3QgbGFzdCA9IGZsb29yc1szXTtcbiAgaWYgKGxhc3QgIT09IDQpIHtcbiAgICBmbGlwS2FybWluZUV4aXQoLi4uZXhpdHNbNF0pO1xuICAgIGZsaXBOb25LYXJtaW5lRXhpdCguLi5leGl0c1tsYXN0XSk7XG4gIH1cblxuICAvLyBOb3cgZ28gdGhyb3VnaCBlYWNoIGFuZCBkbyB0aGUgbGlua3MuXG4gIC8vIGV4aXRzWzBdIDogZW50cmFuY2VzW2Zsb29yc1swXV1cbiAgLy8gZXhpdHNbZmxvb3JzWzBdXSA6IGVudHJhbmNlc1tmbG9vcnNbMV1dXG4gIC8vIC4uLlxuICAvLyBleGl0c1tmbG9vcnNbM11dIDogZW50cmFuY2VzWzBdXG5cbiAgZnVuY3Rpb24gY29ubmVjdChmcm9tOiBMb2NhdGlvbiwgZXhpdDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgIHRvOiBMb2NhdGlvbiwgZW50cmFuY2U6IG51bWJlcikge1xuICAgIC8vIGZpbmQgYWxsIGV4aXRzIGluICdmcm9tJyB0aGF0IG1hcCB0byB0aGUgc2FtZSBlbnRyYW5jZVxuICAgIGNvbnN0IHdhbnQgPSBmcm9tLmV4aXRzW2V4aXRdO1xuICAgIGNvbnN0IGZvdW5kID0gW107XG4gICAgZm9yIChjb25zdCBlIG9mIGZyb20uZXhpdHMpIHtcbiAgICAgIGlmIChlLmRlc3QgPT09IHdhbnQuZGVzdCAmJiBlLmVudHJhbmNlID09PSB3YW50LmVudHJhbmNlKSBmb3VuZC5wdXNoKGUpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGUgb2YgZm91bmQpIHtcbiAgICAgIGUuZGVzdCA9IHRvLmlkO1xuICAgICAgZS5lbnRyYW5jZSA9IGVudHJhbmNlO1xuICAgIH1cbiAgfVxuXG4gIGZvciAobGV0IGkgPSAwOyBpIDw9IDQ7IGkrKykge1xuICAgIGNvbnN0IGxvd2VyID0gaSA9PT0gMCA/IDAgOiBmbG9vcnNbaSAtIDFdO1xuICAgIGNvbnN0IHVwcGVyID0gaSA9PT0gNCA/IDAgOiBmbG9vcnNbaV07XG4gICAgY29uc3QgW2xvd2VyTG9jLCBsb3dlckluLCBsb3dlck91dF0gPSBleGl0c1tsb3dlcl07XG4gICAgY29uc3QgW3VwcGVyTG9jLCB1cHBlckluLCB1cHBlck91dF0gPSBlbnRyYW5jZXNbdXBwZXJdO1xuICAgIGNvbm5lY3QodXBwZXJMb2MsIHVwcGVyT3V0LCBsb3dlckxvYywgbG93ZXJJbik7XG4gICAgY29ubmVjdChsb3dlckxvYywgbG93ZXJPdXQsIHVwcGVyTG9jLCB1cHBlckluKTtcbiAgfVxuXG4gIC8vIEZpeCB0aGUgcGFsZXR0ZXMgYW5kIG11c2ljLlxuICBmb3IgKGNvbnN0IFtsXSBvZiBleGl0cykge1xuICAgIGlmICh0eXBlb2YgbC5kYXRhLm11c2ljID09PSAnbnVtYmVyJykge1xuICAgICAgbC5iZ20gPSBsLm5laWdoYm9yRm9yRW50cmFuY2UobC5kYXRhLm11c2ljIGFzIG51bWJlcikuYmdtO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGwuZGF0YS5wYWxldHRlID09PSAnbnVtYmVyJykge1xuICAgICAgY29uc3QgbiA9IGwubmVpZ2hib3JGb3JFbnRyYW5jZShsLmRhdGEucGFsZXR0ZSBhcyBudW1iZXIpLnRpbGVQYWxldHRlcztcbiAgICAgIGwudGlsZVBhbGV0dGVzID0gW25bMF0sIG5bMV0sIG5bMl1dO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBmbGlwS2FybWluZUV4aXQobDogTG9jYXRpb24sIGk6IG51bWJlciwgbzogbnVtYmVyKSB7XG4gIGwud3JpdGVTY3JlZW5zMmQoMHgwMSwgW1sweDlhLCAweDgwXV0pO1xuICBsLmVudHJhbmNlc1tpXS5zY3JlZW4gPSBsLmV4aXRzW29dLnNjcmVlbiA9IGwuZXhpdHNbbyArIDFdLnNjcmVlbiA9IDB4MDE7XG4gIGwuZW50cmFuY2VzW2ldLmNvb3JkID0gMHhkMDgwO1xuICBsLmV4aXRzW29dLnRpbGUgPSAweGM3O1xuICBsLmV4aXRzW28gKyAxXS50aWxlID0gMHhjODtcbn1cblxuZnVuY3Rpb24gZmxpcE5vbkthcm1pbmVFeGl0KGw6IExvY2F0aW9uLCBpOiBudW1iZXIsIG86IG51bWJlcikge1xuICBpZiAobC53aWR0aCA8IDIpIGwucmVzaXplU2NyZWVucygwLCAwLCAwLCAxLCAweDgwKTtcbiAgbC53cml0ZVNjcmVlbnMyZCgweDAwLCBbWzB4ODMsIDB4OTddXSk7XG4gIGwuZW50cmFuY2VzW2ldLnNjcmVlbiA9IGwuZXhpdHNbb10uc2NyZWVuID0gbC5leGl0c1tvICsgMV0uc2NyZWVuID0gMHgwMTtcbiAgbC5lbnRyYW5jZXNbaV0uY29vcmQgPSAweGFmMzA7XG4gIGwuZXhpdHNbb10udGlsZSA9IDB4YjI7XG4gIGwuZXhpdHNbbyArIDFdLnRpbGUgPSAweGIzO1xufVxuIl19