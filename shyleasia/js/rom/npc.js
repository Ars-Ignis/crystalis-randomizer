import { Entity, EntityArray } from './entity.js';
import { MessageId } from './messageid.js';
import { DIALOG_FLAGS, SPAWN_CONDITION_FLAGS, addr, hex, readBigEndian, readLittleEndian, tuple, upperCamelToSpaces, writeLittleEndian } from './util.js';
export class Npcs extends EntityArray {
    constructor(rom) {
        super(0xcd);
        this.rom = rom;
        this.GoaSoldier = new Npc(this, 0x0b);
        this.LeafElder = new Npc(this, 0x0d);
        this.LeafElderDaughter = new Npc(this, 0x11);
        this.LeafRabbit = new Npc(this, 0x13);
        this.WindmillGuard = new Npc(this, 0x14);
        this.SleepingWindmillGuard = new Npc(this, 0x15);
        this.Akahana = new Npc(this, 0x16);
        this.OakElder = new Npc(this, 0x1d);
        this.OakMother = new Npc(this, 0x1e);
        this.OakChild = new Npc(this, 0x1f);
        this.Aryllis = new Npc(this, 0x23);
        this.AmazonesGuard = new Npc(this, 0x25);
        this.AryllisRightAttendant = new Npc(this, 0x26);
        this.AryllisLeftAttendant = new Npc(this, 0x27);
        this.Nadare = new Npc(this, 0x28);
        this.SoldierGuard = new Npc(this, 0x2d);
        this.PortoaThroneRoomBackDoorGuard = new Npc(this, 0x33);
        this.PortoaPalaceFrontGuard = new Npc(this, 0x34);
        this.PortoaQueen = new Npc(this, 0x38);
        this.FortuneTeller = new Npc(this, 0x39);
        this.WaterfallCaveAdventurers = new Npc(this, 0x3a);
        this.JoelElder = new Npc(this, 0x3d);
        this.Clark = new Npc(this, 0x44);
        this.ShyronGuard = new Npc(this, 0x4e);
        this.Brokahana = new Npc(this, 0x54);
        this.SaharaBunny = new Npc(this, 0x59);
        this.Deo = new Npc(this, 0x5a);
        this.SaharaElder = new Npc(this, 0x5b);
        this.SaharaElderDaughter = new Npc(this, 0x5c);
        this.Zebu = new Npc(this, 0x5e);
        this.Tornel = new Npc(this, 0x5f);
        this.Stom = new Npc(this, 0x60);
        this.MesiaRecording = new Npc(this, 0x61);
        this.Asina = new Npc(this, 0x62);
        this.HurtDolphin = new Npc(this, 0x63);
        this.Fisherman = new Npc(this, 0x64);
        this.KensuInCabin = new Npc(this, 0x68);
        this.Dolphin = new Npc(this, 0x69);
        this.SleepingKensu = new Npc(this, 0x6b);
        this.KensuDisguisedAsDancer = new Npc(this, 0x6c);
        this.KensuDisguisedAsSoldier = new Npc(this, 0x6d);
        this.AztecaInShyron = new Npc(this, 0x6e);
        this.DeadAkahana = new Npc(this, 0x70);
        this.DeadStomsGirlfriend = new Npc(this, 0x71);
        this.DeadStom = new Npc(this, 0x72);
        this.KensuInSwan = new Npc(this, 0x74);
        this.SlimedKensu = new Npc(this, 0x75);
        this.FishermanDaughter = new Npc(this, 0x7b);
        this.Kensu = new Npc(this, 0x7e);
        this.AkahanaInBrynmaer = new Npc(this, 0x82);
        this.AztecaInPyramid = new Npc(this, 0x83);
        this.SaberaDisguisedAsMesia = new Npc(this, 0x84);
        this.StonedWaterfallCaveAdventurers = new Npc(this, 0x85);
        this.StonedAkahana = new Npc(this, 0x88);
        this.Mesia = new Npc(this, 0x8e);
        this.Vampire1 = new Npc(this, 0xc0);
        this.Insect = new Npc(this, 0xc1);
        this.Kelbesque1 = new Npc(this, 0xc2);
        this.Rage = new Npc(this, 0xc3);
        this.Kelbesque2 = new Npc(this, 0xc5);
        this.Sabera2 = new Npc(this, 0xc6);
        this.Mado2 = new Npc(this, 0xc7);
        this.Karmine = new Npc(this, 0xc8);
        this.StatueOfMoon = new Npc(this, 0xc9);
        this.StatueOfSun = new Npc(this, 0xca);
        this.Draygon = new Npc(this, 0xcb);
        this.Vampire2 = new Npc(this, 0xcc);
        for (const key in this) {
            const npc = this[key];
            if (!this.hasOwnProperty(key) || !(npc instanceof Npc))
                continue;
            this[npc.id] = npc;
            npc.name = upperCamelToSpaces(key);
        }
        for (let i = 0; i < 0xcd; i++) {
            if (!this[i]) {
                this[i] = new Npc(this, i);
            }
        }
    }
}
export class Npc extends Entity {
    constructor(npcs, id) {
        super(npcs.rom, id);
        this.npcs = npcs;
        this.spawnConditions = new Map();
        this.localDialogs = new Map();
        const rom = npcs.rom;
        if (id > 0xcc)
            throw new Error(`Unavailable: ${id}`);
        this._used = !UNUSED_NPCS.has(id) && (id < 0x8f || id >= 0xc0);
        const dialogBase = addr(rom.prg, this.dialogPointer, 0x14000);
        const hasDialog = id < 0xc4 && dialogBase !== 0x1cb39;
        this.dataBase = 0x80f0 | ((id & 0xfc) << 6) | ((id & 3) << 2);
        this.data = tuple(rom.prg, this.dataBase, 4);
        this.spawnPointer = 0x1c5e0 + (id << 1);
        this.spawnBase = readLittleEndian(rom.prg, this.spawnPointer) + 0x14000;
        let i = this.spawnBase;
        let loc;
        while (this.used && (loc = rom.prg[i++]) !== 0xff) {
            const flags = SPAWN_CONDITION_FLAGS.read(rom.prg, i);
            i += 2 * flags.length;
            this.spawnConditions.set(loc, flags);
        }
        this.globalDialogs = [];
        if (hasDialog) {
            let a = dialogBase;
            while (true) {
                const [dialog, last] = GlobalDialog.parse(rom.prg, a);
                a += 4;
                if (dialog.condition)
                    this.globalDialogs.push(dialog);
                if (last)
                    break;
            }
            const locations = [];
            while (true) {
                const location = rom.prg[a++];
                if (location === 0xff)
                    break;
                locations.push([location, rom.prg[a++]]);
            }
            if (!locations.length)
                locations.push([-1, 0]);
            const base = a;
            for (const [location, offset] of locations) {
                const dialogs = [];
                this.localDialogs.set(location, dialogs);
                a = base + offset;
                while (true) {
                    const [dialog, last] = LocalDialog.parse(rom.prg, a);
                    a += dialog.byteLength();
                    dialogs.push(dialog);
                    if (last)
                        break;
                }
            }
        }
    }
    get dialogPointer() {
        return 0x1c95d + (this.id << 1);
    }
    get used() { return this._used; }
    set used(used) {
        if (used && (this.id > 0x88 && this.id < 0xc0 && this.id !== 0x8e)) {
            throw new Error(`invalid: ${this.id}`);
        }
        this._used = used;
    }
    spawnConditionsBytes() {
        const bytes = [];
        for (const [loc, flags] of this.spawnConditions) {
            bytes.push(loc, ...SPAWN_CONDITION_FLAGS.bytes(flags));
        }
        bytes.push(0xff);
        return bytes;
    }
    dialog(location) {
        const id = location ? location.id : -1;
        const dialogs = this.localDialogs.get(id);
        if (dialogs)
            return dialogs;
        throw new Error(`No local dialog for NPC ${hex(this.id)} at ${hex(id)}`);
    }
    spawns(location) {
        const id = location.id;
        const conditions = this.spawnConditions.get(location.id);
        if (conditions)
            return conditions;
        throw new Error(`No spawn condition for NPC ${hex(this.id)} at ${hex(id)}`);
    }
    hasDialog() {
        const result = Boolean(this.globalDialogs.length || this.localDialogs.size);
        if (this.id > 0x8e && this.id !== 0xc3 && result) {
            throw new Error(`invalid: ${this.id}`);
        }
        return result;
    }
    *allDialogs() {
        yield* this.globalDialogs;
        for (const ds of this.localDialogs.values()) {
            yield* ds;
        }
    }
    dialogBytes() {
        if (!this.hasDialog())
            return [];
        const bytes = [];
        function serialize(ds) {
            const out = [];
            for (let i = 0; i < ds.length; i++) {
                out.push(...ds[i].bytes(i === ds.length - 1));
            }
            return out;
        }
        if (this.globalDialogs.length) {
            bytes.push(...serialize(this.globalDialogs));
        }
        else {
            bytes.push(0x80, 0, 0, 0);
        }
        const locals = [];
        const cache = new Map();
        for (const [location, dialogs] of this.localDialogs) {
            const localBytes = serialize(dialogs);
            const label = localBytes.join(',');
            const cached = cache.get(label);
            if (cached != null) {
                bytes.push(location, cached);
                continue;
            }
            cache.set(label, locals.length);
            if (location !== -1)
                bytes.push(location, locals.length);
            locals.push(...localBytes);
        }
        if (locals.length)
            bytes.push(0xff, ...locals);
        return bytes;
    }
    link(id) {
        const other = this.rom.npcs[id];
        this.spawnConditions = other.spawnConditions;
        this.linkDialog(id);
    }
    linkDialog(id) {
        const other = this.rom.npcs[id];
        this.globalDialogs = other.globalDialogs;
        this.localDialogs = other.localDialogs;
    }
    localDialog(location, index) {
        if (index == null) {
            index = location;
            location = -1;
        }
        const dialogs = this.localDialogs.get(location);
        if (dialogs == null || index >= dialogs.length) {
            throw new Error(`No local dialog ${index} for location ${hex(location)}`);
        }
        return dialogs[index];
    }
    isParalyzable() {
        for (let i = 0x35058; i < 0x3506c; i++) {
            if (this.rom.prg[i] === this.id)
                return false;
        }
        return true;
    }
    async write(writer) {
        if (!this.used)
            return;
        const promises = [];
        writer.rom.subarray(this.dataBase, this.dataBase + 4).set(this.data);
        promises.push(writer.write(this.spawnConditionsBytes(), 0x1c000, 0x1dfff, `SpawnCondition ${hex(this.id)}`).then(address => writeLittleEndian(writer.rom, this.spawnPointer, address - 0x14000)));
        if (this.hasDialog()) {
            promises.push(writer.write(this.dialogBytes(), 0x1c000, 0x1dfff, `Dialog ${hex(this.id)}`).then(address => writeLittleEndian(writer.rom, this.dialogPointer, address - 0x14000)));
        }
        await Promise.all(promises);
    }
}
export class GlobalDialog {
    constructor(condition, message) {
        this.condition = condition;
        this.message = message;
    }
    static of(condition, message) {
        const [part, index, action = 0] = message;
        return new GlobalDialog(condition, MessageId.of({ part, index, action }));
    }
    static parse(data, offset = 0) {
        const flag = readBigEndian(data, offset);
        const message = MessageId.from(data, offset + 2);
        let condition = flag & 0x03ff;
        const last = !!(flag & 0x8000);
        const sign = flag & 0x2000;
        if (sign)
            condition = ~condition;
        return [new GlobalDialog(condition, message), last];
    }
    bytes(last) {
        let flag = this.condition;
        if (flag < 0)
            flag = (~flag) | 0x2000;
        if (last)
            flag |= 0x8000;
        return [flag >>> 8, flag & 0xff, ...this.message.data];
    }
}
export class LocalDialog {
    constructor(condition, message, update, flags) {
        this.condition = condition;
        this.message = message;
        this.update = update;
        this.flags = flags;
    }
    clone() {
        return LocalDialog.parse(this.bytes(false))[0];
    }
    static parse(data, offset = 0) {
        const word = readBigEndian(data, offset);
        const message = MessageId.from(data, offset + 2);
        const update = data[offset + 4];
        offset += 5;
        let condition = word & 0x03ff;
        const last = !!(word & 0x8000);
        const sign = word & 0x2000;
        if (sign)
            condition = ~condition;
        const flags = word & 0x4000 ? DIALOG_FLAGS.read(data, offset) : [];
        return [new LocalDialog(condition, message, update, flags), last];
    }
    static of(condition, message, flags = []) {
        const [part, index, action = 0] = message;
        return new LocalDialog(condition, MessageId.of({ part, index, action }), 0, flags);
    }
    byteLength() {
        return 5 + 2 * this.flags.length;
    }
    bytes(last) {
        let flag = this.condition;
        if (flag < 0)
            flag = (~flag) | 0x2000;
        if (last)
            flag |= 0x8000;
        if (this.flags.length)
            flag |= 0x4000;
        return [flag >>> 8, flag & 0xff, ...this.message.data, this.update,
            ...DIALOG_FLAGS.bytes(this.flags)];
    }
}
const UNUSED_NPCS = new Set([
    0x31, 0x3b, 0x3c, 0x66, 0x67, 0x6a, 0x73, 0x74,
    0x82, 0x86, 0x87, 0x89, 0x8a, 0x8b, 0x8c, 0x8d,
    0xc4,
]);
export class PortoaQueen extends Npc {
    constructor() {
        super(...arguments);
        this.id = 0x38;
        this.name = 'Portoa Queen';
    }
    get expectedSword() { return this.localDialog(3).condition & 0xff; }
    set expectedSword(id) { this.localDialog(3).condition = 0x200 | id; }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnBjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3JvbS9ucGMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLE1BQU0sRUFBRSxXQUFXLEVBQUMsTUFBTSxhQUFhLENBQUM7QUFFaEQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ3pDLE9BQU8sRUFBQyxZQUFZLEVBQVEscUJBQXFCLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFDcEQsYUFBYSxFQUFFLGdCQUFnQixFQUFFLEtBQUssRUFDdEMsa0JBQWtCLEVBQUUsaUJBQWlCLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFNaEUsTUFBTSxPQUFPLElBQUssU0FBUSxXQUFnQjtJQXFHeEMsWUFBcUIsR0FBUTtRQUMzQixLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7UUFETyxRQUFHLEdBQUgsR0FBRyxDQUFLO1FBbkc3QixlQUFVLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRWpDLGNBQVMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFaEMsc0JBQWlCLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRXhDLGVBQVUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDakMsa0JBQWEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDcEMsMEJBQXFCLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzVDLFlBQU8sR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFOUIsYUFBUSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvQixj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QUFhLENBQUMsRUFBVSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEtBQUssR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0NBQzlFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtFbnRpdHksIEVudGl0eUFycmF5fSBmcm9tICcuL2VudGl0eS5qcyc7XG5pbXBvcnQge0xvY2F0aW9ufSBmcm9tICcuL2xvY2F0aW9uLmpzJztcbmltcG9ydCB7TWVzc2FnZUlkfSBmcm9tICcuL21lc3NhZ2VpZC5qcyc7XG5pbXBvcnQge0RJQUxPR19GTEFHUywgRGF0YSwgU1BBV05fQ09ORElUSU9OX0ZMQUdTLCBhZGRyLCBoZXgsXG4gICAgICAgIHJlYWRCaWdFbmRpYW4sIHJlYWRMaXR0bGVFbmRpYW4sIHR1cGxlLFxuICAgICAgICB1cHBlckNhbWVsVG9TcGFjZXMsIHdyaXRlTGl0dGxlRW5kaWFufSBmcm9tICcuL3V0aWwuanMnO1xuaW1wb3J0IHtXcml0ZXJ9IGZyb20gJy4vd3JpdGVyLmpzJztcbmltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuXG50eXBlIEZsYWdMaXN0ID0gbnVtYmVyW107XG5cbmV4cG9ydCBjbGFzcyBOcGNzIGV4dGVuZHMgRW50aXR5QXJyYXk8TnBjPiB7XG4gIC8vIGdlbmVyaWMgMDAuLjBhXG4gIEdvYVNvbGRpZXIgPSBuZXcgTnBjKHRoaXMsIDB4MGIpO1xuICAvLyBnZW5lcmljIDBjXG4gIExlYWZFbGRlciA9IG5ldyBOcGModGhpcywgMHgwZCk7XG4gIC8vIGdlbmVyaWMgbGVhZiAwZS4uMTBcbiAgTGVhZkVsZGVyRGF1Z2h0ZXIgPSBuZXcgTnBjKHRoaXMsIDB4MTEpO1xuICAvLyBnZW5lcmljIGxlYWYgMTJcbiAgTGVhZlJhYmJpdCA9IG5ldyBOcGModGhpcywgMHgxMyk7XG4gIFdpbmRtaWxsR3VhcmQgPSBuZXcgTnBjKHRoaXMsIDB4MTQpO1xuICBTbGVlcGluZ1dpbmRtaWxsR3VhcmQgPSBuZXcgTnBjKHRoaXMsIDB4MTUpO1xuICBBa2FoYW5hID0gbmV3IE5wYyh0aGlzLCAweDE2KTtcbiAgLy8gZ2VuZXJpYyBicnlubWFlciAxNy4uMWNcbiAgT2FrRWxkZXIgPSBuZXcgTnBjKHRoaXMsIDB4MWQpO1xuICBPYWtNb3RoZXIgPSBuZXcgTnBjKHRoaXMsIDB4MWUpO1xuICBPYWtDaGlsZCA9IG5ldyBOcGModGhpcywgMHgxZik7XG4gIC8vIGdlbmVyaWMgb2FrIDIwLi4yMlxuICBBcnlsbGlzID0gbmV3IE5wYyh0aGlzLCAweDIzKTtcbiAgLy8gZ2VuZXJpYyBhbWF6b25lcyAyNFxuICBBbWF6b25lc0d1YXJkID0gbmV3IE5wYyh0aGlzLCAweDI1KTtcbiAgQXJ5bGxpc1JpZ2h0QXR0ZW5kYW50ID0gbmV3IE5wYyh0aGlzLCAweDI2KTtcbiAgQXJ5bGxpc0xlZnRBdHRlbmRhbnQgPSBuZXcgTnBjKHRoaXMsIDB4MjcpO1xuICBOYWRhcmUgPSBuZXcgTnBjKHRoaXMsIDB4MjgpO1xuICAvLyBnZW5lcmljIG5hZGFyZSAyOS4uMmNcbiAgU29sZGllckd1YXJkID0gbmV3IE5wYyh0aGlzLCAweDJkKTsgLy8gc3dhbiwgbXQgc2FicmVcbiAgLy8gc2hvcGtlZXBlciBwcmlzb25lcnMgMmUuLjMwXG4gIC8vIHVudXNlZCAzMVxuICAvLyBnZW5lcmljIHBvcnRvYSBwYWxhY2UgMzJcbiAgUG9ydG9hVGhyb25lUm9vbUJhY2tEb29yR3VhcmQgPSBuZXcgTnBjKHRoaXMsIDB4MzMpO1xuICBQb3J0b2FQYWxhY2VGcm9udEd1YXJkID0gbmV3IE5wYyh0aGlzLCAweDM0KTtcbiAgLy8gZ2VuZXJpYyBwb3J0b2EgcGFsYWNlIDM1Li4zN1xuICBQb3J0b2FRdWVlbiA9IG5ldyBOcGModGhpcywgMHgzOCk7XG4gIEZvcnR1bmVUZWxsZXIgPSBuZXcgTnBjKHRoaXMsIDB4MzkpO1xuICBXYXRlcmZhbGxDYXZlQWR2ZW50dXJlcnMgPSBuZXcgTnBjKHRoaXMsIDB4M2EpO1xuICAvLyB1bnVzZWQgM2IuLjNjXG4gIEpvZWxFbGRlciA9IG5ldyBOcGModGhpcywgMHgzZCk7XG4gIC8vIGdlbmVyaWMgam9lbCAzZS4uNDNcbiAgQ2xhcmsgPSBuZXcgTnBjKHRoaXMsIDB4NDQpO1xuICAvLyBnZW5lcmljIHpvbWJpZSB0b3duIDQ1Li40N1xuICAvLyBnZW5lcmljIHN3YW4gNDkuLjRkXG4gIFNoeXJvbkd1YXJkID0gbmV3IE5wYyh0aGlzLCAweDRlKTtcbiAgLy8gZ2VuZXJpYyBzaHlyb24gNGYuLjUzXG4gIEJyb2thaGFuYSA9IG5ldyBOcGModGhpcywgMHg1NCk7XG4gIC8vIGdlbmVyaWMgZ29hIDU1Li41OFxuICBTYWhhcmFCdW5ueSA9IG5ldyBOcGModGhpcywgMHg1OSk7XG4gIERlbyA9IG5ldyBOcGModGhpcywgMHg1YSk7XG4gIFNhaGFyYUVsZGVyID0gbmV3IE5wYyh0aGlzLCAweDViKTtcbiAgU2FoYXJhRWxkZXJEYXVnaHRlciA9IG5ldyBOcGModGhpcywgMHg1Yyk7XG4gIC8vIGdlbmVyaWMgNWRcbiAgWmVidSA9IG5ldyBOcGModGhpcywgMHg1ZSk7XG4gIFRvcm5lbCA9IG5ldyBOcGModGhpcywgMHg1Zik7XG4gIFN0b20gPSBuZXcgTnBjKHRoaXMsIDB4NjApO1xuICBNZXNpYVJlY29yZGluZyA9IG5ldyBOcGModGhpcywgMHg2MSk7XG4gIEFzaW5hID0gbmV3IE5wYyh0aGlzLCAweDYyKTtcbiAgSHVydERvbHBoaW4gPSBuZXcgTnBjKHRoaXMsIDB4NjMpO1xuICBGaXNoZXJtYW4gPSBuZXcgTnBjKHRoaXMsIDB4NjQpO1xuICAvLyBnZW5lcmljL3Vuc2VkIDY1Li42N1xuICBLZW5zdUluQ2FiaW4gPSBuZXcgTnBjKHRoaXMsIDB4NjgpO1xuICBEb2xwaGluID0gbmV3IE5wYyh0aGlzLCAweDY5KTtcbiAgLy8gdW51c2VkIDZhXG4gIFNsZWVwaW5nS2Vuc3UgPSBuZXcgTnBjKHRoaXMsIDB4NmIpO1xuICBLZW5zdURpc2d1aXNlZEFzRGFuY2VyID0gbmV3IE5wYyh0aGlzLCAweDZjKTtcbiAgS2Vuc3VEaXNndWlzZWRBc1NvbGRpZXIgPSBuZXcgTnBjKHRoaXMsIDB4NmQpO1xuICBBenRlY2FJblNoeXJvbiA9IG5ldyBOcGModGhpcywgMHg2ZSk7XG4gIC8vIGdlbmVyaWMgNmZcbiAgRGVhZEFrYWhhbmEgPSBuZXcgTnBjKHRoaXMsIDB4NzApO1xuICBEZWFkU3RvbXNHaXJsZnJpZW5kID0gbmV3IE5wYyh0aGlzLCAweDcxKTtcbiAgRGVhZFN0b20gPSBuZXcgTnBjKHRoaXMsIDB4NzIpO1xuICAvLyB1bnVzZWQgNzNcbiAgS2Vuc3VJblN3YW4gPSBuZXcgTnBjKHRoaXMsIDB4NzQpOyAvLyBub3RlOiB1bnVzZWQgaW4gdmFuaWxsYSAoN2UpXG4gIFNsaW1lZEtlbnN1ID0gbmV3IE5wYyh0aGlzLCAweDc1KTtcbiAgLy8gZ2VuZXJpYyA3Ni4uN2FcbiAgRmlzaGVybWFuRGF1Z2h0ZXIgPSBuZXcgTnBjKHRoaXMsIDB4N2IpO1xuICAvLyBnZW5lcmljIDdjLi43ZFxuICBLZW5zdSA9IG5ldyBOcGModGhpcywgMHg3ZSk7XG4gIC8vIGdlbmVyaWMvdW51c2VkIDdmLi44MlxuICBBa2FoYW5hSW5CcnlubWFlciA9IG5ldyBOcGModGhpcywgMHg4Mik7IC8vIG5vdGU6IHVudXNlZCBpbiB2YW5pbGxhICgxNilcbiAgQXp0ZWNhSW5QeXJhbWlkID0gbmV3IE5wYyh0aGlzLCAweDgzKTtcbiAgU2FiZXJhRGlzZ3Vpc2VkQXNNZXNpYSA9IG5ldyBOcGModGhpcywgMHg4NCk7XG4gIFN0b25lZFdhdGVyZmFsbENhdmVBZHZlbnR1cmVycyA9IG5ldyBOcGModGhpcywgMHg4NSk7XG4gIC8vIHVudXNlZCA4Ni4uODdcbiAgU3RvbmVkQWthaGFuYSA9IG5ldyBOcGModGhpcywgMHg4OCk7XG4gIC8vIHVudXNlZCA4OS4uOGRcbiAgTWVzaWEgPSBuZXcgTnBjKHRoaXMsIDB4OGUpO1xuXG4gIC8vIHVudXNhYmxlIDhmLi5iZiAod2UndmUgY28tb3B0ZWQgdGhhdCBQUkcgc3BhY2UgZm9yIG5vdylcblxuICBWYW1waXJlMSA9IG5ldyBOcGModGhpcywgMHhjMCk7XG4gIEluc2VjdCA9IG5ldyBOcGModGhpcywgMHhjMSk7XG4gIEtlbGJlc3F1ZTEgPSBuZXcgTnBjKHRoaXMsIDB4YzIpO1xuICBSYWdlID0gbmV3IE5wYyh0aGlzLCAweGMzKTtcbiAgLy8gdW51c2VkIC0gTWFkbzEgPSBuZXcgTnBjKHRoaXMsIDB4YzQpO1xuICBLZWxiZXNxdWUyID0gbmV3IE5wYyh0aGlzLCAweGM1KTtcbiAgU2FiZXJhMiA9IG5ldyBOcGModGhpcywgMHhjNik7XG4gIE1hZG8yID0gbmV3IE5wYyh0aGlzLCAweGM3KTtcbiAgS2FybWluZSA9IG5ldyBOcGModGhpcywgMHhjOCk7XG4gIFN0YXR1ZU9mTW9vbiA9IG5ldyBOcGModGhpcywgMHhjOSk7XG4gIFN0YXR1ZU9mU3VuID0gbmV3IE5wYyh0aGlzLCAweGNhKTtcbiAgRHJheWdvbiA9IG5ldyBOcGModGhpcywgMHhjYik7XG4gIFZhbXBpcmUyID0gbmV3IE5wYyh0aGlzLCAweGNjKTtcblxuICBjb25zdHJ1Y3RvcihyZWFkb25seSByb206IFJvbSkge1xuICAgIHN1cGVyKDB4Y2QpO1xuICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMpIHtcbiAgICAgIGNvbnN0IG5wYyA9IHRoaXNba2V5XTtcbiAgICAgIGlmICghdGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpIHx8ICEobnBjIGluc3RhbmNlb2YgTnBjKSkgY29udGludWU7XG4gICAgICB0aGlzW25wYy5pZF0gPSBucGM7XG4gICAgICBucGMubmFtZSA9IHVwcGVyQ2FtZWxUb1NwYWNlcyhrZXkpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDB4Y2Q7IGkrKykge1xuICAgICAgaWYgKCF0aGlzW2ldKSB7XG4gICAgICAgIHRoaXNbaV0gPSBuZXcgTnBjKHRoaXMsIGkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTnBjIGV4dGVuZHMgRW50aXR5IHtcblxuICBwcml2YXRlIF91c2VkOiBib29sZWFuO1xuICBuYW1lPzogc3RyaW5nO1xuICBpdGVtTmFtZXM/OiBbc3RyaW5nLCBzdHJpbmddO1xuXG4gIGRhdGFCYXNlOiBudW1iZXI7XG4gIGRhdGE6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXJdOyAvLyB1aW50OFxuICBzcGF3blBvaW50ZXI6IG51bWJlcjtcbiAgc3Bhd25CYXNlOiBudW1iZXI7XG4gIC8vIEZsYWdzIHRvIGNoZWNrIHBlciBsb2NhdGlvbjogcG9zaXRpdmUgbWVhbnMgXCJtdXN0IGJlIHNldFwiXG4gIHNwYXduQ29uZGl0aW9ucyA9IG5ldyBNYXA8bnVtYmVyLCBGbGFnTGlzdD4oKTsgLy8ga2V5IHVpbnQ4XG5cbiAgZ2xvYmFsRGlhbG9nczogR2xvYmFsRGlhbG9nW107XG4gIGxvY2FsRGlhbG9ncyA9IG5ldyBNYXA8bnVtYmVyLCBMb2NhbERpYWxvZ1tdPigpO1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IG5wY3M6IE5wY3MsIGlkOiBudW1iZXIpIHtcbiAgICBzdXBlcihucGNzLnJvbSwgaWQpO1xuICAgIGNvbnN0IHJvbSA9IG5wY3Mucm9tO1xuICAgIGlmIChpZCA+IDB4Y2MpIHRocm93IG5ldyBFcnJvcihgVW5hdmFpbGFibGU6ICR7aWR9YCk7XG4gICAgLy8gVE9ETyAtIGNoZWNrICh0aGlzLmJhc2UgPD0gMHgxYzc4MSkgZm9yIHVudXNlZD9cbiAgICB0aGlzLl91c2VkID0gIVVOVVNFRF9OUENTLmhhcyhpZCkgJiYgKGlkIDwgMHg4ZiB8fCBpZCA+PSAweGMwKTtcbiAgICBjb25zdCBkaWFsb2dCYXNlID0gYWRkcihyb20ucHJnLCB0aGlzLmRpYWxvZ1BvaW50ZXIsIDB4MTQwMDApO1xuICAgIGNvbnN0IGhhc0RpYWxvZyA9IGlkIDwgMHhjNCAmJiBkaWFsb2dCYXNlICE9PSAweDFjYjM5O1xuXG4gICAgdGhpcy5kYXRhQmFzZSA9IDB4ODBmMCB8ICgoaWQgJiAweGZjKSA8PCA2KSB8ICgoaWQgJiAzKSA8PCAyKTtcbiAgICB0aGlzLmRhdGEgPSB0dXBsZShyb20ucHJnLCB0aGlzLmRhdGFCYXNlLCA0KTtcblxuICAgIHRoaXMuc3Bhd25Qb2ludGVyID0gMHgxYzVlMCArIChpZCA8PCAxKTtcbiAgICB0aGlzLnNwYXduQmFzZSA9IHJlYWRMaXR0bGVFbmRpYW4ocm9tLnByZywgdGhpcy5zcGF3blBvaW50ZXIpICsgMHgxNDAwMDtcblxuICAgIC8vIFBvcHVsYXRlIHNwYXduIGNvbmRpdGlvbnNcbiAgICBsZXQgaSA9IHRoaXMuc3Bhd25CYXNlO1xuICAgIGxldCBsb2M7XG4gICAgd2hpbGUgKHRoaXMudXNlZCAmJiAobG9jID0gcm9tLnByZ1tpKytdKSAhPT0gMHhmZikge1xuICAgICAgY29uc3QgZmxhZ3MgPSBTUEFXTl9DT05ESVRJT05fRkxBR1MucmVhZChyb20ucHJnLCBpKTtcbiAgICAgIGkgKz0gMiAqIGZsYWdzLmxlbmd0aDtcbiAgICAgIHRoaXMuc3Bhd25Db25kaXRpb25zLnNldChsb2MsIGZsYWdzKTtcbiAgICB9XG5cbiAgICAvLyBQb3B1bGF0ZSB0aGUgZGlhbG9nIHRhYmxlXG4gICAgdGhpcy5nbG9iYWxEaWFsb2dzID0gW107XG4gICAgaWYgKGhhc0RpYWxvZykge1xuICAgICAgbGV0IGEgPSBkaWFsb2dCYXNlO1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgY29uc3QgW2RpYWxvZywgbGFzdF0gPSBHbG9iYWxEaWFsb2cucGFyc2Uocm9tLnByZywgYSk7XG4gICAgICAgIGEgKz0gNDtcbiAgICAgICAgaWYgKGRpYWxvZy5jb25kaXRpb24pIHRoaXMuZ2xvYmFsRGlhbG9ncy5wdXNoKGRpYWxvZyk7XG4gICAgICAgIGlmIChsYXN0KSBicmVhaztcbiAgICAgIH1cbiAgICAgIC8vIFJlYWQgdGhlIGxvY2F0aW9uIHRhYmxlXG4gICAgICBjb25zdCBsb2NhdGlvbnM6IFtudW1iZXIsIG51bWJlcl1bXSA9IFtdO1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgY29uc3QgbG9jYXRpb24gPSByb20ucHJnW2ErK107XG4gICAgICAgIGlmIChsb2NhdGlvbiA9PT0gMHhmZikgYnJlYWs7XG4gICAgICAgIGxvY2F0aW9ucy5wdXNoKFtsb2NhdGlvbiwgcm9tLnByZ1thKytdXSk7XG4gICAgICB9XG4gICAgICBpZiAoIWxvY2F0aW9ucy5sZW5ndGgpIGxvY2F0aW9ucy5wdXNoKFstMSwgMF0pO1xuICAgICAgLy8gTm93IGJ1aWxkIHVwIHRoZSBMb2NhbERpYWxvZyB0YWJsZXNcbiAgICAgIGNvbnN0IGJhc2UgPSBhO1xuICAgICAgZm9yIChjb25zdCBbbG9jYXRpb24sIG9mZnNldF0gb2YgbG9jYXRpb25zKSB7XG4gICAgICAgIGNvbnN0IGRpYWxvZ3M6IExvY2FsRGlhbG9nW10gPSBbXTtcbiAgICAgICAgdGhpcy5sb2NhbERpYWxvZ3Muc2V0KGxvY2F0aW9uLCBkaWFsb2dzKTtcbiAgICAgICAgYSA9IGJhc2UgKyBvZmZzZXQ7XG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgY29uc3QgW2RpYWxvZywgbGFzdF0gPSBMb2NhbERpYWxvZy5wYXJzZShyb20ucHJnLCBhKTtcbiAgICAgICAgICBhICs9IGRpYWxvZy5ieXRlTGVuZ3RoKCk7XG4gICAgICAgICAgZGlhbG9ncy5wdXNoKGRpYWxvZyk7XG4gICAgICAgICAgaWYgKGxhc3QpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZm9yIChjb25zdCBpIGluIE5BTUVTKSB7XG4gICAgLy8gICBpZiAoIU5BTUVTLmhhc093blByb3BlcnR5KGkpKSBjb250aW51ZTtcbiAgICAvLyAgIGNvbnN0IG5hbWUgPSAoTkFNRVMgYXMge30gYXMge1trZXk6IHN0cmluZ106IFtudW1iZXIsIHN0cmluZywgc3RyaW5nPywgc3RyaW5nP119KVtpXTtcbiAgICAvLyAgIGlmIChuYW1lWzBdID09PSBpZCkge1xuICAgIC8vICAgICB0aGlzLm5hbWUgPSBuYW1lWzFdO1xuICAgIC8vICAgICBpZiAobmFtZS5sZW5ndGggPiAyKSB7XG4gICAgLy8gICAgICAgdGhpcy5pdGVtTmFtZXMgPSBuYW1lLnNsaWNlKDIsIDQpIGFzIFtzdHJpbmcsIHN0cmluZ107XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH1cbiAgICAvLyB9XG5cbiAgICAvLyBjb25zb2xlLmxvZyhgTlBDIFNwYXduICQke3RoaXMuaWQudG9TdHJpbmcoMTYpfSBmcm9tICR7dGhpcy5iYXNlLnRvU3RyaW5nKDE2KX06IGJ5dGVzOiAkJHtcbiAgICAvLyAgICAgICAgICAgICAgdGhpcy5ieXRlcygpLm1hcCh4PT54LnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLDApKS5qb2luKCcgJyl9YCk7XG4gIH1cblxuICBnZXQgZGlhbG9nUG9pbnRlcigpOiBudW1iZXIge1xuICAgIHJldHVybiAweDFjOTVkICsgKHRoaXMuaWQgPDwgMSk7XG4gIH1cblxuICBnZXQgdXNlZCgpIHsgcmV0dXJuIHRoaXMuX3VzZWQ7IH1cbiAgc2V0IHVzZWQodXNlZDogYm9vbGVhbikge1xuICAgIC8vIHF1aWNrIGNoZWNrOiB3ZSBjYW4ndCB1c2Ugc29tZSBpbmRleGVzIGJlY2F1c2UgZGF0YSB0YWJsZXMgY28tb3B0ZWQuXG4gICAgLy8gMWNhNmYuLjFjYTc5LCAxY2E3Yi4uMWNhZTMgKGMwLi5jMiBhcmUgdXNlZCBidXQgaGF2ZSBubyBkaWFsb2cuLi4pXG4gICAgLy8gMWM2ZjIuLjFjNmZjLCAxYzZmZS4uMWM3NjBcbiAgICBpZiAodXNlZCAmJiAodGhpcy5pZCA+IDB4ODggJiYgdGhpcy5pZCA8IDB4YzAgJiYgdGhpcy5pZCAhPT0gMHg4ZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZDogJHt0aGlzLmlkfWApO1xuICAgIH1cbiAgICB0aGlzLl91c2VkID0gdXNlZDtcbiAgfVxuXG4gIHNwYXduQ29uZGl0aW9uc0J5dGVzKCk6IG51bWJlcltdIHtcbiAgICBjb25zdCBieXRlcyA9IFtdO1xuICAgIGZvciAoY29uc3QgW2xvYywgZmxhZ3NdIG9mIHRoaXMuc3Bhd25Db25kaXRpb25zKSB7XG4gICAgICBieXRlcy5wdXNoKGxvYywgLi4uU1BBV05fQ09ORElUSU9OX0ZMQUdTLmJ5dGVzKGZsYWdzKSk7XG4gICAgfVxuICAgIGJ5dGVzLnB1c2goMHhmZik7XG4gICAgcmV0dXJuIGJ5dGVzO1xuICB9XG5cbiAgZGlhbG9nKGxvY2F0aW9uPzogTG9jYXRpb24pOiBMb2NhbERpYWxvZ1tdIHtcbiAgICBjb25zdCBpZCA9IGxvY2F0aW9uID8gbG9jYXRpb24uaWQgOiAtMTtcbiAgICBjb25zdCBkaWFsb2dzID0gdGhpcy5sb2NhbERpYWxvZ3MuZ2V0KGlkKTtcbiAgICBpZiAoZGlhbG9ncykgcmV0dXJuIGRpYWxvZ3M7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBObyBsb2NhbCBkaWFsb2cgZm9yIE5QQyAke2hleCh0aGlzLmlkKX0gYXQgJHtoZXgoaWQpfWApO1xuICB9XG5cbiAgc3Bhd25zKGxvY2F0aW9uOiBMb2NhdGlvbik6IG51bWJlcltdIHtcbiAgICBjb25zdCBpZCA9IGxvY2F0aW9uLmlkO1xuICAgIGNvbnN0IGNvbmRpdGlvbnMgPSB0aGlzLnNwYXduQ29uZGl0aW9ucy5nZXQobG9jYXRpb24uaWQpO1xuICAgIGlmIChjb25kaXRpb25zKSByZXR1cm4gY29uZGl0aW9ucztcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHNwYXduIGNvbmRpdGlvbiBmb3IgTlBDICR7aGV4KHRoaXMuaWQpfSBhdCAke2hleChpZCl9YCk7XG4gIH1cblxuICBoYXNEaWFsb2coKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVzdWx0ID0gQm9vbGVhbih0aGlzLmdsb2JhbERpYWxvZ3MubGVuZ3RoIHx8IHRoaXMubG9jYWxEaWFsb2dzLnNpemUpO1xuICAgIGlmICh0aGlzLmlkID4gMHg4ZSAmJiB0aGlzLmlkICE9PSAweGMzICYmIHJlc3VsdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkOiAke3RoaXMuaWR9YCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAqIGFsbERpYWxvZ3MoKTogSXRlcmFibGU8TG9jYWxEaWFsb2cgfCBHbG9iYWxEaWFsb2c+IHtcbiAgICB5aWVsZCAqIHRoaXMuZ2xvYmFsRGlhbG9ncztcbiAgICBmb3IgKGNvbnN0IGRzIG9mIHRoaXMubG9jYWxEaWFsb2dzLnZhbHVlcygpKSB7XG4gICAgICB5aWVsZCAqIGRzO1xuICAgIH1cbiAgfVxuXG4gIGRpYWxvZ0J5dGVzKCk6IG51bWJlcltdIHtcbiAgICBpZiAoIXRoaXMuaGFzRGlhbG9nKCkpIHJldHVybiBbXTtcbiAgICBjb25zdCBieXRlczogbnVtYmVyW10gPSBbXTtcbiAgICBmdW5jdGlvbiBzZXJpYWxpemUoZHM6IEdsb2JhbERpYWxvZ1tdIHwgTG9jYWxEaWFsb2dbXSk6IG51bWJlcltdIHtcbiAgICAgIGNvbnN0IG91dDogbnVtYmVyW10gPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgb3V0LnB1c2goLi4uZHNbaV0uYnl0ZXMoaSA9PT0gZHMubGVuZ3RoIC0gMSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG4gICAgaWYgKHRoaXMuZ2xvYmFsRGlhbG9ncy5sZW5ndGgpIHtcbiAgICAgIGJ5dGVzLnB1c2goLi4uc2VyaWFsaXplKHRoaXMuZ2xvYmFsRGlhbG9ncykpO1xuICAgIH0gZWxzZSB7XG4gICAgICBieXRlcy5wdXNoKDB4ODAsIDAsIDAsIDApOyAvLyBcImVtcHR5XCJcbiAgICB9XG4gICAgY29uc3QgbG9jYWxzOiBudW1iZXJbXSA9IFtdO1xuICAgIGNvbnN0IGNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTsgLy8gYWxsb3cgcmV1c2luZyBsb2NhdGlvbnNcbiAgICBmb3IgKGNvbnN0IFtsb2NhdGlvbiwgZGlhbG9nc10gb2YgdGhpcy5sb2NhbERpYWxvZ3MpIHtcbiAgICAgIGNvbnN0IGxvY2FsQnl0ZXMgPSBzZXJpYWxpemUoZGlhbG9ncyk7XG4gICAgICBjb25zdCBsYWJlbCA9IGxvY2FsQnl0ZXMuam9pbignLCcpO1xuICAgICAgY29uc3QgY2FjaGVkID0gY2FjaGUuZ2V0KGxhYmVsKTtcbiAgICAgIGlmIChjYWNoZWQgIT0gbnVsbCkge1xuICAgICAgICBieXRlcy5wdXNoKGxvY2F0aW9uLCBjYWNoZWQpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhgU0FWRUQgJHtsb2NhbEJ5dGVzLmxlbmd0aH0gYnl0ZXNgKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjYWNoZS5zZXQobGFiZWwsIGxvY2Fscy5sZW5ndGgpO1xuICAgICAgaWYgKGxvY2F0aW9uICE9PSAtMSkgYnl0ZXMucHVzaChsb2NhdGlvbiwgbG9jYWxzLmxlbmd0aCk7XG4gICAgICBsb2NhbHMucHVzaCguLi5sb2NhbEJ5dGVzKTtcbiAgICB9XG4gICAgaWYgKGxvY2Fscy5sZW5ndGgpIGJ5dGVzLnB1c2goMHhmZiwgLi4ubG9jYWxzKTtcblxuICAgIC8vIGNvbnNvbGUubG9nKGBOUEMgJHt0aGlzLmlkLnRvU3RyaW5nKDE2KX06IGJ5dGVzIGxlbmd0aCAke2J5dGVzLmxlbmd0aH1gKTtcblxuICAgIHJldHVybiBieXRlcztcbiAgfVxuXG4gIC8vIE1ha2VzIGEgXCJoYXJkbGlua1wiIGJldHdlZW4gdHdvIE5QQ3MsIGZvciBzcGF3biBjb25kaXRpb25zIGFuZCBkaWFsb2cuXG4gIGxpbmsoaWQ6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IG90aGVyID0gdGhpcy5yb20ubnBjc1tpZF07XG4gICAgdGhpcy5zcGF3bkNvbmRpdGlvbnMgPSBvdGhlci5zcGF3bkNvbmRpdGlvbnM7XG4gICAgdGhpcy5saW5rRGlhbG9nKGlkKTtcbiAgfVxuXG4gIGxpbmtEaWFsb2coaWQ6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IG90aGVyID0gdGhpcy5yb20ubnBjc1tpZF07XG4gICAgdGhpcy5nbG9iYWxEaWFsb2dzID0gb3RoZXIuZ2xvYmFsRGlhbG9ncztcbiAgICB0aGlzLmxvY2FsRGlhbG9ncyA9IG90aGVyLmxvY2FsRGlhbG9ncztcbiAgfVxuXG4gIGxvY2FsRGlhbG9nKGluZGV4OiBudW1iZXIpOiBMb2NhbERpYWxvZztcbiAgbG9jYWxEaWFsb2cobG9jYXRpb246IG51bWJlciwgaW5kZXg/OiBudW1iZXIpOiBMb2NhbERpYWxvZyB7XG4gICAgaWYgKGluZGV4ID09IG51bGwpIHtcbiAgICAgIGluZGV4ID0gbG9jYXRpb247XG4gICAgICBsb2NhdGlvbiA9IC0xO1xuICAgIH1cbiAgICBjb25zdCBkaWFsb2dzID0gdGhpcy5sb2NhbERpYWxvZ3MuZ2V0KGxvY2F0aW9uKTtcbiAgICBpZiAoZGlhbG9ncyA9PSBudWxsIHx8IGluZGV4ID49IGRpYWxvZ3MubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGxvY2FsIGRpYWxvZyAke2luZGV4fSBmb3IgbG9jYXRpb24gJHtoZXgobG9jYXRpb24pfWApO1xuICAgIH1cbiAgICByZXR1cm4gZGlhbG9nc1tpbmRleF07XG4gIH1cblxuICBpc1BhcmFseXphYmxlKCk6IGJvb2xlYW4ge1xuICAgIGZvciAobGV0IGkgPSAweDM1MDU4OyBpIDwgMHgzNTA2YzsgaSsrKSB7XG4gICAgICBpZiAodGhpcy5yb20ucHJnW2ldID09PSB0aGlzLmlkKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgYXN5bmMgd3JpdGUod3JpdGVyOiBXcml0ZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMudXNlZCkgcmV0dXJuO1xuICAgIGNvbnN0IHByb21pc2VzID0gW107XG4gICAgd3JpdGVyLnJvbS5zdWJhcnJheSh0aGlzLmRhdGFCYXNlLCB0aGlzLmRhdGFCYXNlICsgNCkuc2V0KHRoaXMuZGF0YSk7XG4gICAgcHJvbWlzZXMucHVzaCh3cml0ZXIud3JpdGUodGhpcy5zcGF3bkNvbmRpdGlvbnNCeXRlcygpLCAweDFjMDAwLCAweDFkZmZmLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBTcGF3bkNvbmRpdGlvbiAke2hleCh0aGlzLmlkKX1gKS50aGVuKFxuICAgICAgICBhZGRyZXNzID0+IHdyaXRlTGl0dGxlRW5kaWFuKHdyaXRlci5yb20sIHRoaXMuc3Bhd25Qb2ludGVyLCBhZGRyZXNzIC0gMHgxNDAwMCkpKTtcblxuICAgIGlmICh0aGlzLmhhc0RpYWxvZygpKSB7XG4gICAgICBwcm9taXNlcy5wdXNoKHdyaXRlci53cml0ZSh0aGlzLmRpYWxvZ0J5dGVzKCksIDB4MWMwMDAsIDB4MWRmZmYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgRGlhbG9nICR7aGV4KHRoaXMuaWQpfWApLnRoZW4oXG4gICAgICAgICAgYWRkcmVzcyA9PiB3cml0ZUxpdHRsZUVuZGlhbih3cml0ZXIucm9tLCB0aGlzLmRpYWxvZ1BvaW50ZXIsIGFkZHJlc3MgLSAweDE0MDAwKSkpO1xuICAgIH1cbiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEdsb2JhbERpYWxvZyB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBjb25kaXRpb246IG51bWJlciwgcHVibGljIG1lc3NhZ2U6IE1lc3NhZ2VJZCkge31cblxuICBzdGF0aWMgb2YoY29uZGl0aW9uOiBudW1iZXIsXG4gICAgICAgICAgICBtZXNzYWdlOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcj9dKTogR2xvYmFsRGlhbG9nIHtcbiAgICBjb25zdCBbcGFydCwgaW5kZXgsIGFjdGlvbiA9IDBdID0gbWVzc2FnZTtcbiAgICByZXR1cm4gbmV3IEdsb2JhbERpYWxvZyhjb25kaXRpb24sIE1lc3NhZ2VJZC5vZih7cGFydCwgaW5kZXgsIGFjdGlvbn0pKTtcbiAgfVxuXG4gIC8vIFJldHVybnMgW2RpYWxvZywgbGFzdF0uXG4gIHN0YXRpYyBwYXJzZShkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyID0gMCk6IFtHbG9iYWxEaWFsb2csIGJvb2xlYW5dIHtcbiAgICBjb25zdCBmbGFnID0gcmVhZEJpZ0VuZGlhbihkYXRhLCBvZmZzZXQpO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBNZXNzYWdlSWQuZnJvbShkYXRhLCBvZmZzZXQgKyAyKTtcblxuICAgIGxldCBjb25kaXRpb24gPSBmbGFnICYgMHgwM2ZmO1xuICAgIGNvbnN0IGxhc3QgPSAhIShmbGFnICYgMHg4MDAwKTtcbiAgICBjb25zdCBzaWduID0gZmxhZyAmIDB4MjAwMDtcbiAgICBpZiAoc2lnbikgY29uZGl0aW9uID0gfmNvbmRpdGlvbjtcblxuICAgIHJldHVybiBbbmV3IEdsb2JhbERpYWxvZyhjb25kaXRpb24sIG1lc3NhZ2UpLCBsYXN0XTtcbiAgfVxuXG4gIGJ5dGVzKGxhc3Q6IGJvb2xlYW4pOiBudW1iZXJbXSB7XG4gICAgbGV0IGZsYWcgPSB0aGlzLmNvbmRpdGlvbjtcbiAgICBpZiAoZmxhZyA8IDApIGZsYWcgPSAofmZsYWcpIHwgMHgyMDAwO1xuICAgIGlmIChsYXN0KSBmbGFnIHw9IDB4ODAwMDtcbiAgICByZXR1cm4gW2ZsYWcgPj4+IDgsIGZsYWcgJiAweGZmLCAuLi50aGlzLm1lc3NhZ2UuZGF0YV07XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIExvY2FsRGlhbG9nIHtcbiAgY29uc3RydWN0b3IocHVibGljIGNvbmRpdGlvbjogbnVtYmVyLFxuICAgICAgICAgICAgICBwdWJsaWMgbWVzc2FnZTogTWVzc2FnZUlkLFxuICAgICAgICAgICAgICBwdWJsaWMgdXBkYXRlOiBudW1iZXIsXG4gICAgICAgICAgICAgIHB1YmxpYyBmbGFnczogRmxhZ0xpc3QpIHt9XG5cbiAgY2xvbmUoKTogTG9jYWxEaWFsb2cge1xuICAgIHJldHVybiBMb2NhbERpYWxvZy5wYXJzZSh0aGlzLmJ5dGVzKGZhbHNlKSlbMF07XG4gIH1cblxuICAvLyBSZXR1cm5zIFtkaWFsb2csIGxhc3RdXG4gIHN0YXRpYyBwYXJzZShkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyID0gMCk6IFtMb2NhbERpYWxvZywgYm9vbGVhbl0ge1xuICAgIGNvbnN0IHdvcmQgPSByZWFkQmlnRW5kaWFuKGRhdGEsIG9mZnNldCk7XG4gICAgY29uc3QgbWVzc2FnZSA9IE1lc3NhZ2VJZC5mcm9tKGRhdGEsIG9mZnNldCArIDIpO1xuICAgIGNvbnN0IHVwZGF0ZSA9IGRhdGFbb2Zmc2V0ICsgNF07XG4gICAgb2Zmc2V0ICs9IDU7XG5cbiAgICBsZXQgY29uZGl0aW9uID0gd29yZCAmIDB4MDNmZjtcbiAgICBjb25zdCBsYXN0ID0gISEod29yZCAmIDB4ODAwMCk7XG4gICAgY29uc3Qgc2lnbiA9IHdvcmQgJiAweDIwMDA7XG4gICAgaWYgKHNpZ24pIGNvbmRpdGlvbiA9IH5jb25kaXRpb247XG4gICAgY29uc3QgZmxhZ3MgPSB3b3JkICYgMHg0MDAwID8gRElBTE9HX0ZMQUdTLnJlYWQoZGF0YSwgb2Zmc2V0KSA6IFtdO1xuICAgIHJldHVybiBbbmV3IExvY2FsRGlhbG9nKGNvbmRpdGlvbiwgbWVzc2FnZSwgdXBkYXRlLCBmbGFncyksIGxhc3RdO1xuICB9XG5cbiAgc3RhdGljIG9mKGNvbmRpdGlvbjogbnVtYmVyLFxuICAgICAgICAgICAgbWVzc2FnZTogW251bWJlciwgbnVtYmVyLCBudW1iZXI/XSxcbiAgICAgICAgICAgIGZsYWdzOiBGbGFnTGlzdCA9IFtdKTogTG9jYWxEaWFsb2cge1xuICAgIGNvbnN0IFtwYXJ0LCBpbmRleCwgYWN0aW9uID0gMF0gPSBtZXNzYWdlO1xuICAgIHJldHVybiBuZXcgTG9jYWxEaWFsb2coY29uZGl0aW9uLCBNZXNzYWdlSWQub2Yoe3BhcnQsIGluZGV4LCBhY3Rpb259KSwgMCwgZmxhZ3MpO1xuICB9XG5cbiAgYnl0ZUxlbmd0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiA1ICsgMiAqIHRoaXMuZmxhZ3MubGVuZ3RoO1xuICB9XG5cbiAgYnl0ZXMobGFzdDogYm9vbGVhbik6IG51bWJlcltdIHtcbiAgICBsZXQgZmxhZyA9IHRoaXMuY29uZGl0aW9uO1xuICAgIGlmIChmbGFnIDwgMCkgZmxhZyA9ICh+ZmxhZykgfCAweDIwMDA7XG4gICAgaWYgKGxhc3QpIGZsYWcgfD0gMHg4MDAwO1xuICAgIGlmICh0aGlzLmZsYWdzLmxlbmd0aCkgZmxhZyB8PSAweDQwMDA7XG4gICAgcmV0dXJuIFtmbGFnID4+PiA4LCBmbGFnICYgMHhmZiwgLi4udGhpcy5tZXNzYWdlLmRhdGEsIHRoaXMudXBkYXRlLFxuICAgICAgICAgICAgLi4uRElBTE9HX0ZMQUdTLmJ5dGVzKHRoaXMuZmxhZ3MpXTtcbiAgfVxufVxuXG5jb25zdCBVTlVTRURfTlBDUyA9IG5ldyBTZXQoW1xuICAweDMxLCAweDNiLCAweDNjLCAweDY2LCAweDY3LCAweDZhLCAweDczLCAweDc0LFxuICAweDgyLCAweDg2LCAweDg3LCAweDg5LCAweDhhLCAweDhiLCAweDhjLCAweDhkLFxuICAweGM0LFxuICAvLyBhbHNvIGV2ZXJ5dGhpbmcgZnJvbSA4Zi4uYzAsIGJ1dCB0aGF0J3MgaW1wbGljaXQuXG5dKTtcblxuZXhwb3J0IGNsYXNzIFBvcnRvYVF1ZWVuIGV4dGVuZHMgTnBjIHtcbiAgLy8gVE9ETyAtIGV4dGVuZCBOYW1lZE5wYz8gYWN0dWFsbHkgYWRkIGl0IHRvIHRoZSBjbGFzcy5cbiAgcmVhZG9ubHkgaWQgPSAweDM4O1xuICByZWFkb25seSBuYW1lID0gJ1BvcnRvYSBRdWVlbic7XG4gIGdldCBleHBlY3RlZFN3b3JkKCk6IG51bWJlciB7IHJldHVybiB0aGlzLmxvY2FsRGlhbG9nKDMpLmNvbmRpdGlvbiAmIDB4ZmY7IH1cbiAgc2V0IGV4cGVjdGVkU3dvcmQoaWQ6IG51bWJlcikgeyB0aGlzLmxvY2FsRGlhbG9nKDMpLmNvbmRpdGlvbiA9IDB4MjAwIHwgaWQ7IH1cbn1cbiJdfQ==