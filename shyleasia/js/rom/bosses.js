import { die } from '../assert.js';
import { readLittleEndian, upperCamelToSpaces } from './util.js';
export class Bosses {
    constructor(rom) {
        this.rom = rom;
        this.Vampire1 = new Boss(this, {
            flag: this.rom.flags.Vampire1,
            kill: 0x0,
            npc: this.rom.npcs.Vampire1,
            shuffled: true,
            sword: 1,
        });
        this.Insect = new Boss(this, {
            flag: this.rom.flags.GiantInsect,
            kill: 0x1,
            npc: this.rom.npcs.Insect,
            sword: 1,
        });
        this.Kelbesque1 = new Boss(this, {
            flag: this.rom.flags.Kelbesque1,
            kill: 0x2,
            npc: this.rom.npcs.Kelbesque1,
            shuffled: true,
        });
        this.Rage = new Boss(this, {
            flag: this.rom.flags.Rage,
            kill: 0x3,
            npc: this.rom.npcs.Rage,
        });
        this.Sabera1 = new Boss(this, {
            address: 0x3656e,
            flag: this.rom.flags.Sabera1,
            kill: 0x4,
            npc: this.rom.npcs.SaberaDisguisedAsMesia,
            shuffled: true,
        });
        this.Vampire2 = new Boss(this, {
            flag: this.rom.flags.Vampire2,
            kill: 0xc,
            npc: this.rom.npcs.Vampire2,
            shuffled: true,
            sword: 1,
        });
        this.Mado1 = new Boss(this, {
            address: 0x3d820,
            flag: this.rom.flags.Mado1,
            kill: 0x5,
            shuffled: true,
        });
        this.Kelbesque2 = new Boss(this, {
            flag: this.rom.flags.Kelbesque2,
            kill: 0x6,
            npc: this.rom.npcs.Kelbesque2,
            shuffled: true,
        });
        this.Sabera2 = new Boss(this, {
            flag: this.rom.flags.Sabera2,
            kill: 0x7,
            npc: this.rom.npcs.Sabera2,
            shuffled: true,
        });
        this.Mado2 = new Boss(this, {
            flag: this.rom.flags.Mado2,
            kill: 0x8,
            npc: this.rom.npcs.Mado2,
            shuffled: true,
        });
        this.Karmine = new Boss(this, {
            flag: this.rom.flags.Karmine,
            kill: 0x9,
            npc: this.rom.npcs.Karmine,
            shuffled: true,
            sword: 2,
        });
        this.Draygon1 = new Boss(this, {
            flag: this.rom.flags.Draygon1,
            kill: 0xa,
            npc: this.rom.npcs.Draygon,
            shuffled: true,
            sword: 2,
        });
        this.StatueOfMoon = new Boss(this, {
            flag: this.rom.flags.UsedBowOfMoon,
            npc: this.rom.npcs.StatueOfMoon,
        });
        this.StatueOfSun = new Boss(this, {
            flag: this.rom.flags.UsedBowOfSun,
            npc: this.rom.npcs.StatueOfSun,
        });
        this.Draygon2 = new Boss(this, {
            flag: this.rom.flags.Draygon2,
            kill: 0xb,
            npc: this.rom.npcs.Draygon,
        });
        this.Dyna = new Boss(this, {
            kill: 0xd,
            object: 0xa4,
        });
        this.all = [];
        for (const key in this) {
            if (!this.hasOwnProperty(key))
                continue;
            const boss = this[key];
            if (boss instanceof Boss) {
                boss.name = upperCamelToSpaces(key);
                this.all.push(boss);
            }
        }
    }
    isBossFlag(flag) {
        const flags = this.flags || (this.flags = (() => {
            const f = new Set();
            for (const boss of this.all) {
                if (boss.flag != null)
                    f.add(boss.flag.id);
            }
            return f;
        })());
        return flags.has(flag);
    }
    fromLocation(id) {
        return this.all.find(b => b.location === id);
    }
    fromBossKill(num) {
        return this.all.find(b => b.kill === num);
    }
    fromObject(id) {
        return this.all.find(b => b.object === id);
    }
    [Symbol.iterator]() {
        return this.all[Symbol.iterator]();
    }
}
export class Boss {
    constructor(bosses, { flag, npc, kill, shuffled, address, sword = 3, object }) {
        this.bosses = bosses;
        const { prg } = bosses.rom;
        this.flag = flag;
        this.npc = npc;
        this.object =
            address ? prg[address] : npc ? npc.data[1] : (object !== null && object !== void 0 ? object : die(`address, npc, or object is required`));
        this.swordLevel = sword;
        this.shuffled = Boolean(shuffled);
        this.kill = kill;
        if (kill != null) {
            const killAddr = 0x14000 + readLittleEndian(prg, 0x1f96b + 2 * kill);
            const drop = prg[killAddr + 4];
            if (drop !== 0xff)
                this.drop = drop;
            this.location = prg[0x1f95d + kill];
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm9zc2VzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3JvbS9ib3NzZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLEdBQUcsRUFBQyxNQUFNLGNBQWMsQ0FBQztBQUlqQyxPQUFPLEVBQVUsZ0JBQWdCLEVBQUUsa0JBQWtCLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFpQnhFLE1BQU0sT0FBTyxNQUFNO0lBbUdqQixZQUFxQixHQUFRO1FBQVIsUUFBRyxHQUFILEdBQUcsQ0FBSztRQWpHcEIsYUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUNqQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUTtZQUM3QixJQUFJLEVBQUUsR0FBRztZQUNULEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRO1lBQzNCLFFBQVEsRUFBRSxJQUFJO1lBQ2QsS0FBSyxFQUFFLENBQUM7U0FDVCxDQUFDLENBQUM7UUFDTSxXQUFNLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQy9CLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxXQUFXO1lBQ2hDLElBQUksRUFBRSxHQUFHO1lBQ1QsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU07WUFDekIsS0FBSyxFQUFFLENBQUM7U0FDVCxDQUFDLENBQUM7UUFDTSxlQUFVLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ25DLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxVQUFVO1lBQy9CLElBQUksRUFBRSxHQUFHO1lBQ1QsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVU7WUFDN0IsUUFBUSxFQUFFLElBQUk7U0FDZixDQUFDLENBQUM7UUFDTSxTQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQzdCLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJO1lBQ3pCLElBQUksRUFBRSxHQUFHO1lBQ1QsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7U0FDeEIsQ0FBQyxDQUFDO1FBQ00sWUFBTyxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUNoQyxPQUFPLEVBQUUsT0FBTztZQUNoQixJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTztZQUM1QixJQUFJLEVBQUUsR0FBRztZQUNULEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxzQkFBc0I7WUFDekMsUUFBUSxFQUFFLElBQUk7U0FDZixDQUFDLENBQUM7UUFDTSxhQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2pDLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRO1lBQzdCLElBQUksRUFBRSxHQUFHO1lBQ1QsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVE7WUFDM0IsUUFBUSxFQUFFLElBQUk7WUFDZCxLQUFLLEVBQUUsQ0FBQztTQUNULENBQUMsQ0FBQztRQUNNLFVBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDOUIsT0FBTyxFQUFFLE9BQU87WUFDaEIsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUs7WUFDMUIsSUFBSSxFQUFFLEdBQUc7WUFDVCxRQUFRLEVBQUUsSUFBSTtTQUNmLENBQUMsQ0FBQztRQUNNLGVBQVUsR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDbkMsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLFVBQVU7WUFDL0IsSUFBSSxFQUFFLEdBQUc7WUFDVCxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVTtZQUM3QixRQUFRLEVBQUUsSUFBSTtTQUNmLENBQUMsQ0FBQztRQUNNLFlBQU8sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDaEMsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU87WUFDNUIsSUFBSSxFQUFFLEdBQUc7WUFDVCxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTztZQUMxQixRQUFRLEVBQUUsSUFBSTtTQUNmLENBQUMsQ0FBQztRQUNNLFVBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDOUIsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUs7WUFDMUIsSUFBSSxFQUFFLEdBQUc7WUFDVCxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSztZQUN4QixRQUFRLEVBQUUsSUFBSTtTQUNmLENBQUMsQ0FBQztRQUNNLFlBQU8sR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDaEMsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU87WUFDNUIsSUFBSSxFQUFFLEdBQUc7WUFDVCxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTztZQUMxQixRQUFRLEVBQUUsSUFBSTtZQUNkLEtBQUssRUFBRSxDQUFDO1NBQ1QsQ0FBQyxDQUFDO1FBQ00sYUFBUSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUNqQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUTtZQUM3QixJQUFJLEVBQUUsR0FBRztZQUNULEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPO1lBQzFCLFFBQVEsRUFBRSxJQUFJO1lBQ2QsS0FBSyxFQUFFLENBQUM7U0FDVCxDQUFDLENBQUM7UUFDTSxpQkFBWSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUNyQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsYUFBYTtZQUNsQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWTtTQUNoQyxDQUFDLENBQUM7UUFDTSxnQkFBVyxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUNwQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsWUFBWTtZQUNqQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVztTQUMvQixDQUFDLENBQUM7UUFDTSxhQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ2pDLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxRQUFRO1lBQzdCLElBQUksRUFBRSxHQUFHO1lBQ1QsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU87U0FDM0IsQ0FBQyxDQUFDO1FBQ00sU0FBSSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtZQUM3QixJQUFJLEVBQUUsR0FBRztZQUNULE1BQU0sRUFBRSxJQUFJO1NBQ2IsQ0FBQyxDQUFDO1FBRWMsUUFBRyxHQUFXLEVBQUUsQ0FBQztRQUloQyxLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRTtZQUN0QixJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUM7Z0JBQUUsU0FBUztZQUN4QyxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdkIsSUFBSSxJQUFJLFlBQVksSUFBSSxFQUFFO2dCQUN2QixJQUFzQixDQUFDLElBQUksR0FBRyxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDdkQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDckI7U0FDRjtJQUNILENBQUM7SUFFRCxVQUFVLENBQUMsSUFBWTtRQUNyQixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsRUFBRTtZQUM5QyxNQUFNLENBQUMsR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO1lBQzVCLEtBQUssTUFBTSxJQUFJLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFDM0IsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUk7b0JBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2FBQzVDO1lBQ0QsT0FBTyxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDTixPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUVELFlBQVksQ0FBQyxFQUFVO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRCxZQUFZLENBQUMsR0FBVztRQUN0QixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRUQsVUFBVSxDQUFDLEVBQVU7UUFDbkIsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQztRQUNmLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztJQUNyQyxDQUFDO0NBQ0Y7QUFHRCxNQUFNLE9BQU8sSUFBSTtJQWNmLFlBQXFCLE1BQWMsRUFDdkIsRUFBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQ3pCLE9BQU8sRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLE1BQU0sRUFBVztRQUY3QixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBR2pDLE1BQU0sRUFBQyxHQUFHLEVBQUMsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO1FBQ2YsSUFBSSxDQUFDLE1BQU07WUFDUCxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFDNUMsTUFBTSxhQUFOLE1BQU0sY0FBTixNQUFNLEdBQUksR0FBRyxDQUFDLHFDQUFxQyxDQUFDLENBQUEsQ0FBQztRQUN6RCxJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztRQUN4QixJQUFJLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLElBQUksSUFBSSxJQUFJLEVBQUU7WUFDaEIsTUFBTSxRQUFRLEdBQUcsT0FBTyxHQUFHLGdCQUFnQixDQUFDLEdBQUcsRUFBRSxPQUFPLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQ3JFLE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0IsSUFBSSxJQUFJLEtBQUssSUFBSTtnQkFBRSxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUNwQyxJQUFJLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUM7U0FDckM7SUFDSCxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2RpZX0gZnJvbSAnLi4vYXNzZXJ0LmpzJztcbmltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuaW1wb3J0IHtGbGFnfSBmcm9tICcuL2ZsYWdzLmpzJztcbmltcG9ydCB7TnBjfSBmcm9tICcuL25wYy5qcyc7XG5pbXBvcnQge011dGFibGUsIHJlYWRMaXR0bGVFbmRpYW4sIHVwcGVyQ2FtZWxUb1NwYWNlc30gZnJvbSAnLi91dGlsLmpzJztcblxuaW50ZXJmYWNlIEJvc3NEYXRhIHtcbiAgcmVhZG9ubHkgZmxhZz86IEZsYWc7XG4gIHJlYWRvbmx5IG5wYz86IE5wYztcbiAgcmVhZG9ubHkga2lsbD86IG51bWJlcjtcbiAgcmVhZG9ubHkgc2h1ZmZsZWQ/OiBib29sZWFuO1xuICByZWFkb25seSBhZGRyZXNzPzogbnVtYmVyO1xuICByZWFkb25seSBzd29yZD86IG51bWJlcjtcbiAgcmVhZG9ubHkgb2JqZWN0PzogbnVtYmVyO1xufVxuXG4vLyBUT0RPIC0gd2UgbmVlZCBhIGNvbnNpc3RlbnQgd2F5IHRvIHJlZmVyIHRvIGJvc3Nlcy4uLlxuLy8gIC0gbWF5YmUgYm9zc2VzLmZyb21OcGNJZCgpLCBib3NzZXMuZnJvbU9iamVjdElkKCksIGJvc3Nlcy5mcm9tQm9zc0tpbGwoKVxuXG4vLyBSZXByZXNlbnRzIGEgYm9zcyBzbG90LiAgTm90ZSB0aGF0IHRoZSBzcGVjaWZpYyBvYmplY3QgaXMgdGllZCBtb3N0IHRpZ2h0bHlcbi8vIHRvIHRoZSBib3NzIGtpbGwgKGRyb3ApLCByYXRoZXIgdGhhbiB0aGUgc3BlY2lmaWMgaWRlbnRpdHkgb2YgdGhlIGJvc3MuXG5leHBvcnQgY2xhc3MgQm9zc2VzIGltcGxlbWVudHMgSXRlcmFibGU8Qm9zcz4ge1xuXG4gIHJlYWRvbmx5IFZhbXBpcmUxID0gbmV3IEJvc3ModGhpcywge1xuICAgIGZsYWc6IHRoaXMucm9tLmZsYWdzLlZhbXBpcmUxLFxuICAgIGtpbGw6IDB4MCxcbiAgICBucGM6IHRoaXMucm9tLm5wY3MuVmFtcGlyZTEsXG4gICAgc2h1ZmZsZWQ6IHRydWUsXG4gICAgc3dvcmQ6IDEsXG4gIH0pO1xuICByZWFkb25seSBJbnNlY3QgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuR2lhbnRJbnNlY3QsXG4gICAga2lsbDogMHgxLFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5JbnNlY3QsXG4gICAgc3dvcmQ6IDEsXG4gIH0pO1xuICByZWFkb25seSBLZWxiZXNxdWUxID0gbmV3IEJvc3ModGhpcywge1xuICAgIGZsYWc6IHRoaXMucm9tLmZsYWdzLktlbGJlc3F1ZTEsXG4gICAga2lsbDogMHgyLFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5LZWxiZXNxdWUxLFxuICAgIHNodWZmbGVkOiB0cnVlLFxuICB9KTtcbiAgcmVhZG9ubHkgUmFnZSA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBmbGFnOiB0aGlzLnJvbS5mbGFncy5SYWdlLFxuICAgIGtpbGw6IDB4MyxcbiAgICBucGM6IHRoaXMucm9tLm5wY3MuUmFnZSxcbiAgfSk7XG4gIHJlYWRvbmx5IFNhYmVyYTEgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgYWRkcmVzczogMHgzNjU2ZSxcbiAgICBmbGFnOiB0aGlzLnJvbS5mbGFncy5TYWJlcmExLFxuICAgIGtpbGw6IDB4NCxcbiAgICBucGM6IHRoaXMucm9tLm5wY3MuU2FiZXJhRGlzZ3Vpc2VkQXNNZXNpYSxcbiAgICBzaHVmZmxlZDogdHJ1ZSxcbiAgfSk7XG4gIHJlYWRvbmx5IFZhbXBpcmUyID0gbmV3IEJvc3ModGhpcywge1xuICAgIGZsYWc6IHRoaXMucm9tLmZsYWdzLlZhbXBpcmUyLFxuICAgIGtpbGw6IDB4YyxcbiAgICBucGM6IHRoaXMucm9tLm5wY3MuVmFtcGlyZTIsXG4gICAgc2h1ZmZsZWQ6IHRydWUsXG4gICAgc3dvcmQ6IDEsXG4gIH0pO1xuICByZWFkb25seSBNYWRvMSA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBhZGRyZXNzOiAweDNkODIwLFxuICAgIGZsYWc6IHRoaXMucm9tLmZsYWdzLk1hZG8xLFxuICAgIGtpbGw6IDB4NSxcbiAgICBzaHVmZmxlZDogdHJ1ZSxcbiAgfSk7XG4gIHJlYWRvbmx5IEtlbGJlc3F1ZTIgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuS2VsYmVzcXVlMixcbiAgICBraWxsOiAweDYsXG4gICAgbnBjOiB0aGlzLnJvbS5ucGNzLktlbGJlc3F1ZTIsXG4gICAgc2h1ZmZsZWQ6IHRydWUsXG4gIH0pO1xuICByZWFkb25seSBTYWJlcmEyID0gbmV3IEJvc3ModGhpcywge1xuICAgIGZsYWc6IHRoaXMucm9tLmZsYWdzLlNhYmVyYTIsXG4gICAga2lsbDogMHg3LFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5TYWJlcmEyLFxuICAgIHNodWZmbGVkOiB0cnVlLFxuICB9KTtcbiAgcmVhZG9ubHkgTWFkbzIgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuTWFkbzIsXG4gICAga2lsbDogMHg4LFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5NYWRvMixcbiAgICBzaHVmZmxlZDogdHJ1ZSxcbiAgfSk7XG4gIHJlYWRvbmx5IEthcm1pbmUgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuS2FybWluZSxcbiAgICBraWxsOiAweDksXG4gICAgbnBjOiB0aGlzLnJvbS5ucGNzLkthcm1pbmUsXG4gICAgc2h1ZmZsZWQ6IHRydWUsXG4gICAgc3dvcmQ6IDIsXG4gIH0pO1xuICByZWFkb25seSBEcmF5Z29uMSA9IG5ldyBCb3NzKHRoaXMsIHtcbiAgICBmbGFnOiB0aGlzLnJvbS5mbGFncy5EcmF5Z29uMSxcbiAgICBraWxsOiAweGEsXG4gICAgbnBjOiB0aGlzLnJvbS5ucGNzLkRyYXlnb24sXG4gICAgc2h1ZmZsZWQ6IHRydWUsXG4gICAgc3dvcmQ6IDIsXG4gIH0pO1xuICByZWFkb25seSBTdGF0dWVPZk1vb24gPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuVXNlZEJvd09mTW9vbixcbiAgICBucGM6IHRoaXMucm9tLm5wY3MuU3RhdHVlT2ZNb29uLFxuICB9KTtcbiAgcmVhZG9ubHkgU3RhdHVlT2ZTdW4gPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAgZmxhZzogdGhpcy5yb20uZmxhZ3MuVXNlZEJvd09mU3VuLFxuICAgIG5wYzogdGhpcy5yb20ubnBjcy5TdGF0dWVPZlN1bixcbiAgfSk7XG4gIHJlYWRvbmx5IERyYXlnb24yID0gbmV3IEJvc3ModGhpcywge1xuICAgIGZsYWc6IHRoaXMucm9tLmZsYWdzLkRyYXlnb24yLFxuICAgIGtpbGw6IDB4YixcbiAgICBucGM6IHRoaXMucm9tLm5wY3MuRHJheWdvbixcbiAgfSk7XG4gIHJlYWRvbmx5IER5bmEgPSBuZXcgQm9zcyh0aGlzLCB7XG4gICAga2lsbDogMHhkLFxuICAgIG9iamVjdDogMHhhNCxcbiAgfSk7XG5cbiAgcHJpdmF0ZSByZWFkb25seSBhbGw6IEJvc3NbXSA9IFtdO1xuICBwcml2YXRlIGZsYWdzPzogU2V0PG51bWJlcj47XG5cbiAgY29uc3RydWN0b3IocmVhZG9ubHkgcm9tOiBSb20pIHtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzKSB7XG4gICAgICBpZiAoIXRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSkgY29udGludWU7XG4gICAgICBjb25zdCBib3NzID0gdGhpc1trZXldO1xuICAgICAgaWYgKGJvc3MgaW5zdGFuY2VvZiBCb3NzKSB7XG4gICAgICAgIChib3NzIGFzIE11dGFibGU8Qm9zcz4pLm5hbWUgPSB1cHBlckNhbWVsVG9TcGFjZXMoa2V5KTtcbiAgICAgICAgdGhpcy5hbGwucHVzaChib3NzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpc0Jvc3NGbGFnKGZsYWc6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGZsYWdzID0gdGhpcy5mbGFncyB8fCAodGhpcy5mbGFncyA9ICgoKSA9PiB7XG4gICAgICBjb25zdCBmID0gbmV3IFNldDxudW1iZXI+KCk7XG4gICAgICBmb3IgKGNvbnN0IGJvc3Mgb2YgdGhpcy5hbGwpIHtcbiAgICAgICAgaWYgKGJvc3MuZmxhZyAhPSBudWxsKSBmLmFkZChib3NzLmZsYWcuaWQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGY7XG4gICAgfSkoKSk7XG4gICAgcmV0dXJuIGZsYWdzLmhhcyhmbGFnKTtcbiAgfVxuXG4gIGZyb21Mb2NhdGlvbihpZDogbnVtYmVyKTogQm9zc3x1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmFsbC5maW5kKGIgPT4gYi5sb2NhdGlvbiA9PT0gaWQpO1xuICB9XG5cbiAgZnJvbUJvc3NLaWxsKG51bTogbnVtYmVyKTogQm9zc3x1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmFsbC5maW5kKGIgPT4gYi5raWxsID09PSBudW0pO1xuICB9XG5cbiAgZnJvbU9iamVjdChpZDogbnVtYmVyKTogQm9zc3x1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmFsbC5maW5kKGIgPT4gYi5vYmplY3QgPT09IGlkKTtcbiAgfVxuXG4gIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhYmxlSXRlcmF0b3I8Qm9zcz4ge1xuICAgIHJldHVybiB0aGlzLmFsbFtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gIH1cbn1cblxuLy8gTk9URTogY3VycmVudGx5IHRoaXMgZGF0YSBpcyByZWFkLW9ubHkuXG5leHBvcnQgY2xhc3MgQm9zcyB7XG5cbiAgLy8gVE9ETyAtIG1ha2Ugb2JqZWN0IHNldHRhYmxlP1xuICByZWFkb25seSBuYW1lITogc3RyaW5nO1xuICByZWFkb25seSBvYmplY3Q6IG51bWJlcjtcbiAgcmVhZG9ubHkgZmxhZz86IEZsYWc7XG4gIHJlYWRvbmx5IG5wYz86IE5wYztcbiAgcmVhZG9ubHkgc3dvcmRMZXZlbDogbnVtYmVyO1xuICByZWFkb25seSBzaHVmZmxlZDogYm9vbGVhbjtcbiAgcmVhZG9ubHkgZHJvcD86IG51bWJlcjtcbiAgcmVhZG9ubHkga2lsbD86IG51bWJlcjtcbiAgcmVhZG9ubHkgbG9jYXRpb24/OiBudW1iZXI7XG5cbiAgLy8gT25seSB1c2VkIGZvciBsb2dpYy5cbiAgY29uc3RydWN0b3IocmVhZG9ubHkgYm9zc2VzOiBCb3NzZXMsXG4gICAgICAgICAgICAgIHtmbGFnLCBucGMsIGtpbGwsIHNodWZmbGVkLFxuICAgICAgICAgICAgICAgYWRkcmVzcywgc3dvcmQgPSAzLCBvYmplY3R9OiBCb3NzRGF0YSkge1xuICAgIGNvbnN0IHtwcmd9ID0gYm9zc2VzLnJvbTtcbiAgICB0aGlzLmZsYWcgPSBmbGFnO1xuICAgIHRoaXMubnBjID0gbnBjO1xuICAgIHRoaXMub2JqZWN0ID1cbiAgICAgICAgYWRkcmVzcyA/IHByZ1thZGRyZXNzXSA6IG5wYyA/IG5wYy5kYXRhWzFdIDpcbiAgICAgICAgb2JqZWN0ID8/IGRpZShgYWRkcmVzcywgbnBjLCBvciBvYmplY3QgaXMgcmVxdWlyZWRgKTtcbiAgICB0aGlzLnN3b3JkTGV2ZWwgPSBzd29yZDtcbiAgICB0aGlzLnNodWZmbGVkID0gQm9vbGVhbihzaHVmZmxlZCk7XG4gICAgdGhpcy5raWxsID0ga2lsbDtcbiAgICBpZiAoa2lsbCAhPSBudWxsKSB7XG4gICAgICBjb25zdCBraWxsQWRkciA9IDB4MTQwMDAgKyByZWFkTGl0dGxlRW5kaWFuKHByZywgMHgxZjk2YiArIDIgKiBraWxsKTtcbiAgICAgIGNvbnN0IGRyb3AgPSBwcmdba2lsbEFkZHIgKyA0XTtcbiAgICAgIGlmIChkcm9wICE9PSAweGZmKSB0aGlzLmRyb3AgPSBkcm9wO1xuICAgICAgdGhpcy5sb2NhdGlvbiA9IHByZ1sweDFmOTVkICsga2lsbF07XG4gICAgfVxuICB9XG59XG4iXX0=