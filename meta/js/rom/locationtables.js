import { DataTuple, hex } from './util.js';
export class Entrance extends DataTuple {
    constructor() {
        super(...arguments);
        this.x = this.prop([0], [1, 0xff, -8]);
        this.y = this.prop([2], [3, 0xff, -8]);
        this.screen = this.prop([3, 0x0f, -4], [1, 0x0f]);
        this.tile = this.prop([2, 0xf0], [0, 0xf0, 4]);
        this.coord = this.prop([2, 0xff, -8], [0, 0xff]);
    }
    get used() {
        return this.data[1] < 0x08;
    }
    ;
    toString() {
        return `Entrance ${this.hex()}: (${hex(this.y)}, ${hex(this.x)})`;
    }
}
Entrance.size = 4;
export class Exit extends DataTuple {
    constructor() {
        super(...arguments);
        this.x = this.prop([0, 0xff, -4]);
        this.xt = this.prop([0]);
        this.y = this.prop([1, 0xff, -4]);
        this.yt = this.prop([1]);
        this.screen = this.prop([1, 0xf0], [0, 0xf0, 4]);
        this.tile = this.prop([1, 0x0f, -4], [0, 0x0f]);
        this.coord = this.prop([1, 0x0f, -12], [0, 0x0f, -4]);
        this.dest = this.prop([2]);
        this.entrance = this.prop([3]);
    }
    isSeamless() {
        return Boolean(this.entrance & 0x20);
    }
    toString() {
        return `Exit ${this.hex()}: (${hex(this.y)}, ${hex(this.x)}) => ${this.dest}:${this.entrance}`;
    }
}
Exit.size = 4;
export class Flag extends DataTuple {
    constructor() {
        super(...arguments);
        this.x = this.prop([1, 0x07, -8]);
        this.xs = this.prop([1, 0x07]);
        this.y = this.prop([1, 0xf0, -4]);
        this.ys = this.prop([1, 0xf0, 4]);
        this.screen = this.prop([1]);
    }
    get flag() {
        return this.data[0] | 0x200;
    }
    set flag(f) {
        if ((f & ~0xff) !== 0x200)
            throw new Error(`bad flag: ${hex(f)}`);
        this.data[0] = f & 0xff;
    }
    toString() {
        return `Flag ${this.hex()}: ${hex(this.screen)} @ ${hex(this.flag)}`;
    }
}
Flag.size = 2;
export class Pit extends DataTuple {
    constructor() {
        super(...arguments);
        this.fromXs = this.prop([1, 0x70, 4]);
        this.toXs = this.prop([1, 0x07]);
        this.fromYs = this.prop([3, 0xf0, 4]);
        this.toYs = this.prop([3, 0x0f]);
        this.fromScreen = this.prop([3, 0xf0], [1, 0x70, 4]);
        this.toScreen = this.prop([3, 0x0f, -4], [1, 0x07]);
        this.dest = this.prop([0]);
    }
    toString() {
        return `Pit ${this.hex()}: (${hex(this.fromXs)}, ${hex(this.fromYs)}) => ${hex(this.dest)}:(${hex(this.toXs)}, ${hex(this.toYs)})`;
    }
}
Pit.size = 4;
export class Spawn extends DataTuple {
    constructor() {
        super(...arguments);
        this.y = this.prop([0, 0xff, -4]);
        this.yt = this.prop([0]);
        this.x = this.prop([1, 0x7f, -4], [2, 0x40, 3]);
        this.xt = this.prop([1, 0x7f]);
        this.timed = this.booleanProp(1, 7);
        this.screen = this.prop([0, 0xf0], [1, 0x70, 4]);
        this.tile = this.prop([0, 0x0f, -4], [1, 0x0f]);
        this.coord = this.prop([0, 0xff, -8], [1, 0x7f, -4], [2, 0x40, 3]);
        this.type = this.prop([2, 0x07]);
        this.id = this.prop([3]);
        this.patternBank = this.prop([2, 0x80, 7]);
    }
    get used() {
        return this.data[0] !== 0xfe;
    }
    set used(used) {
        this.data[0] = used ? 0 : 0xfe;
    }
    get monsterId() {
        return (this.id + 0x50) & 0xff;
    }
    set monsterId(id) {
        this.id = (id - 0x50) & 0xff;
    }
    isChest() { return this.type === 2 && this.id < 0x80; }
    isInvisible() {
        return this.isChest() && Boolean(this.data[2] & 0x20);
    }
    isTrigger() { return this.type === 2 && this.id >= 0x80; }
    isNpc() { return this.type === 1 && this.id < 0xc0; }
    isBoss() { return this.type === 1 && this.id >= 0xc0; }
    isMonster() { return this.type === 0; }
    isWall() {
        return Boolean(this.type === 3 && (this.id < 4 || (this.data[2] & 0x20)));
    }
    isShootingWall(location) {
        return this.isWall() &&
            !!(this.data[2] & 0x20 ? this.data[2] & 0x10 :
                location.id === 0x8f || location.id === 0xa8);
    }
    wallType() {
        if (this.type !== 3)
            return '';
        const obj = this.data[2] & 0x20 ? this.id >>> 4 : this.id;
        if (obj >= 4)
            return '';
        return obj === 2 ? 'bridge' : 'wall';
    }
    wallElement() {
        if (!this.isWall())
            return -1;
        return this.id & 3;
    }
    toString() {
        return `Spawn ${this.hex()}: (${hex(this.x)}, ${hex(this.y)}) ${this.timed ? 'timed' : 'fixed'} ${this.type}:${hex(this.id)}`;
    }
}
Spawn.size = 4;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9jYXRpb250YWJsZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvcm9tL2xvY2F0aW9udGFibGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsR0FBRyxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBR3pDLE1BQU0sT0FBTyxRQUFTLFNBQVEsU0FBUztJQUF2Qzs7UUFTRSxNQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFbEMsTUFBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBT2xDLFdBQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7UUFFN0MsU0FBSSxHQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFNUMsVUFBSyxHQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQVUvQyxDQUFDO0lBUEMsSUFBSSxJQUFJO1FBQ04sT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztJQUM3QixDQUFDO0lBQUEsQ0FBQztJQUVGLFFBQVE7UUFDTixPQUFPLFlBQVks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QzNDLFFBQVEsQ0FBQyxFQUFFLEtBQUssSUFBSSxJQUFJLFFBQVEsQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQztZQUFFLE9BQU8sRUFBRSxDQUFDO1FBQy9CLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUMxRCxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQUUsT0FBTyxFQUFFLENBQUM7UUFDeEIsT0FBTyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQUN2QyxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUM5QixPQUFPLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3JCLENBQUM7SUFFRCxRQUFRO1FBQ04sT0FBTyxTQUFTLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQ25ELElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO0lBQ3hFLENBQUM7O0FBN0ZNLFVBQUksR0FBRyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0RhdGFUdXBsZSwgaGV4fSBmcm9tICcuL3V0aWwuanMnO1xuXG4vKiogQSBzaW5nbGUgc2NyZWVuIGVudHJhbmNlIGNvb3JkaW5hdGUuICovXG5leHBvcnQgY2xhc3MgRW50cmFuY2UgZXh0ZW5kcyBEYXRhVHVwbGUge1xuICAvLyBCYXNpYyBwYXR0ZXJuOiB4bG8geGhpIHlsbyB5aGkgPSAoeHApKHh0KSAoeHMpKDApICh5cCkoeXQpICh5cykoMClcbiAgLy8gd2hlcmUgeHAgaXMgcGl4ZWwgcG9zaXRpb24gd2l0aGluIHRpbGUsIHh0IGlzIHRpbGUsIGFuZCB4cyBpcyBzY3JlZW5cbiAgc3RhdGljIHNpemUgPSA0O1xuXG4gIC8vIHggPSB0aGlzLmJpdHMoWzAsIDE2XSlcbiAgLy8geSA9IHRoaXMuYml0cyhbMTYsIDMyXSlcblxuICAvKiogRnVsbCAxMS1iaXQgeC1jb29yZGluYXRlIG9mIHRoZSBlbnRyYW5jZS4gKi9cbiAgeCA9IHRoaXMucHJvcChbMF0sIFsxLCAweGZmLCAtOF0pO1xuICAvKiogRnVsbCAxMi1iaXQgeS1jb29yZGluYXRlIG9mIHRoZSBlbnRyYW5jZS4gKi9cbiAgeSA9IHRoaXMucHJvcChbMl0sIFszLCAweGZmLCAtOF0pO1xuXG4gIC8vIHNjcmVlbiA9IHRoaXMuYml0cyhbOCwgMTJdLCBbMjQsIDI4XSk7XG4gIC8vIHRpbGUgICA9IHRoaXMuYml0cyhbNCwgOF0sIFsyMCwgMjRdKTtcbiAgLy8gY29vcmQgID0gdGhpcy5iaXRzKFswLCA4XSwgWzE2LCAyNF0pO1xuXG4gIC8qKiA4LWJpdCBzY3JlZW4gKHl4KS4gKi9cbiAgc2NyZWVuID0gdGhpcy5wcm9wKFszLCAweDBmLCAtNF0sIFsxLCAweDBmXSk7XG4gIC8qKiA4LWJpdCB0aWxlIHdpdGhpbiB0aGUgc2NyZWVuICh5eCkuICovXG4gIHRpbGUgICA9IHRoaXMucHJvcChbMiwgMHhmMF0sIFswLCAweGYwLCA0XSk7XG4gIC8qKiAxNi1iaXQgY29vcmRpbmF0ZSB3aXRoaW4gdGhlIHNjcmVlbiAoeXl4eCkuICovXG4gIGNvb3JkICA9IHRoaXMucHJvcChbMiwgMHhmZiwgLThdLCBbMCwgMHhmZl0pO1xuXG4gIC8qKiBXaGV0aGVyIHRoZSBlbnRyYW5jZSBoYXMgbm90IGJlZW4gZGlzYWJsZWQgYnkgc2V0dGluZyBpdHMgeCB0byBmZl9fLiAqL1xuICBnZXQgdXNlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhWzFdIDwgMHgwODtcbiAgfTtcblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiBgRW50cmFuY2UgJHt0aGlzLmhleCgpfTogKCR7aGV4KHRoaXMueSl9LCAke2hleCh0aGlzLngpfSlgO1xuICB9XG59XG5cbi8qKiBBIHNpbmdsZSBzY3JlZW4gZXhpdCB0aWxlLiAqL1xuZXhwb3J0IGNsYXNzIEV4aXQgZXh0ZW5kcyBEYXRhVHVwbGUge1xuICBzdGF0aWMgc2l6ZSA9IDQ7XG5cbiAgLyoqIDExLWJpdCB4LWNvb3JkaW5hdGUgb2YgZXhpdCBwaXhlbCAobG93IDQgYml0cyBhbHdheXMgemVybykuICovXG4gIHggICAgICAgID0gdGhpcy5wcm9wKFswLCAweGZmLCAtNF0pO1xuICAvKiogNy1iaXQgeC1jb29yZGluYXRlIG9mIGV4aXQgdGlsZSAoc2NyZWVuLXRpbGUpLiAqL1xuICB4dCAgICAgICA9IHRoaXMucHJvcChbMF0pO1xuXG4gIC8qKiAxMi1iaXQgeS1jb29yZGluYXRlIG9mIGV4aXQgcGl4ZWwgKGxvdyA0IGJpdHMgYWx3YXlzIHplcm8pLiAqL1xuICB5ICAgICAgICA9IHRoaXMucHJvcChbMSwgMHhmZiwgLTRdKTtcbiAgLyoqIDgtYml0IHktY29vcmRpbmF0ZSBvZiBleGl0IHRpbGUgKHNjcmVlbi10aWxlKS4gKi9cbiAgeXQgICAgICAgPSB0aGlzLnByb3AoWzFdKTtcblxuICAvKiogOC1iaXQgc2NyZWVuICh5eCkuICovXG4gIHNjcmVlbiAgID0gdGhpcy5wcm9wKFsxLCAweGYwXSwgWzAsIDB4ZjAsIDRdKTtcbiAgLyoqIDgtYml0IHRpbGUgd2l0aGluIHRoZSBzY3JlZW4gKHl4KS4gKi9cbiAgdGlsZSAgICAgPSB0aGlzLnByb3AoWzEsIDB4MGYsIC00XSwgWzAsIDB4MGZdKTtcbiAgLyoqIDE2LWJpdCBjb29yZGluYXRlIHdpdGhpbiB0aGUgc2NyZWVuICh5MHgwKS4gKi9cbiAgY29vcmQgICAgPSB0aGlzLnByb3AoWzEsIDB4MGYsIC0xMl0sIFswLCAweDBmLCAtNF0pO1xuXG4gIC8qKiBEZXN0aW5hdGlvbiBsb2NhdGlvbiBJRC4gKi9cbiAgZGVzdCAgICAgPSB0aGlzLnByb3AoWzJdKTtcblxuICAvKiogRGVzdGluYXRpb24gZW50cmFuY2UgaW5kZXguICovXG4gIGVudHJhbmNlID0gdGhpcy5wcm9wKFszXSk7XG5cbiAgaXNTZWFtbGVzcyh0aGlzOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLmVudHJhbmNlICYgMHgyMCk7XG4gIH1cblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiBgRXhpdCAke3RoaXMuaGV4KCl9OiAoJHtoZXgodGhpcy55KX0sICR7aGV4KHRoaXMueCl9KSA9PiAke1xuICAgICAgICAgICAgdGhpcy5kZXN0fToke3RoaXMuZW50cmFuY2V9YDtcbiAgfVxufVxuXG4vKiogTWFwcGluZyBmcm9tIHNjcmVlbiBwb3NpdGlvbiB0byBmbGFnIElELiAqL1xuZXhwb3J0IGNsYXNzIEZsYWcgZXh0ZW5kcyBEYXRhVHVwbGUge1xuICBzdGF0aWMgc2l6ZSA9IDI7XG5cbiAgLyoqIE1hcHBlZCBmbGFnLCBhbHdheXMgYmV0d2VlbiAkMjAwIGFuZCAkMmZmLiAqL1xuICBnZXQgZmxhZygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmRhdGFbMF0gfCAweDIwMDtcbiAgfVxuICBzZXQgZmxhZyhmOiBudW1iZXIpIHtcbiAgICBpZiAoKGYgJiB+MHhmZikgIT09IDB4MjAwKSB0aHJvdyBuZXcgRXJyb3IoYGJhZCBmbGFnOiAke2hleChmKX1gKTtcbiAgICB0aGlzLmRhdGFbMF0gPSBmICYgMHhmZjtcbiAgfVxuXG4gIC8qKiAxMS1iaXQgeC1jb29yZGluYXRlIG9mIHRvcC1sZWZ0IHBpeGVsIG9mIHRoZSBmbGFnZ2VkIHNjcmVlbi4gKi9cbiAgeCAgICAgID0gdGhpcy5wcm9wKFsxLCAweDA3LCAtOF0pO1xuICAvKiogMy1iaXQgeC1jb29yZGluYXRlIG9mIGZsYWdnZWQgc2NyZWVuLiAqL1xuICB4cyAgICAgPSB0aGlzLnByb3AoWzEsIDB4MDddKTtcblxuICAvKiogMTItYml0IHktY29vcmRpbmF0ZSBvZiB0b3AtbGVmdCBwaXhlbCBvZiB0aGUgZmxhZ2dlZCBzY3JlZW4uICovXG4gIHkgICAgICA9IHRoaXMucHJvcChbMSwgMHhmMCwgLTRdKTtcbiAgLyoqIDQtYml0IHktY29vcmRpbmF0ZSBvZiBmbGFnZ2VkIHNjcmVlbi4gKi9cbiAgeXMgICAgID0gdGhpcy5wcm9wKFsxLCAweGYwLCA0XSk7XG5cbiAgLyoqIDgtYml0IHNjcmVlbiAoeXgpLiAqL1xuICBzY3JlZW4gPSB0aGlzLnByb3AoWzFdKTtcblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiBgRmxhZyAke3RoaXMuaGV4KCl9OiAke2hleCh0aGlzLnNjcmVlbil9IEAgJHtoZXgodGhpcy5mbGFnKX1gO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBQaXQgZXh0ZW5kcyBEYXRhVHVwbGUge1xuICBzdGF0aWMgc2l6ZSA9IDQ7XG5cbiAgLyoqIDMtYml0IHgtY29vcmRpbmF0ZSBvZiBwaXQncyBzY3JlZW4gb24gdGhpcyBtYXAuICovXG4gIGZyb21YcyA9IHRoaXMucHJvcChbMSwgMHg3MCwgNF0pO1xuICAvKiogMy1iaXQgeC1jb29yZGluYXRlIG9mIGRlc3RpbmF0aW9uIHNjcmVlbiBvbiBkZXN0aW5hdGlvbiBtYXAuICovXG4gIHRvWHMgICA9IHRoaXMucHJvcChbMSwgMHgwN10pO1xuXG4gIC8qKiA0LWJpdCB5LWNvb3JkaW5hdGUgb2YgcGl0J3Mgc2NyZWVuIG9uIHRoaXMgbWFwLiAqL1xuICBmcm9tWXMgPSB0aGlzLnByb3AoWzMsIDB4ZjAsIDRdKTtcbiAgLyoqIDQtYml0IHktY29vcmRpbmF0ZSBvZiBkZXN0aW5hdGlvbiBzY3JlZW4gb24gZGVzdGluYXRpb24gbWFwLiAqL1xuICB0b1lzICAgPSB0aGlzLnByb3AoWzMsIDB4MGZdKTtcblxuICAvKiogOC1iaXQgeXggb2YgXCJmcm9tXCIgc2NyZWVuLiAqL1xuICBmcm9tU2NyZWVuID0gdGhpcy5wcm9wKFszLCAweGYwXSwgWzEsIDB4NzAsIDRdKTtcbiAgLyoqIDgtYml0IHl4IG9mIFwidG9cIiBzY3JlZW4uICovXG4gIHRvU2NyZWVuID0gdGhpcy5wcm9wKFszLCAweDBmLCAtNF0sIFsxLCAweDA3XSk7XG5cbiAgLyoqIExvY2F0aW9uIElEIG9mIGRlc3RpbmF0aW9uLiAqL1xuICBkZXN0ICAgPSB0aGlzLnByb3AoWzBdKTtcblxuICB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiBgUGl0ICR7dGhpcy5oZXgoKX06ICgke2hleCh0aGlzLmZyb21Ycyl9LCAke2hleCh0aGlzLmZyb21Zcyl9KSA9PiAke1xuICAgICAgICAgICAgaGV4KHRoaXMuZGVzdCl9Oigke2hleCh0aGlzLnRvWHMpfSwgJHtoZXgodGhpcy50b1lzKX0pYDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgU3Bhd24gZXh0ZW5kcyBEYXRhVHVwbGUge1xuICBzdGF0aWMgc2l6ZSA9IDQ7XG5cbiAgLy8gZ2V0IHkoKTogbnVtYmVyICB7IHJldHVybiBTUEFXTl9ZLmdldCh0aGlzKTsgfVxuICAvLyBzZXQgeSh5OiBudW1iZXIpIHsgU1BBV05fWS5zZXQodGhpcywgeSk7IH1cblxuICAvKiogMTItYml0IHktY29vcmRpbmF0ZSBvZiBzcGF3biBwaXhlbC4gKi9cbiAgeSAgICAgID0gdGhpcy5wcm9wKFswLCAweGZmLCAtNF0pO1xuICAvKiogOC1iaXQgeS1jb29yZGluYXRlIG9mIHNwYXduIHRpbGUuICovXG4gIHl0ICAgICA9IHRoaXMucHJvcChbMF0pO1xuXG4gIC8qKiAxMS1iaXQgeC1jb29yZGluYXRlIG9mIHNwYXduIHBpeGVsLiAqL1xuICB4ICAgICAgPSB0aGlzLnByb3AoWzEsIDB4N2YsIC00XSwgWzIsIDB4NDAsIDNdKTtcbiAgLyoqIDctYml0IHgtY29vcmRpbmF0ZSBvZiBzcGF3biB0aWxlLiAqL1xuICB4dCAgICAgPSB0aGlzLnByb3AoWzEsIDB4N2ZdKTtcblxuICAvKiogVHJ1ZSBmb3IgdGltZWQgcmVzcGF3biwgZmFsc2UgZm9yIGluaXRpYWwgc3Bhd24uICovXG4gIHRpbWVkICA9IHRoaXMuYm9vbGVhblByb3AoMSwgNyk7XG5cbiAgLyoqIDgtYml0IHNjcmVlbiBjb29yZGluYXRlICh5eCkuICovXG4gIHNjcmVlbiA9IHRoaXMucHJvcChbMCwgMHhmMF0sIFsxLCAweDcwLCA0XSk7XG4gIC8qKiA4LWJpdCB0aWxlIGNvb3JkaW5hdGUgd2l0aGluIHRoZSBzY3JlZW4gKHl4KS4gKi9cbiAgdGlsZSAgID0gdGhpcy5wcm9wKFswLCAweDBmLCAtNF0sIFsxLCAweDBmXSk7XG4gIC8qKiAxNi1iaXQgcGl4ZWwgY29vcmRpbmF0ZSB3aXRoaW4gdGhlIHNjcmVlbiAoeTB4eCkuICovXG4gIGNvb3JkICA9IHRoaXMucHJvcChbMCwgMHhmZiwgLThdLCBbMSwgMHg3ZiwgLTRdLCBbMiwgMHg0MCwgM10pO1xuXG4gIC8qKiBTcGF3biB0eXBlICgwLi40KS4gKi9cbiAgdHlwZSAgID0gdGhpcy5wcm9wKFsyLCAweDA3XSk7XG4gIC8qKiBTcGF3bmVkIG9iamVjdCBJRCAoZXhhY3QgaW50ZXJwcmV0YXRpb24gZGVwZW5kcyBvbiB0eXBlKS4gKi9cbiAgaWQgICAgID0gdGhpcy5wcm9wKFszXSk7XG5cbiAgLyoqIFBhdHRlcm4gYmFuayBzaGlmdCAoMCBvciAxKSB0byBzdG9yZSBpbiAzODAseDoyMC4gKi9cbiAgcGF0dGVybkJhbmsgPSB0aGlzLnByb3AoWzIsIDB4ODAsIDddKTtcblxuLy8gcGF0dGVybkJhbms6IHtnZXQodGhpczogYW55KTogbnVtYmVyIHsgcmV0dXJuIHRoaXMuZGF0YVsyXSA+Pj4gNzsgfSxcbi8vICAgICAgICAgICAgICAgc2V0KHRoaXM6IGFueSwgdjogbnVtYmVyKSB7IGlmICh0aGlzLmRhdGFbM10gPT09IDEyMCkgZGVidWdnZXI7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodikgdGhpcy5kYXRhWzJdIHw9IDB4ODA7IGVsc2UgdGhpcy5kYXRhWzJdICY9IDB4N2Y7IH19LFxuXG4gIC8qKiBXaGV0aGVyIHRoaXMgc3Bhd24gaXMgYWN0aXZlIChpbmFjdGl2ZSBpbmRpY2F0ZWQgYnkgJGZlIGluIFswXSkuICovXG4gIGdldCB1c2VkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmRhdGFbMF0gIT09IDB4ZmU7XG4gIH1cbiAgc2V0IHVzZWQodXNlZDogYm9vbGVhbikge1xuICAgIHRoaXMuZGF0YVswXSA9IHVzZWQgPyAwIDogMHhmZTtcbiAgfVxuXG4gIC8qKiBPYmplY3QgSUQgb2YgbW9uc3RlciBzcGF3biAoc2hpZnRlZCBieSAkNTAgZnJvbSBJRCkuICovXG4gIGdldCBtb25zdGVySWQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gKHRoaXMuaWQgKyAweDUwKSAmIDB4ZmY7XG4gIH1cbiAgc2V0IG1vbnN0ZXJJZChpZDogbnVtYmVyKSB7XG4gICAgdGhpcy5pZCA9IChpZCAtIDB4NTApICYgMHhmZjtcbiAgfVxuXG4gIC8qKiBXaGV0aGVyIHRoaXMgc3Bhd24gaXMgYSB0cmVhc3VyZSBjaGVzdCAobm90ZTogaW5jbHVkZXMgbWltaWNzKS4gKi9cbiAgaXNDaGVzdCgpOiBib29sZWFuIHsgcmV0dXJuIHRoaXMudHlwZSA9PT0gMiAmJiB0aGlzLmlkIDwgMHg4MDsgfVxuICAvKiogV2hldGhlciB0aGlzIHNwYXduIGlzIGFuIGludmlzaWJsZSB0cmVhc3VyZSBjaGVzdC4gKi9cbiAgaXNJbnZpc2libGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNDaGVzdCgpICYmIEJvb2xlYW4odGhpcy5kYXRhWzJdICYgMHgyMCk7XG4gIH1cbiAgLyoqIFdoZXRoZXIgdGhpcyBzcGF3biBpcyBhIHRyaWdnZXIgKHR5cGUgMiwgdXBwZXIgSURzKS4gKi9cbiAgaXNUcmlnZ2VyKCk6IGJvb2xlYW4geyByZXR1cm4gdGhpcy50eXBlID09PSAyICYmIHRoaXMuaWQgPj0gMHg4MDsgfVxuICAvKiogV2hldGhlciB0aGlzIHNwYXduIGlzIGFuIE5QQyAodHlwZSAxLCBsb3dlciBJRHMpLiAqL1xuICBpc05wYygpOiBib29sZWFuIHsgcmV0dXJuIHRoaXMudHlwZSA9PT0gMSAmJiB0aGlzLmlkIDwgMHhjMDsgfVxuICAvKiogV2hldGhlciB0aGlzIHNwYXduIGlzIGEgYm9zcyAodHlwZSAxLCB1cHBlciBJRHMpLiAqL1xuICBpc0Jvc3MoKTogYm9vbGVhbiB7IHJldHVybiB0aGlzLnR5cGUgPT09IDEgJiYgdGhpcy5pZCA+PSAweGMwOyB9XG4gIC8qKiBXaGV0aGVyIHRoaXMgc3Bhd24gaXMgYSBtb25zdGVyICh0eXBlIDApLiAqL1xuICBpc01vbnN0ZXIoKTogYm9vbGVhbiB7IHJldHVybiB0aGlzLnR5cGUgPT09IDA7IH1cbiAgLyoqIFdoZXRoZXIgdGhpcyBzcGF3biBpcyBhIHdhbGwgaGl0Ym94ICh0eXBlIDMsIG1vc3RseSkuICovXG4gIGlzV2FsbCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLnR5cGUgPT09IDMgJiYgKHRoaXMuaWQgPCA0IHx8ICh0aGlzLmRhdGFbMl0gJiAweDIwKSkpO1xuICB9XG4gIC8qKiBXaGV0aGVyIHRoaXMgc3Bhd24gaXMgYSBzaG9vdGluZyB3YWxsICh1c2VzIGN1c3RvbSBsb2dpYykuICovXG4gIGlzU2hvb3RpbmdXYWxsKGxvY2F0aW9uOiBMb2NhdGlvbik6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzV2FsbCgpICYmXG4gICAgICAgICEhKHRoaXMuZGF0YVsyXSAmIDB4MjAgPyB0aGlzLmRhdGFbMl0gJiAweDEwIDpcbiAgICAgICAgICAgbG9jYXRpb24uaWQgPT09IDB4OGYgfHwgbG9jYXRpb24uaWQgPT09IDB4YTgpO1xuICB9XG4gIC8qKiBUeXBlIG9mIHdhbGwgKGkuZS4gd2FsbC9icmlkZ2UpIG9yIGVtcHR5IGlmIG5laXRoZXIuICovXG4gIHdhbGxUeXBlKCk6ICcnIHwgJ3dhbGwnIHwgJ2JyaWRnZScge1xuICAgIGlmICh0aGlzLnR5cGUgIT09IDMpIHJldHVybiAnJztcbiAgICBjb25zdCBvYmogPSB0aGlzLmRhdGFbMl0gJiAweDIwID8gdGhpcy5pZCA+Pj4gNCA6IHRoaXMuaWQ7XG4gICAgaWYgKG9iaiA+PSA0KSByZXR1cm4gJyc7XG4gICAgcmV0dXJuIG9iaiA9PT0gMiA/ICdicmlkZ2UnIDogJ3dhbGwnO1xuICB9XG4gIC8qKiBFbGVtZW50IG9mIHdhbGwgKDAuLjMpIG9yIC0xIGlmIG5vdCBhIHdhbGwuICovXG4gIHdhbGxFbGVtZW50KCk6IG51bWJlciB7XG4gICAgaWYgKCF0aGlzLmlzV2FsbCgpKSByZXR1cm4gLTE7XG4gICAgcmV0dXJuIHRoaXMuaWQgJiAzO1xuICB9XG5cbiAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYFNwYXduICR7dGhpcy5oZXgoKX06ICgke2hleCh0aGlzLngpfSwgJHtoZXgodGhpcy55KX0pICR7XG4gICAgICAgICAgICB0aGlzLnRpbWVkID8gJ3RpbWVkJyA6ICdmaXhlZCd9ICR7dGhpcy50eXBlfToke2hleCh0aGlzLmlkKX1gO1xuICB9XG59XG5cbmludGVyZmFjZSBMb2NhdGlvbiB7XG4gIHJlYWRvbmx5IGlkOiBudW1iZXI7XG59XG4iXX0=