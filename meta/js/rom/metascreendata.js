import { seq } from './util.js';
export const featureMask = {
    'pit': 0x1,
    'arena': 0x2,
    'spikes': 0x4,
    'bridge': 0x8,
    'wall': 0x10,
    'stairs': 0x20,
    'stair:up': 0x40,
    'stair:down': 0x80,
    'empty': 0x100,
    'portoa1': 0x200,
    'portoa2': 0x400,
    'portoa3': 0x800,
    'lake': 0x1000,
    'overBridge': 0x2000,
    'underBridge': 0x4000,
    'whirlpool': 0x8000,
    'lighthouse': 65536,
    'cabin': 131072,
    'windmill': 262144,
    'altar': 524288,
    'pyramid': 1048576,
    'crypt': 2097152,
    'consolidate': 4194304,
};
export function icon(arr) {
    if (arr.length != 1)
        throw new Error('Bad icon input');
    const str = arr[0];
    const lines = str.split('\n');
    const full = lines.slice(1).map(l => l.replace(/^\s*\||\|\s*$/g, ''));
    const short = /\S/.test(lines[0]) ? lines[0][0] : full[1][1];
    return { short, full: [full[0], full[1], full[2]] };
}
export function upStair(tile, width = 2) {
    const y = tile >>> 4;
    const x = tile & 0xf;
    if (width === 1) {
        const dy = y === 0xe ? 0x2800 : 0x1800;
        const entrance = ((y << 12) + dy) | ((x << 4) + 0x0008);
        return {
            type: 'stair:up',
            dir: 2,
            entrance,
            exits: [tile],
        };
    }
    const entrance = y << 12 | ((x << 4) + (width << 3));
    return {
        type: 'stair:up',
        dir: 0,
        entrance,
        exits: seq(width, i => tile - 0x10 + i),
    };
}
export function downStair(tile, width = 2) {
    const y = tile >>> 4;
    const x = tile & 0xf;
    if (width === 1) {
        const entrance = ((y << 12) - 0x0800) | ((x << 4) + 0x0008);
        return {
            type: 'stair:down',
            dir: 2,
            entrance,
            exits: [tile],
            allowedExits: [tile + 16, tile - 16],
        };
    }
    const entrance = y << 12 | 0x0f00 | ((x << 4) + (width << 3));
    return {
        type: 'stair:down',
        dir: 2,
        entrance,
        exits: seq(width, i => tile + 0x10 + i),
        allowedExits: [...seq(width, i => tile + 0x20 + i),
            ...seq(width, i => tile + i)],
    };
}
export function cave(tile, type = 'cave') {
    return { ...upStair(tile + 16), type };
}
export function door(tile, type = 'door') {
    return { ...upStair(tile, 1), type };
}
export function waterfallCave(tile) {
    const y = tile >>> 4;
    const x = tile & 0xf;
    return {
        type: 'cave',
        dir: 0,
        entrance: y << 12 | x << 4 | 0xf,
        exits: [tile - 0xf, tile + 1],
    };
}
export function topEdge({ left = 7, width = 2, top = 2, manual = false } = {}) {
    return {
        type: 'edge:top',
        manual,
        dir: 0,
        entrance: ((top + 1) << 12) | ((left << 4) + (width << 3)),
        exits: seq(width, i => (top << 4) | (i + left)),
    };
}
export function bottomEdge({ left = 7, width = 2, shift = 0, type = 'edge:bottom', manual = false } = {}) {
    return {
        type, manual,
        dir: 2,
        entrance: 57088 | ((left << 4) + (width << 3) + 16 * shift),
        exits: seq(width, i => 0xe0 | (i + left)),
    };
}
export function bottomEdgeHouse({ left = 7, width = 2, shift = 0 } = {}) {
    return {
        type: 'edge:bottom',
        dir: 2,
        entrance: 44800 | ((left << 4) + (width << 3) + 16 * shift),
        exits: seq(width, i => 0xb0 | (i + left)),
    };
}
export function leftEdge({ top = 7, height = 2, shift = 0 } = {}) {
    return {
        type: 'edge:left',
        dir: 1,
        entrance: ((top << 12) + ((16 * shift) << 8) + (height << 11)) | 0x10,
        exits: seq(height, i => (i + top) << 4),
    };
}
export function rightEdge({ top = 7, height = 2 } = {}) {
    return {
        type: 'edge:right',
        dir: 3,
        entrance: ((top << 12) + (height << 11)) | 0xef,
        exits: seq(height, i => (i + top) << 4 | 0xf),
    };
}
export function seamlessUp(tile, width = 2) {
    return {
        type: 'seamless:up',
        dir: 0,
        get entrance() { throw new Error('does not make sense'); },
        exits: seq(width, i => (tile + i)),
    };
}
export function seamlessDown(tile, width = 2) {
    return {
        type: 'seamless:down',
        dir: 2,
        get entrance() { throw new Error('does not make sense'); },
        exits: seq(width, i => (tile + i)),
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YXNjcmVlbmRhdGEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvcm9tL21ldGFzY3JlZW5kYXRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE9BQU8sRUFBQyxHQUFHLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFxRjlCLE1BQU0sQ0FBQyxNQUFNLFdBQVcsR0FBRztJQUV6QixLQUFLLEVBQUUsR0FBRztJQUNWLE9BQU8sRUFBRSxHQUFHO0lBQ1osUUFBUSxFQUFFLEdBQUc7SUFDYixRQUFRLEVBQUUsR0FBRztJQUNiLE1BQU0sRUFBRSxJQUFJO0lBQ1osUUFBUSxFQUFFLElBQUk7SUFDZCxVQUFVLEVBQUUsSUFBSTtJQUNoQixZQUFZLEVBQUUsSUFBSTtJQUNsQixPQUFPLEVBQUUsS0FBSztJQUNkLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLE1BQU0sRUFBRSxNQUFNO0lBQ2QsWUFBWSxFQUFFLE1BQU07SUFDcEIsYUFBYSxFQUFFLE1BQU07SUFDckIsV0FBVyxFQUFFLE1BQU07SUFDbkIsWUFBWSxFQUFFLEtBQVE7SUFDdEIsT0FBTyxFQUFFLE1BQVE7SUFDakIsVUFBVSxFQUFFLE1BQVE7SUFDcEIsT0FBTyxFQUFFLE1BQVE7SUFDakIsU0FBUyxFQUFFLE9BQVM7SUFDcEIsT0FBTyxFQUFFLE9BQVM7SUFDbEIsYUFBYSxFQUFFLE9BQVM7Q0FDaEIsQ0FBQztBQWNYLE1BQU0sVUFBVSxJQUFJLENBQUMsR0FBeUI7SUFDNUMsSUFBSSxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUM7UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDdkQsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRW5CLE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7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QUFHLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSTtRQUMvQyxLQUFLLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUM7S0FDOUMsQ0FBQztBQUNKLENBQUM7QUFHRCxNQUFNLFVBQVUsVUFBVSxDQUFDLElBQVksRUFBRSxLQUFLLEdBQUcsQ0FBQztJQUNoRCxPQUFPO1FBQ0wsSUFBSSxFQUFFLGFBQWE7UUFDbkIsR0FBRyxFQUFFLENBQUM7UUFDTixJQUFJLFFBQVEsS0FBYSxNQUFNLElBQUksS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xFLEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDbkMsQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLFVBQVUsWUFBWSxDQUFDLElBQVksRUFBRSxLQUFLLEdBQUcsQ0FBQztJQUNsRCxPQUFPO1FBQ0wsSUFBSSxFQUFFLGVBQWU7UUFDckIsR0FBRyxFQUFFLENBQUM7UUFDTixJQUFJLFFBQVEsS0FBYSxNQUFNLElBQUksS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xFLEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDbkMsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge01ldGFzY3JlZW59IGZyb20gJy4vbWV0YXNjcmVlbi5qcyc7XG5pbXBvcnQge1NjcmVlbkZpeH0gZnJvbSAnLi9zY3JlZW5maXguanMnO1xuaW1wb3J0IHtNZXRhdGlsZXNldHN9IGZyb20gJy4vbWV0YXRpbGVzZXQuanMnO1xuaW1wb3J0IHtzZXF9IGZyb20gJy4vdXRpbC5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcblxuLyoqXG4gKiBNZXRhZGF0YSBhYm91dCB0aGUgbWV0YXNjcmVlbi4gIEJlY2F1c2UgdGhlc2UgYXJlIGNyZWF0ZWQgcGVyIE1ldGFzY3JlZW5zXG4gKiBpbnN0YW5jZSwgdGhleSBjYW4gYWN0dWFsbHkgYmUgbXV0YXRlZCBhcyBuZWVkZWQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTWV0YXNjcmVlbkRhdGEge1xuICAvKipcbiAgICogSWYgdGhlIHNjcmVlbiBleGlzdHMgb3IgaXMgc2hhcmVkIHdpdGggYSBzY3JlZW4gaW4gdGhlIHZhbmlsbGEgcm9tLCB0aGVuXG4gICAqIHRoaXMgaXMgdGhlIHNjcmVlbiBJRCAoMC4uMTAyKS4gIE90aGVyd2lzZSwgaXQgaXMgYSBzcGFyc2UgbmVnYXRpdmUgbnVtYmVyXG4gICAqIHNoYXJlZCBieSBhbGwgdGhlIHNjcmVlbnMgdGhhdCB3aWxsIHVsdGltYXRlbHkgaGF2ZSB0aGUgc2FtZSBJRC5cbiAgICovXG4gIHJlYWRvbmx5IGlkOiBudW1iZXI7XG4gIC8qKiBSZXByZXNlbnRhdGl2ZSBpY29uIGZvciBkZWJ1ZyBwdXJwb3Nlcy4gKi9cbiAgaWNvbj86IEljb247XG4gIC8qKiBMaXN0IG9mIHRpbGVzZXRzIHRoaXMgc2NyZWVuIGFwcGVhcnMgaW4uICovXG4gIHRpbGVzZXRzOiB7W25hbWUgaW4ga2V5b2YgTWV0YXRpbGVzZXRzXT86IHtcbiAgICAvKiogRml4ZXMgbmVlZGVkIGJlZm9yZSBzY3JlZW4gaXMgdXNhYmxlIGluIHRoZSB0aWxlc2V0LiAqL1xuICAgIHJlcXVpcmVzPzogU2NyZWVuRml4W10sXG4gICAgLyoqID8/PyAqL1xuICAgIHR5cGU/OiBzdHJpbmcsIC8vIGZvciB0b3duP1xuICB9fTtcbiAgLyoqIExpc3Qgb2YgZmVhdHVyZXMgcHJlc2VudC4gKi9cbiAgZmVhdHVyZT86IEZlYXR1cmVbXTtcbiAgLyoqIExpc3Qgb2YgZXhpdCBzcGVjcy4gKi9cbiAgZXhpdHM/OiByZWFkb25seSBDb25uZWN0aW9uW107XG4gIC8qKiBTdHJpbmcgKGxlbmd0aCA0KSBvZiBlZGdlIHR5cGVzIGZvciBtYXRjaGluZzogdXAsIGxlZnQsIGRvd24sIHJpZ2h0LiAqL1xuICBlZGdlcz86IHN0cmluZztcbiAgLyoqXG4gICAqIFN0cmluZyBvZiBjb25uZWN0ZWQgYWNjZXNzIHBvaW50cyBmb3Igcm91dGluZywgZ3JvdXBlZCBieSBjb25uZWN0aW9uIHR5cGUuXG4gICAqIFBvaW50cyBhcmUgaGV4IGRpZ2l0cyBbMTIzXSBmb3IgdG9wIGVkZ2UsIFs1NjddIGZvciBsZWZ0LCBbOWFiXSBmb3IgYm90dG9tLFxuICAgKiBvciBbZGVmXSBmb3IgcmlnaHQgZWRnZS4gIFNlcGFyYXRvcnMgYXJlICd8JyBmb3IgaW1wYXNzaWJsZSwgJz0nIGZvciB3YWxsLFxuICAgKiAnOicgZm9yIHdhdGVyIChpLmUuIGZsaWdodCByZXF1aXJlZCksIGFuZCAnLScgZm9yIGJyaWRnZS4gIEdlbmVyYWxseSBvbmx5XG4gICAqIHRoZSBtaWRkbGUgbnVtYmVyIGlzIHVzZWQgZm9yIGVhY2ggZWRnZSAoMjZhZSkgYnV0IGZvciByaXZlcnMgYW5kIGxhYnlyaW50aFxuICAgKiB0aWxlc2V0cywgdGhlIG90aGVyIG51bWJlcnMgYXJlIHVzZWQgYXMgd2VsbCwgY292ZXJpbmcgdGhlIGVkZ2VzIGxpa2Ugc29cbiAgICogYGBgXG4gICAqICAgICAuMTIzLlxuICAgKiAgICAgNSAgIGRcbiAgICogICAgIDYgICBlXG4gICAqICAgICA3ICAgZlxuICAgKiAgICAgLjlhYi5cbiAgICogYGBgXG4gICAqIFRodXMgdGhlIDQgYml0IGluZGljYXRlcyBhIHZlcnRpY2FsIGVkZ2UgYW5kIHRoZSA4IGJpdCBpbmRpY2F0ZXMgdGhhdCBpdCdzXG4gICAqIHRoZSBjb3JyZXNwb25kaW5nIGVkZ2Ugb24gdGhlIG5leHQgdGlsZS5cbiAgICovXG4gIGNvbm5lY3Q/OiBzdHJpbmc7XG4gIC8qKiBUaWxlICh5eCkgdG8gcGxhY2UgdGhlIHdhbGwvYnJpZGdlIGhpdGJveCwgaWYgcHJlc2VudC4gKi9cbiAgd2FsbD86IG51bWJlcjtcbiAgLyoqIEluZm9ybWF0aW9uIGFib3V0IGFueSBtb3ZpbmcgcGxhdGZvcm0gcGxhdGZvcm0uICovXG4gIHBsYXRmb3JtPzoge1xuICAgIC8qKiBUeXBlIG9mIHBsYXRmb3JtLiAqL1xuICAgIHR5cGU6ICdob3Jpem9udGFsJyB8ICd2ZXJ0aWNhbCcsXG4gICAgLyoqIDE2LWJpdCBzY3JlZW4gY29vcmRpbmF0ZXMgKHl5eHgpIG9mIHBsYXRmb3JtIHNwYXduIHBvc2l0aW9uLiAqL1xuICAgIGNvb3JkOiBudW1iZXIsXG4gIH07XG4gIC8qKlxuICAgKiBQb2ludHMgb2YgaW50ZXJlc3Qgb24gdGhpcyBzY3JlZW4uICBFYWNoIGVudHJ5IGlzIGEgcHJpb3JpdHkgKDEgaXMgbW9zdFxuICAgKiByZWxldmFudCwgNSBpcyBsZWFzdCksIGZvbGxvd2VkIGJ5IGEgZGVsdGEteSBhbmQgYSBkZWx0YS14IGluIHBpeGVsc1xuICAgKiBtZWFzdXJlZCBmcm9tIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhlIHNjcmVlbi4gIFRoZSBkZWx0YXMgbWF5IGJlXG4gICAqIG5lZ2F0aXZlIG9yIGdyZWF0ZXIgdGhhbiAweGZmLCBpbmRpY2F0aW5nIHRoYXQgdGhlIFBPSSBpcyBhY3R1YWxseSBvbiBhXG4gICAqIG5laWdoYm9yaW5nIHNjcmVlbi4gIERlZmF1bHQgZHk9NzAgYW5kIGR4PTc4LlxuICAgKi9cbiAgcG9pPzogUmVhZG9ubHlBcnJheTxyZWFkb25seSBbbnVtYmVyLCBudW1iZXI/LCBudW1iZXI/XT4sXG5cbiAgLyoqIFVwZGF0ZXMgdG8gYXBwbHkgd2hlbiBhcHBseWluZyB0aGUgZ2l2ZW4gZml4LiAqL1xuICB1cGRhdGU/OiBSZWFkb25seUFycmF5PHJlYWRvbmx5IFtTY3JlZW5GaXgsIFNjcmVlblVwZGF0ZV0+O1xuXG4gIC8qKiBXaGV0aGVyIGEgc3BlY2lhbCBmbGFnIGlzIG5lZWRlZCBmb3IgdGhpcyBzY3JlZW4uICovXG4gIGZsYWc/OiAnYWx3YXlzJyB8ICdjYWxtJyB8ICdjdXN0b206ZmFsc2UnIHwgJ2N1c3RvbTp0cnVlJzsgLy8gfCAnYm9zcyc7XG5cbiAgLyoqXG4gICAqIExpc3Qgb2YgZGlyZWN0aW9ucyB0aGUgb3RoZXIgc2NyZWVuIG1heSBiZSBpbiByZWxhdGlvbiB0byB0aGlzLlxuICAgKiBUaGlzIGlzIG9uIHRvcCBvZiBhbnl0aGluZyB0aGF0IG1hdGNoZXMgb24gZWRnZSB0eXBlcywgYW5kIGlzXG4gICAqIHBhcnRpY3VsYXJseSB1c2VmdWwgZm9yIG1hdGNoaW5nICcqJyBlZGdlIHR5cGVzLlxuICAgKi9cbiAgYWxsb3dlZD86IChzOiBNZXRhc2NyZWVuKSA9PiBBcnJheTwwfDF8MnwzPjtcblxuICAvKiogQ29uZGl0aW9ucyBmb3IgbWF0Y2hpbmcgdGhpcyB0aWxlLiAqL1xuICBtYXRjaD86IChyZWFjaGFibGU6IChkeTogbnVtYmVyLCBkeDogbnVtYmVyKSA9PiBib29sZWFuLFxuICAgICAgICAgICBmbGFnOiBib29sZWFuKSA9PiBib29sZWFuO1xufVxuXG5leHBvcnQgdHlwZSBTY3JlZW5VcGRhdGUgPSAoczogTWV0YXNjcmVlbiwgc2VlZDogbnVtYmVyLCByb206IFJvbSkgPT4gYm9vbGVhbjtcblxuZXhwb3J0IGNvbnN0IGZlYXR1cmVNYXNrID0ge1xuICAvLyBUT0RPIC0gY2F2ZT8gZm9ydHJlc3M/IGVkZ2U/ICB3ZSBhbHJlYWR5IGhhdmUgY29ubmVjdGlvbnMgdG8gdGVsbCB1cy4uLlxuICAncGl0JzogMHgxLFxuICAnYXJlbmEnOiAweDIsXG4gICdzcGlrZXMnOiAweDQsXG4gICdicmlkZ2UnOiAweDgsXG4gICd3YWxsJzogMHgxMCxcbiAgJ3N0YWlycyc6IDB4MjAsXG4gICdzdGFpcjp1cCc6IDB4NDAsIC8vIE5PVEU6IG5vdCBhY3R1YWxseSBsaXN0ZWQsIGluc3RlYWQgcHVsbGVkIGZyb20gZXhpdFR5cGVcbiAgJ3N0YWlyOmRvd24nOiAweDgwLFxuICAnZW1wdHknOiAweDEwMCxcbiAgJ3BvcnRvYTEnOiAweDIwMCwgLy8gVE9ETyAtIGNvbnNpZGVyIGEgc2luZ2xlIFwidW5pcXVlXCIgbWFzayBoZXJlP1xuICAncG9ydG9hMic6IDB4NDAwLCAvLyBPciAtIGFsbCAyMCBjb21iaW5hdGlvbnMgb2YgMy82IGJpdHM6IG5vIG11dHVhbCBzdWJzZXRcbiAgJ3BvcnRvYTMnOiAweDgwMCwgLy8gNyxiLGQsZSwxMywxNSwxNiwxOSwxYSwxYywyMywyNSwyNiwyOSwyYSwyYywzMSwzMiwzNCwzOFxuICAnbGFrZSc6IDB4MTAwMCxcbiAgJ292ZXJCcmlkZ2UnOiAweDIwMDAsXG4gICd1bmRlckJyaWRnZSc6IDB4NDAwMCxcbiAgJ3doaXJscG9vbCc6IDB4ODAwMCxcbiAgJ2xpZ2h0aG91c2UnOiAweDFfMDAwMCxcbiAgJ2NhYmluJzogMHgyXzAwMDAsXG4gICd3aW5kbWlsbCc6IDB4NF8wMDAwLFxuICAnYWx0YXInOiAweDhfMDAwMCxcbiAgJ3B5cmFtaWQnOiAweDEwXzAwMDAsXG4gICdjcnlwdCc6IDB4MjBfMDAwMCxcbiAgJ2NvbnNvbGlkYXRlJzogMHg0MF8wMDAwLCAvLyBpbmRpY2F0ZXMgd2UgY2FuIGNvbnNvbGlkYXRlIHRoaXMgc2NyZWVuLlxufSBhcyBjb25zdDtcblxuZXhwb3J0IHR5cGUgRmVhdHVyZSA9IGtleW9mIHR5cGVvZiBmZWF0dXJlTWFzaztcbiAgLy8gJ3BpdCcgfCAnYXJlbmEnIHwgJ3NwaWtlcycgfCAnYnJpZGdlJyB8ICd3YWxsJyB8ICdzdGFpcnMnIHwgJ2VtcHR5JyB8XG4gIC8vICdwb3J0b2ExJyB8ICdwb3J0b2EyJyB8ICdwb3J0b2EzJyB8IC8vIHBhdGggZnJvbSBzYWJyZSB0byBwb3J0b2FcbiAgLy8gJ2xha2UnIHwgJ292ZXJCcmlkZ2UnIHwgJ3VuZGVyQnJpZGdlJyB8ICd3aGlybHBvb2wnIHxcbiAgLy8gJ2xpZ2h0aG91c2UnIHwgJ2NhYmluJyB8ICd3aW5kbWlsbCcgfCAnYWx0YXInIHwgJ3B5cmFtaWQnIHwgJ2NyeXB0JyB8XG4gIC8vICdjb25zb2xpZGF0ZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSWNvbiB7XG4gIHNob3J0OiBzdHJpbmc7IC8vIHNpbmdsZSBjaGFyYWN0ZXJcbiAgZnVsbDogcmVhZG9ubHkgW3N0cmluZywgc3RyaW5nLCBzdHJpbmddOyAvLyAzeDMgZ3JpZFxufVxuXG5leHBvcnQgZnVuY3Rpb24gaWNvbihhcnI6IFRlbXBsYXRlU3RyaW5nc0FycmF5KTogSWNvbiB7XG4gIGlmIChhcnIubGVuZ3RoICE9IDEpIHRocm93IG5ldyBFcnJvcignQmFkIGljb24gaW5wdXQnKTtcbiAgY29uc3Qgc3RyID0gYXJyWzBdO1xuICAvLyBwYXJzZSB0aGUgc3RyaW5nLlxuICBjb25zdCBsaW5lcyA9IHN0ci5zcGxpdCgnXFxuJyk7XG4gIC8vIGxpbmVzIDEuLjMgYXJlIHRoZSBmdWxsIGljb24uXG4gIGNvbnN0IGZ1bGwgPSBsaW5lcy5zbGljZSgxKS5tYXAobCA9PiBsLnJlcGxhY2UoL15cXHMqXFx8fFxcfFxccyokL2csICcnKSk7XG4gIGNvbnN0IHNob3J0ID0gL1xcUy8udGVzdChsaW5lc1swXSkgPyBsaW5lc1swXVswXSA6IGZ1bGxbMV1bMV07XG4gIHJldHVybiB7c2hvcnQsIGZ1bGw6IFtmdWxsWzBdLCBmdWxsWzFdLCBmdWxsWzJdXX07XG59XG5cblxuZXhwb3J0IHR5cGUgU3RhaXJUeXBlID0gJ3N0YWlyOnVwJyB8ICdzdGFpcjpkb3duJztcbmV4cG9ydCB0eXBlIEVkZ2VUeXBlID0gJ2VkZ2U6dG9wJyB8ICdlZGdlOmJvdHRvbScgfCAnZWRnZTpsZWZ0JyB8ICdlZGdlOnJpZ2h0JztcbmV4cG9ydCB0eXBlIFNlYW1sZXNzVHlwZSA9ICdzZWFtbGVzczp1cCcgfCAnc2VhbWxlc3M6ZG93bic7XG5leHBvcnQgdHlwZSBDb25uZWN0aW9uVHlwZSA9XG4gICAgU3RhaXJUeXBlIHwgRWRnZVR5cGUgfCBTZWFtbGVzc1R5cGUgfFxuICAgICdjYXZlJyB8ICdkb29yJyB8ICdkb29yMicgfCAnZG9vcjMnIHwgJ2ZvcnRyZXNzJyB8ICdnYXRlJyB8XG4gICAgJ3N3YW1wJyB8ICd0ZWxlcG9ydGVyJyB8ICd3aW5kbWlsbCc7XG4vLyBUT0RPIC0gaXMgd2luZG1pbGwganVzdCBkb29yMj9cblxuLy8gTk9URTogc3dhbXAgY29ubmVjdHMgdG8gZWRnZTpib3R0b20gZm9yIGNhdmUgb3IgdG93bj9cblxuZXhwb3J0IGludGVyZmFjZSBDb25uZWN0aW9uIHtcbiAgcmVhZG9ubHkgdHlwZTogQ29ubmVjdGlvblR5cGU7XG4gIHJlYWRvbmx5IG1hbnVhbD86IGJvb2xlYW47ICAgICAgICAgLy8gc2hvdWxkIG9ubHkgYmUgcGxhY2VkIG1hbnVhbGx5XG4gIHJlYWRvbmx5IGRpcjogbnVtYmVyOyAgICAgICAgICAgICAgLy8gMD11cCwgMT1sZWZ0LCAyPWRvd24sIDM9cmlnaHRcbiAgcmVhZG9ubHkgZW50cmFuY2U6IG51bWJlcjsgICAgICAgICAvLyBwb3MgWXlYeFxuICByZWFkb25seSBleGl0czogcmVhZG9ubHkgbnVtYmVyW107IC8vIHRpbGUgWVhcbiAgcmVhZG9ubHkgYWxsb3dlZEV4aXRzPzogcmVhZG9ubHkgbnVtYmVyW107IC8vIGV4dHJhIGV4aXRzIHRvIG1hdGNoXG4gIC8vIFRPRE8gLSBzaW5nbGVIZWlnaHRFbnRyYW5jZSAtIGZvciBkaXI9MiBqdXN0IHN1YnRyYWN0IDB4MjAgPz9cbiAgLy8gVE9ETyAtIG9wcG9zaXRlIGRpcmVjdGlvbj8gd2F0ZXJlcmZhbGwgY2F2ZSBpcyBhIHJpZ2h0L2Rvd24gbWF0Y2h1cC4uLlxufVxuXG4vKiogQHBhcmFtIHRpbGUgcG9zaXRpb24gb2YgbG93ZXItbGVmdCBtZXRhdGlsZSAoZS5nLiAweDQyIGZvciA0MF8zMCkuICovXG5leHBvcnQgZnVuY3Rpb24gdXBTdGFpcih0aWxlOiBudW1iZXIsIHdpZHRoID0gMik6IENvbm5lY3Rpb24ge1xuICAvLyBmcm9tIG1hcCAwNDogZW50cmFuY2UgNDBfMzAgID0+IGV4aXRzIDMyLDMzXG4gIC8vIGZyb20gbWFwIDE5IChzaW5nbGUtd2lkdGgpOiB0aWxlIDY4ID0+IGVudHJhbmNlIDc4Xzg4LCBleGl0IDY4XG4gIGNvbnN0IHkgPSB0aWxlID4+PiA0O1xuICBjb25zdCB4ID0gdGlsZSAmIDB4ZjtcbiAgaWYgKHdpZHRoID09PSAxKSB7XG4gICAgLy8gVE9ETyAtIHdoYXQgZG9lcyBpdCBtZWFuIGZvciBlbnRyYW5jZSB0byBiZSA+IDB4ZmZmZi4uLj9cbiAgICAvLyAgICAgIC0gc2NyZWVuIDZjIChvYWsgTlcpIGhhcyB0aGlzXG4gICAgY29uc3QgZHkgPSB5ID09PSAweGUgPyAweDI4MDAgOiAweDE4MDA7XG4gICAgY29uc3QgZW50cmFuY2UgPSAoKHkgPDwgMTIpICsgZHkpIHwgKCh4IDw8IDQpICsgMHgwMDA4KTtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ3N0YWlyOnVwJyxcbiAgICAgIGRpcjogMixcbiAgICAgIGVudHJhbmNlLFxuICAgICAgZXhpdHM6IFt0aWxlXSxcbiAgICAgIC8vYWxsb3dlZEV4aXRzOiBbdGlsZSAtIDE2LCB0aWxlICsgMTZdLFxuICAgIH07XG4gIH1cbiAgLy8gVE9ETyAtIGlmIHkgaXMgMHhlIHRoZW4gd2UgbWF5IG5lZWQgdG8gYWRqdXN0IGZvciBzY3JlZW4gZWRnZT9cbiAgY29uc3QgZW50cmFuY2UgPSB5IDw8IDEyIHwgKCh4IDw8IDQpICsgKHdpZHRoIDw8IDMpKTtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnc3RhaXI6dXAnLFxuICAgIGRpcjogMCxcbiAgICBlbnRyYW5jZSxcbiAgICBleGl0czogc2VxKHdpZHRoLCBpID0+IHRpbGUgLSAweDEwICsgaSksXG4gICAgLy8gVE9ETyAtIGlmIHdlIHNldCB0aGlzIHRoZW4gd2UgY291bGQgcG9zc2libHkgc2F2ZSBzb21lIG9mIHRoZVxuICAgIC8vICAgICAgICBwcmVwYXJzZSBub3JtYWxpemF0aW9uIHRoYXQncyBjdXJyZW50bHkgcmVxdWlyZWQuXG4gICAgLy9hbGxvd2VkRXhpdHM6IFsuLi5zZXEod2lkdGgsIGkgPT4gdGlsZSAtIDB4MjAgKyBpKSxcbiAgICAvLyAgICAgICAgICAgICAgIC4uLnNlcSh3aWR0aCwgaSA9PiB0aWxlICsgaSldLFxuICB9O1xufVxuXG4vKiogQHBhcmFtIHRpbGUgcG9zaXRpb24gb2YgdXBwZXItbGVmdCBtZXRhdGlsZSAoZS5nLiAweGEyIGZvciBhZl8zMCkuICovXG5leHBvcnQgZnVuY3Rpb24gZG93blN0YWlyKHRpbGU6IG51bWJlciwgd2lkdGggPSAyKTogQ29ubmVjdGlvbiB7XG4gIC8vIGZyb20gbWFwIDA1OiBlbnRyYW5jZSBhZl8zMCAgPT4gZXhpdHMgYjIsYjNcbiAgLy8gZnJvbSBtYXAgZDQgKHNpbmdsZS13aWR0aCk6IHRpbGUgNGMgPT4gZW50cmFuY2UgMzhfYzgsIGV4aXQgNGNcbiAgY29uc3QgeSA9IHRpbGUgPj4+IDQ7XG4gIGNvbnN0IHggPSB0aWxlICYgMHhmO1xuICBpZiAod2lkdGggPT09IDEpIHtcbiAgICBjb25zdCBlbnRyYW5jZSA9ICgoeSA8PCAxMikgLSAweDA4MDApIHwgKCh4IDw8IDQpICsgMHgwMDA4KTtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ3N0YWlyOmRvd24nLFxuICAgICAgZGlyOiAyLFxuICAgICAgZW50cmFuY2UsXG4gICAgICBleGl0czogW3RpbGVdLFxuICAgICAgYWxsb3dlZEV4aXRzOiBbdGlsZSArIDE2LCB0aWxlIC0gMTZdLFxuICAgIH07XG4gIH1cbiAgY29uc3QgZW50cmFuY2UgPSB5IDw8IDEyIHwgMHgwZjAwIHwgKCh4IDw8IDQpICsgKHdpZHRoIDw8IDMpKTtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnc3RhaXI6ZG93bicsXG4gICAgZGlyOiAyLFxuICAgIGVudHJhbmNlLFxuICAgIGV4aXRzOiBzZXEod2lkdGgsIGkgPT4gdGlsZSArIDB4MTAgKyBpKSxcbiAgICBhbGxvd2VkRXhpdHM6IFsuLi5zZXEod2lkdGgsIGkgPT4gdGlsZSArIDB4MjAgKyBpKSxcbiAgICAgICAgICAgICAgICAgICAuLi5zZXEod2lkdGgsIGkgPT4gdGlsZSArIGkpXSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhdmUodGlsZTogbnVtYmVyLCB0eXBlOiBDb25uZWN0aW9uVHlwZSA9ICdjYXZlJyk6IENvbm5lY3Rpb24ge1xuICByZXR1cm4gey4uLnVwU3RhaXIodGlsZSArIDE2KSwgdHlwZX07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkb29yKHRpbGU6IG51bWJlciwgdHlwZTogQ29ubmVjdGlvblR5cGUgPSAnZG9vcicpOiBDb25uZWN0aW9uIHtcbiAgcmV0dXJuIHsuLi51cFN0YWlyKHRpbGUsIDEpLCB0eXBlfTtcbn1cblxuLyoqIEBwYXJhbSB0aWxlIGJvdHRvbS1sZWZ0IG1ldGF0aWxlICovXG5leHBvcnQgZnVuY3Rpb24gd2F0ZXJmYWxsQ2F2ZSh0aWxlOiBudW1iZXIpOiBDb25uZWN0aW9uIHtcbiAgY29uc3QgeSA9IHRpbGUgPj4+IDQ7XG4gIGNvbnN0IHggPSB0aWxlICYgMHhmO1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdjYXZlJyxcbiAgICBkaXI6IDAsXG4gICAgZW50cmFuY2U6IHkgPDwgMTIgfCB4IDw8IDQgfCAweGYsXG4gICAgZXhpdHM6IFt0aWxlIC0gMHhmLCB0aWxlICsgMV0sXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b3BFZGdlKHtsZWZ0ID0gNywgd2lkdGggPSAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHRvcCA9IDIsIG1hbnVhbCA9IGZhbHNlfSA9IHt9KTogQ29ubmVjdGlvbiB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ2VkZ2U6dG9wJyxcbiAgICBtYW51YWwsXG4gICAgZGlyOiAwLFxuICAgIGVudHJhbmNlOiAoKHRvcCArIDEpIDw8IDEyKSB8ICgobGVmdCA8PCA0KSArICh3aWR0aCA8PCAzKSksXG4gICAgZXhpdHM6IHNlcSh3aWR0aCwgaSA9PiAodG9wIDw8IDQpIHwgKGkgKyBsZWZ0KSksXG4gIH07XG59XG5cbi8vIFRPRE8gLSBjb25zaWRlciBzZXBhcmF0aW5nIHdpZGUgdnMgbmFycm93IGVkZ2VzIGludG8gc2VwYXJhdGUgdHlwZXM/Pz9cblxuZXhwb3J0IGZ1bmN0aW9uIGJvdHRvbUVkZ2Uoe2xlZnQgPSA3LCB3aWR0aCA9IDIsIHNoaWZ0ID0gMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gJ2VkZ2U6Ym90dG9tJyBhcyBDb25uZWN0aW9uVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYW51YWwgPSBmYWxzZX0gPSB7fSk6IENvbm5lY3Rpb24ge1xuICAvLyBOT1RFOiBzb21lIHNjcmVlbnMgY2FuIGJlIHVzZWQgYm90aCBpbiBub3JtYWwgbWFwcyBhbmQgaW4gc2luZ2xlLWhlaWdodFxuICAvLyBtYXBzLiAgV2hlbiB1c2VkIGluIHNpbmdsZS1oZWlnaHQsIHdlIG5lZWQgdG8gc3VidHJhY3QgMiBmcm9tIHRoZSBZIHRpbGVcbiAgLy8gY29vcmRpbmF0ZXMgb2YgdGhlIGVudHJhbmNlL2V4aXQsIGNsYW1waW5nIHRvIGJmIChlbnRyYW5jZSkgYW5kIGMgKGV4aXQpLlxuICByZXR1cm4ge1xuICAgIHR5cGUsIG1hbnVhbCxcbiAgICBkaXI6IDIsXG4gICAgZW50cmFuY2U6IDB4ZGZfMDAgfCAoKGxlZnQgPDwgNCkgKyAod2lkdGggPDwgMykgKyAxNiAqIHNoaWZ0KSxcbiAgICBleGl0czogc2VxKHdpZHRoLCBpID0+IDB4ZTAgfCAoaSArIGxlZnQpKSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJvdHRvbUVkZ2VIb3VzZSh7bGVmdCA9IDcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGlmdCA9IDB9ID0ge30pOiBDb25uZWN0aW9uIHtcbiAgLy8gVW5saWtlIFwiZHVhbC1tb2RlXCIgc2NyZWVucywgaW5kb29ycy1vbmx5IHNjcmVlbnMgaGF2ZSB0aGVpciBlbnRyYW5jZSBhblxuICAvLyBhZGRpdGlvbmFsIHRpbGUgdXAsIGF0IGFmL2IuICBUaGlzIGhhcmQtY29kZXMgdGhhdC5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnZWRnZTpib3R0b20nLFxuICAgIGRpcjogMixcbiAgICBlbnRyYW5jZTogMHhhZl8wMCB8ICgobGVmdCA8PCA0KSArICh3aWR0aCA8PCAzKSArIDE2ICogc2hpZnQpLFxuICAgIGV4aXRzOiBzZXEod2lkdGgsIGkgPT4gMHhiMCB8IChpICsgbGVmdCkpLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbGVmdEVkZ2Uoe3RvcCA9IDcsIGhlaWdodCA9IDIsIHNoaWZ0ID0gMH0gPSB7fSk6IENvbm5lY3Rpb24ge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdlZGdlOmxlZnQnLFxuICAgIGRpcjogMSxcbiAgICBlbnRyYW5jZTogKCh0b3AgPDwgMTIpICsgKCgxNiAqIHNoaWZ0KSA8PCA4KSArIChoZWlnaHQgPDwgMTEpKSB8IDB4MTAsXG4gICAgZXhpdHM6IHNlcShoZWlnaHQsIGkgPT4gKGkgKyB0b3ApIDw8IDQpLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmlnaHRFZGdlKHt0b3AgPSA3LCBoZWlnaHQgPSAyfSA9IHt9KTogQ29ubmVjdGlvbiB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ2VkZ2U6cmlnaHQnLFxuICAgIGRpcjogMyxcbiAgICBlbnRyYW5jZTogKCh0b3AgPDwgMTIpICsgKGhlaWdodCA8PCAxMSkpIHwgMHhlZixcbiAgICBleGl0czogc2VxKGhlaWdodCwgaSA9PiAoaSArIHRvcCkgPDwgNCB8IDB4ZiksXG4gIH07XG59XG5cbi8qKiBAcGFyYW0gdGlsZSBUb3AtbGVmdCB0aWxlIG9mIHRyYW5zaXRpb24gKGhlaWdodCAyKSAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNlYW1sZXNzVXAodGlsZTogbnVtYmVyLCB3aWR0aCA9IDIpOiBDb25uZWN0aW9uIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnc2VhbWxlc3M6dXAnLFxuICAgIGRpcjogMCxcbiAgICBnZXQgZW50cmFuY2UoKTogbnVtYmVyIHsgdGhyb3cgbmV3IEVycm9yKCdkb2VzIG5vdCBtYWtlIHNlbnNlJyk7IH0sXG4gICAgZXhpdHM6IHNlcSh3aWR0aCwgaSA9PiAodGlsZSArIGkpKSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNlYW1sZXNzRG93bih0aWxlOiBudW1iZXIsIHdpZHRoID0gMik6IENvbm5lY3Rpb24ge1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdzZWFtbGVzczpkb3duJyxcbiAgICBkaXI6IDIsXG4gICAgZ2V0IGVudHJhbmNlKCk6IG51bWJlciB7IHRocm93IG5ldyBFcnJvcignZG9lcyBub3QgbWFrZSBzZW5zZScpOyB9LFxuICAgIGV4aXRzOiBzZXEod2lkdGgsIGkgPT4gKHRpbGUgKyBpKSksXG4gIH07XG59XG4iXX0=