import { Spawn } from './locationtables.js';
export var ScreenFix;
(function (ScreenFix) {
    ScreenFix[ScreenFix["Unknown"] = 0] = "Unknown";
    ScreenFix[ScreenFix["GrassLongGrass"] = 1] = "GrassLongGrass";
    ScreenFix[ScreenFix["GrassLongGrassRemapping"] = 2] = "GrassLongGrassRemapping";
    ScreenFix[ScreenFix["RiverShortGrass"] = 3] = "RiverShortGrass";
    ScreenFix[ScreenFix["SeaCaveEntrance"] = 4] = "SeaCaveEntrance";
    ScreenFix[ScreenFix["SeaRocks"] = 5] = "SeaRocks";
    ScreenFix[ScreenFix["SeaMarsh"] = 6] = "SeaMarsh";
    ScreenFix[ScreenFix["SeaTrees"] = 7] = "SeaTrees";
    ScreenFix[ScreenFix["DesertShortGrass"] = 8] = "DesertShortGrass";
    ScreenFix[ScreenFix["DesertLongGrass"] = 9] = "DesertLongGrass";
    ScreenFix[ScreenFix["DesertMarsh"] = 10] = "DesertMarsh";
    ScreenFix[ScreenFix["DesertRocks"] = 11] = "DesertRocks";
    ScreenFix[ScreenFix["DesertTrees"] = 12] = "DesertTrees";
    ScreenFix[ScreenFix["DesertTownEntrance"] = 13] = "DesertTownEntrance";
    ScreenFix[ScreenFix["LabyrinthParapets"] = 14] = "LabyrinthParapets";
    ScreenFix[ScreenFix["SwampDoors"] = 15] = "SwampDoors";
    ScreenFix[ScreenFix["ExtraSpikes"] = 16] = "ExtraSpikes";
    ScreenFix[ScreenFix["CloseCaves"] = 17] = "CloseCaves";
})(ScreenFix || (ScreenFix = {}));
export function withRequire(requirement, props) {
    for (const key in props) {
        props[key].requires = [requirement];
    }
    return props;
}
export function fixTilesets(rom) {
    const { desert, grass, lime, mountain, mountainRiver, river, sea } = rom.metatilesets;
    const $ = rom.metascreens;
    $.registerFix(ScreenFix.DesertRocks);
    desert.getTile(0x5f).copyFrom(0x5b).replaceIn($.oasisCave, $.oasisLake);
    desert.getTile(0x5a).copyFrom(0x98).setTiles([, , 0x1a, 0x18]);
    desert.getTile(0x5b).copyFrom(0x80).setTiles([0x34, 0x32, ,]);
    desert.getTile(0x5c).copyFrom(0x80).setTiles([, , 0x37, 0x35]);
    desert.getTile(0x5d).copyFrom(0x80).setTiles([, 0x37, , 0x34]);
    desert.getTile(0x5e).copyFrom(0x80).setTiles([0x35, , 0x32,]);
    $.registerFix(ScreenFix.DesertTrees);
    desert.getTile(0x63).copyFrom(0x71);
    desert.getTile(0x68).copyFrom(0x70);
    desert.getTile(0x69).copyFrom(0x60);
    desert.getTile(0x6a).copyFrom(0x65);
    desert.getTile(0x6c).copyFrom(0x70);
    desert.getTile(0x6e).copyFrom(0x76);
    desert.getTile(0x6f).copyFrom(0x78);
    $.registerFix(ScreenFix.GrassLongGrass);
    grass.getTile(0x40).copyFrom(0x51);
    grass.getTile(0x41).copyFrom(0x52);
    grass.getTile(0x42).copyFrom(0x53);
    grass.getTile(0x43).copyFrom(0x54);
    grass.getTile(0x44).copyFrom(0x55);
    grass.getTile(0x45).copyFrom(0x56);
    grass.getTile(0x46).copyFrom(0x58);
    grass.getTile(0x47).copyFrom(0x59);
    $.registerFix(ScreenFix.SeaCaveEntrance);
    sea.getTile(0xad).copyFrom(0x0a)
        .replaceIn($.beachExitN, $.lighthouseEntrance, $.oceanShrine);
    sea.getTile(0x0a).copyFrom(0xa2);
    $.boundaryN_cave.screen.set2d(0x38, [[null, 0x00, 0x00, null],
        [null, 0x0a, 0x0a, null],
        [null, 0xf7, 0xf7, null],
        [0xf8, 0xf8, 0xf8, 0xf8]]);
    $.cornerSE_cave.screen.set2d(0x49, [[null, 0x00, 0x00],
        [null, 0x0a, 0x0a],
        [null, 0xf7, 0xf7],
        [0xf8, 0xf7, 0xf7],
        [null, 0xfd, 0xf7]]);
    $.cornerSE_cave.screen.set2d(0x4a, [[0x00, 0x00],
        [0x0a, 0x0a],
        [0xf7, 0xf7],
        [0xf8, 0xf7],
        [0x80, 0xfd],
        [0x80, 0xff],
        [0xfa, null]]);
    $.registerFix(ScreenFix.CloseCaves);
    river.getTile(0x07).copyFrom(0x01).replaceIn(...river);
    river.getTile(0x0e).copyFrom(0x02).replaceIn(...river);
    river.getTile(0x20).copyFrom(0x03).replaceIn(...river);
    river.getTile(0x21).copyFrom(0x04).replaceIn(...river);
    for (const ts of [desert, sea, mountain, mountainRiver, lime]) {
        ts.getTile(0x68).copyFrom(0x01).replaceIn(...ts);
        ts.getTile(0x83).copyFrom(0x02).replaceIn(...ts);
        ts.getTile(0x88).copyFrom(0x03).replaceIn(...ts);
        ts.getTile(0x89).copyFrom(0x04).replaceIn(...ts);
    }
    for (const ts of [river, desert, sea]) {
        ts.getTile(0x01).copyFrom(0xc1).setAlternative(0x00);
        ts.getTile(0x02).copyFrom(0xc1).setAlternative(0x00);
        ts.getTile(0x03).copyFrom(0xd7).setAlternative(0x0a);
        ts.getTile(0x04).copyFrom(0xd7).setAlternative(0x0a);
    }
    const closedCaves = [
        [$.boundaryE_cave, 0x48], [$.boundaryW_cave, 0x79],
        [$.exitW_cave, 0x38], [$.caveAbovePortoa, 0x56],
    ];
    for (const [scr, pos] of closedCaves) {
        scr.screen.set2d(pos, [[1, 2], [3, 4]]);
        scr.addCustomFlag(true);
    }
    {
        const { locations: { CordelPlainEast, CordelPlainWest, WaterfallValleyNorth }, flags: { OpenedSealedCave } } = rom;
        CordelPlainEast.meta.customFlags.set(0x30, OpenedSealedCave);
        CordelPlainWest.meta.customFlags.set(0x30, OpenedSealedCave);
        WaterfallValleyNorth.meta.customFlags.set(0x30, OpenedSealedCave);
        const explosion = Spawn.of({ y: 0x060, x: 0x060, type: 4, id: 0x2c });
        const keyTrigger = Spawn.of({ y: 0x070, x: 0x070, type: 2, id: 0xad });
        WaterfallValleyNorth.spawns.splice(1, 0, explosion);
        WaterfallValleyNorth.spawns.push(keyTrigger);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyZWVuZml4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3JvbS9zY3JlZW5maXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBSTVDLE1BQU0sQ0FBTixJQUFZLFNBMkRYO0FBM0RELFdBQVksU0FBUztJQUNuQiwrQ0FBTyxDQUFBO0lBR1AsNkRBQWMsQ0FBQTtJQUtkLCtFQUF1QixDQUFBO0lBSXZCLCtEQUFlLENBQUE7SUFLZiwrREFBZSxDQUFBO0lBTWYsaURBQVEsQ0FBQTtJQUdSLGlEQUFRLENBQUE7SUFJUixpREFBUSxDQUFBO0lBR1IsaUVBQWdCLENBQUE7SUFHaEIsK0RBQWUsQ0FBQTtJQUlmLHdEQUFXLENBQUE7SUFHWCx3REFBVyxDQUFBO0lBR1gsd0RBQVcsQ0FBQTtJQUdYLHNFQUFrQixDQUFBO0lBRWxCLG9FQUFpQixDQUFBO0lBRWpCLHNEQUFVLENBQUE7SUFFVix3REFBVyxDQUFBO0lBRVgsc0RBQVUsQ0FBQTtBQUNaLENBQUMsRUEzRFcsU0FBUyxLQUFULFNBQVMsUUEyRHBCO0FBR0QsTUFBTSxVQUFVLFdBQVcsQ0FBaUIsV0FBc0IsRUFBRSxLQUFRO0lBQzFFLEtBQUssTUFBTSxHQUFHLElBQUksS0FBSyxFQUFFO1FBQ3ZCLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztLQUNyQztJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQTRDRCxNQUFNLFVBQVUsV0FBVyxDQUFDLEdBQVE7SUFDbEMsTUFBTSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUNuQixRQUFRLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUMsR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDO0lBQy9ELE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUM7SUFJMUIsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBRXhFLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQUFBRCxFQUFHLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQy9ELE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsQUFBRCxFQUFJLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEFBQUQsRUFBRyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxBQUFELEVBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLEVBQUUsQUFBRCxFQUFHLElBQUksRUFBRyxDQUFDLENBQUM7SUFFL0QsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFJcEMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDeEMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFXbkMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDekMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1NBQzNCLFNBQVMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDbEUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ3hCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ3hCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ3hCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ2xCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUM7UUFDbEIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNsQixDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ2xCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekQsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQXFCbkQsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDcEMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDdkQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDdkQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDdkQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDdkQsS0FBSyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRTtRQUM3RCxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNqRCxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNqRCxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNqRCxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztLQUNsRDtJQUNELEtBQUssTUFBTSxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxFQUFFO1FBQ3JDLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyRCxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckQsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JELEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUN0RDtJQUNELE1BQU0sV0FBVyxHQUFnQztRQUMvQyxDQUFDLENBQUMsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQztLQUNoRCxDQUFDO0lBSUYsS0FBSyxNQUFNLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxJQUFJLFdBQVcsRUFBRTtRQUNwQyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUN6QjtJQUNEO1FBQ0UsTUFBTSxFQUFDLFNBQVMsRUFBRSxFQUFDLGVBQWUsRUFBRSxlQUFlLEVBQUUsb0JBQW9CLEVBQUMsRUFDbkUsS0FBSyxFQUFFLEVBQUMsZ0JBQWdCLEVBQUMsRUFBQyxHQUFHLEdBQUcsQ0FBQztRQUN4QyxlQUFlLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLGdCQUFnQixDQUFDLENBQUM7UUFDN0QsZUFBZSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzdELG9CQUFvQixDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUNwRSxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7UUFDckUsb0JBQW9CLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO1FBQ3BELG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7S0FDOUM7QUEwQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuaW1wb3J0IHsgU3Bhd24gfSBmcm9tICcuL2xvY2F0aW9udGFibGVzLmpzJztcbmltcG9ydCB7IE1ldGFzY3JlZW4gfSBmcm9tICcuL21ldGFzY3JlZW4uanMnO1xuXG4vLyBTaW1wbGUgdGlsZXNldC1vbmx5IGZpeGVzIHRoYXQgdW5sb2NrIHNvbWUgc2NyZWVuLXRpbGVzZXQgY29tYmluYXRpb25zXG5leHBvcnQgZW51bSBTY3JlZW5GaXgge1xuICBVbmtub3duLFxuICAvLyBTdXBwb3J0IFwibG9uZyBncmFzc1wiIHJpdmVyIHNjcmVlbnMgb24gdGhlIGdyYXNzIHRpbGVzZXQgYnkgY29weWluZ1xuICAvLyBzb21lIHRpbGVzIGZyb20gNTEuLjU5IGludG8gNDAuLjQ3LlxuICBHcmFzc0xvbmdHcmFzcyxcbiAgLy8gSW4gYWRkaXRpb24gdG8ganVzdCBtYWtpbmcgdGhlIG5ldyBsb25nIGdyYXNzIHRpbGVzLCB3ZSBuZWVkIHRvXG4gIC8vIGFsc28gcmVtYXAgdGhlIGV4aXN0aW5nIG9uZXMgaW4gc29tZSBzaXR1YXRpb25zIHRvIHBvaW50IHRvIHRoZVxuICAvLyBuZXcgb25lcywgZS5nLiBmb3Igc2NyZWVucyAxZCwyOSB0byB3b3JrIG9uIHJpdmVyLCB3ZSBuZWVkIHRvIHVzZVxuICAvLyB0aGUgNHggdGlsZXMgaW5zdGVhZCBvZiB0aGUgNXggb25lcyB0byBmaXggdGhlIHN1cnJvdW5kaW5nLlxuICBHcmFzc0xvbmdHcmFzc1JlbWFwcGluZywgLy8gVE9ET1xuICAvLyBSaXZlciB0aWxlc2V0cyBkb24ndCBkZWZpbmUgMTAsMTIsMTQsMTYsMTcsMWEsMWIsMWMsMjIsMjMsMjQsMjUsMjYsXG4gIC8vIHdoaWNoIGFyZSB1c2VkIGZvciB0aGUgXCJzaG9ydCBncmFzc1wiIGluIHRoZSBncmFzcyB0aWxlc2V0LiAgVGhlc2VcbiAgLy8gd291bGQgYmUgZWFzeSB0byBjb3B5IGZyb20gc29tZXdoZXJlIGVsc2UgdG8gb3BlbiB1cCBhIGZldyBzY3JlZW5zLlxuICBSaXZlclNob3J0R3Jhc3MsIC8vIFRPRE9cbiAgLy8gQW5ncnkgc2VhIHVzZXMgMGEgb2RkbHkgZm9yIGEgc2ltcGxlIGRpYWdvbmFsIGJlYWNoL21vdW50YWluIHRpbGUsXG4gIC8vIHByZXZlbnRpbmcgcGFyaXR5IHdpdGggZ3Jhc3Mvcml2ZXIgY2F2ZSBlbnRyYW5jZSBib3R0b21zLiAgTW92ZSB0aGlzXG4gIC8vIHRpbGUgZWxzZXdoZXJlIChhZCkgYW5kIGZpeCB0aGUgZ3JhcGhpY3MvZWZmZWN0cy4gIE5vdGUgdGhhdCB0aGVcbiAgLy8gYWN0dWFsIGZpeCBpcyBub3QgZW50aXJlbHkgc2F0aXNmeWluZy5cbiAgU2VhQ2F2ZUVudHJhbmNlLFxuICAvLyBBbmdyeSBzZWEgZG9lcyBub3QgaGFuZGxlIHJvY2tzIGNvcnJlY3RseS4gIEZpeCA1YS4uNWUgZm9yIHBhcml0eVxuICAvLyB3aXRoIGdyYXNzL3JpdmVyIHRpbGVzZXRzLiAgVE9ETyAtIGltcGxlbWVudCB0aGUgZml4ICh3ZSBjb3VsZCBtb3ZlXG4gIC8vIHRoZSBleGlzdGluZyB0aWxlcywgdXNlZCBieSBtb3VudGFpbiBnYXRlcywgZWxzZXdoZXJlIHByZXR0eSBlYXNpbHksXG4gIC8vIG9yIGFsdGVybmF0aXZlbHkgbW92ZSBhbGwgdGhlIDVhLi41ZSBpbiBhbGwgb3RoZXIgdGlsZXNldHMgaW50b1xuICAvLyA4OSw4YSw5MCw5OSw5ZCxkMSxkMiB3aGljaCBhcmUgZnJlZSBpbiA4MCw5MCw5NCw5YykuXG4gIFNlYVJvY2tzLCAvLyBUT0RPXG4gIC8vIEFsbG93IHRoZSBzZWEgdG8gc3VwcG9ydCAzNCwzOCwzYy4uM2YsIHVzZWQgYXMgbWFyc2ggaW4gcml2ZXIgdGlsZXNldC5cbiAgLy8gVGhlc2Ugd291bGQgbmVlZCB0byBtYXAgdG8gc2ltcGxlIG9jZWFuIHRpbGVzLiAgVE9ETyAtIGltcGxlbWVudC5cbiAgU2VhTWFyc2gsIC8vIFRPRE9cbiAgLy8gU3VwcG9ydCA2eCw3eCB0aWxlcyAodHJlZXMpIG9uIGFuZ3J5IHNlYS4gIFByb2JhYmx5IG5vdCB3b3J0aCBpdC5cbiAgLy8gV291bGQgbmVlZCB0byBtb3ZlIChlLmcuKSBMaW1lIFRyZWUgTGFrZSB0byBhIHRvdGFsbHkgZGlmZmVyZW50IHRpbGVzZXRcbiAgLy8gdG8gZnJlZSB1cCB0aGUgbWV0YXRpbGVzLlxuICBTZWFUcmVlcywgLy8gVE9ET1xuICAvLyBGaXhpbmcgUml2ZXJTaG9ydEdyYXNzIGZvciBkZXNlcnQgaXMgYSBsb3QgaGFyZGVyIGJlY2F1c2UgaXQgdG91Y2hlcyBhXG4gIC8vIGJ1bmNoIG9mIHRpbGVzIHVzZWQgYnkgdGhlIG1vdW50YWluUml2ZXIgdGlsZXNldCAoMTAsMTQsMngpLlxuICBEZXNlcnRTaG9ydEdyYXNzLCAvLyBUT0RPXG4gIC8vIEZpeGluZyBHcmFzc0xvbmdHcmFzcyBmb3IgZGVzZXJ0IGlzIGRpZmZpY3VsdCBiZWNhdXNlIHRoZSA0eCB0aWxlc1xuICAvLyBhcmUgdXNlZCBieSBtb3VudGFpblJpdmVyLlxuICBEZXNlcnRMb25nR3Jhc3MsIC8vIFRPRE9cbiAgLy8gRGVzZXJ0IGRvZXNuJ3Qgc3VwcG9ydCB0aGUgM3ggbWFyc2ggdGlsZXMgKGNsYXNoIHdpdGggbW91bnRhaW5SaXZlcikuXG4gIC8vIEl0J3MgcHJvYmFibHkgbm90IGZlYXNpYmxlIHRvIGFkZCBzdXBwb3J0IC0gaXQgd291bGQgYWxsb3cgc2NyZWVuIDMzLFxuICAvLyBidXQgdGhlcmUncyBhIHNpbWlsYXIgc291dGgtZWRnZS1leGl0IHNjcmVlbiB3aXRoIERlc2VydFRvd25FbnRyYW5jZS5cbiAgRGVzZXJ0TWFyc2gsIC8vIFRPRE9cbiAgLy8gRml4IDVhLi41ZSB0byBiZSBjb21wYXRpYmxlIHdpdGggZ3Jhc3Mvcml2ZXIuICA1YiBpcyBhbHJlYWR5IGluIHVzZVxuICAvLyBvbiB0aGUgdHdvIG9hc2lzIHNjcmVlbnMsIHNvIHRoYXQgdGlsZSBpcyBtb3ZlZCB0byA1ZiB0byBtYWtlIHNwYWNlLlxuICBEZXNlcnRSb2NrcyxcbiAgLy8gQWRkIHNvbWUgbWlzc2luZyB0cmVlIHRpbGVzIGluIDYzLDY4LDY5LDZhLDZjLDZlLDZmLCByZXF1aXJlZCBmb3JcbiAgLy8gcGFyaXR5IHdpdGggc29tZSByaXZlciBzY3JlZW5zLlxuICBEZXNlcnRUcmVlcyxcbiAgLy8gU291dGgtZmFjaW5nIHRvd24gZW50cmFuY2VzIHVzZSAwNyBmb3IgdGhlIHRvcCBvZiB0aGUgdG93biB3YWxsLlxuICAvLyBUaGlzIGNvdWxkIGJlIHJlcGxhY2VkIHdpdGggKGUuZy4gOGMpIG9yIG1heWJlIHNvbWV0aGluZyBiZXR0ZXIuXG4gIERlc2VydFRvd25FbnRyYW5jZSwgLy8gVE9ET1xuICAvLyBMYWJ5cmludGggcGFyYXBldHMgY2FuIGJlIGJsb2NrZWQvdW5ibG9ja2VkIHdpdGggYSBmbGFnLlxuICBMYWJ5cmludGhQYXJhcGV0cywgLy8gVE9ETyAoc2VlIG1hemUvZ29hKVxuICAvLyBBZGRzIGZsYWdnYWJsZSBkb29ycyB0byB2YXJpb3VzIHNjcmVlbnMuXG4gIFN3YW1wRG9vcnMsIC8vIFRPRE8gKHNlZSBtYXplL3N3YW1wKVxuICAvLyBBZGRzIHNvbWUgZXh0cmEgc3Bpa2Ugc2NyZWVucy5cbiAgRXh0cmFTcGlrZXMsIC8vIFRPRE9cbiAgLy8gTWFrZSBjYXZlcyBjbG9zZWFibGUuXG4gIENsb3NlQ2F2ZXMsXG59XG5cbnR5cGUgUmVxcyA9IFJlY29yZDxhbnksIHtyZXF1aXJlcz86IFNjcmVlbkZpeFtdfT5cbmV4cG9ydCBmdW5jdGlvbiB3aXRoUmVxdWlyZTxUIGV4dGVuZHMgUmVxcz4ocmVxdWlyZW1lbnQ6IFNjcmVlbkZpeCwgcHJvcHM6IFQpIHtcbiAgZm9yIChjb25zdCBrZXkgaW4gcHJvcHMpIHtcbiAgICBwcm9wc1trZXldLnJlcXVpcmVzID0gW3JlcXVpcmVtZW50XTtcbiAgfVxuICByZXR1cm4gcHJvcHM7XG59XG5cblxuICAvLyAvLyBBZGRzIGFiaWxpdHkgdG8gY2xvc2UgY2F2ZXMuXG4gIC8vIENsb3NlQ2F2ZXMsXG5cblxuLy8gLyoqIEFkZHMgYSAnQ2xvc2VDYXZlcycgcmVxdWlyZW1lbnQgb24gYWxsIHRoZSBwcm9wZXJ0aWVzLiAqL1xuLy8gZnVuY3Rpb24gY2xvc2VDYXZlczxUIGV4dGVuZHMgUmVjb3JkPGFueSwge3JlcXVpcmVzOiBTY3JlZW5GaXhbXX0+Pihwcm9wczogVCkge1xuLy8gICBmb3IgKGNvbnN0IGtleSBpbiBwcm9wcykge1xuLy8gICAgIHByb3BzW2tleV0ucmVxdWlyZXMgPSBbU2NyZWVuRml4LkNsb3NlQ2F2ZXNdO1xuLy8gICB9XG4vLyAgIHJldHVybiBwcm9wcztcbi8vIH1cblxuXG4vLyBOT1RFOiBMaXN0aW5nIGV4cGxpY2l0IGZsYWdzIGRvZXNuJ3QgcXVpdGUgd29yay5cbi8vIGVudW0gRmxhZyB7XG4vLyAgIEFsd2F5cyA9IDB4MmYwLFxuLy8gICBXaW5kbWlsbCA9IDB4MmVlLFxuLy8gICBQcmlzb24gPSAweDJkOCxcbi8vICAgQ2FsbSA9IDB4MjgzLFxuLy8gICBTdHl4ID0gMHgyYjAsXG4vLyAgIERyYXlnb24xID0gMHgyOGYsXG4vLyAgIERyYXlnb24yID0gMHgyOGQsXG4vLyB9XG5cbi8vIGNvbnN0IEdSQVNTID0gMHg4MDtcbi8vIGNvbnN0IFRPV04gPSAweDg0O1xuLy8gY29uc3QgQ0FWRSA9IDB4ODg7XG4vLyBjb25zdCBQWVJBTUlEID0gMHg4Yztcbi8vIGNvbnN0IFJJVkVSID0gMHg5MDtcbi8vIGNvbnN0IE1PVU5UQUlOID0gMHg5NDtcbi8vIGNvbnN0IFNFQSA9IDB4OTQ7XG4vLyBjb25zdCBTSFJJTkUgPSAweDk4O1xuLy8gY29uc3QgREVTRVJUID0gMHg5Yztcbi8vIGNvbnN0IE1PVU5UQUlOX1JJVkVSID0gMHg5Yztcbi8vIGNvbnN0IFNXQU1QID0gMHhhMDtcbi8vIGNvbnN0IEhPVVNFID0gMHhhMDtcbi8vIGNvbnN0IEZPUlRSRVNTID0gMHhhNDtcbi8vIGNvbnN0IElDRV9DQVZFID0gMHhhODtcbi8vIGNvbnN0IFRPV0VSID0gMHhhYztcblxuLyoqIEFwcGx5IHN0YW5kYXJkIHRpbGVzZXQgZml4ZXMuICBPdGhlcnMgbWF5IGJlIGFwcGxpZWQgbGF0ZXIuICovXG5leHBvcnQgZnVuY3Rpb24gZml4VGlsZXNldHMocm9tOiBSb20pIHtcbiAgY29uc3Qge2Rlc2VydCwgZ3Jhc3MsIGxpbWUsXG4gICAgICAgICBtb3VudGFpbiwgbW91bnRhaW5SaXZlciwgcml2ZXIsIHNlYX0gPSByb20ubWV0YXRpbGVzZXRzO1xuICBjb25zdCAkID0gcm9tLm1ldGFzY3JlZW5zO1xuXG4gIC8vIFNldmVyYWwgb2YgdGhlIGdyYXNzL3JpdmVyIHNjcmVlbnMgd2l0aCBmb3Jlc3QgdGlsZXMgZG9uJ3Qgd29yayBvblxuICAvLyBkZXNlcnQuICBGaXggdGhlbSBieSBtYWtpbmcgNWEuLjZmIHdvcmsgY29ycmVjdGx5LlxuICAkLnJlZ2lzdGVyRml4KFNjcmVlbkZpeC5EZXNlcnRSb2Nrcyk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NWYpLmNvcHlGcm9tKDB4NWIpLnJlcGxhY2VJbigkLm9hc2lzQ2F2ZSwgJC5vYXNpc0xha2UpO1xuXG4gIGRlc2VydC5nZXRUaWxlKDB4NWEpLmNvcHlGcm9tKDB4OTgpLnNldFRpbGVzKFssICwgMHgxYSwgMHgxOF0pO1xuICBkZXNlcnQuZ2V0VGlsZSgweDViKS5jb3B5RnJvbSgweDgwKS5zZXRUaWxlcyhbMHgzNCwgMHgzMiwgLCBdKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg1YykuY29weUZyb20oMHg4MCkuc2V0VGlsZXMoWywgLCAweDM3LCAweDM1XSk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NWQpLmNvcHlGcm9tKDB4ODApLnNldFRpbGVzKFssIDB4MzcsICwgMHgzNF0pO1xuICBkZXNlcnQuZ2V0VGlsZSgweDVlKS5jb3B5RnJvbSgweDgwKS5zZXRUaWxlcyhbMHgzNSwgLCAweDMyLCBdKTtcblxuICAkLnJlZ2lzdGVyRml4KFNjcmVlbkZpeC5EZXNlcnRUcmVlcyk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NjMpLmNvcHlGcm9tKDB4NzEpO1xuICBkZXNlcnQuZ2V0VGlsZSgweDY4KS5jb3B5RnJvbSgweDcwKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg2OSkuY29weUZyb20oMHg2MCk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NmEpLmNvcHlGcm9tKDB4NjUpO1xuICBkZXNlcnQuZ2V0VGlsZSgweDZjKS5jb3B5RnJvbSgweDcwKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg2ZSkuY29weUZyb20oMHg3Nik7XG4gIGRlc2VydC5nZXRUaWxlKDB4NmYpLmNvcHlGcm9tKDB4NzgpO1xuXG4gIC8vIExvbmcgZ3Jhc3Mgc2NyZWVucyBkb24ndCB3b3JrIG9uIGdyYXNzIHRpbGVzZXRzIGJlY2F1c2Ugb2YgYSBmZXdcbiAgLy8gZGlmZmVyZW50IHRpbGVzIC0gY29weSB0aGVtIHdoZXJlIHRoZXkgbmVlZCB0byBnby5cbiAgJC5yZWdpc3RlckZpeChTY3JlZW5GaXguR3Jhc3NMb25nR3Jhc3MpO1xuICBncmFzcy5nZXRUaWxlKDB4NDApLmNvcHlGcm9tKDB4NTEpO1xuICBncmFzcy5nZXRUaWxlKDB4NDEpLmNvcHlGcm9tKDB4NTIpO1xuICBncmFzcy5nZXRUaWxlKDB4NDIpLmNvcHlGcm9tKDB4NTMpO1xuICBncmFzcy5nZXRUaWxlKDB4NDMpLmNvcHlGcm9tKDB4NTQpO1xuICBncmFzcy5nZXRUaWxlKDB4NDQpLmNvcHlGcm9tKDB4NTUpO1xuICBncmFzcy5nZXRUaWxlKDB4NDUpLmNvcHlGcm9tKDB4NTYpO1xuICBncmFzcy5nZXRUaWxlKDB4NDYpLmNvcHlGcm9tKDB4NTgpO1xuICBncmFzcy5nZXRUaWxlKDB4NDcpLmNvcHlGcm9tKDB4NTkpO1xuXG4gIC8vIEFuZ3J5IHNlYSB0aWxlc2V0IGRvZXNuJ3Qgc3VwcG9ydCB0aWxlIDBhICh1c2VkIGVsc2V3aGVyZSBmb3IgdGhlXG4gIC8vIGJvdHRvbSB0aWxlIGluIGNhdmUgZW50cmFuY2VzKSBiZWNhdXNlIGl0J3MgYWxyZWFkeSBpbiB1c2UgKGJ1dFxuICAvLyBub3QgYXMgYW4gYWx0ZXJuYXRpdmUpLiAgTW92ZSBpdCB0byBhZCBhbmQgZ2V0IDBhIGJhY2suICBBbHNvIGFkanVzdFxuICAvLyB0aGUgdGlsZXMgYXJvdW5kIHRoZSBjYXZlIGVudHJhbmNlcyB0byBub3QgaGF2ZSBkYW1hZ2UgdGlsZXMgaW4gdGhlXG4gIC8vIGRlc2VydCB0aWxlc2V0LiAgVGhpcyBjaGFuZ2VzIHRoZSBncmFwaGljcyBhIGJpdCAoZnJvbSBkYXJrIGJsdWVcbiAgLy8gd2F0ZXIgdG8gbGlnaHQgYmx1ZSksIHdoaWNoIGRvZXNuJ3QgbG9vayBxdWl0ZSBhcyBuaWNlLiAgVGhlIG90aGVyXG4gIC8vIGFsdGVybmF0aXZlIGlzIHRvIGFsbG9jYXRlIDMgbmV3IHRpbGVzLCBjb3BpZWQgZnJvbSAweDgwIGluIHNlYSBidXRcbiAgLy8gZnJvbSAweGY3LCAweGY4LCBhbmQgMHhmZCBpbiBkZXNlcnQvcml2ZXIvZ3Jhc3MuICBUaGVuIHNlYSBjYW4ga2VlcFxuICAvLyBpdHMgZGVlcCB3YXRlciBidXQgZGVzZXJ0IGF2b2lkcyB0aGUgZGFtYWdlLlxuICAkLnJlZ2lzdGVyRml4KFNjcmVlbkZpeC5TZWFDYXZlRW50cmFuY2UpO1xuICBzZWEuZ2V0VGlsZSgweGFkKS5jb3B5RnJvbSgweDBhKVxuICAgICAgLnJlcGxhY2VJbigkLmJlYWNoRXhpdE4sICQubGlnaHRob3VzZUVudHJhbmNlLCAkLm9jZWFuU2hyaW5lKTtcbiAgc2VhLmdldFRpbGUoMHgwYSkuY29weUZyb20oMHhhMik7IC8vIGRvbid0IGJvdGhlciBzZXR0aW5nIGFuIGFsdGVybmF0aXZlLlxuICAkLmJvdW5kYXJ5Tl9jYXZlLnNjcmVlbi5zZXQyZCgweDM4LCBbW251bGwsIDB4MDAsIDB4MDAsIG51bGxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW251bGwsIDB4MGEsIDB4MGEsIG51bGxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW251bGwsIDB4ZjcsIDB4ZjcsIG51bGxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzB4ZjgsIDB4ZjgsIDB4ZjgsIDB4ZjhdXSk7XG4gICQuY29ybmVyU0VfY2F2ZS5zY3JlZW4uc2V0MmQoMHg0OSwgW1tudWxsLCAweDAwLCAweDAwXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW251bGwsIDB4MGEsIDB4MGFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbnVsbCwgMHhmNywgMHhmN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsweGY4LCAweGY3LCAweGY3XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW251bGwsIDB4ZmQsIDB4ZjddXSk7XG4gICQuY29ybmVyU0VfY2F2ZS5zY3JlZW4uc2V0MmQoMHg0YSwgW1sweDAwLCAweDAwXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzB4MGEsIDB4MGFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMHhmNywgMHhmN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsweGY4LCAweGY3XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzB4ODAsIDB4ZmRdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMHg4MCwgMHhmZl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsweGZhLCBudWxsXV0pO1xuXG4gIC8vIE5PVEU6IHdlIGNhbiBjaGFuZ2UgdGhlIHJvdyBiZW5lYXRoIDB4MGEgdG8gMHg5MCBhbmQgc2V0IGl0cyBncmFwaGljc1xuICAvLyB0byBzb21ldGhpbmcgbmljZXIuXG4gIC8vIHNlYS5nZXRUaWxlKDB4OTApLnNldFRpbGVzKFsweDdlLCAweDdlLCAweDkxLCAweDkxXSkuc2V0QXR0cnMoMikuc2V0RWZmZWN0cygyKTtcbiAgLy8gLy9zZWEuZ2V0VGlsZSgweDBhKS5zZXRUaWxlcyhbMHg3ZSwgMHg3ZSwgMHg5MSwgMHg5MV0pLnNldEF0dHJzKDIpLnNldEVmZmVjdHMoMik7XG4gIC8vIHJpdmVyLmdldFRpbGUoMHg5MCkuY29weUZyb20oMHhmNyk7XG4gIC8vIGdyYXNzLmdldFRpbGUoMHg5MCkuY29weUZyb20oMHhmNyk7XG4gIC8vIGRlc2VydC5nZXRUaWxlKDB4OTApLmNvcHlGcm9tKDB4ZjcpO1xuXG5cbiAgICAgLy8gLCBbMHhmOCwgMHhmOF0sIFtudWxsLCAweGZkXV0pO1xuICAvLyBzZWEuc2NyZWVucy5hZGQoJC5ib3VuZGFyeVdfY2F2ZSk7XG4gIC8vIHNlYS5zY3JlZW5zLmFkZCgkLmRlc2VydENhdmVFbnRyYW5jZSk7XG5cbiAgLy8gVG8gYWxsb3cgY2F2ZXMgdG8gYmUgY2xvc2VkLCB3ZSBjbGVhciBvdXQgbWV0YXRpbGVzIDAxLi4wNCwgdG8gYmUgdXNlZCBhc1xuICAvLyB0aGUgZm91ciBjb3JuZXJzIG9mIHRoZSBjYXZlOiBbWzAxLCAwMl0sIFswMywgMDRdXS4gIFRoZXNlIGFyZSBjb3BpZWQgZnJvbVxuICAvLyBjMSxjMSxkNyxkNy4gIFtUT0RPIC0gc2VlbXMgbGlrZSB3ZSBjb3VsZCBqdXN0IHVzZSAyIGluc3RlYWQgb2YgNCBoZXJlXS5cbiAgLy8gU29tZSB0aWxlc2V0cyBhbHJlYWR5IGhhdmUgbWV0YXRpbGVzIGluIDAxLi4wNCBzbyB3ZSBuZWVkIHRvIG1vdmUgdGhlbSB0b1xuICAvLyB1bm9jY3VwaWVkIHNwb3RzIG9uIGEgcGVyLXRpbGVzZXQgYmFzaXMgKG5vdGUgdGhhdCBzZWEgKDk0KSBhbmQgZGVzZXJ0ICg5YylcbiAgLy8gYXJlIGVudGFuZ2xlZCBoZXJlKS4gIFtUT0RPIC0gY2xlYW4gdXAgMmMgYW5kIDJkIGFzIHdlbGxdXG4gICQucmVnaXN0ZXJGaXgoU2NyZWVuRml4LkNsb3NlQ2F2ZXMpO1xuICByaXZlci5nZXRUaWxlKDB4MDcpLmNvcHlGcm9tKDB4MDEpLnJlcGxhY2VJbiguLi5yaXZlcik7XG4gIHJpdmVyLmdldFRpbGUoMHgwZSkuY29weUZyb20oMHgwMikucmVwbGFjZUluKC4uLnJpdmVyKTtcbiAgcml2ZXIuZ2V0VGlsZSgweDIwKS5jb3B5RnJvbSgweDAzKS5yZXBsYWNlSW4oLi4ucml2ZXIpO1xuICByaXZlci5nZXRUaWxlKDB4MjEpLmNvcHlGcm9tKDB4MDQpLnJlcGxhY2VJbiguLi5yaXZlcik7XG4gIGZvciAoY29uc3QgdHMgb2YgW2Rlc2VydCwgc2VhLCBtb3VudGFpbiwgbW91bnRhaW5SaXZlciwgbGltZV0pIHtcbiAgICB0cy5nZXRUaWxlKDB4NjgpLmNvcHlGcm9tKDB4MDEpLnJlcGxhY2VJbiguLi50cyk7XG4gICAgdHMuZ2V0VGlsZSgweDgzKS5jb3B5RnJvbSgweDAyKS5yZXBsYWNlSW4oLi4udHMpO1xuICAgIHRzLmdldFRpbGUoMHg4OCkuY29weUZyb20oMHgwMykucmVwbGFjZUluKC4uLnRzKTtcbiAgICB0cy5nZXRUaWxlKDB4ODkpLmNvcHlGcm9tKDB4MDQpLnJlcGxhY2VJbiguLi50cyk7XG4gIH1cbiAgZm9yIChjb25zdCB0cyBvZiBbcml2ZXIsIGRlc2VydCwgc2VhXSkge1xuICAgIHRzLmdldFRpbGUoMHgwMSkuY29weUZyb20oMHhjMSkuc2V0QWx0ZXJuYXRpdmUoMHgwMCk7XG4gICAgdHMuZ2V0VGlsZSgweDAyKS5jb3B5RnJvbSgweGMxKS5zZXRBbHRlcm5hdGl2ZSgweDAwKTtcbiAgICB0cy5nZXRUaWxlKDB4MDMpLmNvcHlGcm9tKDB4ZDcpLnNldEFsdGVybmF0aXZlKDB4MGEpO1xuICAgIHRzLmdldFRpbGUoMHgwNCkuY29weUZyb20oMHhkNykuc2V0QWx0ZXJuYXRpdmUoMHgwYSk7XG4gIH1cbiAgY29uc3QgY2xvc2VkQ2F2ZXM6IEFycmF5PFtNZXRhc2NyZWVuLCBudW1iZXJdPiA9IFtcbiAgICBbJC5ib3VuZGFyeUVfY2F2ZSwgMHg0OF0sIFskLmJvdW5kYXJ5V19jYXZlLCAweDc5XSxcbiAgICBbJC5leGl0V19jYXZlLCAweDM4XSwgWyQuY2F2ZUFib3ZlUG9ydG9hLCAweDU2XSxcbiAgXTtcbiAgLy8gaWYgKCQuaXNGaXhlZChTY3JlZW5GaXguU2VhQ2F2ZUVudHJhbmNlcykpIHtcbiAgLy8gICAvLyBUT0RPIC0gYWRkICQuYm91bmRhcnlOX2NhdmUgYW5kIGNvcm5lclNFX2NhdmUgdG8gdGhlIGxpc3QuLi4/XG4gIC8vIH1cbiAgZm9yIChjb25zdCBbc2NyLCBwb3NdIG9mIGNsb3NlZENhdmVzKSB7XG4gICAgc2NyLnNjcmVlbi5zZXQyZChwb3MsIFtbMSwgMl0sIFszLCA0XV0pO1xuICAgIHNjci5hZGRDdXN0b21GbGFnKHRydWUpO1xuICB9XG4gIHtcbiAgICBjb25zdCB7bG9jYXRpb25zOiB7Q29yZGVsUGxhaW5FYXN0LCBDb3JkZWxQbGFpbldlc3QsIFdhdGVyZmFsbFZhbGxleU5vcnRofSxcbiAgICAgICAgICAgZmxhZ3M6IHtPcGVuZWRTZWFsZWRDYXZlfX0gPSByb207XG4gICAgQ29yZGVsUGxhaW5FYXN0Lm1ldGEuY3VzdG9tRmxhZ3Muc2V0KDB4MzAsIE9wZW5lZFNlYWxlZENhdmUpO1xuICAgIENvcmRlbFBsYWluV2VzdC5tZXRhLmN1c3RvbUZsYWdzLnNldCgweDMwLCBPcGVuZWRTZWFsZWRDYXZlKTtcbiAgICBXYXRlcmZhbGxWYWxsZXlOb3J0aC5tZXRhLmN1c3RvbUZsYWdzLnNldCgweDMwLCBPcGVuZWRTZWFsZWRDYXZlKTtcbiAgICBjb25zdCBleHBsb3Npb24gPSBTcGF3bi5vZih7eTogMHgwNjAsIHg6IDB4MDYwLCB0eXBlOiA0LCBpZDogMHgyY30pO1xuICAgIGNvbnN0IGtleVRyaWdnZXIgPSBTcGF3bi5vZih7eTogMHgwNzAsIHg6IDB4MDcwLCB0eXBlOiAyLCBpZDogMHhhZH0pO1xuICAgIFdhdGVyZmFsbFZhbGxleU5vcnRoLnNwYXducy5zcGxpY2UoMSwgMCwgZXhwbG9zaW9uKTtcbiAgICBXYXRlcmZhbGxWYWxsZXlOb3J0aC5zcGF3bnMucHVzaChrZXlUcmlnZ2VyKTtcbiAgfVxuXG4gIC8vIHNlYS5nZXRUaWxlKDB4MGEpLmNvcHlGcm9tKDB4YTIpLnNldFRpbGVzKFssLDB4OTEsMHg5MV0pLnNldEF0dHJzKDApO1xuICAvLyBUaGlzIGRvZXMgb3BlbiB1cCBzY3JlZW4gJGNlIChkZXNlcnQgY2F2ZSBlbnRyYW5jZSkgZm9yIHVzZSBpbiB0aGUgc2VhLFxuICAvLyB3aGljaCBpcyBpbnRlcmVzdGluZyBiZWNhdXNlIHdoaXJscG9vbHMgY2FuJ3QgYmUgZmxvd24gcGFzdCAtIHdlJ2QgbmVlZFxuICAvLyB0byBhZGQgZmxhZ3MgdG8gY2xlYXIgdGhlIHdoaXJscG9vbHMsIGJ1dCBpdCB3b3VsZCBiZSBhIGNhdmUgdGhhdCdzXG4gIC8vIGJsb2NrZWQgb24gY2FsbWluZyB0aGUgc2VhLi4uXG5cbiAgLy8gV2UgY291bGQgYWRkIGEgbnVtYmVyIG9mIHNjcmVlbnMgdG8gdGhlIHNlYSBpZiB3ZSBjb3VsZCBtb3ZlIDVhLi41ZVxuICAvLyAod2hpY2ggY29sbGlkZXMgd2l0aCBtb3VudGFpbiBnYXRlcykuICA4OSw4YSw5MCw5OSw5ZCxkMSxkMiBhcmUgZnJlZVxuICAvLyBpbiA4MCAoZ3Jhc3MpLCA5MCAocml2ZXIpLCBhbmQgOWMgKGRlc2VydCkuICBUaGUgbWFpbiBwcm9ibGVtIGlzIHRoYXRcbiAgLy8gYXQgbGVhc3QgdGhlIGNhdmUgZW50cmFuY2VzIGRvbid0IHF1aXRlIHdvcmsgZm9yIHRoZXNlIC0gdGhleSBlbmQgdXBcbiAgLy8gaW4gc2hhbGxvdyB3YXRlciwgYXJlIGEgbGl0dGxlIHRvbyBzaG9ydCwgYW5kIGl0IHNlZW1zIHRvIGJlIGltcG9zc2libGVcbiAgLy8gdG8gcGljayBhIHBhbGV0dGUgdGhhdCBpcyBsaWdodCBibHVlIG9uIGJvdHRvbSBhbmQgYmxhY2sgb24gdG9wLlxuICAvL1xuICAvLyBPdGhlciBvcHRpb25zIGZvciB0aGUgc2VhIGFyZSAzNCwzOCwzYy4uM2Ygd2hpY2ggYXJlIG1hcnNoIHRpbGVzIGluXG4gIC8vIHJpdmVyIC0gd291bGQgb3BlbiB1cCBzb21lIG5hcnJvdyBwYXNzYWdlcyAoMzMsIFxuXG5cbiAgLy8gIHJvbS5tZXRhc2NyZWVucztcblxuICAvLyBmb3IgKGNvbnN0IHggb2YgT2JqZWN0LnZhbHVlcyhUSUxFU0VUX0ZJWEVTKSkge1xuICAvLyAgIGNvbnN0IGlkID0geC5pZDtcbiAgLy8gICBjb25zdCB0cyA9IHJvbS50aWxlc2V0c1tpZF07XG4gIC8vICAgY29uc3QgdGUgPSB0cy5lZmZlY3RzKCk7XG4gIC8vICAgZm9yIChjb25zdCB0c3RyIGluIHgpIHtcbiAgLy8gICAgIGNvbnN0IHQgPSBOdW1iZXIodHN0cik7XG4gIC8vICAgICBpZiAoaXNOYU4odCkpIGNvbnRpbnVlO1xuICAvLyAgICAgY29uc3QgeTogbnVtYmVyfHtiYXNlOiBudW1iZXJ9ID0gKHggYXMgYW55KVt0XTtcbiAgLy8gICAgIGNvbnN0IGJhc2UgPSB0eXBlb2YgeSA9PT0gJ251bWJlcicgPyB5IDogKHkgYXMgYW55KS5iYXNlO1xuICAvLyAgICAgY29uc3QgcmVzdDogYW55ID0gdHlwZW9mIHkgPT09ICdudW1iZXInID8ge30gOiB5O1xuICAvLyAgICAgdHMuYXR0cnNbdF0gPSB0cy5hdHRyc1tiYXNlXTtcbiAgLy8gICAgIHRlLmVmZmVjdHNbdF0gPSB0ZS5lZmZlY3RzW2Jhc2VdO1xuICAvLyAgICAgW3Jlc3QudGwsIHJlc3QudHIsIHJlc3QuYmwsIHJlc3QuYnJdLmZvckVhY2goKG0sIGkpID0+IHtcbiAgLy8gICAgICAgdHMudGlsZXNbaV1bdF0gPSB0cy50aWxlc1tpXVttICE9IG51bGwgPyBtIDogYmFzZV07XG4gIC8vICAgICB9KTtcbiAgLy8gICAgIGlmIChyZXN0Lm1vdmUpIHt9XG4gIC8vICAgICAvLyBpZiAocmVzdC50aWxlcykge1xuICAvLyAgICAgLy8gICByZXN0LnRpbGVzLmZvckVhY2goKHM6IG51bWJlciwgaTogbnVtYmVyKSA9PiB2b2lkICh0cy50aWxlc1tpXVt0XSA9IHMpKTtcbiAgLy8gICAgIC8vIH1cbiAgLy8gICB9XG4gIC8vIH1cbn1cblxuXG4vLyBjb25zdCBUSUxFU0VUX0ZJWEVTID0ge1xuLy8gICBncmFzczoge1xuLy8gICAgIGlkOiAweDgwLFxuLy8gICAgIDB4NDA6IDB4NTEsXG4vLyAgICAgMHg0MTogMHg1Mixcbi8vICAgICAweDQyOiAweDUzLFxuLy8gICAgIDB4NDM6IDB4NTQsXG4vLyAgICAgMHg0NDogMHg1NSxcbi8vICAgICAweDQ1OiAweDU2LFxuLy8gICAgIDB4NDY6IDB4NTgsXG4vLyAgICAgMHg0NzogMHg1OSxcbi8vICAgfSxcbi8vICAgZGVzZXJ0OiB7XG4vLyAgICAgaWQ6IDB4OWMsXG4vLyAgICAgMHg1YToge2Jhc2U6IDB4OTgsIGJsOiAweDk0LCBicjogMHg5NH0sXG4vLyAgICAgMHg1Yjoge2Jhc2U6IDB4ODAsIHRsOiAweGZkLCB0cjogMHhmY30sXG4vLyAgICAgMHg1Yzoge2Jhc2U6IDB4ODAsIGJsOiAweGZmLCBicjogMHhmZX0sXG4vLyAgICAgMHg1ZDoge2Jhc2U6IDB4ODAsIHRyOiAweGZmLCBicjogMHhmZH0sXG4vLyAgICAgMHg1ZToge2Jhc2U6IDB4ODAsIHRsOiAweGZlLCBibDogMHhmY30sXG4vLyAgICAgMHg2MzogMHg3MSxcbi8vICAgICAweDY4OiAweDcwLFxuLy8gICAgIDB4Njk6IDB4NjAsXG4vLyAgICAgMHg2YTogMHg2NSxcbi8vICAgICAweDZjOiAweDcwLFxuLy8gICAgIDB4NmU6IDB4NzYsXG4vLyAgICAgMHg2ZjogMHg3OCxcbi8vICAgfSxcbi8vIH0gYXMgY29uc3Q7XG5cbi8vIGNvbnN0IFNDUkVFTl9SRU1BUFMgPSBbXG4vLyAgIHt0aWxlc2V0czogWzB4OWNdLCBzcmM6IDB4NWIsIGRlc3Q6IDB4NWYsIHNjcmVlbnM6IFsweGNmXX0sXG4vLyBdO1xuLy8gY29uc3QgW10gPSBTQ1JFRU5fUkVNQVBTO1xuXG4vLyBUT0RPIC0gY29weSA1ZiA8LSA1YiBpbiA5YywgdGhlbiByZW1hcCBpbiBzY3JlZW4gY2Zcbi8vICAgICAgLSBiZXR0ZXIgbm90YXRpb24/XG4vLyBDb25zaWRlciBkb2luZyB0aGlzIHByb2dyYW1tYXRpY2FsbHksIHRob3VnaCB3ZSdkIHdhbnQgdG8gdXNlXG4vLyB0aGUgX2FjdHVhbF8gc2NyZWVuLXRpbGVzZXQgdXNhZ2VzIHJhdGhlciB0aGFuIGRlY2xhcmVkIG9wdGlvbnNcblxuLy8gY2xhc3MgWCB7XG4vLyAgIHJlYWRvbmx5IG06IE1ldGFzY3JlZW5zO1xuLy8gICBjb25zdHJ1Y3RvcihyOiBSb20pIHtcbi8vICAgICB0aGlzLm0gPSBuZXcgTWV0YXNjcmVlbnMocik7XG4vLyAgIH1cbi8vIH1cbiJdfQ==