import { Entity, EntityArray } from './entity.js';
import { Entrance } from './locationtables.js';
import { MessageId } from './messageid.js';
import { DIALOG_FLAGS, SPAWN_CONDITION_FLAGS, Address, Segment, hex, readBigEndian, seq, tuple, upperCamelToSpaces, free } from './util.js';
const { $04, $05, $0e, $1b, $fe } = Segment;
export class Npcs extends EntityArray {
    constructor(rom) {
        super(0xcd);
        this.rom = rom;
        this.GoaSoldier = new Npc(this, 0x0b);
        this.LeafElder = new Npc(this, 0x0d);
        this.LeafElderDaughter = new Npc(this, 0x11);
        this.LeafRabbit = new Npc(this, 0x13);
        this.WindmillGuard = new Npc(this, 0x14);
        this.SleepingWindmillGuard = new Npc(this, 0x15);
        this.Akahana = new Npc(this, 0x16);
        this.OakElder = new Npc(this, 0x1d);
        this.OakMother = new Npc(this, 0x1e);
        this.OakChild = new Npc(this, 0x1f);
        this.Aryllis = new Npc(this, 0x23);
        this.AmazonesGuard = new Npc(this, 0x25);
        this.AryllisRightAttendant = new Npc(this, 0x26);
        this.AryllisLeftAttendant = new Npc(this, 0x27);
        this.Nadare = new Npc(this, 0x28);
        this.SoldierGuard = new Npc(this, 0x2d);
        this.PortoaThroneRoomBackDoorGuard = new Npc(this, 0x33);
        this.PortoaPalaceFrontGuard = new Npc(this, 0x34);
        this.PortoaQueen = new PortoaQueen(this, 0x38);
        this.FortuneTeller = new Npc(this, 0x39);
        this.WaterfallCaveAdventurers = new Npc(this, 0x3a);
        this.JoelElder = new Npc(this, 0x3d);
        this.Clark = new Npc(this, 0x44);
        this.ShyronGuard = new Npc(this, 0x4e);
        this.Brokahana = new Npc(this, 0x54);
        this.SaharaBunny = new Npc(this, 0x59);
        this.Deo = new Npc(this, 0x5a);
        this.SaharaElder = new Npc(this, 0x5b);
        this.SaharaElderDaughter = new Npc(this, 0x5c);
        this.Zebu = new Npc(this, 0x5e);
        this.Tornel = new Npc(this, 0x5f);
        this.Stom = new Npc(this, 0x60);
        this.MesiaRecording = new Npc(this, 0x61);
        this.Asina = new Npc(this, 0x62);
        this.HurtDolphin = new Npc(this, 0x63);
        this.Fisherman = new Npc(this, 0x64);
        this.KensuInCabin = new Npc(this, 0x68);
        this.Dolphin = new Dolphin(this, 0x69);
        this.SleepingKensu = new Npc(this, 0x6b);
        this.KensuDisguisedAsDancer = new Npc(this, 0x6c);
        this.KensuDisguisedAsSoldier = new Npc(this, 0x6d);
        this.AztecaInShyron = new Npc(this, 0x6e);
        this.DeadAkahana = new Npc(this, 0x70);
        this.DeadStomsGirlfriend = new Npc(this, 0x71);
        this.DeadStom = new Npc(this, 0x72);
        this.KensuInSwan = new Npc(this, 0x74);
        this.SlimedKensu = new Npc(this, 0x75);
        this.FishermanDaughter = new Npc(this, 0x7b);
        this.Kensu = new Npc(this, 0x7e);
        this.AkahanaInBrynmaer = new Npc(this, 0x82);
        this.AztecaInPyramid = new Npc(this, 0x83);
        this.SaberaDisguisedAsMesia = new Npc(this, 0x84);
        this.StonedWaterfallCaveAdventurers = new Npc(this, 0x85);
        this.StonedAkahana = new Npc(this, 0x88);
        this.Mesia = new Npc(this, 0x8e);
        this.Vampire1 = new Npc(this, 0xc0);
        this.Insect = new Npc(this, 0xc1);
        this.Kelbesque1 = new Npc(this, 0xc2);
        this.Rage = new Npc(this, 0xc3);
        this.Kelbesque2 = new Npc(this, 0xc5);
        this.Sabera2 = new Npc(this, 0xc6);
        this.Mado2 = new Npc(this, 0xc7);
        this.Karmine = new Npc(this, 0xc8);
        this.StatueOfMoon = new Npc(this, 0xc9);
        this.StatueOfSun = new Npc(this, 0xca);
        this.Draygon = new Npc(this, 0xcb);
        this.Vampire2 = new Npc(this, 0xcc);
        for (const key in this) {
            const npc = this[key];
            if (!this.hasOwnProperty(key) || !(npc instanceof Npc))
                continue;
            this[npc.id] = npc;
            npc.name = upperCamelToSpaces(key);
        }
        for (let i = 0; i < 0xcd; i++) {
            if (!this[i]) {
                this[i] = new Npc(this, i);
            }
        }
        const movementBase = MOVEMENT_SCRIPT_TABLE_POINTER.readAddress(rom.prg);
        this.movementScripts = seq(16, i => {
            let addr = movementBase.plus(2 * i).readAddress(rom.prg).offset;
            const steps = [];
            while (rom.prg[addr] < 0x80) {
                steps.push(rom.prg[addr++]);
            }
            const terminate = rom.prg[addr];
            return { steps, terminate };
        });
    }
    write() {
        const a = this.rom.assembler();
        for (const npc of this) {
            if (!npc || !npc.used)
                continue;
            npc.assemble(a);
        }
        free(a, $1b, 0xaf04, 0xafa9);
        const pointerTable = [];
        a.segment('1b', 'fe', 'ff');
        let i = 0;
        for (const movement of this.movementScripts) {
            const addr = (a.reloc(`MovementScript_${hex(i++)}`), a.pc());
            a.byte(...movement.steps, movement.terminate);
            pointerTable.push(addr);
        }
        const pointerTableAddr = (a.reloc('MovementScriptTable'), a.pc());
        a.word(...pointerTable);
        MOVEMENT_SCRIPT_TABLE_POINTER.loc(a, 'MovementScriptTablePtr');
        a.word(pointerTableAddr);
        MOVEMENT_SCRIPT_TABLE_POINTER.plus(5).loc(a, 'MovementScriptTablePlus1Ptr');
        a.word({ op: '+', args: [pointerTableAddr, { op: 'num', num: 1 }] });
        return [a.module()];
    }
}
export class Npc extends Entity {
    constructor(npcs, id) {
        super(npcs.rom, id);
        this.npcs = npcs;
        this.spawnConditions = new Map();
        this.localDialogs = new Map();
        const rom = npcs.rom;
        if (id > 0xcc)
            throw new Error(`Unavailable: ${id}`);
        this._used = !UNUSED_NPCS.has(id) && (id < 0x8f || id >= 0xc0);
        let dialogBase = id < 0xc4 ? this.dialogPointer.readAddress(rom.prg) : null;
        if (dialogBase && dialogBase.org === 0x8b39)
            dialogBase = null;
        this.data = tuple(rom.prg, this.dataBase.offset, 4);
        const spawnBase = this.spawnPointer.readAddress(rom.prg);
        let i = spawnBase.offset;
        let loc;
        while (this.used && (loc = rom.prg[i++]) !== 0xff) {
            const flags = SPAWN_CONDITION_FLAGS.read(rom.prg, i);
            i += 2 * flags.length;
            this.spawnConditions.set(loc, flags);
        }
        this.globalDialogs = [];
        if (dialogBase) {
            let a = dialogBase.offset;
            while (true) {
                const [dialog, last] = GlobalDialog.parse(rom.prg, a);
                a += 4;
                if (dialog.condition)
                    this.globalDialogs.push(dialog);
                if (last)
                    break;
            }
            const locations = [];
            while (true) {
                const location = rom.prg[a++];
                if (location === 0xff)
                    break;
                locations.push([location, rom.prg[a++]]);
            }
            if (!locations.length)
                locations.push([-1, 0]);
            const base = a;
            for (const [location, offset] of locations) {
                const dialogs = [];
                this.localDialogs.set(location, dialogs);
                a = base + offset;
                while (true) {
                    const [dialog, last] = LocalDialog.parse(rom.prg, a);
                    a += dialog.byteLength();
                    dialogs.push(dialog);
                    if (last)
                        break;
                }
            }
        }
    }
    get dataBase() {
        const seg = this.id & 0x80 ? $05 : $04;
        const org = 0x80f0 | ((this.id & 0xfc) << 6) | ((this.id & 3) << 2);
        return Address.of(seg, org);
    }
    get spawnPointer() {
        return Address.of($0e, 0x85e0 + (this.id << 1));
    }
    get dialogPointer() {
        return Address.of($0e, 0x895d + (this.id << 1));
    }
    get used() { return this._used; }
    set used(used) {
        if (used && (this.id > 0x88 && this.id < 0xc0 && this.id !== 0x8e)) {
            throw new Error(`invalid: ${this.id}`);
        }
        this._used = used;
    }
    spawnConditionsBytes() {
        const bytes = [];
        for (const [loc, flags] of this.spawnConditions) {
            bytes.push(loc, ...SPAWN_CONDITION_FLAGS.bytes(flags));
        }
        bytes.push(0xff);
        return bytes;
    }
    dialog(location) {
        const id = location ? location.id : -1;
        const dialogs = this.localDialogs.get(id);
        if (dialogs)
            return dialogs;
        throw new Error(`No local dialog for NPC ${hex(this.id)} at ${hex(id)}`);
    }
    spawns(location) {
        const id = location.id;
        const conditions = this.spawnConditions.get(location.id);
        if (conditions)
            return conditions;
        throw new Error(`No spawn condition for NPC ${hex(this.id)} at ${hex(id)}`);
    }
    hasDialog() {
        const result = Boolean(this.globalDialogs.length || this.localDialogs.size);
        if (this.id > 0x8e && this.id !== 0xc3 && result) {
            throw new Error(`invalid: ${this.id}`);
        }
        return result;
    }
    *allDialogs() {
        yield* this.globalDialogs;
        for (const ds of this.localDialogs.values()) {
            yield* ds;
        }
    }
    dialogBytes() {
        if (!this.hasDialog())
            return [];
        const bytes = [];
        function serialize(ds) {
            const out = [];
            for (let i = 0; i < ds.length; i++) {
                out.push(...ds[i].bytes(i === ds.length - 1));
            }
            return out;
        }
        if (this.globalDialogs.length) {
            bytes.push(...serialize(this.globalDialogs));
        }
        else {
            bytes.push(0x80, 0, 0, 0);
        }
        const locals = [];
        const cache = new Map();
        for (const [location, dialogs] of this.localDialogs) {
            const localBytes = serialize(dialogs);
            const label = localBytes.join(',');
            const cached = cache.get(label);
            if (cached != null) {
                bytes.push(location, cached);
                continue;
            }
            cache.set(label, locals.length);
            if (location !== -1)
                bytes.push(location, locals.length);
            locals.push(...localBytes);
        }
        if (locals.length)
            bytes.push(0xff, ...locals);
        return bytes;
    }
    link(id) {
        const other = this.rom.npcs[id];
        this.spawnConditions = other.spawnConditions;
        this.linkDialog(id);
    }
    linkDialog(id) {
        const other = this.rom.npcs[id];
        this.globalDialogs = other.globalDialogs;
        this.localDialogs = other.localDialogs;
    }
    localDialog(location, index) {
        if (index == null) {
            index = location;
            location = -1;
        }
        const dialogs = this.localDialogs.get(location);
        if (dialogs == null || index >= dialogs.length) {
            throw new Error(`No local dialog ${index} for location ${hex(location)}`);
        }
        return dialogs[index];
    }
    isParalyzable() {
        for (let i = 0x35058; i < 0x3506c; i++) {
            if (this.rom.prg[i] === this.id)
                return false;
        }
        return true;
    }
    assemble(a) {
        if (!this.used)
            return;
        const id = hex(this.id);
        this.dataBase.loc(a, 'PersonData_${id}');
        a.byte(...this.data);
        a.segment('0e', 'fe', 'ff');
        a.reloc(`SpawnCondition_${id}`);
        const spawn = a.pc();
        a.byte(...this.spawnConditionsBytes());
        this.spawnPointer.loc(a, `SpawnCondition_${id}_Pointer`);
        a.word(spawn);
        if (this.hasDialog()) {
            a.segment('0e', 'fe', 'ff');
            a.reloc(`Dialog_${id}`);
            const dialog = a.pc();
            a.byte(...this.dialogBytes());
            this.dialogPointer.loc(a, `Dialog_${id}_Pointer`);
            a.word(dialog);
        }
    }
}
export class GlobalDialog {
    constructor(condition, message) {
        this.condition = condition;
        this.message = message;
    }
    static of(condition, message) {
        const [part, index, action = 0] = message;
        return new GlobalDialog(condition, MessageId.of({ part, index, action }));
    }
    static parse(data, offset = 0) {
        const flag = readBigEndian(data, offset);
        const message = MessageId.from(data, offset + 2);
        let condition = flag & 0x03ff;
        const last = !!(flag & 0x8000);
        const sign = flag & 0x2000;
        if (sign)
            condition = ~condition;
        return [new GlobalDialog(condition, message), last];
    }
    bytes(last) {
        let flag = this.condition;
        if (flag < 0)
            flag = (~flag) | 0x2000;
        if (last)
            flag |= 0x8000;
        return [flag >>> 8, flag & 0xff, ...this.message.data];
    }
}
export class LocalDialog {
    constructor(condition, message, update, flags) {
        this.condition = condition;
        this.message = message;
        this.update = update;
        this.flags = flags;
    }
    clone() {
        return LocalDialog.parse(this.bytes(false))[0];
    }
    static parse(data, offset = 0) {
        const word = readBigEndian(data, offset);
        const message = MessageId.from(data, offset + 2);
        const update = data[offset + 4];
        offset += 5;
        let condition = word & 0x03ff;
        const last = !!(word & 0x8000);
        const sign = word & 0x2000;
        if (sign)
            condition = ~condition;
        const flags = word & 0x4000 ? DIALOG_FLAGS.read(data, offset) : [];
        return [new LocalDialog(condition, message, update, flags), last];
    }
    static of(condition, message, flags = []) {
        const [part, index, action = 0] = message;
        return new LocalDialog(condition, MessageId.of({ part, index, action }), 0, flags);
    }
    byteLength() {
        return 5 + 2 * this.flags.length;
    }
    bytes(last) {
        let flag = this.condition;
        if (flag < 0)
            flag = (~flag) | 0x2000;
        if (last)
            flag |= 0x8000;
        if (this.flags.length)
            flag |= 0x4000;
        return [flag >>> 8, flag & 0xff, ...this.message.data, this.update,
            ...DIALOG_FLAGS.bytes(this.flags)];
    }
}
const UNUSED_NPCS = new Set([
    0x31, 0x3b, 0x3c, 0x66, 0x67, 0x6a, 0x73, 0x74,
    0x82, 0x86, 0x87, 0x89, 0x8a, 0x8b, 0x8c, 0x8d,
    0xc4,
]);
export class PortoaQueen extends Npc {
    get expectedSword() { return this.localDialog(3).condition & 0xff; }
    set expectedSword(id) { this.localDialog(3).condition = 0x200 | id; }
}
export class Dolphin extends Npc {
    constructor(parent, id) {
        super(parent, id);
        const prg = parent.rom.prg;
        const spawnTableBase = DOLPHIN_SPAWN_TABLE_POINTER.readAddress(prg).offset;
        const read = (i) => {
            const entrance = Entrance.from(prg, spawnTableBase + 5 * i);
            const movement = prg[spawnTableBase + 5 * i + 4];
            return { entrance, movement };
        };
        this.spawnScripts = seq(9, read);
        this.channelSpawn = mustBeInt(DOLPHIN_CHANNEL_SPAWN.read(prg) / 5);
        this.evilSpiritIslandSpawn =
            mustBeInt(DOLPHIN_EVIL_SPIRIT_ISLAND_SPAWN.read(prg) / 5);
    }
    assemble(a) {
        super.assemble(a);
        a.segment('fe');
        a.org(0xd6a8);
        a.free(45);
        a.segment('fe', 'ff');
        a.reloc('DolphinSpawnTable');
        const table = a.pc();
        while (!this.spawnScripts[this.spawnScripts.length - 1].entrance.used) {
            this.spawnScripts.pop();
        }
        for (let i = 0; i < this.rom.locations.AngrySea.entrances.length; i++) {
            const s = this.spawnScripts[i];
            if (s) {
                a.byte(...s.entrance.data, s.movement);
            }
            else {
                a.byte(0xff, 0x0f, 0xff, 0x0f, 0x0f);
            }
        }
        DOLPHIN_CHANNEL_SPAWN.loc(a, 'DolphinChannelSpawn');
        a.byte(this.channelSpawn * 5);
        DOLPHIN_EVIL_SPIRIT_ISLAND_SPAWN.loc(a, 'DolphinEvilSpiritIslandSpawn');
        a.byte(this.evilSpiritIslandSpawn * 5);
        DOLPHIN_SPAWN_TABLE_POINTER.loc(a, 'DolphinSpawnTablePtr');
        a.word(table);
        for (let i = 0; i < 4; i++) {
            DOLPHIN_SPAWN_TABLE_POINTER_1.plus(5 * i)
                .loc(a, `DolphinSpawnTablePlus${i + 1}Ptr`);
            a.word({ op: '+', args: [table, { op: 'num', num: i + 1 }] });
        }
    }
}
export var MovementScript;
(function (MovementScript) {
    MovementScript.UP = 0;
    MovementScript.RIGHT = 2;
    MovementScript.DOWN = 4;
    MovementScript.LEFT = 6;
    MovementScript.DOLPHIN = 0xff;
    MovementScript.DESPAWN = 0xfe;
})(MovementScript || (MovementScript = {}));
const DOLPHIN_CHANNEL_SPAWN = Address.of($fe, 0xd664);
const DOLPHIN_EVIL_SPIRIT_ISLAND_SPAWN = Address.of($fe, 0xd66c);
const DOLPHIN_SPAWN_TABLE_POINTER = Address.of($fe, 0xd67a);
const DOLPHIN_SPAWN_TABLE_POINTER_1 = Address.of($fe, 0xd68e);
const MOVEMENT_SCRIPT_TABLE_POINTER = Address.of($1b, 0xae53);
function mustBeInt(x) {
    if (x !== Math.floor(x))
        throw new Error(`Expected integer: ${x}`);
    return x;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnBjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3JvbS9ucGMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFDLE1BQU0sRUFBRSxXQUFXLEVBQUMsTUFBTSxhQUFhLENBQUM7QUFDaEQsT0FBTyxFQUFDLFFBQVEsRUFBQyxNQUFNLHFCQUFxQixDQUFDO0FBRTdDLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6QyxPQUFPLEVBQUMsWUFBWSxFQUFFLHFCQUFxQixFQUNuQyxPQUFPLEVBQVEsT0FBTyxFQUM1QixHQUFHLEVBQUUsYUFBYSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQUUsSUFBSSxFQUFDLE1BQU0sV0FBVyxDQUFDO0FBRzdFLE1BQU0sRUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFDLEdBQUcsT0FBTyxDQUFDO0FBSTFDLE1BQU0sT0FBTyxJQUFLLFNBQVEsV0FBZ0I7SUF1R3hDLFlBQXFCLEdBQVE7UUFDM0IsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRE8sUUFBRyxHQUFILEdBQUcsQ0FBSztRQXJHN0IsZUFBVSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUVqQyxjQUFTLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBRWhDLHNCQUFpQixHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUV4QyxlQUFVLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2pDLGtCQUFhLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3BDLDBCQUFxQixHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJ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S0FBSyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7U0FDM0Q7SUFDSCxDQUFDO0NBQ0Y7QUFXRCxNQUFNLEtBQVcsY0FBYyxDQU85QjtBQVBELFdBQWlCLGNBQWM7SUFDaEIsaUJBQUUsR0FBRyxDQUFDLENBQUM7SUFDUCxvQkFBSyxHQUFHLENBQUMsQ0FBQztJQUNWLG1CQUFJLEdBQUcsQ0FBQyxDQUFDO0lBQ1QsbUJBQUksR0FBRyxDQUFDLENBQUM7SUFDVCxzQkFBTyxHQUFHLElBQUksQ0FBQztJQUNmLHNCQUFPLEdBQUcsSUFBSSxDQUFDO0FBQzlCLENBQUMsRUFQZ0IsY0FBYyxLQUFkLGNBQWMsUUFPOUI7QUFFRCxNQUFNLHFCQUFxQixHQUFHLE9BQU8sQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQ3RELE1BQU0sZ0NBQWdDLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDakUsTUFBTSwyQkFBMkIsR0FBRyxPQUFPLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUM1RCxNQUFNLDZCQUE2QixHQUFHLE9BQU8sQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0FBQzlELE1BQU0sNkJBQTZCLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFFOUQsU0FBUyxTQUFTLENBQUMsQ0FBUztJQUMxQixJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMscUJBQXFCLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDbkUsT0FBTyxDQUFDLENBQUM7QUFDWCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBc3NlbWJsZXJ9IGZyb20gJy4uL2FzbS9hc3NlbWJsZXIuanMnO1xuaW1wb3J0IHtNb2R1bGV9IGZyb20gJy4uL2FzbS9tb2R1bGUuanMnO1xuaW1wb3J0IHtFbnRpdHksIEVudGl0eUFycmF5fSBmcm9tICcuL2VudGl0eS5qcyc7XG5pbXBvcnQge0VudHJhbmNlfSBmcm9tICcuL2xvY2F0aW9udGFibGVzLmpzJztcbmltcG9ydCB7TG9jYXRpb259IGZyb20gJy4vbG9jYXRpb24uanMnO1xuaW1wb3J0IHtNZXNzYWdlSWR9IGZyb20gJy4vbWVzc2FnZWlkLmpzJztcbmltcG9ydCB7RElBTE9HX0ZMQUdTLCBTUEFXTl9DT05ESVRJT05fRkxBR1MsXG4gICAgICAgIEFkZHJlc3MsIERhdGEsIFNlZ21lbnQsXG4gIGhleCwgcmVhZEJpZ0VuZGlhbiwgc2VxLCB0dXBsZSwgdXBwZXJDYW1lbFRvU3BhY2VzLCBmcmVlfSBmcm9tICcuL3V0aWwuanMnO1xuaW1wb3J0IHtSb219IGZyb20gJy4uL3JvbS5qcyc7XG5cbmNvbnN0IHskMDQsICQwNSwgJDBlLCAkMWIsICRmZX0gPSBTZWdtZW50O1xuXG50eXBlIEZsYWdMaXN0ID0gbnVtYmVyW107XG5cbmV4cG9ydCBjbGFzcyBOcGNzIGV4dGVuZHMgRW50aXR5QXJyYXk8TnBjPiB7XG4gIC8vIGdlbmVyaWMgMDAuLjBhXG4gIEdvYVNvbGRpZXIgPSBuZXcgTnBjKHRoaXMsIDB4MGIpO1xuICAvLyBnZW5lcmljIDBjXG4gIExlYWZFbGRlciA9IG5ldyBOcGModGhpcywgMHgwZCk7XG4gIC8vIGdlbmVyaWMgbGVhZiAwZS4uMTBcbiAgTGVhZkVsZGVyRGF1Z2h0ZXIgPSBuZXcgTnBjKHRoaXMsIDB4MTEpO1xuICAvLyBnZW5lcmljIGxlYWYgMTJcbiAgTGVhZlJhYmJpdCA9IG5ldyBOcGModGhpcywgMHgxMyk7XG4gIFdpbmRtaWxsR3VhcmQgPSBuZXcgTnBjKHRoaXMsIDB4MTQpO1xuICBTbGVlcGluZ1dpbmRtaWxsR3VhcmQgPSBuZXcgTnBjKHRoaXMsIDB4MTUpO1xuICBBa2FoYW5hID0gbmV3IE5wYyh0aGlzLCAweDE2KTtcbiAgLy8gZ2VuZXJpYyBicnlubWFlciAxNy4uMWNcbiAgT2FrRWxkZXIgPSBuZXcgTnBjKHRoaXMsIDB4MWQpO1xuICBPYWtNb3RoZXIgPSBuZXcgTnBjKHRoaXMsIDB4MWUpO1xuICBPYWtDaGlsZCA9IG5ldyBOcGModGhpcywgMHgxZik7XG4gIC8vIGdlbmVyaWMgb2FrIDIwLi4yMlxuICBBcnlsbGlzID0gbmV3IE5wYyh0aGlzLCAweDIzKTtcbiAgLy8gZ2VuZXJpYyBhbWF6b25lcyAyNFxuICBBbWF6b25lc0d1YXJkID0gbmV3IE5wYyh0aGlzLCAweDI1KTtcbiAgQXJ5bGxpc1JpZ2h0QXR0ZW5kYW50ID0gbmV3IE5wYyh0aGlzLCAweDI2KTtcbiAgQXJ5bGxpc0xlZnRBdHRlbmRhbnQgPSBuZXcgTnBjKHRoaXMsIDB4MjcpO1xuICBOYWRhcmUgPSBuZXcgTnBjKHRoaXMsIDB4MjgpO1xuICAvLyBnZW5lcmljIG5hZGFyZSAyOS4uMmNcbiAgU29sZGllckd1YXJkID0gbmV3IE5wYyh0aGlzLCAweDJkKTsgLy8gc3dhbiwgbXQgc2FicmVcbiAgLy8gc2hvcGtlZXBlciBwcmlzb25lcnMgMmUuLjMwXG4gIC8vIHVudXNlZCAzMVxuICAvLyBnZW5lcmljIHBvcnRvYSBwYWxhY2UgMzJcbiAgUG9ydG9hVGhyb25lUm9vbUJhY2tEb29yR3VhcmQgPSBuZXcgTnBjKHRoaXMsIDB4MzMpO1xuICBQb3J0b2FQYWxhY2VGcm9udEd1YXJkID0gbmV3IE5wYyh0aGlzLCAweDM0KTtcbiAgLy8gZ2VuZXJpYyBwb3J0b2EgcGFsYWNlIDM1Li4zN1xuICBQb3J0b2FRdWVlbiA9IG5ldyBQb3J0b2FRdWVlbih0aGlzLCAweDM4KTtcbiAgRm9ydHVuZVRlbGxlciA9IG5ldyBOcGModGhpcywgMHgzOSk7XG4gIFdhdGVyZmFsbENhdmVBZHZlbnR1cmVycyA9IG5ldyBOcGModGhpcywgMHgzYSk7XG4gIC8vIHVudXNlZCAzYi4uM2NcbiAgSm9lbEVsZGVyID0gbmV3IE5wYyh0aGlzLCAweDNkKTtcbiAgLy8gZ2VuZXJpYyBqb2VsIDNlLi40M1xuICBDbGFyayA9IG5ldyBOcGModGhpcywgMHg0NCk7XG4gIC8vIGdlbmVyaWMgem9tYmllIHRvd24gNDUuLjQ3XG4gIC8vIGdlbmVyaWMgc3dhbiA0OS4uNGRcbiAgU2h5cm9uR3VhcmQgPSBuZXcgTnBjKHRoaXMsIDB4NGUpO1xuICAvLyBnZW5lcmljIHNoeXJvbiA0Zi4uNTNcbiAgQnJva2FoYW5hID0gbmV3IE5wYyh0aGlzLCAweDU0KTtcbiAgLy8gZ2VuZXJpYyBnb2EgNTUuLjU4XG4gIFNhaGFyYUJ1bm55ID0gbmV3IE5wYyh0aGlzLCAweDU5KTtcbiAgRGVvID0gbmV3IE5wYyh0aGlzLCAweDVhKTtcbiAgU2FoYXJhRWxkZXIgPSBuZXcgTnBjKHRoaXMsIDB4NWIpO1xuICBTYWhhcmFFbGRlckRhdWdodGVyID0gbmV3IE5wYyh0aGlzLCAweDVjKTtcbiAgLy8gZ2VuZXJpYyA1ZFxuICBaZWJ1ID0gbmV3IE5wYyh0aGlzLCAweDVlKTtcbiAgVG9ybmVsID0gbmV3IE5wYyh0aGlzLCAweDVmKTtcbiAgU3RvbSA9IG5ldyBOcGModGhpcywgMHg2MCk7XG4gIE1lc2lhUmVjb3JkaW5nID0gbmV3IE5wYyh0aGlzLCAweDYxKTtcbiAgQXNpbmEgPSBuZXcgTnBjKHRoaXMsIDB4NjIpO1xuICBIdXJ0RG9scGhpbiA9IG5ldyBOcGModGhpcywgMHg2Myk7XG4gIEZpc2hlcm1hbiA9IG5ldyBOcGModGhpcywgMHg2NCk7XG4gIC8vIGdlbmVyaWMvdW5zZWQgNjUuLjY3XG4gIEtlbnN1SW5DYWJpbiA9IG5ldyBOcGModGhpcywgMHg2OCk7XG4gIERvbHBoaW4gPSBuZXcgRG9scGhpbih0aGlzLCAweDY5KTtcbiAgLy8gdW51c2VkIDZhXG4gIFNsZWVwaW5nS2Vuc3UgPSBuZXcgTnBjKHRoaXMsIDB4NmIpO1xuICBLZW5zdURpc2d1aXNlZEFzRGFuY2VyID0gbmV3IE5wYyh0aGlzLCAweDZjKTtcbiAgS2Vuc3VEaXNndWlzZWRBc1NvbGRpZXIgPSBuZXcgTnBjKHRoaXMsIDB4NmQpO1xuICBBenRlY2FJblNoeXJvbiA9IG5ldyBOcGModGhpcywgMHg2ZSk7XG4gIC8vIGdlbmVyaWMgNmZcbiAgRGVhZEFrYWhhbmEgPSBuZXcgTnBjKHRoaXMsIDB4NzApO1xuICBEZWFkU3RvbXNHaXJsZnJpZW5kID0gbmV3IE5wYyh0aGlzLCAweDcxKTtcbiAgRGVhZFN0b20gPSBuZXcgTnBjKHRoaXMsIDB4NzIpO1xuICAvLyB1bnVzZWQgNzNcbiAgS2Vuc3VJblN3YW4gPSBuZXcgTnBjKHRoaXMsIDB4NzQpOyAvLyBub3RlOiB1bnVzZWQgaW4gdmFuaWxsYSAoN2UpXG4gIFNsaW1lZEtlbnN1ID0gbmV3IE5wYyh0aGlzLCAweDc1KTtcbiAgLy8gZ2VuZXJpYyA3Ni4uN2FcbiAgRmlzaGVybWFuRGF1Z2h0ZXIgPSBuZXcgTnBjKHRoaXMsIDB4N2IpO1xuICAvLyBnZW5lcmljIDdjLi43ZFxuICBLZW5zdSA9IG5ldyBOcGModGhpcywgMHg3ZSk7XG4gIC8vIGdlbmVyaWMvdW51c2VkIDdmLi44MlxuICBBa2FoYW5hSW5CcnlubWFlciA9IG5ldyBOcGModGhpcywgMHg4Mik7IC8vIG5vdGU6IHVudXNlZCBpbiB2YW5pbGxhICgxNilcbiAgQXp0ZWNhSW5QeXJhbWlkID0gbmV3IE5wYyh0aGlzLCAweDgzKTtcbiAgU2FiZXJhRGlzZ3Vpc2VkQXNNZXNpYSA9IG5ldyBOcGModGhpcywgMHg4NCk7XG4gIFN0b25lZFdhdGVyZmFsbENhdmVBZHZlbnR1cmVycyA9IG5ldyBOcGModGhpcywgMHg4NSk7XG4gIC8vIHVudXNlZCA4Ni4uODdcbiAgU3RvbmVkQWthaGFuYSA9IG5ldyBOcGModGhpcywgMHg4OCk7XG4gIC8vIHVudXNlZCA4OS4uOGRcbiAgTWVzaWEgPSBuZXcgTnBjKHRoaXMsIDB4OGUpO1xuXG4gIC8vIHVudXNhYmxlIDhmLi5iZiAod2UndmUgY28tb3B0ZWQgdGhhdCBQUkcgc3BhY2UgZm9yIG5vdylcblxuICBWYW1waXJlMSA9IG5ldyBOcGModGhpcywgMHhjMCk7XG4gIEluc2VjdCA9IG5ldyBOcGModGhpcywgMHhjMSk7XG4gIEtlbGJlc3F1ZTEgPSBuZXcgTnBjKHRoaXMsIDB4YzIpO1xuICBSYWdlID0gbmV3IE5wYyh0aGlzLCAweGMzKTtcbiAgLy8gdW51c2VkIC0gTWFkbzEgPSBuZXcgTnBjKHRoaXMsIDB4YzQpO1xuICBLZWxiZXNxdWUyID0gbmV3IE5wYyh0aGlzLCAweGM1KTtcbiAgU2FiZXJhMiA9IG5ldyBOcGModGhpcywgMHhjNik7XG4gIE1hZG8yID0gbmV3IE5wYyh0aGlzLCAweGM3KTtcbiAgS2FybWluZSA9IG5ldyBOcGModGhpcywgMHhjOCk7XG4gIFN0YXR1ZU9mTW9vbiA9IG5ldyBOcGModGhpcywgMHhjOSk7XG4gIFN0YXR1ZU9mU3VuID0gbmV3IE5wYyh0aGlzLCAweGNhKTtcbiAgRHJheWdvbiA9IG5ldyBOcGModGhpcywgMHhjYik7XG4gIFZhbXBpcmUyID0gbmV3IE5wYyh0aGlzLCAweGNjKTtcblxuICBtb3ZlbWVudFNjcmlwdHM6IE1vdmVtZW50U2NyaXB0W107XG5cbiAgY29uc3RydWN0b3IocmVhZG9ubHkgcm9tOiBSb20pIHtcbiAgICBzdXBlcigweGNkKTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzKSB7XG4gICAgICBjb25zdCBucGMgPSB0aGlzW2tleV07XG4gICAgICBpZiAoIXRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSB8fCAhKG5wYyBpbnN0YW5jZW9mIE5wYykpIGNvbnRpbnVlO1xuICAgICAgdGhpc1tucGMuaWRdID0gbnBjO1xuICAgICAgbnBjLm5hbWUgPSB1cHBlckNhbWVsVG9TcGFjZXMoa2V5KTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAweGNkOyBpKyspIHtcbiAgICAgIGlmICghdGhpc1tpXSkge1xuICAgICAgICB0aGlzW2ldID0gbmV3IE5wYyh0aGlzLCBpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gUmVhZCBhbGwgdGhlIG1vdmVtZW50IHNjcmlwdHNcbiAgICBjb25zdCBtb3ZlbWVudEJhc2UgPSBNT1ZFTUVOVF9TQ1JJUFRfVEFCTEVfUE9JTlRFUi5yZWFkQWRkcmVzcyhyb20ucHJnKTtcbiAgICB0aGlzLm1vdmVtZW50U2NyaXB0cyA9IHNlcSgxNiwgaSA9PiB7XG4gICAgICBsZXQgYWRkciA9IG1vdmVtZW50QmFzZS5wbHVzKDIgKiBpKS5yZWFkQWRkcmVzcyhyb20ucHJnKS5vZmZzZXQ7XG4gICAgICBjb25zdCBzdGVwczogbnVtYmVyW10gPSBbXTtcbiAgICAgIHdoaWxlIChyb20ucHJnW2FkZHJdIDwgMHg4MCkge1xuICAgICAgICBzdGVwcy5wdXNoKHJvbS5wcmdbYWRkcisrXSk7XG4gICAgICB9XG4gICAgICBjb25zdCB0ZXJtaW5hdGUgPSByb20ucHJnW2FkZHJdO1xuICAgICAgcmV0dXJuIHtzdGVwcywgdGVybWluYXRlfTtcbiAgICB9KTtcbiAgfVxuXG4gIHdyaXRlKCk6IE1vZHVsZVtdIHtcbiAgICAvLyBXcml0ZSBhbGwgdGhlIE5QQ3NcbiAgICBjb25zdCBhID0gdGhpcy5yb20uYXNzZW1ibGVyKCk7XG4gICAgZm9yIChjb25zdCBucGMgb2YgdGhpcykge1xuICAgICAgaWYgKCFucGMgfHwgIW5wYy51c2VkKSBjb250aW51ZTtcbiAgICAgIG5wYy5hc3NlbWJsZShhKTtcbiAgICB9XG4gICAgLy8gRnJlZSB0aGUgc3BhY2UgZnJvbSB0aGUgb3JpZ2luYWwgbW92ZW1lbnQgc2NyaXB0c1xuICAgIGZyZWUoYSwgJDFiLCAweGFmMDQsIDB4YWZhOSk7XG4gICAgLy8gV3JpdGUgdGhlIG1vdmVtZW50IHNjcmlwdHNcbiAgICBjb25zdCBwb2ludGVyVGFibGUgPSBbXTtcbiAgICBhLnNlZ21lbnQoJzFiJywgJ2ZlJywgJ2ZmJyk7XG4gICAgbGV0IGkgPSAwO1xuICAgIGZvciAoY29uc3QgbW92ZW1lbnQgb2YgdGhpcy5tb3ZlbWVudFNjcmlwdHMpIHtcbiAgICAgIGNvbnN0IGFkZHIgPSAoYS5yZWxvYyhgTW92ZW1lbnRTY3JpcHRfJHtoZXgoaSsrKX1gKSwgYS5wYygpKTtcbiAgICAgIGEuYnl0ZSguLi5tb3ZlbWVudC5zdGVwcywgbW92ZW1lbnQudGVybWluYXRlKTtcbiAgICAgIHBvaW50ZXJUYWJsZS5wdXNoKGFkZHIpO1xuICAgIH1cbiAgICBjb25zdCBwb2ludGVyVGFibGVBZGRyID0gKGEucmVsb2MoJ01vdmVtZW50U2NyaXB0VGFibGUnKSwgYS5wYygpKTtcbiAgICBhLndvcmQoLi4ucG9pbnRlclRhYmxlKTtcbiAgICBNT1ZFTUVOVF9TQ1JJUFRfVEFCTEVfUE9JTlRFUi5sb2MoYSwgJ01vdmVtZW50U2NyaXB0VGFibGVQdHInKTtcbiAgICBhLndvcmQocG9pbnRlclRhYmxlQWRkcik7XG4gICAgTU9WRU1FTlRfU0NSSVBUX1RBQkxFX1BPSU5URVIucGx1cyg1KS5sb2MoYSwgJ01vdmVtZW50U2NyaXB0VGFibGVQbHVzMVB0cicpO1xuICAgIGEud29yZCh7b3A6ICcrJywgYXJnczogW3BvaW50ZXJUYWJsZUFkZHIsIHtvcDogJ251bScsIG51bTogMX1dfSk7XG4gICAgLy8gUmV0dXJuIHRoZSByZXN1bHRcbiAgICByZXR1cm4gW2EubW9kdWxlKCldO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOcGMgZXh0ZW5kcyBFbnRpdHkge1xuXG4gIHByaXZhdGUgX3VzZWQ6IGJvb2xlYW47XG4gIG5hbWU/OiBzdHJpbmc7XG4gIGl0ZW1OYW1lcz86IFtzdHJpbmcsIHN0cmluZ107XG5cbiAgZGF0YTogW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlcl07IC8vIHVpbnQ4XG4gIC8vIEZsYWdzIHRvIGNoZWNrIHBlciBsb2NhdGlvbjogcG9zaXRpdmUgbWVhbnMgXCJtdXN0IGJlIHNldFwiXG4gIHNwYXduQ29uZGl0aW9ucyA9IG5ldyBNYXA8bnVtYmVyLCBGbGFnTGlzdD4oKTsgLy8ga2V5IHVpbnQ4XG5cbiAgZ2xvYmFsRGlhbG9nczogR2xvYmFsRGlhbG9nW107XG4gIGxvY2FsRGlhbG9ncyA9IG5ldyBNYXA8bnVtYmVyLCBMb2NhbERpYWxvZ1tdPigpO1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IG5wY3M6IE5wY3MsIGlkOiBudW1iZXIpIHtcbiAgICBzdXBlcihucGNzLnJvbSwgaWQpO1xuICAgIGNvbnN0IHJvbSA9IG5wY3Mucm9tO1xuICAgIGlmIChpZCA+IDB4Y2MpIHRocm93IG5ldyBFcnJvcihgVW5hdmFpbGFibGU6ICR7aWR9YCk7XG4gICAgLy8gVE9ETyAtIGNoZWNrICh0aGlzLmJhc2UgPD0gMHgxYzc4MSkgZm9yIHVudXNlZD9cbiAgICB0aGlzLl91c2VkID0gIVVOVVNFRF9OUENTLmhhcyhpZCkgJiYgKGlkIDwgMHg4ZiB8fCBpZCA+PSAweGMwKTtcbiAgICBsZXQgZGlhbG9nQmFzZSA9IGlkIDwgMHhjNCA/IHRoaXMuZGlhbG9nUG9pbnRlci5yZWFkQWRkcmVzcyhyb20ucHJnKSA6IG51bGw7XG4gICAgaWYgKGRpYWxvZ0Jhc2UgJiYgZGlhbG9nQmFzZS5vcmcgPT09IDB4OGIzOSkgZGlhbG9nQmFzZSA9IG51bGw7XG5cbiAgICB0aGlzLmRhdGEgPSB0dXBsZShyb20ucHJnLCB0aGlzLmRhdGFCYXNlLm9mZnNldCwgNCk7XG5cbiAgICBjb25zdCBzcGF3bkJhc2UgPSB0aGlzLnNwYXduUG9pbnRlci5yZWFkQWRkcmVzcyhyb20ucHJnKTtcblxuICAgIC8vIFBvcHVsYXRlIHNwYXduIGNvbmRpdGlvbnNcbiAgICBsZXQgaSA9IHNwYXduQmFzZS5vZmZzZXQ7XG4gICAgbGV0IGxvYztcbiAgICB3aGlsZSAodGhpcy51c2VkICYmIChsb2MgPSByb20ucHJnW2krK10pICE9PSAweGZmKSB7XG4gICAgICBjb25zdCBmbGFncyA9IFNQQVdOX0NPTkRJVElPTl9GTEFHUy5yZWFkKHJvbS5wcmcsIGkpO1xuICAgICAgaSArPSAyICogZmxhZ3MubGVuZ3RoO1xuICAgICAgdGhpcy5zcGF3bkNvbmRpdGlvbnMuc2V0KGxvYywgZmxhZ3MpO1xuICAgIH1cblxuICAgIC8vIFBvcHVsYXRlIHRoZSBkaWFsb2cgdGFibGVcbiAgICB0aGlzLmdsb2JhbERpYWxvZ3MgPSBbXTtcbiAgICBpZiAoZGlhbG9nQmFzZSkge1xuICAgICAgbGV0IGEgPSBkaWFsb2dCYXNlLm9mZnNldDtcbiAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGNvbnN0IFtkaWFsb2csIGxhc3RdID0gR2xvYmFsRGlhbG9nLnBhcnNlKHJvbS5wcmcsIGEpO1xuICAgICAgICBhICs9IDQ7XG4gICAgICAgIGlmIChkaWFsb2cuY29uZGl0aW9uKSB0aGlzLmdsb2JhbERpYWxvZ3MucHVzaChkaWFsb2cpO1xuICAgICAgICBpZiAobGFzdCkgYnJlYWs7XG4gICAgICB9XG4gICAgICAvLyBSZWFkIHRoZSBsb2NhdGlvbiB0YWJsZVxuICAgICAgY29uc3QgbG9jYXRpb25zOiBbbnVtYmVyLCBudW1iZXJdW10gPSBbXTtcbiAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGNvbnN0IGxvY2F0aW9uID0gcm9tLnByZ1thKytdO1xuICAgICAgICBpZiAobG9jYXRpb24gPT09IDB4ZmYpIGJyZWFrO1xuICAgICAgICBsb2NhdGlvbnMucHVzaChbbG9jYXRpb24sIHJvbS5wcmdbYSsrXV0pO1xuICAgICAgfVxuICAgICAgaWYgKCFsb2NhdGlvbnMubGVuZ3RoKSBsb2NhdGlvbnMucHVzaChbLTEsIDBdKTtcbiAgICAgIC8vIE5vdyBidWlsZCB1cCB0aGUgTG9jYWxEaWFsb2cgdGFibGVzXG4gICAgICBjb25zdCBiYXNlID0gYTtcbiAgICAgIGZvciAoY29uc3QgW2xvY2F0aW9uLCBvZmZzZXRdIG9mIGxvY2F0aW9ucykge1xuICAgICAgICBjb25zdCBkaWFsb2dzOiBMb2NhbERpYWxvZ1tdID0gW107XG4gICAgICAgIHRoaXMubG9jYWxEaWFsb2dzLnNldChsb2NhdGlvbiwgZGlhbG9ncyk7XG4gICAgICAgIGEgPSBiYXNlICsgb2Zmc2V0O1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgIGNvbnN0IFtkaWFsb2csIGxhc3RdID0gTG9jYWxEaWFsb2cucGFyc2Uocm9tLnByZywgYSk7XG4gICAgICAgICAgYSArPSBkaWFsb2cuYnl0ZUxlbmd0aCgpO1xuICAgICAgICAgIGRpYWxvZ3MucHVzaChkaWFsb2cpO1xuICAgICAgICAgIGlmIChsYXN0KSBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGZvciAoY29uc3QgaSBpbiBOQU1FUykge1xuICAgIC8vICAgaWYgKCFOQU1FUy5oYXNPd25Qcm9wZXJ0eShpKSkgY29udGludWU7XG4gICAgLy8gICBjb25zdCBuYW1lID0gKE5BTUVTIGFzIHt9IGFzIHtba2V5OiBzdHJpbmddOiBbbnVtYmVyLCBzdHJpbmcsIHN0cmluZz8sIHN0cmluZz9dfSlbaV07XG4gICAgLy8gICBpZiAobmFtZVswXSA9PT0gaWQpIHtcbiAgICAvLyAgICAgdGhpcy5uYW1lID0gbmFtZVsxXTtcbiAgICAvLyAgICAgaWYgKG5hbWUubGVuZ3RoID4gMikge1xuICAgIC8vICAgICAgIHRoaXMuaXRlbU5hbWVzID0gbmFtZS5zbGljZSgyLCA0KSBhcyBbc3RyaW5nLCBzdHJpbmddO1xuICAgIC8vICAgICB9XG4gICAgLy8gICB9XG4gICAgLy8gfVxuXG4gICAgLy8gY29uc29sZS5sb2coYE5QQyBTcGF3biAkJHt0aGlzLmlkLnRvU3RyaW5nKDE2KX0gZnJvbSAke3RoaXMuYmFzZS50b1N0cmluZygxNil9OiBieXRlczogJCR7XG4gICAgLy8gICAgICAgICAgICAgIHRoaXMuYnl0ZXMoKS5tYXAoeD0+eC50b1N0cmluZygxNikucGFkU3RhcnQoMiwwKSkuam9pbignICcpfWApO1xuICB9XG5cbiAgZ2V0IGRhdGFCYXNlKCk6IEFkZHJlc3Mge1xuICAgIGNvbnN0IHNlZyA9IHRoaXMuaWQgJiAweDgwID8gJDA1IDogJDA0O1xuICAgIGNvbnN0IG9yZyA9IDB4ODBmMCB8ICgodGhpcy5pZCAmIDB4ZmMpIDw8IDYpIHwgKCh0aGlzLmlkICYgMykgPDwgMik7XG4gICAgcmV0dXJuIEFkZHJlc3Mub2Yoc2VnLCBvcmcpO1xuICB9XG5cbiAgZ2V0IHNwYXduUG9pbnRlcigpOiBBZGRyZXNzIHtcbiAgICByZXR1cm4gQWRkcmVzcy5vZigkMGUsIDB4ODVlMCArICh0aGlzLmlkIDw8IDEpKTtcbiAgfVxuXG4gIGdldCBkaWFsb2dQb2ludGVyKCk6IEFkZHJlc3Mge1xuICAgIHJldHVybiBBZGRyZXNzLm9mKCQwZSwgMHg4OTVkICsgKHRoaXMuaWQgPDwgMSkpO1xuICB9XG5cbiAgZ2V0IHVzZWQoKSB7IHJldHVybiB0aGlzLl91c2VkOyB9XG4gIHNldCB1c2VkKHVzZWQ6IGJvb2xlYW4pIHtcbiAgICAvLyBxdWljayBjaGVjazogd2UgY2FuJ3QgdXNlIHNvbWUgaW5kZXhlcyBiZWNhdXNlIGRhdGEgdGFibGVzIGNvLW9wdGVkLlxuICAgIC8vIDFjYTZmLi4xY2E3OSwgMWNhN2IuLjFjYWUzIChjMC4uYzIgYXJlIHVzZWQgYnV0IGhhdmUgbm8gZGlhbG9nLi4uKVxuICAgIC8vIDFjNmYyLi4xYzZmYywgMWM2ZmUuLjFjNzYwXG4gICAgaWYgKHVzZWQgJiYgKHRoaXMuaWQgPiAweDg4ICYmIHRoaXMuaWQgPCAweGMwICYmIHRoaXMuaWQgIT09IDB4OGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQ6ICR7dGhpcy5pZH1gKTtcbiAgICB9XG4gICAgdGhpcy5fdXNlZCA9IHVzZWQ7XG4gIH1cblxuICBzcGF3bkNvbmRpdGlvbnNCeXRlcygpOiBudW1iZXJbXSB7XG4gICAgY29uc3QgYnl0ZXMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IFtsb2MsIGZsYWdzXSBvZiB0aGlzLnNwYXduQ29uZGl0aW9ucykge1xuICAgICAgYnl0ZXMucHVzaChsb2MsIC4uLlNQQVdOX0NPTkRJVElPTl9GTEFHUy5ieXRlcyhmbGFncykpO1xuICAgIH1cbiAgICBieXRlcy5wdXNoKDB4ZmYpO1xuICAgIHJldHVybiBieXRlcztcbiAgfVxuXG4gIGRpYWxvZyhsb2NhdGlvbj86IExvY2F0aW9uKTogTG9jYWxEaWFsb2dbXSB7XG4gICAgY29uc3QgaWQgPSBsb2NhdGlvbiA/IGxvY2F0aW9uLmlkIDogLTE7XG4gICAgY29uc3QgZGlhbG9ncyA9IHRoaXMubG9jYWxEaWFsb2dzLmdldChpZCk7XG4gICAgaWYgKGRpYWxvZ3MpIHJldHVybiBkaWFsb2dzO1xuICAgIHRocm93IG5ldyBFcnJvcihgTm8gbG9jYWwgZGlhbG9nIGZvciBOUEMgJHtoZXgodGhpcy5pZCl9IGF0ICR7aGV4KGlkKX1gKTtcbiAgfVxuXG4gIHNwYXducyhsb2NhdGlvbjogTG9jYXRpb24pOiBudW1iZXJbXSB7XG4gICAgY29uc3QgaWQgPSBsb2NhdGlvbi5pZDtcbiAgICBjb25zdCBjb25kaXRpb25zID0gdGhpcy5zcGF3bkNvbmRpdGlvbnMuZ2V0KGxvY2F0aW9uLmlkKTtcbiAgICBpZiAoY29uZGl0aW9ucykgcmV0dXJuIGNvbmRpdGlvbnM7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBObyBzcGF3biBjb25kaXRpb24gZm9yIE5QQyAke2hleCh0aGlzLmlkKX0gYXQgJHtoZXgoaWQpfWApO1xuICB9XG5cbiAgaGFzRGlhbG9nKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IEJvb2xlYW4odGhpcy5nbG9iYWxEaWFsb2dzLmxlbmd0aCB8fCB0aGlzLmxvY2FsRGlhbG9ncy5zaXplKTtcbiAgICBpZiAodGhpcy5pZCA+IDB4OGUgJiYgdGhpcy5pZCAhPT0gMHhjMyAmJiByZXN1bHQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZDogJHt0aGlzLmlkfWApO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgKiBhbGxEaWFsb2dzKCk6IEl0ZXJhYmxlPExvY2FsRGlhbG9nIHwgR2xvYmFsRGlhbG9nPiB7XG4gICAgeWllbGQgKiB0aGlzLmdsb2JhbERpYWxvZ3M7XG4gICAgZm9yIChjb25zdCBkcyBvZiB0aGlzLmxvY2FsRGlhbG9ncy52YWx1ZXMoKSkge1xuICAgICAgeWllbGQgKiBkcztcbiAgICB9XG4gIH1cblxuICBkaWFsb2dCeXRlcygpOiBudW1iZXJbXSB7XG4gICAgaWYgKCF0aGlzLmhhc0RpYWxvZygpKSByZXR1cm4gW107XG4gICAgY29uc3QgYnl0ZXM6IG51bWJlcltdID0gW107XG4gICAgZnVuY3Rpb24gc2VyaWFsaXplKGRzOiBHbG9iYWxEaWFsb2dbXSB8IExvY2FsRGlhbG9nW10pOiBudW1iZXJbXSB7XG4gICAgICBjb25zdCBvdXQ6IG51bWJlcltdID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG91dC5wdXNoKC4uLmRzW2ldLmJ5dGVzKGkgPT09IGRzLmxlbmd0aCAtIDEpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuICAgIGlmICh0aGlzLmdsb2JhbERpYWxvZ3MubGVuZ3RoKSB7XG4gICAgICBieXRlcy5wdXNoKC4uLnNlcmlhbGl6ZSh0aGlzLmdsb2JhbERpYWxvZ3MpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnl0ZXMucHVzaCgweDgwLCAwLCAwLCAwKTsgLy8gXCJlbXB0eVwiXG4gICAgfVxuICAgIGNvbnN0IGxvY2FsczogbnVtYmVyW10gPSBbXTtcbiAgICBjb25zdCBjYWNoZSA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7IC8vIGFsbG93IHJldXNpbmcgbG9jYXRpb25zXG4gICAgZm9yIChjb25zdCBbbG9jYXRpb24sIGRpYWxvZ3NdIG9mIHRoaXMubG9jYWxEaWFsb2dzKSB7XG4gICAgICBjb25zdCBsb2NhbEJ5dGVzID0gc2VyaWFsaXplKGRpYWxvZ3MpO1xuICAgICAgY29uc3QgbGFiZWwgPSBsb2NhbEJ5dGVzLmpvaW4oJywnKTtcbiAgICAgIGNvbnN0IGNhY2hlZCA9IGNhY2hlLmdldChsYWJlbCk7XG4gICAgICBpZiAoY2FjaGVkICE9IG51bGwpIHtcbiAgICAgICAgYnl0ZXMucHVzaChsb2NhdGlvbiwgY2FjaGVkKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coYFNBVkVEICR7bG9jYWxCeXRlcy5sZW5ndGh9IGJ5dGVzYCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY2FjaGUuc2V0KGxhYmVsLCBsb2NhbHMubGVuZ3RoKTtcbiAgICAgIGlmIChsb2NhdGlvbiAhPT0gLTEpIGJ5dGVzLnB1c2gobG9jYXRpb24sIGxvY2Fscy5sZW5ndGgpO1xuICAgICAgbG9jYWxzLnB1c2goLi4ubG9jYWxCeXRlcyk7XG4gICAgfVxuICAgIGlmIChsb2NhbHMubGVuZ3RoKSBieXRlcy5wdXNoKDB4ZmYsIC4uLmxvY2Fscyk7XG5cbiAgICAvLyBjb25zb2xlLmxvZyhgTlBDICR7dGhpcy5pZC50b1N0cmluZygxNil9OiBieXRlcyBsZW5ndGggJHtieXRlcy5sZW5ndGh9YCk7XG5cbiAgICByZXR1cm4gYnl0ZXM7XG4gIH1cblxuICAvLyBNYWtlcyBhIFwiaGFyZGxpbmtcIiBiZXR3ZWVuIHR3byBOUENzLCBmb3Igc3Bhd24gY29uZGl0aW9ucyBhbmQgZGlhbG9nLlxuICBsaW5rKGlkOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCBvdGhlciA9IHRoaXMucm9tLm5wY3NbaWRdO1xuICAgIHRoaXMuc3Bhd25Db25kaXRpb25zID0gb3RoZXIuc3Bhd25Db25kaXRpb25zO1xuICAgIHRoaXMubGlua0RpYWxvZyhpZCk7XG4gIH1cblxuICBsaW5rRGlhbG9nKGlkOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCBvdGhlciA9IHRoaXMucm9tLm5wY3NbaWRdO1xuICAgIHRoaXMuZ2xvYmFsRGlhbG9ncyA9IG90aGVyLmdsb2JhbERpYWxvZ3M7XG4gICAgdGhpcy5sb2NhbERpYWxvZ3MgPSBvdGhlci5sb2NhbERpYWxvZ3M7XG4gIH1cblxuICBsb2NhbERpYWxvZyhpbmRleDogbnVtYmVyKTogTG9jYWxEaWFsb2c7XG4gIGxvY2FsRGlhbG9nKGxvY2F0aW9uOiBudW1iZXIsIGluZGV4PzogbnVtYmVyKTogTG9jYWxEaWFsb2cge1xuICAgIGlmIChpbmRleCA9PSBudWxsKSB7XG4gICAgICBpbmRleCA9IGxvY2F0aW9uO1xuICAgICAgbG9jYXRpb24gPSAtMTtcbiAgICB9XG4gICAgY29uc3QgZGlhbG9ncyA9IHRoaXMubG9jYWxEaWFsb2dzLmdldChsb2NhdGlvbik7XG4gICAgaWYgKGRpYWxvZ3MgPT0gbnVsbCB8fCBpbmRleCA+PSBkaWFsb2dzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBsb2NhbCBkaWFsb2cgJHtpbmRleH0gZm9yIGxvY2F0aW9uICR7aGV4KGxvY2F0aW9uKX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIGRpYWxvZ3NbaW5kZXhdO1xuICB9XG5cbiAgaXNQYXJhbHl6YWJsZSgpOiBib29sZWFuIHtcbiAgICBmb3IgKGxldCBpID0gMHgzNTA1ODsgaSA8IDB4MzUwNmM7IGkrKykge1xuICAgICAgaWYgKHRoaXMucm9tLnByZ1tpXSA9PT0gdGhpcy5pZCkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGFzc2VtYmxlKGE6IEFzc2VtYmxlcikge1xuICAgIGlmICghdGhpcy51c2VkKSByZXR1cm47XG4gICAgY29uc3QgaWQgPSBoZXgodGhpcy5pZCk7XG5cbiAgICB0aGlzLmRhdGFCYXNlLmxvYyhhLCAnUGVyc29uRGF0YV8ke2lkfScpO1xuICAgIGEuYnl0ZSguLi50aGlzLmRhdGEpO1xuXG4gICAgYS5zZWdtZW50KCcwZScsICdmZScsICdmZicpO1xuICAgIGEucmVsb2MoYFNwYXduQ29uZGl0aW9uXyR7aWR9YCk7XG4gICAgY29uc3Qgc3Bhd24gPSBhLnBjKCk7XG4gICAgYS5ieXRlKC4uLnRoaXMuc3Bhd25Db25kaXRpb25zQnl0ZXMoKSk7XG4gICAgdGhpcy5zcGF3blBvaW50ZXIubG9jKGEsIGBTcGF3bkNvbmRpdGlvbl8ke2lkfV9Qb2ludGVyYCk7XG4gICAgYS53b3JkKHNwYXduKTtcblxuICAgIGlmICh0aGlzLmhhc0RpYWxvZygpKSB7XG4gICAgICBhLnNlZ21lbnQoJzBlJywgJ2ZlJywgJ2ZmJyk7XG4gICAgICBhLnJlbG9jKGBEaWFsb2dfJHtpZH1gKTtcbiAgICAgIGNvbnN0IGRpYWxvZyA9IGEucGMoKTtcbiAgICAgIGEuYnl0ZSguLi50aGlzLmRpYWxvZ0J5dGVzKCkpO1xuICAgICAgdGhpcy5kaWFsb2dQb2ludGVyLmxvYyhhLCBgRGlhbG9nXyR7aWR9X1BvaW50ZXJgKTtcbiAgICAgIGEud29yZChkaWFsb2cpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgR2xvYmFsRGlhbG9nIHtcbiAgY29uc3RydWN0b3IocHVibGljIGNvbmRpdGlvbjogbnVtYmVyLCBwdWJsaWMgbWVzc2FnZTogTWVzc2FnZUlkKSB7fVxuXG4gIHN0YXRpYyBvZihjb25kaXRpb246IG51bWJlcixcbiAgICAgICAgICAgIG1lc3NhZ2U6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyP10pOiBHbG9iYWxEaWFsb2cge1xuICAgIGNvbnN0IFtwYXJ0LCBpbmRleCwgYWN0aW9uID0gMF0gPSBtZXNzYWdlO1xuICAgIHJldHVybiBuZXcgR2xvYmFsRGlhbG9nKGNvbmRpdGlvbiwgTWVzc2FnZUlkLm9mKHtwYXJ0LCBpbmRleCwgYWN0aW9ufSkpO1xuICB9XG5cbiAgLy8gUmV0dXJucyBbZGlhbG9nLCBsYXN0XS5cbiAgc3RhdGljIHBhcnNlKGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIgPSAwKTogW0dsb2JhbERpYWxvZywgYm9vbGVhbl0ge1xuICAgIGNvbnN0IGZsYWcgPSByZWFkQmlnRW5kaWFuKGRhdGEsIG9mZnNldCk7XG4gICAgY29uc3QgbWVzc2FnZSA9IE1lc3NhZ2VJZC5mcm9tKGRhdGEsIG9mZnNldCArIDIpO1xuXG4gICAgbGV0IGNvbmRpdGlvbiA9IGZsYWcgJiAweDAzZmY7XG4gICAgY29uc3QgbGFzdCA9ICEhKGZsYWcgJiAweDgwMDApO1xuICAgIGNvbnN0IHNpZ24gPSBmbGFnICYgMHgyMDAwO1xuICAgIGlmIChzaWduKSBjb25kaXRpb24gPSB+Y29uZGl0aW9uO1xuXG4gICAgcmV0dXJuIFtuZXcgR2xvYmFsRGlhbG9nKGNvbmRpdGlvbiwgbWVzc2FnZSksIGxhc3RdO1xuICB9XG5cbiAgYnl0ZXMobGFzdDogYm9vbGVhbik6IG51bWJlcltdIHtcbiAgICBsZXQgZmxhZyA9IHRoaXMuY29uZGl0aW9uO1xuICAgIGlmIChmbGFnIDwgMCkgZmxhZyA9ICh+ZmxhZykgfCAweDIwMDA7XG4gICAgaWYgKGxhc3QpIGZsYWcgfD0gMHg4MDAwO1xuICAgIHJldHVybiBbZmxhZyA+Pj4gOCwgZmxhZyAmIDB4ZmYsIC4uLnRoaXMubWVzc2FnZS5kYXRhXTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTG9jYWxEaWFsb2cge1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgY29uZGl0aW9uOiBudW1iZXIsXG4gICAgICAgICAgICAgIHB1YmxpYyBtZXNzYWdlOiBNZXNzYWdlSWQsXG4gICAgICAgICAgICAgIHB1YmxpYyB1cGRhdGU6IG51bWJlcixcbiAgICAgICAgICAgICAgcHVibGljIGZsYWdzOiBGbGFnTGlzdCkge31cblxuICBjbG9uZSgpOiBMb2NhbERpYWxvZyB7XG4gICAgcmV0dXJuIExvY2FsRGlhbG9nLnBhcnNlKHRoaXMuYnl0ZXMoZmFsc2UpKVswXTtcbiAgfVxuXG4gIC8vIFJldHVybnMgW2RpYWxvZywgbGFzdF1cbiAgc3RhdGljIHBhcnNlKGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIgPSAwKTogW0xvY2FsRGlhbG9nLCBib29sZWFuXSB7XG4gICAgY29uc3Qgd29yZCA9IHJlYWRCaWdFbmRpYW4oZGF0YSwgb2Zmc2V0KTtcbiAgICBjb25zdCBtZXNzYWdlID0gTWVzc2FnZUlkLmZyb20oZGF0YSwgb2Zmc2V0ICsgMik7XG4gICAgY29uc3QgdXBkYXRlID0gZGF0YVtvZmZzZXQgKyA0XTtcbiAgICBvZmZzZXQgKz0gNTtcblxuICAgIGxldCBjb25kaXRpb24gPSB3b3JkICYgMHgwM2ZmO1xuICAgIGNvbnN0IGxhc3QgPSAhISh3b3JkICYgMHg4MDAwKTtcbiAgICBjb25zdCBzaWduID0gd29yZCAmIDB4MjAwMDtcbiAgICBpZiAoc2lnbikgY29uZGl0aW9uID0gfmNvbmRpdGlvbjtcbiAgICBjb25zdCBmbGFncyA9IHdvcmQgJiAweDQwMDAgPyBESUFMT0dfRkxBR1MucmVhZChkYXRhLCBvZmZzZXQpIDogW107XG4gICAgcmV0dXJuIFtuZXcgTG9jYWxEaWFsb2coY29uZGl0aW9uLCBtZXNzYWdlLCB1cGRhdGUsIGZsYWdzKSwgbGFzdF07XG4gIH1cblxuICBzdGF0aWMgb2YoY29uZGl0aW9uOiBudW1iZXIsXG4gICAgICAgICAgICBtZXNzYWdlOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcj9dLFxuICAgICAgICAgICAgZmxhZ3M6IEZsYWdMaXN0ID0gW10pOiBMb2NhbERpYWxvZyB7XG4gICAgY29uc3QgW3BhcnQsIGluZGV4LCBhY3Rpb24gPSAwXSA9IG1lc3NhZ2U7XG4gICAgcmV0dXJuIG5ldyBMb2NhbERpYWxvZyhjb25kaXRpb24sIE1lc3NhZ2VJZC5vZih7cGFydCwgaW5kZXgsIGFjdGlvbn0pLCAwLCBmbGFncyk7XG4gIH1cblxuICBieXRlTGVuZ3RoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIDUgKyAyICogdGhpcy5mbGFncy5sZW5ndGg7XG4gIH1cblxuICBieXRlcyhsYXN0OiBib29sZWFuKTogbnVtYmVyW10ge1xuICAgIGxldCBmbGFnID0gdGhpcy5jb25kaXRpb247XG4gICAgaWYgKGZsYWcgPCAwKSBmbGFnID0gKH5mbGFnKSB8IDB4MjAwMDtcbiAgICBpZiAobGFzdCkgZmxhZyB8PSAweDgwMDA7XG4gICAgaWYgKHRoaXMuZmxhZ3MubGVuZ3RoKSBmbGFnIHw9IDB4NDAwMDtcbiAgICByZXR1cm4gW2ZsYWcgPj4+IDgsIGZsYWcgJiAweGZmLCAuLi50aGlzLm1lc3NhZ2UuZGF0YSwgdGhpcy51cGRhdGUsXG4gICAgICAgICAgICAuLi5ESUFMT0dfRkxBR1MuYnl0ZXModGhpcy5mbGFncyldO1xuICB9XG59XG5cbmNvbnN0IFVOVVNFRF9OUENTID0gbmV3IFNldChbXG4gIDB4MzEsIDB4M2IsIDB4M2MsIDB4NjYsIDB4NjcsIDB4NmEsIDB4NzMsIDB4NzQsXG4gIDB4ODIsIDB4ODYsIDB4ODcsIDB4ODksIDB4OGEsIDB4OGIsIDB4OGMsIDB4OGQsXG4gIDB4YzQsXG4gIC8vIGFsc28gZXZlcnl0aGluZyBmcm9tIDhmLi5jMCwgYnV0IHRoYXQncyBpbXBsaWNpdC5cbl0pO1xuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBTcGVjaWFsIGNhc2VzIGZvciBzb21lIE5QQ3MuXG5cbmV4cG9ydCBjbGFzcyBQb3J0b2FRdWVlbiBleHRlbmRzIE5wYyB7XG4gIGdldCBleHBlY3RlZFN3b3JkKCk6IG51bWJlciB7IHJldHVybiB0aGlzLmxvY2FsRGlhbG9nKDMpLmNvbmRpdGlvbiAmIDB4ZmY7IH1cbiAgc2V0IGV4cGVjdGVkU3dvcmQoaWQ6IG51bWJlcikgeyB0aGlzLmxvY2FsRGlhbG9nKDMpLmNvbmRpdGlvbiA9IDB4MjAwIHwgaWQ7IH1cbn1cblxuZXhwb3J0IGNsYXNzIERvbHBoaW4gZXh0ZW5kcyBOcGMge1xuICBzcGF3blNjcmlwdHM6IERvbHBoaW5TcGF3blNjcmlwdFtdO1xuICBjaGFubmVsU3Bhd246IG51bWJlcjtcbiAgZXZpbFNwaXJpdElzbGFuZFNwYXduOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IocGFyZW50OiBOcGNzLCBpZDogbnVtYmVyKSB7XG4gICAgc3VwZXIocGFyZW50LCBpZCk7XG4gICAgY29uc3QgcHJnID0gcGFyZW50LnJvbS5wcmc7XG4gICAgY29uc3Qgc3Bhd25UYWJsZUJhc2UgPSBET0xQSElOX1NQQVdOX1RBQkxFX1BPSU5URVIucmVhZEFkZHJlc3MocHJnKS5vZmZzZXQ7XG4gICAgLy8gVE9ETyAtIGhvdyB0byBrbm93IGhvdyBiaWcgdGhlIHRhYmxlIGFjdHVhbGx5IGlzLCBpZiByZXdyaXR0ZW4/XG4gICAgY29uc3QgcmVhZCA9IChpOiBudW1iZXIpID0+IHtcbiAgICAgIGNvbnN0IGVudHJhbmNlID0gRW50cmFuY2UuZnJvbShwcmcsIHNwYXduVGFibGVCYXNlICsgNSAqIGkpO1xuICAgICAgY29uc3QgbW92ZW1lbnQgPSBwcmdbc3Bhd25UYWJsZUJhc2UgKyA1ICogaSArIDRdO1xuICAgICAgcmV0dXJuIHtlbnRyYW5jZSwgbW92ZW1lbnR9O1xuICAgIH07XG4gICAgdGhpcy5zcGF3blNjcmlwdHMgPSBzZXEoOSwgcmVhZCk7XG4gICAgdGhpcy5jaGFubmVsU3Bhd24gPSBtdXN0QmVJbnQoRE9MUEhJTl9DSEFOTkVMX1NQQVdOLnJlYWQocHJnKSAvIDUpO1xuICAgIHRoaXMuZXZpbFNwaXJpdElzbGFuZFNwYXduID1cbiAgICAgICAgbXVzdEJlSW50KERPTFBISU5fRVZJTF9TUElSSVRfSVNMQU5EX1NQQVdOLnJlYWQocHJnKSAvIDUpO1xuICB9XG5cbiAgYXNzZW1ibGUoYTogQXNzZW1ibGVyKSB7XG4gICAgc3VwZXIuYXNzZW1ibGUoYSk7XG4gICAgLy8gRnJlZSB0aGUgb3JpZ2luYWwgdGFibGUgdG8gYWxsb3cgcmVsb2NhdGlvbiBhbmQvb3IgcmVzaXppbmcuXG4gICAgYS5zZWdtZW50KCdmZScpO1xuICAgIGEub3JnKDB4ZDZhOCk7XG4gICAgYS5mcmVlKDQ1KTtcbiAgICAvLyBXcml0ZSB0aGUgbmV3IHRhYmxlIChhZnRlciB0cmltbWluZyBhbnkgZW1wdGllcyBhdCB0aGUgZW5kKS5cbiAgICBhLnNlZ21lbnQoJ2ZlJywgJ2ZmJyk7XG4gICAgYS5yZWxvYygnRG9scGhpblNwYXduVGFibGUnKTtcbiAgICBjb25zdCB0YWJsZSA9IGEucGMoKTtcbiAgICB3aGlsZSAoIXRoaXMuc3Bhd25TY3JpcHRzW3RoaXMuc3Bhd25TY3JpcHRzLmxlbmd0aCAtIDFdLmVudHJhbmNlLnVzZWQpIHtcbiAgICAgIHRoaXMuc3Bhd25TY3JpcHRzLnBvcCgpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucm9tLmxvY2F0aW9ucy5BbmdyeVNlYS5lbnRyYW5jZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHMgPSB0aGlzLnNwYXduU2NyaXB0c1tpXTtcbiAgICAgIGlmIChzKSB7XG4gICAgICAgIGEuYnl0ZSguLi5zLmVudHJhbmNlLmRhdGEsIHMubW92ZW1lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gXCJuby1vcFwiIHNjcmlwdC4gIERvbid0IHJlYWQgcmFuZG9tIGdhcmJhZ2UgZm9yIGxhdGVyIGVudHJhbmNlcy5cbiAgICAgICAgYS5ieXRlKDB4ZmYsIDB4MGYsIDB4ZmYsIDB4MGYsIDB4MGYpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBXcml0ZSB0aGUgYWRkcmVzc2VzIGFuZCBoYXJkY29kZWQgaW5kaWNlcyBpbnRvIHRoZSBpdGVtdXNlIGNvZGUuXG4gICAgRE9MUEhJTl9DSEFOTkVMX1NQQVdOLmxvYyhhLCAnRG9scGhpbkNoYW5uZWxTcGF3bicpO1xuICAgIGEuYnl0ZSh0aGlzLmNoYW5uZWxTcGF3biAqIDUpO1xuICAgIERPTFBISU5fRVZJTF9TUElSSVRfSVNMQU5EX1NQQVdOLmxvYyhhLCAnRG9scGhpbkV2aWxTcGlyaXRJc2xhbmRTcGF3bicpO1xuICAgIGEuYnl0ZSh0aGlzLmV2aWxTcGlyaXRJc2xhbmRTcGF3biAqIDUpO1xuICAgIERPTFBISU5fU1BBV05fVEFCTEVfUE9JTlRFUi5sb2MoYSwgJ0RvbHBoaW5TcGF3blRhYmxlUHRyJyk7XG4gICAgYS53b3JkKHRhYmxlKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykge1xuICAgICAgRE9MUEhJTl9TUEFXTl9UQUJMRV9QT0lOVEVSXzEucGx1cyg1ICogaSlcbiAgICAgICAgICAubG9jKGEsIGBEb2xwaGluU3Bhd25UYWJsZVBsdXMke2kgKyAxfVB0cmApO1xuICAgICAgYS53b3JkKHtvcDogJysnLCBhcmdzOiBbdGFibGUsIHtvcDogJ251bScsIG51bTogaSArIDF9XX0pOyAgICBcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBEb2xwaGluU3Bhd25TY3JpcHQge1xuICBlbnRyYW5jZTogRW50cmFuY2U7XG4gIG1vdmVtZW50OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW92ZW1lbnRTY3JpcHQge1xuICBzdGVwczogbnVtYmVyW107XG4gIHRlcm1pbmF0ZTogbnVtYmVyO1xufVxuZXhwb3J0IG5hbWVzcGFjZSBNb3ZlbWVudFNjcmlwdCB7XG4gIGV4cG9ydCBjb25zdCBVUCA9IDA7XG4gIGV4cG9ydCBjb25zdCBSSUdIVCA9IDI7XG4gIGV4cG9ydCBjb25zdCBET1dOID0gNDtcbiAgZXhwb3J0IGNvbnN0IExFRlQgPSA2O1xuICBleHBvcnQgY29uc3QgRE9MUEhJTiA9IDB4ZmY7XG4gIGV4cG9ydCBjb25zdCBERVNQQVdOID0gMHhmZTtcbn1cblxuY29uc3QgRE9MUEhJTl9DSEFOTkVMX1NQQVdOID0gQWRkcmVzcy5vZigkZmUsIDB4ZDY2NCk7XG5jb25zdCBET0xQSElOX0VWSUxfU1BJUklUX0lTTEFORF9TUEFXTiA9IEFkZHJlc3Mub2YoJGZlLCAweGQ2NmMpO1xuY29uc3QgRE9MUEhJTl9TUEFXTl9UQUJMRV9QT0lOVEVSID0gQWRkcmVzcy5vZigkZmUsIDB4ZDY3YSk7XG5jb25zdCBET0xQSElOX1NQQVdOX1RBQkxFX1BPSU5URVJfMSA9IEFkZHJlc3Mub2YoJGZlLCAweGQ2OGUpOyAvLyArNSwgMTAsIDE1XG5jb25zdCBNT1ZFTUVOVF9TQ1JJUFRfVEFCTEVfUE9JTlRFUiA9IEFkZHJlc3Mub2YoJDFiLCAweGFlNTMpO1xuXG5mdW5jdGlvbiBtdXN0QmVJbnQoeDogbnVtYmVyKTogbnVtYmVyIHtcbiAgaWYgKHggIT09IE1hdGguZmxvb3IoeCkpIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgaW50ZWdlcjogJHt4fWApO1xuICByZXR1cm4geDtcbn1cbiJdfQ==