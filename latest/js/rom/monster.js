import { Constraint } from './constraint.js';
import { ObjectData } from './objectdata.js';
export class Monster extends ObjectData {
    constructor(rom, [name, id, scaling, adjustments = {}]) {
        super(rom, id);
        this.constraint = Constraint.ALL;
        this.name = name;
        const expectedLevel = (level(scaling) + this.level) / 2;
        const expectedAttack = expectedLevel + playerSword(scaling, this.elements);
        this.hits = (this.hp + 1) / (expectedAttack - this.def);
        this.sdef = this.def / expectedAttack;
        const expectedPlayerHP = Math.min(255, Math.max(16, 32 + expectedLevel * 16));
        this.satk = (this.atk - expectedPlayerDefense(scaling, this.attackType)) / expectedPlayerHP;
        this.extraDifficulty = adjustments.difficulty || 0;
        this.monsterClass = adjustments.monsterClass;
        const vsExp = processExpReward(this.expReward) / baselineExp(scaling);
        const vsGld = VANILLA_GOLD_DROPS[this.goldDrop] / baselineGold(scaling);
        this.wealth = vsGld && vsGld / (vsExp + vsGld);
    }
    isUntouchedMonster() {
        return !!UNTOUCHED_MONSTERS[this.id];
    }
    placement() {
        const action = ACTION_SCRIPTS.get(this.action);
        return action && action.placement || 'normal';
    }
    clearance() {
        const action = ACTION_SCRIPTS.get(this.action);
        return action && action.large ? 6 : 3;
    }
    totalDifficulty() {
        return this.toughness() + this.attack() + this.statusDifficulty() +
            this.immunities() + this.movement();
    }
    collectDifficulty(f, r) {
        let result = f(this);
        const child = this.spawnedChild();
        if (child)
            result = r(result, child.collectDifficulty(f, r));
        const death = this.spawnedReplacement();
        if (death)
            result = r(result, death.collectDifficulty(f, r));
        return result;
    }
    toughness() {
        return this.collectDifficulty(m => lookup(m.hits, 0, [2, 1], [3, 2], [5, 3], [7, 4], [10, 5], [13, 6]), Math.max);
    }
    attack() {
        return this.collectDifficulty(m => {
            if (m.attackType && m.statusEffect)
                return 0;
            return lookup(m.satk, 0, [.04, 1], [.08, 2], [.13, 3], [.18, 4], [.25, 5], [.33, 6]);
        }, Math.max);
    }
    addStatusEffects(set) {
        if (this.attackType && this.statusEffect) {
            set.add(this.statusEffect);
        }
        else if (!this.attackType && this.poison) {
            set.add(0);
        }
        const replacement = this.spawnedReplacement();
        if (replacement)
            replacement.addStatusEffects(set);
        const child = this.spawnedChild();
        if (child)
            child.addStatusEffects(set);
    }
    statusDifficulty() {
        const set = new Set();
        this.addStatusEffects(set);
        let result = 0;
        for (const status of set) {
            result += STATUS_DIFFICULTY[status];
        }
        return result;
    }
    immunities() {
        let count = 0;
        let elems = this.elements;
        while (elems) {
            if (elems & 1)
                count++;
            elems >>>= 1;
        }
        return (count && 1 << (count - 1));
    }
    movement() {
        return this.collectDifficulty(m => {
            const actionData = ACTION_SCRIPTS.get(m.action);
            const child = m.spawnedChild();
            let result = m.extraDifficulty;
            if (actionData) {
                result += (actionData.movement || 0);
                if (actionData.large)
                    result++;
                if (child && !child.statusEffect)
                    result += (actionData.projectile || 0);
            }
            if (this.metasprite === 0xa7)
                result += 2;
            return result;
        }, (a, b) => a + b);
    }
    spawnedChild() {
        const data = ACTION_SCRIPTS.get(this.action);
        if (!data || !data.child)
            return undefined;
        const spawn = this.rom.adHocSpawns[this.child];
        const spawnId = spawn && spawn.objectId;
        if (spawnId == null)
            return undefined;
        const obj = this.rom.objects[spawnId];
        return obj instanceof Monster ? obj : undefined;
    }
    spawnedReplacement() {
        if (!this.replacement)
            return undefined;
        const obj = this.rom.objects[this.replacement];
        return obj instanceof Monster ? obj : undefined;
    }
    totalReward() {
        return this.totalDifficulty() / 4;
    }
    normalizedGold() {
        if (!this.wealth)
            return 0;
        const dgld = this.totalDifficulty() * this.wealth * 0.6;
        return Math.max(1, Math.min(15, Math.round(dgld)));
    }
    normalizedExp() {
        if (this.wealth === 1)
            return 0;
        const sexp = 0.488 + this.totalDifficulty() * (1 - this.wealth) * 0.256;
        return Math.max(1, Math.min(255, Math.round(sexp * 32)));
    }
}
function processExpReward(raw) {
    return raw < 128 ? raw : (raw & 0x7f) << 4;
}
function baselineExp(scaling) {
    return 2 ** (scaling / 5 - 1);
}
const STATUS_DIFFICULTY = [
    2,
    1,
    3,
    2,
    4,
];
const VANILLA_GOLD_DROPS = [
    0, 1, 2, 4, 8, 16, 30, 50,
    100, 200, 400, 50, 100, 200, 400, 500,
];
function baselineGold(scaling) {
    return 2 ** (scaling / 7 - 1);
}
export const ACTION_SCRIPTS = new Map([
    [0x10, {}],
    [0x11, {}],
    [0x16, {}],
    [0x17, {}],
    [0x1b, {}],
    [0x1d, {
            child: true,
        }],
    [0x1e, {}],
    [0x1f, {}],
    [0x20, {
            movement: 1,
        }],
    [0x21, {
            child: true,
            large: true,
            movement: 2,
        }],
    [0x22, {
            child: true,
            movement: 3,
        }],
    [0x24, {
            movement: 3,
        }],
    [0x25, {
            movement: 3,
        }],
    [0x26, {
            child: true,
            projectile: 1,
            movement: 3,
        }],
    [0x27, {
            child: true,
            projectile: 1,
            movement: 3,
        }],
    [0x28, {
            child: true,
            projectile: 2,
            movement: 3,
            metasprites: () => [0x65, 0x91],
        }],
    [0x29, {
            child: true,
            movement: 5,
            metasprites: () => [0x6b, 0x68],
        }],
    [0x2a, {
            child: true,
            projectile: 1,
            movement: 4,
            metasprites: (o) => [0, 1, 2, 3].map(x => x + o.data[31]),
        }],
    [0x2b, {
            movement: 4,
        }],
    [0x2c, {
            child: true,
        }],
    [0x2e, {
            child: true,
            large: true,
            projectile: 2,
            movement: 3,
        }],
    [0x2f, {}],
    [0x34, {
            child: true,
        }],
    [0x38, {}],
    [0x3c, {}],
    [0x40, {
            child: true,
            moth: true,
            movement: 4,
            placement: 'moth',
        }],
    [0x41, {
            child: true,
            movement: 3,
        }],
    [0x44, {
            movement: 3,
        }],
    [0x45, {
            child: true,
            bird: true,
            projectile: 2,
            movement: 5,
            placement: 'bird',
        }],
    [0x4c, {
            child: true,
            stationary: true,
            projectile: 3,
            placement: 'plant',
        }],
    [0x4d, {
            child: true,
            stationary: true,
            projectile: 3,
        }],
    [0x4e, {
            child: true,
            stationary: true,
        }],
    [0x57, {}],
    [0x58, {}],
    [0x5c, {
            child: true,
            projectile: 3,
            movement: 1,
        }],
    [0x5d, {
            bird: true,
            movement: 6,
            placement: 'bird',
        }],
    [0x5e, {
            child: true,
            projectile: 1,
            movement: 4,
            metasprites: (o) => [0, 1, 2, 3].map(x => x + o.data[31]),
        }],
    [0x60, {
            boss: true,
        }],
    [0x61, {}],
    [0x63, {
            boss: true,
        }],
    [0x64, {
            boss: true,
        }],
    [0x66, {
            boss: true,
        }],
    [0x67, {
            boss: true,
        }],
    [0x68, {
            boss: true,
        }],
    [0x6a, {
            boss: true,
        }],
    [0x6b, {
            boss: true,
        }],
    [0x70, {
            boss: true,
        }],
    [0x7f, {
            boss: true,
        }],
]);
function level(scaling) {
    return scaling < 24 ? 1 + scaling / 3 : (scaling + 12) / 4;
}
function playerSword(scaling, elements = 0) {
    const bestOwned = scaling < 10 ? 1 : scaling < 18 ? 2 : scaling < 38 ? 4 : 8;
    for (let i = bestOwned; i; i >>>= 1) {
        if (!(i & elements))
            return i << 1;
    }
    return bestOwned << 1;
}
function expectedPlayerDefense(scaling, attackType) {
    return level(scaling) + playerArmor(scaling, attackType);
}
function playerArmor(scaling, attackType) {
    if (!attackType) {
        return lookup(scaling, 2, [6, 6], [18, 10], [25, 14], [30, 18], [40, 24], [46, 32]);
    }
    else {
        return lookup(scaling, 2, [6, 6], [18, 8], [25, 12], [30, 18], [37, 24], [42, 32]);
    }
}
function lookup(x, first, ...table) {
    for (let i = table.length - 1; i >= 0; i--) {
        const [k, v] = table[i];
        if (x >= k)
            return v;
    }
    return first;
}
const UNTOUCHED_MONSTERS = {
    [0x7e]: true,
    [0x7f]: true,
    [0x83]: true,
    [0x8d]: true,
    [0x8e]: true,
    [0x8f]: true,
    [0x9f]: true,
    [0xa6]: true,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uc3Rlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vbW9uc3Rlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0saUJBQWlCLENBQUM7QUFDM0MsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBWTNDLE1BQU0sT0FBTyxPQUFRLFNBQVEsVUFBVTtJQTJCckMsWUFBWSxHQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxXQUFXLEdBQUcsRUFBRSxDQUFjO1FBQ3RFLEtBQUssQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFSakIsZUFBVSxHQUFlLFVBQVUsQ0FBQyxHQUFHLENBQUM7UUFTdEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFTakIsTUFBTSxhQUFhLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN4RCxNQUFNLGNBQWMsR0FBRyxhQUFhLEdBQUcsV0FBVyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0UsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxjQUFjLENBQUM7UUFFdEMsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsYUFBYSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDOUUsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFD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Q0FBQyxJQUFJLEVBQUU7WUFDTCxJQUFJLEVBQUUsSUFBSTtZQUNWLFFBQVEsRUFBRSxDQUFDO1lBQ1gsU0FBUyxFQUFFLE1BQU07U0FDbEIsQ0FBQztJQUNGLENBQUMsSUFBSSxFQUFFO1lBQ0wsS0FBSyxFQUFFLElBQUk7WUFDWCxVQUFVLEVBQUUsQ0FBQztZQUNiLFFBQVEsRUFBRSxDQUFDO1lBQ1gsV0FBVyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQzFELENBQUM7SUFDRixDQUFDLElBQUksRUFBRTtZQUNMLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQztJQUNGLENBQUMsSUFBSSxFQUFFLEVBQ04sQ0FBQztJQUNGLENBQUMsSUFBSSxFQUFFO1lBQ0wsSUFBSSxFQUFFLElBQUk7U0FDWCxDQUFDO0lBQ0YsQ0FBQyxJQUFJLEVBQUU7WUFDTCxJQUFJLEVBQUUsSUFBSTtTQUNYLENBQUM7SUFDRixDQUFDLElBQUksRUFBRTtZQUNMLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQztJQUNGLENBQUMsSUFBSSxFQUFFO1lBQ0wsSUFBSSxFQUFFLElBQUk7U0FDWCxDQUFDO0lBQ0YsQ0FBQyxJQUFJLEVBQUU7WUFDTCxJQUFJLEVBQUUsSUFBSTtTQUNYLENBQUM7SUFDRixDQUFDLElBQUksRUFBRTtZQUNMLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQztJQUNGLENBQUMsSUFBSSxFQUFFO1lBQ0wsSUFBSSxFQUFFLElBQUk7U0FDWCxDQUFDO0lBQ0YsQ0FBQyxJQUFJLEVBQUU7WUFDTCxJQUFJLEVBQUUsSUFBSTtTQUNYLENBQUM7SUFDRixDQUFDLElBQUksRUFBRTtZQUNMLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQztDQUVILENBQUMsQ0FBQztBQUtILFNBQVMsS0FB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IHtDb25zdHJhaW50fSBmcm9tICcuL2NvbnN0cmFpbnQuanMnO1xuaW1wb3J0IHtPYmplY3REYXRhfSBmcm9tICcuL29iamVjdGRhdGEuanMnO1xuaW1wb3J0IHtSb219IGZyb20gJy4uL3JvbS5qcyc7XG5cbmV4cG9ydCB0eXBlIE1vbnN0ZXJEYXRhID0gW3N0cmluZywgbnVtYmVyLCBudW1iZXIsIEFkanVzdG1lbnRzP107XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWRqdXN0bWVudHMge1xuICBkaWZmaWN1bHR5PzogbnVtYmVyO1xuICBtb25zdGVyQ2xhc3M/OiBzdHJpbmdcbn1cblxudHlwZSBEaWZmaWN1bHR5RmFjdG9yID0gbnVtYmVyICYge19fZGlmZmljdWx0eV9fOiBuZXZlcn07XG5cbmV4cG9ydCBjbGFzcyBNb25zdGVyIGV4dGVuZHMgT2JqZWN0RGF0YSB7XG5cbiAgLy8gLyoqIFZhbmlsbGEgZGVmZW5zZS4gSWYgY2hhbmdpbmcgZGVmIGJlZm9yZSBzY2FsaW5nLCBjaGFuZ2UgdmRlZiBpbnN0ZWFkLiAqL1xuICAvLyB2ZGVmOiBudW1iZXI7XG4gIC8vIC8qKiBWYW5pbGxhIGhlYWx0aC4gSWYgY2hhbmdpbmcgaHAgYmVmb3JlIHNjYWxpbmcsIGNoYW5nZSB2aHAgaW5zdGVhZC4gKi9cbiAgLy8gdmhwOiBudW1iZXI7XG5cbiAgLyoqIFRhcmdldCBudW1iZXIgb2YgaGl0cyB0byBraWxsIG1vbnN0ZXIuICovXG4gIGhpdHM6IG51bWJlcjtcbiAgLyoqIFRhcmdldCBkZWZlbnNlIGFzIGEgZnJhY3Rpb24gb2YgZXhwZWN0ZWQgcGxheWVyIGF0dGFjay4gKi9cbiAgc2RlZjogbnVtYmVyO1xuICAvKiogVGFyZ2V0IGF0dGFjayBhcyBhIGZyYWN0aW9uIG9mIGV4cGVjdGVkIHBsYXllciBIUC4gKi9cbiAgc2F0azogbnVtYmVyO1xuXG4gIC8qKiBSZWxhdGl2ZSBmcmFjdGlvbiBvZiByZXdhcmQgZ2l2ZW4gYXMgbW9uZXkuICovXG4gIHdlYWx0aDogbnVtYmVyO1xuXG4gIC8qKiBFeHRyYSBkaWZmaWN1bHR5IGZhY3Rvci4gKi9cbiAgZXh0cmFEaWZmaWN1bHR5OiBudW1iZXI7XG5cbiAgY29uc3RyYWludDogQ29uc3RyYWludCA9IENvbnN0cmFpbnQuQUxMO1xuICBzaGlmdFBhdHRlcm5zPzogU2V0PG51bWJlcj47XG4gIHVzZWRQYWxldHRlcz86IHJlYWRvbmx5IG51bWJlcltdO1xuICB1c2VkUGF0dGVybnM/OiByZWFkb25seSBudW1iZXJbXTtcblxuICBtb25zdGVyQ2xhc3M/OiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3Iocm9tOiBSb20sIFtuYW1lLCBpZCwgc2NhbGluZywgYWRqdXN0bWVudHMgPSB7fV06IE1vbnN0ZXJEYXRhKSB7XG4gICAgc3VwZXIocm9tLCBpZCk7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcblxuICAgIC8vIE1ha2UgdGhlIHNjYWxpbmcgY2FsY3VsYXRpb25zIGhlcmVcbiAgICAvLyBGaXJzdCBkZXJpdmUgdmFsdWVzIGNvcnJlc3BvbmRpbmcgdG8gdmFuaWxsYS5cblxuICAgIC8vIEV4cGVjdGVkIHZhbmlsbGEgcGxheWVyIGxldmVsIGNvbWVzIGZyb20gYXZlcmFnaW5nICgxKSB0aGUgZXhwZWN0ZWRcbiAgICAvLyBsZXZlbCBmcm9tIHRoZSBtYW51YWxseS1zcGVjaWZpZWQgKGVxdWl2YWxlbnQpIHNjYWxpbmcgbGV2ZWwgd2l0aFxuICAgIC8vICgyKSB0aGUgbWluaW11bSBsZXZlbCB0byBkYW1hZ2UgKGZyb20gdGhlIG9iamVjdCBkYXRhKS4gIFRoaXMgbWF5IGJlXG4gICAgLy8gZnJhY3Rpb25hbC5cbiAgICBjb25zdCBleHBlY3RlZExldmVsID0gKGxldmVsKHNjYWxpbmcpICsgdGhpcy5sZXZlbCkgLyAyO1xuICAgIGNvbnN0IGV4cGVjdGVkQXR0YWNrID0gZXhwZWN0ZWRMZXZlbCArIHBsYXllclN3b3JkKHNjYWxpbmcsIHRoaXMuZWxlbWVudHMpO1xuICAgIHRoaXMuaGl0cyA9ICh0aGlzLmhwICsgMSkgLyAoZXhwZWN0ZWRBdHRhY2sgLSB0aGlzLmRlZik7XG4gICAgdGhpcy5zZGVmID0gdGhpcy5kZWYgLyBleHBlY3RlZEF0dGFjaztcblxuICAgIGNvbnN0IGV4cGVjdGVkUGxheWVySFAgPSBNYXRoLm1pbigyNTUsIE1hdGgubWF4KDE2LCAzMiArIGV4cGVjdGVkTGV2ZWwgKiAxNikpO1xuICAgIHRoaXMuc2F0ayA9ICh0aGlzLmF0ayAtIGV4cGVjdGVkUGxheWVyRGVmZW5zZShzY2FsaW5nLCB0aGlzLmF0dGFja1R5cGUpKSAvIGV4cGVjdGVkUGxheWVySFA7XG4gICAgdGhpcy5leHRyYURpZmZpY3VsdHkgPSBhZGp1c3RtZW50cy5kaWZmaWN1bHR5IHx8IDA7XG4gICAgdGhpcy5tb25zdGVyQ2xhc3MgPSBhZGp1c3RtZW50cy5tb25zdGVyQ2xhc3M7XG5cbiAgICAvLyBDb21wdXRlIHZhbmlsbGEgc2NhbGVkIGV4cCBhbmQgZ29sZC5cbiAgICBjb25zdCB2c0V4cCA9IHByb2Nlc3NFeHBSZXdhcmQodGhpcy5leHBSZXdhcmQpIC8gYmFzZWxpbmVFeHAoc2NhbGluZyk7XG4gICAgY29uc3QgdnNHbGQgPSBWQU5JTExBX0dPTERfRFJPUFNbdGhpcy5nb2xkRHJvcF0gLyBiYXNlbGluZUdvbGQoc2NhbGluZyk7XG5cbiAgICB0aGlzLndlYWx0aCA9IHZzR2xkICYmIHZzR2xkIC8gKHZzRXhwICsgdnNHbGQpO1xuICB9XG5cbiAgaXNVbnRvdWNoZWRNb25zdGVyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIVVOVE9VQ0hFRF9NT05TVEVSU1t0aGlzLmlkXTtcbiAgfVxuXG4gIHBsYWNlbWVudCgpOiBQbGFjZW1lbnQge1xuICAgIGNvbnN0IGFjdGlvbiA9IEFDVElPTl9TQ1JJUFRTLmdldCh0aGlzLmFjdGlvbik7XG4gICAgcmV0dXJuIGFjdGlvbiAmJiBhY3Rpb24ucGxhY2VtZW50IHx8ICdub3JtYWwnO1xuICB9XG5cbiAgY2xlYXJhbmNlKCk6IG51bWJlciB7XG4gICAgY29uc3QgYWN0aW9uID0gQUNUSU9OX1NDUklQVFMuZ2V0KHRoaXMuYWN0aW9uKTtcbiAgICByZXR1cm4gYWN0aW9uICYmIGFjdGlvbi5sYXJnZSA/IDYgOiAzO1xuICB9XG5cbiAgdG90YWxEaWZmaWN1bHR5KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMudG91Z2huZXNzKCkgKyB0aGlzLmF0dGFjaygpICsgdGhpcy5zdGF0dXNEaWZmaWN1bHR5KCkgK1xuICAgICAgICB0aGlzLmltbXVuaXRpZXMoKSArIHRoaXMubW92ZW1lbnQoKTtcbiAgfVxuXG4gIGNvbGxlY3REaWZmaWN1bHR5KGY6IChtOiBNb25zdGVyKSA9PiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHI6IChhOiBudW1iZXIsIGI6IG51bWJlcikgPT4gbnVtYmVyKTogRGlmZmljdWx0eUZhY3RvciB7XG4gICAgbGV0IHJlc3VsdCA9IGYodGhpcyk7XG4gICAgY29uc3QgY2hpbGQgPSB0aGlzLnNwYXduZWRDaGlsZCgpO1xuICAgIGlmIChjaGlsZCkgcmVzdWx0ID0gcihyZXN1bHQsIGNoaWxkLmNvbGxlY3REaWZmaWN1bHR5KGYsIHIpKTtcbiAgICBjb25zdCBkZWF0aCA9IHRoaXMuc3Bhd25lZFJlcGxhY2VtZW50KCk7XG4gICAgaWYgKGRlYXRoKSByZXN1bHQgPSByKHJlc3VsdCwgZGVhdGguY29sbGVjdERpZmZpY3VsdHkoZiwgcikpO1xuICAgIHJldHVybiByZXN1bHQgYXMgRGlmZmljdWx0eUZhY3RvcjtcbiAgfVxuXG4gIC8qKiBCYXNpYyBtZWFzdXJlIG9mIGhvdyBoYXJkIHRoZSBlbmVteSBpcyB0byBraWxsLiAqL1xuICB0b3VnaG5lc3MoKTogRGlmZmljdWx0eUZhY3RvciB7XG4gICAgcmV0dXJuIHRoaXMuY29sbGVjdERpZmZpY3VsdHkoXG4gICAgICAgIG0gPT4gbG9va3VwKG0uaGl0cywgMCwgWzIsIDFdLCBbMywgMl0sIFs1LCAzXSwgWzcsIDRdLCBbMTAsIDVdLCBbMTMsIDZdKSxcbiAgICAgICAgTWF0aC5tYXgpO1xuICB9XG5cbiAgLyoqIEhvdyBoYXJkIHRoZSBtb25zdGVyIGhpdHMuICovXG4gIGF0dGFjaygpOiBEaWZmaWN1bHR5RmFjdG9yIHtcbiAgICAvLyBpZ25vcmUgQVRLIGZvciBwcm9qZWN0aWxlcyB3aXRoIHN0YXR1c1xuICAgIHJldHVybiB0aGlzLmNvbGxlY3REaWZmaWN1bHR5KFxuICAgICAgICBtID0+IHtcbiAgICAgICAgICBpZiAobS5hdHRhY2tUeXBlICYmIG0uc3RhdHVzRWZmZWN0KSByZXR1cm4gMDtcbiAgICAgICAgICByZXR1cm4gbG9va3VwKG0uc2F0ayxcbiAgICAgICAgICAgICAgICAgICAgICAgIDAsIFsuMDQsIDFdLCBbLjA4LCAyXSwgWy4xMywgM10sIFsuMTgsIDRdLCBbLjI1LCA1XSwgWy4zMywgNl0pO1xuICAgICAgICB9LCBNYXRoLm1heCk7XG4gIH1cblxuICBhZGRTdGF0dXNFZmZlY3RzKHNldDogU2V0PG51bWJlcj4pOiB2b2lkIHtcbiAgICAvLyBUT0RPIC0gaWYgd2UgYWxsb3cgcHJvamVjdGlsZSBwb2lzb24gb3IgYm9keSBwYXJhbHlzaXMsIGFjY291bnQgZm9yIHRoYXQuXG4gICAgaWYgKHRoaXMuYXR0YWNrVHlwZSAmJiB0aGlzLnN0YXR1c0VmZmVjdCkge1xuICAgICAgc2V0LmFkZCh0aGlzLnN0YXR1c0VmZmVjdCk7XG4gICAgfSBlbHNlIGlmICghdGhpcy5hdHRhY2tUeXBlICYmIHRoaXMucG9pc29uKSB7XG4gICAgICBzZXQuYWRkKDApO1xuICAgIH1cbiAgICBjb25zdCByZXBsYWNlbWVudCA9IHRoaXMuc3Bhd25lZFJlcGxhY2VtZW50KCk7XG4gICAgaWYgKHJlcGxhY2VtZW50KSByZXBsYWNlbWVudC5hZGRTdGF0dXNFZmZlY3RzKHNldCk7XG4gICAgY29uc3QgY2hpbGQgPSB0aGlzLnNwYXduZWRDaGlsZCgpO1xuICAgIGlmIChjaGlsZCkgY2hpbGQuYWRkU3RhdHVzRWZmZWN0cyhzZXQpO1xuICB9XG5cbiAgc3RhdHVzRGlmZmljdWx0eSgpOiBEaWZmaWN1bHR5RmFjdG9yIHtcbiAgICBjb25zdCBzZXQgPSBuZXcgU2V0PG51bWJlcj4oKTtcbiAgICB0aGlzLmFkZFN0YXR1c0VmZmVjdHMoc2V0KTtcbiAgICBsZXQgcmVzdWx0ID0gMDtcbiAgICBmb3IgKGNvbnN0IHN0YXR1cyBvZiBzZXQpIHtcbiAgICAgIHJlc3VsdCArPSBTVEFUVVNfRElGRklDVUxUWVtzdGF0dXNdO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0IGFzIERpZmZpY3VsdHlGYWN0b3I7XG4gIH1cblxuICBpbW11bml0aWVzKCk6IERpZmZpY3VsdHlGYWN0b3Ige1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgbGV0IGVsZW1zID0gdGhpcy5lbGVtZW50cztcbiAgICB3aGlsZSAoZWxlbXMpIHtcbiAgICAgIGlmIChlbGVtcyAmIDEpIGNvdW50Kys7XG4gICAgICBlbGVtcyA+Pj49IDE7XG4gICAgfVxuICAgIHJldHVybiAoY291bnQgJiYgMSA8PCAoY291bnQgLSAxKSkgYXMgRGlmZmljdWx0eUZhY3RvcjtcbiAgfVxuXG4gIG1vdmVtZW50KCk6IERpZmZpY3VsdHlGYWN0b3Ige1xuICAgIHJldHVybiB0aGlzLmNvbGxlY3REaWZmaWN1bHR5KFxuICAgICAgICBtID0+IHtcbiAgICAgICAgICBjb25zdCBhY3Rpb25EYXRhID0gQUNUSU9OX1NDUklQVFMuZ2V0KG0uYWN0aW9uKTtcbiAgICAgICAgICBjb25zdCBjaGlsZCA9IG0uc3Bhd25lZENoaWxkKCk7XG4gICAgICAgICAgbGV0IHJlc3VsdCA9IG0uZXh0cmFEaWZmaWN1bHR5O1xuICAgICAgICAgIGlmIChhY3Rpb25EYXRhKSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gKGFjdGlvbkRhdGEubW92ZW1lbnQgfHwgMCk7XG4gICAgICAgICAgICBpZiAoYWN0aW9uRGF0YS5sYXJnZSkgcmVzdWx0Kys7XG4gICAgICAgICAgICAvLyBOT1RFOiBNb3RoUmVzaWR1ZVNvdXJjZSBoYXMgc3RhdHVzRGlmZmljdWx0eSBidXQgbm90IHN0YXR1c0VmZmVjdC5cbiAgICAgICAgICAgIGlmIChjaGlsZCAmJiAhY2hpbGQuc3RhdHVzRWZmZWN0KSByZXN1bHQgKz0gKGFjdGlvbkRhdGEucHJvamVjdGlsZSB8fCAwKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTaGFkb3dzIGdldCArMiwgYWN0aW9uICQyNiB0cmlnZ2VycyB0aGlzIG9uIG1ldGFzcHJpdGUgJGE3XG4gICAgICAgICAgaWYgKHRoaXMubWV0YXNwcml0ZSA9PT0gMHhhNykgcmVzdWx0ICs9IDI7XG5cbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9LCAoYSwgYikgPT4gYSArIGIpO1xuICB9XG5cbiAgc3Bhd25lZENoaWxkKCk6IE1vbnN0ZXIgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGRhdGEgPSBBQ1RJT05fU0NSSVBUUy5nZXQodGhpcy5hY3Rpb24pO1xuICAgIGlmICghZGF0YSB8fCAhZGF0YS5jaGlsZCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICBjb25zdCBzcGF3biA9IHRoaXMucm9tLmFkSG9jU3Bhd25zW3RoaXMuY2hpbGRdO1xuICAgIGNvbnN0IHNwYXduSWQgPSBzcGF3biAmJiBzcGF3bi5vYmplY3RJZDtcbiAgICBpZiAoc3Bhd25JZCA9PSBudWxsKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgIGNvbnN0IG9iaiA9IHRoaXMucm9tLm9iamVjdHNbc3Bhd25JZF07XG4gICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIE1vbnN0ZXIgPyBvYmogOiB1bmRlZmluZWQ7XG4gIH1cblxuICBzcGF3bmVkUmVwbGFjZW1lbnQoKTogTW9uc3RlciB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKCF0aGlzLnJlcGxhY2VtZW50KSByZXR1cm4gdW5kZWZpbmVkO1xuICAgIGNvbnN0IG9iaiA9IHRoaXMucm9tLm9iamVjdHNbdGhpcy5yZXBsYWNlbWVudF07XG4gICAgcmV0dXJuIG9iaiBpbnN0YW5jZW9mIE1vbnN0ZXIgPyBvYmogOiB1bmRlZmluZWQ7XG4gIH1cblxuICAvLyBSZXR1cm5zIGEgbnVtYmVyIDAuLjYgb3Igc29cbiAgdG90YWxSZXdhcmQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy50b3RhbERpZmZpY3VsdHkoKSAvIDQ7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIG51bWJlciBmcm9tIDAgdG8gMTUsIHJlcHJlc2VudGluZyBER0xELzIsIG9yIDAgZm9yIG5vIGdvbGQuXG4gICAqL1xuICBub3JtYWxpemVkR29sZCgpOiBudW1iZXIge1xuICAgIGlmICghdGhpcy53ZWFsdGgpIHJldHVybiAwO1xuICAgIC8vIEF2ZXJhZ2UgZGlmZmljdWx0eSBpcyAxMCwgYXZlcmFnZSB3ZWFsdGggaXMgMC41ID0+IDMgaXMgYXZlcmFnZSBkZ2xkLlxuICAgIC8vIE1heCBkaWZmaWN1bHR5IG9mIDI1LCB3aXRoIHdlYWx0aCBvZiAxID0+IDE1IGRnbGQuXG4gICAgY29uc3QgZGdsZCA9IHRoaXMudG90YWxEaWZmaWN1bHR5KCkgKiB0aGlzLndlYWx0aCAqIDAuNjtcbiAgICByZXR1cm4gTWF0aC5tYXgoMSwgTWF0aC5taW4oMTUsIE1hdGgucm91bmQoZGdsZCkpKTtcbiAgfVxuXG4gIC8qKiBSZXR1cm5zIGEgbnVtYmVyIGZyb20gMCB0byAyNTUsIHJlcHJlc2VudGluZyBTRVhQLzMyLiAqL1xuICBub3JtYWxpemVkRXhwKCk6IG51bWJlciB7XG4gICAgaWYgKHRoaXMud2VhbHRoID09PSAxKSByZXR1cm4gMDtcbiAgICAvLyBBdmcgZGlmZmljdWx0eSAxMCwgd2VhbHRoIDAuNSA9PiBzZXhwIDEuNzY4XG4gICAgLy8gU2xpbWUgZGlmZmljdWx0eSA0LCB3ZWFsdGggMC41ID0+IHNleHAgMVxuICAgIC8vIE1heCBkaWZmaWN1bHR5IDI1LCB3ZWFsdGggMCA9PiBzZXhwIDYuODg4ID0+IDIyMCAvIDMyXG4gICAgY29uc3Qgc2V4cCA9IDAuNDg4ICsgdGhpcy50b3RhbERpZmZpY3VsdHkoKSAqICgxIC0gdGhpcy53ZWFsdGgpICogMC4yNTY7XG4gICAgcmV0dXJuIE1hdGgubWF4KDEsIE1hdGgubWluKDI1NSwgTWF0aC5yb3VuZChzZXhwICogMzIpKSk7XG4gIH1cblxuICAvLyAvKiogQ29uZmlndXJlcyBhIHNwYXduIGJhc2VkIG9uIHRoZSBjaG9zZW4gYmFua3MgZm9yIGEgbG9jYXRpb24uICovXG4gIC8vIGNvbmZpZ3VyZShsb2NhdGlvbjogTG9jYXRpb24sIHNwYXduOiBTcGF3bikge1xuICAvLyAgIGlmICghdGhpcy5zaGlmdFBhdHRlcm5zKSByZXR1cm47XG4gIC8vICAgaWYgKHRoaXMuc2hpZnRQYXR0ZXJucy5oYXMobG9jYXRpb24uc3ByaXRlUGFsZXR0ZXNbMF0pKSBzcGF3bi5wYXR0ZXJuQmFuayA9IDA7XG4gIC8vICAgaWYgKHRoaXMuc2hpZnRQYXR0ZXJucy5oYXMobG9jYXRpb24uc3ByaXRlUGFsZXR0ZXNbMV0pKSBzcGF3bi5wYXR0ZXJuQmFuayA9IDE7XG4gIC8vIH1cbn1cblxuZnVuY3Rpb24gcHJvY2Vzc0V4cFJld2FyZChyYXc6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiByYXcgPCAxMjggPyByYXcgOiAocmF3ICYgMHg3ZikgPDwgNDtcbn1cblxuZnVuY3Rpb24gYmFzZWxpbmVFeHAoc2NhbGluZzogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIDIgKiogKHNjYWxpbmcgLyA1IC0gMSk7XG59XG5cbmNvbnN0IFNUQVRVU19ESUZGSUNVTFRZOiBudW1iZXJbXSA9IFtcbiAgMiwgLy8gMCBwb2lzb24gKGhhbmRsZWQgc3BlY2lhbClcbiAgMSwgLy8gMSBwYXJhbHlzaXNcbiAgMywgLy8gMiBzdG9uZVxuICAyLCAvLyAzIG1wIGRyYWluXG4gIDQsIC8vIDQgY3Vyc2Vcbl07XG5cbmNvbnN0IFZBTklMTEFfR09MRF9EUk9QUyA9IFtcbiAgICAwLCAgIDEsICAgMiwgICA0LCAgIDgsICAxNiwgIDMwLCAgNTAsXG4gIDEwMCwgMjAwLCA0MDAsICA1MCwgMTAwLCAyMDAsIDQwMCwgNTAwLFxuXTtcblxuZnVuY3Rpb24gYmFzZWxpbmVHb2xkKHNjYWxpbmc6IG51bWJlcik6IG51bWJlciB7XG4gIC8vIFRvIGNvbnZlcnQgYSBzY2FsaW5nIGZhY3RvciB0byBER0xELCBub3RlIHRoYXQgcGF0Y2hlZCBnb2xkIGRyb3BzIHNjYWxlIGJ5XG4gIC8vIHRoZSBnb2xkZW4gcmF0aW8gKDEuNjE4KS4uLj9cbiAgcmV0dXJuIDIgKiogKHNjYWxpbmcgLyA3IC0gMSk7XG59XG5cbi8vIEdvbGQgYW5kIEV4cGVyaWVuY2Ugc2NhbGluZzpcbi8vICAtIGdvYWw6IGJhc2UgZXhwIHNob3VsZCBiZSByb3VnaGx5IDEgYXQgMCBhbmQgMTAwMCBhcm91bmQgNDAtNDhcbi8vICAgICAgICAgIHZhcmlhbmNlIHdpdGhpbiBhIGRpZmZpY3VsdHkgbGV2ZWw6IGZhY3RvciBvZiA4P1xuLy8gICAgICAgICAgc28gaWYgd2Ugd2FudCB0byBzdGFydCBzYXR1cmF0aW5nIGFyb3VuZCA0NCwgdGhlbiB3ZVxuLy8gICAgICAgICAgc2hvdWxkIHNob290IGZvciBhIGJhc2Ugb2YgMjU2IGF0IDQ1LFxuLy8gICAgICAgICAgTWF5YmUgc2xvdyBkb3duIHRoZSBncm93dGggdG8gMS81LCBzbyB0aGF0IHdlJ3JlIGF0IDAuNSBhdCAwP1xuLy8gICAgICAgICAgYmFzZSA9IDJeKHMvNS0xKVxuLy8gICAgICAgICAgc2NhbGUgZmFjdG9yID0gMC4uOCBmb3IgdmFyaW91cyBub3JtYWwgZW5lbWllcywgMTZpc2ggZm9yIGJvc3Nlcy5cbi8vICAtIGdvYWw6IGJhc2UgZ29sZCBzaG91bGQgYmUgMC41IGF0IDAgYW5kIDUwIGF0IDQ3IChpbiB2YW5pbGxhIHVuaXRzKS5cbi8vICAgICAgICAgIGJhc2UgPSAyXihzLzctMSlcbi8vIFRoaXMgbWFrZXMgdGhlIGF2ZXJhZ2UgXCJ3ZWFsdGhcIiAoZGVmaW5lZCBhcyBzZ2xkIC8gKHNleHAgKyBzZ2xkKSkgdG9cbi8vIGF2ZXJhZ2Ugcm91Z2hseSAwLjUgYXQgYWxsIGRpZmZpY3VsdHkgbGV2ZWxzLlxuXG4vLyBERUFUSCBSRVBMQUNFTUVOVFMuLi4/XG5cblxuaW50ZXJmYWNlIEFjdGlvblNjcmlwdERhdGEge1xuICBjaGlsZD86IGJvb2xlYW47XG4gIGxhcmdlPzogYm9vbGVhbjtcbiAgYmlyZD86IGJvb2xlYW47XG4gIG1vdGg/OiBib29sZWFuO1xuICBzdGF0aW9uYXJ5PzogYm9vbGVhbjtcbiAgYm9zcz86IGJvb2xlYW47XG4gIHByb2plY3RpbGU/OiBudW1iZXI7XG4gIG1vdmVtZW50PzogbnVtYmVyO1xuICBtZXRhc3ByaXRlcz86IChvOiBPYmplY3REYXRhKSA9PiByZWFkb25seSBudW1iZXJbXTtcbiAgcGxhY2VtZW50PzogUGxhY2VtZW50O1xuICAvLyBUaGlzIGlzIG9uIHRvcCBvZiBhbnkgZWZmZWN0IGZyb20gc2F0aywgc3RhdHVzLCBldGMuXG4gIC8vIGRpZmZpY3VsdHk/OiAobzogTW9uc3RlciwgYz86IE1vbnN0ZXIpID0+IERpZmZpY3VsdHlGYWN0b3I7XG4gIC8vIGZseWVyPyBzdGF0aW9uYXJ5PyBsYXJnZT8gcmVxdWlyZWQgc3BhY2U/XG59XG5cbnR5cGUgUGxhY2VtZW50ID0gJ25vcm1hbCcgfCAnbW90aCcgfCAnYmlyZCcgfCAncGxhbnQnO1xuXG4vLyBTZXQgb2YgYWN0aW9uIHNjcmlwdCBJRHMuXG4vLyBXZSBjb3VsZCBwb3NzaWJseSBkbyBiZXR0ZXIgd2l0aCBhIHF1aWNrIGNvdmVyYWdlIGFuYWx5c2lzIG9mIHRoZSBhY3R1YWwgY29kZS5cbi8vIFNlZSB3aGF0IGFkZHJlc3NlcyBhcmUgaGl0IChhbmQgcm91dGluZXMgY2FsbGVkKSBiZWZvcmUgdGhlIHJ0cy5cbmV4cG9ydCBjb25zdCBBQ1RJT05fU0NSSVBUUyA9IG5ldyBNYXA8bnVtYmVyLCBBY3Rpb25TY3JpcHREYXRhPihbXG4gIFsweDEwLCB7IC8vIHN0cmFpZ2h0IHNob3QgKG9wdGlvbmFsIGJvdW5jZSlcbiAgfV0sXG4gIFsweDExLCB7IC8vIHN0cmFpZ2h0IHNob3RcbiAgfV0sXG4gIFsweDE2LCB7IC8vIG1hZG8gc2h1cmlrZW5cbiAgfV0sXG4gIFsweDE3LCB7IC8vIGRlbW9uIHdhbGwgZmlyZVxuICB9XSxcbiAgWzB4MWIsIHsgLy8gZHJheWdvbjIgLyBrYXJtaW5lIGJhbGxzXG4gIH1dLFxuICBbMHgxZCwgeyAvLyBicm93biByb2JvdCBoYXJwb29uIHNvdXJjZSAob2JqZWN0ICRiZSlcbiAgICBjaGlsZDogdHJ1ZSxcbiAgfV0sXG4gIFsweDFlLCB7IC8vIGRyYXlnb24yIGxhc2Vyc1xuICB9XSxcbiAgWzB4MWYsIHsgLy8gcGFyYWx5c2lzIHBvd2RlclxuICB9XSxcbiAgWzB4MjAsIHsgLy8gYmx1ZSBzbGltZSwgZXRjIChyYW5kb20pXG4gICAgbW92ZW1lbnQ6IDEsIC8vIHNsb3cgcmFuZG9tXG4gIH1dLFxuICBbMHgyMSwgeyAvLyBtZWR1c2EsIGV0YyAocmFuZG9tIGxhcmdlIHN0b25lcnMpXG4gICAgY2hpbGQ6IHRydWUsXG4gICAgbGFyZ2U6IHRydWUsXG4gICAgbW92ZW1lbnQ6IDIsIC8vIGZhc3QgcmFuZG9tXG4gIH1dLFxuICBbMHgyMiwgeyAvLyB3cmFpdGgsIHpvbWJpZSAob3B0aW9uYWwpXG4gICAgY2hpbGQ6IHRydWUsXG4gICAgbW92ZW1lbnQ6IDMsIC8vIHNsb3cgaG9taW5nXG4gIH1dLFxuICBbMHgyNCwgeyAvLyB3ZXJldGlnZXIsIG5vbi1zaG9vdGluZyB3eXZlcm5zIChzbWFsbCBob21pbmcpXG4gICAgbW92ZW1lbnQ6IDMsIC8vIHNsb3cgaG9taW5nXG4gIH1dLFxuICBbMHgyNSwgeyAvLyBtdXNocm9vbSwgYW5lbW9uZXNcbiAgICBtb3ZlbWVudDogMywgLy8gc2xvdyBob21pbmdcbiAgfV0sXG4gIFsweDI2LCB7IC8vIG9yYy93eXZlcm4vc2hhZG93ICAtPiBlOS8xMCA9MiAgfCAgZTMvMTEgPTAgKHN0YXR1cylcbiAgICBjaGlsZDogdHJ1ZSxcbiAgICBwcm9qZWN0aWxlOiAxLCAvLyBvbmx5IGZvciBub24tc3RhdHVzIG9yY1xuICAgIG1vdmVtZW50OiAzLCAvLyBzbG93IGhvbWluZ1xuICB9XSxcbiAgWzB4MjcsIHsgLy8gdHJvbGwvc3BpZGVyL2Zpc2htYW4vc2FsYW1hbmRlci90YXJhbnR1bGEvbXVtbXkgIC0+XG4gICAgY2hpbGQ6IHRydWUsXG4gICAgcHJvamVjdGlsZTogMSxcbiAgICBtb3ZlbWVudDogMywgLy8gc2xvdyBob21pbmdcbiAgfV0sXG4gIFsweDI4LCB7IC8vIGdvbGVtICAgLT4gZTUvMTAgPTNcbiAgICBjaGlsZDogdHJ1ZSxcbiAgICBwcm9qZWN0aWxlOiAyLCAvLyBkaWFnb25hbFxuICAgIG1vdmVtZW50OiAzLCAvLyBzbG93IGhvbWluZ1xuICAgIG1ldGFzcHJpdGVzOiAoKSA9PiBbMHg2NSwgMHg5MV0sXG4gIH1dLFxuICBbMHgyOSwgeyAvLyBsYXZhbWFuXG4gICAgY2hpbGQ6IHRydWUsXG4gICAgLy8gcHJvamVjdGlsZSBkb2VzIG5vIGRhbWFnZVxuICAgIG1vdmVtZW50OiA1LCAvLyBwdWRkbGVcbiAgICBtZXRhc3ByaXRlczogKCkgPT4gWzB4NmIsIDB4NjhdLFxuICB9XSxcbiAgWzB4MmEsIHsgLy8gc29sZGllci9hcmNoZXIva25pZ2h0L2Jyb3duIHJvYm90XG4gICAgY2hpbGQ6IHRydWUsXG4gICAgcHJvamVjdGlsZTogMSxcbiAgICBtb3ZlbWVudDogNCwgLy8gZmFzdCBob21pbmdcbiAgICBtZXRhc3ByaXRlczogKG8pID0+IFswLCAxLCAyLCAzXS5tYXAoeCA9PiB4ICsgby5kYXRhWzMxXSksIC8vIGRpcmVjdGlvbmFsIHdhbGtlclxuICB9XSxcbiAgWzB4MmIsIHsgLy8gbWltaWNcbiAgICBtb3ZlbWVudDogNCwgLy8gZmFzdCBob21pbmdcbiAgfV0sXG4gIFsweDJjLCB7IC8vIG1vdGggcmVzaWR1ZSBzb3VyY2UgKGZyb20gNGQgb2JqZWN0IHJlcGxhY2VtZW50KVxuICAgIGNoaWxkOiB0cnVlLFxuICB9XSxcbiAgWzB4MmUsIHsgLy8gZmxhaWwgZ3V5c1xuICAgIGNoaWxkOiB0cnVlLFxuICAgIGxhcmdlOiB0cnVlLFxuICAgIHByb2plY3RpbGU6IDIsXG4gICAgbW92ZW1lbnQ6IDMsIC8vIHNsb3cgaG9taW5nXG4gIH1dLFxuICBbMHgyZiwgeyAvLyBkeW5hIGxhc2VyXG4gIH1dLFxuICBbMHgzNCwgeyAvLyBndWFyZGlhbiBzdGF0dWVcbiAgICBjaGlsZDogdHJ1ZSxcbiAgfV0sXG4gIFsweDM4LCB7IC8vIG1vdmluZyBwbGF0Zm9ybVxuICB9XSxcbiAgWzB4M2MsIHsgLy8gY3J1bWJsaW5nIG1vdmluZyBwbGF0Zm9ybVxuICAgIC8vIFRPRE8gLSB3aWxsIG5lZWQgdG8gY29weSB0aGUgaG9yaXpvdGFsIHZlcnNpb24ncyBncmFwaGljcz9cbiAgfV0sXG4gIFsweDQwLCB7IC8vIGJhdCwgbW90aFxuICAgIGNoaWxkOiB0cnVlLFxuICAgIG1vdGg6IHRydWUsXG4gICAgLy8gcHJvamVjdGlsZTogMixcbiAgICBtb3ZlbWVudDogNCwgLy8gc2xvdyBmbHllclxuICAgIHBsYWNlbWVudDogJ21vdGgnLFxuICB9XSxcbiAgWzB4NDEsIHsgLy8gc2tlbGV0b24gKG1wIGRyYWluIHdlYilcbiAgICBjaGlsZDogdHJ1ZSxcbiAgICBtb3ZlbWVudDogMywgLy8gc2xvdyBob21pbmdcbiAgfV0sXG4gIFsweDQ0LCB7IC8vIHN3YW1wIHRvbWF0b1xuICAgIG1vdmVtZW50OiAzLCAvLyBzbG93IGhvbWluZ1xuICB9XSxcbiAgWzB4NDUsIHsgLy8gaW5zZWN0cyAocGFyYWx5c2lzIG9yIHNob290aW5nKSwgYm9tYmVyIGJpcmQgKG9wdGlvbmFsIHNob3QpXG4gICAgY2hpbGQ6IHRydWUsXG4gICAgYmlyZDogdHJ1ZSxcbiAgICBwcm9qZWN0aWxlOiAyLFxuICAgIG1vdmVtZW50OiA1LCAvLyBmYXN0IGZseWVyXG4gICAgcGxhY2VtZW50OiAnYmlyZCcsXG4gIH1dLFxuICBbMHg0YywgeyAvLyBzd2FtcCBwbGFudCAtPiBlYS8xMCA9NVxuICAgIGNoaWxkOiB0cnVlLFxuICAgIHN0YXRpb25hcnk6IHRydWUsXG4gICAgcHJvamVjdGlsZTogMyxcbiAgICBwbGFjZW1lbnQ6ICdwbGFudCcsXG4gIH1dLFxuICBbMHg0ZCwgeyAvLyBrcmFrZW5cbiAgICBjaGlsZDogdHJ1ZSxcbiAgICBzdGF0aW9uYXJ5OiB0cnVlLFxuICAgIHByb2plY3RpbGU6IDMsXG4gIH1dLFxuICBbMHg0ZSwgeyAvLyBidXJ0XG4gICAgY2hpbGQ6IHRydWUsXG4gICAgc3RhdGlvbmFyeTogdHJ1ZSxcbiAgfV0sXG4gIFsweDU3LCB7IC8vIGR5bmEgc2hvdHNcbiAgfV0sXG4gIFsweDU4LCB7IC8vIHNhYmVyYTIgZmlyZVxuICB9XSxcbiAgWzB4NWMsIHsgLy8gdG93ZXIgc2VudGluZWxcbiAgICBjaGlsZDogdHJ1ZSxcbiAgICBwcm9qZWN0aWxlOiAzLFxuICAgIG1vdmVtZW50OiAxLFxuICB9XSxcbiAgWzB4NWQsIHsgLy8gaGVsaWNvcHRlclxuICAgIGJpcmQ6IHRydWUsXG4gICAgbW92ZW1lbnQ6IDYsXG4gICAgcGxhY2VtZW50OiAnYmlyZCcsXG4gIH1dLFxuICBbMHg1ZSwgeyAvLyB3aGl0ZSByb2JvdFxuICAgIGNoaWxkOiB0cnVlLFxuICAgIHByb2plY3RpbGU6IDEsXG4gICAgbW92ZW1lbnQ6IDQsIC8vIGZhc3QgaG9taW5nXG4gICAgbWV0YXNwcml0ZXM6IChvKSA9PiBbMCwgMSwgMiwgM10ubWFwKHggPT4geCArIG8uZGF0YVszMV0pLCAvLyBkaXJlY3Rpb25hbCB3YWxrZXJcbiAgfV0sXG4gIFsweDYwLCB7IC8vIHZhbXBpcmVcbiAgICBib3NzOiB0cnVlLFxuICB9XSxcbiAgWzB4NjEsIHsgLy8gdmFtcGlyZSBiYXRcbiAgfV0sXG4gIFsweDYzLCB7IC8vIGtlbGJlc3F1ZVxuICAgIGJvc3M6IHRydWUsXG4gIH1dLFxuICBbMHg2NCwgeyAvLyBrZWxiZXNxdWUxIHJvY2tcbiAgICBib3NzOiB0cnVlLFxuICB9XSxcbiAgWzB4NjYsIHsgLy8gc2FiZXJhXG4gICAgYm9zczogdHJ1ZSxcbiAgfV0sXG4gIFsweDY3LCB7IC8vIG1hZG9cbiAgICBib3NzOiB0cnVlLFxuICB9XSxcbiAgWzB4NjgsIHsgLy8ga2FybWluZVxuICAgIGJvc3M6IHRydWUsXG4gIH1dLFxuICBbMHg2YSwgeyAvLyBkcmF5Z29uMVxuICAgIGJvc3M6IHRydWUsXG4gIH1dLFxuICBbMHg2YiwgeyAvLyBkcmF5Z29uMlxuICAgIGJvc3M6IHRydWUsXG4gIH1dLFxuICBbMHg3MCwgeyAvLyBkeW5hLCBmbGFpbFxuICAgIGJvc3M6IHRydWUsXG4gIH1dLFxuICBbMHg3ZiwgeyAvLyBpbnNlY3RcbiAgICBib3NzOiB0cnVlLFxuICB9XSxcbiAgLy8gVE9ETyAtIGp1c3QgaGFyZGNvZGUgYm9zcyBkaWZmaWN1bHRpZXM/ICBmaXggdGhlbSBhdCBtYXg/XG5dKTtcblxuXG5cbi8vIFNjYWxpbmcgZm9ybXVsYXNcbmZ1bmN0aW9uIGxldmVsKHNjYWxpbmc6IG51bWJlcik6IG51bWJlciB7XG4gIC8vIFRPRE8gLSBub3Qgc3VwZXIgdXNlZnVsLi4uP1xuICAvLyBTZWVtcyBsaWtlIEkgYWN0dWFsbHkgd2FudCB0aGUgbGV2ZWwsIG5vdCB0aGUgc2NhbGluZy5cbiAgLy8gNy1vZmYgY29tcHJlc3Npb21cbiAgcmV0dXJuIHNjYWxpbmcgPCAyNCA/IDEgKyBzY2FsaW5nIC8gMyA6IChzY2FsaW5nICsgMTIpIC8gNDtcbn1cblxuLyoqIEJlc3Qgc3dvcmQgb3duZWQgYnkgcGxheWVyIGF0IGdpdmVuICh2YW5pbGxhIGVxdWl2YWxlbnQpIHNjYWxpbmcuICovXG5mdW5jdGlvbiBwbGF5ZXJTd29yZChzY2FsaW5nOiBudW1iZXIsIGVsZW1lbnRzOiBudW1iZXIgPSAwKTogbnVtYmVyIHtcbiAgY29uc3QgYmVzdE93bmVkID0gc2NhbGluZyA8IDEwID8gMSA6IHNjYWxpbmcgPCAxOCA/IDIgOiBzY2FsaW5nIDwgMzggPyA0IDogODtcbiAgZm9yIChsZXQgaSA9IGJlc3RPd25lZDsgaTsgaSA+Pj49IDEpIHtcbiAgICBpZiAoIShpICYgZWxlbWVudHMpKSByZXR1cm4gaSA8PCAxO1xuICB9XG4gIHJldHVybiBiZXN0T3duZWQgPDwgMTtcbn1cblxuLyoqIEV4cGVjdGVkIHRvdGFsIGRlZmVuc2UuICovXG5mdW5jdGlvbiBleHBlY3RlZFBsYXllckRlZmVuc2Uoc2NhbGluZzogbnVtYmVyLCBhdHRhY2tUeXBlOiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gbGV2ZWwoc2NhbGluZykgKyBwbGF5ZXJBcm1vcihzY2FsaW5nLCBhdHRhY2tUeXBlKTtcbn1cblxuLyoqIEV4cGVjdGVkIGFybW9yL3NoaWVsZCBkZWZlbnNlIGF0IGdpdmVuIHNjYWxpbmcuICovXG5mdW5jdGlvbiBwbGF5ZXJBcm1vcihzY2FsaW5nOiBudW1iZXIsIGF0dGFja1R5cGU6IG51bWJlcik6IG51bWJlciB7XG4gIGlmICghYXR0YWNrVHlwZSkgeyAvLyBib2R5IGRhbWFnZVxuICAgIHJldHVybiBsb29rdXAoc2NhbGluZywgMiwgWzYsIDZdLCBbMTgsIDEwXSwgWzI1LCAxNF0sIFszMCwgMThdLCBbNDAsIDI0XSwgWzQ2LCAzMl0pO1xuICB9IGVsc2UgeyAvLyBwcm9qZWN0aWxlIGRhbWFnZVxuICAgIHJldHVybiBsb29rdXAoc2NhbGluZywgMiwgWzYsIDZdLCBbMTgsIDhdLCBbMjUsIDEyXSwgWzMwLCAxOF0sIFszNywgMjRdLCBbNDIsIDMyXSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbG9va3VwPEsgZXh0ZW5kcyBDb21wYXJhYmxlLCBWPih4OiBLLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdDogVixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi4udGFibGU6IFJlYWRvbmx5QXJyYXk8cmVhZG9ubHkgW0ssIFZdPik6IFYge1xuICBmb3IgKGxldCBpID0gdGFibGUubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBjb25zdCBbaywgdl0gPSB0YWJsZVtpXTtcbiAgICBpZiAoeCA+PSBrKSByZXR1cm4gdjtcbiAgfVxuICByZXR1cm4gZmlyc3Q7XG59XG5cbnR5cGUgQ29tcGFyYWJsZSA9IG51bWJlciB8IHN0cmluZztcblxuY29uc3QgVU5UT1VDSEVEX01PTlNURVJTOiB7W2lkOiBudW1iZXJdOiBib29sZWFufSA9IHsgLy8gbm90IHlldCArMHg1MCBpbiB0aGVzZSBrZXlzXG4gIFsweDdlXTogdHJ1ZSwgLy8gdmVydGljYWwgcGxhdGZvcm1cbiAgWzB4N2ZdOiB0cnVlLCAvLyBob3Jpem9udGFsIHBsYXRmb3JtXG4gIFsweDgzXTogdHJ1ZSwgLy8gZ2xpdGNoIGluICQ3YyAoaHlkcmEpXG4gIFsweDhkXTogdHJ1ZSwgLy8gZ2xpdGNoIGluIGxvY2F0aW9uICRhYiAoc2FiZXJhIDIpIC0gY3J1bWJsaW5nIGhvcml6b250YWwgcGxhdGZvcm1cbiAgWzB4OGVdOiB0cnVlLCAvLyBicm9rZW4/LCBidXQgc2l0cyBvbiB0b3Agb2YgaXJvbiB3YWxsXG4gIFsweDhmXTogdHJ1ZSwgLy8gc2hvb3Rpbmcgc3RhdHVlXG4gIFsweDlmXTogdHJ1ZSwgLy8gY3J1bWJsaW5nIHZlcnRpY2FsIHBsYXRmb3JtXG4gIC8vIFsweGExXTogdHJ1ZSwgLy8gd2hpdGUgdG93ZXIgcm9ib3RzXG4gIFsweGE2XTogdHJ1ZSwgLy8gZ2xpdGNoIGluIGxvY2F0aW9uICRhZiAobWFkbyAyKVxufTtcbiJdfQ==