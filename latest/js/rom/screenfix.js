import { iters } from '../util.js';
export var ScreenFix;
(function (ScreenFix) {
    ScreenFix[ScreenFix["Unknown"] = 0] = "Unknown";
    ScreenFix[ScreenFix["GrassLongGrass"] = 1] = "GrassLongGrass";
    ScreenFix[ScreenFix["GrassLongGrassRemapping"] = 2] = "GrassLongGrassRemapping";
    ScreenFix[ScreenFix["RiverShortGrass"] = 3] = "RiverShortGrass";
    ScreenFix[ScreenFix["SeaCaveEntrance"] = 4] = "SeaCaveEntrance";
    ScreenFix[ScreenFix["SeaRocks"] = 5] = "SeaRocks";
    ScreenFix[ScreenFix["SeaMarsh"] = 6] = "SeaMarsh";
    ScreenFix[ScreenFix["SeaTrees"] = 7] = "SeaTrees";
    ScreenFix[ScreenFix["DesertShortGrass"] = 8] = "DesertShortGrass";
    ScreenFix[ScreenFix["DesertLongGrass"] = 9] = "DesertLongGrass";
    ScreenFix[ScreenFix["DesertMarsh"] = 10] = "DesertMarsh";
    ScreenFix[ScreenFix["DesertRocks"] = 11] = "DesertRocks";
    ScreenFix[ScreenFix["DesertTrees"] = 12] = "DesertTrees";
    ScreenFix[ScreenFix["DesertTownEntrance"] = 13] = "DesertTownEntrance";
    ScreenFix[ScreenFix["LabyrinthParapets"] = 14] = "LabyrinthParapets";
    ScreenFix[ScreenFix["SwampDoors"] = 15] = "SwampDoors";
    ScreenFix[ScreenFix["ExtraSpikes"] = 16] = "ExtraSpikes";
    ScreenFix[ScreenFix["CloseCaves"] = 17] = "CloseCaves";
    ScreenFix[ScreenFix["WideArenaExits"] = 18] = "WideArenaExits";
})(ScreenFix || (ScreenFix = {}));
export function withRequire(requirement, props) {
    for (const key in props) {
        props[key].requires = [requirement];
    }
    return props;
}
export function fixTilesets(rom) {
    const { desert, grass, lime, mountain, mountainRiver, river, sea } = rom.metatilesets;
    const $ = rom.metascreens;
    $.registerFix(ScreenFix.DesertRocks);
    desert.getTile(0x5f).copyFrom(0x5b).replaceIn($.oasisCave, $.oasisLake);
    desert.getTile(0x5a).copyFrom(0x98).setTiles([, , 0x1a, 0x18]);
    desert.getTile(0x5b).copyFrom(0x80).setTiles([0x34, 0x32, ,]);
    desert.getTile(0x5c).copyFrom(0x80).setTiles([, , 0x37, 0x35]);
    desert.getTile(0x5d).copyFrom(0x80).setTiles([, 0x37, , 0x34]);
    desert.getTile(0x5e).copyFrom(0x80).setTiles([0x35, , 0x32,]);
    $.registerFix(ScreenFix.DesertTrees);
    desert.getTile(0x63).copyFrom(0x71);
    desert.getTile(0x68).copyFrom(0x70);
    desert.getTile(0x69).copyFrom(0x60);
    desert.getTile(0x6a).copyFrom(0x65);
    desert.getTile(0x6c).copyFrom(0x70);
    desert.getTile(0x6e).copyFrom(0x76);
    desert.getTile(0x6f).copyFrom(0x78);
    $.registerFix(ScreenFix.GrassLongGrass);
    grass.getTile(0x40).copyFrom(0x51);
    grass.getTile(0x41).copyFrom(0x52);
    grass.getTile(0x42).copyFrom(0x53);
    grass.getTile(0x43).copyFrom(0x54);
    grass.getTile(0x44).copyFrom(0x55);
    grass.getTile(0x45).copyFrom(0x56);
    grass.getTile(0x46).copyFrom(0x58);
    grass.getTile(0x47).copyFrom(0x59);
    $.registerFix(ScreenFix.SeaCaveEntrance);
    sea.getTile(0xad).copyFrom(0x0a)
        .replaceIn($.beachExitN, $.lighthouseEntrance, $.oceanShrine);
    sea.getTile(0x0a).copyFrom(0xa2);
    $.boundaryN_cave.screen.set2d(0x38, [[null, 0x00, 0x00, null],
        [null, 0x0a, 0x0a, null],
        [null, 0xf7, 0xf7, null],
        [0xf8, 0xf8, 0xf8, 0xf8]]);
    $.cornerSE_cave.screen.set2d(0x49, [[null, 0x00, 0x00],
        [null, 0x0a, 0x0a],
        [null, 0xf7, 0xf7],
        [0xf8, 0xf7, 0xf7],
        [null, 0xfd, 0xf7]]);
    $.cornerSE_cave.screen.set2d(0x4a, [[0x00, 0x00],
        [0x0a, 0x0a],
        [0xf7, 0xf7],
        [0xf8, 0xf7],
        [0x80, 0xfd],
        [0x80, 0xff],
        [0xfa, null]]);
    $.registerFix(ScreenFix.CloseCaves);
    river.getTile(0x07).copyFrom(0x01).replaceIn(...river);
    river.getTile(0x0e).copyFrom(0x02).replaceIn(...river);
    river.getTile(0x20).copyFrom(0x03).replaceIn(...river);
    river.getTile(0x21).copyFrom(0x04).replaceIn(...river);
    for (const ts of [desert, sea, mountain, mountainRiver, lime]) {
        ts.getTile(0x68).copyFrom(0x01).replaceIn(...ts);
        ts.getTile(0x83).copyFrom(0x02).replaceIn(...ts);
        ts.getTile(0x88).copyFrom(0x03).replaceIn(...ts);
        ts.getTile(0x89).copyFrom(0x04).replaceIn(...ts);
    }
    for (const ts of [grass, river, desert]) {
        ts.getTile(0x01).copyFrom(0xc1).setAlternative(0x00);
        ts.getTile(0x02).copyFrom(0xd7).setAlternative(0x0a);
        ts.getTile(0x03).copyFrom(0xc1).setAlternative(0x00);
        ts.getTile(0x04).copyFrom(0xd7).setAlternative(0x0a);
    }
    for (const ts of [sea]) {
        ts.getTile(0x01).copyFrom(0xc1).setAlternative(0x00);
        ts.getTile(0x02).copyFrom(0xcb).setAlternative(0x00);
        ts.getTile(0x03).copyFrom(0xc1).setAlternative(0xc0);
        ts.getTile(0x04).copyFrom(0xcb).setAlternative(0xc0);
        for (let i = 1; i < 5; i++) {
            ts.getTile(i).setTiles(grass.getTile(i).tiles);
        }
    }
    const closedCaves = new Set([
        $.boundaryE_cave, $.boundaryW_cave, $.exitW_cave, $.caveAbovePortoa,
        $.beachCave, $.outsideWindmill,
        $.exitS_cave, $.townExitW_cave,
    ]);
    const waterCaves = new Set([]);
    waterCaves.add($.boundaryN_cave);
    waterCaves.add($.cornerSE_cave);
    for (const scr of [...closedCaves, ...waterCaves]) {
        const exit = scr.data.exits.find(e => e.type === 'cave');
        const pos = Math.min(...exit.exits) - 0x10;
        const tiles = waterCaves.has(scr) ? [[3, 3], [4, 4]] : [[1, 1], [2, 2]];
        scr.screen.set2d(pos, tiles);
        scr.addCustomFlag(true);
    }
    $.outsideWindmill.screen.set2d(0x43, [[0xca, 0x82]]);
    $.townExitW_cave.screen.set2d(0x2a, [[0xca, 0x82]]);
}
export function wideArenaExits(rom) {
    var _a;
    function widen(exits) {
        exits.splice(0, exits.length, ...new Set(iters.concat(...exits.map(e => [e, e + 1, e - 1]))));
    }
    const { fortressArena_through, fortressTrap, hallNS, hallNS_arena, hallNS_arenaWall, hallNS_entrance, } = rom.metascreens;
    hallNS_arena.screen.set2d(0x04, [
        [0x97, 0x76, 0x22, 0x23, 0x23, 0x23, 0x4b, 0x95],
        [0x42, 0x48, 0x22, 0x21, 0x23, 0x23, 0x45, 0x42],
        [0x43, 0x49, 0x2e, 0x23, 0x23, 0x21, 0x46, 0x43],
        [0x44, 0x4a, 0x2e, 0x23, 0x21, 0x21, 0x47, 0x44],
    ]);
    hallNS_arena.setGridTile(' c | a | c ');
    widen(hallNS_arena.findExitByType('edge:top').exits);
    hallNS_arenaWall.screen.set2d(0x04, [
        [0x94, 0x4c, 0x22, 0x21, 0x21, 0x21, 0x4b, 0x93],
        [0x97, 0x4f, 0x00, 0x01, 0x01, 0x02, 0x50, 0x95],
    ]);
    hallNS_arenaWall.setGridTile(' c | a | c ');
    widen(hallNS_arenaWall.findExitByType('edge:top').exits);
    const abductionTrigger = rom.locations.ZebuCave.spawns.find(s => s.isTrigger() && s.id === 0x8c);
    if (abductionTrigger)
        abductionTrigger.yt += 4;
    fortressArena_through.screen.set2d(0x05, [
        [0x5f, 0x22, 0x21, 0x21, 0x21, 0x5f],
        [0xb7, 0x22, 0x21, 0x21, 0x21, 0xb5],
        [0xbf, 0x22, 0x21, 0x21, 0x21, 0xa8],
    ]);
    fortressArena_through.setGridTile(' c | a | w ');
    widen(fortressArena_through.findExitByType('edge:top').exits);
    fortressTrap.screen.set2d(0xc4, [
        [0x3c, 0x3d, 0x21, 0x21, 0x21, 0x21, 0x3b, 0x3c],
        [0x92, 0x4c, 0x22, 0x21, 0x21, 0x21, 0x4b, 0x90],
        [0x94, 0x4c, 0x22, 0x21, 0x21, 0x21, 0x4b, 0x93],
    ]);
    fortressTrap.setGridTile('   | x | c ');
    widen(fortressTrap.findExitByType('edge:bottom').exits);
    for (const location of rom.locations) {
        const meta = location.meta;
        for (const pos of meta.allPos()) {
            const scr = meta.get(pos);
            if (scr === hallNS_entrance && ((_a = meta.get(pos + 16)) === null || _a === void 0 ? void 0 : _a.hasFeature('arena'))) {
                meta.set(pos, hallNS);
                const row = location.screens[pos >>> 4];
                if (row)
                    row[pos & 0xf] = hallNS.sid;
            }
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NyZWVuZml4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3JvbS9zY3JlZW5maXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFlBQVksQ0FBQztBQUduQyxNQUFNLENBQU4sSUFBWSxTQThEWDtBQTlERCxXQUFZLFNBQVM7SUFDbkIsK0NBQU8sQ0FBQTtJQUdQLDZEQUFjLENBQUE7SUFLZCwrRUFBdUIsQ0FBQTtJQUl2QiwrREFBZSxDQUFBO0lBS2YsK0RBQWUsQ0FBQTtJQU1mLGlEQUFRLENBQUE7SUFHUixpREFBUSxDQUFBO0lBSVIsaURBQVEsQ0FBQTtJQUdSLGlFQUFnQixDQUFBO0lBR2hCLCtEQUFlLENBQUE7SUFJZix3REFBVyxDQUFBO0lBR1gsd0RBQVcsQ0FBQTtJQUdYLHdEQUFXLENBQUE7SUFHWCxzRUFBa0IsQ0FBQTtJQUVsQixvRUFBaUIsQ0FBQTtJQUVqQixzREFBVSxDQUFBO0lBRVYsd0RBQVcsQ0FBQTtJQUVYLHNEQUFVLENBQUE7SUFHViw4REFBYyxDQUFBO0FBQ2hCLENBQUMsRUE5RFcsU0FBUyxLQUFULFNBQVMsUUE4RHBCO0FBR0QsTUFBTSxVQUFVLFdBQVcsQ0FBaUIsV0FBc0IsRUFBRSxLQUFRO0lBQzFFLEtBQUssTUFBTSxHQUFHLElBQUksS0FBSyxFQUFFO1FBQ3ZCLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztLQUNyQztJQUNELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQTRDRCxNQUFNLFVBQVUsV0FBVyxDQUFDLEdBQVE7SUFDbEMsTUFBTSxFQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUNuQixRQUFRLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUMsR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDO0lBQy9ELE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUM7SUFJMUIsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBRXhFLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQUFBRCxFQUFHLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQy9ELE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsQUFBRCxFQUFJLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEFBQUQsRUFBRyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxBQUFELEVBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLEVBQUUsQUFBRCxFQUFHLElBQUksRUFBRyxDQUFDLENBQUM7SUFFL0QsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFJcEMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDeEMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFXbkMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDekMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1NBQzNCLFNBQVMsQ0FBQyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDbEUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFakMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ3hCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ3hCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ3hCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ2xCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUM7UUFDbEIsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNsQixDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBQ2xCLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekQsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztRQUNaLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQWFuRCxDQUFDLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUVwQyxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUN2RCxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUN2RCxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUN2RCxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUN2RCxLQUFLLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFO1FBQzdELEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0tBQ2xEO0lBRUQsS0FBSyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDdkMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JELEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyRCxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckQsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3REO0lBQ0QsS0FBSyxNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ3RCLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNyRCxFQUFFLENBQUMsT0FBTyxDQUFDLElB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TWV0YXNjcmVlbiB9IGZyb20gJy4vbWV0YXNjcmVlbi5qcyc7XG5pbXBvcnQgeyBpdGVycyB9IGZyb20gJy4uL3V0aWwuanMnO1xuXG4vLyBTaW1wbGUgdGlsZXNldC1vbmx5IGZpeGVzIHRoYXQgdW5sb2NrIHNvbWUgc2NyZWVuLXRpbGVzZXQgY29tYmluYXRpb25zXG5leHBvcnQgZW51bSBTY3JlZW5GaXgge1xuICBVbmtub3duLFxuICAvLyBTdXBwb3J0IFwibG9uZyBncmFzc1wiIHJpdmVyIHNjcmVlbnMgb24gdGhlIGdyYXNzIHRpbGVzZXQgYnkgY29weWluZ1xuICAvLyBzb21lIHRpbGVzIGZyb20gNTEuLjU5IGludG8gNDAuLjQ3LlxuICBHcmFzc0xvbmdHcmFzcyxcbiAgLy8gSW4gYWRkaXRpb24gdG8ganVzdCBtYWtpbmcgdGhlIG5ldyBsb25nIGdyYXNzIHRpbGVzLCB3ZSBuZWVkIHRvXG4gIC8vIGFsc28gcmVtYXAgdGhlIGV4aXN0aW5nIG9uZXMgaW4gc29tZSBzaXR1YXRpb25zIHRvIHBvaW50IHRvIHRoZVxuICAvLyBuZXcgb25lcywgZS5nLiBmb3Igc2NyZWVucyAxZCwyOSB0byB3b3JrIG9uIHJpdmVyLCB3ZSBuZWVkIHRvIHVzZVxuICAvLyB0aGUgNHggdGlsZXMgaW5zdGVhZCBvZiB0aGUgNXggb25lcyB0byBmaXggdGhlIHN1cnJvdW5kaW5nLlxuICBHcmFzc0xvbmdHcmFzc1JlbWFwcGluZywgLy8gVE9ET1xuICAvLyBSaXZlciB0aWxlc2V0cyBkb24ndCBkZWZpbmUgMTAsMTIsMTQsMTYsMTcsMWEsMWIsMWMsMjIsMjMsMjQsMjUsMjYsXG4gIC8vIHdoaWNoIGFyZSB1c2VkIGZvciB0aGUgXCJzaG9ydCBncmFzc1wiIGluIHRoZSBncmFzcyB0aWxlc2V0LiAgVGhlc2VcbiAgLy8gd291bGQgYmUgZWFzeSB0byBjb3B5IGZyb20gc29tZXdoZXJlIGVsc2UgdG8gb3BlbiB1cCBhIGZldyBzY3JlZW5zLlxuICBSaXZlclNob3J0R3Jhc3MsIC8vIFRPRE9cbiAgLy8gQW5ncnkgc2VhIHVzZXMgMGEgb2RkbHkgZm9yIGEgc2ltcGxlIGRpYWdvbmFsIGJlYWNoL21vdW50YWluIHRpbGUsXG4gIC8vIHByZXZlbnRpbmcgcGFyaXR5IHdpdGggZ3Jhc3Mvcml2ZXIgY2F2ZSBlbnRyYW5jZSBib3R0b21zLiAgTW92ZSB0aGlzXG4gIC8vIHRpbGUgZWxzZXdoZXJlIChhZCkgYW5kIGZpeCB0aGUgZ3JhcGhpY3MvZWZmZWN0cy4gIE5vdGUgdGhhdCB0aGVcbiAgLy8gYWN0dWFsIGZpeCBpcyBub3QgZW50aXJlbHkgc2F0aXNmeWluZy5cbiAgU2VhQ2F2ZUVudHJhbmNlLFxuICAvLyBBbmdyeSBzZWEgZG9lcyBub3QgaGFuZGxlIHJvY2tzIGNvcnJlY3RseS4gIEZpeCA1YS4uNWUgZm9yIHBhcml0eVxuICAvLyB3aXRoIGdyYXNzL3JpdmVyIHRpbGVzZXRzLiAgVE9ETyAtIGltcGxlbWVudCB0aGUgZml4ICh3ZSBjb3VsZCBtb3ZlXG4gIC8vIHRoZSBleGlzdGluZyB0aWxlcywgdXNlZCBieSBtb3VudGFpbiBnYXRlcywgZWxzZXdoZXJlIHByZXR0eSBlYXNpbHksXG4gIC8vIG9yIGFsdGVybmF0aXZlbHkgbW92ZSBhbGwgdGhlIDVhLi41ZSBpbiBhbGwgb3RoZXIgdGlsZXNldHMgaW50b1xuICAvLyA4OSw4YSw5MCw5OSw5ZCxkMSxkMiB3aGljaCBhcmUgZnJlZSBpbiA4MCw5MCw5NCw5YykuXG4gIFNlYVJvY2tzLCAvLyBUT0RPXG4gIC8vIEFsbG93IHRoZSBzZWEgdG8gc3VwcG9ydCAzNCwzOCwzYy4uM2YsIHVzZWQgYXMgbWFyc2ggaW4gcml2ZXIgdGlsZXNldC5cbiAgLy8gVGhlc2Ugd291bGQgbmVlZCB0byBtYXAgdG8gc2ltcGxlIG9jZWFuIHRpbGVzLiAgVE9ETyAtIGltcGxlbWVudC5cbiAgU2VhTWFyc2gsIC8vIFRPRE9cbiAgLy8gU3VwcG9ydCA2eCw3eCB0aWxlcyAodHJlZXMpIG9uIGFuZ3J5IHNlYS4gIFByb2JhYmx5IG5vdCB3b3J0aCBpdC5cbiAgLy8gV291bGQgbmVlZCB0byBtb3ZlIChlLmcuKSBMaW1lIFRyZWUgTGFrZSB0byBhIHRvdGFsbHkgZGlmZmVyZW50IHRpbGVzZXRcbiAgLy8gdG8gZnJlZSB1cCB0aGUgbWV0YXRpbGVzLlxuICBTZWFUcmVlcywgLy8gVE9ET1xuICAvLyBGaXhpbmcgUml2ZXJTaG9ydEdyYXNzIGZvciBkZXNlcnQgaXMgYSBsb3QgaGFyZGVyIGJlY2F1c2UgaXQgdG91Y2hlcyBhXG4gIC8vIGJ1bmNoIG9mIHRpbGVzIHVzZWQgYnkgdGhlIG1vdW50YWluUml2ZXIgdGlsZXNldCAoMTAsMTQsMngpLlxuICBEZXNlcnRTaG9ydEdyYXNzLCAvLyBUT0RPXG4gIC8vIEZpeGluZyBHcmFzc0xvbmdHcmFzcyBmb3IgZGVzZXJ0IGlzIGRpZmZpY3VsdCBiZWNhdXNlIHRoZSA0eCB0aWxlc1xuICAvLyBhcmUgdXNlZCBieSBtb3VudGFpblJpdmVyLlxuICBEZXNlcnRMb25nR3Jhc3MsIC8vIFRPRE9cbiAgLy8gRGVzZXJ0IGRvZXNuJ3Qgc3VwcG9ydCB0aGUgM3ggbWFyc2ggdGlsZXMgKGNsYXNoIHdpdGggbW91bnRhaW5SaXZlcikuXG4gIC8vIEl0J3MgcHJvYmFibHkgbm90IGZlYXNpYmxlIHRvIGFkZCBzdXBwb3J0IC0gaXQgd291bGQgYWxsb3cgc2NyZWVuIDMzLFxuICAvLyBidXQgdGhlcmUncyBhIHNpbWlsYXIgc291dGgtZWRnZS1leGl0IHNjcmVlbiB3aXRoIERlc2VydFRvd25FbnRyYW5jZS5cbiAgRGVzZXJ0TWFyc2gsIC8vIFRPRE9cbiAgLy8gRml4IDVhLi41ZSB0byBiZSBjb21wYXRpYmxlIHdpdGggZ3Jhc3Mvcml2ZXIuICA1YiBpcyBhbHJlYWR5IGluIHVzZVxuICAvLyBvbiB0aGUgdHdvIG9hc2lzIHNjcmVlbnMsIHNvIHRoYXQgdGlsZSBpcyBtb3ZlZCB0byA1ZiB0byBtYWtlIHNwYWNlLlxuICBEZXNlcnRSb2NrcyxcbiAgLy8gQWRkIHNvbWUgbWlzc2luZyB0cmVlIHRpbGVzIGluIDYzLDY4LDY5LDZhLDZjLDZlLDZmLCByZXF1aXJlZCBmb3JcbiAgLy8gcGFyaXR5IHdpdGggc29tZSByaXZlciBzY3JlZW5zLlxuICBEZXNlcnRUcmVlcyxcbiAgLy8gU291dGgtZmFjaW5nIHRvd24gZW50cmFuY2VzIHVzZSAwNyBmb3IgdGhlIHRvcCBvZiB0aGUgdG93biB3YWxsLlxuICAvLyBUaGlzIGNvdWxkIGJlIHJlcGxhY2VkIHdpdGggKGUuZy4gOGMpIG9yIG1heWJlIHNvbWV0aGluZyBiZXR0ZXIuXG4gIERlc2VydFRvd25FbnRyYW5jZSwgLy8gVE9ET1xuICAvLyBMYWJ5cmludGggcGFyYXBldHMgY2FuIGJlIGJsb2NrZWQvdW5ibG9ja2VkIHdpdGggYSBmbGFnLlxuICBMYWJ5cmludGhQYXJhcGV0cywgLy8gVE9ETyAoc2VlIG1hemUvZ29hKVxuICAvLyBBZGRzIGZsYWdnYWJsZSBkb29ycyB0byB2YXJpb3VzIHNjcmVlbnMuXG4gIFN3YW1wRG9vcnMsIC8vIFRPRE8gKHNlZSBtYXplL3N3YW1wKVxuICAvLyBBZGRzIHNvbWUgZXh0cmEgc3Bpa2Ugc2NyZWVucy5cbiAgRXh0cmFTcGlrZXMsIC8vIFRPRE9cbiAgLy8gTWFrZSBjYXZlcyBjbG9zZWFibGUuXG4gIENsb3NlQ2F2ZXMsXG4gIC8vIE1ha2VzIHRoZSB0b3AgZXhpdHMgb2YgYXJlbmFzIGZ1bGwtc2l6ZSByYXRoZXIgdGhhbiBuYXJyb3csIGdpdmluZ1xuICAvLyBtb3JlIGZsZXhpYmlsaXR5IHdpdGggd2hhdCBjYW4gZ28gdGhlcmUuXG4gIFdpZGVBcmVuYUV4aXRzLFxufVxuXG50eXBlIFJlcXMgPSBSZWNvcmQ8YW55LCB7cmVxdWlyZXM/OiBTY3JlZW5GaXhbXX0+XG5leHBvcnQgZnVuY3Rpb24gd2l0aFJlcXVpcmU8VCBleHRlbmRzIFJlcXM+KHJlcXVpcmVtZW50OiBTY3JlZW5GaXgsIHByb3BzOiBUKSB7XG4gIGZvciAoY29uc3Qga2V5IGluIHByb3BzKSB7XG4gICAgcHJvcHNba2V5XS5yZXF1aXJlcyA9IFtyZXF1aXJlbWVudF07XG4gIH1cbiAgcmV0dXJuIHByb3BzO1xufVxuXG5cbiAgLy8gLy8gQWRkcyBhYmlsaXR5IHRvIGNsb3NlIGNhdmVzLlxuICAvLyBDbG9zZUNhdmVzLFxuXG5cbi8vIC8qKiBBZGRzIGEgJ0Nsb3NlQ2F2ZXMnIHJlcXVpcmVtZW50IG9uIGFsbCB0aGUgcHJvcGVydGllcy4gKi9cbi8vIGZ1bmN0aW9uIGNsb3NlQ2F2ZXM8VCBleHRlbmRzIFJlY29yZDxhbnksIHtyZXF1aXJlczogU2NyZWVuRml4W119Pj4ocHJvcHM6IFQpIHtcbi8vICAgZm9yIChjb25zdCBrZXkgaW4gcHJvcHMpIHtcbi8vICAgICBwcm9wc1trZXldLnJlcXVpcmVzID0gW1NjcmVlbkZpeC5DbG9zZUNhdmVzXTtcbi8vICAgfVxuLy8gICByZXR1cm4gcHJvcHM7XG4vLyB9XG5cblxuLy8gTk9URTogTGlzdGluZyBleHBsaWNpdCBmbGFncyBkb2Vzbid0IHF1aXRlIHdvcmsuXG4vLyBlbnVtIEZsYWcge1xuLy8gICBBbHdheXMgPSAweDJmMCxcbi8vICAgV2luZG1pbGwgPSAweDJlZSxcbi8vICAgUHJpc29uID0gMHgyZDgsXG4vLyAgIENhbG0gPSAweDI4Myxcbi8vICAgU3R5eCA9IDB4MmIwLFxuLy8gICBEcmF5Z29uMSA9IDB4MjhmLFxuLy8gICBEcmF5Z29uMiA9IDB4MjhkLFxuLy8gfVxuXG4vLyBjb25zdCBHUkFTUyA9IDB4ODA7XG4vLyBjb25zdCBUT1dOID0gMHg4NDtcbi8vIGNvbnN0IENBVkUgPSAweDg4O1xuLy8gY29uc3QgUFlSQU1JRCA9IDB4OGM7XG4vLyBjb25zdCBSSVZFUiA9IDB4OTA7XG4vLyBjb25zdCBNT1VOVEFJTiA9IDB4OTQ7XG4vLyBjb25zdCBTRUEgPSAweDk0O1xuLy8gY29uc3QgU0hSSU5FID0gMHg5ODtcbi8vIGNvbnN0IERFU0VSVCA9IDB4OWM7XG4vLyBjb25zdCBNT1VOVEFJTl9SSVZFUiA9IDB4OWM7XG4vLyBjb25zdCBTV0FNUCA9IDB4YTA7XG4vLyBjb25zdCBIT1VTRSA9IDB4YTA7XG4vLyBjb25zdCBGT1JUUkVTUyA9IDB4YTQ7XG4vLyBjb25zdCBJQ0VfQ0FWRSA9IDB4YTg7XG4vLyBjb25zdCBUT1dFUiA9IDB4YWM7XG5cbi8qKiBBcHBseSBzdGFuZGFyZCB0aWxlc2V0IGZpeGVzLiAgT3RoZXJzIG1heSBiZSBhcHBsaWVkIGxhdGVyLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZpeFRpbGVzZXRzKHJvbTogUm9tKSB7XG4gIGNvbnN0IHtkZXNlcnQsIGdyYXNzLCBsaW1lLFxuICAgICAgICAgbW91bnRhaW4sIG1vdW50YWluUml2ZXIsIHJpdmVyLCBzZWF9ID0gcm9tLm1ldGF0aWxlc2V0cztcbiAgY29uc3QgJCA9IHJvbS5tZXRhc2NyZWVucztcblxuICAvLyBTZXZlcmFsIG9mIHRoZSBncmFzcy9yaXZlciBzY3JlZW5zIHdpdGggZm9yZXN0IHRpbGVzIGRvbid0IHdvcmsgb25cbiAgLy8gZGVzZXJ0LiAgRml4IHRoZW0gYnkgbWFraW5nIDVhLi42ZiB3b3JrIGNvcnJlY3RseS5cbiAgJC5yZWdpc3RlckZpeChTY3JlZW5GaXguRGVzZXJ0Um9ja3MpO1xuICBkZXNlcnQuZ2V0VGlsZSgweDVmKS5jb3B5RnJvbSgweDViKS5yZXBsYWNlSW4oJC5vYXNpc0NhdmUsICQub2FzaXNMYWtlKTtcblxuICBkZXNlcnQuZ2V0VGlsZSgweDVhKS5jb3B5RnJvbSgweDk4KS5zZXRUaWxlcyhbLCAsIDB4MWEsIDB4MThdKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg1YikuY29weUZyb20oMHg4MCkuc2V0VGlsZXMoWzB4MzQsIDB4MzIsICwgXSk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NWMpLmNvcHlGcm9tKDB4ODApLnNldFRpbGVzKFssICwgMHgzNywgMHgzNV0pO1xuICBkZXNlcnQuZ2V0VGlsZSgweDVkKS5jb3B5RnJvbSgweDgwKS5zZXRUaWxlcyhbLCAweDM3LCAsIDB4MzRdKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg1ZSkuY29weUZyb20oMHg4MCkuc2V0VGlsZXMoWzB4MzUsICwgMHgzMiwgXSk7XG5cbiAgJC5yZWdpc3RlckZpeChTY3JlZW5GaXguRGVzZXJ0VHJlZXMpO1xuICBkZXNlcnQuZ2V0VGlsZSgweDYzKS5jb3B5RnJvbSgweDcxKTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg2OCkuY29weUZyb20oMHg3MCk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NjkpLmNvcHlGcm9tKDB4NjApO1xuICBkZXNlcnQuZ2V0VGlsZSgweDZhKS5jb3B5RnJvbSgweDY1KTtcbiAgZGVzZXJ0LmdldFRpbGUoMHg2YykuY29weUZyb20oMHg3MCk7XG4gIGRlc2VydC5nZXRUaWxlKDB4NmUpLmNvcHlGcm9tKDB4NzYpO1xuICBkZXNlcnQuZ2V0VGlsZSgweDZmKS5jb3B5RnJvbSgweDc4KTtcblxuICAvLyBMb25nIGdyYXNzIHNjcmVlbnMgZG9uJ3Qgd29yayBvbiBncmFzcyB0aWxlc2V0cyBiZWNhdXNlIG9mIGEgZmV3XG4gIC8vIGRpZmZlcmVudCB0aWxlcyAtIGNvcHkgdGhlbSB3aGVyZSB0aGV5IG5lZWQgdG8gZ28uXG4gICQucmVnaXN0ZXJGaXgoU2NyZWVuRml4LkdyYXNzTG9uZ0dyYXNzKTtcbiAgZ3Jhc3MuZ2V0VGlsZSgweDQwKS5jb3B5RnJvbSgweDUxKTtcbiAgZ3Jhc3MuZ2V0VGlsZSgweDQxKS5jb3B5RnJvbSgweDUyKTtcbiAgZ3Jhc3MuZ2V0VGlsZSgweDQyKS5jb3B5RnJvbSgweDUzKTtcbiAgZ3Jhc3MuZ2V0VGlsZSgweDQzKS5jb3B5RnJvbSgweDU0KTtcbiAgZ3Jhc3MuZ2V0VGlsZSgweDQ0KS5jb3B5RnJvbSgweDU1KTtcbiAgZ3Jhc3MuZ2V0VGlsZSgweDQ1KS5jb3B5RnJvbSgweDU2KTtcbiAgZ3Jhc3MuZ2V0VGlsZSgweDQ2KS5jb3B5RnJvbSgweDU4KTtcbiAgZ3Jhc3MuZ2V0VGlsZSgweDQ3KS5jb3B5RnJvbSgweDU5KTtcblxuICAvLyBBbmdyeSBzZWEgdGlsZXNldCBkb2Vzbid0IHN1cHBvcnQgdGlsZSAwYSAodXNlZCBlbHNld2hlcmUgZm9yIHRoZVxuICAvLyBib3R0b20gdGlsZSBpbiBjYXZlIGVudHJhbmNlcykgYmVjYXVzZSBpdCdzIGFscmVhZHkgaW4gdXNlIChidXRcbiAgLy8gbm90IGFzIGFuIGFsdGVybmF0aXZlKS4gIE1vdmUgaXQgdG8gYWQgYW5kIGdldCAwYSBiYWNrLiAgQWxzbyBhZGp1c3RcbiAgLy8gdGhlIHRpbGVzIGFyb3VuZCB0aGUgY2F2ZSBlbnRyYW5jZXMgdG8gbm90IGhhdmUgZGFtYWdlIHRpbGVzIGluIHRoZVxuICAvLyBkZXNlcnQgdGlsZXNldC4gIFRoaXMgY2hhbmdlcyB0aGUgZ3JhcGhpY3MgYSBiaXQgKGZyb20gZGFyayBibHVlXG4gIC8vIHdhdGVyIHRvIGxpZ2h0IGJsdWUpLCB3aGljaCBkb2Vzbid0IGxvb2sgcXVpdGUgYXMgbmljZS4gIFRoZSBvdGhlclxuICAvLyBhbHRlcm5hdGl2ZSBpcyB0byBhbGxvY2F0ZSAzIG5ldyB0aWxlcywgY29waWVkIGZyb20gMHg4MCBpbiBzZWEgYnV0XG4gIC8vIGZyb20gMHhmNywgMHhmOCwgYW5kIDB4ZmQgaW4gZGVzZXJ0L3JpdmVyL2dyYXNzLiAgVGhlbiBzZWEgY2FuIGtlZXBcbiAgLy8gaXRzIGRlZXAgd2F0ZXIgYnV0IGRlc2VydCBhdm9pZHMgdGhlIGRhbWFnZS5cbiAgJC5yZWdpc3RlckZpeChTY3JlZW5GaXguU2VhQ2F2ZUVudHJhbmNlKTtcbiAgc2VhLmdldFRpbGUoMHhhZCkuY29weUZyb20oMHgwYSlcbiAgICAgIC5yZXBsYWNlSW4oJC5iZWFjaEV4aXROLCAkLmxpZ2h0aG91c2VFbnRyYW5jZSwgJC5vY2VhblNocmluZSk7XG4gIHNlYS5nZXRUaWxlKDB4MGEpLmNvcHlGcm9tKDB4YTIpOyAvLyBkb24ndCBib3RoZXIgc2V0dGluZyBhbiBhbHRlcm5hdGl2ZS5cbiAgLy9zZWEuZ2V0VGlsZSgweDBhKS5zZXRUaWxlcyhbMHg5MSwgMHg5MSwgMHg3ZCwgMHg3ZF0pLnNldEF0dHJzKDIpO1xuICAkLmJvdW5kYXJ5Tl9jYXZlLnNjcmVlbi5zZXQyZCgweDM4LCBbW251bGwsIDB4MDAsIDB4MDAsIG51bGxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW251bGwsIDB4MGEsIDB4MGEsIG51bGxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW251bGwsIDB4ZjcsIDB4ZjcsIG51bGxdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzB4ZjgsIDB4ZjgsIDB4ZjgsIDB4ZjhdXSk7XG4gICQuY29ybmVyU0VfY2F2ZS5zY3JlZW4uc2V0MmQoMHg0OSwgW1tudWxsLCAweDAwLCAweDAwXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW251bGwsIDB4MGEsIDB4MGFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbbnVsbCwgMHhmNywgMHhmN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsweGY4LCAweGY3LCAweGY3XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW251bGwsIDB4ZmQsIDB4ZjddXSk7XG4gICQuY29ybmVyU0VfY2F2ZS5zY3JlZW4uc2V0MmQoMHg0YSwgW1sweDAwLCAweDAwXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzB4MGEsIDB4MGFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMHhmNywgMHhmN10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsweGY4LCAweGY3XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWzB4ODAsIDB4ZmRdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbMHg4MCwgMHhmZl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsweGZhLCBudWxsXV0pO1xuXG4gICAgIC8vICwgWzB4ZjgsIDB4ZjhdLCBbbnVsbCwgMHhmZF1dKTtcbiAgLy8gc2VhLnNjcmVlbnMuYWRkKCQuYm91bmRhcnlXX2NhdmUpO1xuICAvLyBzZWEuc2NyZWVucy5hZGQoJC5kZXNlcnRDYXZlRW50cmFuY2UpO1xuXG4gIC8vIFRvIGFsbG93IGNhdmVzIHRvIGJlIGNsb3NlZCwgd2UgY2xlYXIgb3V0IG1ldGF0aWxlcyAwMS4uMDQsIHRvIGJlIHVzZWQgYXNcbiAgLy8gdGhlIGZvdXIgY29ybmVycyBvZiB0aGUgY2F2ZTogW1swMSwgMDFdLCBbMDIsIDAyXV0uICAwMyBhbmQgMDQgYXJlIHVzZWQgZm9yXG4gIC8vIHdhdGVyIGVudHJhbmNlcyB0byBlbnN1cmUgdGhlIHBsYXllciBpc24ndCBraWNrZWQgb2ZmIHRoZSBkb2xwaGluLlxuICAvLyBUaGVzZSBhcmUgY29waWVkIGZyb20gYzEsZDcgZm9yIG1vc3QgdGlsZXNldHMgKHRob3VnaCBvY2VhbiBpcyBzcGVjaWFsKS5cbiAgLy8gU29tZSB0aWxlc2V0cyBhbHJlYWR5IGhhdmUgbWV0YXRpbGVzIGluIDAxLi4wNCBzbyB3ZSBuZWVkIHRvIG1vdmUgdGhlbSB0b1xuICAvLyB1bm9jY3VwaWVkIHNwb3RzIG9uIGEgcGVyLXRpbGVzZXQgYmFzaXMgKG5vdGUgdGhhdCBzZWEgKDk0KSBhbmQgZGVzZXJ0ICg5YylcbiAgLy8gYXJlIGVudGFuZ2xlZCBoZXJlKS4gIFtUT0RPIC0gY2xlYW4gdXAgMmMgYW5kIDJkIGFzIHdlbGxdXG4gICQucmVnaXN0ZXJGaXgoU2NyZWVuRml4LkNsb3NlQ2F2ZXMpO1xuICAvLyBNb3ZlIHRoZSBleGlzdGluZyB0aWxlcyBpbiAwMS4uMDQgdG8gdmFyaW91cyBmcmVlIHNwb3RzXG4gIHJpdmVyLmdldFRpbGUoMHgwNykuY29weUZyb20oMHgwMSkucmVwbGFjZUluKC4uLnJpdmVyKTtcbiAgcml2ZXIuZ2V0VGlsZSgweDBlKS5jb3B5RnJvbSgweDAyKS5yZXBsYWNlSW4oLi4ucml2ZXIpO1xuICByaXZlci5nZXRUaWxlKDB4MjApLmNvcHlGcm9tKDB4MDMpLnJlcGxhY2VJbiguLi5yaXZlcik7XG4gIHJpdmVyLmdldFRpbGUoMHgyMSkuY29weUZyb20oMHgwNCkucmVwbGFjZUluKC4uLnJpdmVyKTtcbiAgZm9yIChjb25zdCB0cyBvZiBbZGVzZXJ0LCBzZWEsIG1vdW50YWluLCBtb3VudGFpblJpdmVyLCBsaW1lXSkge1xuICAgIHRzLmdldFRpbGUoMHg2OCkuY29weUZyb20oMHgwMSkucmVwbGFjZUluKC4uLnRzKTtcbiAgICB0cy5nZXRUaWxlKDB4ODMpLmNvcHlGcm9tKDB4MDIpLnJlcGxhY2VJbiguLi50cyk7XG4gICAgdHMuZ2V0VGlsZSgweDg4KS5jb3B5RnJvbSgweDAzKS5yZXBsYWNlSW4oLi4udHMpO1xuICAgIHRzLmdldFRpbGUoMHg4OSkuY29weUZyb20oMHgwNCkucmVwbGFjZUluKC4uLnRzKTtcbiAgfVxuICAvLyBNYWtlIDAxLi4wNCBiZSBmbGFnZ2FibGUgd2FsbC9vcGVuaW5nXG4gIGZvciAoY29uc3QgdHMgb2YgW2dyYXNzLCByaXZlciwgZGVzZXJ0XSkge1xuICAgIHRzLmdldFRpbGUoMHgwMSkuY29weUZyb20oMHhjMSkuc2V0QWx0ZXJuYXRpdmUoMHgwMCk7XG4gICAgdHMuZ2V0VGlsZSgweDAyKS5jb3B5RnJvbSgweGQ3KS5zZXRBbHRlcm5hdGl2ZSgweDBhKTtcbiAgICB0cy5nZXRUaWxlKDB4MDMpLmNvcHlGcm9tKDB4YzEpLnNldEFsdGVybmF0aXZlKDB4MDApO1xuICAgIHRzLmdldFRpbGUoMHgwNCkuY29weUZyb20oMHhkNykuc2V0QWx0ZXJuYXRpdmUoMHgwYSk7XG4gIH1cbiAgZm9yIChjb25zdCB0cyBvZiBbc2VhXSkge1xuICAgIHRzLmdldFRpbGUoMHgwMSkuY29weUZyb20oMHhjMSkuc2V0QWx0ZXJuYXRpdmUoMHgwMCk7XG4gICAgdHMuZ2V0VGlsZSgweDAyKS5jb3B5RnJvbSgweGNiKS5zZXRBbHRlcm5hdGl2ZSgweDAwKTtcbiAgICB0cy5nZXRUaWxlKDB4MDMpLmNvcHlGcm9tKDB4YzEpLnNldEFsdGVybmF0aXZlKDB4YzApO1xuICAgIHRzLmdldFRpbGUoMHgwNCkuY29weUZyb20oMHhjYikuc2V0QWx0ZXJuYXRpdmUoMHhjMCk7XG4gICAgLy8gY29weSByb2NrIGdyYXBoaWNzIGZyb20gb3RoZXIgdGlsZXNldCAoc2FtZSBwYWdlIGlzIGxvYWRlZClcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IDU7IGkrKykge1xuICAgICAgdHMuZ2V0VGlsZShpKS5zZXRUaWxlcyhncmFzcy5nZXRUaWxlKGkpLnRpbGVzKTtcbiAgICB9XG4gIH1cbiAgLy8gU2V0IHRoZSBjYXZlIGVudHJhbmNlcyB0byB1c2UgMDEuLjA0IGFzIGFwcHJvcHJpYXRlXG4gIGNvbnN0IGNsb3NlZENhdmVzID0gbmV3IFNldChbXG4gICAgJC5ib3VuZGFyeUVfY2F2ZSwgJC5ib3VuZGFyeVdfY2F2ZSwgJC5leGl0V19jYXZlLCAkLmNhdmVBYm92ZVBvcnRvYSxcbiAgICAkLmJlYWNoQ2F2ZSwgJC5vdXRzaWRlV2luZG1pbGwsXG4gICAgLy8gVE9ETyAtIHRlc3QgdGhlc2U6XG4gICAgJC5leGl0U19jYXZlLCAkLnRvd25FeGl0V19jYXZlLFxuICAgIC8vIFRPRE8gLSAkLnpvbWJpZVRvd25Cb3R0b21fY2F2ZUV4aXQsICh0b3duKVxuICAgIC8vIFRPRE8gLSAkLmNoYW5uZWxFbmRXX2NhdmUsIChkb2xwaGluQ2F2ZSlcbiAgXSk7XG4gIGNvbnN0IHdhdGVyQ2F2ZXMgPSBuZXcgU2V0PE1ldGFzY3JlZW4+KFtdKTtcbiAgLy9pZiAoJC5pc0ZpeGVkKFNjcmVlbkZpeC5TZWFDYXZlRW50cmFuY2VzKSkge1xuICAgIHdhdGVyQ2F2ZXMuYWRkKCQuYm91bmRhcnlOX2NhdmUpO1xuICAgIHdhdGVyQ2F2ZXMuYWRkKCQuY29ybmVyU0VfY2F2ZSk7XG4gIC8vfVxuICBmb3IgKGNvbnN0IHNjciBvZiBbLi4uY2xvc2VkQ2F2ZXMsIC4uLndhdGVyQ2F2ZXNdKSB7XG4gICAgY29uc3QgZXhpdCA9IHNjci5kYXRhLmV4aXRzIS5maW5kKGUgPT4gZS50eXBlID09PSAnY2F2ZScpO1xuICAgIGNvbnN0IHBvcyA9IE1hdGgubWluKC4uLmV4aXQhLmV4aXRzKSAtIDB4MTA7XG4gICAgY29uc3QgdGlsZXMgPSB3YXRlckNhdmVzLmhhcyhzY3IpID8gW1szLCAzXSwgWzQsIDRdXSA6IFtbMSwgMV0sIFsyLCAyXV07XG4gICAgc2NyLnNjcmVlbi5zZXQyZChwb3MsIHRpbGVzKTtcbiAgICBzY3IuYWRkQ3VzdG9tRmxhZyh0cnVlKTtcbiAgfVxuICAvLyBGaXggdGhlIHR3byB2YW5pbGxhIHNlYWxlZC1jYXZlIGdyYXBoaWNzIHRvIGJlIGNvbnNpc3RlbnQgd2l0aFxuICAvLyBvdXIgbmljZXIgXCJyb2NrZmFsbFwiIGdyYXBoaWNzIChzcGVjaWZpY2FsbHksIGFkZCB0aGUgYXJjaGVkIHRvcCkuXG4gICQub3V0c2lkZVdpbmRtaWxsLnNjcmVlbi5zZXQyZCgweDQzLCBbWzB4Y2EsIDB4ODJdXSk7XG4gICQudG93bkV4aXRXX2NhdmUuc2NyZWVuLnNldDJkKDB4MmEsIFtbMHhjYSwgMHg4Ml1dKTtcblxuICAvLyBOT1RFOiB0aGUgY29ycmVjdCBjYXZlcyBhcmUgY2xvc2VkIGJ5IHBhc3MvZml4ZW50cmFuY2V0cmlnZ2Vycy5cblxuICAvLyBzZWEuZ2V0VGlsZSgweDBhKS5jb3B5RnJvbSgweGEyKS5zZXRUaWxlcyhbLCwweDkxLDB4OTFdKS5zZXRBdHRycygwKTtcbiAgLy8gVGhpcyBkb2VzIG9wZW4gdXAgc2NyZWVuICRjZSAoZGVzZXJ0IGNhdmUgZW50cmFuY2UpIGZvciB1c2UgaW4gdGhlIHNlYSxcbiAgLy8gd2hpY2ggaXMgaW50ZXJlc3RpbmcgYmVjYXVzZSB3aGlybHBvb2xzIGNhbid0IGJlIGZsb3duIHBhc3QgLSB3ZSdkIG5lZWRcbiAgLy8gdG8gYWRkIGZsYWdzIHRvIGNsZWFyIHRoZSB3aGlybHBvb2xzLCBidXQgaXQgd291bGQgYmUgYSBjYXZlIHRoYXQnc1xuICAvLyBibG9ja2VkIG9uIGNhbG1pbmcgdGhlIHNlYS4uLlxuXG4gIC8vIFdlIGNvdWxkIGFkZCBhIG51bWJlciBvZiBzY3JlZW5zIHRvIHRoZSBzZWEgaWYgd2UgY291bGQgbW92ZSA1YS4uNWVcbiAgLy8gKHdoaWNoIGNvbGxpZGVzIHdpdGggbW91bnRhaW4gZ2F0ZXMpLiAgODksOGEsOTAsOTksOWQsZDEsZDIgYXJlIGZyZWVcbiAgLy8gaW4gODAgKGdyYXNzKSwgOTAgKHJpdmVyKSwgYW5kIDljIChkZXNlcnQpLiAgVGhlIG1haW4gcHJvYmxlbSBpcyB0aGF0XG4gIC8vIGF0IGxlYXN0IHRoZSBjYXZlIGVudHJhbmNlcyBkb24ndCBxdWl0ZSB3b3JrIGZvciB0aGVzZSAtIHRoZXkgZW5kIHVwXG4gIC8vIGluIHNoYWxsb3cgd2F0ZXIsIGFyZSBhIGxpdHRsZSB0b28gc2hvcnQsIGFuZCBpdCBzZWVtcyB0byBiZSBpbXBvc3NpYmxlXG4gIC8vIHRvIHBpY2sgYSBwYWxldHRlIHRoYXQgaXMgbGlnaHQgYmx1ZSBvbiBib3R0b20gYW5kIGJsYWNrIG9uIHRvcC5cbiAgLy9cbiAgLy8gT3RoZXIgb3B0aW9ucyBmb3IgdGhlIHNlYSBhcmUgMzQsMzgsM2MuLjNmIHdoaWNoIGFyZSBtYXJzaCB0aWxlcyBpblxuICAvLyByaXZlciAtIHdvdWxkIG9wZW4gdXAgc29tZSBuYXJyb3cgcGFzc2FnZXMgKDMzLCBcblxuXG4gIC8vICByb20ubWV0YXNjcmVlbnM7XG5cbiAgLy8gZm9yIChjb25zdCB4IG9mIE9iamVjdC52YWx1ZXMoVElMRVNFVF9GSVhFUykpIHtcbiAgLy8gICBjb25zdCBpZCA9IHguaWQ7XG4gIC8vICAgY29uc3QgdHMgPSByb20udGlsZXNldHNbaWRdO1xuICAvLyAgIGNvbnN0IHRlID0gdHMuZWZmZWN0cygpO1xuICAvLyAgIGZvciAoY29uc3QgdHN0ciBpbiB4KSB7XG4gIC8vICAgICBjb25zdCB0ID0gTnVtYmVyKHRzdHIpO1xuICAvLyAgICAgaWYgKGlzTmFOKHQpKSBjb250aW51ZTtcbiAgLy8gICAgIGNvbnN0IHk6IG51bWJlcnx7YmFzZTogbnVtYmVyfSA9ICh4IGFzIGFueSlbdF07XG4gIC8vICAgICBjb25zdCBiYXNlID0gdHlwZW9mIHkgPT09ICdudW1iZXInID8geSA6ICh5IGFzIGFueSkuYmFzZTtcbiAgLy8gICAgIGNvbnN0IHJlc3Q6IGFueSA9IHR5cGVvZiB5ID09PSAnbnVtYmVyJyA/IHt9IDogeTtcbiAgLy8gICAgIHRzLmF0dHJzW3RdID0gdHMuYXR0cnNbYmFzZV07XG4gIC8vICAgICB0ZS5lZmZlY3RzW3RdID0gdGUuZWZmZWN0c1tiYXNlXTtcbiAgLy8gICAgIFtyZXN0LnRsLCByZXN0LnRyLCByZXN0LmJsLCByZXN0LmJyXS5mb3JFYWNoKChtLCBpKSA9PiB7XG4gIC8vICAgICAgIHRzLnRpbGVzW2ldW3RdID0gdHMudGlsZXNbaV1bbSAhPSBudWxsID8gbSA6IGJhc2VdO1xuICAvLyAgICAgfSk7XG4gIC8vICAgICBpZiAocmVzdC5tb3ZlKSB7fVxuICAvLyAgICAgLy8gaWYgKHJlc3QudGlsZXMpIHtcbiAgLy8gICAgIC8vICAgcmVzdC50aWxlcy5mb3JFYWNoKChzOiBudW1iZXIsIGk6IG51bWJlcikgPT4gdm9pZCAodHMudGlsZXNbaV1bdF0gPSBzKSk7XG4gIC8vICAgICAvLyB9XG4gIC8vICAgfVxuICAvLyB9XG59XG5cblxuLy8gY29uc3QgVElMRVNFVF9GSVhFUyA9IHtcbi8vICAgZ3Jhc3M6IHtcbi8vICAgICBpZDogMHg4MCxcbi8vICAgICAweDQwOiAweDUxLFxuLy8gICAgIDB4NDE6IDB4NTIsXG4vLyAgICAgMHg0MjogMHg1Myxcbi8vICAgICAweDQzOiAweDU0LFxuLy8gICAgIDB4NDQ6IDB4NTUsXG4vLyAgICAgMHg0NTogMHg1Nixcbi8vICAgICAweDQ2OiAweDU4LFxuLy8gICAgIDB4NDc6IDB4NTksXG4vLyAgIH0sXG4vLyAgIGRlc2VydDoge1xuLy8gICAgIGlkOiAweDljLFxuLy8gICAgIDB4NWE6IHtiYXNlOiAweDk4LCBibDogMHg5NCwgYnI6IDB4OTR9LFxuLy8gICAgIDB4NWI6IHtiYXNlOiAweDgwLCB0bDogMHhmZCwgdHI6IDB4ZmN9LFxuLy8gICAgIDB4NWM6IHtiYXNlOiAweDgwLCBibDogMHhmZiwgYnI6IDB4ZmV9LFxuLy8gICAgIDB4NWQ6IHtiYXNlOiAweDgwLCB0cjogMHhmZiwgYnI6IDB4ZmR9LFxuLy8gICAgIDB4NWU6IHtiYXNlOiAweDgwLCB0bDogMHhmZSwgYmw6IDB4ZmN9LFxuLy8gICAgIDB4NjM6IDB4NzEsXG4vLyAgICAgMHg2ODogMHg3MCxcbi8vICAgICAweDY5OiAweDYwLFxuLy8gICAgIDB4NmE6IDB4NjUsXG4vLyAgICAgMHg2YzogMHg3MCxcbi8vICAgICAweDZlOiAweDc2LFxuLy8gICAgIDB4NmY6IDB4NzgsXG4vLyAgIH0sXG4vLyB9IGFzIGNvbnN0O1xuXG4vLyBjb25zdCBTQ1JFRU5fUkVNQVBTID0gW1xuLy8gICB7dGlsZXNldHM6IFsweDljXSwgc3JjOiAweDViLCBkZXN0OiAweDVmLCBzY3JlZW5zOiBbMHhjZl19LFxuLy8gXTtcbi8vIGNvbnN0IFtdID0gU0NSRUVOX1JFTUFQUztcblxuLy8gVE9ETyAtIGNvcHkgNWYgPC0gNWIgaW4gOWMsIHRoZW4gcmVtYXAgaW4gc2NyZWVuIGNmXG4vLyAgICAgIC0gYmV0dGVyIG5vdGF0aW9uP1xuLy8gQ29uc2lkZXIgZG9pbmcgdGhpcyBwcm9ncmFtbWF0aWNhbGx5LCB0aG91Z2ggd2UnZCB3YW50IHRvIHVzZVxuLy8gdGhlIF9hY3R1YWxfIHNjcmVlbi10aWxlc2V0IHVzYWdlcyByYXRoZXIgdGhhbiBkZWNsYXJlZCBvcHRpb25zXG5cbi8vIGNsYXNzIFgge1xuLy8gICByZWFkb25seSBtOiBNZXRhc2NyZWVucztcbi8vICAgY29uc3RydWN0b3IocjogUm9tKSB7XG4vLyAgICAgdGhpcy5tID0gbmV3IE1ldGFzY3JlZW5zKHIpO1xuLy8gICB9XG4vLyB9XG5cbi8vIEFwcGxpZXMgdGhlIFdpZGVBcmVuYUV4aXRzIHNjcmVlbiBmaXguXG5leHBvcnQgZnVuY3Rpb24gd2lkZUFyZW5hRXhpdHMocm9tOiBSb20pIHtcbiAgZnVuY3Rpb24gd2lkZW4oZXhpdHM6IG51bWJlcltdKSB7XG4gICAgZXhpdHMuc3BsaWNlKDAsIGV4aXRzLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgLi4ubmV3IFNldChpdGVycy5jb25jYXQoXG4gICAgICAgICAgICAgICAgICAgICAuLi5leGl0cy5tYXAoZSA9PiBbZSwgZSArIDEsIGUgLSAxXSkpKSk7XG4gIH1cblxuICAvLyBXaWRlbiB0aGUgdG9wIGV4aXRzIG9mIHRoZSBzaW1wbGUgYXJlbmFzXG4gIGNvbnN0IHtcbiAgICBmb3J0cmVzc0FyZW5hX3Rocm91Z2gsIGZvcnRyZXNzVHJhcCxcbiAgICBoYWxsTlMsIGhhbGxOU19hcmVuYSwgaGFsbE5TX2FyZW5hV2FsbCwgaGFsbE5TX2VudHJhbmNlLFxuICB9ID0gcm9tLm1ldGFzY3JlZW5zO1xuICBoYWxsTlNfYXJlbmEuc2NyZWVuLnNldDJkKDB4MDQsIFtcbiAgICBbMHg5NywgMHg3NiwgMHgyMiwgMHgyMywgMHgyMywgMHgyMywgMHg0YiwgMHg5NV0sXG4gICAgWzB4NDIsIDB4NDgsIDB4MjIsIDB4MjEsIDB4MjMsIDB4MjMsIDB4NDUsIDB4NDJdLFxuICAgIFsweDQzLCAweDQ5LCAweDJlLCAweDIzLCAweDIzLCAweDIxLCAweDQ2LCAweDQzXSxcbiAgICBbMHg0NCwgMHg0YSwgMHgyZSwgMHgyMywgMHgyMSwgMHgyMSwgMHg0NywgMHg0NF0sXG4gIF0pO1xuICBoYWxsTlNfYXJlbmEuc2V0R3JpZFRpbGUoJyBjIHwgYSB8IGMgJyk7IC8vLCAnIGMgfCBhIHwgdyAnKTtcbiAgd2lkZW4oaGFsbE5TX2FyZW5hLmZpbmRFeGl0QnlUeXBlKCdlZGdlOnRvcCcpLmV4aXRzIGFzIG51bWJlcltdKTtcblxuICBoYWxsTlNfYXJlbmFXYWxsLnNjcmVlbi5zZXQyZCgweDA0LCBbXG4gICAgWzB4OTQsIDB4NGMsIDB4MjIsIDB4MjEsIDB4MjEsIDB4MjEsIDB4NGIsIDB4OTNdLFxuICAgIFsweDk3LCAweDRmLCAweDAwLCAweDAxLCAweDAxLCAweDAyLCAweDUwLCAweDk1XSxcbiAgXSk7XG4gIGhhbGxOU19hcmVuYVdhbGwuc2V0R3JpZFRpbGUoJyBjIHwgYSB8IGMgJyk7XG4gIHdpZGVuKGhhbGxOU19hcmVuYVdhbGwuZmluZEV4aXRCeVR5cGUoJ2VkZ2U6dG9wJykuZXhpdHMgYXMgbnVtYmVyW10pO1xuXG4gIC8vIE1vdmUgdGhlIGFiZHVjdGlvbiB0cmlnZ2VyIGRvd24gMyB0aWxlcyBzbyB5b3UgY2FuJ3Qgd2FsayBhcm91bmQgaXRcbiAgY29uc3QgYWJkdWN0aW9uVHJpZ2dlciA9XG4gICAgICByb20ubG9jYXRpb25zLlplYnVDYXZlLnNwYXducy5maW5kKHMgPT4gcy5pc1RyaWdnZXIoKSAmJiBzLmlkID09PSAweDhjKTtcbiAgaWYgKGFiZHVjdGlvblRyaWdnZXIpIGFiZHVjdGlvblRyaWdnZXIueXQgKz0gNDtcblxuICAvLyBXaWRlbiB0aGUgdG9wIGV4aXRzIG9mIHRoZSBmb3J0cmVzcy9weXJhbWlkIGFyZW5hc1xuICBmb3J0cmVzc0FyZW5hX3Rocm91Z2guc2NyZWVuLnNldDJkKDB4MDUsIFtcbiAgICBbMHg1ZiwgMHgyMiwgMHgyMSwgMHgyMSwgMHgyMSwgMHg1Zl0sXG4gICAgWzB4YjcsIDB4MjIsIDB4MjEsIDB4MjEsIDB4MjEsIDB4YjVdLFxuICAgIFsweGJmLCAweDIyLCAweDIxLCAweDIxLCAweDIxLCAweGE4XSxcbiAgXSk7XG4gIGZvcnRyZXNzQXJlbmFfdGhyb3VnaC5zZXRHcmlkVGlsZSgnIGMgfCBhIHwgdyAnKTtcbiAgd2lkZW4oZm9ydHJlc3NBcmVuYV90aHJvdWdoLmZpbmRFeGl0QnlUeXBlKCdlZGdlOnRvcCcpLmV4aXRzIGFzIG51bWJlcltdKTtcblxuICAvLyBXaWRlbiB0aGUgYm90dG9tIGVudHJhbmNlIG9mIHNhYmVyYSdzIHRyYXBcbiAgZm9ydHJlc3NUcmFwLnNjcmVlbi5zZXQyZCgweGM0LCBbXG4gICAgWzB4M2MsIDB4M2QsIDB4MjEsIDB4MjEsIDB4MjEsIDB4MjEsIDB4M2IsIDB4M2NdLFxuICAgIFsweDkyLCAweDRjLCAweDIyLCAweDIxLCAweDIxLCAweDIxLCAweDRiLCAweDkwXSxcbiAgICBbMHg5NCwgMHg0YywgMHgyMiwgMHgyMSwgMHgyMSwgMHgyMSwgMHg0YiwgMHg5M10sXG4gIF0pO1xuICBmb3J0cmVzc1RyYXAuc2V0R3JpZFRpbGUoJyAgIHwgeCB8IGMgJyk7XG4gIHdpZGVuKGZvcnRyZXNzVHJhcC5maW5kRXhpdEJ5VHlwZSgnZWRnZTpib3R0b20nKS5leGl0cyBhcyBudW1iZXJbXSk7XG5cbiAgLy8gRmluZCBjYXNlcyB3aGVyZSBhIG5hcnJvdyBoYWxsd2F5IHdhcyB1c2VkIG9uIHRvcFxuICAvLyBvZiBhbiBhcmVuYSBhbmQgcmVwbGFjZSB3aXRoIGEgbm9ybWFsIGhhbGx3YXlcbiAgZm9yIChjb25zdCBsb2NhdGlvbiBvZiByb20ubG9jYXRpb25zKSB7XG4gICAgY29uc3QgbWV0YSA9IGxvY2F0aW9uLm1ldGE7XG4gICAgZm9yIChjb25zdCBwb3Mgb2YgbWV0YS5hbGxQb3MoKSkge1xuICAgICAgY29uc3Qgc2NyID0gbWV0YS5nZXQocG9zKTtcbiAgICAgIGlmIChzY3IgPT09IGhhbGxOU19lbnRyYW5jZSAmJiBtZXRhLmdldChwb3MgKyAxNik/Lmhhc0ZlYXR1cmUoJ2FyZW5hJykpIHtcbiAgICAgICAgbWV0YS5zZXQocG9zLCBoYWxsTlMpO1xuICAgICAgICAvLyBhbHNvIHNldCB0aGUgbm9uLW1ldGEgdmVyc2lvbiwgbWFpbmx5IGZvciBtYXAgdmlld2VyXG4gICAgICAgIGNvbnN0IHJvdyA9IGxvY2F0aW9uLnNjcmVlbnNbcG9zID4+PiA0XTtcbiAgICAgICAgaWYgKHJvdykgcm93W3BvcyAmIDB4Zl0gPSBoYWxsTlMuc2lkO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19