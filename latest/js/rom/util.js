export function upperCamelToSpaces(upperCamel) {
    return upperCamel.replace(/([a-z])([A-Z0-9])/g, '$1 $2')
        .replace(/Of/g, 'of')
        .replace(/_/g, ' - ');
}
export function seq(x, f = (i) => i) {
    return new Array(x).fill(0).map((_, i) => f(i));
}
export function slice(arr, start, len) {
    return arr.slice(start, start + len);
}
export function tuple(arr, start, len) {
    return Array.from(arr.slice(start, start + len));
}
export function signed(x) {
    return x < 0x80 ? x : x - 0x100;
}
export function unsigned(x) {
    return x < 0 ? x + 0x100 : x;
}
export function varSlice(arr, start, width, sentinel, end = Infinity, func) {
    if (!func)
        func = (x) => x;
    const out = [];
    while (start + width <= end && arr[start] !== sentinel) {
        out.push(func(arr.slice(start, start + width)));
        start += width;
    }
    return out;
}
export function addr(arr, i, offset = 0) {
    return (arr[i] | arr[i + 1] << 8) + offset;
}
export function group(width, arr, func) {
    if (!func)
        func = (x) => x;
    return seq(Math.max(0, Math.floor(arr.length / width)), i => func(slice(arr, i * width, width)));
}
export function reverseBits(x) {
    return ((x * 0x0802 & 0x22110) | (x * 0x8020 & 0x88440)) * 0x10101 >>> 16 & 0xff;
}
export function countBits(x) {
    x -= x >> 1 & 0x55;
    x = (x & 0x33) + (x >> 2 & 0x33);
    return (x + (x >> 4)) & 0xf;
}
export function hex(id) {
    return id != null ? id.toString(16).padStart(2, '0') : String(id);
}
export function hex3(id) {
    return id.toString(16).padStart(3, '0');
}
export function hex4(id) {
    return id.toString(16).padStart(4, '0');
}
export function hex5(id) {
    return id.toString(16).padStart(5, '0');
}
export function concatIterables(iters) {
    const out = [];
    for (const iter of iters) {
        for (const elem of iter) {
            out.push(elem);
        }
    }
    return out;
}
export function readBigEndian(data, offset) {
    return data[offset] << 8 | data[offset + 1];
}
export function readLittleEndian(data, offset) {
    return data[offset + 1] << 8 | data[offset];
}
export function readString(arr, address, end = 0) {
    const bytes = [];
    while (arr[address] != end) {
        bytes.push(arr[address++]);
    }
    return String.fromCharCode(...bytes);
}
export function writeLittleEndian(data, offset, value) {
    data[offset] = value & 0xff;
    data[offset + 1] = value >>> 8;
}
export function writeString(arr, address, str) {
    for (let i = 0, len = str.length; i < len; i++) {
        arr[address + i] = str.charCodeAt(i);
    }
}
export function write(data, offset, values) {
    data.subarray(offset, offset + values.length).set(values);
}
export class FlagListType {
    constructor(last, clear, nonEmpty = false) {
        this.last = last;
        this.clear = clear;
        this.nonEmpty = nonEmpty;
    }
    read(data, offset = 0) {
        const flags = [];
        while (true) {
            const hi = data[offset++];
            const lo = data[offset++];
            const flag = (hi & 3) << 8 | lo;
            const signed = hi & this.clear ? ~flag : flag;
            if (signed !== ~0)
                flags.push(signed);
            if (hi & this.last)
                return flags;
        }
    }
    bytes(flags) {
        flags = flags.filter(f => f !== ~0);
        if (this.nonEmpty && !flags.length)
            flags = [~0];
        const bytes = [];
        for (let i = 0; i < flags.length; i++) {
            let flag = flags[i];
            if (flag < 0)
                flag = (this.clear << 8) | ~flag;
            if (i === flags.length - 1)
                flag |= (this.last << 8);
            bytes.push(flag >>> 8);
            bytes.push(flag & 0xff);
        }
        return bytes;
    }
    write(data, flags, offset = 0) {
        const bytes = this.bytes(flags);
        for (let i = 0; i < bytes.length; i++) {
            data[i + offset] = bytes[i];
        }
    }
}
export const DIALOG_FLAGS = new FlagListType(0x40, 0x80);
export const ITEM_GET_FLAGS = new FlagListType(0x40, 0x80, true);
export const ITEM_USE_FLAGS = new FlagListType(0x40, 0x80, true);
export const ITEM_CONDITION_FLAGS = new FlagListType(0x80, 0x20, true);
export const SPAWN_CONDITION_FLAGS = new FlagListType(0x80, 0x20);
export function initializer() {
    const tag = Symbol();
    function f(...args) {
        return { tag, args };
    }
    f.commit = (instance, builder) => {
        for (const prop of Object.getOwnPropertyNames(instance)) {
            const value = instance[prop];
            if (value.tag !== tag)
                continue;
            instance[prop] = builder(prop, ...value.args);
        }
    };
    return f;
}
const PROP_TAG = Symbol('PROP_TAG');
const dataTupleMap = new WeakMap();
function dataTupleActualClass(arg) {
    let result = dataTupleMap.get(arg);
    if (!result) {
        result = class extends DataTuple {
        };
        Object.defineProperties(result, { name: { value: arg.name } });
        Object.assign(result, arg);
        Reflect.setPrototypeOf(result.prototype, arg.prototype);
        const proto = new arg();
        const descriptors = {};
        for (const [prop, descr] of Object.entries(proto)) {
            if (descr && descr[PROP_TAG]) {
                descriptors[prop] = descr;
            }
        }
        Object.defineProperties(result.prototype, descriptors);
        dataTupleMap.set(arg, result);
        dataTupleMap.set(result, result);
    }
    return result;
}
export class DataTuple {
    constructor(arg) {
        this.data = arg;
    }
    static of(inits) {
        return Object.assign(new (dataTupleActualClass(this))(new Array(this.size).fill(0)), inits);
    }
    static from(data, offset = 0) {
        const cls = dataTupleActualClass(this);
        const arg = !offset && data.length === this.size ?
            data : tuple(data, offset, this.size);
        return new cls(arg);
    }
    [Symbol.iterator]() {
        return this.data[Symbol.iterator]();
    }
    hex() {
        return Array.from(this.data, hex).join(' ');
    }
    clone() {
        return new this.constructor(this.data);
    }
    prop(...bits) {
        return {
            get() {
                let value = 0;
                for (const [index, mask = 0xff, shift = 0] of bits) {
                    const lsh = shift < 0 ? -shift : 0;
                    const rsh = shift < 0 ? 0 : shift;
                    value |= ((this.data[index] & mask) >>> rsh) << lsh;
                }
                return value;
            },
            set(value) {
                for (const [index, mask = 0xff, shift = 0] of bits) {
                    const lsh = shift < 0 ? -shift : 0;
                    const rsh = shift < 0 ? 0 : shift;
                    const v = (value >>> lsh) << rsh & mask;
                    this.data[index] = this.data[index] & ~mask | v;
                }
            },
            [PROP_TAG]: true,
        };
    }
    booleanProp(byte, bit) {
        return {
            get() {
                return Boolean(this.data[byte] & (1 << bit));
            },
            set(value) {
                const mask = 1 << bit;
                if (value) {
                    this.data[byte] |= mask;
                }
                else {
                    this.data[byte] &= ~mask;
                }
            },
            [PROP_TAG]: true,
        };
    }
}
export const watchArray = (arr, watch) => {
    const arrayChangeHandler = {
        get(target, property) {
            let v = target[property];
            if (property === 'subarray') {
                return (start, end) => {
                    const sub = target.subarray(start, end);
                    if (start <= watch && watch < end)
                        return watchArray(sub, watch - start);
                    return sub;
                };
            }
            else if (property === 'set') {
                return (val) => {
                    console.log(`Setting overlapping array ${watch}`);
                    debugger;
                    target.set(val);
                };
            }
            if (typeof v === 'function')
                v = v.bind(target);
            return v;
        },
        set(target, property, value, receiver) {
            if (property == watch) {
                console.log(`Writing ${watch.toString(16)}`);
                debugger;
            }
            target[property] = value;
            return true;
        },
    };
    return new Proxy(arr, arrayChangeHandler);
};
export class Segment {
    constructor(name, bank, org) {
        this.name = name;
        this.bank = bank;
        this.org = org;
    }
    get offset() {
        return (this.bank & 0x1f) << 13;
    }
}
Segment.$04 = new Segment('04', 0x04, 0x8000);
Segment.$05 = new Segment('05', 0x05, 0xa000);
Segment.$0a = new Segment('0a', 0x0a, 0x8000);
Segment.$0b = new Segment('0b', 0x0b, 0xa000);
Segment.$0c = new Segment('0c', 0x0c, 0x8000);
Segment.$0d = new Segment('0d', 0x0d, 0xa000);
Segment.$0e = new Segment('0e', 0x0e, 0x8000);
Segment.$0f = new Segment('0f', 0x0f, 0xa000);
Segment.$10 = new Segment('10', 0x10, 0x8000);
Segment.$14 = new Segment('14', 0x14, 0x8000);
Segment.$15 = new Segment('15', 0x15, 0xa000);
Segment.$16_a = new Segment('16:a', 0x16, 0xa000);
Segment.$17 = new Segment('17', 0x17, 0xa000);
Segment.$18 = new Segment('18', 0x18, 0x8000);
Segment.$19 = new Segment('19', 0x19, 0xa000);
Segment.$1a = new Segment('1a', 0x1a, 0x8000);
Segment.$1b = new Segment('1b', 0x1b, 0xa000);
Segment.$fe = new Segment('fe', 0x1e, 0xc000);
Segment.$ff = new Segment('ff', 0x1f, 0xe000);
export class Address {
    constructor(seg, delta) {
        this.seg = seg;
        this.delta = delta;
    }
    static of(segment, org) {
        return new Address(segment, org - segment.org);
    }
    get offset() {
        return this.seg.offset + this.delta;
    }
    get org() {
        return this.seg.org + this.delta;
    }
    get segment() {
        return this.seg.name;
    }
    plus(offset, nextSegment) {
        const newDelta = this.delta + offset;
        if (newDelta >= 0x2000) {
            if (!nextSegment)
                throw new Error(`Segment changed`);
            if (this.seg.org & 0x2000)
                throw new Error(`Bad segment cross`);
            return new Address(nextSegment, newDelta & 0x1fff);
        }
        return new Address(this.seg, newDelta);
    }
    minus(addr) {
        if (addr.seg !== this.seg)
            throw new Error(`Incompatible segments`);
        return this.delta - addr.delta;
    }
    read(data) {
        return data[this.offset];
    }
    readLittleEndian(data) {
        const off = this.offset;
        return data[off] | data[off + 1] << 8;
    }
    readAddress(data, ...segments) {
        const org = this.readLittleEndian(data);
        if (!segments.length)
            segments = [this.seg];
        for (const s of segments) {
            if ((org & 0xe000) === (s.org & 0xe000))
                return Address.of(s, org);
        }
        throw new Error(`Could not find valid segment for ${hex(org)}`);
    }
    loc(assembler, name) {
        assembler.segment(this.segment);
        assembler.org(this.org, name);
    }
}
export function free(a, seg, start, end) {
    a.segment(seg.name);
    a.org(start);
    a.free(end - start);
}
export function relocExportLabel(a, seg, name) {
    a.segment(...seg.map(s => s.name));
    a.reloc(name);
    a.label(name);
    a.export(name);
}
export function cloneArray(arr) {
    return [...arr];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxNQUFNLFVBQVUsa0JBQWtCLENBQUMsVUFBa0I7SUFDbkQsT0FBTyxVQUFVLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLE9BQU8sQ0FBQztTQUNuRCxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQztTQUNwQixPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFPRCxNQUFNLFVBQVUsR0FBRyxDQUFDLENBQVMsRUFBRSxJQUEyQixDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNoRSxPQUFPLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNsRCxDQUFDO0FBU0QsTUFBTSxVQUFVLEtBQUssQ0FBc0IsR0FBTSxFQUFFLEtBQWEsRUFBRSxHQUFXO0lBQzNFLE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZDLENBQUM7QUFNRCxNQUFNLFVBQVUsS0FBSyxDQUFJLEdBQVksRUFBRSxLQUFhLEVBQUUsR0FBVztJQUMvRCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUVELE1BQU0sVUFBVSxNQUFNLENBQUMsQ0FBUztJQUM5QixPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztB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QUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUV0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0QyxhQUFLLEdBQUcsSUFBSSxPQUFPLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUMxQyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUV0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0QyxXQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztBQUt4RCxNQUFNLE9BQU8sT0FBTztJQUtsQixZQUE2QixHQUFZLEVBQVcsS0FBYTtR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LENBQUM7Q0FhRjtBQVdELE1BQU0sVUFBVSxJQUFJLENBQUMsQ0FBYSxFQUFFLEdBQVksRUFBRSxLQUFhLEVBQUUsR0FBVztJQUMxRSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNwQixDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2IsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUM7QUFDdEIsQ0FBQztBQUVELE1BQU0sVUFBVSxnQkFBZ0IsQ0FBQyxDQUFhLEVBQUUsR0FBYyxFQUFFLElBQVk7SUFDMUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNuQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2QsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNkLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDakIsQ0FBQztBQUVELE1BQU0sVUFBVSxVQUFVLENBQStCLEdBQU07SUFDN0QsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFlLENBQUM7QUFDaEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEdlbmVyYWwgdXRpbGl0aWVzIGZvciByb20gcGFja2FnZS5cblxuZXhwb3J0IGZ1bmN0aW9uIHVwcGVyQ2FtZWxUb1NwYWNlcyh1cHBlckNhbWVsOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gdXBwZXJDYW1lbC5yZXBsYWNlKC8oW2Etel0pKFtBLVowLTldKS9nLCAnJDEgJDInKVxuICAgICAgLnJlcGxhY2UoL09mL2csICdvZicpXG4gICAgICAucmVwbGFjZSgvXy9nLCAnIC0gJyk7XG59XG5cbi8qKiBSZW1vdmVzIHJlYWRvbmx5IGZyb20gZmllbGRzLiAqL1xuZXhwb3J0IHR5cGUgTXV0YWJsZTxUPiA9IHstcmVhZG9ubHkgW0sgaW4ga2V5b2YoVCldOiBUW0tdfTtcblxuZXhwb3J0IGZ1bmN0aW9uIHNlcSh4OiBudW1iZXIpOiBudW1iZXJbXTtcbmV4cG9ydCBmdW5jdGlvbiBzZXE8VD4oeDogbnVtYmVyLCBmPzogKHg6IG51bWJlcikgPT4gVCk6IFRbXTtcbmV4cG9ydCBmdW5jdGlvbiBzZXEoeDogbnVtYmVyLCBmOiAoeDogbnVtYmVyKSA9PiBudW1iZXIgPSAoaSkgPT4gaSk6IG51bWJlcltdIHtcbiAgcmV0dXJuIG5ldyBBcnJheSh4KS5maWxsKDApLm1hcCgoXywgaSkgPT4gZihpKSk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGF0YTxUPiB7XG4gIFtpbmRleDogbnVtYmVyXTogVDtcbiAgbGVuZ3RoOiBudW1iZXI7XG4gIHNsaWNlKHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyKTogdGhpcztcbiAgW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmF0b3I8VD47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzbGljZTxUIGV4dGVuZHMgRGF0YTxhbnk+PihhcnI6IFQsIHN0YXJ0OiBudW1iZXIsIGxlbjogbnVtYmVyKTogVCB7XG4gIHJldHVybiBhcnIuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgbGVuKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHR1cGxlPFQ+KGFycjogRGF0YTxUPiwgc3RhcnQ6IG51bWJlciwgbGVuOiAyKTogW1QsIFRdO1xuZXhwb3J0IGZ1bmN0aW9uIHR1cGxlPFQ+KGFycjogRGF0YTxUPiwgc3RhcnQ6IG51bWJlciwgbGVuOiAzKTogW1QsIFQsIFRdO1xuZXhwb3J0IGZ1bmN0aW9uIHR1cGxlPFQ+KGFycjogRGF0YTxUPiwgc3RhcnQ6IG51bWJlciwgbGVuOiA0KTogW1QsIFQsIFQsIFRdO1xuZXhwb3J0IGZ1bmN0aW9uIHR1cGxlPFQ+KGFycjogRGF0YTxUPiwgc3RhcnQ6IG51bWJlciwgbGVuOiBudW1iZXIpOiBUW107XG5leHBvcnQgZnVuY3Rpb24gdHVwbGU8VD4oYXJyOiBEYXRhPFQ+LCBzdGFydDogbnVtYmVyLCBsZW46IG51bWJlcik6IFRbXSB7XG4gIHJldHVybiBBcnJheS5mcm9tKGFyci5zbGljZShzdGFydCwgc3RhcnQgKyBsZW4pKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNpZ25lZCh4OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4geCA8IDB4ODAgPyB4IDogeCAtIDB4MTAwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdW5zaWduZWQoeDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIHggPCAwID8geCArIDB4MTAwIDogeDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhclNsaWNlPFQgZXh0ZW5kcyBEYXRhPG51bWJlcj4+KGFycjogVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VudGluZWw6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ/OiBudW1iZXIpOiBUW107XG5leHBvcnQgZnVuY3Rpb24gdmFyU2xpY2U8VCBleHRlbmRzIERhdGE8bnVtYmVyPiwgVT4oYXJyOiBULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW50aW5lbDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IChzbGljZTogVCkgPT4gVSk6IFVbXTtcbmV4cG9ydCBmdW5jdGlvbiB2YXJTbGljZTxUIGV4dGVuZHMgRGF0YTxudW1iZXI+LCBVPihhcnI6IFQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbnRpbmVsOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBudW1iZXIgPSBJbmZpbml0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jPzogKHNsaWNlOiBUKSA9PiBVKTogVVtdIHtcbiAgaWYgKCFmdW5jKSBmdW5jID0gKHg6IFQpID0+IHggYXMgYW55O1xuICBjb25zdCBvdXQgPSBbXTtcbiAgd2hpbGUgKHN0YXJ0ICsgd2lkdGggPD0gZW5kICYmIGFycltzdGFydF0gIT09IHNlbnRpbmVsKSB7XG4gICAgb3V0LnB1c2goZnVuYyEoYXJyLnNsaWNlKHN0YXJ0LCBzdGFydCArIHdpZHRoKSkpO1xuICAgIHN0YXJ0ICs9IHdpZHRoO1xuICB9XG4gIHJldHVybiBvdXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRyKGFycjogRGF0YTxudW1iZXI+LCBpOiBudW1iZXIsIG9mZnNldDogbnVtYmVyID0gMCk6IG51bWJlciB7XG4gIHJldHVybiAoYXJyW2ldIHwgYXJyW2kgKyAxXSA8PCA4KSArIG9mZnNldDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdyb3VwPFQgZXh0ZW5kcyBEYXRhPGFueT4+KHdpZHRoOiBudW1iZXIsIGFycjogVCk6IFRbXTtcbmV4cG9ydCBmdW5jdGlvbiBncm91cDxUIGV4dGVuZHMgRGF0YTxhbnk+LCBVPih3aWR0aDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycjogVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jOiAoc2xpY2U6IFQpID0+IFUpOiBVW107XG5cbmV4cG9ydCBmdW5jdGlvbiBncm91cDxUIGV4dGVuZHMgRGF0YTxhbnk+LCBVPih3aWR0aDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFycjogVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jPzogKHNsaWNlOiBUKSA9PiBVKTogVVtdIHtcbiAgaWYgKCFmdW5jKSBmdW5jID0gKHg6IFQpID0+IHggYXMgYW55O1xuICByZXR1cm4gc2VxKFxuICAgICAgTWF0aC5tYXgoMCwgTWF0aC5mbG9vcihhcnIubGVuZ3RoIC8gd2lkdGgpKSxcbiAgICAgIGkgPT4gZnVuYyEoc2xpY2UoYXJyLCBpICogd2lkdGgsIHdpZHRoKSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmV2ZXJzZUJpdHMoeDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuICgoeCAqIDB4MDgwMiAmIDB4MjIxMTApIHwgKHggKiAweDgwMjAgJiAweDg4NDQwKSkgKiAweDEwMTAxID4+PiAxNiAmIDB4ZmY7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb3VudEJpdHMoeDogbnVtYmVyKTogbnVtYmVyIHtcbiAgeCAtPSB4ID4+IDEgJiAweDU1O1xuICB4ID0gKHggJiAweDMzKSArICh4ID4+IDIgJiAweDMzKTtcbiAgcmV0dXJuICh4ICsgKHggPj4gNCkpICYgMHhmO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4KGlkOiBudW1iZXIpOiBzdHJpbmcge1xuICByZXR1cm4gaWQgIT0gbnVsbCA/IGlkLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpIDogU3RyaW5nKGlkKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhleDMoaWQ6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBpZC50b1N0cmluZygxNikucGFkU3RhcnQoMywgJzAnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhleDQoaWQ6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBpZC50b1N0cmluZygxNikucGFkU3RhcnQoNCwgJzAnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhleDUoaWQ6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBpZC50b1N0cmluZygxNikucGFkU3RhcnQoNSwgJzAnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbmNhdEl0ZXJhYmxlcyhpdGVyczogSXRlcmFibGU8bnVtYmVyPltdKTogbnVtYmVyW10ge1xuICBjb25zdCBvdXQ6IG51bWJlcltdID0gW107XG4gIGZvciAoY29uc3QgaXRlciBvZiBpdGVycykge1xuICAgIGZvciAoY29uc3QgZWxlbSBvZiBpdGVyKSB7XG4gICAgICBvdXQucHVzaChlbGVtKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG91dDtcbiAgLy8gcmV0dXJuIFtdLmNvbmNhdCguLi5pdGVycy5tYXAoQXJyYXkuZnJvbSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZEJpZ0VuZGlhbihkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCA4IHwgZGF0YVtvZmZzZXQgKyAxXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRMaXR0bGVFbmRpYW4oZGF0YTogRGF0YTxudW1iZXI+LCBvZmZzZXQ6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiBkYXRhW29mZnNldCArIDFdIDw8IDggfCBkYXRhW29mZnNldF07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkU3RyaW5nKGFycjogRGF0YTxudW1iZXI+LCBhZGRyZXNzOiBudW1iZXIsIGVuZDogbnVtYmVyID0gMCk6IHN0cmluZyB7XG4gIGNvbnN0IGJ5dGVzID0gW107XG4gIHdoaWxlIChhcnJbYWRkcmVzc10gIT0gZW5kKSB7XG4gICAgYnl0ZXMucHVzaChhcnJbYWRkcmVzcysrXSk7XG4gIH1cbiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYnl0ZXMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gd3JpdGVMaXR0bGVFbmRpYW4oZGF0YTogRGF0YTxudW1iZXI+LCBvZmZzZXQ6IG51bWJlciwgdmFsdWU6IG51bWJlcikge1xuICBkYXRhW29mZnNldF0gPSB2YWx1ZSAmIDB4ZmY7XG4gIGRhdGFbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+Pj4gODtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdyaXRlU3RyaW5nKGFycjogRGF0YTxudW1iZXI+LCBhZGRyZXNzOiBudW1iZXIsIHN0cjogc3RyaW5nKSB7XG4gIGZvciAobGV0IGkgPSAwLCBsZW4gPSBzdHIubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICBhcnJbYWRkcmVzcyArIGldID0gc3RyLmNoYXJDb2RlQXQoaSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdyaXRlKGRhdGE6IFVpbnQ4QXJyYXksIG9mZnNldDogbnVtYmVyLCB2YWx1ZXM6IERhdGE8bnVtYmVyPikge1xuICBkYXRhLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgdmFsdWVzLmxlbmd0aCkuc2V0KHZhbHVlcyk7XG59XG5cbmV4cG9ydCBjbGFzcyBGbGFnTGlzdFR5cGUge1xuICBjb25zdHJ1Y3RvcihyZWFkb25seSBsYXN0OiBudW1iZXIsXG4gICAgICAgICAgICAgIHJlYWRvbmx5IGNsZWFyOiBudW1iZXIsXG4gICAgICAgICAgICAgIHJlYWRvbmx5IG5vbkVtcHR5OiBib29sZWFuID0gZmFsc2UpIHt9XG5cbiAgcmVhZChkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyID0gMCk6IG51bWJlcltdIHtcbiAgICAvLyBUT0RPIC0gZG8gd2UgZXZlciBuZWVkIHRvIGludmVydCBjbGVhci9sYXN0PyAgSWYgc28sIHVzZSB+IGFzIHNpZ25hbC5cbiAgICBjb25zdCBmbGFncyA9IFtdO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBjb25zdCBoaSA9IGRhdGFbb2Zmc2V0KytdO1xuICAgICAgY29uc3QgbG8gPSBkYXRhW29mZnNldCsrXTtcbiAgICAgIGNvbnN0IGZsYWcgPSAoaGkgJiAzKSA8PCA4IHwgbG87XG4gICAgICBjb25zdCBzaWduZWQgPSBoaSAmIHRoaXMuY2xlYXIgPyB+ZmxhZyA6IGZsYWc7XG4gICAgICBpZiAoc2lnbmVkICE9PSB+MCkgZmxhZ3MucHVzaChzaWduZWQpO1xuICAgICAgaWYgKGhpICYgdGhpcy5sYXN0KSByZXR1cm4gZmxhZ3M7XG4gICAgfVxuICB9XG5cbiAgYnl0ZXMoZmxhZ3M6IG51bWJlcltdKTogbnVtYmVyW10ge1xuICAgIGZsYWdzID0gZmxhZ3MuZmlsdGVyKGYgPT4gZiAhPT0gfjApO1xuICAgIGlmICh0aGlzLm5vbkVtcHR5ICYmICFmbGFncy5sZW5ndGgpIGZsYWdzID0gW34wXTtcbiAgICBjb25zdCBieXRlcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmxhZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBmbGFnID0gZmxhZ3NbaV07XG4gICAgICBpZiAoZmxhZyA8IDApIGZsYWcgPSAodGhpcy5jbGVhciA8PCA4KSB8IH5mbGFnO1xuICAgICAgaWYgKGkgPT09IGZsYWdzLmxlbmd0aCAtIDEpIGZsYWcgfD0gKHRoaXMubGFzdCA8PCA4KTtcbiAgICAgIGJ5dGVzLnB1c2goZmxhZyA+Pj4gOCk7XG4gICAgICBieXRlcy5wdXNoKGZsYWcgJiAweGZmKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ5dGVzO1xuICB9XG5cbiAgd3JpdGUoZGF0YTogRGF0YTxudW1iZXI+LCBmbGFnczogbnVtYmVyW10sIG9mZnNldDogbnVtYmVyID0gMCkge1xuICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5ieXRlcyhmbGFncyk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgZGF0YVtpICsgb2Zmc2V0XSA9IGJ5dGVzW2ldO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY29uc3QgRElBTE9HX0ZMQUdTID0gbmV3IEZsYWdMaXN0VHlwZSgweDQwLCAweDgwKTtcbmV4cG9ydCBjb25zdCBJVEVNX0dFVF9GTEFHUyA9IG5ldyBGbGFnTGlzdFR5cGUoMHg0MCwgMHg4MCwgdHJ1ZSk7XG5leHBvcnQgY29uc3QgSVRFTV9VU0VfRkxBR1MgPSBuZXcgRmxhZ0xpc3RUeXBlKDB4NDAsIDB4ODAsIHRydWUpO1xuZXhwb3J0IGNvbnN0IElURU1fQ09ORElUSU9OX0ZMQUdTID0gbmV3IEZsYWdMaXN0VHlwZSgweDgwLCAweDIwLCB0cnVlKTtcbmV4cG9ydCBjb25zdCBTUEFXTl9DT05ESVRJT05fRkxBR1MgPSBuZXcgRmxhZ0xpc3RUeXBlKDB4ODAsIDB4MjApO1xuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbmRlY2xhcmUgY29uc3QgaW5pdGlhbFRhZzogdW5pcXVlIHN5bWJvbDtcbmV4cG9ydCBpbnRlcmZhY2UgSW5pdGlhbCB7IFtpbml0aWFsVGFnXTogbmV2ZXI7IH1cbmV4cG9ydCB0eXBlIEluaXRpYWxQcm9wczxULFxuICAgIFggPSB7W1AgaW4ga2V5b2YgVF06IFRbUF0gZXh0ZW5kcyBJbml0aWFsID8gUCA6IG5ldmVyfT4gPSBYW2tleW9mIFhdO1xuXG4vLyBJbXBsIC0gcXVlc3Rpb24gLSBjYW4gd2UgZG8gc29tZXRoaW5nIHNpbWlsYXIgZm9yIERhdGFUdXBsZT8/P1xuXG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZXI8UCBleHRlbmRzIHJlYWRvbmx5IGFueVtdLCBUPigpOiBJbml0aWFsaXplcjxQLCBUPiB7XG4gIGNvbnN0IHRhZyA9IFN5bWJvbCgpO1xuICBmdW5jdGlvbiBmKC4uLmFyZ3M6IFApOiBUICYgSW5pdGlhbCB7XG4gICAgcmV0dXJuIHt0YWcsIGFyZ3N9IGFzIGFueTsgLy8gTk9URTogdGhpcyBpcyBhIGNvbXBsZXRlIGxpZSBmb3Igbm93LlxuICB9XG4gIGYuY29tbWl0ID0gKGluc3RhbmNlOiBhbnksIGJ1aWxkZXI6IChwcm9wOiBzdHJpbmcsIC4uLmFyZ3M6IFApID0+IFQpID0+IHtcbiAgICBmb3IgKGNvbnN0IHByb3Agb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoaW5zdGFuY2UpKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGluc3RhbmNlW3Byb3BdO1xuICAgICAgaWYgKHZhbHVlLnRhZyAhPT0gdGFnKSBjb250aW51ZTtcbiAgICAgIGluc3RhbmNlW3Byb3BdID0gYnVpbGRlcihwcm9wLCAuLi52YWx1ZS5hcmdzKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBmO1xufVxuZXhwb3J0IGludGVyZmFjZSBJbml0aWFsaXplcjxQIGV4dGVuZHMgcmVhZG9ubHkgYW55W10sIFQ+IHtcbiAgKC4uLmFyZ3M6IFApOiBUO1xuICBjb21taXQoaW5zdGFuY2U6IGFueSwgYnVpbGRlcjogKHByb3A6IHN0cmluZywgLi4uYXJnczogUCkgPT4gVCk6IHZvaWQ7XG59XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxudHlwZSBOb25OZXZlclByb3BzPFQ+ID0gKHtbSyBpbiBrZXlvZiBUXTogVFtLXSBleHRlbmRzIG5ldmVyID8gbmV2ZXIgOiBLfSlba2V5b2YgVF07XG5leHBvcnQgdHlwZSBOb25OZXZlcjxUPiA9IFBpY2s8VCwgTm9uTmV2ZXJQcm9wczxUPj47XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuLy8gLy8gaW50ZXJmYWNlIFJlYWRvbmx5U2V0PFY+IGV4dGVuZHMgSXRlcmFibGU8Vj4ge1xuLy8gLy8gICBoYXMoZWxlbTogVik6IGJvb2xlYW47XG4vLyAvLyB9XG4vLyBpbnRlcmZhY2UgSGFzSWQge1xuLy8gICBpZDogbnVtYmVyO1xuLy8gfVxuXG4vLyB0eXBlIENvbGxlY3Rpb25CYXNlPEssIFY+ID0ge1tUIGluIGtleW9mIEtdOiBWfSAmIFJlYWRvbmx5U2V0PFY+O1xuLy8gdHlwZSBDb2xsZWN0aW9uQmFzZUluZGV4PEssIFYgZXh0ZW5kcyB7aWQ6IG51bWJlcn0+ID1cbi8vICAgICBDb2xsZWN0aW9uQmFzZTxLLCBWPiAmIHtbaWQ6IG51bWJlcl06IFZ9O1xuLy8gdHlwZSBDb2xsZWN0aW9uQmFzZUFycmF5PEssIFYgZXh0ZW5kcyB7aWQ6IG51bWJlcn0+ID1cbi8vICAgICB7W1QgaW4ga2V5b2YgS106IFZ9ICYgUmVhZG9ubHlBcnJheTxWPiAmIEl0ZXJhYmxlPFY+O1xuXG4vLyB0eXBlIENvbGxlY3Rpb25NYXBwZXI8SywgVj4gPSA8VCBleHRlbmRzIGtleW9mIEs+KGVsZW06IEtbVF0sIGtleTogVCkgPT4gVjtcbi8vIGludGVyZmFjZSBDb2xsZWN0aW9uQ3RvcjxLLCBWPiB7XG4vLyAgIG5ldyhkYXRhOiBLLCBtYXBwZXI6IENvbGxlY3Rpb25NYXBwZXI8SywgVj4pOiBDb2xsZWN0aW9uQmFzZTxLLCBWPjtcbi8vIH1cbi8vIGludGVyZmFjZSBDb2xsZWN0aW9uQ3RvckluZGV4PEssIFYgZXh0ZW5kcyB7aWQ6IG51bWJlcn0+IHtcbi8vICAgbmV3KGRhdGE6IEssIG1hcHBlcjogQ29sbGVjdGlvbk1hcHBlcjxLLCBWPik6IENvbGxlY3Rpb25CYXNlSW5kZXg8SywgVj47XG4vLyB9XG4vLyBpbnRlcmZhY2UgQ29sbGVjdGlvbkN0b3JBcnJheTxLLCBWIGV4dGVuZHMge2lkOiBudW1iZXJ9PiB7XG4vLyAgIG5ldyhkYXRhOiBLLCBtYXBwZXI6IENvbGxlY3Rpb25NYXBwZXI8SywgVj4sIGluaXRpYWxTaXplPzogbnVtYmVyKTpcbi8vICAgICAgIENvbGxlY3Rpb25CYXNlQXJyYXk8SywgVj47XG4vLyB9XG5cbi8vIC8vIGZ1bmN0aW9uIGNvbGxlY3Rpb25CYXNlPEssIFY+KCk6IHtcbi8vIC8vICAgbmV3KGRhdGE6IEssIG1hcHBlcjogQ29sbGVjdGlvbk1hcHBlcjxLLCBWPik6IENvbGxlY3Rpb25CYXNlPEssIFY+XG4vLyAvLyB9IHtcbi8vIC8vICAgcmV0dXJuIGNsYXNzIGV4dGVuZHMgU2V0PHVua25vd24+IHtcbi8vIC8vICAgICBjb25zdHJ1Y3RvcihkYXRhOiBLLCBtYXBwZXI6IDxUIGV4dGVuZHMga2V5b2YgSz4oZWxlbTogS1tUXSwga2V5OiBUKSA9PiBWKSB7XG4vLyAvLyAgICAgICBzdXBlcigpO1xuLy8gLy8gICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xuLy8gLy8gICAgICAgICBjb25zdCB2YWx1ZSA9IG1hcHBlcihkYXRhW2tleV0sIGtleSk7XG4vLyAvLyAgICAgICAgIHN1cGVyLmFkZCgodGhpcyBhcyBhbnkpW2tleV0gPSB2YWx1ZSk7XG4vLyAvLyAgICAgICAgIGlmIChpbmRleGVkKSAodGhpcyBhcyBhbnkpWyh2YWx1ZSBhcyBhbnkpLmlkXSA9IHZhbHVlO1xuLy8gLy8gICAgICAgfVxuLy8gLy8gICAgIH1cbi8vIC8vICAgICBhZGQoKTogbmV2ZXIgeyB0aHJvdyBuZXcgRXJyb3IoJ25vdCBpbXBsZW1lbnRlZCcpOyB9XG4vLyAvLyAgICAgZGVsZXRlKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gLy8gICAgIGNsZWFyKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gLy8gICB9IGFzIGFueTtcbi8vIC8vIH1cblxuLy8gZXhwb3J0IGZ1bmN0aW9uIGNvbGxlY3Rpb25CYXNlPEssIFYgZXh0ZW5kcyBIYXNJZD4oaW5kZXhlZDogdHJ1ZSk6IENvbGxlY3Rpb25DdG9ySW5kZXg8SywgVj47XG4vLyBleHBvcnQgZnVuY3Rpb24gY29sbGVjdGlvbkJhc2U8SywgVj4oaW5kZXhlZDogYm9vbGVhbik6IENvbGxlY3Rpb25DdG9yPEssIFY+IHtcbi8vICAgcmV0dXJuIGNsYXNzIGV4dGVuZHMgU2V0PHVua25vd24+IHtcbi8vICAgICBjb25zdHJ1Y3RvcihkYXRhOiBLLCBtYXBwZXI6IDxUIGV4dGVuZHMga2V5b2YgSz4oZWxlbTogS1tUXSwga2V5OiBUKSA9PiBWKSB7XG4vLyAgICAgICBzdXBlcigpO1xuLy8gICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xuLy8gICAgICAgICBjb25zdCB2YWx1ZSA9IG1hcHBlcihkYXRhW2tleV0sIGtleSk7XG4vLyAgICAgICAgIHN1cGVyLmFkZCgodGhpcyBhcyBhbnkpW2tleV0gPSB2YWx1ZSk7XG4vLyAgICAgICAgIGlmIChpbmRleGVkKSAodGhpcyBhcyBhbnkpWyh2YWx1ZSBhcyBhbnkpLmlkXSA9IHZhbHVlO1xuLy8gICAgICAgfVxuLy8gICAgIH1cbi8vICAgICBhZGQoKTogbmV2ZXIgeyB0aHJvdyBuZXcgRXJyb3IoJ25vdCBpbXBsZW1lbnRlZCcpOyB9XG4vLyAgICAgZGVsZXRlKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gICAgIGNsZWFyKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gICB9IGFzIGFueTtcbi8vIH1cblxuLy8gZXhwb3J0IGZ1bmN0aW9uIGNvbGxlY3Rpb25CYXNlQXJyYXk8SywgViBleHRlbmRzIEhhc0lkPigpOiBDb2xsZWN0aW9uQ3RvckFycmF5PEssIFY+IHtcbi8vICAgcmV0dXJuIGNsYXNzIGV4dGVuZHMgQXJyYXk8dW5rbm93bj4ge1xuLy8gICAgIHN0YXRpYyBnZXQgW1N5bWJvbC5zcGVjaWVzXSgpIHsgcmV0dXJuIEFycmF5OyB9XG4vLyAgICAgY29uc3RydWN0b3IoZGF0YTogSyxcbi8vICAgICAgICAgICAgICAgICBtYXBwZXI6IDxUIGV4dGVuZHMga2V5b2YgSz4oZWxlbTogS1tUXSwga2V5OiBUKSA9PiBWLFxuLy8gICAgICAgICAgICAgICAgIGluaXRpYWxTaXplID0gMCkge1xuLy8gICAgICAgc3VwZXIoaW5pdGlhbFNpemUpO1xuLy8gICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xuLy8gICAgICAgICBjb25zdCB2YWx1ZSA9IG1hcHBlcihkYXRhW2tleV0sIGtleSk7XG4vLyAgICAgICAgICh0aGlzIGFzIGFueSlbdmFsdWUuaWRdID0gdmFsdWU7XG4vLyAgICAgICB9XG4vLyAgICAgfVxuLy8gICB9IGFzIGFueTtcbi8vIH1cblxuLy8gLy8gZXhwb3J0IGNsYXNzIENvbGxlY3Rpb248SywgVj4gZXh0ZW5kcyBjb2xsZWN0aW9uQmFzZTxLLCBWPigpIGltcGxlbWVudHMgQ29sbGVjdGlvbkJhc2U8SywgVj4ge31cbi8vIC8vIGV4cG9ydCBjbGFzcyBJbmRleGVkQ29sbGVjdGlvbjxLLCBWIGV4dGVuZHMge2lkOiBudW1iZXJ9PlxuLy8gLy8gICAgIGV4dGVuZHMgY29sbGVjdGlvbkJhc2U8SywgVj4odHJ1ZSkge31cbi8vIC8vIGV4cG9ydCBjbGFzcyBBcnJheUNvbGxlY3Rpb248SywgViBleHRlbmRzIHtpZDogbnVtYmVyfT5cbi8vIC8vICAgICBleHRlbmRzIGNvbGxlY3Rpb25CYXNlQXJyYXk8SywgVj4oKSB7fVxuXG4vLyAvLyB0eXBlIENvbGxlY3Rpb25CYXNlPEssIFY+ID0ge1xuLy8gLy8gICByZWFkb25seSBbVCBpbiBrZXlvZiBLXTogVixcbiAgXG4vLyAvLyBleHBvcnQgZnVuY3Rpb24gY29sbGVjdGlvbkJhc2U8SywgVj4oKToge25ldygpOiB7W1QgaW4ga2V5b2YgS106IFZ9fSB7XG4vLyAvLyAgIHJldHVybiBPYmplY3QgYXMgdW5rbm93biBhcyB7bmV3KCk6IHtbVCBpbiBrZXlvZiBLXTogVn19O1xuLy8gLy8gfVxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbmNvbnN0IFBST1BfVEFHID0gU3ltYm9sKCdQUk9QX1RBRycpO1xuXG50eXBlIFNldHRlckhlbHBlcjxYLCBZLCBaLCBBPiA9XG4gIFogZXh0ZW5kcyBGdW5jdGlvbiA/IG5ldmVyIDpcbiAgKDxUPigpID0+IFQgZXh0ZW5kcyBYID8gMSA6IDIpIGV4dGVuZHNcbiAgKDxUPigpID0+IFQgZXh0ZW5kcyBZID8gMSA6IDIpID8gQSA6IG5ldmVyO1xudHlwZSBTZXR0ZXJQcm9wczxUPiA9IHtcbiAgW1AgaW4ga2V5b2YgVF0tPzogU2V0dGVySGVscGVyPHtbUSBpbiBQXTogVFtQXX0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LXJlYWRvbmx5IFtRIGluIFBdOiBUW1BdfSwgVFtQXSwgUD5cbn1ba2V5b2YgVF07XG4vLyBOT1RFOiBUaGlzIGZvcm0gZ2l2ZXMgdGhlIGJlc3QgdG9vbHRpcCBtZXNzYWdlcy5cbnR5cGUgU2V0dGFibGU8VD4gPSBQaWNrUGFydGlhbDxULCBTZXR0ZXJQcm9wczxUPj47XG5pbnRlcmZhY2UgRGF0YVR1cGxlQ3RvcjxUIGV4dGVuZHMgRGF0YVR1cGxlPiB7XG4gIG5ldyhhcmc6IG5ldmVyKTogVDsgLy8gTk9URTogaXQncyBhY3R1YWxseSBkYXRhOiBEYXRhPG51bWJlcj5cbiAgc2l6ZTogbnVtYmVyO1xufVxudHlwZSBQaWNrUGFydGlhbDxULCBLIGV4dGVuZHMga2V5b2YgVD4gPSB7W1AgaW4gS10/OiBUW1BdfTtcblxuY29uc3QgZGF0YVR1cGxlTWFwID0gbmV3IFdlYWtNYXAoKTtcblxuZnVuY3Rpb24gZGF0YVR1cGxlQWN0dWFsQ2xhc3M8VCBleHRlbmRzIERhdGFUdXBsZUN0b3I8YW55Pj4oYXJnOiBUKTogVCB7XG4gIGxldCByZXN1bHQgPSBkYXRhVHVwbGVNYXAuZ2V0KGFyZyk7XG4gIGlmICghcmVzdWx0KSB7XG4gICAgLy8gTWFrZSBhIG5ldyBkaXJlY3Qgc3VidHlwZSBvZiBEYXRhVHVwbGUsIGJ1dCBtYWtlIGl0IGxvb2sgbGlrZSBhcmcuXG4gICAgcmVzdWx0ID0gY2xhc3MgZXh0ZW5kcyBEYXRhVHVwbGUge307XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMocmVzdWx0LCB7bmFtZToge3ZhbHVlOiBhcmcubmFtZX19KTtcbiAgICBPYmplY3QuYXNzaWduKHJlc3VsdCwgYXJnKTsgLy8gY29weSBzdGF0aWMgcHJvcGVydGllcyB0byBlbnN1cmUgY3RvciBza2lwcGVkXG4gICAgUmVmbGVjdC5zZXRQcm90b3R5cGVPZihyZXN1bHQucHJvdG90eXBlLCBhcmcucHJvdG90eXBlKTtcbiAgICAvLyBSZWZsZWN0IG9uIGFuIGFjdHVhbCBpbnN0YW5jZSB0byBmaW5kIHRoZSBwcm9wcy5cbiAgICBjb25zdCBwcm90byA9IG5ldyAoYXJnIGFzIGFueSkoKTtcbiAgICBjb25zdCBkZXNjcmlwdG9yczogYW55ID0ge307XG4gICAgZm9yIChjb25zdCBbcHJvcCwgZGVzY3JdIG9mIE9iamVjdC5lbnRyaWVzKHByb3RvKSkge1xuICAgICAgaWYgKGRlc2NyICYmIChkZXNjciBhcyB7W1BST1BfVEFHXTogYm9vbGVhbn0pW1BST1BfVEFHXSkge1xuICAgICAgICBkZXNjcmlwdG9yc1twcm9wXSA9IGRlc2NyO1xuICAgICAgfVxuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhyZXN1bHQucHJvdG90eXBlLCBkZXNjcmlwdG9ycyk7XG4gICAgLy8gRmluYWxseSBhZGQgaXQgdG8gdGhlIG1hcCBmb3IgYm90aCBhcmcgYW5kIHJlc3VsdC5cbiAgICBkYXRhVHVwbGVNYXAuc2V0KGFyZywgcmVzdWx0KTtcbiAgICBkYXRhVHVwbGVNYXAuc2V0KHJlc3VsdCwgcmVzdWx0KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRGF0YVR1cGxlIGltcGxlbWVudHMgSXRlcmFibGU8bnVtYmVyPiB7XG4gIHN0YXRpYyBzaXplOiBudW1iZXI7XG5cbiAgcmVhZG9ubHkgZGF0YTogRGF0YTxudW1iZXI+O1xuICBjb25zdHJ1Y3Rvcihhcmc6IG5ldmVyKSB7XG4gICAgdGhpcy5kYXRhID0gYXJnO1xuICB9XG5cbiAgc3RhdGljIG9mPFQgZXh0ZW5kcyBEYXRhVHVwbGU+KHRoaXM6IERhdGFUdXBsZUN0b3I8VD4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbml0czogU2V0dGFibGU8VD4pOiBUIHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihcbiAgICAgICAgbmV3IChkYXRhVHVwbGVBY3R1YWxDbGFzcyh0aGlzKSBhcyBhbnkpKG5ldyBBcnJheSh0aGlzLnNpemUpLmZpbGwoMCkpLFxuICAgICAgICBpbml0cyk7XG4gIH1cblxuICBzdGF0aWMgZnJvbTxUIGV4dGVuZHMgRGF0YVR1cGxlPih0aGlzOiBEYXRhVHVwbGVDdG9yPFQ+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldCA9IDApOiBUIHtcbiAgICBjb25zdCBjbHM6IGFueSA9IGRhdGFUdXBsZUFjdHVhbENsYXNzKHRoaXMpO1xuICAgIGNvbnN0IGFyZyA9XG4gICAgICAgICFvZmZzZXQgJiYgZGF0YS5sZW5ndGggPT09IHRoaXMuc2l6ZSA/XG4gICAgICAgIGRhdGEgOiB0dXBsZShkYXRhLCBvZmZzZXQsIHRoaXMuc2l6ZSk7XG4gICAgcmV0dXJuIG5ldyBjbHMoYXJnKTtcbiAgfVxuXG4gIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhdG9yPG51bWJlcj4ge1xuICAgIHJldHVybiAodGhpcy5kYXRhIGFzIG51bWJlcltdKVtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gIH1cblxuICBoZXgoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmRhdGEsIGhleCkuam9pbignICcpO1xuICB9XG5cbiAgY2xvbmUoKTogdGhpcyB7XG4gICAgcmV0dXJuIG5ldyAodGhpcy5jb25zdHJ1Y3RvciBhcyBhbnkpKHRoaXMuZGF0YSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgcHJvcCguLi5iaXRzOiBbbnVtYmVyLCBudW1iZXI/LCBudW1iZXI/XVtdKTogbnVtYmVyIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ2V0KHRoaXM6IERhdGFUdXBsZSk6IG51bWJlciB7XG4gICAgICAgIGxldCB2YWx1ZSA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgW2luZGV4LCBtYXNrID0gMHhmZiwgc2hpZnQgPSAwXSBvZiBiaXRzKSB7XG4gICAgICAgICAgY29uc3QgbHNoID0gc2hpZnQgPCAwID8gLXNoaWZ0IDogMDtcbiAgICAgICAgICBjb25zdCByc2ggPSBzaGlmdCA8IDAgPyAwIDogc2hpZnQ7XG4gICAgICAgICAgdmFsdWUgfD0gKCh0aGlzLmRhdGFbaW5kZXhdICYgbWFzaykgPj4+IHJzaCkgPDwgbHNoO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH0sXG4gICAgICBzZXQodGhpczogRGF0YVR1cGxlLCB2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgIGZvciAoY29uc3QgW2luZGV4LCBtYXNrID0gMHhmZiwgc2hpZnQgPSAwXSBvZiBiaXRzKSB7XG4gICAgICAgICAgY29uc3QgbHNoID0gc2hpZnQgPCAwID8gLXNoaWZ0IDogMDtcbiAgICAgICAgICBjb25zdCByc2ggPSBzaGlmdCA8IDAgPyAwIDogc2hpZnQ7XG4gICAgICAgICAgY29uc3QgdiA9ICh2YWx1ZSA+Pj4gbHNoKSA8PCByc2ggJiBtYXNrO1xuICAgICAgICAgIHRoaXMuZGF0YVtpbmRleF0gPSB0aGlzLmRhdGFbaW5kZXhdICYgfm1hc2sgfCB2O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW1BST1BfVEFHXTogdHJ1ZSxcbiAgICB9IGFzIHVua25vd24gYXMgbnVtYmVyO1xuICB9XG5cbiAgcHJvdGVjdGVkIGJvb2xlYW5Qcm9wKGJ5dGU6IG51bWJlciwgYml0OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ2V0KHRoaXM6IERhdGFUdXBsZSk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gQm9vbGVhbih0aGlzLmRhdGFbYnl0ZV0gJiAoMSA8PCBiaXQpKTtcbiAgICAgIH0sXG4gICAgICBzZXQodGhpczogRGF0YVR1cGxlLCB2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICBjb25zdCBtYXNrID0gMSA8PCBiaXQ7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgIHRoaXMuZGF0YVtieXRlXSB8PSBtYXNrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZGF0YVtieXRlXSAmPSB+bWFzaztcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFtQUk9QX1RBR106IHRydWUsXG4gICAgfSBhcyB1bmtub3duIGFzIGJvb2xlYW47XG4gIH1cbn0gIFxuXG5cblxuXG4vLyBpbnRlcmZhY2UgR2V0U2V0PFU+IHtcbi8vICAgZ2V0KCk6IFU7XG4vLyAgIHNldChhcmc6IFUpOiB2b2lkO1xuLy8gfVxuXG4vLyB0eXBlIERhdGFUdXBsZVN1YjxUPiA9XG4vLyAgICAge1tLIGluIGtleW9mIFRdOiBUW0tdIGV4dGVuZHMgR2V0U2V0PGluZmVyIFU+ID8gVSA6XG4vLyAgICAgICAgICAgICAgICAgICAgICBUW0tdIGV4dGVuZHMge3ZhbHVlOiAoaW5mZXIgVyl9ID8gVyA6XG4vLyAgICAgICAgICAgICAgICAgICAgICBUW0tdIGV4dGVuZHMgKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkID8gVFtLXSA6IG5ldmVyfSAmIERhdGFUdXBsZTtcblxuLy8gLy8gTm90ZTogaXQgd291bGQgYmUgbmljZSBmb3IgdGhlIGZpbmFsIFRbS10gYmVsb3cgdG8gYmUgJ25ldmVyJywgYnV0XG4vLyAvLyB0aGlzIGZhaWxzIGJlY2F1c2UgYWxsIG9iamVjdHMgaGF2ZSBhbiBpbXBsaWNpdCB0b1N0cmluZywgd2hpY2ggd291bGRcbi8vIC8vIG90aGVyd2lzZSBuZWVkIHRvIGJlIHt0b1N0cmluZz86IHVuZGVmaW5lZH0gZm9yIHNvbWUgcmVhc29uLlxuLy8gdHlwZSBEYXRhVHVwbGVJbml0czxcbi8vICAgVCwgSyA9IHtbUCBpbiBrZXlvZiBUXTogVFtQXSBleHRlbmRzIHtzZXQoYXJnOiBpbmZlciBVKTogdm9pZH0gPyBVIDogbmV2ZXJ9PlxuLy8gICA9IHtbUCBpbiBOb25OZXZlclByb3BzPEs+XT86IEtbUF19O1xuXG4vLyBpbnRlcmZhY2UgRGF0YVR1cGxlQ3RvcjxUPiB7XG4vLyAgIG5ldyhkYXRhPzogRGF0YTxudW1iZXI+KTogRGF0YVR1cGxlU3ViPFQ+O1xuLy8gICBvZjxWIGV4dGVuZHMgRGF0YVR1cGxlQ3RvcjxUPj4odGhpczogViwgaW5pdHM6IERhdGFUdXBsZUluaXRzPFQ+KTogSW5zdGFuY2VUeXBlPFY+O1xuLy8gICBmcm9tPFYgZXh0ZW5kcyBEYXRhVHVwbGVDdG9yPFQ+PihkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyKTogSW5zdGFuY2VUeXBlPFY+O1xuLy8gfVxuXG5leHBvcnQgY29uc3Qgd2F0Y2hBcnJheSA9IChhcnI6IERhdGE8dW5rbm93bj4sIHdhdGNoOiBudW1iZXIpID0+IHtcbiAgY29uc3QgYXJyYXlDaGFuZ2VIYW5kbGVyID0ge1xuICAgIGdldCh0YXJnZXQ6IGFueSwgcHJvcGVydHk6IHN0cmluZyB8IG51bWJlcikge1xuICAgICAgLy8gY29uc29sZS5sb2coJ2dldHRpbmcgJyArIHByb3BlcnR5ICsgJyBmb3IgJyArIHRhcmdldCk7XG4gICAgICAvLyBwcm9wZXJ0eSBpcyBpbmRleCBpbiB0aGlzIGNhc2VcbiAgICAgIGxldCB2ID0gdGFyZ2V0W3Byb3BlcnR5XTtcbiAgICAgIGlmIChwcm9wZXJ0eSA9PT0gJ3N1YmFycmF5Jykge1xuICAgICAgICByZXR1cm4gKHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyKSA9PiB7XG4gICAgICAgICAgY29uc3Qgc3ViID0gdGFyZ2V0LnN1YmFycmF5KHN0YXJ0LCBlbmQpO1xuICAgICAgICAgIGlmIChzdGFydCA8PSB3YXRjaCAmJiB3YXRjaCA8IGVuZCkgcmV0dXJuIHdhdGNoQXJyYXkoc3ViLCB3YXRjaCAtIHN0YXJ0KTtcbiAgICAgICAgICByZXR1cm4gc3ViO1xuICAgICAgICB9O1xuICAgICAgfSBlbHNlIGlmIChwcm9wZXJ0eSA9PT0gJ3NldCcpIHtcbiAgICAgICAgcmV0dXJuICh2YWw6IERhdGE8dW5rbm93bj4pID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgU2V0dGluZyBvdmVybGFwcGluZyBhcnJheSAke3dhdGNofWApO1xuICAgICAgICAgIC8vIHRocm93IG5ldyBFcnJvcignJyk7XG4gICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgdGFyZ2V0LnNldCh2YWwpO1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiB2ID09PSAnZnVuY3Rpb24nKSB2ID0gdi5iaW5kKHRhcmdldCk7XG4gICAgICByZXR1cm4gdjtcbiAgICB9LFxuICAgIHNldCh0YXJnZXQ6IGFueSwgcHJvcGVydHk6IHN0cmluZyB8IG51bWJlciwgdmFsdWU6IGFueSwgcmVjZWl2ZXI6IGFueSkge1xuICAgICAgLy8gY29uc29sZS5sb2coJ3NldHRpbmcgJyArIHByb3BlcnR5ICsgJyBmb3IgJy8qICsgdGFyZ2V0Ki8gKyAnIHdpdGggdmFsdWUgJyArIHZhbHVlKTtcbiAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp0cmlwbGUtZXF1YWxzXG4gICAgICBpZiAocHJvcGVydHkgPT0gd2F0Y2gpIHtcbiAgICAgICAgY29uc29sZS5sb2coYFdyaXRpbmcgJHt3YXRjaC50b1N0cmluZygxNil9YCk7XG4gICAgICAgIC8vIHRocm93IG5ldyBFcnJvcignJyk7XG4gICAgICAgIGRlYnVnZ2VyO1xuICAgICAgfVxuICAgICAgdGFyZ2V0W3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgICAgLy8geW91IGhhdmUgdG8gcmV0dXJuIHRydWUgdG8gYWNjZXB0IHRoZSBjaGFuZ2VzXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuICB9O1xuICByZXR1cm4gbmV3IFByb3h5KGFyciwgYXJyYXlDaGFuZ2VIYW5kbGVyKTtcbn07XG5cbmV4cG9ydCB0eXBlIFdyaXRhYmxlPFQ+ID0gey1yZWFkb25seSBbSyBpbiBrZXlvZiBUXTogVFtLXX07XG5cbmV4cG9ydCBjbGFzcyBTZWdtZW50IHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgbmFtZTogc3RyaW5nLFxuICAgICAgICAgICAgICByZWFkb25seSBiYW5rOiBudW1iZXIsXG4gICAgICAgICAgICAgIHJlYWRvbmx5IG9yZzogbnVtYmVyKSB7fVxuXG4gIGdldCBvZmZzZXQoKTogbnVtYmVyIHtcbiAgICAvLyBUT0RPIC0gb2Zmc2V0IGRlcGVuZHMgb24gZXhwYW5zaW9uIG9yIG5vdCBmb3IgZml4ZWQgYmFua3NcbiAgICAvLyBJdCBzaG91bGQgcHJvYmFibHkgb25seSBiZSB1c2VkIGZvciBSRUFESU5HLCBzbyB3ZSB1c2UgMWZcbiAgICByZXR1cm4gKHRoaXMuYmFuayAmIDB4MWYpIDw8IDEzO1xuICB9XG5cbiAgc3RhdGljIHJlYWRvbmx5ICQwNCA9IG5ldyBTZWdtZW50KCcwNCcsIDB4MDQsIDB4ODAwMCk7XG4gIHN0YXRpYyByZWFkb25seSAkMDUgPSBuZXcgU2VnbWVudCgnMDUnLCAweDA1LCAweGEwMDApO1xuXG4gIHN0YXRpYyByZWFkb25seSAkMGEgPSBuZXcgU2VnbWVudCgnMGEnLCAweDBhLCAweDgwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJDBiID0gbmV3IFNlZ21lbnQoJzBiJywgMHgwYiwgMHhhMDAwKTtcbiAgc3RhdGljIHJlYWRvbmx5ICQwYyA9IG5ldyBTZWdtZW50KCcwYycsIDB4MGMsIDB4ODAwMCk7XG4gIHN0YXRpYyByZWFkb25seSAkMGQgPSBuZXcgU2VnbWVudCgnMGQnLCAweDBkLCAweGEwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJDBlID0gbmV3IFNlZ21lbnQoJzBlJywgMHgwZSwgMHg4MDAwKTtcbiAgc3RhdGljIHJlYWRvbmx5ICQwZiA9IG5ldyBTZWdtZW50KCcwZicsIDB4MGYsIDB4YTAwMCk7XG4gIHN0YXRpYyByZWFkb25seSAkMTAgPSBuZXcgU2VnbWVudCgnMTAnLCAweDEwLCAweDgwMDApO1xuXG4gIHN0YXRpYyByZWFkb25seSAkMTQgPSBuZXcgU2VnbWVudCgnMTQnLCAweDE0LCAweDgwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJDE1ID0gbmV3IFNlZ21lbnQoJzE1JywgMHgxNSwgMHhhMDAwKTtcbiAgc3RhdGljIHJlYWRvbmx5ICQxNl9hID0gbmV3IFNlZ21lbnQoJzE2OmEnLCAweDE2LCAweGEwMDApOyAvLyBOT1RFOiBhbm9tYWxvdXNcbiAgc3RhdGljIHJlYWRvbmx5ICQxNyA9IG5ldyBTZWdtZW50KCcxNycsIDB4MTcsIDB4YTAwMCk7XG4gIHN0YXRpYyByZWFkb25seSAkMTggPSBuZXcgU2VnbWVudCgnMTgnLCAweDE4LCAweDgwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJDE5ID0gbmV3IFNlZ21lbnQoJzE5JywgMHgxOSwgMHhhMDAwKTtcbiAgc3RhdGljIHJlYWRvbmx5ICQxYSA9IG5ldyBTZWdtZW50KCcxYScsIDB4MWEsIDB4ODAwMCk7XG4gIHN0YXRpYyByZWFkb25seSAkMWIgPSBuZXcgU2VnbWVudCgnMWInLCAweDFiLCAweGEwMDApO1xuXG4gIHN0YXRpYyByZWFkb25seSAkZmUgPSBuZXcgU2VnbWVudCgnZmUnLCAweDFlLCAweGMwMDApO1xuICBzdGF0aWMgcmVhZG9ubHkgJGZmID0gbmV3IFNlZ21lbnQoJ2ZmJywgMHgxZiwgMHhlMDAwKTtcbn1cblxuLy8gVE9ETyAtIGl0IG1heSBiZSBhIG1pc3Rha2UgdG8gdXNlIHNlZ21lbnQgc3RyaW5ncyBoZXJlP1xuLy8gICAgICAtIHdlJ2xsIHNlZSBpZiB0aGF0IGNvbWVzIGJhY2sgdG8gYnl0ZSB1cyBsYXRlci5cbmV4cG9ydCBjbGFzcyBBZGRyZXNzIHtcbiAgc3RhdGljIG9mKHNlZ21lbnQ6IFNlZ21lbnQsIG9yZzogbnVtYmVyKSB7XG4gICAgcmV0dXJuIG5ldyBBZGRyZXNzKHNlZ21lbnQsIG9yZyAtIHNlZ21lbnQub3JnKTtcbiAgfVxuXG4gIHByaXZhdGUgY29uc3RydWN0b3IocmVhZG9ubHkgc2VnOiBTZWdtZW50LCByZWFkb25seSBkZWx0YTogbnVtYmVyKSB7fVxuXG4gIGdldCBvZmZzZXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VnLm9mZnNldCArIHRoaXMuZGVsdGE7XG4gIH1cbiAgZ2V0IG9yZygpIHtcbiAgICByZXR1cm4gdGhpcy5zZWcub3JnICsgdGhpcy5kZWx0YTtcbiAgfVxuICBnZXQgc2VnbWVudCgpIHtcbiAgICByZXR1cm4gdGhpcy5zZWcubmFtZTtcbiAgfVxuICBwbHVzKG9mZnNldDogbnVtYmVyLCBuZXh0U2VnbWVudD86IFNlZ21lbnQpIHtcbiAgICBjb25zdCBuZXdEZWx0YSA9IHRoaXMuZGVsdGEgKyBvZmZzZXQ7XG4gICAgaWYgKG5ld0RlbHRhID49IDB4MjAwMCkge1xuICAgICAgaWYgKCFuZXh0U2VnbWVudCkgdGhyb3cgbmV3IEVycm9yKGBTZWdtZW50IGNoYW5nZWRgKTtcbiAgICAgIGlmICh0aGlzLnNlZy5vcmcgJiAweDIwMDApIHRocm93IG5ldyBFcnJvcihgQmFkIHNlZ21lbnQgY3Jvc3NgKTtcbiAgICAgIHJldHVybiBuZXcgQWRkcmVzcyhuZXh0U2VnbWVudCwgbmV3RGVsdGEgJiAweDFmZmYpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEFkZHJlc3ModGhpcy5zZWcsIG5ld0RlbHRhKTtcbiAgfVxuICBtaW51cyhhZGRyOiBBZGRyZXNzKSB7XG4gICAgaWYgKGFkZHIuc2VnICE9PSB0aGlzLnNlZykgdGhyb3cgbmV3IEVycm9yKGBJbmNvbXBhdGlibGUgc2VnbWVudHNgKTtcbiAgICByZXR1cm4gdGhpcy5kZWx0YSAtIGFkZHIuZGVsdGE7XG4gIH1cbiAgcmVhZDxUPihkYXRhOiBEYXRhPFQ+KTogVCB7XG4gICAgcmV0dXJuIGRhdGFbdGhpcy5vZmZzZXRdO1xuICB9XG4gIHJlYWRMaXR0bGVFbmRpYW4oZGF0YTogRGF0YTxudW1iZXI+KTogbnVtYmVyIHtcbiAgICBjb25zdCBvZmYgPSB0aGlzLm9mZnNldDtcbiAgICByZXR1cm4gZGF0YVtvZmZdIHwgZGF0YVtvZmYgKyAxXSA8PCA4O1xuICB9XG4gIHJlYWRBZGRyZXNzKGRhdGE6IERhdGE8bnVtYmVyPiwgLi4uc2VnbWVudHM6IFNlZ21lbnRbXSk6IEFkZHJlc3Mge1xuICAgIGNvbnN0IG9yZyA9IHRoaXMucmVhZExpdHRsZUVuZGlhbihkYXRhKTtcbiAgICBpZiAoIXNlZ21lbnRzLmxlbmd0aCkgc2VnbWVudHMgPSBbdGhpcy5zZWddO1xuICAgIC8vIEZpZ3VyZSBvdXQgd2hpY2ggc2VnbWVudCBpdCdzIGluLlxuICAgIGZvciAoY29uc3QgcyBvZiBzZWdtZW50cykge1xuICAgICAgaWYgKChvcmcgJiAweGUwMDApID09PSAocy5vcmcgJiAweGUwMDApKSByZXR1cm4gQWRkcmVzcy5vZihzLCBvcmcpO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBmaW5kIHZhbGlkIHNlZ21lbnQgZm9yICR7aGV4KG9yZyl9YCk7XG4gIH1cbiAgbG9jKGFzc2VtYmxlcjogSUFzc2VtYmxlciwgbmFtZT86IHN0cmluZykge1xuICAgIGFzc2VtYmxlci5zZWdtZW50KHRoaXMuc2VnbWVudCk7XG4gICAgYXNzZW1ibGVyLm9yZyh0aGlzLm9yZywgbmFtZSk7XG4gIH1cbiAgLy8gbG9jV2lkZShhc3NlbWJsZXI6IElBc3NlbWJsZXIsIG5hbWU/OiBzdHJpbmcpIHtcbiAgLy8gICBhc3NlbWJsZXIuc2VnbWVudCh0aGlzLnNlZ21lbnQsIGhleCh0aGlzLnNlZyBeIDEpKTtcbiAgLy8gICBhc3NlbWJsZXIub3JnKHRoaXMub3JnLCBuYW1lKTtcbiAgLy8gfVxuICAvLyBsb2NGaXhlZChhc3NlbWJsZXI6IElBc3NlbWJsZXIsIG5hbWU/OiBzdHJpbmcpIHtcbiAgLy8gICBhc3NlbWJsZXIuc2VnbWVudCh0aGlzLnNlZ21lbnQsICdmZScsICdmZicpO1xuICAvLyAgIGFzc2VtYmxlci5vcmcodGhpcy5vcmcsIG5hbWUpO1xuICAvLyB9XG4gIC8vIGxvY1dpZGVGaXhlZChhc3NlbWJsZXI6IElBc3NlbWJsZXIsIG5hbWU/OiBzdHJpbmcpIHtcbiAgLy8gICBhc3NlbWJsZXIuc2VnbWVudCh0aGlzLnNlZ21lbnQsIGhleCh0aGlzLnNlZyBeIDEpLCAnZmUnLCAnZmYnKTtcbiAgLy8gICBhc3NlbWJsZXIub3JnKHRoaXMub3JnLCBuYW1lKTtcbiAgLy8gfVxufVxuXG5pbnRlcmZhY2UgSUFzc2VtYmxlciB7XG4gIHNlZ21lbnQoLi4uczogc3RyaW5nW10pOiB2b2lkO1xuICBvcmcobzogbnVtYmVyLCBuPzogc3RyaW5nKTogdm9pZDtcbiAgZnJlZShzaXplOiBudW1iZXIpOiB2b2lkO1xuICByZWxvYyhuYW1lPzogc3RyaW5nKTogdm9pZDtcbiAgbGFiZWwobmFtZTogc3RyaW5nKTogdm9pZDtcbiAgZXhwb3J0KG5hbWU6IHN0cmluZyk6IHZvaWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmcmVlKGE6IElBc3NlbWJsZXIsIHNlZzogU2VnbWVudCwgc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIpIHtcbiAgYS5zZWdtZW50KHNlZy5uYW1lKTtcbiAgYS5vcmcoc3RhcnQpO1xuICBhLmZyZWUoZW5kIC0gc3RhcnQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVsb2NFeHBvcnRMYWJlbChhOiBJQXNzZW1ibGVyLCBzZWc6IFNlZ21lbnRbXSwgbmFtZTogc3RyaW5nKSB7XG4gIGEuc2VnbWVudCguLi5zZWcubWFwKHMgPT4gcy5uYW1lKSk7XG4gIGEucmVsb2MobmFtZSk7XG4gIGEubGFiZWwobmFtZSk7XG4gIGEuZXhwb3J0KG5hbWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xvbmVBcnJheTxUIGV4dGVuZHMgUmVhZG9ubHlBcnJheTxhbnk+PihhcnI6IFQpOiBNdXRhYmxlPFQ+IHtcbiAgcmV0dXJuIFsuLi5hcnJdIGFzIE11dGFibGU8VD47XG59XG4iXX0=