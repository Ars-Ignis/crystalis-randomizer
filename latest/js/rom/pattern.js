import { Entity } from './entity.js';
import { reverseBits, seq, tuple } from './util.js';
export class Pattern extends Entity {
    constructor(rom, id, pixels) {
        super(rom, id);
        this.pixels = pixels || tuple(rom.chr, id << 4, 16);
    }
    pixelAt(y, x) {
        return (this.pixels[y | 8] >> x & 1) << 1 | (this.pixels[y] >> x & 1);
    }
    flipH() {
        return new Pattern(this.rom, -1, this.pixels.map(reverseBits));
    }
    flipV() {
        return new Pattern(this.rom, -1, seq(16, y => this.pixels[y & 8 | ~y & 7]));
    }
    flip(type) {
        let p = this;
        if (type & Flip.HORIZONTAL)
            p = p.flipH();
        if (type & Flip.VERTICAL)
            p = p.flipV();
        return p;
    }
    write() {
        const a = this.id << 4;
        this.rom.chr.subarray(a, a + 16).set(this.pixels);
        return [];
    }
}
export var Flip;
(function (Flip) {
    Flip[Flip["HORIZONTAL"] = 64] = "HORIZONTAL";
    Flip[Flip["VERTICAL"] = 128] = "VERTICAL";
})(Flip || (Flip = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0dGVybi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vcGF0dGVybi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUMsTUFBTSxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBQ25DLE9BQU8sRUFBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUVsRCxNQUFNLE9BQU8sT0FBUSxTQUFRLE1BQU07SUFJakMsWUFBWSxHQUFRLEVBQUUsRUFBVSxFQUFFLE1BQWlCO1FBQ2pELEtBQUssQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDZixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFHRCxPQUFPLENBQUMsQ0FBUyxFQUFFLENBQVM7UUFDMUIsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN4RSxDQUFDO0lBRUQsS0FBSztRQUNILE9BQU8sSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFFRCxLQUFLO1FBQ0gsT0FBTyxJQUFJLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFFRCxJQUFJLENBQUMsSUFBVTtRQUNiLElBQUksQ0FBQyxHQUFZLElBQUksQ0FBQztRQUN0QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVTtZQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDMUMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVE7WUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3hDLE9BQU8sQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUVELEtBQUs7UUFFSCxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN2QixJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xELE9BQU8sRUFBRSxDQUFDO0lBQ1osQ0FBQztDQUNGO0FBRUQsTUFBTSxDQUFOLElBQVksSUFHWDtBQUhELFdBQVksSUFBSTtJQUNkLDRDQUFpQixDQUFBO0lBQ2pCLHlDQUFlLENBQUE7QUFDakIsQ0FBQyxFQUhXLElBQUksS0FBSixJQUFJLFFBR2YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge01vZHVsZX0gZnJvbSAnLi4vYXNtL21vZHVsZS5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcbmltcG9ydCB7RW50aXR5fSBmcm9tICcuL2VudGl0eS5qcyc7XG5pbXBvcnQge3JldmVyc2VCaXRzLCBzZXEsIHR1cGxlfSBmcm9tICcuL3V0aWwuanMnO1xuXG5leHBvcnQgY2xhc3MgUGF0dGVybiBleHRlbmRzIEVudGl0eSB7XG5cbiAgcGl4ZWxzOiBudW1iZXJbXTtcblxuICBjb25zdHJ1Y3Rvcihyb206IFJvbSwgaWQ6IG51bWJlciwgcGl4ZWxzPzogbnVtYmVyW10pIHtcbiAgICBzdXBlcihyb20sIGlkKTtcbiAgICB0aGlzLnBpeGVscyA9IHBpeGVscyB8fCB0dXBsZShyb20uY2hyLCBpZCA8PCA0LCAxNik7XG4gIH1cblxuICAvLyBUYWtlcyB4IGFuZCB5IGZyb20gMC4uNywgcmV0dXJucyBhIGNvbG9yIDAuLjMuXG4gIHBpeGVsQXQoeTogbnVtYmVyLCB4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiAodGhpcy5waXhlbHNbeSB8IDhdID4+IHggJiAxKSA8PCAxIHwgKHRoaXMucGl4ZWxzW3ldID4+IHggJiAxKTtcbiAgfVxuXG4gIGZsaXBIKCk6IFBhdHRlcm4ge1xuICAgIHJldHVybiBuZXcgUGF0dGVybih0aGlzLnJvbSwgLTEsIHRoaXMucGl4ZWxzLm1hcChyZXZlcnNlQml0cykpO1xuICB9XG5cbiAgZmxpcFYoKTogUGF0dGVybiB7XG4gICAgcmV0dXJuIG5ldyBQYXR0ZXJuKHRoaXMucm9tLCAtMSwgc2VxKDE2LCB5ID0+IHRoaXMucGl4ZWxzW3kgJiA4IHwgfnkgJiA3XSkpO1xuICB9XG5cbiAgZmxpcCh0eXBlOiBGbGlwKTogUGF0dGVybiB7XG4gICAgbGV0IHA6IFBhdHRlcm4gPSB0aGlzO1xuICAgIGlmICh0eXBlICYgRmxpcC5IT1JJWk9OVEFMKSBwID0gcC5mbGlwSCgpO1xuICAgIGlmICh0eXBlICYgRmxpcC5WRVJUSUNBTCkgcCA9IHAuZmxpcFYoKTtcbiAgICByZXR1cm4gcDtcbiAgfVxuXG4gIHdyaXRlKCk6IE1vZHVsZVtdIHtcbiAgICAvLyBUT0RPOiBpbnRlZ3JhdGUgQ0hSIGFzIGEgc2VwYXJhdGUgb3V0cHV0L29mZnNldCBpbiBsaW5rZXI/XG4gICAgY29uc3QgYSA9IHRoaXMuaWQgPDwgNDtcbiAgICB0aGlzLnJvbS5jaHIuc3ViYXJyYXkoYSwgYSArIDE2KS5zZXQodGhpcy5waXhlbHMpO1xuICAgIHJldHVybiBbXTtcbiAgfVxufVxuXG5leHBvcnQgZW51bSBGbGlwIHtcbiAgSE9SSVpPTlRBTCA9IDB4NDAsXG4gIFZFUlRJQ0FMID0gMHg4MCxcbn1cbiJdfQ==