(function(){
const global=window;'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(c){return a.next(c)}function c(c){return a.throw(c)}return new Promise(function(d,e){function f(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(c,a-b.length)+b}},"es8","es3");$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill("Object.entries",function(a){return a?a:function(a){var c=[],b;for(b in a)$jscomp.owns(a,b)&&c.push([b,a[b]]);return c}},"es8","es3");
$jscomp.polyfill("String.prototype.padEnd",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,null,"padStart");return b+$jscomp.stringPadding(c,a-b.length)}},"es8","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=b[c];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");const LOG$$module$6502=!0;
class Assembler$$module$6502{constructor(){this.labels={};this.allChunks=[]}assemble(a,b="input"){b=new File$$module$6502(this.labels,b);for(const c of a.split("\n"))b.ingest(c);a=b.assemble();this.allChunks.push(...a)}chunks(){return[...this.allChunks]}patch(){return Patch$$module$6502.from(this.allChunks)}patchRom(a){buildRomPatch$$module$6502(this.patch()).apply(a);this.allChunks=[]}expand(a){const [b=null,...c]=this.labels[a]||[];if(null==b)throw Error(`Missing label: ${a}`);if(c.length)throw Error(`Non-unique label: ${a}`);
return 0>b?~b:b}}
class File$$module$6502{constructor(a,b){this.labels=a;this.filename=b;this.lines=[];this.pc=0;this.lineNumber=-1;this.lineContents="";this.conditions=[];this.assembling=!0}addLine(a){this.lines.push(a.orig(this.filename,this.lineNumber,this.lineContents))}addLabel(a,b){if("number"!==typeof b)throw Error("Expected a number");a=this.labels[a]||(this.labels[a]=[]);const c=find$$module$6502(a,b);0>c&&a.splice(~c,0,b)}parseNumber(a){a=parseNumber$$module$6502(a,!0);return"number"===typeof a?a:(new Context$$module$6502(this.labels)).mapLabel(a)}ingest(a){this.lineNumber++;
this.lineContents=a;a=a.replace(/;.*/,"");a=a.replace(/\s+/g," ");a=a.replace(/\s$/g,"");var b;if(b=/^\s*\.if(n?)def\s+(\S+)/i.exec(a))a=b[2]in this.labels,this.conditions.push(b[1]?!a:a),this.assembling=this.conditions.every((a)=>a);else if(b=/^\s*\.else/i.exec(a))this.conditions.push(!this.conditions.pop()),this.assembling=this.conditions.every((a)=>a);else if(b=/^\s*\.endif/i.exec(a))this.conditions.pop(),this.assembling=this.conditions.every((a)=>a);else if(this.assembling)if(b=/^\s*\.org\s+(\S+)/i.exec(a))this.addLine(new OrgLine$$module$6502(this.pc=
parseNumber$$module$6502(b[1])));else if(b=/^\s*\.skip\s+(.+)/i.exec(a))this.addLine(new OrgLine$$module$6502(this.pc+=this.parseNumber(b[1])));else if(b=/^\s*\.assert\s+(<\s*)?(\S+)/i.exec(a))this.addLine(new AssertLine$$module$6502(this.pc=parseNumber$$module$6502(b[2]),!b[1]));else if(b=/^\s*\.bank\s+(\S+)\s+(\S+)\s*:\s*(\S+)/i.exec(a)){const [,a,c,f]=b;this.addLine(new BankLine$$module$6502(parseNumber$$module$6502(a),parseNumber$$module$6502(c),parseNumber$$module$6502(f)))}else if(b=/^\s*\.(byte|word)\s+(.*)/i.exec(a))b=
("word"===b[1]?WordLine$$module$6502:ByteLine$$module$6502).parse(b[2]),this.addLine(b),this.pc+=b.size();else if(b=/^\s*\.res\s+([^,]+)(?:,\s*(.+))?/i.exec(a))b=ByteLine$$module$6502.parseRes(this.parseNumber(b[1]),this.parseNumber(b[2]||"0")),this.addLine(b),this.pc+=b.size();else if(b=/^define\s+(\S+)\s+(.*)/.exec(a))this.addLabel(b[1],this.parseNumber(b[2]));else{if(b=/^(\S+?):(.*)$/.exec(a)){var c=b[1];a=" "+b[2];this.addLabel(c,~this.pc)}else if(b=/^((?:[-+]+\s+)+)(.*)$/.exec(a)){a=b[1];for(c of a.trim().split(" "))this.addLabel(c,
~this.pc);a=" "+b[2]}if(b=/^\s+([a-z]{3})(\s+.*)?$/.exec(a))b=new Opcode$$module$6502(b[1],(b[2]||"").trim(),this.pc),this.addLine(b),this.pc+=b.size();else if(/\S/.test(a))throw Error(`Could not parse line ${a} at ${this.filename}:${this.lineNumber}`);}}assemble(){var a=new Context$$module$6502(this.labels),b=[];const c=[],d=(a,b)=>{throw Error(`Collision at $${b.toString(16)}:\n  written at ${c[b].source()}\n  written at ${a.source()}`);};for(var e of this.lines){try{e.expand(a)}catch(g){throw b=
g.stack.replace(`Error: ${g.message}`,""),Error(`${g.message}${` from line ${e.origLineNumber+1}: \`${e.origContent}\``}${b}\n================`);}e instanceof OrgLine$$module$6502&&null!=b[e.pc]&&d(e,e.pc);for(const f of e.bytes())null!=b[a.pc]&&d(e,a.pc),c[a.pc]=e,b[a.pc++]=f}a=[];for(var f in b)Number(f)-1 in b||a.push(Number(f));e=[];for(const c of a){f=[];for(a=c;a in b;a++)f.push(b[a]);e.push(new Chunk$$module$6502(c,f))}if(this.conditions.length)throw Error("Unterminated .if");return e}}
class AbstractLine$$module$6502{constructor(){this.origFile="";this.origLineNumber=-1;this.origContent=""}orig(a,b,c){this.origFile=a;this.origLineNumber=b;this.origContent=c;return this}source(){return`${this.origFile}:${this.origLineNumber+1}  ${this.origContent}`}}
class ByteLine$$module$6502 extends AbstractLine$$module$6502{constructor(a){super();this.bytesInternal=a}static parse(a){const b=[];for(let c of a.split(","))c=c.trim(),(a=/^"(.*)"$/.exec(c))?b.push(...[...a[1]].map((a)=>a.charCodeAt(0))):b.push(parseNumber$$module$6502(c));return new ByteLine$$module$6502(b)}static parseRes(a,b){return new ByteLine$$module$6502(Array(a).fill(b))}bytes(){return[...this.bytesInternal]}size(){return this.bytesInternal.length}expand(){}}
class WordLine$$module$6502 extends AbstractLine$$module$6502{constructor(a){super();this.words=a}static parse(a){const b=[];for(let c of a.split(","))c=c.trim(),c=c.replace(/[()]/g,""),b.push(parseNumber$$module$6502(c,!0));return new WordLine$$module$6502(b)}bytes(){const a=[];for(const b of this.words)a.push(b&255),a.push(b>>>8);return a}size(){return 2*this.words.length}expand(a){for(let b=0;b<this.words.length;b++)"string"===typeof this.words[b]&&(this.words[b]=a.map(this.words[b]))}}
class OrgLine$$module$6502 extends AbstractLine$$module$6502{constructor(a){super();this.pc=a}bytes(){return[]}size(){return 0}expand(a){a.pc=this.pc}}
class AssertLine$$module$6502 extends AbstractLine$$module$6502{constructor(a,b){super();this.pc=a;this.exact=b}bytes(){return[]}size(){return 0}expand(a){if(this.exact?a.pc!==this.pc:a.pc>this.pc)throw Error(`Misalignment: expected ${this.exact?"":"< "}$${this.pc.toString(16)} but was $${a.pc.toString(16)}`);!this.exact&&LOG$$module$6502&&console.log(`Free: ${this.pc-a.pc} bytes between $${a.pc.toString(16)} and $${this.pc.toString(16)}`)}}
class BankLine$$module$6502 extends AbstractLine$$module$6502{constructor(a,b,c){super();this.prg=a;this.cpu=b;this.length=c}bytes(){return[]}size(){return 0}expand(a){a.updateBank(this.prg,this.cpu,this.length)}}
class Context$$module$6502{constructor(a){this.labels=a;this.pc=0;this.cpuToPrg=[];this.prgToCpu=[]}updateBank(a,b,c){for(var d=0;d<c;d++){var e=b+d,f=this.cpuToPrg[e];null!=f&&(this.prgToCpu[f]=null,this.cpuToPrg[e]=null)}for(d=0;d<c;d++)e=b+d,f=a+d,this.prgToCpu[f]=e,this.cpuToPrg[e]=f}mapLabel(a,b){var c=/([^-+]+)([-+])(.*)/.exec(a);if(c)return a=this.map(parseNumber$$module$6502(c[1].trim(),!0),b),b=this.map(parseNumber$$module$6502(c[3].trim(),!0),b),"-"===c[2]?a-b:a+b;if(c=/([^*]+)[*](.*)/.exec(a))return a=
this.map(parseNumber$$module$6502(c[1].trim(),!0),b),b=this.map(parseNumber$$module$6502(c[2].trim(),!0),b),a*b;if(c=/([<>])(.*)/.exec(a))return b=this.map(parseNumber$$module$6502(c[2].trim(),!0),b),"<"===c[1]?b&255:b>>>8&255;c=this.labels[a];if(!c)throw Error(`Label not found: ${a}`);if(null==b){if(1<c.length)throw Error(`Ambiguous label: ${a}`);return c[0]}b=~(b+2);const d=find$$module$6502(c,b);if(0<=d)return c[d];if(-1===d)return c[0];if(d===~c.length)return c[c.length-1];c=c.slice(~d-1,~d+1);
return a.startsWith("-")?c[1]:a.startsWith("+")?c[0]:b<(c[0]+c[1])/2?c[0]:c[1]}mapPrgToCpu(a){const b=this.prgToCpu[a];if(null==b)throw Error(`PRG address unmapped: $${a.toString(16)}`);return b}map(a,b){if(null==a)return a;"string"===typeof a&&(a=this.mapLabel(a,b));0>a&&(a=this.mapPrgToCpu(~a));return a}}
class Chunk$$module$6502 extends Uint8Array{constructor(a,b){super(b.length);this.start=a;this.set(b)}apply(a){a.subarray(this.start,this.start+this.length).set(this)}shift(a){return new Chunk$$module$6502(this.start+a,this)}}
class Patch$$module$6502{constructor(a){this.data=a}static from(a){const b=[];var c=8;for(var d of a)a=new Uint8Array(d.length+5),a[0]=d.start>>>16,a[1]=d.start>>>8&255,a[2]=d.start&255,a[3]=d.length>>>8,a[4]=d.length&255,a.set(d,5),b.push(a),c+=a.length;c=new Uint8Array(c);d=5;c[0]=80;c[1]=65;c[2]=84;c[3]=67;c[4]=72;for(const a of b)c.subarray(d,d+a.length).set(a),d+=a.length;c[d]=69;c[d+1]=79;c[d+2]=70;return new Patch$$module$6502(c)}apply(a){for(const b of this)b.apply(a)}*[Symbol.iterator](){let a=
5;for(;a<this.data.length-3;){const b=this.data[a+3]<<8|this.data[a+4];yield new Chunk$$module$6502(this.data[a]<<16|this.data[a+1]<<8|this.data[a+2],this.data.subarray(a+5,a+5+b));a+=b+5}}toHexString(){return[...this.data].map((a)=>a.toString(16).padStart(2,"0")).join("")}}
const assemble$$module$6502=(a,b="input")=>{b=new File$$module$6502({},b);for(const c of a.split("\n"))b.ingest(c);a=b.assemble();return Patch$$module$6502.from(a)},buildRomPatch$$module$6502=(a,b,c=262144)=>{a=[...a].map((a)=>a.shift(16));b=[...b||[]].map((a)=>a.shift(16+c));return Patch$$module$6502.from([...a,...b])};
class Opcode$$module$6502 extends AbstractLine$$module$6502{constructor(a,b,c){super();this.mnemonic=a;this.pcInternal=c;this.arg=findMode$$module$6502(a,b)}get pc(){return this.pcInternal}size(){return 1+this.arg[1]}bytes(){let a=this.arg[2];if("Relative"===this.arg[0]&&(a-=this.pc+2,!(128>a&&-128<=a)))throw Error(`Too far to branch: ${a} at ${this.source()}`);var b=opcodes$$module$6502[this.mnemonic][this.arg[0]];if(null==b)throw Error(`No opcode: ${this.mnemonic} ${this.arg[0]}`);b=[b];let c=this.arg[1];
for(;c--;)b.push(a&255),a>>>=8;return b}expand(a){this.arg[2]=a.map(this.arg[2],this.pc);this.pcInternal=a.map(~this.pc)}}const find$$module$6502=(a,b)=>{let c=0,d=a.length-1;if(0>d||b<a[0])return-1;var e=a[d];if(b===e)return d;if(b>e)return~a.length;for(;1<d-c;)e=c+d>>1,b<a[e]?d=e:c=e;return b===a[c]?c:~d},findMode$$module$6502=(a,b)=>{for(const [d,e]of modes$$module$6502){var c=d.exec(b);if(c){c=e(c[1]);if(!(a in opcodes$$module$6502))throw Error(`Bad mnemonic: ${a}`);if(c[0]in opcodes$$module$6502[a])return c}}throw Error(`Could not find mode for ${a} ${b}
Expected one of [${Object.keys(opcodes$$module$6502[a]).join(", ")}]`);},modes$$module$6502=[[/^$/,()=>["Implied",0,0]],[/^#(.+)$/,(a)=>["Immediate",1,parseNumber$$module$6502(a,!0)]],[/^(\$..)$/,(a)=>["ZeroPage",1,parseNumber$$module$6502(a,!0)]],[/^(\$..),x$/,(a)=>["ZeroPageX",1,parseNumber$$module$6502(a,!0)]],[/^(\$..),y$/,(a)=>["ZeroPageY",1,parseNumber$$module$6502(a,!0)]],[/^\((\$..),x\)$/,(a)=>["PreindexedIndirect",1,parseNumber$$module$6502(a,!0)]],[/^\((\$..)\),y$/,(a)=>["PostindexedIndirect",
1,parseNumber$$module$6502(a,!0)]],[/^\((.+)\)$/,(a)=>["IndirectAbsolute",2,parseNumber$$module$6502(a,!0)]],[/^(.+),x$/,(a)=>["AbsoluteX",2,parseNumber$$module$6502(a,!0)]],[/^(.+),y$/,(a)=>["AbsoluteY",2,parseNumber$$module$6502(a,!0)]],[/^(.+)$/,(a)=>["Absolute",2,parseNumber$$module$6502(a,!0)]],[/^(.+)$/,(a)=>["Relative",1,parseNumber$$module$6502(a,!0)]]];
function parseNumber$$module$6502(a,b=!1){if(a.startsWith("$"))return Number.parseInt(a.substring(1),16);if(a.startsWith("%"))return Number.parseInt(a.substring(1),2);if(a.startsWith("0"))return Number.parseInt(a,8);const c=Number.parseInt(a,10);if(!Number.isNaN(c))return c;if(b)return a;throw Error(`Bad number: ${a}`);}
const opcodes$$module$6502={adc:{Absolute:109,AbsoluteX:125,AbsoluteY:121,Immediate:105,PostindexedIndirect:113,PreindexedIndirect:97,ZeroPage:101,ZeroPageX:117},and:{Absolute:45,AbsoluteX:61,AbsoluteY:57,Immediate:41,PostindexedIndirect:49,PreindexedIndirect:33,ZeroPage:37,ZeroPageX:53},asl:{Absolute:14,AbsoluteX:30,Implied:10,ZeroPage:6,ZeroPageX:22},bcc:{Relative:144},bcs:{Relative:176},beq:{Relative:240},bit:{Absolute:44,ZeroPage:36},bmi:{Relative:48},bne:{Relative:208},bpl:{Relative:16},brk:{Implied:0},
bvc:{Relative:80},bvs:{Relative:112},clc:{Implied:24},cld:{Implied:216},cli:{Implied:88},clv:{Implied:184},cmp:{Absolute:205,AbsoluteX:221,AbsoluteY:217,Immediate:201,PostindexedIndirect:209,PreindexedIndirect:193,ZeroPage:197,ZeroPageX:213},cpx:{Absolute:236,Immediate:224,ZeroPage:228},cpy:{Absolute:204,Immediate:192,ZeroPage:196},dec:{Absolute:206,AbsoluteX:222,ZeroPage:198,ZeroPageX:214},dex:{Implied:202},dey:{Implied:136},eor:{Absolute:77,AbsoluteX:93,AbsoluteY:89,Immediate:73,PostindexedIndirect:81,
PreindexedIndirect:65,ZeroPage:69,ZeroPageX:85},inc:{Absolute:238,AbsoluteX:254,ZeroPage:230,ZeroPageX:246},inx:{Implied:232},iny:{Implied:200},jmp:{Absolute:76,IndirectAbsolute:108},jsr:{Absolute:32},lda:{Absolute:173,AbsoluteX:189,AbsoluteY:185,Immediate:169,PostindexedIndirect:177,PreindexedIndirect:161,ZeroPage:165,ZeroPageX:181},ldx:{Absolute:174,AbsoluteY:190,Immediate:162,ZeroPage:166,ZeroPageY:182},ldy:{Absolute:172,AbsoluteX:188,Immediate:160,ZeroPage:164,ZeroPageX:180},lsr:{Absolute:78,
AbsoluteX:94,Implied:74,ZeroPage:70,ZeroPageX:86},nop:{Implied:234},ora:{Absolute:13,AbsoluteX:29,AbsoluteY:25,Immediate:9,PostindexedIndirect:17,PreindexedIndirect:1,ZeroPage:5,ZeroPageX:21},pha:{Implied:72},php:{Implied:8},pla:{Implied:104},plp:{Implied:40},rol:{Absolute:46,AbsoluteX:62,Implied:42,ZeroPage:38,ZeroPageX:54},ror:{Absolute:110,AbsoluteX:126,Implied:106,ZeroPage:102,ZeroPageX:118},rti:{Implied:64},rts:{Implied:96},sbc:{Absolute:237,AbsoluteX:253,AbsoluteY:249,Immediate:233,PostindexedIndirect:241,
PreindexedIndirect:225,ZeroPage:229,ZeroPageX:245},sec:{Implied:56},sed:{Implied:248},sei:{Implied:120},sta:{Absolute:141,AbsoluteX:157,AbsoluteY:153,PostindexedIndirect:145,PreindexedIndirect:129,ZeroPage:133,ZeroPageX:149},stx:{Absolute:142,ZeroPage:134,ZeroPageY:150},sty:{Absolute:140,ZeroPage:132,ZeroPageX:148},tax:{Implied:170},tay:{Implied:168},tsx:{Implied:186},txa:{Implied:138},txs:{Implied:154},tya:{Implied:152}};var module$6502={};module$6502.Assembler=Assembler$$module$6502;
module$6502.assemble=assemble$$module$6502;module$6502.buildRomPatch=buildRomPatch$$module$6502;const BitsArray$$module$bits_array={of:(...a)=>{const b=[];for(const c of a)b[c>>>5]=(b[c>>>5]||0)|1<<c;return b},from:(a)=>{const b=[];for(const c of a)b[c>>>5]=(b[c>>>5]||0)|1<<c;return b},containsAll:(a,b)=>{for(let c=Math.max(a.length,b.length)-1;0<=c;c--)if((b[c]||0)&~(a[c]||0))return!1;return!0},difference:(a,b)=>{const c=Array(Math.max(a.length,b.length));for(let d=Math.max(a.length,b.length)-1;0<=d;d--)c[d]=(a[d]||0)&~(b[d]||0);return c},with:(a,b)=>{a=[...a];a[b>>>5]=(a[b>>>5]||0)|1<<b;return a},
without:(a,b)=>{a=[...a];a[b>>>5]=(a[b>>>5]||0)&~(1<<b);return a},has:(a,b)=>!!((a[b>>>5]||0)&1<<b),bits:(a)=>{const b=[];for(let c=0;c<a.length;c++){let d=a[c],e=32;for(;d;){const a=Math.clz32(d)+1;e-=a;d<<=a;32===a&&(d=0);b.push(c<<5|e)}}return b},clone:(a)=>[...a],empty:(a)=>a.every((a)=>!a)};var module$bits_array={};module$bits_array.BitsArray=BitsArray$$module$bits_array;const BitsBigInt$$module$bits_bigint={of:(...a)=>{let b=ZERO$$module$bits_bigint;for(const c of a)b|=ONE$$module$bits_bigint<<BigInt(c);return b},from:(a)=>{let b=ZERO$$module$bits_bigint;for(const c of a)b|=ONE$$module$bits_bigint<<BigInt(c);return b},containsAll:(a,b)=>!(b&~a),with:(a,b)=>a|ONE$$module$bits_bigint<<BigInt(b),without:(a,b)=>a&~(ONE$$module$bits_bigint<<BigInt(b)),has:(a,b)=>!!(a&ONE$$module$bits_bigint<<BigInt(b)),bits:(a)=>{const b=[];let c=0;for(;a;){let d=Number(a&MAX_UINT32$$module$bits_bigint),
e=32;for(;d;){const a=Math.clz32(d)+1;e-=a;d<<=a;32===a&&(d=0);b.push(c|e)}a>>=THIRTY_TWO$$module$bits_bigint;c+=32}return b},clone:(a)=>a,empty:(a)=>!a,difference:(a,b)=>a&~b},BIGINT_OK$$module$bits_bigint="function"===typeof BigInt&&"bigint"===typeof BigInt(0),ZERO$$module$bits_bigint=BIGINT_OK$$module$bits_bigint&&BigInt(0),ONE$$module$bits_bigint=BIGINT_OK$$module$bits_bigint&&BigInt(1),MAX_UINT32$$module$bits_bigint=BIGINT_OK$$module$bits_bigint&&BigInt(4294967295),THIRTY_TWO$$module$bits_bigint=
BIGINT_OK$$module$bits_bigint&&BigInt(32);var module$bits_bigint={};module$bits_bigint.BitsBigInt=BitsBigInt$$module$bits_bigint;module$bits_bigint.BIGINT_OK=BIGINT_OK$$module$bits_bigint;const Bits$$module$bits=BIGINT_OK$$module$bits_bigint?BitsBigInt$$module$bits_bigint:BitsArray$$module$bits_array;var module$bits={};module$bits.Bits=Bits$$module$bits;let table$$module$crc32;
const buildTable$$module$crc32=()=>{let a;table$$module$crc32=new Uint32Array(256);for(let b=0;256>b;b++){a=b;for(let c=0;8>c;c++)a=a&1?3988292384^a>>>1:a>>>1;table$$module$crc32[b]=a}},USE_TEXT_ENCODER$$module$crc32=!1,strToBytes$$module$crc32=USE_TEXT_ENCODER$$module$crc32&&"function"===typeof TextEncoder?(a)=>(new TextEncoder).encode(a):(a)=>a.split("").map((a)=>a.charCodeAt(0)),crc32$$module$crc32=(a)=>{table$$module$crc32||buildTable$$module$crc32();"string"===typeof a&&(a=strToBytes$$module$crc32(a));
let b=-1;for(let c=0,d=a.length;c<d;c++)b=b>>>8^table$$module$crc32[(b^a[c])&255];return(b^-1)>>>0};var module$crc32={};module$crc32.crc32=crc32$$module$crc32;function generate$$module$data$monster(a){function b(a,b,f,g,h){h=Object.assign({},h);h.id=a;h.name=b;h.type="monster";h.action=f;h.count=g;c.push(h)}const c=[];b(80,"Blue Slime",32,6,{hits:1,satk:16,dgld:2,sexp:32,must:and$$module$data$monster(pat$$module$data$monster(100),pal$$module$data$monster(2,33))});b(81,"Weretiger",36,7,{hits:1.5,satk:21,dgld:4,sexp:40,must:and$$module$data$monster(pat$$module$data$monster(96),pal$$module$data$monster(3,32))});b(82,"Green Jelly",32,10,{sdef:4,hits:3,satk:16,
dgld:4,sexp:36,must:and$$module$data$monster(pat$$module$data$monster(101),pal$$module$data$monster(2,34))});b(83,"Red Slime",32,16,{sdef:6,hits:4,satk:16,dgld:4,sexp:48,must:and$$module$data$monster(pat$$module$data$monster(100),pal$$module$data$monster(2,35))});return c}function and$$module$data$monster(a,b){return[]}function pat$$module$data$monster(a){return[]}function pal$$module$data$monster(a,b){return[]}var module$data$monster={};module$data$monster.generate=generate$$module$data$monster;class Deque$$module$util{constructor(){this.buffer=Array(16);this.mask=15;this.size=this.end=this.start=0}get length(){return this.size}upsize(a){for(;this.mask<a;)this.end<=this.start&&(this.start+=this.mask+1),this.mask=this.mask<<1|1,this.buffer=this.buffer.concat(this.buffer);this.size=a}push(...a){this.upsize(this.size+a.length);for(const b of a)this.buffer[this.end]=b,this.end=this.end+1&this.mask}pop(){if(this.size)return this.end=this.end-1&this.mask,this.size--,this.buffer[this.end]}peek(){if(this.size)return this.buffer[this.end-
1&this.mask]}unshift(...a){this.upsize(this.size+a.length);for(const b of a)this.start=this.start-1&this.mask,this.buffer[this.start]=b}shift(){if(this.size){var a=this.buffer[this.start];this.start=this.start+1&this.mask;this.size--;return a}}front(){if(this.size)return this.buffer[this.start]}toString(){const a=Array(this.size);for(let b=0;b<this.size;b++)a[b]=this.buffer[this.start+b&this.mask];return`[${a.join(", ")}]`}}
const breakLines$$module$util=(a,b)=>{a=a.trim();const c=[];for(;a.length>b;){let d=a.substring(0,b).lastIndexOf(" ");0>d&&(d=b);c.push(a.substring(0,d).trim());a=a.substring(d).trim()}c.push(a.trim());return c};class UsageError$$module$util extends Error{}
class SuffixTrie$$module$util{constructor(a=""){this.key=a;this.next=new Map}get(a){let b=this;for(let c=a.length-1;0<=c&&b;c++)b=b.next.get(a[c]);return b&&b.data}with(a){let b=this.next.get(a);b||this.next.set(a,b=new SuffixTrie$$module$util(a+this.key));return b}set(a,b){let c=this;for(let b=a.length-1;0<=b&&c;b++)c=c.with(a[b]);c.data=b}*values(){const a=[this];for(;a.length;){const b=a.pop();b.data&&(yield b.data);a.push(...b.next.values())}}}var module$util={};module$util.Deque=Deque$$module$util;
module$util.breakLines=breakLines$$module$util;module$util.UsageError=UsageError$$module$util;module$util.SuffixTrie=SuffixTrie$$module$util;const REPEATABLE_FLAGS$$module$flagset=new Set(["S"]),PRESETS$$module$flagset=[{title:"Casual",descr:"Basic flags for a relatively easy playthrough.",flags:"Ds Edmrsx Fw Mr Rp Sbk Sc Sm Tab"},{title:"Intermediate",descr:"Slightly more challenge than Casual but still approachable.",flags:"Ds Edms Fsw Gt Mr Ps Rlpt Sbkm Sct Tab",default:!0},{title:"Full Shuffle",descr:"Slightly harder than intermediate, with full shuffle and no spoiler log.",flags:"Em Fsw Gt Mr Ps Rlprt Sbckmt Tab"},{title:"Glitchless",
descr:"Full shuffle but with no glitches.",flags:"Em Fcpstw Mr Ps Rlprt Sbckmt Tab"},{title:"Advanced",descr:"A balanced randomization with quite a bit more difficulty.",flags:"Fsw Gfprt Hbw Mr Ps Rlprt Sbckt Sm Tab"},{title:"Ludicrous",descr:"Pulls out all the stops, may require superhuman feats.",flags:"Fs Gfprstw Hbgmswx Mr Ps Rlprt Sbckmt Tab"}],PRESETS_BY_KEY$$module$flagset={};
for(const {title:a,flags:b}of PRESETS$$module$flagset)PRESETS_BY_KEY$$module$flagset[`@${a.replace(/ /g,"").toLowerCase()}`]=b;
const FLAGS$$module$flagset=[{section:"Items",text:"Items are broken into five pools: <i>key items</i> includes all\n      swords, orbs, bracelets, and progression items (rabbit boots,\n      gas mask, and all items in the third row: windmill key through\n      bow of truth), as well as anything dropped by a boss (one each\n      of fruit of power, opel statue, fruit of repun, sacred shield,\n      and psycho armor); <i>bonus items</i> includes items that are\n      never required but are nice to have, specifically the remaining\n      six passive effect items in the second inventory row;\n      <i>consumable items</i> includes everything else found in\n      chests: primarily first row one-use items, but also includes\n      psycho shield and battle armor; <i>magic</i> is the eight\n      spells; and <i>traps</i> are the 12 trap chests found in various\n      places. These pools can be shuffled together, kept separate, or\n      left unshuffled.",flags:[{flag:"Sk",
name:"Shuffle key items"},{flag:"Sm",name:"Shuffle magics"},{flag:"Sb",name:"Shuffle bonus items"},{flag:"Sc",name:"Shuffle consumables"},{flag:"Sbk",name:"Shuffle key items with bonus items"},{flag:"Sbm",name:"Shuffle bonus items with magic"},{flag:"Sbt",name:"Shuffle bonus items with traps"},{flag:"Sct",name:"Shuffle consumables with traps"},{flag:"Skm",name:"Shuffle key items with magic"},{flag:"Skt",name:"Shuffle key items with traps"},{flag:"Sbkm",name:"Shuffle bonus, key, and magic"},{flag:"Sbc",
hard:!0,name:"Shuffle bonus items with consumables"},{flag:"Sck",hard:!0,name:"Shuffle consumables with key items"},{flag:"Scm",hard:!0,name:"Shuffle consumables with magic"},{flag:"Sbck",hard:!0,name:"Shuffle bonus, consumables, and key items"},{flag:"Sbct",hard:!0,name:"Shuffle bonus, consumables, and traps"},{flag:"Sbkt",hard:!0,name:"Shuffle bonus, key, and traps"},{flag:"Skmt",hard:!0,name:"Shuffle key, magic, and traps"},{flag:"Sbckm",hard:!0,name:"Shuffle bonus, key, consumables, and magic"},
{flag:"Sbckt",hard:!0,name:"Shuffle bonus, key, consumables, and traps"},{flag:"Sbkmt",hard:!0,name:"Shuffle bonus, key, magic, and traps"},{flag:"Sbckmt",hard:!0,name:"Shuffle all items and traps together"}]},{section:"Monsters",text:"Monster stats are always normalized by scaling level.",flags:[{flag:"Mr",name:"Randomize monsters",text:"Monster locations are shuffled, with the exception of sea creatures\n           and tower robots."},{flag:"Me",hard:!0,name:"Shuffle monster weaknesses",text:"Monster elemental weaknesses are shuffled.  This is <i>not</i>\n           accounted for when guaranteeing matching swords, so use at your\n           own risk (it's recommended to also turn on the 'Hs' flag)."},
{flag:"Mt",hard:!0,name:"Shuffle tower robots",text:"Tower robots will be shuffled into the normal pool.  At some\n           point, normal monsters may be shuffled into the tower as well.\n           NOTE: tower robots currently don't give any gold or experience."}]},{section:"Shops",text:"Prices are always normalized by scaling level: prices at tool shops\n         and inns double every 10 scaling levels, while prices at armor shops\n         halve every 12 scaling levels ",flags:[{flag:"Ps",name:"Shuffle shop contents",
text:"This includes normalizing prices via the scaling level, as well as a\n           random variance for each shop: base prices may vary \u00b150% for the same\n           item at different; inn prices may vary \u00b162.5%."}]},{section:"Hard mode",flags:[{flag:"Hw",hard:!0,name:"Battle magic not guaranteed",text:"Normally, the logic will guarantee that level 3 sword charges are\n           available before fighting the tetrarchs (with the exception of Karmine,\n           who only requires level 2).  This disables that check."},
{flag:"Hb",hard:!0,name:"Barrier not guaranteed",text:"Normally, the logic will guarantee Barrier (or else refresh and shield\n           ring) before entering Stxy, the Fortress, or fighting Karmine.  This\n           disables that check."},{flag:"Hm",hard:!0,name:"Don't buff medical herb or fruit of power",text:"Medical Herb is not buffed to heal 64 damage, which is helpful to make\n           up for cases where Refresh is unavailable early.  Fruit of Power is not\n           buffed to restore 48 MP."},
{flag:"Hg",hard:!0,name:"Gas mask not guaranteed",text:"The logic will not guarantee gas mask before needing to enter the swamp.\n           Gas mask is still guaranteed to kill the insect."},{flag:"Hs",hard:!0,name:"Matching sword not guaranteed",text:'Player may be required to fight bosses with the wrong sword, which\n           may require using "tink strats" dealing 1 damage per hit.'},{flag:"Hx",hard:!0,name:"Experience scales slower",text:'More grinding will be required to "keep up" with the difficulty.'},
{flag:"Hc",hard:!0,name:"Charge shots only",text:"Stabbing is completely ineffective.  Only charged shots work."},{flag:"Hz",hard:!0,name:"Blackout mode",text:"All caves and fortresses are permanently dark."}]},{section:"Tweaks",flags:[{flag:"Ta",name:"Automatically equip orbs and bracelets",text:"Adds a quality-of-life improvement to automatically equip the\n           corresponding orb/bracelet whenever changing swords."},{flag:"Tb",name:"Buff bonus items",text:"Leather Boots are changed to Speed Boots, which increase player walking\n           speed (this allows climbing up the slope to access the Tornado Bracelet\n           chest, which is taken into consideration by the logic).  Deo's pendant\n           restores MP while moving.  Rabbit boots enable sword charging up to\n           level 2 while walking (level 3 still requires being stationary, so as\n           to prevent wasting tons of magic)."}]},
{section:"Routing",flags:[{flag:"Rs",name:"Story Mode",text:"Draygon 2 won't spawn unless you have all four swords and have\n           defeated all major bosses of the tetrarchy."},{flag:"Rt",name:"Sword of Thunder teleports to Shyron",text:"Normally when acquiring the thunder sword, the player is instantly\n           teleported to Shyron. This flag maintains that behavior regardless of\n           where it is found (immediately activating the warp point; talking\n           to Asina will teleport back to the start, in case no other means of\n           return is available).  Disabling this flag means that the Sword of\n           Thunder will act like all other items and not teleport."},
{flag:"Rd",name:"Require healing dolphin to return fog lamp",text:"Normally the fog lamp cannot be returned without healing the dolphin\n           to acquire the shell flute (so as not to be stranded).  Continuity\n           suggests that actually healing the dolphin should also be required,\n           but we've found that this makes the dolphin a lot less useful.  By\n           default the fog lamp can be returned before healing the dolphin.  This\n           flag adds the extra requirement for better continuity."},
{flag:"Rp",name:"Wind-waterfall passage",text:"Opens a passage between Valley of Wind (lower right side) and\n           Lime Tree Valley."},{flag:"Rr",name:"Deo requires telepathy",text:"Deo's item is additionally blocked on telepathy."},{flag:"Rl",name:'No "free lunch" magic',text:'Disables "free lunch" magics that only require stepping on a square to\n           learn (specifally Barrier and Paralysis).  Instead, Barrier requires\n           the seas to be calmed, and Paralysis requires the prison key (which\n           can be used at the top of the slope in Waterfall Valley to open the\n           path in reverse).  Reverse vampire also requires the windmill to have\n           been started.'},
{flag:"Ro",name:"Orbs not required to break walls",text:"Walls can be broken and bridges formed with level 1 shots.  Orbs and\n           bracelets are no longer considered progression items (except for\n           Tornado bracelet for Tornel on Mt Sabre)."}]},{section:"Glitches",text:"The routing logic can be made aware of the following\n      glitches.  If selected, it will assume that the glitch can be\n      performed when verifying that a game is winnable.  Enabling\n      these glitches tends to increase the randomness of the shuffle,\n      since there are more valid options.",
flags:[{flag:"Gc",hard:!0,name:"Sword charge glitch may be required",text:"Progression may require using the sword charge glitch to destroy walls or\n           form bridges without actually possessing the correct orb."},{flag:"Gf",name:"Ghetto flight may be required",text:"Progression may require using Rabbit Boots and the dolphin to reach Swan\n           before the Angry Sea can be calmed and before Flight is available."},{flag:"Gp",name:"Teleport skip may be required",text:"Progression may require entering Mt. Sabre North from Cordel Plain\n           without the Teleport spell (flying over the river to avoid the\n           trigger)."},
{flag:"Gr",name:"Rabbit skip may be required",text:"Progression may require entering Mt. Sabre North from Cordel Plain\n           without talking to the rabbit in Leaf after the abduction."},{flag:"Gt",name:"Statue glitch may be required",text:"Progression may require glitching past guards without Change or Paralysis,\n           or people turned to stone without a Flute of Lime.  The logic <i>hopefully</i>\n           ensures that using the Flute of Lime on the two statues will not break the\n           game, but we're less confident that this is always the case, so for safety\n           we recommend always glitching past the statues if this option is set, even if\n           the first Flute of Lime has been found."},
{flag:"Gw",hard:!0,name:"Wild warp may be required",text:'Progression may require using "wild warp" (holding A and B on controller 1\n           and tapping A on controller 2) to travel to parts of the game that would\n           otherwise be unreachable.'}]},{section:"Glitch Fixes",text:"Alternatively, glitches may be patched out of the game and made unusable.\n         These flags are exclusive with the flags that require the glitch.",flags:[{flag:"Fs",name:"Disable shop glitch",text:"Items may no longer be purchased for neighboring prices.  This makes\n           money actually mean something.  To compensate, gold drops money\n           will be scaled up somewhat."},
{flag:"Fc",name:"Disable sword charge glitch",text:"Sword charge glitch will no longer work.  It will be impossible to\n           achieve charge levels without having correct inventory."},{flag:"Fp",name:"Disable teleport skip",text:"Mt Sabre North cannot be entered from Cordel Plans without the\n           Teleport spell, even via glitch."},{flag:"Fr",name:"Disable rabbit skip",text:"Mt Sabre North cannot be entered from Cordel Plans without talking to\n           the rabbit in leaf."},{flag:"Ft",
name:"Disable statue glitch",text:"Statues will instead always push downwards, making it impossible to\n           glitch through statues for progression."},{flag:"Fw",name:"Disable wild warp",text:"Wild warp will only teleport back to Mezame shrine (to prevent\n           game-breaking soft-locks)."}]},{section:"Easy Mode",text:"The following options make parts of the game easier.",flags:[{flag:"Ed",name:"Decrease enemy damage",text:"Enemy attack power will be significantly decreased in the early game\n           (by a factor of 3).  The gap will narrow in the mid-game and eventually\n           phase out at scaling level 40."},
{flag:"Es",name:"Guarantee starting sword",text:"The Leaf elder is guaranteed to give a sword.  It will not be\n           required to deal with any enemies before finding the first sword."},{flag:"Er",name:"Guarantee refresh",text:"Guarantees the Refresh spell will be available before fighting Tetrarchs."},{flag:"Em",name:"Extra buff medical herb",text:"Buff Medical Herb to heal 96 instead of 64 and Fruit of Power to\n           restore 64 MP instead of 48."},{flag:"Ex",name:"Experience scales faster",
text:'Less grinding will be required to "keep up" with the game difficulty.'}]},{section:"Debug Mode",text:"These options are helpful for exploring or debugging.  Note that,\n      while they do not directly affect any randomization, they\n      <i>do</i> factor into the seed to prevent cheating, and they\n      will remove the option to generate a seed for racing.",flags:[{flag:"Ds",name:"Generate a spoiler log"},{flag:"Di",name:"Player never dies"}]}],exclusiveFlags$$module$flagset=(a)=>a.startsWith("S")?
new RegExp(`S.*[${a.substring(1)}]`):FLAG_CONFLICTS$$module$flagset[a],FLAG_CONFLICTS$$module$flagset={Hm:/Em/,Hx:/Ex/,Em:/Hm/,Ex:/Hx/,Fw:/Gw/,Gw:/Fw/,Ft:/Gt/,Gt:/Ft/,Fc:/Gc/,Gc:/Fc/,Fp:/Gp/,Gp:/Fp/,Fr:/Gr/,Gr:/Fr/};
class FlagSet$$module$flagset{constructor(a="RtGftTab"){if(a.startsWith("@")){var b=PRESETS_BY_KEY$$module$flagset[a.toLowerCase()];if(!b)throw new UsageError$$module$util(`Unknown preset: ${a}`);a=b}this.flags={};a=a.replace(/[^A-Za-z0-9!]/g,"");b=/([A-Z])([a-z0-9!]+)/g;for(var c;c=b.exec(a);){const [,a,b]=c;c=REPEATABLE_FLAGS$$module$flagset.has(a)?[b]:b;for(const b of c)this.set(a+b,!0)}}get(a){return this.flags[a]||[]}set(a,b){const c=a[0],d=a.substring(1);b?(this.removeConflicts(a),a=(this.flags[c]||
[]).filter((a)=>a!==d),a.push(d),a.sort(),this.flags[c]=a):(a=(this.flags[c]||[]).filter((a)=>a!==d),a.length?this.flags[c]=a:delete this.flags[c])}check(a){const b=this.flags[a[0]];return!!(b&&0<=b.indexOf(a.substring(1)))}autoEquipBracelet(){return this.check("Ta")}buffDeosPendant(){return this.check("Tb")}leatherBootsGiveSpeed(){return this.check("Tb")}rabbitBootsChargeWhileWalking(){return this.check("Tb")}shuffleMonsters(){return this.check("Mr")}shuffleShops(){return this.check("Ps")}bargainHunting(){return this.shuffleShops()}shuffleTowerMonsters(){return this.check("Mt")}shuffleMonsterElements(){return this.check("Me")}shuffleBossElements(){return this.shuffleMonsterElements()}doubleBuffMedicalHerb(){return this.check("Em")}buffMedicalHerb(){return!this.check("Hm")}decreaseEnemyDamage(){return this.check("Ed")}neverDie(){return this.check("Di")}chargeShotsOnly(){return this.check("Hc")}barrierRequiresCalmSea(){return this.check("Rl")}paralysisRequiresPrisonKey(){return this.check("Rl")}sealedCaveRequiresWindmill(){return this.check("Rl")}connectLimeTreeToLeaf(){return this.check("Rp")}storyMode(){return this.check("Rs")}requireHealedDolphinToRide(){return this.check("Rd")}saharaRabbitsRequireTelepathy(){return this.check("Rr")}teleportOnThunderSword(){return this.check("Rt")}orbsOptional(){return this.check("Ro")}guaranteeSword(){return this.check("Es")}guaranteeSwordMagic(){return!this.check("Hw")}guaranteeMatchingSword(){return!this.check("Hs")}guaranteeGasMask(){return!this.check("Hg")}guaranteeBarrier(){return!this.check("Hb")}guaranteeRefresh(){return this.check("Er")}disableSwordChargeGlitch(){return this.check("Fc")}disableTeleportSkip(){return this.check("Fp")}disableRabbitSkip(){return this.check("Fr")}disableShopGlitch(){return this.check("Fs")}disableStatueGlitch(){return this.check("Ft")}assumeSwordChargeGlitch(){return this.check("Gc")}assumeGhettoFlight(){return this.check("Gf")}assumeTeleportSkip(){return this.check("Gp")}assumeRabbitSkip(){return this.check("Gr")}assumeStatueGlitch(){return this.check("Gt")}assumeWildWarp(){return this.check("Gw")}nerfWildWarp(){return this.check("Fw")}allowWildWarp(){return!this.nerfWildWarp()}blackoutMode(){return this.check("Hz")}expScalingFactor(){return this.check("Hx")?
.25:this.check("Ex")?2.5:1}removeConflicts(a){const b=exclusiveFlags$$module$flagset(a);if(b)for(const c in this.flags)this.flags.hasOwnProperty(c)&&(a=this.flags[c].filter((a)=>!b.test(c+a)),a.length?this.flags[c]=a:delete this.flags[c])}toStringKey(a){return REPEATABLE_FLAGS$$module$flagset.has(a)?[...this.flags[a]].sort().map((b)=>a+b).join(" "):a+[...this.flags[a]].sort().join("")}toString(){const a=Object.keys(this.flags);a.sort();return a.map((a)=>this.toStringKey(a)).join(" ")}}
var module$flagset={};module$flagset.PRESETS=PRESETS$$module$flagset;module$flagset.FLAGS=FLAGS$$module$flagset;module$flagset.FlagSet=FlagSet$$module$flagset;const Edge$$module$graph={of:(...a)=>a.map((a)=>a.uid)};class Node$$module$graph{constructor(a,b){this.graph=a;this.name=b;this.uid=a.nodes.length;a.nodes.push(this)}get nodeType(){return"Node"}toString(){return`${this.nodeType} ${this.name}`}edges(a){return[]}write(){}}
class Graph$$module$graph{constructor(a){this.rom=a;this.nodes=[]}traverse({wanted:a,dfs:b=!1}={}){const c=new Deque$$module$util,d=new Map,e=new Map;for(var f of this.nodes)for(var g of f.edges()){var h=g.join(" ");for(let a=1;a<g.length;a++){const b=g[a];e.has(b)||e.set(b,new Map);e.get(b).set(h,g)}1===g.length&&(h=g[0],d.has(h)||(c.push(h),d.set(h,g)))}a=new Set((a||this.nodes).map((a)=>a instanceof Node$$module$graph?a.uid:a));for(f=new Map;a.size&&c.length;){g=b?c.pop():c.shift();a.delete(g);
a:for(const a of(e.get(g)||f).values())if(g=a[0],!d.has(g)){for(h=1;h<a.length;h++)if(!d.has(a[h]))continue a;d.set(g,a);c.push(g)}}return{path:[...d.values()].map(([a,...b])=>{const c=(a)=>[this.nodes[a]];return[a,[...c(a)," (",b.map((a)=>c(a).join("").replace(/\s+\(.*\)/,"")).join(", "),")"].join("")]}),seen:d,win:!a.size}}}
class SparseDependencyGraph$$module$graph{constructor(a){this.nodes=Array(a).fill(0).map(()=>new Map);this.finalized=Array(a).fill(!1)}addRoute(a){const b=a[0];if(this.finalized[b])throw Error(`Attempted to add a route for finalized node ${b}`);let c=new Set;for(let b=a.length-1;1<=b;b--)c.add(a[b]);for(;;){a=!1;for(var d of c){if(d===b)return[];if(this.finalized[d]){a=this.nodes[d];if(!a.size)return[];c.delete(d);if(1===a.size){for(const b of a.values().next().value)c.add(b);a=!0;break}d=new Map;
for(var e of a.values())for(var f of this.addRoute([b,...c,...e]))d.set(f.label,f);return[...d.values()]}}if(!a)break}e=[...c].sort();c=new Set(e);e=e.join(" ");f=this.nodes[b];if(f.has(e))return[];for(const [a,b]of f){if(containsAll$$module$graph(c,b))return[];containsAll$$module$graph(b,c)&&f.delete(a)}f.set(e,c);return[{target:b,deps:c,label:`${b}:${e}`}]}finalize(a){if(!this.finalized[a]){this.finalized[a]=!0;for(let b=0;b<this.nodes.length;b++){const c=this.nodes[b];if(c.size)for(const [d,e]of c)if(e.has(a)){const a=
this.finalized[b];this.finalized[b]=!1;c.delete(d);this.addRoute([b,...e.values()]);this.finalized[b]=a}}}}}const containsAll$$module$graph=(a,b)=>{if(a.size<b.size)return!1;for(const c of b)if(!a.has(c))return!1;return!0};var module$graph={};module$graph.Edge=Edge$$module$graph;module$graph.Node=Node$$module$graph;module$graph.Graph=Graph$$module$graph;module$graph.SparseDependencyGraph=SparseDependencyGraph$$module$graph;function seq$$module$rom$util(a,b=(a)=>a){return Array(a).fill(0).map((a,d)=>b(d))}function slice$$module$rom$util(a,b,c){return a.slice(b,b+c)}function tuple$$module$rom$util(a,b,c){return Array.from(a.slice(b,b+c))}function signed$$module$rom$util(a){return 128>a?a:a-256}function unsigned$$module$rom$util(a){return 0>a?a+256:a}function varSlice$$module$rom$util(a,b,c,d,e=Infinity,f){f||(f=(a)=>a);const g=[];for(;b+c<=e&&a[b]!==d;)g.push(f(a.slice(b,b+c))),b+=c;return g}
function addr$$module$rom$util(a,b,c=0){return(a[b]|a[b+1]<<8)+c}function group$$module$rom$util(a,b,c){c||(c=(a)=>a);return seq$$module$rom$util(Math.max(0,Math.floor(b.length/a)),(d)=>c(slice$$module$rom$util(b,d*a,a)))}function reverseBits$$module$rom$util(a){return 65793*(2050*a&139536|32800*a&558144)>>>16&255}function countBits$$module$rom$util(a){a-=a>>1&85;a=(a&51)+(a>>2&51);return a+(a>>4)&15}function hex$$module$rom$util(a){return null!=a?a.toString(16).padStart(2,"0"):String(a)}
function hex4$$module$rom$util(a){return a.toString(16).padStart(4,"0")}function concatIterables$$module$rom$util(a){const b=[];for(const c of a)for(const a of c)b.push(a);return b}function readBigEndian$$module$rom$util(a,b){return a[b]<<8|a[b+1]}function readLittleEndian$$module$rom$util(a,b){return a[b+1]<<8|a[b]}function readString$$module$rom$util(a,b,c=0){const d=[];for(;a[b]!=c;)d.push(a[b++]);return String.fromCharCode(...d)}
function writeLittleEndian$$module$rom$util(a,b,c){a[b]=c&255;a[b+1]=c>>>8}function writeString$$module$rom$util(a,b,c){for(let d=0,e=c.length;d<e;d++)a[b+d]=c.charCodeAt(d)}function write$$module$rom$util(a,b,c){a.subarray(b,b+c.length).set(c)}
class FlagListType$$module$rom$util{constructor(a,b){this.last=a;this.clear=b}read(a,b=0){const c=[];for(;;){const e=a[b++];var d=a[b++];d|=(e&3)<<8;c.push(e&this.clear?~d:d);if(e&this.last)return c}}bytes(a){const b=[];for(let c=0;c<a.length;c++){let d=a[c];0>d&&(d=this.clear<<8|~d);c===a.length-1&&(d|=this.last<<8);b.push(d>>>8);b.push(d&255)}return b}write(a,b,c=0){b=this.bytes(b);for(let d=0;d<b.length;d++)a[d+c]=b[d]}}
const DIALOG_FLAGS$$module$rom$util=new FlagListType$$module$rom$util(64,128),ITEM_GET_FLAGS$$module$rom$util=new FlagListType$$module$rom$util(64,128),SPAWN_CONDITION_FLAGS$$module$rom$util=new FlagListType$$module$rom$util(128,32);
class DataTuple$$module$rom$util{constructor(a){this.data=a}[Symbol.iterator](){return this.data[Symbol.iterator]()}hex(){return Array.from(this.data,hex$$module$rom$util).join(" ")}clone(){return new this.constructor(this.data)}static make(a,b){const c=class extends DataTuple$$module$rom$util{constructor(b=Array(a).fill(0)){super(b)}static of(a){const b=new c;for(const [c,d]of Object.entries(a))b[c]=d;return b}static from(b,d=0){return new c(tuple$$module$rom$util(b,d,a))}},d={};for(const a in b)d[a]=
"function"===typeof b[a]?{value:b[a]}:b[a];Object.defineProperties(c.prototype,d);return c}static prop(...a){return{get(){let b=0;for(const [c,d=255,e=0]of a)b|=(this.data[c]&d)>>>(0>e?0:e)<<(0>e?-e:0);return b},set(b){for(const [c,d=255,e=0]of a)this.data[c]=this.data[c]&~d|b>>>(0>e?-e:0)<<(0>e?0:e)&d}}}static booleanProp(a){const b=DataTuple$$module$rom$util.prop(a);return{get(){return!!b.get.call(this)},set(a){b.set.call(this,+a)}}}}
const watchArray$$module$rom$util=(a,b)=>new Proxy(a,{get(a,d){let c=a[d];if("subarray"===d)return(c,d)=>{const e=a.subarray(c,d);return c<=b&&b<d?watchArray$$module$rom$util(e,b-c):e};if("set"===d)return(c)=>{console.log(`Setting overlapping array ${b}`);debugger;a.set(c)};"function"===typeof c&&(c=c.bind(a));return c},set(a,d,e,f){if(d==b){console.log(`Writing ${b.toString(16)}`);debugger}a[d]=e;return!0}});var module$rom$util={};module$rom$util.seq=seq$$module$rom$util;module$rom$util.slice=slice$$module$rom$util;
module$rom$util.tuple=tuple$$module$rom$util;module$rom$util.signed=signed$$module$rom$util;module$rom$util.unsigned=unsigned$$module$rom$util;module$rom$util.varSlice=varSlice$$module$rom$util;module$rom$util.addr=addr$$module$rom$util;module$rom$util.group=group$$module$rom$util;module$rom$util.reverseBits=reverseBits$$module$rom$util;module$rom$util.countBits=countBits$$module$rom$util;module$rom$util.hex=hex$$module$rom$util;module$rom$util.hex4=hex4$$module$rom$util;
module$rom$util.concatIterables=concatIterables$$module$rom$util;module$rom$util.readBigEndian=readBigEndian$$module$rom$util;module$rom$util.readLittleEndian=readLittleEndian$$module$rom$util;module$rom$util.readString=readString$$module$rom$util;module$rom$util.writeLittleEndian=writeLittleEndian$$module$rom$util;module$rom$util.writeString=writeString$$module$rom$util;module$rom$util.write=write$$module$rom$util;module$rom$util.FlagListType=FlagListType$$module$rom$util;
module$rom$util.DIALOG_FLAGS=DIALOG_FLAGS$$module$rom$util;module$rom$util.ITEM_GET_FLAGS=ITEM_GET_FLAGS$$module$rom$util;module$rom$util.SPAWN_CONDITION_FLAGS=SPAWN_CONDITION_FLAGS$$module$rom$util;module$rom$util.DataTuple=DataTuple$$module$rom$util;module$rom$util.watchArray=watchArray$$module$rom$util;class TrackerNode$$module$nodes extends Node$$module$graph{constructor(a,b,c){super(a,c);this.type=b}get nodeType(){return"Tracker"}edges({}={}){return[]}}TrackerNode$$module$nodes.OFF_ROUTE=1;TrackerNode$$module$nodes.GLITCH=2;TrackerNode$$module$nodes.HARD=3;class Option$$module$nodes extends Node$$module$graph{constructor(a,b,c){super(a,b);this.value=c}get nodeType(){return"Option"}edges(){return this.value?[Edge$$module$graph.of(this)]:[]}}
class Slot$$module$nodes extends Node$$module$graph{constructor(a,b,c,d,e=[]){super(a,b);this.item=c;this.slots=e;this.isInvisible=this.requiresUnique=!1;this.slotName=b;this.slotIndex=d;this.slotType=c instanceof Magic$$module$nodes?"magic":"consumable";this.vanillaItemName=c.name;this.itemIndex=d}get nodeType(){return"Slot"}toString(){return`${super.toString()} [${this.vanillaItemName} $${this.slotIndex.toString(16).padStart(2,"0")}]`}edges(){return null!=this.item&&null!=this.itemIndex?[Edge$$module$graph.of(this.item,
this)]:[]}isFixed(){return!1}isMimic(){return 112<=this.itemIndex}requireUnique(){this.requiresUnique=!0;return this}canHoldMimic(){return this instanceof Chest$$module$nodes&&!this.isInvisible}needsChest(){const a=this.itemIndex;return 13<=a&&36>=a||38===a||72<a}isChest(){return(this instanceof Chest$$module$nodes||this instanceof BossDrop$$module$nodes)&&9!==this.slotIndex}get name2(){return this.item.name===this.vanillaItemName?this.name:`${this.item.name} [${this.vanillaItemName}]`}set(a,b){this.item=
a;this.itemIndex=b}write(){if(this.slots){var a=this.graph.rom;if(a)for(const b of this.slots)b(a,this)}}swap(a){const b=this.item,c=this.itemIndex;this.set(a.item,a.itemIndex);a.set(b,c)}key(){this.slotType="key";return this}bonus(){this.slotType="bonus";return this}direct(a){this.slots.push((b,c)=>{write$$module$nodes(b.prg,a,c.itemIndex)});return this}fromPerson(a,b,c=0){this.slots.push((a,e)=>{a.npcs[b].data[c]=e.itemIndex});return this}npcSpawn(a,b,c=0){this.slots.push((d,e)=>{d=d.npcs[a].spawnConditions;
null==b&&(b=getFirst$$module$nodes(d.keys()));d=d.get(b);if(!d)throw Error(`No spawn found for NPC $${hex$$module$rom$util(a)} @ $${hex$$module$rom$util(b)}`);d[c]=setItem$$module$nodes(d[c],e)});return this}dialog(a,b,c=0,d){this.slots.push((e,f)=>{e=e.npcs[a].localDialogs;null==b&&(b=getFirst$$module$nodes(e.keys()));e=e.get(b);if(!e)throw Error(`No dialog found for NPC $${hex$$module$rom$util(a)} @ $${hex$$module$rom$util(b)}`);e=e[c];if(!e)throw Error(`No such dialog ${c}`);null==d?e.condition=
setItem$$module$nodes(e.condition,f):e.flags[d]=setItem$$module$nodes(e.flags[d],f)});return this}trigger(a,b=0,c){this.slots.push((d,e)=>{d=d.triggers[a&127];null==c?d.conditions[b]=setItem$$module$nodes(d.conditions[b],e):d.flags[c]=setItem$$module$nodes(d.flags[c],e)});return this}}class FixedSlot$$module$nodes extends Slot$$module$nodes{isFixed(){return!0}}class BossDrop$$module$nodes extends Slot$$module$nodes{get nodeType(){return"BossDrop"}}
class Chest$$module$nodes extends Slot$$module$nodes{constructor(a,b,c,d){super(a,b,c,d);this.spawnSlot=null;this.isInvisible=!1}get nodeType(){return"Chest"}objectSlot(a,b){this.spawnSlot=b;this.slots.push((c,d)=>{c=c.locations[a];if(!c||!c.used)throw Error(`No such location: $${hex$$module$rom$util(a)}`);c=c.spawns[b-13];if(!c||!c.isChest())throw Error(`No chest $${hex$$module$rom$util(b)} on $${hex$$module$rom$util(a)}`);c.timed=!1;c.id=Math.min(d.itemIndex,112)});return this}invisible(a){this.isInvisible=
!0;return this.direct(a)}}
class ItemGet$$module$nodes extends Node$$module$graph{constructor(a,b,c){super(a,c);this.id=b;this.shufflePriority=1;this.inventoryRow="unique"}get nodeType(){return"ItemGet"}chest(a=this.name+" chest",b=this.id){return new Chest$$module$nodes(this.graph,a,this,b)}fromPerson(a,b,c=0){return new Slot$$module$nodes(this.graph,a,this,this.id,[(a,e)=>{a.npcs[b].data[c]=e.itemIndex}])}bossDrop(a,b,c=this.id){return new BossDrop$$module$nodes(this.graph,a,this,c,[(a,c)=>{a.bossKills[b].itemDrop=c.itemIndex}])}direct(a,
b){return new Slot$$module$nodes(this.graph,a,this,this.id,[(a,d)=>{write$$module$nodes(a.prg,b,d.itemIndex)}])}fixed(){return new FixedSlot$$module$nodes(this.graph,this.name,this,this.id)}weight(a){this.shufflePriority=a;return this}consumable(){this.inventoryRow="consumable";return this}armor(){this.inventoryRow="armor";return this}}class Item$$module$nodes extends ItemGet$$module$nodes{get nodeType(){return"Item"}}
class Magic$$module$nodes extends ItemGet$$module$nodes{get nodeType(){return"Magic"}}class Trigger$$module$nodes extends Node$$module$graph{constructor(a,b){super(a,b);this.slot=null;this.reqs=[]}get nodeType(){return"Trigger"}edges(){const a=[...this.reqs];this.slot&&a.push(Edge$$module$graph.of(this.slot,this));return a}get(a){if(this.slot)throw Error("already have a slot");this.slot=a;return this}}
class Condition$$module$nodes extends Node$$module$graph{constructor(a,b){super(a,b);this.options=[]}get nodeType(){return"Condition"}edges(){return this.options.map((a)=>Edge$$module$graph.of(this,...a))}option(...a){this.options.push(a.map((a)=>a instanceof Slot$$module$nodes?a.item:a));return this}}class Boss$$module$nodes extends Trigger$$module$nodes{constructor(a,b,c,...d){super(a,c);this.index=b;this.deps=d.map((a)=>a instanceof Slot$$module$nodes?a.item:a)}get nodeType(){return"Boss"}}
class Area$$module$nodes extends Node$$module$graph{get nodeType(){return"Area"}}class Connection$$module$nodes{constructor(a,b,c=!1,d=[]){this.from=a;this.to=b;this.bidi=c;this.deps=d.map((a)=>a instanceof Slot$$module$nodes?a.item:a)}reverse(){return new Connection$$module$nodes(this.to,this.from,this.bidi,this.deps)}}
class Location$$module$nodes extends Node$$module$graph{constructor(a,b,c,d){super(a,c.name+": "+d);this.id=b;this.area=c;this.connections=[];this.chests=[];this.type=this.bossNode=null;this.isEnd=this.isStart=!1;this.sells=[];this.simpleName=d}get nodeType(){return"Location"}toString(){return`Location ${this.id.toString(16).padStart(2,"0")} ${this.name}`}edges(){const a=[];for(const b of this.connections)a.push(Edge$$module$graph.of(b.to,b.from,...b.deps,...b.from.bossNode?[b.from.bossNode]:[])),
b.bidi&&a.push(Edge$$module$graph.of(b.from,b.to,...b.deps,...b.to.bossNode?[b.to.bossNode]:[]));for(const b of this.chests)a.push(Edge$$module$graph.of(b,this));this.isStart&&a.push(Edge$$module$graph.of(this));return a}addConnection(a){a.from.connections.push(a);a.to.connections.push(a);return this}from(a,...b){return this.addConnection(new Connection$$module$nodes(a,this,!1,b))}to(a,...b){return this.addConnection(new Connection$$module$nodes(this,a,!1,b))}connect(a,...b){return this.addConnection(new Connection$$module$nodes(a,
this,!0,b))}connectTo(a,...b){return this.addConnection(new Connection$$module$nodes(this,a,!0,b))}chest(a,b,c){a instanceof Slot$$module$nodes&&!(a instanceof Chest$$module$nodes)&&null!=c&&(a=a.item);a instanceof ItemGet$$module$nodes&&(a=a.chest(void 0,c));b=a.objectSlot(this.id,b);this.chests.push(b);112<=b.itemIndex&&(b.slotType="trap");if(!b.slotName||b.slotName.endsWith(" chest"))b.slotName=a.name+" in "+this.area.name;return this}trigger(a,...b){b=b.map((a)=>a instanceof Slot$$module$nodes?
a.item:a);a.reqs.push(Edge$$module$graph.of(a,this,...b));return this}boss(a){this.bossNode=a;a.reqs.push(Edge$$module$graph.of(a,this,...a.deps));return this}overworld(){this.type="overworld";return this}town(){this.type="town";return this}cave(){this.type="cave";return this}sea(){this.type="sea";return this}fortress(){this.type="fortress";return this}house(){this.type="house";return this}shop(...a){this.type="house";this.sells=a.map((a)=>a instanceof Slot$$module$nodes?a.item:a);return this}misc(){this.type=
"misc";return this}start(){this.isStart=!0;return this}end(){this.isEnd=!0;return this}fullName(){const a=[this.simpleName];this.bossNode&&a.push(this.bossNode.name);return a.join("\\n")}write(){if(this.sells.length){var a=this.graph.rom;if(!a)throw Error("Cannot write without a rom");for(const b of a.shops)if(b.location===this.id)for(a=0;4>a;a++)b.contents[a]=this.sells[a]?this.sells[a].id:255}}}
class WorldGraph$$module$nodes extends Graph$$module$graph{write(){for(const a of this.nodes)a.write()}shuffleShops(a){const b={shops:[],items:[]},c={shops:[],items:[]};for(var d of this.nodes)if(d instanceof Location$$module$nodes&&d.sells.length){var e="armor"===d.sells[0].inventoryRow?b:c;e.shops.push(d);for(let a=0;4>a;a++)e.items.push(d.sells[a]||null);d.sells=[]}a.shuffle(b.items);a.shuffle(c.items);for(const {shops:f,items:g}of[b,c])for(a=0;g.length&&1E5>a;)d=g.pop(),e=f[a++%f.length],d&&(0<=
e.sells.indexOf(d)||4<=e.sells.length?g.push(d):e.sells.push(d));for(const {shops:a}of[b,c])for(const b of a)b.sells.sort((a,b)=>a.id-b.id)}integrate({tracker:a=!1}={}){var b=!a;const c=new SparseDependencyGraph$$module$graph(this.nodes.length);var d=[],e=[];const f=new Set,g=new Map;var h=[];const k=[],l=[],m=[],n=[],p=new Set;for(const a of this.nodes)if(a instanceof Location$$module$nodes){if(a.isStart){const [b]=c.addRoute([a.uid]);g.set(b.label,b)}d[a.uid]=[];e[a.uid]=[];for(const b of a.connections)f.has(b)||
(f.add(b),b.bidi&&f.add(b.reverse()));for(const b of a.chests)c.addRoute([b.uid,a.uid])}else if(a instanceof ItemGet$$module$nodes&&"Medical Herb"===a.name&&(c.addRoute([a.uid]),c.finalize(a.uid)),a instanceof Option$$module$nodes)h.push(a);else if(a instanceof TrackerNode$$module$nodes)k.push(a);else if(a instanceof Condition$$module$nodes)l.push(a);else if(a instanceof Trigger$$module$nodes)m.push(a);else if(a instanceof ItemGet$$module$nodes)n.push(a);else if(a instanceof Slot$$module$nodes)p.add(a);
else if(!(a instanceof Area$$module$nodes))throw Error(`Unknown node type: ${a.nodeType}`);for(const a of f)d[a.from.uid].push(a),e[a.to.uid].push(a);e=(b)=>{for(const d of b){for(const b of d.edges({tracker:a}))c.addRoute(b);c.finalize(d.uid)}};e(h);b&&e(k);e(m);for(const a of g.values()){b=a.target;for(const e of d[b]){b=[e.to.uid,...a.deps];for(h=e.deps.length-1;0<=h;h--)b.push(e.deps[h].uid);e.from.bossNode&&b.push(e.from.bossNode.uid);for(const a of c.addRoute(b))g.has(a.label)||g.set(a.label,
a)}}e(l);for(d=0;d<this.nodes.length;d++)this.nodes[d]instanceof ItemGet$$module$nodes||this.nodes[d]instanceof TrackerNode$$module$nodes||c.finalize(d);d=new LocationList$$module$nodes(this);for(const a of p)for(const b of c.nodes[a.uid].values())d.addRoute([a.uid,...b]);return d}}
class LocationList$$module$nodes{constructor(a){this.worldGraph=a;this.uidToLocation=[];this.locationToUid=[];this.uidToItem=[];this.itemToUid=[];this.routes=[];this.unlocks=[];this.win=null}item(a){return this.worldGraph.nodes[this.itemToUid[a]]}location(a){return this.worldGraph.nodes[this.locationToUid[a]]}addRoute(a){let b=Bits$$module$bits.of(),c=-1;const d=[];for(let f=a.length-1;0<=f;f--){var e=f?this.uidToItem:this.uidToLocation;const g=f?this.itemToUid:this.locationToUid,h=a[f];let k=e[h];
null==k&&(k=g.length,g.push(h),e[h]=k,e=this.worldGraph.nodes[h],!f&&e instanceof Slot$$module$nodes&&e.isFixed()&&(this.win=k));f?(b=Bits$$module$bits.with(b,k),d.push(this.unlocks[k]||(this.unlocks[k]=new Set))):c=k}(this.routes[c]||(this.routes[c]=[])).push(b);for(const a of d)a.add(c)}canReach(a,b){a=this.routes[this.uidToLocation[a.uid]];for(let c=0,d=a.length;c<d;c++)if(Bits$$module$bits.containsAll(b,a[c]))return!0;return!1}traverse(a=Bits$$module$bits.of(),b=[]){a=Bits$$module$bits.clone(a);
const c=new Set,d=new Set;for(var e=0;e<this.locationToUid.length;e++)d.add(e);for(const f of d)if(d.delete(f),!c.has(f)){e=this.routes[f];for(let g=0,h=e.length;g<h;g++)if(Bits$$module$bits.containsAll(a,e[g])){c.add(f);if(b[f]){a=Bits$$module$bits.with(a,b[f]);for(const a of this.unlocks[b[f]])d.add(a)}break}}return c}traverseDepths(a){let b=Bits$$module$bits.of(),c=0;const d=[],e={},f=new Set;for(var g=0;g<this.locationToUid.length;g++)f.add(g);f.add(e);for(const h of f)if(f.delete(h),"number"!==
typeof h)f.size&&f.add(e),c++;else if(null==d[h]){g=this.routes[h];for(let e=0,l=g.length;e<l;e++)if(Bits$$module$bits.containsAll(b,g[e])){d[h]=c;if(a[h]){b=Bits$$module$bits.with(b,a[h]);for(const b of this.unlocks[a[h]])f.add(b)}break}}return d}toString(){const a=[];for(let b=0;b<this.routes.length;b++){const c=this.location(b),d=this.routes[b],e=[];for(let a=0,b=d.length;a<b;a++){const b=[];for(const c of Bits$$module$bits.bits(d[a]))b.push(this.item(c));e.push("("+b.join(" & ")+")")}a.push(`${c}: ${e.join(" | ")}`)}return a.join("\n")}assumedFill(a,
b=(a,b)=>!0,c=FillStrategy$$module$nodes){const d=c.shuffleItems(this.itemToUid.map((a)=>this.worldGraph.nodes[a]),a);let e=Bits$$module$bits.from(d);const f=Array(this.locationToUid.length).fill(null);for(;d.length;){const g=d.pop();if(!Bits$$module$bits.has(e,g))continue;const h=this.item(g);e=Bits$$module$bits.without(e,g);const k=[...this.traverse(e,f)].filter((a)=>null==f[a]);c.shuffleSlots(h,k,a);let l=!1;for(const a of k)if(null==f[a]&&a!==this.win&&b(this.location(a),h)){if(100<a)throw Error("Something went horribly wrong");
f[a]=g;l=!0;break}if(!l)return null}return f}}const FillStrategy$$module$nodes={shuffleSlots:(a,b,c)=>{c.shuffle(b)},shuffleItems:(a,b)=>{const c=[];for(let b=0;b<a.length;b++){const {shufflePriority:d=1}=a[b];for(let a=0;a<d;a++)c.push(b)}b.shuffle(c);return c}},write$$module$nodes=(a,b,c)=>{a[b]=c};function getFirst$$module$nodes(a){for(const b of a)return b;throw Error("Empty iterable");}function setItem$$module$nodes(a,b){return 0>a?~(512|b.itemIndex):512|b.itemIndex}var module$nodes={};
module$nodes.TrackerNode=TrackerNode$$module$nodes;module$nodes.Option=Option$$module$nodes;module$nodes.Slot=Slot$$module$nodes;module$nodes.FixedSlot=FixedSlot$$module$nodes;module$nodes.BossDrop=BossDrop$$module$nodes;module$nodes.Chest=Chest$$module$nodes;module$nodes.ItemGet=ItemGet$$module$nodes;module$nodes.Item=Item$$module$nodes;module$nodes.Magic=Magic$$module$nodes;module$nodes.Trigger=Trigger$$module$nodes;module$nodes.Condition=Condition$$module$nodes;module$nodes.Boss=Boss$$module$nodes;
module$nodes.Area=Area$$module$nodes;module$nodes.Connection=Connection$$module$nodes;module$nodes.Location=Location$$module$nodes;module$nodes.WorldGraph=WorldGraph$$module$nodes;module$nodes.LocationList=LocationList$$module$nodes;module$nodes.FillStrategy=FillStrategy$$module$nodes;const generate$$module$depgraph=(a,b)=>{a=void 0===a?new FlagSet$$module$flagset:a;const c=new WorldGraph$$module$nodes(b),d=(a,b)=>new Option$$module$nodes(c,a,void 0===b?!0:b),e=(a,b,...d)=>new Boss$$module$nodes(c,a,b,...d),f=new TrackerNode$$module$nodes(c,TrackerNode$$module$nodes.GLITCH,"Glitch"),g=new TrackerNode$$module$nodes(c,TrackerNode$$module$nodes.HARD,"Hard"),h=(a,b,c)=>a.value?a:f,k=d("Leather Boots grant speed",a.leatherBootsGiveSpeed()),l=h(d("Assume ghetto flight",a.assumeGhettoFlight())),
m=h(d("Assume statue glitch",a.assumeStatueGlitch())),n=d("Allow statue glitch",!a.disableStatueGlitch()),p=h(d("Assume teleport skip",a.assumeTeleportSkip())),q=d("Allow teleport skip",!a.disableTeleportSkip()),r=h(d("Assume rabbit skip",a.assumeRabbitSkip())),u=h(d("Allow rabbit skip",!a.disableRabbitSkip())),z=h(d("Assume sword charge glitch",a.assumeSwordChargeGlitch())),V=d("Allow sword charge glitch",!a.disableSwordChargeGlitch()),va=h(d("Assume wild warp",a.assumeWildWarp())),oa=d("Allow wild warp",
a.allowWildWarp()),F=d("Sword magic optional",!a.guaranteeSwordMagic()),H=d("Matching sword optional",!a.guaranteeMatchingSword()),Qa=d("Gas mask optional",!a.guaranteeGasMask()),Pd=d("Healed dolphin optional",!a.requireHealedDolphinToRide()),Qd=d("Calm sea optional",!a.barrierRequiresCalmSea()),Rd=d("Prison key optional",!a.paralysisRequiresPrisonKey()),Sd=d("Windmill optional",!a.sealedCaveRequiresWindmill()),Td=d("Sword of Thunder teleports to Shyron",a.teleportOnThunderSword()),Wb=d("Barrier magic optional",
!a.guaranteeBarrier()),Xb=d("Refresh magic optional",!a.guaranteeRefresh()),Ud=d("Telepathy optional for Deo",!a.saharaRabbitsRequireTelepathy()),Vd=d("Lime Tree connects to Leaf",a.connectLimeTreeToLeaf()),Wd=d("Buffed medical herb",a.buffMedicalHerb()),Ra=d("Orbs optional",a.orbsOptional()),P=(new Item$$module$nodes(c,0,"Sword of Wind")).weight(a.guaranteeSword()?10:5).fromPerson("Leaf elder",13).npcSpawn(94,16,1).dialog(13,192,2).key(),Q=(new Item$$module$nodes(c,1,"Sword of Fire")).weight(a.guaranteeSword()?
10:5).fromPerson("Oak elder",29).dialog(29,void 0,3).key(),L=(new Item$$module$nodes(c,2,"Sword of Water")).weight(10).chest().key(),J=(new Item$$module$nodes(c,3,"Sword of Thunder")).weight(15).chest().key(),pb=(new Item$$module$nodes(c,4,"Crystalis")).fixed(),Ia=(new Item$$module$nodes(c,5,"Ball of Wind")).chest().key(),Ja=(new Item$$module$nodes(c,6,"Tornado Bracelet")).chest().key(),Sa=(new Item$$module$nodes(c,7,"Ball of Fire")).bossDrop("Insect",1).dialog(30,void 0,2).dialog(32,void 0,0).dialog(33,
void 0,0).dialog(34,void 0,0).dialog(96,30,0).dialog(29,void 0,2).dialog(31,void 0,0).npcSpawn(193).key(),Ta=(new Item$$module$nodes(c,8,"Flame Bracelet")).bossDrop("Kelbesque 1",2).npcSpawn(194).key(),Ua=(new Item$$module$nodes(c,9,"Ball of Water")).weight(5).direct("Rage",250679).npcSpawn(195).key(),Va=(new Item$$module$nodes(c,10,"Blizzard Bracelet")).weight(5).chest().key(),Wa=(new Item$$module$nodes(c,11,"Ball of Thunder")).bossDrop("Mado 1",5).trigger(154,1).key(),Xa=(new Item$$module$nodes(c,
12,"Storm Bracelet")).chest().key(),Yb=(new Item$$module$nodes(c,13,"Carapace Shield")).armor(),Xd=(new Item$$module$nodes(c,14,"Bronze Shield")).armor(),Zb=(new Item$$module$nodes(c,15,"Platinum Shield")).armor(),$b=(new Item$$module$nodes(c,16,"Mirrored Shield")).armor(),Yd=(new Item$$module$nodes(c,17,"Ceramic Shield")).armor(),qb=(new Item$$module$nodes(c,18,"Sacred Shield")).armor().bossDrop("Mado 2",8).npcSpawn(199).bonus(),ac=(new Item$$module$nodes(c,19,"Battle Shield")).armor(),Zd=(new Item$$module$nodes(c,
20,"Psycho Shield")).armor(),$d=(new Item$$module$nodes(c,21,"Tanned Hide")).armor(),ae=(new Item$$module$nodes(c,22,"Leather Armor")).armor(),be=(new Item$$module$nodes(c,23,"Bronze Armor")).armor(),bc=(new Item$$module$nodes(c,24,"Platinmum Armor")).armor(),ce=(new Item$$module$nodes(c,25,"Soldier Suit")).armor(),cc=(new Item$$module$nodes(c,26,"Ceramic Suit")).armor(),de=(new Item$$module$nodes(c,27,"Battle Suit")).armor(),ee=(new Item$$module$nodes(c,28,"Psycho Armor")).armor().bossDrop("Draygon 1",
10).npcSpawn(203).trigger(159).npcSpawn(131).key(),E=(new Item$$module$nodes(c,29,"Medical Herb")).consumable(),K=(new Item$$module$nodes(c,30,"Antidote")).consumable(),wa=(new Item$$module$nodes(c,31,"Lysis Plant")).consumable(),rb=(new Item$$module$nodes(c,32,"Fruit of Lime")).consumable(),M=(new Item$$module$nodes(c,33,"Fruit of Power")).consumable(),W=(new Item$$module$nodes(c,34,"Magic Ring")).consumable(),sb=(new Item$$module$nodes(c,35,"Fruit of Repun")).consumable().bossDrop("Sabera 2",7).npcSpawn(198).key(),
R=(new Item$$module$nodes(c,36,"Warp Boots")).consumable(),dc=(new Item$$module$nodes(c,37,"Statue of Onyx")).chest("Cordel grass").invisible(254882).key(),tb=(new Item$$module$nodes(c,38,"Opel Statue")).consumable().bossDrop("Kelbesque 2",6).npcSpawn(197).key(),ec=(new Item$$module$nodes(c,39,"Insect Flute")).fromPerson("Oak mother",30).dialog(30,void 0,1).key(),ub=(new Item$$module$nodes(c,40,"Flute of Lime")).fromPerson("Portoa queen",56).fromPerson("Asina secondary",98,1).dialog(56,void 0,4).key(),
Ya=(new Item$$module$nodes(c,41,"Gas Mask")).direct("Akahana in Brynmaer",251902).npcSpawn(22,24).key(),fe=(new Item$$module$nodes(c,42,"Power Ring")).chest().bonus(),ge=(new Item$$module$nodes(c,43,"Warrior Ring")).fromPerson("Akahana's friend",84).dialog(84,void 0,2).bonus(),he=(new Item$$module$nodes(c,44,"Iron Necklace")).chest().bonus(),ie=(new Item$$module$nodes(c,45,"Deo's Pendant")).fromPerson("Deo",90).dialog(90,void 0,0).bonus(),vb=(new Item$$module$nodes(c,46,"Rabbit Boots")).bossDrop("Vampire 1",
0).npcSpawn(192).key(),fc=((a,b)=>new Item$$module$nodes(c,a,b))(47,a.leatherBootsGiveSpeed()?"Speed Boots":"Leather Boots").chest().bonus(),gc=(new Item$$module$nodes(c,48,"Shield Ring")).direct("Akahana in waterfall cave",250543).bonus(),wb=(new Item$$module$nodes(c,49,"Alarm Flute")).fromPerson("Zebu's student",20,1).key(),hc=(new Item$$module$nodes(c,50,"Windmill Key")).fromPerson("Windmill guard",20).dialog(20,14,0).npcSpawn(20,14,1).key(),xb=(new Item$$module$nodes(c,51,"Key to Prison")).chest().key(),
ic=(new Item$$module$nodes(c,52,"Key to Styx")).fromPerson("Zebu in Shyron",94,1).trigger(128,2).dialog(94,242,0).dialog(98,242,0).key(),jc=(new Item$$module$nodes(c,53,"Fog Lamp")).chest().key(),yb=(new Item$$module$nodes(c,54,"Shell Flute")).fromPerson("Dolphin",99,1).npcSpawn(99).key(),kc=(new Item$$module$nodes(c,55,"Eye Glasses")).fromPerson("Clark",68).dialog(68,233,1).key(),lc=(new Item$$module$nodes(c,56,"Broken Statue")).bossDrop("Sabera 1",4).npcSpawn(127,101).npcSpawn(9).npcSpawn(10).npcSpawn(69).npcSpawn(70).npcSpawn(71).npcSpawn(132).npcSpawn(142).dialog(61).dialog(62).dialog(63).dialog(64).dialog(65).dialog(66).dialog(67).dialog(68,
233).trigger(182).key(),mc=(new Item$$module$nodes(c,57,"Glowing Lamp")).direct("Kensu in lighthouse",250638).npcSpawn(126,98,1).key(),nc=(new Item$$module$nodes(c,59,"Love Pendant")).chest("Underground channel").invisible(254890).key(),oc=(new Item$$module$nodes(c,60,"Kirisa Plant")).chest("Kirisa meadow").invisible(254886).key(),zb=(new Item$$module$nodes(c,61,"Ivory Statue")).bossDrop("Karmine",9).npcSpawn(200).key(),pc=(new Item$$module$nodes(c,62,"Bow of Moon")).fromPerson("Aryllis",35).direct(251624).dialog(35,
void 0,1).key(),qc=(new Item$$module$nodes(c,63,"Bow of Sun")).chest().key(),rc=(new Item$$module$nodes(c,64,"Bow of Truth")).fromPerson("Azteca",131).npcSpawn(131,156,1).dialog(131,void 0,0).key(),Za=(new Magic$$module$nodes(c,65,"Refresh")).fromPerson("Zebu at windmill",94).requireUnique().direct(251665).dialog(94,16,3).trigger(180,1),Ka=(new Magic$$module$nodes(c,66,"Paralysis")).direct("Zebu at Mt. Sabre summit",251477).requireUnique().trigger(141).trigger(178),fa=(new Magic$$module$nodes(c,67,
"Telepathy")).direct("Tornel at Stom's house",223220).npcSpawn(95,30,1).trigger(133,1),sc=(new Magic$$module$nodes(c,68,"Teleport")).fromPerson("Tornel on Mt. Sabre",95).dialog(95,33,0),je=(new Magic$$module$nodes(c,69,"Recover")).direct("Asina in Portoa",250361),tc=(new Magic$$module$nodes(c,70,"Barrier")).direct("Asina on Angry sea",251609).requireUnique().trigger(132,0),pa=(new Magic$$module$nodes(c,71,"Change")).direct("Kensu in Swan",251614).npcSpawn(116,241,1).npcSpawn(126,241,1),B=(new Magic$$module$nodes(c,
72,"Flight")).weight(15).direct("Kensu in Draygonia Fortress",250255),ke=M.bossDrop("Vampire 2",12,97).npcSpawn(204).key(),N=new Item$$module$nodes(c,112,"Mimic"),uc=(new Trigger$$module$nodes(c,"Talked to Leaf Elder")).get(P),vc=(new Trigger$$module$nodes(c,"Talked to Leaf Student")).get(wb),Ab=new Trigger$$module$nodes(c,"Talked to Zebu in cave"),le=(new Trigger$$module$nodes(c,"Woke up Windmill Guard")).get(hc),La=new Trigger$$module$nodes(c,"Started Windmill"),wc=(new Trigger$$module$nodes(c,
"Learned Refresh")).get(Za),me=(new Trigger$$module$nodes(c,"Gave Statue to Akahana")).get(Ya),ne=(new Trigger$$module$nodes(c,"Fought Stom")).get(fa),xc=new Trigger$$module$nodes(c,"Visited Oak"),yc=new Trigger$$module$nodes(c,"Talked to Oak Mother"),Bb=new Trigger$$module$nodes(c,"Rescued Oak Child"),oe=(new Trigger$$module$nodes(c,"Talked to Oak Mother Again")).get(ec),pe=(new Trigger$$module$nodes(c,"Talked to Oak Elder")).get(Q),qe=(new Trigger$$module$nodes(c,"Talked to Tornel on Mt Sabre")).get(sc),
zc=new Trigger$$module$nodes(c,"Villagers Abducted"),Ac=new Trigger$$module$nodes(c,"Talked to Rabbit in Leaf"),re=(new Trigger$$module$nodes(c,"Learned Paralysis")).get(Ka),Bc=new Trigger$$module$nodes(c,"Talked to Portoa Queen"),Cc=new Trigger$$module$nodes(c,"Talked to Fortune Teller"),Dc=new Trigger$$module$nodes(c,"Visited Underground Channel"),se=(new Trigger$$module$nodes(c,"Sent to Waterfall Cave")).get(ub),te=(new Trigger$$module$nodes(c,"Cured Akahana")).get(gc),Ec=(new Trigger$$module$nodes(c,
"Talked to Rage")).get(Ua),Fc=new Trigger$$module$nodes(c,"Mesia recording played"),Gc=(new Trigger$$module$nodes(c,"Talked to Asina")).get(je),Hc=(new Trigger$$module$nodes(c,"Healed Dolphin")).get(yb),Cb=new Trigger$$module$nodes(c,"Returned Fog Lamp"),Ic=new Trigger$$module$nodes(c,"Talked to Kensu in Cabin"),Jc=new Trigger$$module$nodes(c,"Talked to Joel Elder"),ue=(new Trigger$$module$nodes(c,"Talked to Clark")).get(kc),ve=(new Trigger$$module$nodes(c,"Talked to Kensu in Lighthouse")).get(mc),
Db=new Trigger$$module$nodes(c,"Calmed the Angry Sea"),we=(new Trigger$$module$nodes(c,"Learned Barrier")).get(tc),Kc=new Trigger$$module$nodes(c,"Talked to Stom in Swan Hut"),Lc=new Trigger$$module$nodes(c,"Talked to Kensu in Swan tavern"),Mc=new Trigger$$module$nodes(c,"Talked to Kensu at Swan dance"),xe=(new Trigger$$module$nodes(c,"Returned Kensu's love pendant")).get(pa),ye=(new Trigger$$module$nodes(c,"Talked to Amazones Queen")).get(pc),Eb=new Trigger$$module$nodes(c,"Entered Shyron"),ze=(new Trigger$$module$nodes(c,
"Talked to Zebu in Shyron")).get(ic),Nc=new Trigger$$module$nodes(c,"Shyron Massacre"),Ae=(new Trigger$$module$nodes(c,"Saved Kensu")).get(B),Be=(new Trigger$$module$nodes(c,"Talked to Deo")).get(ie),Ce=(new Trigger$$module$nodes(c,"Talked to Akahana's Friend")).get(ge),De=(new Trigger$$module$nodes(c,"Get Bow of Truth")).get(rc),Ee=(new Trigger$$module$nodes(c,"Forged Crystalis")).get(pb),$a=(new Condition$$module$nodes(c,"Sword charge glitch")).option(z,V),Fe=(new Condition$$module$nodes(c,"Rabbit skip")).option(r,
u),Ge=(new Condition$$module$nodes(c,"Teleport skip")).option(p,q),ab=(new Condition$$module$nodes(c,"Statue glitch")).option(m,n),He=(new Condition$$module$nodes(c,"Wild warp")).option(va,oa),bb=(new Condition$$module$nodes(c,"Any level 2 sword")).option(P,Ia).option(P,Ja).option(Q,Sa).option(Q,Ta).option(L,Ua).option(L,Va).option(J,Wa).option(J,Xa),w=(new Condition$$module$nodes(c,"Destroy stone")).option(P,Ra).option(P,Ia).option(P,Ja).option($a,P,bb),x=(new Condition$$module$nodes(c,"Destroy ice")).option(Q,
Ra).option(Q,Sa).option(Q,Ta).option($a,Q,bb),t=(new Condition$$module$nodes(c,"Cross rivers")).option(L,Ra).option(L,Ua).option(L,Va).option(B).option($a,L,bb),xa=(new Condition$$module$nodes(c,"Destroy iron")).option(J,Ra).option(J,Wa).option(J,Xa).option($a,J,bb),S=(new Condition$$module$nodes(c,"Any sword")).option(P).option(Q).option(L).option(J),Ie=(new Condition$$module$nodes(c,"Match insect sword (fire/water/thunder)")).option(Q).option(L).option(J).option(Ya,H.value?H:g,P),Je=(new Condition$$module$nodes(c,
"Match vampire 2 sword (wind/water/thunder)")).option(P).option(L).option(J).option(H.value?H:g,Q),Oc=(new Condition$$module$nodes(c,"Speed boots")).option(fc,k),Pc=(new Condition$$module$nodes(c,"Climb slopes")).option(vb).option(B).option(Oc),Ke=(new Condition$$module$nodes(c,"Enter Mt Sabre North (rabbit)")).option(Ac).option(Fe),Le=(new Condition$$module$nodes(c,"Enter Mt Sabre North (Teleport)")).option(sc).option(Ge,B),Qc=(new Condition$$module$nodes(c,"Asina in her room")).option(Fc),Me=(new Condition$$module$nodes(c,
"Paralysis or Asina revealed")).option(Ka).option(Qc).option(ab),Rc=(new Condition$$module$nodes(c,"Ride dolphin")).option(yb,Ic),Ne=(new Condition$$module$nodes(c,"Ghetto flight")).option(l,Rc,vb),ba=(new Condition$$module$nodes(c,"Cross sea")).option(Rc).option(B),Oe=(new Condition$$module$nodes(c,"Cross whirlpool")).option(Db).option(B).option(Ne),T=(new Condition$$module$nodes(c,"Refresh if needed")).option(Xb.value?Xb:g).option(Za),Sc=(new Condition$$module$nodes(c,"Wind magic")).option(F.value?
F:g,T).option(Ia,Ja,T),Tc=(new Condition$$module$nodes(c,"Fire magic")).option(F.value?F:g,T).option(Sa,Ta,T),Uc=(new Condition$$module$nodes(c,"Water magic")).option(F.value?F:g,T).option(F,T).option(Ua,Va,T),Pe=(new Condition$$module$nodes(c,"Thunder magic")).option(F.value?F:g,T).option(F,T).option(Wa,T).option(Xa,T),Qe=(new Condition$$module$nodes(c,"Flute of lime or glitch")).option(ub).option(ab),Re=(new Condition$$module$nodes(c,"Change or glitch")).option(pa).option(ab),Se=(new Condition$$module$nodes(c,
"Change or glitch or paralysis")).option(pa).option(ab).option(Ka),Fb=(new Condition$$module$nodes(c,"Pass shooting statues")).option(tc).option(S,Wb.value?Wb:g).option(Za,gc),Te=(new Condition$$module$nodes(c,"Healed dolphin if required")).option(Hc).option(Pd),Vc=(new Condition$$module$nodes(c,"Match sword of wind")).option(P).option(H.value?H:g,S),Wc=(new Condition$$module$nodes(c,"Match sword of fire")).option(Q).option(H.value?H:g,S),Xc=(new Condition$$module$nodes(c,"Match sword of water")).option(L).option(H.value?
H:g,S),Ue=(new Condition$$module$nodes(c,"Match sword of thunder")).option(J).option(H.value?H:g,S),Ve=(new Condition$$module$nodes(c,"Swamp run possible")).option(S,Oc).option(S,Wd).option(S,Za),We=(new Condition$$module$nodes(c,"Insect possible to kill")).option(Ya),cb=(new Condition$$module$nodes(c,"Travel swamp")).option(Ya).option(Qa.value?Qa:g,Ve),Xe=(new Condition$$module$nodes(c,"Calmed sea if required")).option(Db).option(Qd),Ye=(new Condition$$module$nodes(c,"Started windmill if required")).option(La).option(Sd),
Ze=(new Condition$$module$nodes(c,"Telepathy if required for Deo")).option(fa).option(Ud),$e=e(0,"Vampire 1",S).get(vb),af=e(1,"Insect",ec,Ie,We).get(Sa),bf=e(2,"Kelbesque 1",Vc,Sc).get(Ta),cf=e(12,"Vampire 2",Je).get(ke),Yc=e(4,"Sabera 1",Wc,Tc).get(lc),df=e(5,"Mado 1",Xc,Uc).get(Wa),ef=e(6,"Kelbesque 2",Vc,Sc).get(tb),ff=e(7,"Sabera 2",Wc,Tc).get(sb),gf=e(8,"Mado 2",Xc,Uc).get(qb),hf=e(9,"Karmine",Ue,Pe).get(zb),jf=e(10,"Draygon 1",S).get(ee),kf=e(-1,"Statues",qc,pc),lf=e(11,"Draygon 2",S,rc),mf=
e(13,"Dyna",pb),nf=(new Condition$$module$nodes(c,"Opened prison if required")).option(xb).option(Rd),X=new Area$$module$nodes(c,"Leaf"),ya=new Area$$module$nodes(c,"Valley of Wind"),U=new Area$$module$nodes(c,"Sealed Cave"),qa=new Area$$module$nodes(c,"Cordel Plain"),za=new Area$$module$nodes(c,"Brynmaer"),Aa=new Area$$module$nodes(c,"Amazones"),C=new Area$$module$nodes(c,"Mt Sabre West"),v=new Area$$module$nodes(c,"Mt Sabre North"),db=new Area$$module$nodes(c,"Nadare's"),Ma=new Area$$module$nodes(c,
"Oak"),ha=new Area$$module$nodes(c,"Waterfall Valley"),A=new Area$$module$nodes(c,"Portoa"),ia=new Area$$module$nodes(c,"Waterfall Cave"),D=new Area$$module$nodes(c,"Fog Lamp Cave"),ja=new Area$$module$nodes(c,"Kirisa Plant Cave"),ra=new Area$$module$nodes(c,"Angry Sea"),ka=new Area$$module$nodes(c,"Joel"),I=new Area$$module$nodes(c,"Evil Spirit Island"),la=new Area$$module$nodes(c,"Sabera's Castle"),Y=new Area$$module$nodes(c,"Swan"),y=new Area$$module$nodes(c,"Mt Hydra"),ma=new Area$$module$nodes(c,
"Shyron"),sa=new Area$$module$nodes(c,"Styx"),ta=new Area$$module$nodes(c,"Goa"),eb=new Area$$module$nodes(c,"Draygonia Fortress 1"),Z=new Area$$module$nodes(c,"Draygonia Fortress 2"),Ba=new Area$$module$nodes(c,"Draygonia Fortress 3"),O=new Area$$module$nodes(c,"Draygonia Fortress 4"),G=new Area$$module$nodes(c,"Oasis Cave"),aa=new Area$$module$nodes(c,"Sahara"),Ca=new Area$$module$nodes(c,"Pyramid Front"),ca=new Area$$module$nodes(c,"Pyramid Back"),da=new Area$$module$nodes(c,"Tower"),Gb=(new Location$$module$nodes(c,
0,X,"Start")).overworld().start(),of=(new Location$$module$nodes(c,0,X,"Mezame Shrine")).overworld().from(Gb),pf=(new Location$$module$nodes(c,1,X,"Outside Start")).overworld().connect(of),na=(new Location$$module$nodes(c,2,X,"Town")).town().connect(pf),Na=(new Location$$module$nodes(c,3,ya,"Main")).overworld().connect(na).trigger(wc,La),Zc=(new Location$$module$nodes(c,3,ya,"Outside Windmill")).overworld(),$c=(new Location$$module$nodes(c,4,U,"Tunnel 1 (entrance)")).cave().from(Na,La),qf=(new Location$$module$nodes(c,
5,U,"Tunnel 2 (over bridge)")).cave().connect($c),rf=(new Location$$module$nodes(c,6,U,"Tunnel 6 (herb dead end)")).cave().chest(E,15),ad=(new Location$$module$nodes(c,7,U,"Tunnel 4a (ball corridor)")).cave().chest(E,20,80).chest(Ia,21);(new Location$$module$nodes(c,7,U,"Tunnel 4b (antidote dead end)")).cave().connect(ad,w).chest(K,19);const sf=(new Location$$module$nodes(c,8,U,"Tunnel 5 (warp boots dead end)")).cave().chest(R,14),tf=(new Location$$module$nodes(c,9,U,"Tunnel 3a (branch, front)")).cave().connect(qf).connectTo(ad).connectTo(sf),
uf=(new Location$$module$nodes(c,9,U,"Tunnel 3b (branch, back)")).cave().connect(tf,w).connectTo(rf),vf=(new Location$$module$nodes(c,10,U,"Tunnel 7 (boss)")).cave().connect(uf).boss($e),wf=(new Location$$module$nodes(c,12,U,"Tunnel 8a (exit, above wall)")).cave().connect(vf),xf=(new Location$$module$nodes(c,12,U,"Tunnel 8b (exit, below wall")).cave().connect(wf,w);(new Location$$module$nodes(c,14,ya,"Windmill Cave")).cave().connect(Na).connectTo(Zc).trigger(le,wb,Ab);(new Location$$module$nodes(c,
15,ya,"Windmill")).misc().connect(Zc).trigger(La,hc);const yf=(new Location$$module$nodes(c,16,ya,"Zebu's Cave Front")).cave().connect(Na).trigger(Ab,uc,vc).trigger(wc,La,Ab),zf=(new Location$$module$nodes(c,16,ya,"Zebu's Cave Back")).cave().trigger(zc).connect(yf,x),Af=(new Location$$module$nodes(c,17,C,"Tunnel 1 (to Zebu)")).cave().connect(zf),Da=(new Location$$module$nodes(c,20,qa,"West")).overworld().connect(xf,Ye),Bf=(new Location$$module$nodes(c,20,qa,"South")).overworld().connect(Da,t),bd=
(new Location$$module$nodes(c,21,qa,"East")).overworld().connect(Da).chest(dc,24),Oa=(new Location$$module$nodes(c,24,za,"Town")).town().connect(Da).trigger(me,dc),Cf=(new Location$$module$nodes(c,25,qa,"Outside Stom's House")).town().connect(Da),Hb=(new Location$$module$nodes(c,26,qa,"Swamp")).overworld().connect(bd,cb).trigger(Bb,yc,cb);(new Location$$module$nodes(c,26,qa,"Swamp Insect Area")).overworld().connect(Hb,cb).boss(af);const fb=(new Location$$module$nodes(c,27,Aa,"Town")).town().connect(Bf),
gb=(new Location$$module$nodes(c,28,Ma,"Town")).town().connect(Hb,cb).trigger(xc);(new Location$$module$nodes(c,30,qa,"Stom's House")).house().connect(Cf).trigger(ne,xc);const Ea=(new Location$$module$nodes(c,32,C,"Entrance")).overworld().connect(Da).connect(Af),Df=(new Location$$module$nodes(c,32,C,"Up Slope")).overworld().from(Ea,Pc).to(Ea),Ef=(new Location$$module$nodes(c,32,C,"Dead End (warp boots)")).overworld().chest(R,24,106),cd=(new Location$$module$nodes(c,33,C,"Upper")).overworld().from(Ea,
B).to(Ea),Ff=(new Location$$module$nodes(c,33,C,"Tornel Dead End")).overworld().trigger(qe,Ia,Ja).chest(W,23,105),dd=(new Location$$module$nodes(c,34,C,"Tunnel 2a (fork at start)")).cave().connect(Ea);(new Location$$module$nodes(c,34,C,"Tunnel 2b (left branch to dead end)")).cave().connect(dd,x).connectTo(Ef);const Gf=(new Location$$module$nodes(c,34,C,"Tunnel 2c (right branch to upper)")).cave().connect(dd,x),Hf=(new Location$$module$nodes(c,35,C,"Tunnel 3a (tunnel to upper, with herb chest)")).cave().connect(Gf).chest(E,
23,82),If=(new Location$$module$nodes(c,35,C,"Tunnel 3b (tunnel to upper, branch below ice)")).cave().connect(Hf,x).connectTo(cd),ed=(new Location$$module$nodes(c,36,C,"Tunnel 4a (branch to upper or Tornel)")).cave().connect(If);(new Location$$module$nodes(c,36,C,"Tunnel 4b (out to upper)")).cave().connect(ed,x).connectTo(cd);const Jf=(new Location$$module$nodes(c,37,C,"Tunnel 5 (tiny connector)")).cave().connect(ed),Kf=(new Location$$module$nodes(c,38,C,"Tunnel 6a (exit to Tornel, above ice)")).cave().connect(Jf);
(new Location$$module$nodes(c,38,C,"Tunnel 6b (exit to Tornel, below ice)")).cave().connect(Kf,x).connectTo(Ff);const Lf=(new Location$$module$nodes(c,39,C,"Tunnel 7a (tornado bracelet, lower)")).cave().connect(Df),Mf=(new Location$$module$nodes(c,39,C,"Tunnel 7b (tornado bracelet, middle)")).cave().connect(Lf,x);(new Location$$module$nodes(c,39,C,"Tunnel 7c (tornado bracelet, upper)")).cave().connect(Mf,x).chest(Ja,25);const hb=(new Location$$module$nodes(c,40,v,"Entrance")).overworld().connect(bd,
Le,Ke),ib=(new Location$$module$nodes(c,40,v,"Upper")).overworld().from(hb,B).to(hb),Ib=(new Location$$module$nodes(c,40,v,"Summit (boss)")).overworld().from(ib,B).to(ib).boss(bf),fd=(new Location$$module$nodes(c,41,v,"Connector")).overworld(),Jb=(new Location$$module$nodes(c,41,v,"Middle Left")).overworld(),Nf=(new Location$$module$nodes(c,41,v,"Middle Right")).overworld().from(Jb,Pc).to(Jb),gd=(new Location$$module$nodes(c,42,v,"Tunnel 2a (from entrance to connector)")).cave().connectTo(fd);(new Location$$module$nodes(c,
42,v,"Tunnel 2b (under bridge, to antidote)")).cave().connect(gd,x).chest(K,23,94);const hd=(new Location$$module$nodes(c,43,v,"Tunnel 3a (branch after connector)")).cave().connect(fd),Of=(new Location$$module$nodes(c,43,v,"Tunnel 3b (right branch)")).cave().connect(hd,x),Pf=(new Location$$module$nodes(c,43,v,"Tunnel 3c (upper branch)")).cave().connect(hd,x);(new Location$$module$nodes(c,44,v,"Tunnel 4 (over bridge, to middle)")).cave().connect(Pf).connectTo(Jb);const id=(new Location$$module$nodes(c,
45,v,"Tunnel 5a (E-shaped, from right branch)")).cave().connect(Of).connectTo(Nf);(new Location$$module$nodes(c,45,v,"Tunnel 5b (dead-end with herb)")).cave().connect(id,x).chest(E,22,83);const Qf=(new Location$$module$nodes(c,46,v,"Tunne; 6a (S-shaped hall, right)")).cave().connect(id),Rf=(new Location$$module$nodes(c,46,v,"Tunne; 6b (S-shaped hall, middle)")).cave().connect(Qf,x),Sf=(new Location$$module$nodes(c,46,v,"Tunnel 6c (S-shaped hall, left)")).cave().connect(Rf,x),jd=(new Location$$module$nodes(c,
47,v,"Prison (hallway)")).cave().connect(ib),Tf=(new Location$$module$nodes(c,48,v,"Left Cell (shopkeepers)")).cave().from(jd,x);(new Location$$module$nodes(c,49,v,"Left Cell 2 (back, with prison key)")).cave().from(Tf,x).chest(xb,13);const Uf=(new Location$$module$nodes(c,50,v,"Right Cell (villagers)")).cave().from(jd,x),Vf=(new Location$$module$nodes(c,51,v,"Tunnel 8 (behind right cell, toward summit)")).cave().from(Uf,x);(new Location$$module$nodes(c,52,v,"Tunnel 9 (connector to summit)")).cave().connect(Vf).connectTo(Ib);
const Wf=(new Location$$module$nodes(c,53,v,"Summit Cave (front)")).cave().from(Ib,xb).to(Ib),Xf=(new Location$$module$nodes(c,53,v,"Summit Cave (behind ice)")).cave().connect(Wf,x).trigger(re);(new Location$$module$nodes(c,56,v,"Tunnel 1 (leads from main entrance)")).cave().connect(hb).connectTo(gd);(new Location$$module$nodes(c,57,v,"Tunnel 7 (to upper)")).cave().connect(Sf).connectTo(ib);const Yf=(new Location$$module$nodes(c,60,db,"Inn")).shop(),Zf=(new Location$$module$nodes(c,61,db,"Tool Shop")).shop(E,
K,M,R),$f=(new Location$$module$nodes(c,62,db,"Back Room")).house(),Kb=(new Location$$module$nodes(c,64,ha,"Summit")).overworld().connect(Xf,nf),jb=(new Location$$module$nodes(c,64,ha,"Northwest")).overworld().from(Kb).to(Kb,B),ag=(new Location$$module$nodes(c,64,ha,"Northeast")).overworld().connect(jb,t),kd=(new Location$$module$nodes(c,65,ha,"Southwest")).overworld().connect(jb),bg=(new Location$$module$nodes(c,65,ha,"Southeast")).overworld().connect(kd,t),ld=(new Location$$module$nodes(c,66,ha,
"Lime Tree Valley")).overworld().connect(kd).connect(Na,Vd),cg=(new Location$$module$nodes(c,67,ha,"Lime Tree Lake (Rage)")).cave().connect(ld).trigger(Ec,L),dg=(new Location$$module$nodes(c,68,ja,"Tunnel 1a (entrance)")).cave().connect(bg),eg=(new Location$$module$nodes(c,68,ja,"Tunnel 1b (behind wall)")).cave().connect(dg,w),md=(new Location$$module$nodes(c,69,ja,"Tunnel 2a (main path, before wall)")).cave().connect(eg);(new Location$$module$nodes(c,69,ja,"Tunnel 2b (dead end, antidote)")).cave().connect(md,
w).chest(K,25,95);const fg=(new Location$$module$nodes(c,69,ja,"Tunnel 2c (main path, after wall)")).cave().connect(md,w),gg=(new Location$$module$nodes(c,70,ja,"Tunnel 3a (last room, before wall)")).cave().connect(fg),hg=(new Location$$module$nodes(c,70,ja,"Tunnel 3b (last room, after wall)")).cave().connect(gg,w);(new Location$$module$nodes(c,71,ja,"Meadow")).overworld().connect(hg).chest(oc,14);const ig=(new Location$$module$nodes(c,72,D,"Tunnel 1a (entrance)")).cave().connect(ag),nd=(new Location$$module$nodes(c,
72,D,"Tunnel 1b (past wall)")).cave().connect(ig,w);(new Location$$module$nodes(c,72,D,"Tunnel 1c (dead end, lysisPlant)")).cave().connect(nd,w).chest(wa,24);const jg=(new Location$$module$nodes(c,73,D,"Tunnel 2 (tiny connector)")).cave().connect(nd),od=(new Location$$module$nodes(c,74,D,"Tunnel 3a (upper branch)")).cave().connect(jg);(new Location$$module$nodes(c,74,D,"Tunnel 3b (dead end, mimic)")).cave().connect(od,w).chest(N,21,112);const pd=(new Location$$module$nodes(c,74,D,"Tunnel 3c (short passage with mimic)")).cave().connect(od,
w).chest(N,22,113),kg=(new Location$$module$nodes(c,74,D,"Tunnel 3d (lower branch)")).cave().connect(pd,w);(new Location$$module$nodes(c,75,D,"Dead end loop")).cave().connect(kg);const qd=(new Location$$module$nodes(c,76,D,"Tunnel 4a (right branch over bridge)")).cave().connect(pd),lg=(new Location$$module$nodes(c,76,D,"Tunnel 4b (past wall over bridge)")).cave().connect(qd,w),mg=(new Location$$module$nodes(c,77,D,"Tunnel 5a (from left branch)")).cave().connect(qd),ng=(new Location$$module$nodes(c,
77,D,"Tunnel 5b (reconvergence)")).cave().connect(mg,w).connect(lg),og=(new Location$$module$nodes(c,77,D,"Tunnel 5c (between walls)")).cave().connect(ng,w),pg=(new Location$$module$nodes(c,77,D,"Tunnel 5d (under bridge)")).cave().connect(og,w),qg=(new Location$$module$nodes(c,78,D,"Tunnel 6a (over second bridge)")).cave().connect(pg),rg=(new Location$$module$nodes(c,78,D,"Tunnel 6b (past wall)")).cave().connect(qg,w),sg=(new Location$$module$nodes(c,79,D,"Tunnel 7a (under second bridge)")).cave().connect(rg);
(new Location$$module$nodes(c,79,D,"Tunnel 7b (fog lamp)")).cave().connect(sg,w).chest(jc,19);const ua=(new Location$$module$nodes(c,80,A,"Town")).town().connect(jb),rd=(new Location$$module$nodes(c,81,A,"Fishherman Island")).town().connect(ua);(new Location$$module$nodes(c,82,ha,"Mesia Shrine")).cave().trigger(Fc).connect(cg,t,Ec);const sd=(new Location$$module$nodes(c,84,ia,"Tunnel 1a (entrance)")).cave().connect(jb);(new Location$$module$nodes(c,84,ia,"Tunnel 1b (dead end, mimic)")).cave().connect(sd,
x).chest(N,19,114);const tg=(new Location$$module$nodes(c,84,ia,"Tunnel 1c (past ice)")).cave().connect(sd,x),ug=(new Location$$module$nodes(c,85,ia,"Tunnel 2 (stoned pair)")).cave().connect(tg),Lb=(new Location$$module$nodes(c,86,ia,"Tunnel 3 (wide medusa hallways)")).cave().connect(ug,Qe),vg=(new Location$$module$nodes(c,87,ia,"Tunnel 4a (left entrance)")).cave().from(Lb,x).chest($b.chest().bonus(),25).trigger(te,ub);(new Location$$module$nodes(c,87,ia,"Tunnel 4b (right entrance)")).cave().from(Lb,
x).connect(vg,B);(new Location$$module$nodes(c,87,ia,"Tunnel 4c (sword of water)")).cave().connect(Lb,x).chest(L,24);const td=(new Location$$module$nodes(c,88,da,"Entrance")).misc(),wg=(new Location$$module$nodes(c,89,da,"Level 1")).misc().from(td),xg=(new Location$$module$nodes(c,90,da,"Level 2")).misc().from(wg),yg=(new Location$$module$nodes(c,91,da,"Level 3")).misc().from(xg),ud=(new Location$$module$nodes(c,92,da,"Outside Mesia Room")).misc().from(yg),zg=(new Location$$module$nodes(c,93,da,"Outside Dyna Room")).misc().from(ud,
pb);(new Location$$module$nodes(c,94,da,"Mesia")).misc().connect(ud).trigger(Ee);const Ag=(new Location$$module$nodes(c,95,da,"Dyna")).misc().from(zg).boss(mf);(new Location$$module$nodes(c,95,da,"Win")).misc().from(Ag).end();const Mb=(new Location$$module$nodes(c,96,ra,"Cabin Beach")).sea().from(rd,Cb),Fa=(new Location$$module$nodes(c,96,ra,"South")).sea().connect(Mb,ba),Bg=(new Location$$module$nodes(c,96,ra,"Joel Beach")).sea().connect(Fa,ba),vd=(new Location$$module$nodes(c,96,ka,"Outside Lighthouse")).sea();
(new Location$$module$nodes(c,96,ra,"Altar")).sea().connect(Fa,ba).trigger(Db,mc,lc);const Cg=(new Location$$module$nodes(c,96,ra,"North")).sea().to(Fa,ba).from(Fa,ba,Oe).trigger(we,Xe),Dg=(new Location$$module$nodes(c,96,ra,"Swan Beach")).sea().connect(Cg,ba);(new Location$$module$nodes(c,97,ra,"Cabin")).misc().connect(Mb).trigger(Ic,Cb);(new Location$$module$nodes(c,98,ka,"Lighthouse")).misc().connect(vd).trigger(ve,wb);const kb=(new Location$$module$nodes(c,100,A,"Underground Channel 1 (from throne room)")).sea().trigger(Dc),
Eg=(new Location$$module$nodes(c,100,A,"Underground Channel 2 (to fortune teller)")).sea().connect(kb,t),wd=(new Location$$module$nodes(c,100,A,"Underground Channel 3 (from fortune teller)")).sea().connect(kb,B),xd=(new Location$$module$nodes(c,100,A,"Underground Channel 4 (asina)")).sea().connect(wd,t),Fg=(new Location$$module$nodes(c,100,A,"Underground Channel 5 (dolphin)")).sea().connect(xd,t).trigger(Hc,E,Gc);(new Location$$module$nodes(c,100,A,"Underground Channel 6 (water)")).sea().connect(Fg,
ba).connectTo(Fa,ba).chest(nc,17);const Nb=(new Location$$module$nodes(c,101,I,"Zombie Town")).town(),Gg=(new Location$$module$nodes(c,104,I,"Tunnel 1 (entrance)")).sea().connect(Fa,Jc,ba),yd=(new Location$$module$nodes(c,105,I,"Tunnel 2a (start)")).cave().connect(Gg);(new Location$$module$nodes(c,105,I,"Tunnel 2b (dead end to left)")).cave().connect(yd,t);const Hg=(new Location$$module$nodes(c,105,I,"Tunnel 2c (across first river)")).cave().connect(yd,t),zd=(new Location$$module$nodes(c,105,I,"Tunnel 2d (across second river)")).cave().connect(Hg,
t);(new Location$$module$nodes(c,105,I,"Tunnel 2e (dead end, magic ring)")).cave().connect(zd,w).chest(W,29);const Ig=(new Location$$module$nodes(c,105,I,"Tunnel 2f (stair down)")).cave().connect(zd,w),Jg=(new Location$$module$nodes(c,106,I,"Tunnel 3a (main area)")).cave().connect(Ig).connectTo(Nb).chest(wa,25,92),Kg=(new Location$$module$nodes(c,106,I,"Tunnel 3b (left area toward items)")).cave().connect(Jg,w),Lg=(new Location$$module$nodes(c,107,I,"Tunnel 4a (right side, mimic)")).cave().connect(Kg).chest(N,
14,115);(new Location$$module$nodes(c,107,I,"Tunnel 4b (left side, iron necklace)")).cave().connect(Lg,t).chest(he,15);const Ob=(new Location$$module$nodes(c,108,la,"Floor 1")).fortress().connect(Nb),Mg=(new Location$$module$nodes(c,108,la,"Miniboss")).fortress().boss(cf).connect(Ob);(new Location$$module$nodes(c,109,la,"Floor 2a (left stair)")).fortress().connect(Ob).chest(M,19);const Ng=(new Location$$module$nodes(c,109,la,"Floor 2b (right stair)")).fortress().connect(Mg).chest(E,30,85),Og=(new Location$$module$nodes(c,
110,la,"Floor 3a (toward boss)")).fortress().connect(Ng),Ad=(new Location$$module$nodes(c,110,la,"Floor 3b (boss room)")).fortress().connect(Og);(new Location$$module$nodes(c,110,la,"Boss")).fortress().boss(Yc).connect(Ad);(new Location$$module$nodes(c,110,la,"Floor 3c (back room trap)")).fortress().from(Ad).to(Ob);const Pg=(new Location$$module$nodes(c,112,ka,"Secret Passage")).cave().connectTo(vd),lb=(new Location$$module$nodes(c,113,ka,"Town")).town().connect(Bg),ea=(new Location$$module$nodes(c,
114,Y,"Town")).town().connect(Dg),Qg=(new Location$$module$nodes(c,115,Y,"Inside Gate")).overworld().connect(ea),Rg=(new Location$$module$nodes(c,115,Y,"Outside Gate")).overworld().from(Qg,pa),mb=(new Location$$module$nodes(c,120,ta,"Valley")).overworld().connect(Rg),Pb=(new Location$$module$nodes(c,124,y,"Entrance")).overworld().connect(mb),Sg=(new Location$$module$nodes(c,124,y,"Over first river toward Shyron")).overworld().connect(Pb,t),Bd=(new Location$$module$nodes(c,124,y,"After first tunnel")).overworld(),
Cd=(new Location$$module$nodes(c,124,y,"Door to Styx")).overworld().connect(Bd,t),Tg=(new Location$$module$nodes(c,124,y,"Dead end (no item)")).overworld(),Ug=(new Location$$module$nodes(c,124,y,"Dead end (fruit of lime)")).overworld().chest(rb,26),Vg=(new Location$$module$nodes(c,124,y,"Dead end (magic ring)")).overworld().chest(W,25,101),Dd=(new Location$$module$nodes(c,124,y,"Outside tunnel to bow")).overworld();(new Location$$module$nodes(c,124,y,"Floating island (bow of sun)")).overworld().connect(Dd,
B).chest(qc,24);const Wg=(new Location$$module$nodes(c,125,y,"Tunnel 1 (to Shyron)")).cave().connect(Sg),Xg=(new Location$$module$nodes(c,126,y,"Outside Shyron")).overworld().connect(Wg);(new Location$$module$nodes(c,127,y,"Tunnel 2 (fork)")).cave().connect(Pb).connectTo(Ug).connectTo(Bd);const Ed=(new Location$$module$nodes(c,128,y,"Tunnel 3 (caves)")).cave().connect(Cd).connect(Tg),Fd=(new Location$$module$nodes(c,129,y,"Tunnel 4 (left branch of cave)")).cave().connect(Ed);(new Location$$module$nodes(c,
130,y,"Tunnel 5 (dead end, medical herb)")).cave().connect(Fd).chest(E,15,86);const Yg=(new Location$$module$nodes(c,131,y,"Tunnel 6a (left-then-right)")).cave().connect(Fd),Zg=(new Location$$module$nodes(c,131,y,"Tunnel 6b (past wall)")).cave().connect(Yg,w),$g=(new Location$$module$nodes(c,132,y,"Tunnel 7 (wide hall)")).cave().connect(Zg);(new Location$$module$nodes(c,133,y,"Tunnel 8 (red slimes)")).cave().from($g,w).connectTo(Dd).chest(N,23,116);const ah=(new Location$$module$nodes(c,134,y,"Tunnel 9 (right branch, infinite loop)")).cave().connect(Ed),
bh=(new Location$$module$nodes(c,135,y,"Tunnel 10a (toward magic ring)")).cave().connect(ah);(new Location$$module$nodes(c,135,y,"Tunnel 10b (past wall)")).cave().connect(bh,w).connectTo(Vg);const Gd=(new Location$$module$nodes(c,136,sa,"Entrance")).fortress().from(Cd,ic,Fb),ch=(new Location$$module$nodes(c,137,sa,"Left branch")).fortress().connect(Gd).chest(N,19,117),dh=(new Location$$module$nodes(c,137,sa,"Left branch, past one bridge")).fortress().connect(ch,t),eh=(new Location$$module$nodes(c,
137,sa,"Left branch, past two bridges")).fortress().connect(dh,t).chest(E,29,87),fh=(new Location$$module$nodes(c,137,sa,"Right branch")).fortress().connect(Gd);(new Location$$module$nodes(c,137,sa,"Right branch, across water")).fortress().connect(fh,B).chest(N,20,118).chest(N,21,119).chest(Zd,28);(new Location$$module$nodes(c,138,sa,"Upper floor")).fortress().connect(eh).chest(J,27);const Ga=(new Location$$module$nodes(c,140,ma,"Town")).town().connect(Xg,Re).trigger(Eb),Pa=(new Location$$module$nodes(c,
142,ta,"Town")).town().connect(mb),Hd=(new Location$$module$nodes(c,143,G,"Draygonia Fortress Basement 1 (front)")).fortress();(new Location$$module$nodes(c,143,G,"Draygonia Fortress Basement 2 (power ring)")).fortress().connect(Hd,xa).chest(fe,15);const Qb=(new Location$$module$nodes(c,144,ta,"Desert 1")).overworld().connect(mb),nb=(new Location$$module$nodes(c,145,G,"Area 1 (from entrance)")).cave().chest(fc,26),Id=(new Location$$module$nodes(c,145,G,"Area 2 (across top bridge)")).cave().connect(nb,
t);(new Location$$module$nodes(c,145,G,"Area 3 (dead-end across top-right bridge)")).cave().connect(Id,t);const gh=(new Location$$module$nodes(c,145,G,"Area 4 (left across middle-right bridge)")).cave().connect(Id,t),hh=(new Location$$module$nodes(c,145,G,"Area 5 (bottom edge)")).cave().connect(gh,t),ih=(new Location$$module$nodes(c,145,G,"Area 6 (bottom island)")).cave().connect(hh,t),jh=(new Location$$module$nodes(c,145,G,"Area 7 (bottom inner ring)")).cave().connect(ih,t),kh=(new Location$$module$nodes(c,
145,G,"Area 8 (left outer ring)")).cave().connect(jh,t).connect(nb,t).chest(M,27,100),lh=(new Location$$module$nodes(c,145,G,"Area 9 (top left inner ring)")).cave().connect(kh,t),mh=(new Location$$module$nodes(c,145,G,"Area 10 (top right inner ring)")).cave().connect(lh,t);(new Location$$module$nodes(c,145,G,"Area 11 (center)")).cave().connect(mh,t).connectTo(Hd);(new Location$$module$nodes(c,145,G,"Area 12 (top center islands)")).cave().connect(nb,B).chest(de,28);const nh=(new Location$$module$nodes(c,
146,aa,"Desert Cave 1")).cave().connect(Qb,B),Ha=(new Location$$module$nodes(c,147,aa,"Town")).town(),oh=(new Location$$module$nodes(c,148,aa,"Outside Cave")).overworld().connect(Ha),ph=(new Location$$module$nodes(c,149,aa,"Desert Cave 2")).cave().connect(oh);(new Location$$module$nodes(c,150,aa,"Meadow")).overworld().connect(nh).connectTo(Ha).trigger(Be,pa,Ze);const Rb=(new Location$$module$nodes(c,152,aa,"Desert 2")).overworld().connect(ph),qh=(new Location$$module$nodes(c,156,Ca,"Entrance")).fortress().connect(Rb,
B),rh=(new Location$$module$nodes(c,156,Ca,"Azteca")).fortress().trigger(De),sh=(new Location$$module$nodes(c,157,Ca,"Fork")).fortress().connect(qh),Jd=(new Location$$module$nodes(c,158,Ca,"Main")).fortress().connect(sh);(new Location$$module$nodes(c,158,Ca,"Treasure Chest (magic ring)")).fortress().connect(Jd).chest(W,27,108);(new Location$$module$nodes(c,159,Ca,"Draygon")).fortress().connect(Jd).to(rh).boss(jf);const th=(new Location$$module$nodes(c,160,ca,"Entrance")).fortress().connect(Rb,B),
uh=(new Location$$module$nodes(c,160,ca,"Statues")).fortress().connect(th).boss(kf),vh=(new Location$$module$nodes(c,161,ca,"Hall 1")).fortress().connect(uh),Sb=(new Location$$module$nodes(c,162,ca,"Branch")).fortress().connect(vh);(new Location$$module$nodes(c,163,ca,"Left Dead End")).fortress().connect(Sb).chest(N,13,120);(new Location$$module$nodes(c,164,ca,"Right Dead End")).fortress().connect(Sb);const wh=(new Location$$module$nodes(c,165,ca,"Hall 2")).fortress().connect(Sb).chest(tb,26,109),
xh=(new Location$$module$nodes(c,166,ca,"Draygon 2")).fortress().connect(wh).boss(lf);(new Location$$module$nodes(c,167,ca,"Teleporter")).fortress().from(xh).to(td);const Kd=(new Location$$module$nodes(c,168,eb,"Entrance")).fortress().connect(Pa,Fb).trigger(Nc,J),yh=(new Location$$module$nodes(c,169,eb,"Main")).fortress().from(Kd,xa),zh=(new Location$$module$nodes(c,169,eb,"Boss")).fortress().connect(yh).boss(ef),Ah=(new Location$$module$nodes(c,170,eb,"Zebu")).fortress().connect(zh),ob=(new Location$$module$nodes(c,
171,Z,"Entrance")).fortress().connect(Ah);(new Location$$module$nodes(c,171,Z,"Dead End Behind Iron (fruit of power)")).fortress().connect(ob,xa).chest(M,28,98);(new Location$$module$nodes(c,171,Z,"Dead End Loop Across Closer Bridges")).fortress().connect(ob,t).connect(ob,t);const Bh=(new Location$$module$nodes(c,171,Z,"Across First Bridge (fruit of repun)")).fortress().connect(ob,t).chest(sb,30,102),Tb=(new Location$$module$nodes(c,171,Z,"Across Second Bridge")).fortress().connect(Bh,t);(new Location$$module$nodes(c,
171,Z,"Dead End Across Two Bridges ()")).fortress().connect(Tb,t).connect(Tb,t).chest(wa,29,93);const Ch=(new Location$$module$nodes(c,171,Z,"Across Third Bridge")).fortress().connect(Tb,t),Dh=(new Location$$module$nodes(c,171,Z,"Exit Behind Iron Door")).fortress().connect(Ch,xa),Eh=(new Location$$module$nodes(c,172,Z,"Boss")).fortress().connect(Dh).boss(ff),Fh=(new Location$$module$nodes(c,172,Z,"Tornel")).fortress().connect(Eh),Ld=(new Location$$module$nodes(c,173,Ba,"Lower")).fortress().connect(Fh).chest(tb,
26,99).chest(W,27,111),Gh=(new Location$$module$nodes(c,174,Ba,"Upper Loop")).fortress().connect(Ld).chest(K,22,96);(new Location$$module$nodes(c,174,Ba,"Upper Loop Behind Wall (magic ring)")).fortress().connect(Gh,xa).chest(W,23,107);const Hh=(new Location$$module$nodes(c,175,Ba,"Upper Passage (toward Mado)")).fortress().connect(Ld).chest(W,27,84),Ub=(new Location$$module$nodes(c,176,O,"Initial Fork")).fortress(),Ih=(new Location$$module$nodes(c,177,O,"Left Branch")).fortress().connect(Ub),Md=(new Location$$module$nodes(c,
178,O,"Main Area (right branch, over bridges)")).fortress().connect(Ub),Jh=(new Location$$module$nodes(c,179,O,"U-shaped Passage (between floors)")).fortress().connect(Md),Kh=(new Location$$module$nodes(c,180,O,"Main Area Lower (under bridge)")).fortress().connect(Ih).connect(Md).connect(Jh),Nd=(new Location$$module$nodes(c,180,O,"Behind Iron Wall")).fortress().connect(Kh,xa),Lh=(new Location$$module$nodes(c,181,O,"Lower")).fortress().connect(Nd).chest(N,13,121).chest(N,14,122).chest(N,15,123).chest(W,
23,88).chest(R,24,110),Mh=(new Location$$module$nodes(c,182,O,"Boss Corridor")).fortress().connect(Lh),Nh=(new Location$$module$nodes(c,182,O,"Boss")).fortress().connect(Mh,Fb).boss(hf);(new Location$$module$nodes(c,182,O,"Behind Boss (stormBracelet)")).fortress().connect(Nh).chest(Xa,18);const Od=(new Location$$module$nodes(c,183,O,"Exit Stairs")).fortress(),Oh=(new Location$$module$nodes(c,184,G,"Entrance Back (behind river)")).cave().connect(Od).chest(M,13,90);(new Location$$module$nodes(c,184,
G,"Entrance Front")).cave().connect(Oh,B).connectTo(Qb).connectTo(nb);const Ph=(new Location$$module$nodes(c,185,Ba,"Boss")).fortress().connect(Hh).boss(gf);(new Location$$module$nodes(c,185,Ba,"Asina")).fortress().connect(Ph).connectTo(Ub);(new Location$$module$nodes(c,186,O,"Kensu")).fortress().connect(Nd).connectTo(Od).trigger(Ae,zb);(new Location$$module$nodes(c,187,ta,"House")).house().connect(Pa).trigger(Ce,pa,zb);(new Location$$module$nodes(c,188,ta,"Inn")).shop().connect(Pa,Eb);(new Location$$module$nodes(c,
190,ta,"Tool Shop")).shop(E,K,R,M).connect(Pa,Eb);(new Location$$module$nodes(c,191,ta,"Tavern")).shop().connect(Pa);(new Location$$module$nodes(c,192,X,"Elder House")).house().connect(na).trigger(uc);(new Location$$module$nodes(c,193,X,"Rabbit Hut")).house().connect(na).trigger(Ac,zc,fa);(new Location$$module$nodes(c,194,X,"Inn")).shop().connect(na);(new Location$$module$nodes(c,195,X,"Tool Shop")).shop(E,K,R,M).connect(na);(new Location$$module$nodes(c,196,X,"Armor Shop")).shop($d,Yb).connect(na);
(new Location$$module$nodes(c,197,X,"Student House")).house().connect(na).trigger(vc);(new Location$$module$nodes(c,198,za,"Tavern")).house().connect(Oa);(new Location$$module$nodes(c,199,za,"Pawn Shop")).shop().connect(Oa);(new Location$$module$nodes(c,200,za,"Inn")).shop().connect(Oa);(new Location$$module$nodes(c,201,za,"Armor Shop")).shop(ae,Yb,Xd).connect(Oa);(new Location$$module$nodes(c,203,za,"Tool Shop")).shop(E,K,R).connect(Oa);(new Location$$module$nodes(c,205,Ma,"Elder House")).house().from(gb,
fa).trigger(pe,Bb);(new Location$$module$nodes(c,206,Ma,"Mother's House")).house().from(gb,fa).trigger(yc,fa).trigger(oe,Bb);(new Location$$module$nodes(c,207,Ma,"Tool Shop")).shop(E,K,M).from(gb,fa);(new Location$$module$nodes(c,208,Ma,"Inn")).shop().from(gb,fa);(new Location$$module$nodes(c,209,Aa,"Inn")).shop().connect(fb);(new Location$$module$nodes(c,210,Aa,"Tool Shop")).shop(R,M,wa).connect(fb);(new Location$$module$nodes(c,211,Aa,"Armor Shop")).shop(bc,Zb,$b,qb).connect(fb);const Qh=(new Location$$module$nodes(c,
212,Aa,"Queen's House")).house().from(fb,Se).trigger(ye,pa,oc);(new Location$$module$nodes(c,213,db,"Nadare's")).house().connect(hb).connectTo(Yf).connectTo(Zf).connectTo($f);(new Location$$module$nodes(c,214,A,"Fisherman's House")).house().connect(rd).trigger(Cb,jc,yb,Te);const Vb=(new Location$$module$nodes(c,215,A,"Palace Entrance")).house().connect(ua);(new Location$$module$nodes(c,216,A,"Fortune Teller Front")).house().connect(ua).trigger(Cc,Bc);(new Location$$module$nodes(c,216,A,"Fortune Teller Back")).house().connect(Eg).connect(wd);
(new Location$$module$nodes(c,217,A,"Pawn Shop")).shop().connect(ua);(new Location$$module$nodes(c,218,A,"Armor Shop")).shop(be,bc,Zb).connect(ua);(new Location$$module$nodes(c,220,A,"Inn")).shop().connect(ua);(new Location$$module$nodes(c,221,A,"Tool Shop")).shop(E,wa,rb,R).connect(ua);(new Location$$module$nodes(c,222,A,"Palace Left")).house().connect(Vb);(new Location$$module$nodes(c,223,A,"Palace Throne Room")).house().connect(Vb).to(kb,Me).from(kb).trigger(Bc).trigger(se,Cc,Dc);(new Location$$module$nodes(c,
224,A,"Palace Right")).house().connect(Vb);(new Location$$module$nodes(c,225,A,"Asina's Room")).house().connect(xd).trigger(Gc,Qc);(new Location$$module$nodes(c,226,Aa,"Queen Downstairs")).house().connect(Qh).chest(Va,13);(new Location$$module$nodes(c,227,ka,"Elder's House")).house().connect(lb).trigger(Jc);(new Location$$module$nodes(c,228,ka,"Shed")).house().connect(lb).to(Pg,kc);(new Location$$module$nodes(c,229,ka,"Tool Shop")).shop(E,K,M,wa).connect(lb);(new Location$$module$nodes(c,231,ka,"Inn")).shop().connect(lb);
const Rh=(new Location$$module$nodes(c,232,I,"Zombie Town House")).house().connect(Nb);(new Location$$module$nodes(c,233,I,"Zombie Town Basement")).house().connect(Rh).trigger(ue,Yc);(new Location$$module$nodes(c,235,Y,"Tool Shop")).shop(E,K,M,R).connect(ea);(new Location$$module$nodes(c,236,Y,"Stom's Hut")).house().connect(ea).trigger(Kc);(new Location$$module$nodes(c,237,Y,"Inn")).shop().connect(ea);(new Location$$module$nodes(c,238,Y,"Armor Shop")).shop(ce,cc,Yd,ac).connect(ea);(new Location$$module$nodes(c,
239,Y,"Tavern")).house().connect(ea).trigger(Lc,Kc,Ka);(new Location$$module$nodes(c,240,Y,"Pawn Shop")).shop().connect(ea);(new Location$$module$nodes(c,241,Y,"Dance Hall")).house().connect(ea).trigger(Mc,Lc,Ka).trigger(xe,Mc,nc);const Sh=(new Location$$module$nodes(c,242,ma,"Temple (pre-massacre)")).fortress().connect(Ga).from(Gb,J,Td).trigger(ze);(new Location$$module$nodes(c,242,ma,"Temple (post-massacre)")).fortress().from(Sh,Nc).boss(df);(new Location$$module$nodes(c,243,ma,"Training Hall")).house().connect(Ga);
(new Location$$module$nodes(c,244,ma,"Hospital")).house().connect(Ga);(new Location$$module$nodes(c,245,ma,"Armor Shop")).shop(cc,qb,ac).connect(Ga);(new Location$$module$nodes(c,246,ma,"Tool Shop")).shop(E,K,rb,W).connect(Ga);(new Location$$module$nodes(c,247,ma,"Inn")).shop().connect(Ga);(new Location$$module$nodes(c,248,aa,"Inn")).shop().connect(Ha);(new Location$$module$nodes(c,249,aa,"Tool Shop")).shop(K,R,sb,W).connect(Ha);(new Location$$module$nodes(c,250,aa,"Elder's House")).house().connect(Ha);
(new Location$$module$nodes(c,251,aa,"Pawn Shop")).house().connect(Ha);const Th=[na,Na,$c,Da,Hb,Ea,Kb,ld,Mb,ea,mb,Pb,Qb,Kd,Rb];for(const a of Th)a.from(Gb,He);return c},shuffle$$module$depgraph=(a,b,c,d,e)=>{d=void 0===d?new FlagSet$$module$flagset("Sbkm Sct"):d;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const f=generate$$module$depgraph(d,a);d.shuffleShops()&&f.shuffleShops(b);const g=f.nodes.filter((a)=>a instanceof Slot$$module$nodes&&a.slots&&a.slotName);var h={};for(var k of g)if(k instanceof
Slot$$module$nodes&&k.slots){var l=k.slotType[0];(h[l]=h[l]||[]).push(k)}k=[];l=[];var m={};for(var n of d.get("S")){var p=[];for(var q of n){m[q]=!0;for(var r of h[q])p.push(r),l.push([r,k.length])}k.push(p)}for(var u of"bc")if(m[u])for(n=h[u],q=n.map((a)=>[a.item,a.itemIndex]),b.shuffle(q),r=0;r<n.length;r++)n[r].set(q[r][0],q[r][1]);p=(a)=>g.find((b)=>b.vanillaItemName===a);h=p("Sword of Wind");u=p("Sword of Fire");n=p("Ball of Wind");q=p("Ball of Fire");r=p("Statue of Onyx");p=p("Gas Mask");m.k&&
b.nextInt(2)&&(u.swap(h),q.swap(n));m.k&&!b.nextInt(3)&&r.swap(p);m=[1,1,1,1,2,2,2,3,3,3,5,5,8,13];h=[];e&&e.addTasks(10);for(u=0;1E3>u;u++){e&&0===u%100&&(yield new Promise(requestAnimationFrame),e.addCompleted(1));b.shuffle(l);for(var z of k)b.shuffle(z);n=k.map(()=>-1);q=m[b.nextInt(m.length)];r=[];p=(a,b)=>a.itemIndex===b.itemIndex||a.isMimic()&&!b.canHoldMimic()||b.isMimic()&&!a.canHoldMimic()||a.needsChest()&&!b.isChest()||b.needsChest()&&!a.isChest()?!1:!0;for(let a=0;a<q;a++){const [b,c]=
l[a],d=k[c][++n[c]];p(b,d)&&(b.swap(d),r.push([b,d]))}if(!r.length)continue;const {win:a,path:c}=f.traverse({wanted:g,dfs:!1});if(a)h=c;else for(;r.length;){const [a,b]=r.pop();a.swap(b)}}a&&f.write();if(c){c.items=[];c.route=[];for(const a of h){const [b,d]=a;c.route.push(d);z=f.nodes[b];z instanceof Slot$$module$nodes&&!z.isFixed()&&null!=z.slotName&&(k=z.slotName,0>k.indexOf(z.vanillaItemName)&&(k+=` (normally ${z.vanillaItemName})`),c.items.push({itemIndex:z.itemIndex,itemName:z.item.name,origName:z.vanillaItemName,
slotIndex:z.slotIndex,slotName:z.slotName,text:`${z.item.name}: ${k}`}))}}})},shuffle2$$module$depgraph=(a,b,c,d,e)=>{d=void 0===d?new FlagSet$$module$flagset("Sbkm Sct"):d;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const f=generate$$module$depgraph(d,a);d.shuffleShops()&&f.shuffleShops(b);const g=f.integrate();e&&e.addTasks(1E3);for(let h=0;1E3>h;h++){if(yield shuffle3$$module$depgraph(f,g,a,b,c,d,e)){console.log(`success after ${h} attempts`);return}e&&(e.addCompleted(1),0===
h%50&&(yield new Promise(requestAnimationFrame)))}return shuffle$$module$depgraph(a,b,c,d,e)})},shuffle3$$module$depgraph=(a,b,c,d,e,f,g)=>{f=void 0===f?new FlagSet$$module$flagset("Sbkm Sct"):f;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const g=e&&e.stats;var k=a.nodes.filter((a)=>a instanceof Slot$$module$nodes&&a.slots&&!a.isFixed());const l=new Map(d.shuffle(k.map((a)=>[a,[a.item,a.itemIndex]]))),m=new Set(d.shuffle(k)),n=new Map,p={};g&&g.seeds++;f.get("S").forEach((a,b)=>
{for(const c of a)p[c]=b});for(var q of m)n.set(q.item,q);const r=new Set,u=(a,b)=>{if(null==p[a.slotType?a.slotType[0]:"c"])return a===b;if(b.isMimic()&&!a.canHoldMimic()||"unique"!==b.item.inventoryRow&&a.requiresUnique||"armor"===b.item.inventoryRow&&!a.isChest())return!1;if(f.guaranteeSword()){if(0===a.slotIndex)return 4>b.item.id;if(4>b.item.id&&(r.add(b),4===r.size))return 0===a.slotIndex}return p[a.slotType?a.slotType[0]:"c"]===p[b.slotType?b.slotType[0]:"c"]};q=b.assumedFill(d,(a,b)=>u(a,
n.get(b)));if(null==q){g&&g.endState.key++;return!1;throw Error("Could not fill!");}const z=new Map;for(var V=0;V<q.length;V++){var va=q[V];if(null!=va){var oa=n.get(b.item(va));va=l.get(oa);l.delete(oa);oa=b.location(V);z.set(oa,va);m.delete(oa)}}V=(a,b,c)=>{c=void 0===c?"":c;for(const c of m)if(u(c,a))return z.set(c,b),m.delete(c),l.delete(a),!0;g&&("traps"===c?g.endState.traps++:"chest"===c?g.endState.chest++:g.endState.misc++);return!1};for(var F of l){const [a,b]=F;if(a.isMimic()&&!V(a,b,"traps"))return!1}for(const a of l){const [b,
c]=a;if(b.needsChest()&&!V(b,c,"chest"))return!1}for(const a of l){const [b,c]=a;if(!V(b,c))return!1}for(const a of z){const [b,c]=a;b.set(...c)}const {win:H,path:Qa}=a.traverse({wanted:k,dfs:!1});if(!H)return g&&g.endState.no_win++,!1;c&&a.write();if(!e)return!0;g&&(g.endState.success++,g.analyze(a,b,q));e.items=[];e.route=[];for(const b of Qa){const [c,d]=b;e.route.push(d);k=a.nodes[c];k instanceof Slot$$module$nodes&&!k.isFixed()&&(F=k.slotName,0>F.indexOf(k.vanillaItemName)&&(F+=` (normally ${k.vanillaItemName})`),
e.items.push({itemIndex:k.itemIndex,itemName:k.item.name,origName:k.vanillaItemName,slotIndex:k.slotIndex,slotName:k.slotName,text:`${k.item.name}: ${F}`}))}return!0})};var module$depgraph={};module$depgraph.generate=generate$$module$depgraph;module$depgraph.shuffle=shuffle$$module$depgraph;module$depgraph.shuffle2=shuffle2$$module$depgraph;module$depgraph.shuffle3=shuffle3$$module$depgraph;class FetchReader$$module$fetchreader{constructor(a){this.path=void 0===a?"js/":a}read(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return yield(yield fetch(b.path+a)).text()})}}var module$fetchreader={};module$fetchreader.FetchReader=FetchReader$$module$fetchreader;const IM1$$module$random=2147483563,IM2$$module$random=2147483399,AM$$module$random=1/IM1$$module$random,IMM1$$module$random=IM1$$module$random-1,IA1$$module$random=40014,IA2$$module$random=40692,IQ1$$module$random=53668,IQ2$$module$random=52774,IR1$$module$random=12211,IR2$$module$random=3791,NTAB$$module$random=32,NDIV$$module$random=1+Math.floor(IMM1$$module$random/NTAB$$module$random),EPS$$module$random=1.2E-7,RNMX$$module$random=1-EPS$$module$random;
class Random$$module$random{constructor(a=Math.floor(4294967296*Math.random())){this.iy=this.idum2=this.idum=0;this.iv=[];this.z1=null;this.seed(a)}static newSeed(){return Math.floor(4294967296*Math.random())}seed(a){this.idum2=this.idum=Math.max(1,Math.floor(a));this.iy=0;this.iv=Array(NTAB$$module$random).fill(0);for(a=NTAB$$module$random+7;0<=a;a--){const b=Math.floor(this.idum/IQ1$$module$random);this.idum=IA1$$module$random*(this.idum-b*IQ1$$module$random)-b*IR1$$module$random;0>this.idum&&(this.idum+=
IM1$$module$random);a<NTAB$$module$random&&(this.iv[a]=this.idum)}this.iy=this.iv[0]}next(){var a=Math.floor(this.idum/IQ1$$module$random);this.idum=IA1$$module$random*(this.idum-a*IQ1$$module$random)-a*IR1$$module$random;0>this.idum&&(this.idum+=IM1$$module$random);a=Math.floor(this.idum2/IQ2$$module$random);this.idum2=IA2$$module$random*(this.idum2-a*IQ2$$module$random)-a*IR2$$module$random;0>this.idum2&&(this.idum2+=IM2$$module$random);a=Math.floor(this.iy/NDIV$$module$random);this.iy=this.iv[a]-
this.idum2;this.iv[a]=this.idum;1>this.iy&&(this.iy+=IMM1$$module$random);return Math.min(AM$$module$random*this.iy,RNMX$$module$random)}nextInt(a){return Math.floor(this.next()*a)}nextNormal(a=0,b=1,c=-Infinity,d=Infinity){for(;;){let e=this.z1;if(null==e){const a=Math.sqrt(-2*Math.log(this.next())),b=TWOPI$$module$random*this.next();e=a*Math.cos(b);this.z1=a*Math.sin(b)}else this.z1=null;e=a+e*b;if(e>=c&&e<=d)return e}}shuffle(a){for(let b=a.length;b;){const c=this.nextInt(b--);[a[b],a[c]]=[a[c],
a[b]]}return a}}const TWOPI$$module$random=2*Math.PI;var module$random={};module$random.Random=Random$$module$random;class Entity$$module$rom$entity{constructor(a,b){this.rom=a;this.id=b}write(a){}toString(){return`${this.constructor.name} $${hex$$module$rom$util(this.id)}`}}var module$rom$entity={get Rom(){return Rom$$module$rom}};module$rom$entity.Entity=Entity$$module$rom$entity;class AdHocSpawn$$module$rom$adhocspawn extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=(b<<2)+171008;this.data=tuple$$module$rom$util(a.prg,this.base,4)}get slotRangeLower(){return this.data[0]}set slotRangeLower(a){this.data[0]=a}get slotRangeUpper(){return this.data[1]}set slotRangeUpper(a){this.data[1]=a}get objectId(){return this.data[2]}set objectId(a){this.data[2]=a}get count(){return this.data[3]}set count(a){this.data[3]=a}write(a){a.rom.subarray(this.base,this.base+
4).set(this.data)}}var module$rom$adhocspawn={};module$rom$adhocspawn.AdHocSpawn=AdHocSpawn$$module$rom$adhocspawn;class BossKill$$module$rom$bosskill extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.pointer=129387+2*b;this.base=readLittleEndian$$module$rom$util(a.prg,this.pointer)+81920;this.data=a.prg.slice(this.base,this.base+21);this.palettes=this.data.subarray(5,13);this.patterns=this.data.subarray(13,19)}get routine(){const a=readLittleEndian$$module$rom$util(this.data,0);return a&&a+81920}set routine(a){writeLittleEndian$$module$rom$util(this.data,0,a?a-81920:0)}get restoreMusic(){return this.data[3]}set restoreMusic(a){this.data[3]=
a}get itemDrop(){return this.data[4]}set itemDrop(a){this.data[4]=a}get restoreAnimation(){return this.data[19]}set restoreAnimation(a){this.data[19]=a}get explode(){return!!this.data[20]}set explode(a){this.data[20]=a?1:0}write(a){a.rom.subarray(this.base,this.base+21).set(this.data)}}var module$rom$bosskill={};module$rom$bosskill.BossKill=BossKill$$module$rom$bosskill;class Hitbox$$module$rom$hitbox extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=218769+(b<<2);this.coordinates=tuple$$module$rom$util(a.prg,this.base,4)}get w(){return this.coordinates[1]}set w(a){this.coordinates[1]=a}get x0(){return signed$$module$rom$util(this.coordinates[0])}set x0(a){this.coordinates[0]=unsigned$$module$rom$util(a)}get x1(){return this.x0+this.w}get h(){return this.coordinates[3]}set h(a){this.coordinates[3]=a}get y0(){return signed$$module$rom$util(this.coordinates[2])}set y0(a){this.coordinates[2]=
unsigned$$module$rom$util(a)}get y1(){return this.y0+this.h}write(a){a.rom.subarray(this.base,this.base+4).set(this.coordinates)}}var module$rom$hitbox={};module$rom$hitbox.Hitbox=Hitbox$$module$rom$hitbox;const MessageId$$module$rom$messageid=DataTuple$$module$rom$util.make(2,{action:DataTuple$$module$rom$util.prop([0,248,3]),part:DataTuple$$module$rom$util.prop([0,7,-3],[1,224,5]),index:DataTuple$$module$rom$util.prop([1,31]),toString(){const a=this.action?` (action ${hex$$module$rom$util(this.action)})`:"";return`MessageId ${this.hex()}: (${hex$$module$rom$util(this.part)}:${hex$$module$rom$util(this.index)}${a}`},mid(){return`${hex$$module$rom$util(this.part)}:${hex$$module$rom$util(this.index)}`},
nonzero(){return!(!this.part&&!this.index)}});var module$rom$messageid={};module$rom$messageid.MessageId=MessageId$$module$rom$messageid;const ITEM_USE_DATA_TABLE$$module$rom$item=121826,ITEM_DATA_TABLE$$module$rom$item=135152,SELECTED_ITEM_TABLE$$module$rom$item=135227,VANILLA_PAWN_PRICE_TABLE$$module$rom$item=138946,MENU_NAME_TABLE$$module$rom$item=135302,MESSAGE_NAME_TABLE$$module$rom$item=166492,MENU_NAME_ENCODE$$module$rom$item=[["Sword","\n\x0B\f"],[" of ","\\]"],["Bracelet","<=>["],["Shield","\r\u000e\u000f"],["Armor","{\u0011\u0012"],["Magic","#%("],["Power","\u0013\u0014\u0015"],["Item","\u0016\u0017^"]];
class Item$$module$rom$item extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.itemUseDataPointer=ITEM_USE_DATA_TABLE$$module$rom$item+2*b;this.itemUseDataBase=readLittleEndian$$module$rom$util(a.prg,this.itemUseDataPointer)+81920;this.itemDataPointer=ITEM_DATA_TABLE$$module$rom$item+b;this.itemDataValue=a.prg[this.itemDataPointer];this.selectedItemPointer=SELECTED_ITEM_TABLE$$module$rom$item+b;this.selectedItemValue=a.prg[this.selectedItemPointer];if(null!=a.shopDataTablesAddress){const c=
a.shopDataTablesAddress+21*a.shopCount+2*a.scalingLevels+2*(b-13);this.basePrice=13<=b&&39>b?readLittleEndian$$module$rom$util(a.prg,c):0}else this.basePrice=2*readLittleEndian$$module$rom$util(a.prg,VANILLA_PAWN_PRICE_TABLE$$module$rom$item+2*b);this.messageNamePointer=MESSAGE_NAME_TABLE$$module$rom$item+2*b;this.messageNameBase=readLittleEndian$$module$rom$util(a.prg,this.messageNamePointer)+131072;this.messageName=readString$$module$rom$util(a.prg,this.messageNameBase);this.menuNamePointer=MENU_NAME_TABLE$$module$rom$item+
2*b;this.menuNameBase=readLittleEndian$$module$rom$util(a.prg,this.menuNamePointer)+98304;this.menuName=MENU_NAME_ENCODE$$module$rom$item.reduce((a,b)=>{var [c,d]=b;return a.replace(d,c)},readString$$module$rom$util(a.prg,this.menuNameBase,255))}itemUseMessages(){const a=new Map;for(const b of ITEM_USE_MESSAGE$$module$rom$item.get(this.id)||[]){const c=MessageId$$module$rom$messageid.from(this.rom.prg,this.itemUseDataBase+b);a.set(c.mid(),c)}return[...a.values()]}setName(a){this.messageName=this.menuName=
a}get palette(){return this.itemDataValue&3}set palette(a){this.itemDataValue=this.itemDataValue&-4|a&3}get unique(){return!!(this.itemDataValue&64)}set unique(a){this.itemDataValue=this.itemDataValue&-65|(a?64:0)}get worn(){return!!(this.itemDataValue&32)}set worn(a){this.itemDataValue=this.itemDataValue&-33|(a?32:0)}get solid(){return!!(this.itemDataValue&128)}set solid(a){this.itemDataValue=this.itemDataValue&-129|(a?128:0)}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){a.rom[b.itemDataPointer]=
b.itemDataValue;a.rom[b.selectedItemPointer]=b.selectedItemValue;null!=b.rom.shopDataTablesAddress?13<=b.id&&39>b.id&&writeLittleEndian$$module$rom$util(a.rom,b.rom.shopDataTablesAddress+21*b.rom.shopCount+2*b.rom.scalingLevels+2*(b.id-13),b.basePrice):writeLittleEndian$$module$rom$util(a.rom,VANILLA_PAWN_PRICE_TABLE$$module$rom$item+2*b.id,b.basePrice>>>1);var c=MENU_NAME_ENCODE$$module$rom$item.reduce((a,b)=>{var [c,d]=b;return a.replace(c,d)},b.menuName);c=yield a.write([...stringToBytes$$module$rom$item(c),
255],131072,139263,`ItemMenuName ${hex$$module$rom$util(b.id)}`);writeLittleEndian$$module$rom$util(a.rom,b.menuNamePointer,c-98304)})}}const stringToBytes$$module$rom$item=(a)=>seq$$module$rom$util(a.length,(b)=>a.charCodeAt(b)),ITEM_USE_MESSAGE$$module$rom$item=new Map([[29,[2,6]],[30,[0]],[31,[0]],[32,[0]],[33,[0]],[34,[0]],[35,[0]],[37,[2]],[40,[2,8,14,20]],[50,[1]],[51,[2]],[52,[2]],[53,[2]],[54,[2]],[55,[1]],[57,[0]],[58,[2]],[59,[2]],[60,[2]],[61,[2]],[62,[2]],[63,[2]],[64,[2]]]);
var module$rom$item={};module$rom$item.Item=Item$$module$rom$item;class ItemGet$$module$rom$itemget extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.itemPointer=122214+b;this.itemId=a.prg[this.itemPointer];this.tablePointer=121600+2*b;b=this.tableBase=readLittleEndian$$module$rom$util(a.prg,this.tablePointer)+81920;this.inventoryRowStart=a.prg[b++];this.inventoryRowLength=a.prg[b++];this.acquisitionAction=MessageId$$module$rom$messageid.from(a.prg,b);this.flags=ITEM_GET_FLAGS$$module$rom$util.read(a.prg,b+2);this.key=254===a.prg[b+2+2*this.flags.length+
1]}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){a.rom[b.itemPointer]=b.itemId;var c=[b.inventoryRowStart,b.inventoryRowLength,...b.acquisitionAction.data,...ITEM_GET_FLAGS$$module$rom$util.bytes(b.flags),b.key?254:255];c=yield a.write(c,118784,126975,`ItemGetData ${hex$$module$rom$util(b.id)}`);writeLittleEndian$$module$rom$util(a.rom,b.tablePointer,c-81920)})}}var module$rom$itemget={};module$rom$itemget.ItemGet=ItemGet$$module$rom$itemget;class Location$$module$rom$location extends Entity$$module$rom$entity{constructor(a,b){super(a,b);const c=LOCATIONS$$module$rom$location[b]||{name:""};this.mapDataPointer=82688+(b<<1);this.mapDataBase=readLittleEndian$$module$rom$util(a.prg,this.mapDataPointer)+49152;this.name=c.name||"";this.used=49152<this.mapDataBase&&!!this.name;this.layoutBase=readLittleEndian$$module$rom$util(a.prg,this.mapDataBase)+49152;this.graphicsBase=readLittleEndian$$module$rom$util(a.prg,this.mapDataBase+2)+49152;this.entrancesBase=
readLittleEndian$$module$rom$util(a.prg,this.mapDataBase+4)+49152;this.exitsBase=readLittleEndian$$module$rom$util(a.prg,this.mapDataBase+6)+49152;this.flagsBase=readLittleEndian$$module$rom$util(a.prg,this.mapDataBase+8)+49152;let d=this.layoutBase!==this.mapDataBase+10,e=this.exitsBase-this.entrancesBase;this.exits=(()=>{const b=[];let c=this.exitsBase;for(;!(a.prg[c]&128);)b.push(new Exit$$module$rom$location(a.prg.slice(c,c+4))),c+=4;255!==a.prg[c]&&(d=!!(a.prg[c]&64),e=(a.prg[c]&31)<<2);return b})();
this.pitsBase=d?readLittleEndian$$module$rom$util(a.prg,this.mapDataBase+10)+49152:0;this.bgm=a.prg[this.layoutBase];this.layoutWidth=a.prg[this.layoutBase+1];this.layoutHeight=a.prg[this.layoutBase+2];this.animation=a.prg[this.layoutBase+3];this.extended=a.prg[this.layoutBase+4];this.screens=seq$$module$rom$util(this.height,(b)=>tuple$$module$rom$util(a.prg,this.layoutBase+5+b*this.width,this.width));for(const a of c.replace||[]){const [b,c,d]=a;this.screens[c][b]=d}this.tilePalettes=tuple$$module$rom$util(a.prg,
this.graphicsBase,3);this.tileset=a.prg[this.graphicsBase+3];this.tileEffects=a.prg[this.graphicsBase+4];this.tilePatterns=tuple$$module$rom$util(a.prg,this.graphicsBase+5,2);this.entrances=group$$module$rom$util(4,a.prg.slice(this.entrancesBase,this.entrancesBase+e),(a)=>new Entrance$$module$rom$location(a));this.flags=varSlice$$module$rom$util(a.prg,this.flagsBase,2,255,Infinity,(a)=>new Flag$$module$rom$location(a));this.pits=this.pitsBase?varSlice$$module$rom$util(a.prg,this.pitsBase,4,255,Infinity,
(a)=>new Pit$$module$rom$location(a)):[];this.npcDataPointer=102913+(b<<1);this.npcDataBase=readLittleEndian$$module$rom$util(a.prg,this.npcDataPointer)+65536;this.spritePalettes=(this.hasSpawns=65536!==this.npcDataBase)?tuple$$module$rom$util(a.prg,this.npcDataBase+1,2):[0,0];this.spritePatterns=this.hasSpawns?tuple$$module$rom$util(a.prg,this.npcDataBase+3,2):[0,0];this.spawns=this.hasSpawns?varSlice$$module$rom$util(a.prg,this.npcDataBase+5,4,255,Infinity,(a)=>new Spawn$$module$rom$location(a)):
[]}get width(){return this.layoutWidth+1}set width(a){this.layoutWidth=a-1}get height(){return this.layoutHeight+1}set height(a){this.layoutHeight=a-1}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(b.used){var c=[];if(b.hasSpawns){var d=[0,...b.spritePalettes,...b.spritePatterns,...concatIterables$$module$rom$util(b.spawns),255];c.push(a.write(d,98304,114687,`NpcData ${hex$$module$rom$util(b.id)}`).then((c)=>writeLittleEndian$$module$rom$util(a.rom,b.npcDataPointer,
c-65536)))}d=(c,d)=>a.write(c,81920,98303,`${d} ${hex$$module$rom$util(b.id)}`);var e=[b.bgm,b.layoutWidth,b.layoutHeight,b.animation,b.extended,...concatIterables$$module$rom$util(b.screens)],f=[...b.tilePalettes,b.tileset,b.tileEffects,...b.tilePatterns],g=concatIterables$$module$rom$util(b.entrances),h=[...concatIterables$$module$rom$util(b.exits),128|(b.pits.length?64:0)|b.entrances.length],k=[...concatIterables$$module$rom$util(b.flags),255],l=concatIterables$$module$rom$util(b.pits),[m,n,p,
q,r,u]=yield Promise.all([d(e,"Layout"),d(f,"Graphics"),d(g,"Entrances"),d(h,"Exits"),d(k,"Flags"),...l.length?[d(l,"Pits")]:[]]);e=[m&255,(m>>>8)-192,n&255,(n>>>8)-192,p&255,(p>>>8)-192,q&255,(q>>>8)-192,r&255,(r>>>8)-192,...u?[u&255,(u>>8)-192]:[]];d=yield d(e,"MapData");writeLittleEndian$$module$rom$util(a.rom,b.mapDataPointer,d-49152);yield Promise.all(c)}})}allScreens(){const a=new Set,b=this.extended?256:0;for(const c of this.screens)for(const d of c)a.add(this.rom.screens[d+b]);return a}}
const Entrance$$module$rom$location=DataTuple$$module$rom$util.make(4,{x:DataTuple$$module$rom$util.prop([0],[1,255,-8]),y:DataTuple$$module$rom$util.prop([2],[3,255,-8]),toString(){return`Entrance ${this.hex()}: (${hex$$module$rom$util(this.x)}, ${hex$$module$rom$util(this.y)})`}}),Exit$$module$rom$location=DataTuple$$module$rom$util.make(4,{x:DataTuple$$module$rom$util.prop([0,255,-4]),xt:DataTuple$$module$rom$util.prop([0]),y:DataTuple$$module$rom$util.prop([1,255,-4]),yt:DataTuple$$module$rom$util.prop([1]),
dest:DataTuple$$module$rom$util.prop([2]),entrance:DataTuple$$module$rom$util.prop([3]),toString(){return`Exit ${this.hex()}: (${hex$$module$rom$util(this.x)}, ${hex$$module$rom$util(this.y)}) => ${this.dest}:${this.entrance}`}}),Flag$$module$rom$location=DataTuple$$module$rom$util.make(2,{flag:{get(){return this.data[0]|512},set(a){if(512!==(a&-256))throw Error(`bad flag: ${hex$$module$rom$util(a)}`);this.data[0]=a&255}},x:DataTuple$$module$rom$util.prop([1,7,-8]),xs:DataTuple$$module$rom$util.prop([1,
7]),y:DataTuple$$module$rom$util.prop([1,240,-4]),ys:DataTuple$$module$rom$util.prop([1,240,4]),yx:DataTuple$$module$rom$util.prop([1]),toString(){return`Flag ${this.hex()}: (${hex$$module$rom$util(this.xs)}, ${hex$$module$rom$util(this.ys)}) @ ${hex$$module$rom$util(this.flag)}`}}),Pit$$module$rom$location=DataTuple$$module$rom$util.make(4,{fromXs:DataTuple$$module$rom$util.prop([1,112,4]),toXs:DataTuple$$module$rom$util.prop([1,7]),fromYs:DataTuple$$module$rom$util.prop([3,240,4]),toYs:DataTuple$$module$rom$util.prop([3,
15]),dest:DataTuple$$module$rom$util.prop([0]),toString(){return`Pit ${this.hex()}: (${hex$$module$rom$util(this.fromXs)}, ${hex$$module$rom$util(this.fromYs)}) => ${hex$$module$rom$util(this.dest)}:(${hex$$module$rom$util(this.toXs)}, ${hex$$module$rom$util(this.toYs)})`}}),Spawn$$module$rom$location=DataTuple$$module$rom$util.make(4,{y:DataTuple$$module$rom$util.prop([0,255,-4]),yt:DataTuple$$module$rom$util.prop([0]),timed:DataTuple$$module$rom$util.booleanProp([1,128,7]),x:DataTuple$$module$rom$util.prop([1,
127,-4],[2,64,3]),xt:DataTuple$$module$rom$util.prop([1,127]),patternBank:DataTuple$$module$rom$util.prop([2,128,7]),type:DataTuple$$module$rom$util.prop([2,7]),id:DataTuple$$module$rom$util.prop([3]),monsterId:{get(){return this.id+80&255},set(a){this.id=a-80&255}},isChest(){return 2===this.type&&128>this.id},isTrigger(){return 2===this.type&&128<=this.id},isMonster(){return 0===this.type},toString(){return`Spawn ${this.hex()}: (${hex$$module$rom$util(this.x)}, ${hex$$module$rom$util(this.y)}) ${this.timed?
"timed":"fixed"} ${this.type}:${hex$$module$rom$util(this.id)}`}}),LOCATIONS$$module$rom$location=(()=>{function a(a,d,e){({replace:e}=void 0===e?{}:e);d={name:d};e&&(d.replace=e);b[a]=d}const b=[];a(0,"Mezame Shrine");a(1,"Leaf - Outside Start");a(2,"Leaf");a(3,"Valley of Wind");a(4,"Sealed Cave 1");a(5,"Sealed Cave 2");a(6,"Sealed Cave 6");a(7,"Sealed Cave 4");a(8,"Sealed Cave 5");a(9,"Sealed Cave 3");a(10,"Sealed Cave 7");a(12,"Sealed Cave 8");a(14,"Windmill Cave");a(15,"Windmill");a(16,"Zebu Cave");
a(17,"Mt Sabre West - Cave 1");a(20,"Cordel Plains West");a(21,"Cordel Plains East");a(24,"Brynmaer");a(25,"Outside Stom House");a(26,"Swamp");a(27,"Amazones");a(28,"Oak");a(30,"Stom House");a(32,"Mt Sabre West - Lower");a(33,"Mt Sabre West - Upper");a(34,"Mt Sabre West - Cave 2");a(35,"Mt Sabre West - Cave 3");a(36,"Mt Sabre West - Cave 4",{replace:[[3,4,128]]});a(37,"Mt Sabre West - Cave 5");a(38,"Mt Sabre West - Cave 6");a(39,"Mt Sabre West - Cave 7");a(40,"Mt Sabre North - Main");a(41,"Mt Sabre North - Middle");
a(42,"Mt Sabre North - Cave 2");a(43,"Mt Sabre North - Cave 3");a(44,"Mt Sabre North - Cave 4");a(45,"Mt Sabre North - Cave 5");a(46,"Mt Sabre North - Cave 6");a(47,"Mt Sabre North - Prison Hall");a(48,"Mt Sabre North - Left Cell");a(49,"Mt Sabre North - Left Cell 2");a(50,"Mt Sabre North - Right Cell");a(51,"Mt Sabre North - Cave 8");a(52,"Mt Sabre North - Cave 9");a(53,"Mt Sabre North - Summit Cave");a(56,"Mt Sabre North - Cave 1");a(57,"Mt Sabre North - Cave 7");a(60,"Nadare - Inn");a(61,"Nadare - Tool Shop");
a(62,"Nadare - Back Room");a(64,"Waterfall Valley North");a(65,"Waterfall Valley South");a(66,"Lime Tree Valley",{replace:[[0,2,0]]});a(67,"Lime Tree Lake");a(68,"Kirisa Plant Cave 1");a(69,"Kirisa Plant Cave 2");a(70,"Kirisa Plant Cave 3");a(71,"Kirisa Meadow");a(72,"Fog Lamp Cave 1");a(73,"Fog Lamp Cave 2");a(74,"Fog Lamp Cave 3");a(75,"Fog Lamp Cave Dead End");a(76,"Fog Lamp Cave 4");a(77,"Fog Lamp Cave 5");a(78,"Fog Lamp Cave 6");a(79,"Fog Lamp Cave 7");a(80,"Portoa");a(81,"Portoa - Fisherman Island");
a(82,"Mesia Shrine");a(84,"Waterfall Cave 1");a(85,"Waterfall Cave 2");a(86,"Waterfall Cave 3");a(87,"Waterfall Cave 4");a(88,"Tower - Entrance");a(89,"Tower 1");a(90,"Tower 2");a(91,"Tower 3");a(92,"Tower - Outside Mesia");a(93,"Tower - Outside Dyna");a(94,"Tower - Mesia");a(95,"Tower - Dyna");a(96,"Angry Sea");a(97,"Boat House");a(98,"Joel - Lighthouse");a(100,"Underground Channel");a(101,"Zombie Town");a(104,"Evil Spirit Island 1");a(105,"Evil Spirit Island 2");a(106,"Evil Spirit Island 3");a(107,
"Evil Spirit Island 4");a(108,"Sabera Palace 1");a(109,"Sabera Palace 2");a(110,"Sabera Palace 3");a(112,"Joel - Secret Passage");a(113,"Joel");a(114,"Swan");a(115,"Swan - Gate");a(120,"Goa Valley");a(124,"Mt Hydra");a(125,"Mt Hydra - Cave 1");a(126,"Mt Hydra - Outside Shyron");a(127,"Mt Hydra - Cave 2");a(128,"Mt Hydra - Cave 3");a(129,"Mt Hydra - Cave 4");a(130,"Mt Hydra - Cave 5");a(131,"Mt Hydra - Cave 6");a(132,"Mt Hydra - Cave 7");a(133,"Mt Hydra - Cave 8");a(134,"Mt Hydra - Cave 9");a(135,
"Mt Hydra - Cave 10");a(136,"Styx 1");a(137,"Styx 2");a(138,"Styx 3");a(140,"Shyron");a(142,"Goa");a(143,"Goa Fortress - Oasis Entrance");a(144,"Desert 1");a(145,"Oasis Cave - Main",{replace:[[0,11,128],[1,11,128],[2,11,128],[3,11,128],[4,11,128],[5,11,128],[6,11,128],[7,11,128]]});a(146,"Desert Cave 1");a(147,"Sahara");a(148,"Sahara - Outside Cave");a(149,"Desert Cave 2");a(150,"Sahara Meadow");a(152,"Desert 2");a(156,"Pyramid Front - Entrance");a(157,"Pyramid Front - Branch");a(158,"Pyramid Front - Main");
a(159,"Pyramid Front - Draygon");a(160,"Pyramid Back - Entrance");a(161,"Pyramid Back - Hall 1");a(162,"Pyramid Back - Branch");a(163,"Pyramid Back - Dead End Left");a(164,"Pyramid Back - Dead End Right");a(165,"Pyramid Back - Hall 2");a(166,"Pyramid Back - Draygon Revisited");a(167,"Pyramid Back - Teleporter");a(168,"Goa Fortress - Entrance");a(169,"Goa Fortress - Kelbesque");a(170,"Goa Fortress - Zebu");a(171,"Goa Fortress - Sabera");a(172,"Goa Fortress - Tornel");a(173,"Goa Fortress - Mado 1");
a(174,"Goa Fortress - Mado 2");a(175,"Goa Fortress - Mado 3");a(176,"Goa Fortress - Karmine 1");a(177,"Goa Fortress - Karmine 2");a(178,"Goa Fortress - Karmine 3");a(179,"Goa Fortress - Karmine 4");a(180,"Goa Fortress - Karmine 5");a(181,"Goa Fortress - Karmine 6");a(182,"Goa Fortress - Karmine 7");a(183,"Goa Fortress - Exit");a(184,"Oasis Cave - Entrance");a(185,"Goa Fortress - Asina");a(186,"Goa Fortress - Kensu");a(187,"Goa - House");a(188,"Goa - Inn");a(190,"Goa - Tool Shop");a(191,"Goa - Tavern");
a(192,"Leaf - Elder House");a(193,"Leaf - Rabbit Hut");a(194,"Leaf - Inn");a(195,"Leaf - Tool Shop");a(196,"Leaf - Armor Shop");a(197,"Leaf - Student House");a(198,"Brynmaer - Tavern");a(199,"Brynmaer - Pawn Shop");a(200,"Brynmaer - Inn");a(201,"Brynmaer - Armor Shop");a(203,"Brynmaer - Item Shop");a(205,"Oak - Elder House");a(206,"Oak - Mother House");a(207,"Oak - Tool Shop");a(208,"Oak - Inn");a(209,"Amazones - Inn");a(210,"Amazones - Item Shop");a(211,"Amazones - Armor Shop");a(212,"Amazones - Elder");
a(213,"Nadare");a(214,"Portoa - Fisherman House");a(215,"Portoa - Palace Entrance");a(216,"Portoa - Fortune Teller");a(217,"Portoa - Pawn Shop");a(218,"Portoa - Armor Shop");a(220,"Portoa - Inn");a(221,"Portoa - Tool Shop");a(222,"Portoa - Palace Left");a(223,"Portoa - Palace Throne Room");a(224,"Portoa - Palace Right");a(225,"Portoa - Asina Room");a(226,"Amazones - Elder Downstairs");a(227,"Joel - Elder House");a(228,"Joel - Shed");a(229,"Joel - Tool Shop");a(231,"Joel - Inn");a(232,"Zombie Town - House");
a(233,"Zombie Town - House Basement");a(235,"Swan - Tool Shop");a(236,"Swan - Stom Hut");a(237,"Swan - Inn");a(238,"Swan - Armor Shop");a(239,"Swan - Tavern");a(240,"Swan - Pawn Shop");a(241,"Swan - Dance Hall");a(242,"Shyron - Fortress");a(243,"Shyron - Training Hall");a(244,"Shyron - Hospital");a(245,"Shyron - Armor Shop");a(246,"Shyron - Tool Shop");a(247,"Shyron - Inn");a(248,"Sahara - Inn");a(249,"Sahara - Tool Shop");a(250,"Sahara - Elder House");a(251,"Sahara - Pawn Shop");return b})();
var module$rom$location={};module$rom$location.Location=Location$$module$rom$location;module$rom$location.Entrance=Entrance$$module$rom$location;module$rom$location.Exit=Exit$$module$rom$location;module$rom$location.Flag=Flag$$module$rom$location;module$rom$location.Pit=Pit$$module$rom$location;module$rom$location.Spawn=Spawn$$module$rom$location;module$rom$location.LOCATIONS=LOCATIONS$$module$rom$location;class DataTable$$module$rom$messages extends Array{constructor(a,b,c,d,e){e=void 0===e?1<d?(...a)=>a:(a)=>a:e;super(c);this.rom=a;this.base=b;this.count=c;this.width=d;for(let f=0;f<c;f++)this[f]=e(...slice$$module$rom$util(a.prg,b+f*d,d))}}
class AddressTable$$module$rom$messages extends Array{constructor(a,b,c,d,e){e=void 0===e?(a)=>a:e;super(c);this.rom=a;this.base=b;this.count=c;this.offset=d;this.addresses=seq$$module$rom$util(this.count,(c)=>(c=readLittleEndian$$module$rom$util(a.prg,b+2*c))&&c+d);for(let a=0;a<c;a++)this[a]=e(this.addresses[a],a,this.addresses)}}const DELIMITERS$$module$rom$messages=new Map([[6,"{}"],[7,"[]"]]);
class Message$$module$rom$messages{constructor(a,b,c,d,e){this.messages=a;this.part=b;this.id=c;this.addr=d;this.pointer=e;this.bytes=[];this.hex="";b=a.rom.prg;c=[];for(e=d;d&&b[e];e++){const f=b[e];this.bytes.push(f);if(1===f){if(e!==d&&3!==b[e-1])throw Error(`Unexpected start message signal at ${e.toString(16)}`);}else if(2===f)c.push("\n ");else if(3===f)c.push(`${Messages$$module$rom$messages.CONTINUED}\n`);else if(4===f)c.push("{:HERO:}");else if(8===f)c.push("[:ITEM:]");else if(5<=f&&9>=f){const d=
b[++e];if(9===f){c.push(" ".repeat(d));continue}const h=DELIMITERS$$module$rom$messages.get(f);h&&(c.push(h[0]),c.push(d.toString(16).padStart(2,"0")),c.push(":"));c.push(a.extraWords[f][d]);h&&c.push(h[1]);PUNCTUATION$$module$rom$messages[String.fromCharCode(b[e+1])]||c.push(" ")}else if(128<=f)c.push(a.basicWords[f-128]),PUNCTUATION$$module$rom$messages[String.fromCharCode(b[e+1])]||c.push(" ");else if(32<=f)c.push(String.fromCharCode(f));else throw Error(`Non-exhaustive switch: ${f} at ${e.toString(16)}`);
}this.text=c.join("")}mid(){return`${hex$$module$rom$util(this.part)}:${hex$$module$rom$util(this.id)}`}fixText(){function a(g,h,m){h=void 0===h?g.length:h;if(29<d+h){if(m){g=m.split(/\s+/);for(h=0;h<g.length;h++)h&&(e||a(" "),e=!0),a(g[h]);return}d=1;3<++c?(b.push("#\n "),c=0):b.push("\n ");e=!0}" "===g?(b.push(...f," "),f=[]):f.push(g);d+=h;e=g.endsWith(" ")}if(!this.checkText()){var b=[],c=0,d=0,e=!1,f=[];for(let b=0;b<this.text.length;b++){var g=this.text[b],h=this.text[b+1];/\s/.test(g)?(e||
a(" "),e=!0):"{"===g?(":"===h?a("{:HERO:}",6):(g=this.text.indexOf(":",b),g=Number.parseInt(this.text.substring(b+1,g),16),h=this.messages.extraWords[6][g],a(`{${g.toString(16)}:${h}}`,h.length,h)),b=this.text.indexOf("}",b)):"["===g?(":"===h?a("[:ITEM:]",Math.max(...this.messages.rom.items.map((a)=>a.messageName.length))):(g=this.text.indexOf(":",b),g=Number.parseInt(this.text.substring(b+1,g),16),h=this.messages.rom.items[g].messageName,a(`[${g.toString(16)}:${h}]`,h.length,h)),b=this.text.indexOf("]",
b)):a(g)}b.push(...f);this.text=b.join("")}}checkText(){let a=0,b=0;for(let d=0;d<this.text.length;d++){const e=this.text[d];var c=this.text[d+1];if("\n"===e){if(a++,b=1,3<a)return!1}else if("#"===e)"\n"===c&&d++,a=b=0;else if("{"===e||"["===e){if(":"===c){if(b="{"===e?b+6:b+Math.max(...this.messages.rom.items.map((a)=>a.messageName.length)),28<b)return!1}else c=this.text.indexOf(":",d),c=Number.parseInt(this.text.substring(d+1,c),16),b+=("{"===e?this.messages.extraWords[6][c]:this.messages.rom.items[c].messageName).length;
d=this.text.indexOf(CLOSERS$$module$rom$messages[e],d)}else b++;if(29<b&&" "!==e)return!1}return!0}}const PUNCTUATION$$module$rom$messages={"\x00":!0," ":!0,"!":!0,"'":!0,",":!0,".":!0,":":!0,";":!0,"?":!0,_:!0,"\n":!0,"#":!0};
class Messages$$module$rom$messages{constructor(a){this.rom=a;const b=readLittleEndian$$module$rom$util(a.prg,165636)+131072,c=readLittleEndian$$module$rom$util(a.prg,165514)+131072,d=readLittleEndian$$module$rom$util(a.prg,165589)+131072,e=readLittleEndian$$module$rom$util(a.prg,165609)+131072,f=(b)=>readString$$module$rom$util(a.prg,b);this.basicWords=new AddressTable$$module$rom$messages(a,b,128,131072,f);this.extraWords={5:new AddressTable$$module$rom$messages(a,c,d-c>>>1,131072,f),6:new AddressTable$$module$rom$messages(a,
d,36,131072,f),7:new AddressTable$$module$rom$messages(a,e,74,131072,f)};this.banks=new DataTable$$module$rom$messages(a,164862,36,1);this.parts=new AddressTable$$module$rom$messages(a,164898,34,131072,(b,c,d)=>new AddressTable$$module$rom$messages(a,b,33===c?3:d[c+1]-b>>>1,(this.banks[c]<<13)-40960,(a,d)=>new Message$$module$rom$messages(this,c,d,a,b+2*d)))}*messages(a){for(const b of this.parts)if(a)for(const c of b)a.has(c.mid())&&(yield c);else yield*b}uses(){function a(a,c){a="string"===typeof a?
a:a.mid();const d=b.get(a)||new Set;d.add(c);b.set(a,d)}const b=new Map;for(var c of this.rom.triggers)c.message.nonzero()&&a(c.message,`Trigger $${hex$$module$rom$util(c.id)}`);for(const b of this.rom.items)for(const c of b.itemUseMessages())c.nonzero()&&a(c,`Item $${hex$$module$rom$util(b.id)}`);for(var d of this.rom.npcs){for(const b of d.globalDialogs)a(b.message,`NPC $${hex$$module$rom$util(d.id)}`);for(const b of d.localDialogs){const [e,g]=b;c=0<=e?` @ $${hex$$module$rom$util(e)}`:"";for(const b of g)a(b.message,
`NPC $${hex$$module$rom$util(d.id)}${c}`)}}for(const b of this.rom.telepathy.sages){for(const c of b.defaultMessages)a(c,`Telepathy ${b.sage}`);for(const c of b.messageGroups)for(const e of c.messages){[,...d]=e;for(const c of d)a(c,`Telepathy ${b.sage}`)}}for(const b of HARDCODED_MESSAGES$$module$rom$messages)a(b,"Hardcoded");return b}buildAbbreviationTable(a){a=void 0===a?this.uses():a;const b=[];var c=new Map;const d=new Map;for(var e of this.messages(a)){a=e.mid();var f=c.get(e.addr);if(f=null!=
f&&d.get(f))f.push(a);else{c.set(e.addr,a);d.set(a,[]);f=e.text;var g=[];for(let c=0,d=f.length;c<=d;c++){var h=f[c],k=CLOSERS$$module$rom$messages[h];if(PUNCTUATION$$module$rom$messages[h]||k||c===d){var l=f[c+1];k&&(c=Math.max(c,f.indexOf(k,c)));if(g.length){k=" "!==h&&"'"!==h||!l||PUNCTUATION$$module$rom$messages[l]?"":h;l=g.join("");var m=b.length;h=l.length+(" "===h?1:0);g=[];b.push({str:l,id:m,chain:k,bytes:h,used:0,suffixes:new Set,mid:a})}}else g.push(h)}}}c=new Map;for(e=b.length-1;0<=e;e--)for(a=
b[e],f=a.bytes-2;0<=f;f--)for(g=a.str.substring(f),h=0,k=a,l=a.bytes-f-1;;){(m=c.get(g))||c.set(g,m={chains:h,missing:f,saving:-g.length,str:g,words:new Set});m.words.add(e);m.saving+=l;for(let a=h;0<=a;a--)b[e+a].suffixes.add(m);if(!k.chain)break;g+=k.chain;k=b[e+ ++h];g+=k.str;l+=k.bytes}e=new Set;a=[];f=(a,b)=>{({saving:a}=a);({saving:b}=b);return b-a};g=[...c.values()].sort(f);for(h=0;g.length&&h<MAX_TABLE_LENGTH$$module$rom$messages;){e.has(g[0].str)&&(g.sort(f),e.clear());const {str:n,saving:p,
missing:q,words:r,chains:u}=g.shift();if(0>=p)break;h+=n.length+3;k=a.length;l=new Set;for(const a of r){m=b[a];for(const a of[m.mid,...d.get(m.mid)||[]])l.add(a)}a.push({bytes:128>k?[k+128]:[5,k-128],mids:l,str:n});for(const a of r)for(k=0;k<=u;k++){l=b[a+k];m=l.bytes-(k?0:q);for(const a of l.suffixes)a.saving-=m-l.used,e.add(a.str);l.used=m}if(128===a.length){for(const a of c.values())a.saving-=a.words.size;g.sort(f);e.clear()}}return a}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){function c(b,
c){writeLittleEndian$$module$rom$util(a.rom,b,c-131072);writeLittleEndian$$module$rom$util(a.rom,b+5,c+1-131072)}var d=b.uses(),e=b.buildAbbreviationTable(d),f=166053,g=f+2*(e.length+b.rom.items.length+b.extraWords[6].count);c(165636,f);for(let b=0,d=e.length;b<d;b++)128===b&&c(165514,f),writeLittleEndian$$module$rom$util(a.rom,f,g),f+=2,writeString$$module$rom$util(a.rom,g,e[b].str),g+=e[b].str.length,a.rom[g++]=0;128>e.length&&c(165514,f);c(165589,f);const h=b.extraWords[6];for(const b of h)writeLittleEndian$$module$rom$util(a.rom,
f,g),f+=2,writeString$$module$rom$util(a.rom,g,b),g+=b.length,a.rom[g++]=0;c(165609,f);c(165769,f);for(const c of b.rom.items)writeLittleEndian$$module$rom$util(a.rom,f,g),f+=2,writeString$$module$rom$util(a.rom,g,c.messageName),g+=c.messageName.length,a.rom[g++]=0;f=new Map;for(var k of e)for(var l of k.mids)(e=f.get(l))||f.set(l,e=[]),e.push(k);for(var m of f.values())m.sort((a,b)=>{({str:{length:a}}=a);({str:{length:b}}=b);return b-a});k=seq$$module$rom$util(b.parts.length,()=>[]);for(var n of b.messages(d)){l=
n.text;l=l.replace(/([\[{])([^\]}]*)[\]}](.|$)/g,(a,b,c,d)=>{if(d&&!PUNCTUATION$$module$rom$messages[d])return a;" "===d&&(d="");if("["===b&&":ITEM:"===c)return`[8]${d}`;if("{"===b&&":HERO:"===c)return`[4]${d}`;c=/^([0-9a-f]+):/.exec(c);if(!c)throw Error(`Bad message text: ${a}`);a=Number.parseInt(c[1],16);return`[${"{"===b?6:7}][${a}]${d}`});for(var p of f.get(n.mid())||[]){const {str:a,bytes:b}=p;l=l.replace(new RegExp(a+"(  |.|$)","g"),(a,c)=>{if(c&&!PUNCTUATION$$module$rom$messages[c])return a;
" "===c&&(c="");return b.map((a)=>`[${a}]`).join("")+c})}m=["[01]"];d=[];d.push(1);for(let a=0,b=l.length;a<b;a++)if(e=l[a],e===Messages$$module$rom$messages.CONTINUED)d.push(3,1),m.push("[03][01]"),"\n"===l[a+1]&&a++;else if("\n"===e)d.push(2)," "===l[a+1]&&a++,m.push("[02]");else if("["===e){e=l.indexOf("]",a);if(0>=e)throw Error(`bad text: ${l}`);g=Number(l.substring(a+1,e));if(isNaN(g))throw Error(`bad text: ${l}`);d.push(g);m.push(`[${hex$$module$rom$util(g)}]`);a=e}else if(" "===e&&" "===l[a+
1]){for(e=a+2;" "===l[e];)e++;d.push(9,e-a);m.push(`[09][${hex$$module$rom$util(e-a)}]`);a=e-1}else d.push(e.charCodeAt(0)),m.push(e);d.push(0);m.push("[0]");n.bytes=d;n.hex=m.join("");l=b.banks[n.part]<<13;const c=l-40960;k[n.part][n.id]=a.write(d,l,l+8192,`Message ${n.mid()}`).then((a)=>a-c)}n=yield Promise.all(k.map((a)=>Promise.all(a)));p=163840;for(f=0;f<n.length;f++){d=[];for(k=0;k<n[f].length;k++)writeLittleEndian$$module$rom$util(d,2*k,n[f][k]);a.rom.subarray(p,p+d.length).set(d);writeLittleEndian$$module$rom$util(a.rom,
164898+2*f,p-131072);p+=d.length}for(n=0;n<b.banks.length;n++)a.rom[164862+n]=b.banks[n];yield Promise.all([])})}}Messages$$module$rom$messages.CONTINUED="#";const MAX_TABLE_LENGTH$$module$rom$messages=1250,CLOSERS$$module$rom$messages={"{":"}","[":"]"},HARDCODED_MESSAGES$$module$rom$messages=new Set("20:1d 1b:0f 1b:10 1b:11 1b:12 1b:05 1f:00 13:00 0b:01 20:0c 20:0f 1c:11 0e:05 16:00 20:11 21:00 21:02 21:01 06:00 18:00 18:02 18:04 18:08 1b:03 1b:00 1b:00 06:01 10:13 19:05 20:14 20:15 20:17 20:02 20:0d 20:19 20:1a 20:1b 03:01 03:02 10:10 10:11 10:12 0c:04 0c:05 03:03 20:0e 20:13".split(" "));
var module$rom$messages={};module$rom$messages.Messages=Messages$$module$rom$messages;module$rom$messages.HARDCODED_MESSAGES=HARDCODED_MESSAGES$$module$rom$messages;const METASPRITE_TABLE$$module$rom$metasprite=230492;
class Metasprite$$module$rom$metasprite extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.mirrored=null;this.pointer=METASPRITE_TABLE$$module$rom$metasprite+(this.id<<1);this.base=readLittleEndian$$module$rom$util(a.prg,this.pointer)+196608;this.used=229376<=this.base;if(255===a.prg[this.base]){const c=readLittleEndian$$module$rom$util(a.prg,this.base+1);for(let b=0;256>b;b++)if(readLittleEndian$$module$rom$util(a.prg,METASPRITE_TABLE$$module$rom$metasprite+(b<<1))===c){this.mirrored=
b;break}if(null==this.mirrored)throw Error(`could not find mirrored sprite for ${hex$$module$rom$util(b)}`);this.frames=this.frameMask=this.size=0;this.sprites=[]}else this.mirrored=null,this.size=a.prg[this.base],this.frameMask=a.prg[this.base+1],this.frames=this.frameMask+1,this.sprites=seq$$module$rom$util(this.frames,(b)=>{b=this.base+2+4*b*this.size;const c=[];for(let d=0;d<this.size&&128!==a.prg[b+4*d];d++)c.push(tuple$$module$rom$util(a.prg,b+4*d,4));return c})}palettes(){if(!this.used)return[];
let a=this;a.mirrored&&(a=this.rom.metasprites[a.mirrored]);const b=new Set;for(const c of a.sprites)for(const [a,,e]of c){if(128===a)break;b.add(e&3)}return[...b]}}var module$rom$metasprite={};module$rom$metasprite.Metasprite=Metasprite$$module$rom$metasprite;class Npc$$module$rom$npc extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.spawnConditions=new Map;this.localDialogs=new Map;this.used=!UNUSED_NPCS$$module$rom$npc.has(b)&&(143>b||192<=b);var c=195>=b;this.dataBase=33008|(b&252)<<6|(b&3)<<2;this.data=tuple$$module$rom$util(a.prg,this.dataBase,4);this.spawnPointer=116192+(b<<1);var d=this.spawnBase=readLittleEndian$$module$rom$util(a.prg,this.spawnPointer)+81920;let e;for(;this.used&&255!==(e=a.prg[d++]);){const b=SPAWN_CONDITION_FLAGS$$module$rom$util.read(a.prg,
d);d+=2*b.length;this.spawnConditions.set(e,b)}this.dialogPointer=c?117085+(b<<1):0;this.dialogBase=c?addr$$module$rom$util(a.prg,this.dialogPointer,81920):0;this.globalDialogs=[];if(c){for(b=this.dialogBase;;){const [c,d]=GlobalDialog$$module$rom$npc.parse(a.prg,b);b+=4;c.condition&&this.globalDialogs.push(c);if(d)break}for(c=[];;){d=a.prg[b++];if(255===d)break;c.push([d,a.prg[b++]])}c.length||c.push([-1,0]);d=b;for(const e of c){const [f,h]=e;c=[];this.localDialogs.set(f,c);for(b=d+h;;){const [d,
e]=LocalDialog$$module$rom$npc.parse(a.prg,b);b+=d.byteLength();c.push(d);if(e)break}}}}spawnConditionsBytes(){const a=[];for(const b of this.spawnConditions){const [c,d]=b;a.push(c,...SPAWN_CONDITION_FLAGS$$module$rom$util.bytes(d))}a.push(255);return a}dialogBytes(){function a(a){const b=[];for(let c=0;c<a.length;c++)b.push(...a[c].bytes(c===a.length-1));return b}if(!this.dialogPointer)return[];const b=[];this.globalDialogs.length?b.push(...a(this.globalDialogs)):b.push(128,0,0,0);const c=[],d=
new Map;for(const e of this.localDialogs){const [f,g]=e;{const e=a(g),k=e.join(","),l=d.get(k);null!=l?b.push(f,l):(d.set(k,c.length),-1!==f&&b.push(f,c.length),c.push(...e))}}c.length&&b.push(255,...c);return b}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(b.used){var c=[];a.rom.subarray(b.dataBase,b.dataBase+4).set(b.data);c.push(a.write(b.spawnConditionsBytes(),114688,122879,`SpawnCondition ${hex$$module$rom$util(b.id)}`).then((c)=>writeLittleEndian$$module$rom$util(a.rom,
b.spawnPointer,c-81920)));b.dialogPointer&&c.push(a.write(b.dialogBytes(),114688,122879,`Dialog ${hex$$module$rom$util(b.id)}`).then((c)=>writeLittleEndian$$module$rom$util(a.rom,b.dialogPointer,c-81920)));yield Promise.all(c)}})}}
class GlobalDialog$$module$rom$npc{constructor(a,b){this.condition=a;this.message=b}static of(a,b){const [c,d,e=0]=b;return new GlobalDialog$$module$rom$npc(a,MessageId$$module$rom$messageid.of({part:c,index:d,action:e}))}static parse(a,b){b=void 0===b?0:b;const c=readBigEndian$$module$rom$util(a,b);a=MessageId$$module$rom$messageid.from(a,b+2);b=c&1023;const d=!!(c&32768);c&8192&&(b=~b);return[new GlobalDialog$$module$rom$npc(b,a),d]}bytes(a){let b=this.condition;0>b&&(b=~b|8192);a&&(b|=32768);return[b>>>
8,b&255,...this.message.data]}}
class LocalDialog$$module$rom$npc{constructor(a,b,c,d){this.condition=a;this.message=b;this.update=c;this.flags=d}clone(){return LocalDialog$$module$rom$npc.parse(this.bytes(!1))[0]}static parse(a,b){b=void 0===b?0:b;const c=readBigEndian$$module$rom$util(a,b),d=MessageId$$module$rom$messageid.from(a,b+2),e=a[b+4];let f=c&1023;const g=!!(c&32768);c&8192&&(f=~f);a=c&16384?DIALOG_FLAGS$$module$rom$util.read(a,b+5):[];return[new LocalDialog$$module$rom$npc(f,d,e,a),g]}static of(a,b,c){c=void 0===c?[]:
c;const [d,e,f=0]=b;return new LocalDialog$$module$rom$npc(a,MessageId$$module$rom$messageid.of({part:d,index:e,action:f}),0,c)}byteLength(){return 5+2*this.flags.length}bytes(a){let b=this.condition;0>b&&(b=~b|8192);a&&(b|=32768);this.flags.length&&(b|=16384);return[b>>>8,b&255,...this.message.data,this.update,...DIALOG_FLAGS$$module$rom$util.bytes(this.flags)]}}const UNUSED_NPCS$$module$rom$npc=new Set([49,60,106,115,130,134,135,137,138,139,140,141]);var module$rom$npc={};module$rom$npc.Npc=Npc$$module$rom$npc;
module$rom$npc.GlobalDialog=GlobalDialog$$module$rom$npc;module$rom$npc.LocalDialog=LocalDialog$$module$rom$npc;class ObjectData$$module$rom$objectdata extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.used=!0;this.name="";this.pointer=109568+(b<<1);this.base=readLittleEndian$$module$rom$util(a.prg,this.pointer)+65536;this.sfx=a.prg[this.base];this.data=[];b=this.base+1;let c=0;for(let d=0;32>d;d++)d&7||(c=a.prg[b++]),this.data.push(c&128?a.prg[b++]:0),c<<=1}serialize(){const a=[this.sfx];for(let b=0;4>b;b++){const c=a.length;a.push(0);for(let d=0;8>d;d++)this.data[8*b+d]&&(a[c]|=128>>>d,a.push(this.data[8*
b+d]))}return a}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const c=yield a.write(b.serialize(),106496,114687,`Object ${hex$$module$rom$util(b.id)}`);writeLittleEndian$$module$rom$util(a.rom,b.pointer,c-65536)})}get(a){return this.data[a-768>>>5]}parents(){return this.rom.monsters.filter((a)=>a.child&&this.rom.adHocSpawns[a.child].objectId===this.id)}locations(){return this.rom.locations.filter((a)=>a.used&&a.spawns.some((a)=>a.isMonster()&&a.monsterId===
this.id))}palettes(a){if(34===this.action)return[3];let b=this.data[0];42===this.action&&(b=this.data[31]|1);41===this.action&&(b=107);38===this.action&&(b=156);a=(void 0===a?0:a)&&this.child?this.rom.metasprites[this.rom.objects[this.rom.adHocSpawns[this.child].objectId].data[0]]:null;return[...new Set([...this.rom.metasprites[b].palettes(),...a?a.palettes():[]])]}get metasprite(){return METASPRITE$$module$rom$objectdata.get(this.data)}set metasprite(a){METASPRITE$$module$rom$objectdata.set(this.data,
a)}get collisionPlane(){return COLLISION_PLANE$$module$rom$objectdata.get(this.data)}set collisionPlane(a){COLLISION_PLANE$$module$rom$objectdata.set(this.data,a)}get hitbox(){return HITBOX$$module$rom$objectdata.get(this.data)}set hitbox(a){HITBOX$$module$rom$objectdata.set(this.data,a)}get hp(){return HP$$module$rom$objectdata.get(this.data)}set hp(a){HP$$module$rom$objectdata.set(this.data,a)}get atk(){return ATK$$module$rom$objectdata.get(this.data)}set atk(a){ATK$$module$rom$objectdata.set(this.data,
a)}get def(){return DEF$$module$rom$objectdata.get(this.data)}set def(a){DEF$$module$rom$objectdata.set(this.data,a)}get level(){return LEVEL$$module$rom$objectdata.get(this.data)}set level(a){LEVEL$$module$rom$objectdata.set(this.data,a)}get child(){return CHILD$$module$rom$objectdata.get(this.data)}set child(a){CHILD$$module$rom$objectdata.set(this.data,a)}get terrainSusceptibility(){return TERRAIN_SUSCEPTIBILITY$$module$rom$objectdata.get(this.data)}set terrainSusceptibility(a){TERRAIN_SUSCEPTIBILITY$$module$rom$objectdata.set(this.data,
a)}get immobile(){return!!IMMOBILE$$module$rom$objectdata.get(this.data)}set immobile(a){IMMOBILE$$module$rom$objectdata.set(this.data,a?1:0)}get action(){return ACTION$$module$rom$objectdata.get(this.data)}set action(a){ACTION$$module$rom$objectdata.set(this.data,a)}get replacement(){return REPLACEMENT$$module$rom$objectdata.get(this.data)}set replacement(a){REPLACEMENT$$module$rom$objectdata.set(this.data,a)}get goldDrop(){return GOLD_DROP$$module$rom$objectdata.get(this.data)}set goldDrop(a){GOLD_DROP$$module$rom$objectdata.set(this.data,
a)}get elements(){return ELEMENTS$$module$rom$objectdata.get(this.data)}set elements(a){ELEMENTS$$module$rom$objectdata.set(this.data,a)}get expReward(){return EXP_REWARD$$module$rom$objectdata.get(this.data)}set expReward(a){EXP_REWARD$$module$rom$objectdata.set(this.data,a)}get attackType(){return ATTACK_TYPE$$module$rom$objectdata.get(this.data)}set attackType(a){ATTACK_TYPE$$module$rom$objectdata.set(this.data,a)}}
function prop$$module$rom$objectdata(...a){return new Stat$$module$rom$objectdata(...a)}class Stat$$module$rom$objectdata{constructor(...a){this.spec=a}get(a){let b=0;for(const c of this.spec){const [d,e=255,f=0]=c;b|=(a[d-768>>>5]&e)>>>(0>f?0:f)<<(0>f?-f:0)}return b}set(a,b){for(const c of this.spec){const [d,e=255,f=0]=c;{const c=d-768>>>5;a[c]=a[c]&~e|b>>>(0>f?-f:0)<<(0>f?0:f)&e}}}}
const METASPRITE$$module$rom$objectdata=prop$$module$rom$objectdata([768]),COLLISION_PLANE$$module$rom$objectdata=prop$$module$rom$objectdata([928,240,4]),HITBOX$$module$rom$objectdata=prop$$module$rom$objectdata([1056,64,2],[928,15]),HP$$module$rom$objectdata=prop$$module$rom$objectdata([960]),ATK$$module$rom$objectdata=prop$$module$rom$objectdata([992]),DEF$$module$rom$objectdata=prop$$module$rom$objectdata([1024]),LEVEL$$module$rom$objectdata=prop$$module$rom$objectdata([1056,31]),CHILD$$module$rom$objectdata=
prop$$module$rom$objectdata([1088]),TERRAIN_SUSCEPTIBILITY$$module$rom$objectdata=prop$$module$rom$objectdata([1120]),IMMOBILE$$module$rom$objectdata=prop$$module$rom$objectdata([1184,128,7]),ACTION$$module$rom$objectdata=prop$$module$rom$objectdata([1184,127]),REPLACEMENT$$module$rom$objectdata=prop$$module$rom$objectdata([1216]),GOLD_DROP$$module$rom$objectdata=prop$$module$rom$objectdata([1280,240,4]),ELEMENTS$$module$rom$objectdata=prop$$module$rom$objectdata([1280,15]),EXP_REWARD$$module$rom$objectdata=
prop$$module$rom$objectdata([1312]),ATTACK_TYPE$$module$rom$objectdata=prop$$module$rom$objectdata([1344]);var module$rom$objectdata={};module$rom$objectdata.ObjectData=ObjectData$$module$rom$objectdata;var RomOption$$module$rom$option;(function(a){a.bit=(a,c)=>new RomOptionBit$$module$rom$option(a,c);a.byte=(a)=>new RomOptionByte$$module$rom$option(a);a.address=(a)=>new RomOptionAddress$$module$rom$option(a)})(RomOption$$module$rom$option||(RomOption$$module$rom$option={}));class RomOptionBit$$module$rom$option{constructor(a,b){this.address=a;this.bit=b}get(a){return!!(a[this.address]&1<<this.bit)}set(a,b){const c=1<<this.bit;a[this.address]=b?a[this.address]|c:a[this.address]&~c}}
class RomOptionByte$$module$rom$option{constructor(a){this.address=a}get(a){return a[this.address]}set(a,b){a[this.address]=b&255}}class RomOptionAddress$$module$rom$option{constructor(a){this.address=a}get(a){return a[this.address]<<16|a[this.address+1]<<8|a[this.address+2]}set(a,b){a[this.address]=b>>>16&255;a[this.address+1]=b>>>8&255;a[this.address+2]=b&255}}var module$rom$option={};module$rom$option.RomOption=RomOption$$module$rom$option;class Palette$$module$rom$palette extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=(b&3)<<2|(b&252)<<6|16624;this.colors=tuple$$module$rom$util(a.prg,this.base,4)}color(a){return this.colors[a]&63}}var module$rom$palette={};module$rom$palette.Palette=Palette$$module$rom$palette;class Pattern$$module$rom$pattern extends Entity$$module$rom$entity{constructor(a,b,c){super(a,b);this.pixels=c||tuple$$module$rom$util(a.chr,b<<4,16)}pixelAt(a,b){return(this.pixels[a|8]>>b&1)<<1|this.pixels[a]>>b&1}flipH(){return new Pattern$$module$rom$pattern(this.rom,-1,this.pixels.map(reverseBits$$module$rom$util))}flipV(){return new Pattern$$module$rom$pattern(this.rom,-1,seq$$module$rom$util(16,(a)=>this.pixels[a&8|~a&7]))}flip(a){let b=this;a&Flip$$module$rom$pattern.HORIZONTAL&&(b=b.flipH());
a&Flip$$module$rom$pattern.VERTICAL&&(b=b.flipV());return b}}var Flip$$module$rom$pattern;(function(a){a[a.HORIZONTAL=64]="HORIZONTAL";a[a.VERTICAL=128]="VERTICAL"})(Flip$$module$rom$pattern||(Flip$$module$rom$pattern={}));var module$rom$pattern={};module$rom$pattern.Pattern=Pattern$$module$rom$pattern;module$rom$pattern.Flip=Flip$$module$rom$pattern;class Screen$$module$rom$screen extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=(255<b?64+b:b)<<8;this.tiles=seq$$module$rom$util(15,(b)=>tuple$$module$rom$util(a.prg,this.base|b<<4,16))}allTilesSet(){const a=new Set;for(const b of this.tiles)for(const c of b)a.add(c);return a}write(a){let b=this.base;for(const c of this.tiles)for(const d of c)a.rom[b++]=d}}var module$rom$screen={};module$rom$screen.Screen=Screen$$module$rom$screen;var ShopType$$module$rom$shop;(function(a){a[a.ARMOR=0]="ARMOR";a[a.TOOL=1]="TOOL";a[a.INN=2]="INN";a[a.PAWN=3]="PAWN"})(ShopType$$module$rom$shop||(ShopType$$module$rom$shop={}));
const SHOP_TYPES$$module$rom$shop=[ShopType$$module$rom$shop.ARMOR,ShopType$$module$rom$shop.TOOL,ShopType$$module$rom$shop.INN,ShopType$$module$rom$shop.PAWN],CONTENTS_ADDRESSES$$module$rom$shop=[(a,b)=>a?a:VANILLA_ARMOR_SHOP_ITEMS$$module$rom$shop,(a,b)=>a?a+4*b:VANILLA_TOOL_SHOP_ITEMS$$module$rom$shop,(a,b)=>0,(a,b)=>0],CONTENTS_COUNTS$$module$rom$shop=[4,4,0,0],PRICES_ADDRESSES$$module$rom$shop=[(a,b)=>a?a+8*b:VANILLA_ARMOR_SHOP_PRICES$$module$rom$shop,(a,b)=>a?a+12*b:VANILLA_TOOL_SHOP_PRICES$$module$rom$shop,
(a,b)=>a?a+16*b:VANILLA_INN_PRICES$$module$rom$shop,(a,b)=>0],PRICES_COUNTS$$module$rom$shop=[4,4,1,0];
class Shop$$module$rom$shop extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.type=SHOP_TYPES$$module$rom$shop[b&3];this.index=b>>>2;if(a.shopDataTablesAddress)this.location=a.prg[a.shopDataTablesAddress+17*a.shopCount+b];else for(this.location=255,b=0;33>b&&255===this.location;b++){if(a.prg[VANILLA_SHOP_INDICES$$module$rom$shop+b]!==this.index)continue;const d=a.prg[VANILLA_SHOP_LOCATIONS$$module$rom$shop+b];for(var c of a.locations[d].spawns)if(4===c.type&&a.objects[c.id].data[25]===
32+this.type){this.location=d;break}}c=a.shopDataTablesAddress?(b)=>a.prg[this.pricesAddress+b]/32:(b)=>readLittleEndian$$module$rom$util(a.prg,this.pricesAddress+2*b);this.contents=tuple$$module$rom$util(a.prg,this.contentsAddress,CONTENTS_COUNTS$$module$rom$shop[this.type]);this.prices=seq$$module$rom$util(PRICES_COUNTS$$module$rom$shop[this.type],c);this.used=255!==this.location}get contentsAddress(){return CONTENTS_ADDRESSES$$module$rom$shop[this.type](this.rom.shopDataTablesAddress,this.rom.shopCount)+
4*this.index}get pricesAddress(){const a=this.rom.shopDataTablesAddress;return PRICES_ADDRESSES$$module$rom$shop[this.type](a,this.rom.shopCount)+(a?1:2)*PRICES_COUNTS$$module$rom$shop[this.type]*this.index}updateShopkeeper(){throw Error("not implemented");}write(a){const b=this.rom.shopDataTablesAddress,c=a.rom;a=b?(a,b)=>c[this.pricesAddress+a]=Math.round(32*b):(a,b)=>writeLittleEndian$$module$rom$util(c,this.pricesAddress+2*a,b);for(var d=0;d<CONTENTS_COUNTS$$module$rom$shop[this.type];d++)c[this.contentsAddress+
d]=null!=this.contents[d]?this.contents[d]:255;for(d=0;d<PRICES_COUNTS$$module$rom$shop[this.type];d++)a(d,this.prices[d]||0);b&&(c[b+17*this.rom.shopCount+this.id]=this.location)}}
const VANILLA_SHOP_LOCATIONS$$module$rom$shop=139092,VANILLA_SHOP_INDICES$$module$rom$shop=139125,VANILLA_ARMOR_SHOP_ITEMS$$module$rom$shop=138660,VANILLA_ARMOR_SHOP_PRICES$$module$rom$shop=138704,VANILLA_TOOL_SHOP_ITEMS$$module$rom$shop=138792,VANILLA_TOOL_SHOP_PRICES$$module$rom$shop=138836,VANILLA_INN_PRICES$$module$rom$shop=138924;var module$rom$shop={};module$rom$shop.ShopType=ShopType$$module$rom$shop;module$rom$shop.Shop=Shop$$module$rom$shop;var Sage$$module$rom$telepathy;(function(a){a[a.TORNEL=0]="TORNEL";a[a.ZEBU=1]="ZEBU";a[a.ASINA=2]="ASINA";a[a.KENSU=3]="KENSU"})(Sage$$module$rom$telepathy||(Sage$$module$rom$telepathy={}));var DefaultMessage$$module$rom$telepathy;(function(a){a[a.INSUFFICIENT_MAGIC=0]="INSUFFICIENT_MAGIC";a[a.FREE_MAGIC=1]="FREE_MAGIC";a[a.IGNORED=2]="IGNORED";a[a.DEFAULT=3]="DEFAULT"})(DefaultMessage$$module$rom$telepathy||(DefaultMessage$$module$rom$telepathy={}));
const RESULT_TABLE$$module$rom$telepathy=115247,VANILLA_LEVELS_TABLE$$module$rom$telepathy=115219,VANILLA_LOCATION_TABLE$$module$rom$telepathy=121076,VANILLA_MAIN_TABLE$$module$rom$telepathy=121332,VANILLA_DEFAULTS_TABLE$$module$rom$telepathy=121388;
class Telepathy$$module$rom$telepathy{constructor(a){this.rom=a;this.sages=seq$$module$rom$util(4,(a)=>new SageData$$module$rom$telepathy(this,a));this.resultTable=tuple$$module$rom$util(a.prg,RESULT_TABLE$$module$rom$telepathy,64);a.telepathyTablesAddress?(this.groupsByLocation=[],this.minimumLevels=[]):(this.groupsByLocation=tuple$$module$rom$util(a.prg,VANILLA_LOCATION_TABLE$$module$rom$telepathy,256),this.minimumLevels=tuple$$module$rom$util(a.prg,VANILLA_LEVELS_TABLE$$module$rom$telepathy,7))}write(a){let b=
this.rom.telepathyTablesAddress;const c=[];if(b){write$$module$rom$util(a.rom,RESULT_TABLE$$module$rom$telepathy,this.resultTable.map((a)=>4>a?a:a>>>1));for(let f=0;4>f;f++){var d=this.sages[f];for(var e=1;4>e;e++)write$$module$rom$util(a.rom,b+8*e+2*f,this.sages[f].defaultMessages[e].data);c.push(a.write(d.messageGroups[0].bytes(),114688,122880,`Sage ${f}`).then((c)=>writeLittleEndian$$module$rom$util(a.rom,b+2*f,c-81920)))}}else for(write$$module$rom$util(a.rom,RESULT_TABLE$$module$rom$telepathy,
this.resultTable),write$$module$rom$util(a.rom,VANILLA_LEVELS_TABLE$$module$rom$telepathy,this.minimumLevels),write$$module$rom$util(a.rom,VANILLA_LOCATION_TABLE$$module$rom$telepathy,this.groupsByLocation),d=0;4>d;d++){e=this.sages[d];b=VANILLA_DEFAULTS_TABLE$$module$rom$telepathy+2*d;for(let c=0;4>c;c++)write$$module$rom$util(a.rom,b+8*c,e.defaultMessages[c].data);b=VANILLA_MAIN_TABLE$$module$rom$telepathy+2*d;for(let f=0,g=e.messageGroups.length;f<g;f++)c.push(a.write(e.messageGroups[f].bytes(),
114688,122880,`Sage ${d}`).then((c)=>writeLittleEndian$$module$rom$util(a.rom,b+8*f,c-81920)))}return Promise.all(c).then(()=>{})}}
class SageData$$module$rom$telepathy{constructor(a,b){this.telepathy=a;this.sage=b;const c=a.rom;let d,e;c.telepathyTablesAddress?(e=d=c.telepathyTablesAddress+2*b,a=1):(d=VANILLA_DEFAULTS_TABLE$$module$rom$telepathy+2*b,e=VANILLA_MAIN_TABLE$$module$rom$telepathy+2*b,a=7);this.defaultMessages=seq$$module$rom$util(4,(a)=>MessageId$$module$rom$messageid.from(c.prg,d+8*a));this.messageGroups=seq$$module$rom$util(a,(a)=>TelepathyMessageGroup$$module$rom$telepathy.from(c.prg,e+8*a))}}
class TelepathyMessageGroup$$module$rom$telepathy{constructor(a){this.messages=a}bytes(){const a=[];for(let b=0,c=this.messages.length;b<c;b++){const [d,e,f]=this.messages[b];let g=0<=d?d:8192|~d;b===c-1&&(g|=32768);f&&(g|=16384);a.push(g>>=8,g&255,...e.data,...f?f.data:[])}return a}static from(a,b){const c=new TelepathyMessageGroup$$module$rom$telepathy([]);b=readLittleEndian$$module$rom$util(a,b)+81920;let d=0;for(;!(d&32768);){d=readBigEndian$$module$rom$util(a,b);b+=2;var e=d&8191;d&8192&&(e=
~e);e=[e,MessageId$$module$rom$messageid.from(a,b)];b+=2;d&16384&&(e.push(MessageId$$module$rom$messageid.from(a,b)),b+=2);c.messages.push(e)}return c}}var module$rom$telepathy={};module$rom$telepathy.Sage=Sage$$module$rom$telepathy;module$rom$telepathy.DefaultMessage=DefaultMessage$$module$rom$telepathy;module$rom$telepathy.Telepathy=Telepathy$$module$rom$telepathy;module$rom$telepathy.SageData=SageData$$module$rom$telepathy;module$rom$telepathy.TelepathyMessageGroup=TelepathyMessageGroup$$module$rom$telepathy;class TileAnimation$$module$rom$tileanimation extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=255865+(b<<3);this.pages=tuple$$module$rom$util(a.prg,this.base,8)}}var module$rom$tileanimation={};module$rom$tileanimation.TileAnimation=TileAnimation$$module$rom$tileanimation;class TileEffects$$module$rom$tileeffects extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=b<<8&8191|73728;this.effects=tuple$$module$rom$util(a.prg,this.base,256)}write(a){for(let b=0;256>b;b++)a.rom[this.base+b]=this.effects[b]}}var module$rom$tileeffects={};module$rom$tileeffects.TileEffects=TileEffects$$module$rom$tileeffects;class Tileset$$module$rom$tileset extends Entity$$module$rom$entity{constructor(a,b){super(a,b);b&=63;this.tileBase=65536|b<<8;this.attrBase=77824|b<<4;this.alternatesBase=81408|b<<3;this.tiles=seq$$module$rom$util(4,(b)=>tuple$$module$rom$util(a.prg,this.tileBase|b<<8,256));this.attrs=seq$$module$rom$util(256,(b)=>a.prg[this.attrBase|b>>2]>>((b&3)<<1)&3);this.alternates=tuple$$module$rom$util(a.prg,this.alternatesBase,32)}write(a){for(var b=0;256>b;b++){32>b&&(a.rom[this.alternatesBase+b]=this.alternates[b]);
for(var c=0;4>c;c++)a.rom[this.tileBase+(c<<8)+b]=this.tiles[c][b]}for(b=0;64>b;b++)c=b<<2,a.rom[this.attrBase+b]=this.attrs[c]&3|(this.attrs[c+1]&3)<<2|(this.attrs[c+2]&3)<<4|(this.attrs[c+3]&3)<<6}}var module$rom$tileset={};module$rom$tileset.Tileset=Tileset$$module$rom$tileset;const UNUSED_TRIGGERS$$module$rom$trigger=new Set([135,136,137,143,147,150,152,155,156,157,158,159,160,181,185,190,192]);
class Trigger$$module$rom$trigger extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.used=!UNUSED_TRIGGERS$$module$rom$trigger.has(b);this.pointer=123258+((b&127)<<1);this.base=addr$$module$rom$util(a.prg,this.pointer,81920);this.conditions=[];this.message=new MessageId$$module$rom$messageid;this.flags=[];let c=this.base;do{b=readBigEndian$$module$rom$util(a.prg,c);var d=b&4095;this.conditions.push(b&8192?~d:d);c+=2}while(!(b&32768));this.message=MessageId$$module$rom$messageid.from(a.prg,
c);do c+=2,b=readBigEndian$$module$rom$util(a.prg,c),d=b&4095,this.flags.push(b&32768?~d:d);while(!(b&16384))}bytes(){const a=[];this.conditions.length||this.conditions.push(-1);for(var b=0;b<this.conditions.length;b++){var c=this.conditions[b];0>c&&(c=~c|8192);b===this.conditions.length-1&&(c|=32768);a.push(c>>>8,c&255)}a.push(...this.message.data);this.flags.length||this.flags.push(-1);for(b=0;b<this.flags.length;b++)c=this.flags[b],0>c&&(c=~c|32768),b===this.flags.length-1&&(c|=16384),a.push(c>>>
8,c&255);return a}write(a,b){b=void 0===b?123258:b;const c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(c.used){var d=yield a.write(c.bytes(),122880,131071,`Trigger ${hex$$module$rom$util(c.id)}`);a.rom[b+2*(c.id&127)]=d&255;a.rom[b+2*(c.id&127)+1]=(d>>>8)-64}})}}var module$rom$trigger={};module$rom$trigger.Trigger=Trigger$$module$rom$trigger;function page$$module$rom$writer(a){return a>>>13}class Chunk$$module$rom$writer{constructor(a,b){this.start=a;this.end=b;this.page=page$$module$rom$writer(a);if(page$$module$rom$writer(b-1)!==this.page)throw Error("Chunk spans pages");this.pos=a}free(){return this.end-this.pos}find(a,b){for(let c=this.start;c<=this.pos-a.length;c++){let d=!0;for(let e=0;e<a.length;e++)if(b[c+e]!==a[e]){d=!1;break}if(d)return c}return-1}}
class Writer$$module$rom$writer{constructor(a){this.rom=a;this.chunks=[];this.writes=[];this.promises=[];this.free=[]}alloc(a,b){for(;page$$module$rom$writer(b-1)>page$$module$rom$writer(a);){const b=page$$module$rom$writer(a)+1<<13;this.addChunk(new Chunk$$module$rom$writer(a,b-1));a=b}this.addChunk(new Chunk$$module$rom$writer(a,b))}addChunk(a){this.chunks.push(a);this.free[a.page]=(this.free[a.page]||0)+a.free()}write(a,b,c,d){const e=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const f=
page$$module$rom$writer(b),g=page$$module$rom$writer(c-1),h=new Promise((b,c)=>{e.writes.push({data:a,resolve:b,reject:c,startPage:f,endPage:g,name:d})});e.promises.push(h.catch(()=>{}));return h})}commit(){const a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){for(;a.writes.length;){var b=a.writes;a.writes=[];const c=a.promises;a.promises=[];b.sort((a,b)=>a.endPage-a.startPage-(b.endPage-b.startPage)||b.data.length-a.data.length);for(const c of b)b=a.find(c),0<=b?c.resolve(b):
a.writeOne(c);yield Promise.all(c);yield 0;yield 0;yield 0}})}find(a){var {data:b,startPage:c,endPage:d}=a;for(const e of this.chunks)if(!(e.page<c||e.page>d)&&(a=e.find(b,this.rom),0<=a))return a;return-1}writeOne(a){for(const b of this.chunks)if(!(b.page<a.startPage||b.page>a.endPage||b.free()<a.data.length)){this.rom.subarray(b.pos,b.pos+a.data.length).set(a.data);a.resolve(b.pos);this.free[b.page]-=a.data.length;b.pos+=a.data.length;return}console.log(`${a.name}: WRITE FAILED ${a.data.length} bytes: ${Array.from(a.data,
hex$$module$rom$util).join(" ")}`);a.reject(Error(`Could not find sufficient chunk in ${hex$$module$rom$util(a.startPage)}..${hex$$module$rom$util(a.endPage)} to write ${a.name}: ${a.data}`))}}var module$rom$writer={};module$rom$writer.Writer=Writer$$module$rom$writer;class UnionFind$$module$unionfind{constructor(){this.data=new Map;this.sizes=new Map}find(a){this.data.has(a)||(this.data.set(a,a),this.sizes.set(a,1));let b;for(;(b=this.data.get(a))!==a;)this.data.set(a,a=this.data.get(b));return a}union(a){this.find(a[0]);for(let b=1;b<a.length;b++)this.unionInternal(a[0],a[b])}unionInternal(a,b){a=this.find(a);b=this.find(b);if(a!==b){var c=this.sizes.get(a),d=this.sizes.get(b);c<d?(this.sizes.set(b,c+d),this.data.set(a,b)):(this.sizes.set(a,c+d),this.data.set(b,
a))}}sets(){const a=new Map;for(const b of this.data.keys()){const c=this.find(b);a.has(c)||a.set(c,new Set);a.get(c).add(b)}return[...a.values()]}}var module$unionfind={};module$unionfind.UnionFind=UnionFind$$module$unionfind;class Rom$$module$rom{constructor(a){this.prg=a.subarray(16,262160);this.chr=a.subarray(262160);this.shopCount=Rom$$module$rom.SHOP_COUNT.get(a);this.scalingLevels=Rom$$module$rom.SCALING_LEVELS.get(a);this.uniqueItemTableAddress=Rom$$module$rom.UNIQUE_ITEM_TABLE.get(a);this.shopDataTablesAddress=Rom$$module$rom.SHOP_DATA_TABLES.get(a);this.telepathyTablesAddress=Rom$$module$rom.TELEPATHY_TABLES.get(a);this.omitItemGetDataSuffix=Rom$$module$rom.OMIT_ITEM_GET_DATA_SUFFIX.get(a);this.omitLocalDialogSuffix=
Rom$$module$rom.OMIT_LOCAL_DIALOG_SUFFIX.get(a);for(const a of ADJUSTMENTS$$module$rom){const [b,d]=a;this.prg[b]=d}this.screens=seq$$module$rom$util(259,(a)=>new Screen$$module$rom$screen(this,a));this.tilesets=seq$$module$rom$util(12,(a)=>new Tileset$$module$rom$tileset(this,a<<2|128));this.tileEffects=seq$$module$rom$util(11,(a)=>new TileEffects$$module$rom$tileeffects(this,a+179));this.triggers=seq$$module$rom$util(67,(a)=>new Trigger$$module$rom$trigger(this,128|a));this.patterns=seq$$module$rom$util(this.chr.length>>
4,(a)=>new Pattern$$module$rom$pattern(this,a));this.palettes=seq$$module$rom$util(256,(a)=>new Palette$$module$rom$palette(this,a));this.locations=seq$$module$rom$util(256,(a)=>new Location$$module$rom$location(this,a));this.tileAnimations=seq$$module$rom$util(4,(a)=>new TileAnimation$$module$rom$tileanimation(this,a));this.hitboxes=seq$$module$rom$util(24,(a)=>new Hitbox$$module$rom$hitbox(this,a));this.objects=seq$$module$rom$util(256,(a)=>new ObjectData$$module$rom$objectdata(this,a));this.adHocSpawns=
seq$$module$rom$util(96,(a)=>new AdHocSpawn$$module$rom$adhocspawn(this,a));this.metasprites=seq$$module$rom$util(256,(a)=>new Metasprite$$module$rom$metasprite(this,a));this.messages=new Messages$$module$rom$messages(this);this.telepathy=new Telepathy$$module$rom$telepathy(this);this.itemGets=seq$$module$rom$util(113,(a)=>new ItemGet$$module$rom$itemget(this,a));this.items=seq$$module$rom$util(73,(a)=>new Item$$module$rom$item(this,a));this.shops=seq$$module$rom$util(44,(a)=>new Shop$$module$rom$shop(this,
a));this.npcs=seq$$module$rom$util(205,(a)=>new Npc$$module$rom$npc(this,a));this.bossKills=seq$$module$rom$util(14,(a)=>new BossKill$$module$rom$bosskill(this,a))}trigger(a){if(128>a||255<a)throw Error(`Bad trigger id $${hex$$module$rom$util(a)}`);return this.triggers[a&127]}get monsters(){const a=new Set;for(const b of this.locations)if(b.used&&b.hasSpawns)for(const c of b.spawns)c.isMonster()&&a.add(this.objects[c.monsterId]);return[...a].sort((a,c)=>a.id-c.id)}get projectiles(){const a=new Set;
for(const b of this.monsters)b.child&&a.add(this.objects[this.adHocSpawns[b.child].objectId]);return[...a].sort((a,c)=>a.id-c.id)}get monsterGraphics(){const a={};for(const b of this.locations)if(b.used&&b.hasSpawns)for(const c of b.spawns)if(!(c.data[2]&7)){const d=c.data[2]&128?1:0,e=hex$$module$rom$util(c.data[3]+80);(a[e]=a[e]||{})[`${d}:${b.spritePatterns[d].toString(16)}:${b.spritePalettes[d].toString(16)}`]={pal:b.spritePalettes[d],pat:b.spritePatterns[d],slot:d}}return a}get locationMonsters(){const a=
{};for(const b of this.locations){if(!b.used||!b.hasSpawns)continue;const c=a["$"+hex$$module$rom$util(b.id)]={};for(const a of b.spawns)if(!(a.data[2]&7)){const b=a.data[2]&128?1:0,d=a.data[3]+80;c[`${b}:${d.toString(16)}`]=(c[`${b}:${d.toString(16)}`]||0)+1}}return a}static load(a){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const b=yield pickFile$$module$rom();a&&(yield a(b));return new Rom$$module$rom(b)})}writeData(){const a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){Rom$$module$rom.SHOP_COUNT.set(a.prg,
a.shopCount);Rom$$module$rom.SCALING_LEVELS.set(a.prg,a.scalingLevels);Rom$$module$rom.UNIQUE_ITEM_TABLE.set(a.prg,a.uniqueItemTableAddress);Rom$$module$rom.SHOP_DATA_TABLES.set(a.prg,a.shopDataTablesAddress);Rom$$module$rom.OMIT_ITEM_GET_DATA_SUFFIX.set(a.prg,a.omitItemGetDataSuffix);Rom$$module$rom.OMIT_LOCAL_DIALOG_SUFFIX.set(a.prg,a.omitLocalDialogSuffix);const b=new Writer$$module$rom$writer(a.prg);b.alloc(83192,97792);b.alloc(103417,109568);b.alloc(110080,113920);b.alloc(116602,117085);b.alloc(117477,
121076);b.alloc(122342,122981);b.alloc(123392,123840);b.alloc(135450,136296);b.alloc(172032,195584);a.telepathyTablesAddress?b.alloc(121076,121600):b.alloc(121420,121600);const c=[],d=(a)=>{for(const d of a)c.push(d.write(b))};d(a.locations);d(a.objects);d(a.hitboxes);d(a.triggers);d(a.npcs);d(a.tilesets);d(a.tileEffects);d(a.screens);d(a.adHocSpawns);d(a.itemGets);d(a.items);d(a.shops);d(a.bossKills);c.push(a.telepathy.write(b));c.push(a.messages.write(b));c.push(b.commit());yield Promise.all(c).then(()=>
{})})}analyzeTiles(){}disjointTilesets(){var a=[];for(var b of this.locations)if(b.used){var c=b.tileset,d=b.extended?256:0;for(const e of b.screens)for(const b of e)(a[b+d]||(a[b+d]=new Set)).add(c)}b=seq$$module$rom$util(256,()=>new UnionFind$$module$unionfind);for(c=0;c<a.length;c++)if(a[c]){d=new Set;for(var e of this.screens[c].tiles)for(const a of e)d.add(a);for(const e of d)b[e].union([...a[c]])}for(a=0;a<b.length;a++)e=b[a].sets().map((a)=>[...a].map(hex$$module$rom$util).join(" ")).join(" | "),
console.log(`Tile ${hex$$module$rom$util(a)}: ${e}`)}swapMetatiles(a,...b){var c=new Map,d=seq$$module$rom$util(256);const e=new Map,f=(a)=>Array.isArray(a)?a[0]:0>a?~a:a;for(var g of b){for(var h=0;h<g.length-1;h++)if(Array.isArray(g[h])){var k=g[h];e.set(k[0],k[1]);g[h]=k[0]}for(h=0;h<g.length-1;h++){k=g[h];const a=g[h+1];0>k||0>a||(c.set(a,k),d[a]=k)}}g=new Set;c=new Set;a=new Set(a);for(var l of this.locations)if(l.used&&a.has(l.tileset)){c.add(l.tileEffects);for(var m of l.allScreens())g.add(m)}for(var n of g)for(var p of n.tiles)for(l=
0;l<p.length;l++)p[l]=d[p[l]];for(var q of a){d=this.tilesets[(q&127)>>>2];for(var r of b)for(n=0;n<r.length-1;n++){p=f(r[n]);l=f(r[n+1]);for(m=0;4>m;m++)d.tiles[m][p]=d.tiles[m][l];d.attrs[p]=d.attrs[l];if(32>l&&d.alternates[l]!==l){if(32<=p)throw Error(`Cannot unflag: ${q} ${p} ${l} ${d.alternates[l]}`);d.alternates[p]=d.alternates[l]}}for(var u of e){const [a,b]=u;d.alternates[a]=b}}for(const a of c){q=this.tileEffects[a-179];for(const a of b)for(r=0;r<a.length-1;r++)u=f(a[r]),d=f(a[r+1]),q.effects[u]=
q.effects[d];for(const a of e.keys())q.effects[a]|=8}}}Rom$$module$rom.OMIT_ITEM_GET_DATA_SUFFIX=module$rom$option.RomOption.bit(82624,0);Rom$$module$rom.OMIT_LOCAL_DIALOG_SUFFIX=module$rom$option.RomOption.bit(82624,1);Rom$$module$rom.SHOP_COUNT=module$rom$option.RomOption.byte(82625);Rom$$module$rom.SCALING_LEVELS=module$rom$option.RomOption.byte(82626);Rom$$module$rom.UNIQUE_ITEM_TABLE=module$rom$option.RomOption.address(82640);Rom$$module$rom.SHOP_DATA_TABLES=module$rom$option.RomOption.address(82643);
Rom$$module$rom.TELEPATHY_TABLES=module$rom$option.RomOption.address(82646);
function pickFile$$module$rom(){return new Promise((a)=>{if("#reset"!==window.location.hash){const b=localStorage.getItem("rom");if(b)return a(Uint8Array.from(Array(b.length/2).fill(0).map((a,c)=>Number.parseInt(b[2*c]+b[2*c+1],16))))}const b=document.createElement("input");document.body.appendChild(b);b.type="file";b.addEventListener("change",()=>{const c=b.files[0],d=new FileReader;d.addEventListener("loadend",()=>{const c=new Uint8Array(d.result),f=Array.from(c,hex$$module$rom$util).join("");localStorage.setItem("rom",
f);b.remove();a(c)});d.readAsArrayBuffer(c)})})}const EXPECTED_CRC32$$module$rom=466849842,ADJUSTMENTS$$module$rom=new Map([[118533,72],[119569,160],[119570,0],[118777,224],[182928,0],[193907,0],[195300,0]]);var module$rom={};module$rom.Rom=Rom$$module$rom;module$rom.EXPECTED_CRC32=EXPECTED_CRC32$$module$rom;const STATUS$$module$version="unstable",VERSION$$module$version="latest",LABEL$$module$version="latest 90ea85c",HASH$$module$version="90ea85cd9ebd125e934b267966cf2c951a6e309e",DATE$$module$version=new Date(1558599067E3);var module$version={};module$version.STATUS=STATUS$$module$version;module$version.VERSION=VERSION$$module$version;module$version.LABEL=LABEL$$module$version;module$version.HASH=HASH$$module$version;module$version.DATE=DATE$$module$version;var $jscompDefaultExport$$module$patch={apply(a,b,c){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let d;b.seed||(b.seed=parseSeed$$module$patch("").toString(16),window.location.hash+="&seed="+b.seed);d=b.flags?new FlagSet$$module$flagset(String(b.flags)):new FlagSet$$module$flagset("Em Gt Mr Rlpt Sbk Sct Sm Tasd");for(const a in b)"false"===b[a]&&(b[a]=!1);yield shuffle$$module$patch(a,parseSeed$$module$patch(String(b.seed)),d,new FetchReader$$module$fetchreader(c))})}};
const parseSeed$$module$patch=(a)=>a?/^[0-9a-f]{1,8}$/i.test(a)?Number.parseInt(a,16):crc32$$module$crc32(a):Random$$module$random.newSeed(),shuffle$$module$patch=(a,b,c,d,e,f)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){if("number"!==typeof b)throw Error("Bad seed");var g=crc32$$module$crc32(b.toString(16).padStart(8,"0")+String(c))>>>0;const h={_ALLOW_TELEPORT_OUT_OF_TOWER:!0,_AUTO_EQUIP_BRACELET:c.autoEquipBracelet(),_BARRIER_REQUIRES_CALM_SEA:c.barrierRequiresCalmSea(),_BUFF_DEOS_PENDANT:c.buffDeosPendant(),
_CHECK_FLAG0:!0,_DISABLE_SHOP_GLITCH:c.disableShopGlitch(),_DISABLE_STATUE_GLITCH:c.disableStatueGlitch(),_DISABLE_SWORD_CHARGE_GLITCH:c.disableSwordChargeGlitch(),_DISABLE_WILD_WARP:!1,_DISPLAY_DIFFICULTY:!0,_EXTRA_PITY_MP:!0,_FIX_OPEL_STATUE:!0,_FIX_SHAKING:!0,_FIX_VAMPIRE:!0,_LEATHER_BOOTS_GIVE_SPEED:c.leatherBootsGiveSpeed(),_NERF_FLIGHT:!0,_NERF_WILD_WARP:c.nerfWildWarp(),_NEVER_DIE:c.neverDie(),_NORMALIZE_SHOP_PRICES:!0,_PITY_HP_AND_MP:!0,_PROGRESSIVE_BRACELET:!0,_RABBIT_BOOTS_CHARGE_WHILE_WALKING:c.rabbitBootsChargeWhileWalking(),
_REQUIRE_HEALED_DOLPHIN_TO_RIDE:c.requireHealedDolphinToRide(),_REVERSIBLE_SWAN_GATE:!0,_SAHARA_RABBITS_REQUIRE_TELEPATHY:c.saharaRabbitsRequireTelepathy(),_TELEPORT_ON_THUNDER_SWORD:c.teleportOnThunderSword()},k=new Assembler$$module$6502,l=(b)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){k.assemble(yield d.read(b),b);k.patchRom(a)});var m=Object.keys(h).filter((a)=>h[a]).map((a)=>`define ${a} 1\n`).join("");k.assemble(m,"flags.s");yield l("preshuffle.s");g=new Random$$module$random(g);
m=new Rom$$module$rom(a);makeBraceletsProgressive$$module$patch(m);c.blackoutMode()&&blackoutMode$$module$patch(m);closeCaveEntrances$$module$patch(m,c);reversibleSwanGate$$module$patch(m);adjustGoaFortressTriggers$$module$patch(m);preventNpcDespawns$$module$patch(m,c);c.requireHealedDolphinToRide()&&requireHealedDolphin$$module$patch(m);c.saharaRabbitsRequireTelepathy()&&requireTelepathyForDeo$$module$patch(m);adjustItemNames$$module$patch(m,c);yield l("postparse.s");alarmFluteIsKeyItem$$module$patch(m);
c.teleportOnThunderSword()?teleportOnThunderSword$$module$patch(m):noTeleportOnThunderSword$$module$patch(m);m.scalingLevels=48;m.uniqueItemTableAddress=k.expand("KeyItemData");yield shuffle2$$module$depgraph(m,g,e,c,f);rescaleShops$$module$patch(m,k,c.bargainHunting()?g:void 0);normalizeSwords$$module$patch(m,c,g);rescaleMonsters$$module$patch(m,c,g);c.shuffleMonsters()&&shuffleMonsters$$module$patch(m,c,g);identifyKeyItemsForDifficultyBuffs$$module$patch(m);c.doubleBuffMedicalHerb()?(a[115996]*=
2,a[115962]*=3):c.buffMedicalHerb()&&(a[115996]+=16,a[115962]*=2);c.connectLimeTreeToLeaf()&&connectLimeTreeToLeaf$$module$patch(m);addCordelWestTriggers$$module$patch(m,c);c.disableRabbitSkip()&&fixRabbitSkip$$module$patch(m);c.storyMode()&&storyMode$$module$patch(m);c.chargeShotsOnly()&&disableStabs$$module$patch(m);c.orbsOptional()&&orbsOptional$$module$patch(m);misc$$module$patch(m,c);yield m.writeData();return yield postParsedShuffle$$module$patch(a,g,b,c,k,l)}),postParsedShuffle$$module$patch=
(a,b,c,d,e,f)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield f("postshuffle.s");updateDifficultyScalingTables$$module$patch(a,d,e);updateCoinDrops$$module$patch(a,d);shuffleRandomNumbers$$module$patch(a,b);return stampVersionSeedAndHash$$module$patch(a,c,d)}),misc$$module$patch=(a,b)=>{a.messages.parts[2][2].text="\n{01:Akahana} is handed a statue.#\nThanks for finding that.\nI was totally gonna sell\nit for tons of cash.#\nHere, have this lame\n[29:Gas Mask] or something.";a.messages.parts[0][14].text=
"It's dangerous to go alone! Take this.";a.messages.parts[0][14].fixText();a&&b||console.log(a,b)};function makeBraceletsProgressive$$module$patch(a){a=a.npcs[95];var b=a.localDialogs.get(33);b=[b[0],b[2],b[2],b[1]];b[1].condition=-519;b[2].condition=-518;b[3].condition=-1;a.localDialogs.set(33,b)}function blackoutMode$$module$patch(a){var b=generate$$module$depgraph();for(const c of b.nodes)b=c.type,"Location"!==c.nodeType||"cave"!==b&&"fortress"!==b||a.locations[c.id].tilePalettes.fill(154)}
const closeCaveEntrances$$module$patch=(a,b)=>{a.swapMetatiles([144],[7,[1,0],-194],[14,[2,0],-194],[32,[3,10],-216],[33,[4,10],-216]);a.swapMetatiles([148,156],[104,[1,0],-194],[131,[2,0],-194],[136,[3,10],-216],[137,[4,10],-216]);a.screens[10].tiles[3][8]=1;a.screens[10].tiles[3][9]=2;a.screens[10].tiles[4][8]=3;a.screens[10].tiles[4][9]=4;a.screens[21].tiles[7][9]=1;a.screens[21].tiles[7][10]=2;a.screens[21].tiles[8][9]=3;a.screens[21].tiles[8][10]=4;a.screens[25].tiles[4][8]=1;a.screens[25].tiles[4][9]=
2;a.screens[25].tiles[5][8]=3;a.screens[25].tiles[5][9]=4;a.screens[62].tiles[5][6]=1;a.screens[62].tiles[5][7]=2;a.screens[62].tiles[6][6]=3;a.screens[62].tiles[6][7]=4;var c=[[3,48],[20,48],[21,48],[64,0],[64,20],[65,116],[71,16],[148,0],[152,65]];for(const b of c){const [c,d]=b;a.locations[c].flags.push(Flag$$module$rom$location.of({yx:d,flag:751}))}c=(b,c,f)=>{for(const d of a.locations[b].flags)if(d.yx===c){d.flag=f;return}throw Error(`Could not find flag to replace at ${b}:${c}`);};b.paralysisRequiresPrisonKey()&&
(c(20,48,750),c(21,48,750),c(64,0,728),b=Spawn$$module$rom$location.of({y:96,x:96,type:4,id:44}),c=Spawn$$module$rom$location.of({y:112,x:112,type:2,id:173}),a.locations[64].spawns.splice(1,0,b),a.locations[64].spawns.push(c))},eastCave$$module$patch=(a)=>{console.log(a,[[156,132,128,131,156],[128,129,131,134,128],[131,136,137,128,128],[129,140,133,130,132],[154,133,156,152,134]],[[156,132,155,128,155],[128,129,129,128,129],[128,135,139,138,134],[128,140,128,133,132],[156,134,128,128,154]])},adjustGoaFortressTriggers$$module$patch=
(a)=>{a.locations[169].spawns[0].x-=8;a.locations[170].spawns.splice(1,1);a.locations[172].spawns.splice(2,1);a.locations[185].spawns.splice(2,1)},alarmFluteIsKeyItem$$module$patch=(a)=>{a.npcs[20].data[1]=49;a.itemGets[49].inventoryRowStart=32;a.items[49].unique=!0;a.items[49].basePrice=0;const b=[[33,.72],[31,.9]];let c=0;for(const d of a.shops)if(d.type===module$rom$shop.ShopType.TOOL)for(let e=0,f=d.contents.length;e<f;e++){if(49!==d.contents[e])continue;const [f,h]=b[c++%b.length];d.contents[e]=
f;a.shopDataTablesAddress&&(d.prices[e]=Math.round(d.prices[e]*h))}a.itemGets[91].itemId=29;a.locations[87].spawns[12].id=16},reversibleSwanGate$$module$patch=(a)=>{a.locations[115].spawns.push(Spawn$$module$rom$location.of({xt:10,yt:2,type:1,id:45}),Spawn$$module$rom$location.of({xt:11,yt:2,type:1,id:45}),Spawn$$module$rom$location.of({xt:14,yt:10,type:2,id:179}));a.npcs[45].localDialogs.get(115)[0].flags.push(269);a.trigger(179).conditions.push(269)},preventNpcDespawns$$module$patch=(a,b)=>{a.npcs[13].localDialogs.get(192)[2].flags=
[];a.npcs[20].spawnConditions.get(14)[1]=-563;a.npcs[20].localDialogs.get(14)[0].flags=[];a.npcs[22].localDialogs.get(87)[0].flags=[];a.npcs[136].localDialogs.get(87)[0].flags=[];a.npcs[22].spawnConditions.get(87).shift();a.npcs[136].spawnConditions.get(87).pop();var c=(a)=>{a.reverse();for(let b=0;b<a.length;b++){const c=a[b+1];a[b].condition=c?~c.condition:-1}},d=a.npcs[29].localDialogs.get(-1);d[4].flags=[];d[0].message.action=3;d[1].message.action=3;d[2].message.action=3;d[3].message.action=3;
const e=a.npcs[30].localDialogs.get(-1);(()=>{const [b,c,d,k]=e;k.condition=-70;d.condition=-552;d.flags=[];c.condition=-1;a.npcs[30].localDialogs.set(-1,[k,d,b,c])})();for(const b of[32,33,34,124,125])c(a.npcs[b].localDialogs.get(-1));c=a.npcs[31].localDialogs.get(-1);c.unshift(...c.splice(1,1));a.npcs[51].spawnConditions.set(223,[-33,-28]);a.npcs[52].localDialogs.get(-1)[1].condition=27;c=a.npcs[56];d=c.localDialogs.get(-1);d[3].message.action=3;d[4].flags.push(156);c.spawnConditions.get(223)[1]=
-28;c.spawnConditions.get(225)[0]=27;d[1].condition=27;a.npcs[57].spawnConditions.get(216)[1]=-28;a.npcs[68].spawnConditions.set(233,[-142]);a.npcs[68].spawnConditions.set(228,[141]);a.npcs[68].localDialogs.get(233)[1].flags.pop();a.npcs[84].localDialogs.get(-1)[2].flags=[];a.npcs[90].localDialogs.get(-1)[1].flags=[];a.npcs[94].localDialogs.set(16,[LocalDialog$$module$rom$npc.of(-59,[0,26],[58]),LocalDialog$$module$rom$npc.of(13,[0,29]),LocalDialog$$module$rom$npc.of(56,[0,28]),LocalDialog$$module$rom$npc.of(577,
[0,29]),LocalDialog$$module$rom$npc.of(10,[0,27,3]),LocalDialog$$module$rom$npc.of(-1,[0,29])]);a.npcs[94].spawnConditions.get(16).pop();a.npcs[95].localDialogs.get(33)[1].flags=[];a.npcs[95].spawnConditions.delete(33);a.npcs[96].spawnConditions.delete(30);c=a.npcs[98];c.data[1]=40;c.localDialogs.get(225)[0].message.action=17;c.localDialogs.get(225)[2].message.action=17;c.spawnConditions.get(225).pop();a.npcs[104].spawnConditions.set(97,[-156,33]);a.npcs[104].localDialogs.get(-1)[0].message.action=
2;a.npcs[116].localDialogs.get(98)[0].flags=[];a.npcs[126].localDialogs.get(98)[0].flags=[];a.npcs[131].localDialogs.get(-1)[0].condition=-577;a.npcs[131].localDialogs.get(-1)[0].flags=[];a.npcs[196].spawnConditions.delete(242);a.npcs[203].spawnConditions.set(166,[-654]);c=a.npcs[94].localDialogs.get(242);c.unshift(...c.splice(1,1));c[0].flags=[];a.trigger(128).conditions.push(564);a.trigger(129).conditions=[];b.barrierRequiresCalmSea()&&a.trigger(132).conditions.push(643);a.trigger(132).flags=[];
a.trigger(140).conditions.push(55);a.trigger(178).conditions[0]=-579;a.trigger(178).flags.shift();a.trigger(180).conditions[1]=-578;a.trigger(180).flags=[];a.trigger(187).conditions[1]=-28;b=a.locations[101];138===b.spawns[9].id&&b.spawns.splice(9,1)},requireHealedDolphin$$module$patch=(a)=>{a.npcs[100].spawnConditions.set(214,[566,37]);a=a.npcs[123].localDialogs.get(-1);a.unshift(a[0].clone());a[0].condition=-38;a[1].condition=-567},requireTelepathyForDeo$$module$patch=(a)=>{a.npcs[89].globalDialogs.push(GlobalDialog$$module$rom$npc.of(-580,
[26,18]));a.npcs[90].globalDialogs.push(GlobalDialog$$module$rom$npc.of(-580,[26,19]))},teleportOnThunderSword$$module$patch=(a)=>{a.itemGets[3].flags.push(765);for(const b of[0,1,3])for(const c of[242,244])a.npcs[98].localDialogs.get(c)[b].message.action=31},noTeleportOnThunderSword$$module$patch=(a)=>{a.itemGets[3].acquisitionAction.action=22},adjustItemNames$$module$patch=(a,b)=>{b.leatherBootsGiveSpeed()&&(b=a.items[47],b.menuName="Speed Boots",b.messageName="Speed Boots");for(b=5;12>b;b+=2)a.items[b].menuName=
a.items[b].menuName.replace("Ball","Orb"),a.items[b].messageName=a.items[b].messageName.replace("Ball","Orb")},addCordelWestTriggers$$module$patch=(a,b)=>{for(const c of a.locations[21].spawns)(c.isChest()||b.disableTeleportSkip()&&c.isTrigger())&&a.locations[20].spawns.push(c.clone())},fixRabbitSkip$$module$patch=(a)=>{for(const b of a.locations[40].spawns)b.isTrigger()&&134===b.id&&1856===b.x&&(b.x+=16,b.y+=16)},storyMode$$module$patch=(a)=>{a.npcs[203].spawnConditions.set(166,[~a.npcs[194].spawnConditions.get(40)[0],
~a.npcs[132].spawnConditions.get(110)[0],~a.triggers[26].conditions[1],~a.npcs[197].spawnConditions.get(169)[0],~a.npcs[198].spawnConditions.get(172)[0],~a.npcs[199].spawnConditions.get(185)[0],~a.npcs[200].spawnConditions.get(182)[0],~a.npcs[203].spawnConditions.get(159)[0],512,513,514,515])},disableStabs$$module$patch=(a)=>{for(const b of[8,9,39])a.objects[b].collisionPlane=0},orbsOptional$$module$patch=(a)=>{for(const b of[16,20,24,29])a.objects[b].terrainSusceptibility&=-5,a.objects[b].level=
2},connectLimeTreeToLeaf$$module$patch=(a)=>{const b=a.locations[3];a=a.locations[66];b.screens[5][4]=16;a.screens[1][0]=26;a.screens[2][0]=12;const c=b.entrances.push(Entrance$$module$rom$location.of({x:1263,y:1400}))-1,d=a.entrances.push(Entrance$$module$rom$location.of({x:16,y:448}))-1;b.exits.push(Exit$$module$rom$location.of({x:1264,y:1376,dest:66,entrance:d}),Exit$$module$rom$location.of({x:1264,y:1392,dest:66,entrance:d}));a.exits.push(Exit$$module$rom$location.of({x:0,y:432,dest:3,entrance:c}),
Exit$$module$rom$location.of({x:0,y:448,dest:3,entrance:c}))},stampVersionSeedAndHash$$module$patch=(a,b,c)=>{const d=crc32$$module$crc32(a),e=d.toString(16).padStart(8,"0").toUpperCase(),f="unstable"===STATUS$$module$version?HASH$$module$version.substring(0,7).padStart(7,"0").toUpperCase()+"     ":VERSION$$module$version.substring(0,12).padEnd(12," "),g=b.toString(16).padStart(8,"0").toUpperCase();b=(b,c)=>{for(let d=0;d<c.length;d++)a[b+16+d]=c.charCodeAt(d)};const h=(a,b)=>{const c=[];for(let d=
0;d<a.length||d<b.length;d++)c.push(a[d]||" "),c.push(b[d]||" ");return c.join("")};b(161743,h("  VERSION     SEED      ",`  ${f}${g}`));c=String(c);let k;if(46<c.length){if(92<c.length)throw Error("Flag string way too long!");k=c.substring(46,92).padEnd(46," ");c=c.substring(0,46)}c=c.padEnd(46," ");b(161791,h(c.substring(0,23),c.substring(23)));k&&b(161839,h(k.substring(0,23),k.substring(23)));b(161925,h(e.substring(0,4),e.substring(4)));b(153366,"RANDOMIZER");"unstable"===STATUS$$module$version&&
b(153404,"BETA");return d},patchBytes$$module$patch=(a,b,c)=>{for(let d=0;d<c.length;d++)a[b+d]=c[d]},patchWords$$module$patch=(a,b,c)=>{for(let d=0;d<2*c.length;d+=2)a[b+d]=c[d>>>1]&255,a[b+d+1]=c[d>>>1]>>>8},updateCoinDrops$$module$patch=(a,b)=>{a=a.subarray(16);b.disableShopGlitch()?patchWords$$module$patch(a,216030,[0,5,10,15,25,40,65,105,170,275,445,600,700,800,900,1E3]):patchWords$$module$patch(a,216030,[0,1,2,4,8,16,30,50,100,200,300,400,500,600,700,800])},updateDifficultyScalingTables$$module$patch=
(a,b,c)=>{a=a.subarray(16);const d=seq$$module$rom$util(48,(a)=>a);patchBytes$$module$patch(a,c.expand("DiffAtk"),d.map((a)=>Math.round(40+15*a/4)));patchBytes$$module$patch(a,c.expand("DiffDef"),d.map((a)=>4*a));const e=b.decreaseEnemyDamage()?16:48,f=b.decreaseEnemyDamage()?6:5.5;patchBytes$$module$patch(a,c.expand("DiffHP"),d.map((a)=>Math.min(255,e+Math.round(a*f))));const g=b.expScalingFactor();patchBytes$$module$patch(a,c.expand("DiffExp"),d.map((a)=>{a=Math.floor(4*Math.pow(2,(16+9*a)/32)*
g);return 128>a?a:Math.min(255,128+(a>>4))}));patchBytes$$module$patch(a,216E3,[0,2,6,10,14,18,32,24,20,0,2,6,10,14,18,16,32,20])},rescaleShops$$module$patch=(a,b,c)=>{a.shopCount=11;a.shopDataTablesAddress=b.expand("ShopData");writeLittleEndian$$module$rom$util(a.prg,b.expand("InnBasePrice"),20);for(const b of a.shops)if(b.type!==module$rom$shop.ShopType.PAWN)for(let a=0,d=b.prices.length;a<d;a++)b.prices[a]=128>b.contents[a]?c?c.nextNormal(1,.3,.5,1.5):1:b.type!==module$rom$shop.ShopType.INN?0:
c?c.nextNormal(1,.5,.375,1.625):1;c=seq$$module$rom$util(48,(a)=>a);patchBytes$$module$patch(a.prg,b.expand("ToolShopScaling"),c.map((a)=>Math.round(8*Math.pow(2,a/10))));patchBytes$$module$patch(a.prg,b.expand("ArmorShopScaling"),c.map((a)=>Math.round(8*Math.pow(2,(47-a)/12))));for(b=13;39>b;b++)a.items[b].basePrice=BASE_PRICES$$module$patch[b]},BASE_PRICES$$module$patch={13:4,14:16,15:50,16:325,17:1E3,18:2E3,19:4E3,21:6,22:20,23:75,24:250,25:1E3,26:4800,29:25,30:30,31:45,32:40,33:36,34:200,35:150,
36:80,38:300};function normalizeSwords$$module$patch(a,b,c){a.objects[16].atk=3;a.objects[17].atk=6;a.objects[18].atk=8;a.objects[24].atk=3;a.objects[19].atk=5;a.objects[25].atk=5;a.objects[23].atk=7;a.objects[26].atk=7;a.objects[20].atk=3;a.objects[21].atk=6;a.objects[22].atk=8;a.objects[28].atk=3;a.objects[30].atk=5;a.objects[27].atk=7;a.objects[31].atk=7}
const rescaleMonsters$$module$patch=(a,b,c)=>{var d=new Set(Object.keys(a.objects).map(Number));for(var e of SCALED_MONSTERS$$module$patch){var [f]=e;d.delete(f)}for(var g of SCALED_MONSTERS$$module$patch){const [b,c]=g;for(const e of d)a.objects[b].base===a.objects[e].base&&(SCALED_MONSTERS$$module$patch.set(e,c),d.delete(b))}a.objects[125].elements|=8;e=new Set([87,94,104,125,136,151,155,158]);d=new Set([80,83,95,105]);for(const h of SCALED_MONSTERS$$module$patch){const [k,{sdef:l,swrd:m,hits:n,
satk:p,dgld:q,sexp:r}]=h;f=a.objects[k].data;g=e.has(k)?1:0;f[2]|=128;f[6]=n;f[7]=p;f[8]=l|m<<4;f[9]=f[9]&224|g;f[16]=f[16]&15|q<<4;f[17]=r;(g?b.shuffleBossElements():b.shuffleMonsterElements())&&!d.has(k)&&(f=[...a.objects[k].elements.toString(2).padStart(4,"0")],c.shuffle(f),a.objects[k].elements=Number.parseInt(f.join(""),2))}if(b.shuffleMonsterElements()){b=c.nextInt(4);a.prg[152109]=b+1;for(const c of d)a.objects[c].elements=1<<b}},shuffleMonsters$$module$patch=(a,b,c)=>{b=new MonsterPool$$module$patch(b,
{});for(const c of a.locations)c.used&&b.populate(c);b.shuffle(c)},identifyKeyItemsForDifficultyBuffs$$module$patch=(a)=>{for(let b=0;73>b;b++){const c=1<<(b&7),d=123152+(b>>>3);a.prg[d]=a.prg[d]&~c|(a.prg[135152+b]&64||49===b?c:0)}},SCALED_MONSTERS$$module$patch=new Map([[63,"p","Sorceror shot",,,,19,,,],[75,"m","wraith??",2,,2,22,4,61],[79,"m","wraith",1,,2,20,4,61],[80,"m","Blue Slime",,,1,16,2,32],[81,"m","Weretiger",,,1,21,4,40],[82,"m","Green Jelly",4,,3,16,4,36],[83,"m","Red Slime",6,,4,16,
4,48],[84,"m","Rock Golem",6,,11,24,6,85],[85,"m","Blue Bat",,,,4,,32],[86,"m","Green Wyvern",4,,4,24,6,52],[87,"b","Vampire",3,,12,18,,,],[88,"m","Orc",3,,4,21,4,57],[89,"m","Red Flying Swamp Insect",3,,1,21,4,57],[90,"m","Blue Mushroom",2,,1,21,4,44],[91,"m","Swamp Tomato",3,,2,35,4,52],[92,"m","Flying Meadow Insect",3,,3,23,4,81],[93,"m","Swamp Plant",,,,,,36],[94,"b","Insect",,1,8,6,,,],[95,"m","Large Blue Slime",5,,3,20,4,52],[96,"m","Ice Zombie",5,,7,14,4,57],[97,"m","Green Living Rock",,,1,
9,4,28],[98,"m","Green Spider",4,,4,22,4,44],[99,"m","Red/Purple Wyvern",3,,4,30,4,65],[100,"m","Draygonia Soldier",6,,11,36,4,89],[101,"m","Ice Entity",3,,2,24,4,52],[102,"m","Red Living Rock",,,1,13,4,40],[103,"m","Ice Golem",7,2,11,28,4,81],[104,"b","Kelbesque",4,6,12,29,,,],[105,"m","Giant Red Slime",7,,40,90,4,102],[106,"m","Troll",2,,3,24,4,65],[107,"m","Red Jelly",2,,2,14,4,44],[108,"m","Medusa",3,,4,36,8,77],[109,"m","Red Crab",2,,1,21,4,44],[110,"m","Medusa Head",,,1,29,4,36],[111,"m","Evil Bird",
,,2,30,6,65],[113,"m","Red/Purple Mushroom",3,,5,19,6,69],[114,"m","Violet Earth Entity",3,,3,18,6,61],[115,"m","Mimic",,,3,26,15,73],[116,"m","Red Spider",3,,4,22,6,48],[117,"m","Fishman",4,,6,19,5,61],[118,"m","Jellyfish",,,3,14,3,48],[119,"m","Kraken",5,,11,25,7,73],[120,"m","Dark Green Wyvern",4,,5,21,5,61],[121,"m","Sand Monster",5,,8,6,4,57],[123,"m","Wraith Shadow 1",,,,9,7,44],[124,"m","Killer Moth",,,2,35,,77],[125,"b","Sabera",3,7,13,24,,,],[128,"m","Draygonia Archer",1,,3,20,6,61],[129,
"m","Evil Bomber Bird",,,1,19,4,65],[130,"m","Lavaman/blob",3,,3,24,6,85],[132,"m","Lizardman (w/ flail(",2,,3,30,6,81],[133,"m","Giant Eye",3,,5,33,4,81],[134,"m","Salamander",2,,4,29,8,77],[135,"m","Sorceror",2,,5,31,6,65],[136,"b","Mado",4,8,10,30,,,],[137,"m","Draygonia Knight",2,,3,24,4,77],[138,"m","Devil",,,1,18,4,52],[139,"b","Kelbesque 2",4,6,11,27,,,],[140,"m","Wraith Shadow 2",,,,17,4,48],[144,"b","Sabera 2",5,7,21,27,,,],[145,"m","Tarantula",3,,3,21,6,73],[146,"m","Skeleton",,,4,30,6,
69],[147,"b","Mado 2",4,8,11,25,,,],[148,"m","Purple Giant Eye",4,,10,23,6,102],[149,"m","Black Knight (w/ flail)",3,,7,26,6,89],[150,"m","Scorpion",3,,5,29,2,73],[151,"b","Karmine",4,,14,26,,,],[152,"m","Sandman/blob",3,,5,36,6,98],[153,"m","Mummy",5,,19,36,6,110],[154,"m","Tomb Guardian",7,,60,37,6,106],[155,"b","Draygon",5,6,16,41,,,],[158,"b","Draygon 2",7,6,28,40,,,],[160,"m","Ground Sentry (1)",4,,6,26,,73],[161,"m","Tower Defense Mech (2)",5,,8,36,,85],[162,"m","Tower Sentinel",,,1,,,32],[163,
"m","Air Sentry",3,,2,26,,65],[164,"b","Dyna",6,5,8,,,,],[165,"b","Vampire 2",3,,12,27,,,],[180,"b","dyna pod",15,,255,26,,,],[184,"p","dyna counter",,,,26,,,],[185,"p","dyna laser",,,,26,,,],[186,"p","dyna bubble",,,,36,,,],[188,"m","vamp2 bat",,,,16,,15],[191,"p","draygon2 fireball",,,,26,,,],[193,"m","vamp1 bat",,,,16,,15],[195,"p","giant insect spit",,,,35,,,],[196,"m","summoned insect",4,,2,42,,98],[197,"p","kelby1 rock",,,,22,,,],[198,"p","sabera1 balls",,,,19,,,],[199,"p","kelby2 fireballs",
,,,11,,,],[200,"p","sabera2 fire",,,1,6,,,],[201,"p","sabera2 balls",,,,17,,,],[202,"p","karmine balls",,,,25,,,],[203,"p","sun/moon statue fireballs",,,,39,,,],[204,"p","draygon1 lightning",,,,37,,,],[205,"p","draygon2 laser",,,,36,,,],[206,"p","draygon2 breath",,,,36,,,],[224,"p","evil bomber bird bomb",,,,2,,,],[226,"p","summoned insect bomb",,,,47,,,],[227,"p","paralysis beam",,,,23,,,],[228,"p","stone gaze",,,,33,,,],[229,"p","rock golem rock",,,,24,,,],[230,"p","curse beam",,,,10,,,],[231,"p",
"mp drain web",,,,11,,,],[232,"p","fishman trident",,,,15,,,],[233,"p","orc axe",,,,24,,,],[234,"p","Swamp Pollen",,,,37,,,],[235,"p","paralysis powder",,,,17,,,],[236,"p","draygonia solider sword",,,,28,,,],[237,"p","ice golem rock",,,,20,,,],[238,"p","troll axe",,,,27,,,],[239,"p","kraken ink",,,,24,,,],[240,"p","draygonia archer arrow",,,,12,,,],[241,"p","??? unused",,,,16,,,],[242,"p","draygonia knight sword",,,,9,,,],[243,"p","moth residue",,,,19,,,],[244,"p","ground sentry laser",,,,13,,,],
[245,"p","tower defense mech laser",,,,23,,,],[246,"p","tower sentinel laser",,,,8,,,],[247,"p","skeleton shot",,,,11,,,],[248,"p","lavaman shot",,,,14,,,],[249,"p","black knight flail",,,,18,,,],[250,"p","lizardman flail",,,,21,,,],[252,"p","mado shuriken",,,,36,,,],[253,"p","guardian statue missile",,,,23,,,],[254,"p","demon wall fire",,,,23,,,]].map((a)=>{var [b,c,d,e=0,f=0,g=0,h=0,k=0,l=0]=a;return[b,{id:b,type:c,name:d,sdef:e,swrd:f,hits:g,satk:h,dgld:k,sexp:l}]}));
class MonsterPool$$module$patch{constructor(a,b){this.flags=a;this.report=b;this.monsters=[];this.used=[];this.locations=[]}populate(a){var b=MONSTER_ADJUSTMENTS$$module$patch[a.id]||{},c=Object.assign({},b);const d=void 0===b.skip?!1:b.skip;b=void 0===b.tower?!1:b.tower;c=(delete c.maxFlyers,delete c.nonFlyers,delete c.skip,delete c.tower,delete c.fixedSlots,c);for(var e of Object.keys(c))throw Error(`Unexpected property '${e}' in MONSTER_ADJUSTMENTS[${a.id}]`);if(!0!==d&&(this.flags.shuffleTowerMonsters()||
!b)&&a.spritePatterns&&a.spritePalettes){e=[];c=[];b=12;for(const d of a.spawns){++b;if(!d.isMonster())continue;const h=d.monsterId;if(h in UNTOUCHED_MONSTERS$$module$patch||!SCALED_MONSTERS$$module$patch.has(h)||"m"!==SCALED_MONSTERS$$module$patch.get(h).type)continue;var f=a.rom.objects[h];if(!f)continue;const l=d.patternBank,m=a.spritePatterns[l];var g=f.palettes(!0);f=g.includes(2)?a.spritePalettes[0]:void 0;g=g.includes(3)?a.spritePalettes[1]:void 0;e.push({id:h,pat:m,pal2:f,pal3:g,patBank:l});
(this.report[`start-${h.toString(16)}`]=this.report[`start-${h.toString(16)}`]||[]).push("$"+a.id.toString(16));c.push(b)}e.length&&(d||this.locations.push({location:a,slots:c}),this.monsters.push(...e))}}shuffle(a){this.report["pre-shuffle locations"]=this.locations.map((a)=>a.location.id);this.report["pre-shuffle monsters"]=this.monsters.map((a)=>a.id);a.shuffle(this.locations);a.shuffle(this.monsters);this.report["post-shuffle locations"]=this.locations.map((a)=>a.location.id);for(this.report["post-shuffle monsters"]=
this.monsters.map((a)=>a.id);this.locations.length;){const {location:d,slots:e}=this.locations.pop(),f=this.report["$"+d.id.toString(16).padStart(2,"0")]=[],{maxFlyers:g=0,nonFlyers:h={},fixedSlots:k={},tower:l=!1}=MONSTER_ADJUSTMENTS$$module$patch[d.id]||{};if(l)continue;let m=k.pat0||null,n=k.pat1||null,p=k.pal2||null,q=k.pal3||null,r=g,u=!1;for(const a of d.spawns)if(a.isChest()&&(u=!0),a.isMonster()){var b=a.monsterId;126===b||127===b||159===b?n=98:143===b&&(m=97)}if(21===d.id||71===d.id)u=!1;
f.push(`Initial pass: ${[u,m,n,p,q].join(", ")}`);b=(a)=>{var b=FLYERS$$module$patch.has(a.id),c=MOTHS_AND_BATS$$module$patch.has(a.id);if(b){if(!r)return!1;--r}if(null!=p&&null!=a.pal2&&p!==a.pal2||null!=q&&null!=a.pal3&&q!==a.pal3)return!1;var g=!u||TREASURE_CHEST_BANKS$$module$patch.has(a.pat);let k;if(d.rom.objects[a.id].child||RETAIN_SLOTS$$module$patch.has(a.id)){const b=(k=a.patBank)?n:m;if(null!=b&&b!==a.pat)return!1;if(k)n=a.pat;else if(g)m=a.pat;else return!1;f.push(`  Adding ${a.id.toString(16)}: pat(${k}) <-  ${a.pat.toString(16)}`)}else if(null==
m&&g||m===a.pat)m=a.pat,k=0,f.push(`  Adding ${a.id.toString(16)}: pat0 <-  ${a.pat.toString(16)}`);else if(null==n||n===a.pat)n=a.pat,k=1,f.push(`  Adding ${a.id.toString(16)}: pat1 <-  ${a.pat.toString(16)}`);else return!1;null!=a.pal2&&(p=a.pal2);null!=a.pal3&&(q=a.pal3);f.push(`    ${Object.keys(a).map((b)=>`${b}: ${a[b]&&a[b].toString(16)}`).join(", ")}`);f.push(`    pal: ${(a.pal2||0).toString(16)} ${(a.pal3||0).toString(16)}`);g=0;if(b||c)for(b=0;b<e.length;b++){if(e[b]in h){g=b;break}}else for(b=
0;b<e.length;b++)if(!(e[b]in h)){g=b;break}(this.report[`mon-${a.id.toString(16)}`]=this.report[`mon-${a.id.toString(16)}`]||[]).push("$"+d.id.toString(16));b=e[g];c=d.spawns[b-13];b in h&&(c.y+=16*h[b][0],c.x+=16*h[b][1]);c.patternBank=k||0;c.monsterId=a.id;f.push(`    slot ${b.toString(16)}: ${c}`);e.splice(g,1);return!0};if(r)for(var c=0;c<Math.min(40,this.monsters.length);c++)FLYERS$$module$patch.has(this.monsters[c].id)&&b(this.monsters[c])&&this.monsters.splice(c,1),a.shuffle(this.monsters);
for(c=0;c<this.monsters.length&&e.length;c++)if(b(this.monsters[c])){const [a]=this.monsters.splice(c,1);FLYERS$$module$patch.has(a.id)||this.used.push(a);c--}for(c=0;c<this.used.length&&e.length;c++)b(this.used[c])&&(this.used.push(...this.used.splice(c,1)),c--);null!=m&&(d.spritePatterns[0]=m);null!=n&&(d.spritePatterns[1]=n);null!=p&&(d.spritePalettes[0]=p);null!=q&&(d.spritePalettes[1]=q);if(e.length){f.push(`Failed to fill location ${d.id.toString(16)}: ${e.length} remaining`);for(const a of e)b=
d.spawns[a-13],b.x=b.y=0}}}}
const FLYERS$$module$patch=new Set([89,92,110,111,129,138,163,196]),MOTHS_AND_BATS$$module$patch=new Set([85,93,124,188,193]),TREASURE_CHEST_BANKS$$module$patch=new Set([94,95,96,97,100,101,102,103,104,105,106,108,109,110,111,112,116,117,118,119]),MONSTER_ADJUSTMENTS$$module$patch={[3]:{fixedSlots:{pat1:96},maxFlyers:2},[7]:{nonFlyers:{[15]:[0,-3],[16]:[-10,0],[17]:[0,4]}},[20]:{maxFlyers:2},[21]:{maxFlyers:2},[26]:{fixedSlots:{pal3:35,pat1:79},maxFlyers:2,nonFlyers:{[16]:[4,0],[17]:[5,0],[18]:[4,
0],[19]:[5,0],[20]:[4,0],[21]:[4,0]}},[27]:{skip:!0},[32]:{maxFlyers:1},[33]:{fixedSlots:{pat1:80},maxFlyers:1},[39]:{nonFlyers:{[13]:[0,16]}},[40]:{maxFlyers:1},[41]:{maxFlyers:1},[43]:{nonFlyers:{[20]:[32,-8]}},[64]:{maxFlyers:2,nonFlyers:{[19]:[12,-16]}},[65]:{maxFlyers:2,nonFlyers:{[21]:[0,-6]}},[66]:{maxFlyers:2,nonFlyers:{[13]:[0,8],[14]:[-8,8]}},[71]:{maxFlyers:1,nonFlyers:{[13]:[-8,-8]}},[74]:{maxFlyers:1,nonFlyers:{[14]:[4,0],[15]:[0,-3],[16]:[0,4]}},[76]:{},[77]:{maxFlyers:1},[78]:{maxFlyers:1},
[79]:{},[87]:{fixedSlots:{pat1:77}},[89]:{tower:!0},[90]:{tower:!0},[91]:{tower:!0},[96]:{fixedSlots:{pal3:8,pat1:82},maxFlyers:2,skip:!0},[100]:{fixedSlots:{pal3:8,pat1:82},skip:!0},[104]:{fixedSlots:{pal3:8,pat1:82},skip:!0},[105]:{maxFlyers:1,nonFlyers:{[23]:[4,6]}},[106]:{maxFlyers:1,nonFlyers:{[21]:[0,24]}},[108]:{maxFlyers:1,nonFlyers:{[23]:[0,24]}},[109]:{maxFlyers:1,nonFlyers:{[17]:[16,0],[27]:[0,0],[28]:[6,0]}},[120]:{maxFlyers:1,nonFlyers:{[22]:[-8,-8]}},[124]:{maxFlyers:1,nonFlyers:{[21]:[-39,
84]}},[132]:{nonFlyers:{[18]:[0,-4],[19]:[0,4],[20]:[-6,0],[21]:[14,12]}},[136]:{maxFlyers:1},[137]:{maxFlyers:1},[138]:{maxFlyers:1,nonFlyers:{[13]:[7,0],[14]:[0,0],[15]:[7,3],[16]:[0,6],[17]:[11,-16]}},[143]:{skip:!0},[144]:{maxFlyers:2,nonFlyers:{[20]:[-11,-3],[21]:[0,16]}},[145]:{maxFlyers:2,nonFlyers:{[24]:[0,14],[25]:[4,-16]}},[152]:{maxFlyers:2,nonFlyers:{[20]:[-6,6],[21]:[0,-16]}},[158]:{maxFlyers:2},[162]:{maxFlyers:1,nonFlyers:{[18]:[0,11],[19]:[6,0]}},[165]:{nonFlyers:{[23]:[6,6],[24]:[-6,
0],[25]:[-1,-7]}},[166]:{skip:!0},[168]:{skip:!0},[169]:{maxFlyers:2,nonFlyers:{[22]:[26,-16],[23]:[0,32]}},[171]:{maxFlyers:2,nonFlyers:{[13]:[1,0],[14]:[2,-2]}},[173]:{maxFlyers:2,nonFlyers:{[24]:[0,8],[25]:[0,-8]}},[175]:{nonFlyers:{[13]:[0,0],[14]:[0,0],[19]:[59,-38]}},[180]:{maxFlyers:2,nonFlyers:{[17]:[6,0],[18]:[0,6]}},[215]:{skip:!0}},RETAIN_SLOTS$$module$patch=new Set([80,83]),UNTOUCHED_MONSTERS$$module$patch={[126]:!0,[127]:!0,[131]:!0,[141]:!0,[142]:!0,[143]:!0,[159]:!0,[166]:!0},shuffleRandomNumbers$$module$patch=
(a,b)=>{a=a.subarray(219124,219188);b.shuffle(a)};var module$patch={};module$patch.default=$jscompDefaultExport$$module$patch;module$patch.parseSeed=parseSeed$$module$patch;module$patch.shuffle=shuffle$$module$patch;module$patch.stampVersionSeedAndHash=stampVersionSeedAndHash$$module$patch;const FullRomImage$$module$romimage={of:(a)=>a},PrgImage$$module$romimage={of:(a)=>a.subarray(16,262160)},ChrImage$$module$romimage={of:(a)=>a.subarray(262160)};var module$romimage={};module$romimage.FullRomImage=FullRomImage$$module$romimage;module$romimage.PrgImage=PrgImage$$module$romimage;module$romimage.ChrImage=ChrImage$$module$romimage;function uint1$$module$rom$ints(a){return a&1}function uint2$$module$rom$ints(a){return a&3}function uint3$$module$rom$ints(a){return a&7}function uint4$$module$rom$ints(a){return a&15}function uint5$$module$rom$ints(a){return a&31}function uint6$$module$rom$ints(a){return a&63}function uint7$$module$rom$ints(a){return a&127}function uint8$$module$rom$ints(a){return a&255}function int8$$module$rom$ints(a){a=uint8$$module$rom$ints(a);return 128>a?a:a-256}var module$rom$ints={};
module$rom$ints.uint1=uint1$$module$rom$ints;module$rom$ints.uint2=uint2$$module$rom$ints;module$rom$ints.uint3=uint3$$module$rom$ints;module$rom$ints.uint4=uint4$$module$rom$ints;module$rom$ints.uint5=uint5$$module$rom$ints;module$rom$ints.uint6=uint6$$module$rom$ints;module$rom$ints.uint7=uint7$$module$rom$ints;module$rom$ints.uint8=uint8$$module$rom$ints;module$rom$ints.int8=int8$$module$rom$ints;class ProgressTracker$$module$progress{constructor(){this.completed=this.tasks=0}addTasks(a){this.tasks+=a}addCompleted(a){this.completed+=a}value(){return this.tasks&&this.completed/this.tasks}}var module$progress={};module$progress.ProgressTracker=ProgressTracker$$module$progress;const renderPresets$$module$render=(a)=>{for(const {title:c,flags:d,descr:e,default:f}of PRESETS$$module$flagset){var b=document.createElement("h2");b.textContent=c;a.appendChild(b);b=document.createElement("p");b.innerHTML=e;a.appendChild(b);b=document.createElement("a");b.textContent=d;b.classList.add("button");b.classList.add("preset-flags");b.dataset.flags=d;f&&(b.dataset.defaultPreset="true");a.appendChild(b)}},renderOptions$$module$render=(a)=>{for(const {section:c,text:d,flags:e}of FLAGS$$module$flagset){var b=
document.createElement("h2");b.textContent=c;a.appendChild(b);d&&(b=document.createElement("p"),b.innerHTML=d,a.appendChild(b));b=document.createElement("div");b.classList.add("flag-list");a.appendChild(b);for(const {flag:a,hard:c,name:d,text:k}of e){const e=document.createElement("div");e.textContent=`${a}: ${d}`;e.classList.add("checkbox");c&&e.classList.add("hard");if(k){const a=document.createElement("div");a.classList.add("flag-body");a.innerHTML=k;e.appendChild(a)}b.appendChild(e)}}},renderRaceFlags$$module$render=
(a,b)=>{for(const {section:c,text:d,flags:e}of FLAGS$$module$flagset){let f=!1;const g=document.createElement("h2");g.textContent=c;const h=d?document.createElement("p"):null;d&&(h.innerHTML=d);const k=document.createElement("div");k.classList.add("flag-list");for(const {flag:a,hard:c,name:d,text:g}of e){if(!b.check(a))continue;f=!0;const e=document.createElement("div");e.textContent=`${a}: ${d}`;e.classList.add("checkbox");c&&e.classList.add("hard");if(g){const a=document.createElement("div");a.classList.add("flag-body");
a.innerHTML=g;e.appendChild(a)}k.appendChild(e)}f&&(a.appendChild(g),h&&a.appendChild(h),a.appendChild(k))}};var module$render={};module$render.renderPresets=renderPresets$$module$render;module$render.renderOptions=renderOptions$$module$render;module$render.renderRaceFlags=renderRaceFlags$$module$render;let flags$$module$main,seed$$module$main,rom$$module$main,romName$$module$main,race$$module$main=!1;
const ga$$module$main=window.ga||(()=>{}),initRace$$module$main=()=>{race$$module$main=!0;loadRomFromStorage$$module$main();initializeStateFromHash$$module$main(!1);updateRaceDom$$module$main();window.addEventListener("popstate",(a)=>{initializeStateFromHash$$module$main(!1)});document.body.addEventListener("click",click$$module$main);initVersion$$module$main()},main$$module$main=()=>{if(null==document.getElementById("race")){initRace$$module$main();renderRaceFlags$$module$render(document.getElementById("flags"),
flags$$module$main);for(const a of[...document.getElementsByClassName("checkbox")])makeCheckbox$$module$main(a);for(const a of document.querySelectorAll('.flag-list > input[type="checkbox"]'))a.checked=!0,a.disabled=!0}else{renderPresets$$module$render(document.getElementById("presets"));renderOptions$$module$render(document.getElementById("select-options"));loadRomFromStorage$$module$main();initializeStateFromHash$$module$main(!0);flags$$module$main||document.querySelector("[data-default-preset]").click();
for(const a of[...document.getElementsByClassName("checkbox")])makeCheckbox$$module$main(a);updateDom$$module$main();addSeedListeners$$module$main();document.body.addEventListener("click",click$$module$main);window.addEventListener("popstate",(a)=>{a.state?(flags$$module$main.flags=a.state.flags,seed$$module$main=a.state.seed):initializeStateFromHash$$module$main(!0)});initVersion$$module$main()}},initVersion$$module$main=()=>{"latest"!==HASH$$module$version&&(document.getElementById("version").textContent=
`Current version: ${LABEL$$module$version} (${DATE$$module$version.toDateString()})`);document.body.classList.add("js-works");document.body.classList.remove("js-broken");"rc"==STATUS$$module$version?(document.body.classList.add("release-candidate"),document.body.classList.add("versioned")):"stable"==STATUS$$module$version&&document.body.classList.add("versioned")},addSeedListeners$$module$main=()=>{const a=document.getElementById("seed"),b=()=>{seed$$module$main=a.value;updateDom$$module$main()};
a.addEventListener("keyup",b);a.addEventListener("change",b)},initializeStateFromHash$$module$main=(a)=>{for(const a of location.hash.substring(1).split("&")){let [b,d]=a.split("=");d=decodeURIComponent(d);"flags"===b&&(flags$$module$main=new FlagSet$$module$flagset(d));"seed"===b&&(seed$$module$main=decodeURIComponent(d));"race"===b&&document.body.classList.add("race");for(const a of document.querySelectorAll("[data-flags]"))a.addEventListener("click",()=>{flags$$module$main=new FlagSet$$module$flagset(a.dataset.flags);
"unstable"==VERSION$$module$version&&flags$$module$main.set("Ds",!0);updateDom$$module$main()})}},click$$module$main=(a)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){var b=a.target,c=`${LABEL$$module$version}: ${flags$$module$main}`;const d=(new Date).getTime();for(;b;){if("H1"===b.tagName&&b.parentElement.classList.contains("expandable")){b.parentElement.classList.toggle("expanded");break}else if("preset-apply"===b.id){ga$$module$main("send","event","custom-preset");flags$$module$main=
new FlagSet$$module$flagset(document.getElementById("flagstring").value);updateDom$$module$main();break}else if("new-seed"===b.id){ga$$module$main("send","event","Main","new-seed");seed$$module$main=Math.floor(4294967296*Math.random()).toString(16);updateDom$$module$main();break}else if("generate"===b.id){ga$$module$main("send","event","Main","generate",c);b=parseSeed$$module$patch(seed$$module$main);const [a,f]=yield shuffleRom$$module$main(b);ga$$module$main("send","timing","Main","generate",(new Date).getTime()-
d,c);c=romName$$module$main.replace(/\.nes|$/,["_",b.toString(16).padStart(8,0),"_",f.toString(16).padStart(8,0),".nes"].join(""));download$$module$main(a,c);break}else if("spoiler"===b.id){ga$$module$main("send","event","Main","spoiler",c);yield shuffleRom$$module$main(parseSeed$$module$patch(seed$$module$main));ga$$module$main("send","timing","Main","spoiler",(new Date).getTime()-d,c);break}b=b.parentElement}}),read$$module$main=(a,b,c)=>{const d=[];for(let e=0;e<c;e++)d.push(String.fromCharCode(a[b+
2*e]));return d.join("")},shuffleRom$$module$main=(a)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const b=document.getElementById("progress"),c=new ProgressTracker$$module$progress,d=rom$$module$main.slice();let e=!1;var f=new FlagSet$$module$flagset(String(flags$$module$main));document.body.classList.add("shuffling");const g=flags$$module$main.check("Ds")?{}:void 0,h=()=>{e||(b.value=c.value(),setTimeout(h,120))};h();f=yield shuffle$$module$patch(d,a,f,new FetchReader$$module$fetchreader,
g,c);e=!0;document.body.classList.remove("shuffling");g&&(replaceSpoiler$$module$main("spoiler-items",g.items.map((a)=>a.text)),replaceSpoiler$$module$main("spoiler-route",g.route));document.getElementById("checksum").textContent=read$$module$main(d,161941,4)+read$$module$main(d,161942,4);return[d,f]}),replaceSpoiler$$module$main=(a,b)=>{for(a=document.getElementById(a);a.children.length;)a.lastChild.remove();for(const c of b)b=document.createElement("li"),b.textContent=c,a.appendChild(b)},makeCheckbox$$module$main=
(a)=>{const b=a.getElementsByClassName("flag-body")[0];b&&b.remove();const [c,d]=a.textContent.split(/:\s*/),e=document.createElement("input");e.type="checkbox";e.id=`flag-${c}`;e.dataset.flag=c;a.parentElement.insertBefore(e,a);const f=document.createElement("label");f.textContent=c;f.htmlFor=e.id;a.parentElement.insertBefore(f,a);const g=document.createElement("div");a.parentElement.insertBefore(g,a);const h=document.createElement("label");h.textContent=d;h.htmlFor=e.id;g.appendChild(h);b&&g.appendChild(b);
a.classList.contains("hard")&&(f.classList.add("hard"),h.classList.add("hard"),h.textContent+=" *");a.remove();e.addEventListener("change",()=>{window.FLAGS=flags$$module$main;flags$$module$main.set(c,e.checked);updateDom$$module$main()})},updateDom$$module$main=()=>{for(var a of document.querySelectorAll("input[data-flag]"))a.checked=flags$$module$main.check(a.dataset.flag);a=String(flags$$module$main).replace(/ /g,"");document.getElementById("seed").value=seed$$module$main||"";var b=["#flags=",
a];seed$$module$main&&b.push("&seed=",encodeURIComponent(seed$$module$main));history.replaceState({flags:flags$$module$main.flags,seed:seed$$module$main},"",String(window.location).replace(/#.*/,"")+b.join(""));if("stable"==STATUS$$module$version||"rc"==STATUS$$module$version){b=seed$$module$main||Math.floor(4294967296*Math.random()).toString(16);const c=VERSION$$module$version;document.getElementById("race").href=`/${c}/race#flags=${a}&seed=${b}`}updateRaceDom$$module$main()},updateRaceDom$$module$main=
()=>{const a=String(flags$$module$main);document.body.classList.toggle("spoiled",flags$$module$main.check("Ds"));document.body.classList.toggle("debug-mode",/D/.test(a));document.getElementById("flagstring-out").textContent=a;document.getElementById("track-url").href=`track#flags=${a.replace(/ /g,"")}`},loadRomFromStorage$$module$main=()=>{const a=window.localStorage.getItem("name"),b=window.localStorage.getItem("rom"),c=document.getElementById("pick-file"),d=()=>{document.body.classList.add("rom-uploaded");
document.body.classList.toggle("rom-broken",crc32$$module$crc32(rom$$module$main)!=EXPECTED_CRC32$$module$rom)};a&&b&&(romName$$module$main=a,rom$$module$main=Uint8Array.from(Array(b.length/2).fill(0).map((a,c)=>Number.parseInt(b[2*c]+b[2*c+1],16))),d());c.addEventListener("change",()=>{const a=c.files[0],b=new FileReader;b.addEventListener("loadend",()=>{const c=new Uint8Array(b.result),e=Array.from(c,(a)=>a.toString(16).padStart(2,0)).join("");window.localStorage.setItem("rom",e);window.localStorage.setItem("name",
a.name);rom$$module$main=c.slice(0,393232);d();romName$$module$main=a.name});b.readAsArrayBuffer(a)})},download$$module$main=(a,b)=>{const c=document.createElement("a");document.body.appendChild(c);c.style="display: none";a=new Blob([a],{type:"octet/stream"});a=window.URL.createObjectURL(a);c.href=a;c.download=b;c.click();window.URL.revokeObjectURL(a);c.remove()};main$$module$main();var module$main={};
}).call(this)
