import { DefaultMap } from '../util.js';
export class Graphics {
    constructor(rom) {
        this.rom = rom;
        this.palettes = new Uint32Array(0x400);
        this.tiles = new DefaultMap((() => {
            return (key) => {
                const data = new Uint32Array(64);
                const uint8 = new Uint8Array(data.buffer);
                data.fill(0);
                const pal = (key & 0xff) << 2;
                const id = key >>> 8;
                const pat = this.rom.patterns[id];
                for (let r = 0; r < 8; r++) {
                    let hi = pat.pixels[8 | r] << 1;
                    let lo = pat.pixels[r];
                    for (let c = 7; c >= 0; c--) {
                        const z = hi & 2 | lo & 1;
                        hi >>>= 1;
                        lo >>>= 1;
                        if (z)
                            data[r << 3 | c] = this.palettes[pal | z];
                    }
                }
                return uint8;
            };
        })());
        this.metatiles = new DefaultMap((() => {
            const canvas = document.createElement('canvas');
            canvas.width = canvas.height = 16;
            const ctx = canvas.getContext('2d');
            return (key) => {
                ctx.clearRect(0, 0, 16, 16);
                const pal = key % 256;
                key = Math.floor(key / 256);
                const id = key >>> 24;
                const pats = [(key >>> 16) & 0xff, (key >>> 8) & 0xff];
                const ts = this.rom.tilesets[key & 0xff];
                for (let r = 0; r < 2; r++) {
                    for (let c = 0; c < 2; c++) {
                        const tile = ts.tiles[r << 1 | c][id];
                        const data = this.tiles.get(pats[tile >>> 7] << 14 | (tile & 0x7f) << 8 | pal);
                        const imgData = ctx.getImageData(c << 3, r << 3, 8, 8);
                        imgData.data.set(data);
                        ctx.putImageData(imgData, c << 3, r << 3);
                    }
                }
                return canvas.toDataURL('image/png');
            };
        })());
        this.rebuildPalettes();
    }
    rebuildPalettes() {
        for (let i = 0; i < 0x100; i++) {
            for (let j = 0; j < 4; j++) {
                const color = COLORS[this.rom.palettes[i].color(j)];
                this.palettes[i << 2 | j] = color | 0xff000000;
            }
        }
    }
    metatile(id, pats, tileset, pal) {
        return this.metatiles.get(id * 0x100000000 + (pats[0] << 24 | pats[1] << 16 | tileset << 8 | pal));
    }
    paletteCss(id, index = 0) {
        const rgb = this.palettes[id << 2 | index];
        return `rgb(${rgb & 0xff}, ${rgb >> 8 & 0xff}, ${rgb >> 16 & 0xff})`;
    }
}
const COLORS = [
    0x525252, 0xB40000, 0xA00000, 0xB1003D, 0x740069, 0x00005B, 0x00005F, 0x001840,
    0x002F10, 0x084A08, 0x006700, 0x124200, 0x6D2800, 0x000000, 0x000000, 0x000000,
    0xC4D5E7, 0xFF4000, 0xDC0E22, 0xFF476B, 0xD7009F, 0x680AD7, 0x0019BC, 0x0054B1,
    0x006A5B, 0x008C03, 0x00AB00, 0x2C8800, 0xA47200, 0x000000, 0x000000, 0x000000,
    0xF8F8F8, 0xFFAB3C, 0xFF7981, 0xFF5BC5, 0xFF48F2, 0xDF49FF, 0x476DFF, 0x00B4F7,
    0x00E0FF, 0x00E375, 0x03F42B, 0x78B82E, 0xE5E218, 0x787878, 0x000000, 0x000000,
    0xFFFFFF, 0xFFF2BE, 0xF8B8B8, 0xF8B8D8, 0xFFB6FF, 0xFFC3FF, 0xC7D1FF, 0x9ADAFF,
    0x88EDF8, 0x83FFDD, 0xB8F8B8, 0xF5F8AC, 0xFFFFB0, 0xF8D8F8, 0x000000, 0x000000,
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGhpY3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvZWRpdC9ncmFwaGljcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUMsVUFBVSxFQUFDLE1BQU0sWUFBWSxDQUFDO0FBRXRDLE1BQU0sT0FBTyxRQUFRO0lBeURuQixZQUFxQixHQUFRO1FBQVIsUUFBRyxHQUFILEdBQUcsQ0FBSztRQXREN0IsYUFBUSxHQUFHLElBQUksV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBR2xDLFVBQUssR0FBRyxJQUFJLFVBQVUsQ0FBcUIsQ0FBQyxHQUFHLEVBQUU7WUFDL0MsT0FBTyxDQUFDLEdBQVcsRUFBRSxFQUFFO2dCQUNyQixNQUFNLElBQUksR0FBRyxJQUFJLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDakMsTUFBTSxLQUFLLEdBQUcsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUMxQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNiLE1BQU0sR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDOUIsTUFBTSxFQUFFLEdBQUcsR0FBRyxLQUFLLENBQUMsQ0FBQztnQkFHckIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ2xDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7b0JBQzFCLElBQUksRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDaEMsSUFBSSxFQUFFLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTt3QkFDM0IsTUFBTSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO3dCQUMxQixFQUFFLE1BQU0sQ0FBQyxDQUFDO3dCQUNWLEVBQUUsTUFBTSxDQUFDLENBQUM7d0JBQ1YsSUFBSSxDQUFDOzRCQUFFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO3FCQUNsRDtpQkFDRjtnQkFDRCxPQUFPLEtBQUssQ0FBQztZQUNmLENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUdOLGNBQVMsR0FBRyxJQUFJLFVBQVUsQ0FBaUIsQ0FBQyxHQUFHLEVBQUU7WUFDL0MsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNoRCxNQUFNLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1lBQ2xDLE1BQU0sR0FBRyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFFLENBQUM7WUFDckMsT0FBTyxDQUFDLEdBQVcsRUFBRSxFQUFFO2dCQUNyQixHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUM1QixNQUFNLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO2dCQUN0QixHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQzVCLE1BQU0sRUFBRSxHQUFHLEdBQUcsS0FBSyxFQUFFLENBQUM7Z0JBQ3RCLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssRUFBRSxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO2dCQUN2RCxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQUM7Z0JBRXpDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7b0JBQzFCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7d0JBQzFCLE1BQU0sSUFBSSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQzt3QkFDdEMsTUFBTSxJQUFJLEdBQ04sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO3dCQUN0RSxNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7d0JBQ3ZELE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO3dCQUN2QixHQUFHLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztxQkFDM0M7aUJBQ0Y7Z0JBQ0QsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3ZDLENBQUMsQ0FBQztRQUNKLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUdKLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRUQsZUFBZTtRQUNiLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDOUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDMUIsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNwRCxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFHLFVBQVUsQ0FBQzthQUNoRDtTQUNGO0lBQ0gsQ0FBQztJQUVELFFBQVEsQ0FBQyxFQUFVLEVBQUUsSUFBc0IsRUFBRSxPQUFlLEVBQUUsR0FBVztRQUN2RSxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUNyQixFQUFFLEdBQUcsV0FBVyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxHQUFHLE9BQU8sSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMvRSxDQUFDO0lBRUQsVUFBVSxDQUFDLEVBQVUsRUFBRSxRQUFnQixDQUFDO1FBQ3RDLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztRQUMzQyxPQUFPLE9BQU8sR0FBRyxHQUFHLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLElBQUksS0FBSyxHQUFHLElBQUksRUFBRSxHQUFHLElBQUksR0FBRyxDQUFDO0lBQ3ZFLENBQUM7Q0FDRjtBQUVELE1BQU0sTUFBTSxHQUFHO0lBQ2IsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVE7SUFDOUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVE7SUFDOUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVE7SUFDOUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVE7SUFDOUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVE7SUFDOUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVE7SUFDOUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVE7SUFDOUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVE7Q0FDL0UsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuaW1wb3J0IHtEZWZhdWx0TWFwfSBmcm9tICcuLi91dGlsLmpzJztcblxuZXhwb3J0IGNsYXNzIEdyYXBoaWNzIHtcblxuICAvKioga2V5IGlzIChpZCkoaW5kZXgpICovXG4gIHBhbGV0dGVzID0gbmV3IFVpbnQzMkFycmF5KDB4NDAwKTtcblxuICAvKioga2V5IGlzICh0aWxlaWQpKHBhbGV0dGUpICovXG4gIHRpbGVzID0gbmV3IERlZmF1bHRNYXA8bnVtYmVyLCBVaW50OEFycmF5PigoKCkgPT4ge1xuICAgIHJldHVybiAoa2V5OiBudW1iZXIpID0+IHtcbiAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDMyQXJyYXkoNjQpO1xuICAgICAgY29uc3QgdWludDggPSBuZXcgVWludDhBcnJheShkYXRhLmJ1ZmZlcik7XG4gICAgICBkYXRhLmZpbGwoMCk7XG4gICAgICBjb25zdCBwYWwgPSAoa2V5ICYgMHhmZikgPDwgMjtcbiAgICAgIGNvbnN0IGlkID0ga2V5ID4+PiA4O1xuXG4gICAgICAvLyBQbG90IG9uIGNhbnZhc1xuICAgICAgY29uc3QgcGF0ID0gdGhpcy5yb20ucGF0dGVybnNbaWRdO1xuICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCA4OyByKyspIHtcbiAgICAgICAgbGV0IGhpID0gcGF0LnBpeGVsc1s4IHwgcl0gPDwgMTtcbiAgICAgICAgbGV0IGxvID0gcGF0LnBpeGVsc1tyXTtcbiAgICAgICAgZm9yIChsZXQgYyA9IDc7IGMgPj0gMDsgYy0tKSB7XG4gICAgICAgICAgY29uc3QgeiA9IGhpICYgMiB8IGxvICYgMTtcbiAgICAgICAgICBoaSA+Pj49IDE7XG4gICAgICAgICAgbG8gPj4+PSAxO1xuICAgICAgICAgIGlmICh6KSBkYXRhW3IgPDwgMyB8IGNdID0gdGhpcy5wYWxldHRlc1twYWwgfCB6XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHVpbnQ4O1xuICAgIH07XG4gIH0pKCkpO1xuXG4gIC8qKiBrZXkgaXMgNDAgYml0czogKGlkKShwYXQwKShwYXQxKSh0aWxlc2V0KShwYWwpICovXG4gIG1ldGF0aWxlcyA9IG5ldyBEZWZhdWx0TWFwPG51bWJlciwgc3RyaW5nPigoKCkgPT4ge1xuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIGNhbnZhcy53aWR0aCA9IGNhbnZhcy5oZWlnaHQgPSAxNjtcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSE7XG4gICAgcmV0dXJuIChrZXk6IG51bWJlcikgPT4ge1xuICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCAxNiwgMTYpO1xuICAgICAgY29uc3QgcGFsID0ga2V5ICUgMjU2O1xuICAgICAga2V5ID0gTWF0aC5mbG9vcihrZXkgLyAyNTYpO1xuICAgICAgY29uc3QgaWQgPSBrZXkgPj4+IDI0O1xuICAgICAgY29uc3QgcGF0cyA9IFsoa2V5ID4+PiAxNikgJiAweGZmLCAoa2V5ID4+PiA4KSAmIDB4ZmZdO1xuICAgICAgY29uc3QgdHMgPSB0aGlzLnJvbS50aWxlc2V0c1trZXkgJiAweGZmXTtcbiAgICAgIC8vIFBsb3Qgb24gdGhlIGNhbnZhc1xuICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCAyOyByKyspIHtcbiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCAyOyBjKyspIHtcbiAgICAgICAgICBjb25zdCB0aWxlID0gdHMudGlsZXNbciA8PCAxIHwgY11baWRdO1xuICAgICAgICAgIGNvbnN0IGRhdGEgPVxuICAgICAgICAgICAgICB0aGlzLnRpbGVzLmdldChwYXRzW3RpbGUgPj4+IDddIDw8IDE0IHwgKHRpbGUgJiAweDdmKSA8PCA4IHwgcGFsKTtcbiAgICAgICAgICBjb25zdCBpbWdEYXRhID0gY3R4LmdldEltYWdlRGF0YShjIDw8IDMsIHIgPDwgMywgOCwgOCk7XG4gICAgICAgICAgaW1nRGF0YS5kYXRhLnNldChkYXRhKTtcbiAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIGMgPDwgMywgciA8PCAzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpOyAgICAgIFxuICAgIH07XG4gIH0pKCkpO1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IHJvbTogUm9tKSB7XG4gICAgdGhpcy5yZWJ1aWxkUGFsZXR0ZXMoKTtcbiAgfVxuXG4gIHJlYnVpbGRQYWxldHRlcygpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDB4MTAwOyBpKyspIHtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNDsgaisrKSB7XG4gICAgICAgIGNvbnN0IGNvbG9yID0gQ09MT1JTW3RoaXMucm9tLnBhbGV0dGVzW2ldLmNvbG9yKGopXTtcbiAgICAgICAgdGhpcy5wYWxldHRlc1tpIDw8IDIgfCBqXSA9IGNvbG9yIHwgMHhmZjAwMDAwMDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBtZXRhdGlsZShpZDogbnVtYmVyLCBwYXRzOiBbbnVtYmVyLCBudW1iZXJdLCB0aWxlc2V0OiBudW1iZXIsIHBhbDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5tZXRhdGlsZXMuZ2V0KFxuICAgICAgICBpZCAqIDB4MTAwMDAwMDAwICsgKHBhdHNbMF0gPDwgMjQgfCBwYXRzWzFdIDw8IDE2IHwgdGlsZXNldCA8PCA4IHwgcGFsKSk7XG4gIH1cblxuICBwYWxldHRlQ3NzKGlkOiBudW1iZXIsIGluZGV4OiBudW1iZXIgPSAwKTogc3RyaW5nIHtcbiAgICBjb25zdCByZ2IgPSB0aGlzLnBhbGV0dGVzW2lkIDw8IDIgfCBpbmRleF07XG4gICAgcmV0dXJuIGByZ2IoJHtyZ2IgJiAweGZmfSwgJHtyZ2IgPj4gOCAmIDB4ZmZ9LCAke3JnYiA+PiAxNiAmIDB4ZmZ9KWA7XG4gIH1cbn1cblxuY29uc3QgQ09MT1JTID0gW1xuICAweDUyNTI1MiwgMHhCNDAwMDAsIDB4QTAwMDAwLCAweEIxMDAzRCwgMHg3NDAwNjksIDB4MDAwMDVCLCAweDAwMDA1RiwgMHgwMDE4NDAsXG4gIDB4MDAyRjEwLCAweDA4NEEwOCwgMHgwMDY3MDAsIDB4MTI0MjAwLCAweDZEMjgwMCwgMHgwMDAwMDAsIDB4MDAwMDAwLCAweDAwMDAwMCxcbiAgMHhDNEQ1RTcsIDB4RkY0MDAwLCAweERDMEUyMiwgMHhGRjQ3NkIsIDB4RDcwMDlGLCAweDY4MEFENywgMHgwMDE5QkMsIDB4MDA1NEIxLFxuICAweDAwNkE1QiwgMHgwMDhDMDMsIDB4MDBBQjAwLCAweDJDODgwMCwgMHhBNDcyMDAsIDB4MDAwMDAwLCAweDAwMDAwMCwgMHgwMDAwMDAsXG4gIDB4RjhGOEY4LCAweEZGQUIzQywgMHhGRjc5ODEsIDB4RkY1QkM1LCAweEZGNDhGMiwgMHhERjQ5RkYsIDB4NDc2REZGLCAweDAwQjRGNyxcbiAgMHgwMEUwRkYsIDB4MDBFMzc1LCAweDAzRjQyQiwgMHg3OEI4MkUsIDB4RTVFMjE4LCAweDc4Nzg3OCwgMHgwMDAwMDAsIDB4MDAwMDAwLFxuICAweEZGRkZGRiwgMHhGRkYyQkUsIDB4RjhCOEI4LCAweEY4QjhEOCwgMHhGRkI2RkYsIDB4RkZDM0ZGLCAweEM3RDFGRiwgMHg5QURBRkYsXG4gIDB4ODhFREY4LCAweDgzRkZERCwgMHhCOEY4QjgsIDB4RjVGOEFDLCAweEZGRkZCMCwgMHhGOEQ4RjgsIDB4MDAwMDAwLCAweDAwMDAwMCxcbl07XG4iXX0=