export function shufflePyramid(rom, random) {
    const loc = rom.locations.Pyramid_Main;
    const dir = 'dudududuudududduu'.split('');
    let realDir = 'u';
    if (random.next() < 0.5) {
        loc.screens[0][3] = 0x84;
        loc.screens[0][2] = 0x99;
        dir[16] = realDir = 'd';
        loc.entrances[12].screen = loc.entrances[16].screen;
        loc.entrances[12].coord = loc.entrances[16].coord;
        loc.exits[2 * 12].screen = loc.exits[2 * 16].screen;
        loc.exits[2 * 12].tile = loc.exits[2 * 16].tile;
        loc.exits[2 * 12 + 1].screen = loc.exits[2 * 16 + 1].screen;
        loc.exits[2 * 12 + 1].tile = loc.exits[2 * 16 + 1].tile;
        loc.entrances[16].screen = 0x02;
        loc.entrances[16].coord = 0xafd0;
        loc.exits[2 * 16].screen = loc.exits[2 * 16 + 1].screen = 0x02;
        loc.exits[2 * 16].tile = 0xbc;
        loc.exits[2 * 16 + 1].tile = 0xbd;
        const loc2 = rom.locations.Pyramid_Draygon;
        loc2.width = 2;
        loc2.screens[0].push(0x9a);
        loc2.screens[1].push(0xfd);
        loc2.screens[2] = [0xe0, 0xe1];
        loc2.exits[0].screen = loc2.exits[1].screen = 0x01;
        loc2.exits[0].tile = 0xc7;
        loc2.exits[1].tile = 0xc8;
        loc2.entrances[0].screen = 0x01;
        loc2.entrances[0].coord = 0xd080;
    }
    const all = { 'u': [], 'd': [] };
    for (let i = 0; i < dir.length; i++) {
        all[dir[i]].push(i);
    }
    random.shuffle(all['u']);
    random.shuffle(all['d']);
    const realEntrance = all[realDir].pop();
    const entrances = [];
    entrances[16] = loc.entrances[realEntrance];
    setExit(realEntrance, 0x9f, 0);
    const upEntrance = all['u'].pop();
    entrances[1] = loc.entrances[upEntrance];
    setExit(upEntrance, 0x9d, 2);
    let downEntrance = all['d'].pop();
    if (realDir === 'u' && downEntrance === 0xe && upEntrance === 0xc) {
        [downEntrance] = all['d'].splice(0, 1, downEntrance);
    }
    else if (realDir === 'd' &&
        ((downEntrance === 0xe && realEntrance === 0x10) ||
            (downEntrance === 0x10 && realEntrance === 0xe))) {
        [downEntrance] = all['d'].splice(0, 1, downEntrance);
    }
    entrances[0] = loc.entrances[downEntrance];
    setExit(downEntrance, 0x9d, 1);
    do {
        const sources = { 'u': [...all['u']], 'd': [...all['d']] };
        const dests = { 'u': [...all['u']], 'd': [...all['d']] };
        random.shuffle(dests['u']);
        random.shuffle(dests['d']);
        const inv = { 'u': 'd', 'd': 'u' };
        for (let i = 2; i < 16; i++) {
            const source = sources[dir[i]].pop();
            const dest = dests[inv[dir[i]]].pop();
            if (source == null || dest == null)
                throw new Error('impossible');
            entrances[i] = loc.entrances[source];
            setExit(dest, 0x9e, i);
        }
        const cExit = loc.exits[2 * 0xc];
        const eExit = loc.exits[2 * 0xe];
        if (realDir === 'u' && cExit.dest === eExit.dest &&
            loc.entrances[0xe] === entrances[cExit.entrance] &&
            loc.entrances[0xc] === entrances[eExit.entrance]) {
            continue;
        }
        break;
    } while (true);
    loc.entrances = entrances;
    function setExit(i, dest, entrance) {
        loc.exits[2 * i].dest = loc.exits[2 * i + 1].dest = dest;
        loc.exits[2 * i].entrance = loc.exits[2 * i + 1].entrance = entrance;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHlyYW1pZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9tYXplL3B5cmFtaWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUEsTUFBTSxVQUFVLGNBQWMsQ0FBQyxHQUFRLEVBQUUsTUFBYztJQWtCckQsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUM7SUFDdkMsTUFBTSxHQUFHLEdBQUcsbUJBQW1CLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBVSxDQUFDO0lBQ25ELElBQUksT0FBTyxHQUFRLEdBQUcsQ0FBQztJQUd2QixJQUFJLE1BQU0sQ0FBQyxJQUFJLEVBQUUsR0FBRyxHQUFHLEVBQUU7UUFFdkIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDekIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDekIsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE9BQU8sR0FBRyxHQUFHLENBQUM7UUFHeEIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDcEQsR0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDbEQsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUNwRCxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ2hELEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUM1RCxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFHeEQsR0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2hDLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztRQUNqQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDL0QsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUM5QixHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUdsQyxNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQztRQUMzQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FB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O1FBRUQsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDakMsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDakMsSUFBSSxPQUFPLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDLElBQUk7WUFDNUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxTQUFTLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQztZQUNoRCxHQUFHLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDcEQsU0FBUztTQUNWO1FBQ0QsTUFBTTtLQUNQLFFBQVEsSUFBSSxFQUFFO0lBQ2YsR0FBRyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7SUFFMUIsU0FBUyxPQUFPLENBQUMsQ0FBUyxFQUFFLElBQVksRUFBRSxRQUFnQjtRQUN4RCxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDekQsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQ3ZFLENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtSYW5kb219IGZyb20gJy4uL3JhbmRvbS5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcbmltcG9ydCB7RW50cmFuY2V9IGZyb20gJy4uL3JvbS9sb2NhdGlvbi5qcyc7XG5cbnR5cGUgRGlyID0gJ3UnIHwgJ2QnO1xuXG5leHBvcnQgZnVuY3Rpb24gc2h1ZmZsZVB5cmFtaWQocm9tOiBSb20sIHJhbmRvbTogUmFuZG9tKTogdm9pZCB7XG4gIC8vIFRoZSBweXJhbWlkIGhhcyAxNyBlbnRyYW5jZXMvZXhpdHM6IDggZG93biwgOSB1cC5cbiAgLy8gVGhlIGVudHJhbmNlcyBhbmQgZXhpdHMgYXJlIHBhaXJlZDogZW50cmFuY2UgMCA8PT0+IGV4aXRzIDAgYW5kIDEsXG4gIC8vIGVudHJhbmNlIDEgPD09PiBleGl0cyAyIGFuZCAzLCBldGMuICBOb3JtYWxseSAwIGFuZCAxIGdvIGJhY2sgdG9cbiAgLy8gdGhlIGVudHJhbmNlIGFuZCAxNiBhZHZhbmNlcy5cbiAgLy9cbiAgLy8gT3VyIHN0cmF0ZWd5IGhlcmUgaXMgdG8gc2h1ZmZsZSB0aGUgcG9zaXRpb25zIG9mIHRoZSBlbnRyYW5jZXMsXG4gIC8vIHNvIHRoYXQgd2UgZG9uJ3QgbmVlZCB0byBjaGFuZ2UgdGhlIGV4aXQgZGVzdGluYXRpb25zIHBvaW50aW5nXG4gIC8vIHRvIHRoZW0uICBXZSBzdGFydCBieSBwaWNraW5nIDMgZW50cmFuY2VzIHRvIGJlIG5vcm1hbCwgYW5kIHB1bGxcbiAgLy8gdGhlbSBvdXQgb2YgdGhlIG1peCwgYXNzaWduaW5nIHRoZW0gdGhlIGNvcnJlY3QgaW5mb3JtYXRpb24gc29cbiAgLy8gdGhhdCB0aGV5J3JlIHByb3Blcmx5IHJldmVyc2libGUuICBUaGUgcmVtYWluaW5nIDcgdXAgYW5kIDcgZG93blxuICAvLyBlbnRyYW5jZXMgYXJlIHRoZW4gcGFpcmVkIHVwIHJhbmRvbWx5LCBub3QgbmVjZXNzYXJpbHkgcmV2ZXJzaWJseS5cbiAgLy9cbiAgLy8gVGhlcmUncyBvbmUgZWRnZSBjYXNlIHRvIGJlIGF3YXJlIG9mOiBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIGNoZXN0XG4gIC8vIHJvb20gZm9ybXMgYSBjbG9zZWQgbG9vcCwgZWl0aGVyIGJlY2F1c2UgYm90aCBiYWNrIGVudHJhbmNlcyBhcmVcbiAgLy8gdGhlcmUsIG9yIGJlY2F1c2UgdGhleSByZXZlcnNpYmx5IHBvaW50IHRvIGVhY2ggb3RoZXIuICBXZSBtdXN0XG4gIC8vIGRldGVjdCBlaXRoZXIgY2FzZSBhbmQgcmVyb2xsLlxuXG4gIGNvbnN0IGxvYyA9IHJvbS5sb2NhdGlvbnMuUHlyYW1pZF9NYWluO1xuICBjb25zdCBkaXIgPSAnZHVkdWR1ZHV1ZHVkdWRkdXUnLnNwbGl0KCcnKSBhcyBEaXJbXTtcbiAgbGV0IHJlYWxEaXI6IERpciA9ICd1JztcblxuICAvLyA1MCUgY2hhbmNlIHRvIGZsaXAgdGhlIHRvcCBlbnRyYW5jZSB1cHNpZGUgZG93bi5cbiAgaWYgKHJhbmRvbS5uZXh0KCkgPCAwLjUpIHtcbiAgICAvLyBBZGQgYW4gZXh0cmEgc2NyZWVuIHRvIHBvaW50IHRoZSB0b3AgZXhpdCBkb3dud2FyZC5cbiAgICBsb2Muc2NyZWVuc1swXVszXSA9IDB4ODQ7XG4gICAgbG9jLnNjcmVlbnNbMF1bMl0gPSAweDk5O1xuICAgIGRpclsxNl0gPSByZWFsRGlyID0gJ2QnO1xuXG4gICAgLy8gTW92ZSBlbnRyYW5jZSAxMiB0byB0aGUgdmFuaWxsYSBhZHZhbmNlbWVudCBkb29yLlxuICAgIGxvYy5lbnRyYW5jZXNbMTJdLnNjcmVlbiA9IGxvYy5lbnRyYW5jZXNbMTZdLnNjcmVlbjtcbiAgICBsb2MuZW50cmFuY2VzWzEyXS5jb29yZCA9IGxvYy5lbnRyYW5jZXNbMTZdLmNvb3JkO1xuICAgIGxvYy5leGl0c1syICogMTJdLnNjcmVlbiA9IGxvYy5leGl0c1syICogMTZdLnNjcmVlbjtcbiAgICBsb2MuZXhpdHNbMiAqIDEyXS50aWxlID0gbG9jLmV4aXRzWzIgKiAxNl0udGlsZTtcbiAgICBsb2MuZXhpdHNbMiAqIDEyICsgMV0uc2NyZWVuID0gbG9jLmV4aXRzWzIgKiAxNiArIDFdLnNjcmVlbjtcbiAgICBsb2MuZXhpdHNbMiAqIDEyICsgMV0udGlsZSA9IGxvYy5leGl0c1syICogMTYgKyAxXS50aWxlO1xuXG4gICAgLy8gTW92ZSBlbnRyYW5jZSAxNiB0byB0aGUgbmV3IHRpbGUuXG4gICAgbG9jLmVudHJhbmNlc1sxNl0uc2NyZWVuID0gMHgwMjtcbiAgICBsb2MuZW50cmFuY2VzWzE2XS5jb29yZCA9IDB4YWZkMDtcbiAgICBsb2MuZXhpdHNbMiAqIDE2XS5zY3JlZW4gPSBsb2MuZXhpdHNbMiAqIDE2ICsgMV0uc2NyZWVuID0gMHgwMjtcbiAgICBsb2MuZXhpdHNbMiAqIDE2XS50aWxlID0gMHhiYztcbiAgICBsb2MuZXhpdHNbMiAqIDE2ICsgMV0udGlsZSA9IDB4YmQ7XG5cbiAgICAvLyBGaXggdXAgdGhlIGxhbmRpbmcgdG8gYmUgdGhlIG90aGVyIGRpcmVjdGlvbiwgdG9vLlxuICAgIGNvbnN0IGxvYzIgPSByb20ubG9jYXRpb25zLlB5cmFtaWRfRHJheWdvbjtcbiAgICBsb2MyLndpZHRoID0gMjtcbiAgICBsb2MyLnNjcmVlbnNbMF0ucHVzaCgweDlhKTtcbiAgICBsb2MyLnNjcmVlbnNbMV0ucHVzaCgweGZkKTtcbiAgICBsb2MyLnNjcmVlbnNbMl0gPSBbMHhlMCwgMHhlMV07XG4gICAgbG9jMi5leGl0c1swXS5zY3JlZW4gPSBsb2MyLmV4aXRzWzFdLnNjcmVlbiA9IDB4MDE7XG4gICAgbG9jMi5leGl0c1swXS50aWxlID0gMHhjNztcbiAgICBsb2MyLmV4aXRzWzFdLnRpbGUgPSAweGM4O1xuICAgIGxvYzIuZW50cmFuY2VzWzBdLnNjcmVlbiA9IDB4MDE7XG4gICAgbG9jMi5lbnRyYW5jZXNbMF0uY29vcmQgPSAweGQwODA7XG4gIH1cblxuICBjb25zdCBhbGwgPSB7J3UnOiBbXSBhcyBudW1iZXJbXSwgJ2QnOiBbXSBhcyBudW1iZXJbXX07XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGlyLmxlbmd0aDsgaSsrKSB7XG4gICAgYWxsW2RpcltpXV0ucHVzaChpKTtcbiAgfVxuXG4gIHJhbmRvbS5zaHVmZmxlKGFsbFsndSddKTtcbiAgcmFuZG9tLnNodWZmbGUoYWxsWydkJ10pO1xuICBjb25zdCByZWFsRW50cmFuY2UgPSBhbGxbcmVhbERpcl0ucG9wKCkhO1xuXG4gIGNvbnN0IGVudHJhbmNlczogRW50cmFuY2VbXSA9IFtdO1xuICAvLyBGaXggdGhlIFwicmVhbCBlbnRyYW5jZVwiXG4gIGVudHJhbmNlc1sxNl0gPSBsb2MuZW50cmFuY2VzW3JlYWxFbnRyYW5jZV07XG4gIHNldEV4aXQocmVhbEVudHJhbmNlLCAweDlmLCAwKTtcbiAgLy8gRml4IHRoZSBicmFuY2hlZCBlbnRyYW5jZXNcbiAgY29uc3QgdXBFbnRyYW5jZSA9IGFsbFsndSddLnBvcCgpITtcbiAgZW50cmFuY2VzWzFdID0gbG9jLmVudHJhbmNlc1t1cEVudHJhbmNlXTtcbiAgc2V0RXhpdCh1cEVudHJhbmNlLCAweDlkLCAyKTtcbiAgbGV0IGRvd25FbnRyYW5jZSA9IGFsbFsnZCddLnBvcCgpITtcbiAgaWYgKHJlYWxEaXIgPT09ICd1JyAmJiBkb3duRW50cmFuY2UgPT09IDB4ZSAmJiB1cEVudHJhbmNlID09PSAweGMpIHtcbiAgICAvLyBwcmV2ZW50IHRoZSBjYXNlIHdoZXJlIGJvdGggYmFjayBlbnRyYW5jZXMgYXJlIGluIHRoZSBjaGVzdCByb29tXG4gICAgW2Rvd25FbnRyYW5jZV0gPSBhbGxbJ2QnXS5zcGxpY2UoMCwgMSwgZG93bkVudHJhbmNlKTtcbiAgfSBlbHNlIGlmIChyZWFsRGlyID09PSAnZCcgJiZcbiAgICAgICAgICAgICAoKGRvd25FbnRyYW5jZSA9PT0gMHhlICYmIHJlYWxFbnRyYW5jZSA9PT0gMHgxMCkgfHxcbiAgICAgICAgICAgICAgKGRvd25FbnRyYW5jZSA9PT0gMHgxMCAmJiByZWFsRW50cmFuY2UgPT09IDB4ZSkpKSB7XG4gICAgLy8gcHJldmVudCB0aGUgY2FzZSB3aGVyZSBib3RoIGRvd24tYmFjayBhbmQgcmVhbCBleGl0IGFyZSBpbiBjaGVzdCByb29tXG4gICAgW2Rvd25FbnRyYW5jZV0gPSBhbGxbJ2QnXS5zcGxpY2UoMCwgMSwgZG93bkVudHJhbmNlKTtcbiAgfVxuICBlbnRyYW5jZXNbMF0gPSBsb2MuZW50cmFuY2VzW2Rvd25FbnRyYW5jZV07XG4gIHNldEV4aXQoZG93bkVudHJhbmNlLCAweDlkLCAxKTtcbiAgLy8gTm93IGRvIHRoZSBmdWxsIHNodWZmbGVkIHJlbWFwXG4gIGRvIHtcbiAgICBjb25zdCBzb3VyY2VzID0geyd1JzogWy4uLmFsbFsndSddXSwgJ2QnOiBbLi4uYWxsWydkJ11dfTtcbiAgICBjb25zdCBkZXN0cyA9IHsndSc6IFsuLi5hbGxbJ3UnXV0sICdkJzogWy4uLmFsbFsnZCddXX07XG4gICAgcmFuZG9tLnNodWZmbGUoZGVzdHNbJ3UnXSk7XG4gICAgcmFuZG9tLnNodWZmbGUoZGVzdHNbJ2QnXSk7XG4gICAgY29uc3QgaW52ID0geyd1JzogJ2QnLCAnZCc6ICd1J30gYXMgY29uc3Q7XG4gICAgZm9yIChsZXQgaSA9IDI7IGkgPCAxNjsgaSsrKSB7XG4gICAgICAvLyBGb3IgZWFjaCBlbnRyYW5jZSBpPTIuLjE2LCBwaWNrIGEgcmVtYWluaW5nIHNhbWUtZGlyZWN0aW9uIGVudHJhbmNlXG4gICAgICAvLyBhbmQgYSByZW1haW5pbmcgb3Bwb3NpdGUtZGlyZWN0aW9uIGVudHJhbmNlLlxuICAgICAgY29uc3Qgc291cmNlID0gc291cmNlc1tkaXJbaV1dLnBvcCgpO1xuICAgICAgY29uc3QgZGVzdCA9IGRlc3RzW2ludltkaXJbaV1dXS5wb3AoKTtcbiAgICAgIGlmIChzb3VyY2UgPT0gbnVsbCB8fCBkZXN0ID09IG51bGwpIHRocm93IG5ldyBFcnJvcignaW1wb3NzaWJsZScpO1xuICAgICAgZW50cmFuY2VzW2ldID0gbG9jLmVudHJhbmNlc1tzb3VyY2VdO1xuICAgICAgc2V0RXhpdChkZXN0LCAweDllLCBpKTtcbiAgICB9XG4gICAgLy8gTWFrZSBzdXJlIHdlIGRpZG4ndCBjdXQgb2ZmIHRoZSBjaGVzdCByb29tIGZyb20gdGhlIHJlc3Qgb2YgdGhlIG1hcC5cbiAgICBjb25zdCBjRXhpdCA9IGxvYy5leGl0c1syICogMHhjXTtcbiAgICBjb25zdCBlRXhpdCA9IGxvYy5leGl0c1syICogMHhlXTtcbiAgICBpZiAocmVhbERpciA9PT0gJ3UnICYmIGNFeGl0LmRlc3QgPT09IGVFeGl0LmRlc3QgJiZcbiAgICAgICAgbG9jLmVudHJhbmNlc1sweGVdID09PSBlbnRyYW5jZXNbY0V4aXQuZW50cmFuY2VdICYmXG4gICAgICAgIGxvYy5lbnRyYW5jZXNbMHhjXSA9PT0gZW50cmFuY2VzW2VFeGl0LmVudHJhbmNlXSkge1xuICAgICAgY29udGludWU7IC8vIHRyeSBhZ2FpblxuICAgIH1cbiAgICBicmVhaztcbiAgfSB3aGlsZSAodHJ1ZSk7XG4gIGxvYy5lbnRyYW5jZXMgPSBlbnRyYW5jZXM7XG5cbiAgZnVuY3Rpb24gc2V0RXhpdChpOiBudW1iZXIsIGRlc3Q6IG51bWJlciwgZW50cmFuY2U6IG51bWJlcikge1xuICAgIGxvYy5leGl0c1syICogaV0uZGVzdCA9IGxvYy5leGl0c1syICogaSArIDFdLmRlc3QgPSBkZXN0O1xuICAgIGxvYy5leGl0c1syICogaV0uZW50cmFuY2UgPSBsb2MuZXhpdHNbMiAqIGkgKyAxXS5lbnRyYW5jZSA9IGVudHJhbmNlO1xuICB9XG59XG4iXX0=