import { Token } from './token.js';
export var Expr;
(function (Expr) {
    function traverse(expr, f) {
        function rec(e) {
            if (!e.args)
                return e;
            return { ...e, args: e.args.map(c => t(c, e)) };
        }
        ;
        function t(e, p) {
            const source = e.source;
            e = f(e, rec, p);
            if (source && !e.source)
                e.source = source;
            return e;
        }
        return t(expr);
    }
    Expr.traverse = traverse;
    function traversePost(expr, f) {
        return traverse(expr, (expr, rec) => f(rec(expr)));
    }
    Expr.traversePost = traversePost;
    function evaluate(expr) {
        var _a, _b, _c, _d;
        switch (expr.op) {
            case '.move':
            case 'im':
            case 'sym':
                return expr;
            case 'num':
                if (((_a = expr.meta) === null || _a === void 0 ? void 0 : _a.rel) && expr.meta.org != null) {
                    const { rel, ...meta } = expr.meta;
                    return { op: 'num', num: expr.num + meta.org, meta };
                }
                return expr;
            case '.max': return sameChunk(expr, Math.max);
            case '.min': return sameChunk(expr, Math.min);
            default:
        }
        if (((_b = expr.args) === null || _b === void 0 ? void 0 : _b.length) === 1) {
            switch (expr.op) {
                case '+': return expr.args[0];
                case '-': return unary(expr, x => -x);
                case '~': return unary(expr, x => ~x);
                case '!': return unary(expr, x => +!x);
                case '<': return unary(expr, x => x & 0xff);
                case '>': return unary(expr, x => (x >> 8) & 0xff);
                case '^': return (_d = num((_c = expr.args[0].meta) === null || _c === void 0 ? void 0 : _c.bank)) !== null && _d !== void 0 ? _d : expr;
                default: throw new Error(`Unknown unary operator: ${expr.op}`);
            }
        }
        switch (expr.op) {
            case '+': return plus(expr);
            case '-': return minus(expr);
            case '*': return binary(expr, (a, b) => a * b);
            case '/': return binary(expr, (a, b) => Math.floor(a / b));
            case '.mod': return binary(expr, (a, b) => a % b);
            case '&': return binary(expr, (a, b) => a & b);
            case '|': return binary(expr, (a, b) => a | b);
            case '^': return binary(expr, (a, b) => a ^ b);
            case '<<': return binary(expr, (a, b) => a << b);
            case '>>': return binary(expr, (a, b) => a >>> b);
            case '<': return binary(expr, (a, b) => +(a < b));
            case '<=': return binary(expr, (a, b) => +(a <= b));
            case '>': return binary(expr, (a, b) => +(a > b));
            case '>=': return binary(expr, (a, b) => +(a >= b));
            case '=': return binary(expr, (a, b) => +(a == b));
            case '<>': return binary(expr, (a, b) => +(a != b));
            case '&&': return binary(expr, (a, b) => a && b);
            case '||': return binary(expr, (a, b) => a || b);
            case '.xor': return binary(expr, (a, b) => !a && b || !b && a || 0);
            default: throw new Error(`Unknown operator: ${expr.op}`);
        }
    }
    Expr.evaluate = evaluate;
    function identifier(expr) {
        if (expr.op === 'sym' && expr.sym)
            return expr.sym;
        throw new Error(`Expected identifier but got op: ${expr.op}`);
    }
    Expr.identifier = identifier;
    function parseOnly(tokens, index = 0) {
        const [expr, i] = parse(tokens, index);
        if (i < tokens.length) {
            throw new Error(`Garbage after expression: ${Token.nameAt(tokens[i])}`);
        }
        else if (!expr) {
            throw new Error(`No expression?`);
        }
        return expr;
    }
    Expr.parseOnly = parseOnly;
    function parse(tokens, index = 0) {
        const ops = [];
        const exprs = [];
        function popOp() {
            const [op, [, , arity]] = ops.pop();
            const args = exprs.splice(exprs.length - arity, arity);
            if (args.length !== arity)
                throw new Error('shunting parse failed?');
            exprs.push(fixSize({ op, args }));
        }
        let val = true;
        let i = index;
        for (; i < tokens.length; i++) {
            const front = tokens[i];
            if (val) {
                if (front.token === 'cs' || front.token === 'op') {
                    const mapped = NAME_MAP.get(front.str);
                    const prefix = PREFIXOPS.get(mapped !== null && mapped !== void 0 ? mapped : front.str);
                    if (prefix) {
                        ops.push([front.str, prefix]);
                    }
                    else if (front.token === 'cs') {
                        const op = front.str;
                        if (!FUNCTIONS.has(op)) {
                            throw new Error(`No such function: ${Token.nameAt(front)}`);
                        }
                        const next = tokens[i + 1];
                        if ((next === null || next === void 0 ? void 0 : next.token) !== 'lp') {
                            throw new Error(`Bad funcall: ${Token.nameAt(next !== null && next !== void 0 ? next : front)}`);
                        }
                        const close = Token.findBalanced(tokens, i + 1);
                        if (close < 0) {
                            throw new Error(`Never closed: ${Token.nameAt(next)}`);
                        }
                        const args = [];
                        for (const arg of Token.parseArgList(tokens, i + 2, close)) {
                            args.push(parseOnly(arg));
                        }
                        i = close;
                        exprs.push(fixSize({ op, args }));
                        val = false;
                    }
                    else if (Token.eq(front, Token.STAR)) {
                        exprs.push({ op: 'sym', sym: '*' });
                        val = false;
                    }
                    else {
                        throw new Error(`Unknown prefix operator: ${Token.nameAt(front)}`);
                    }
                }
                else if (front.token === 'lp') {
                    const close = Token.findBalanced(tokens, i);
                    if (close < 0) {
                        throw new Error(`No close paren: ${Token.nameAt(front)}`);
                    }
                    const e = parseOnly(tokens.slice(i + 1, close));
                    exprs.push(e);
                    i = close;
                    val = false;
                }
                else if (front.token === 'ident') {
                    exprs.push({ op: 'sym', sym: front.str });
                    val = false;
                }
                else if (front.token === 'num') {
                    const num = front.num;
                    exprs.push({ op: 'num', num, meta: size(num) });
                    val = false;
                }
                else {
                    throw new Error(`Bad expression token: ${Token.nameAt(front)}`);
                }
            }
            else {
                if (Token.eq(front, Token.COMMA)) {
                    break;
                }
                if (front.token === 'cs' || front.token === 'op') {
                    const mapped = NAME_MAP.get(front.str);
                    const op = BINOPS.get(mapped !== null && mapped !== void 0 ? mapped : front.str);
                    if (!op)
                        break;
                    while (ops.length) {
                        const top = ops[ops.length - 1];
                        const cmp = compareOp(top[1], op);
                        if (cmp < 0)
                            break;
                        if (cmp === 0) {
                            throw new Error(`Mixing ${top[0]} and ${front.str} needs explicit parens.${Token.at(front)}`);
                        }
                        popOp();
                    }
                    ops.push([front.str, op]);
                    val = true;
                }
                else {
                    break;
                }
            }
        }
        while (ops.length)
            popOp();
        if (exprs.length !== 1)
            throw new Error(`shunting parse failed?`);
        if (tokens[index].source)
            exprs[0].source = tokens[index].source;
        return [exprs[0], i];
    }
    Expr.parse = parse;
    function sameChunk(expr, f) {
        throw new Error();
    }
    function num(num) {
        if (num == null)
            return undefined;
        return { op: 'num', num, meta: size(num) };
    }
    function unary(expr, f) {
        const arg = expr.args[0];
        if (!isAbs(arg))
            return expr;
        const num = f(arg.num);
        return { op: 'num', num, meta: size(num) };
    }
    function binary(expr, f) {
        const [a, b] = expr.args;
        if (!isAbs(a) || !isAbs(b))
            return expr;
        const num = f(a.num, b.num);
        return { op: 'num', num, meta: size(num) };
    }
    function plus(expr) {
        var _a, _b, _c, _d, _e, _f;
        const [a, b] = expr.args;
        if (a.op !== 'num' || b.op !== 'num')
            return expr;
        const out = { op: 'num', num: a.num + b.num };
        if (a.meta || b.meta) {
            if (((_a = a.meta) === null || _a === void 0 ? void 0 : _a.rel) && ((_b = b.meta) === null || _b === void 0 ? void 0 : _b.rel))
                return expr;
            if ((_c = a.meta) === null || _c === void 0 ? void 0 : _c.rel) {
                out.meta = a.meta;
            }
            else if ((_d = b.meta) === null || _d === void 0 ? void 0 : _d.rel) {
                out.meta = b.meta;
            }
        }
        if (!((_e = out.meta) === null || _e === void 0 ? void 0 : _e.rel) && ((_f = out.meta) === null || _f === void 0 ? void 0 : _f.size) == null) {
            (out.meta || (out.meta = {})).size = size(out.num).size;
        }
        return out;
    }
    function minus(expr) {
        var _a, _b, _c, _d, _e;
        const [a, b] = expr.args;
        if (a.op !== 'num' || b.op !== 'num')
            return expr;
        const out = { op: 'num', num: a.num - b.num };
        if ((_a = b.meta) === null || _a === void 0 ? void 0 : _a.rel) {
            return ((_b = a.meta) === null || _b === void 0 ? void 0 : _b.rel) && a.meta.chunk === b.meta.chunk ? out : expr;
        }
        if ((_c = a.meta) === null || _c === void 0 ? void 0 : _c.rel)
            out.meta = a.meta;
        if (!((_d = out.meta) === null || _d === void 0 ? void 0 : _d.rel) && ((_e = out.meta) === null || _e === void 0 ? void 0 : _e.size) == null) {
            (out.meta || (out.meta = {})).size = size(out.num).size;
        }
        return out;
    }
    function isAbs(expr) {
        var _a;
        return expr.op === 'num' && !((_a = expr.meta) === null || _a === void 0 ? void 0 : _a.rel);
    }
})(Expr || (Expr = {}));
function compareOp(top, next) {
    if (top[0] > next[0])
        return 1;
    if (top[0] < next[0])
        return -1;
    if (top[1] !== next[1])
        return 0;
    return top[1];
}
const BINARY = 2;
const UNARY = 1;
export const BINOPS = new Map([
    ['*', [5, 4, BINARY]],
    ['/', [5, 4, BINARY]],
    ['.mod', [5, 3, BINARY]],
    ['&', [5, 2, BINARY]],
    ['^', [5, 1, BINARY]],
    ['<<', [5, 0, BINARY]],
    ['>>', [5, 0, BINARY]],
    ['+', [4, 2, BINARY]],
    ['-', [4, 2, BINARY]],
    ['|', [4, 1, BINARY]],
    ['<', [3, 0, BINARY]],
    ['<=', [3, 0, BINARY]],
    ['>', [3, 0, BINARY]],
    ['>=', [3, 0, BINARY]],
    ['=', [3, 0, BINARY]],
    ['<>', [3, 0, BINARY]],
    ['&&', [2, 3, BINARY]],
    ['.xor', [2, 2, BINARY]],
    ['||', [2, 1, BINARY]],
]);
const PREFIXOPS = new Map([
    ['+', [9, -1, UNARY]],
    ['-', [9, -1, UNARY]],
    ['~', [9, -1, UNARY]],
    ['<', [9, -1, UNARY]],
    ['>', [9, -1, UNARY]],
    ['^', [9, -1, UNARY]],
    ['!', [2, -1, UNARY]],
]);
const FUNCTIONS = new Set([
    '.byteat',
    '.wordat',
    '.max', '.min',
]);
const NAME_MAP = new Map([
    ['.bitand', '&'],
    ['.bitxor', '^'],
    ['.bitor', '|'],
    ['.shl', '<<'],
    ['.shr', '>>'],
    ['.and', '&&'],
    ['.or', '||'],
    ['.bitnot', '~'],
    ['.lobyte', '<'],
    ['.hibyte', '>'],
    ['.bankbyte', '^'],
    ['.not', '!'],
]);
const SIZE_TRANSFORMS = new Map([
    ['^', (...args) => args.length === 1 ? 1 : Math.max(...args)],
    ['<', () => 1],
    ['>', () => 1],
    ['!', () => 1],
    ['<=', () => 1],
    ['>=', () => 1],
    ['<>', () => 1],
    ['=', () => 1],
    ['&', Math.max],
    ['&&', Math.max],
    ['|', Math.max],
    ['||', Math.max],
    ['.xor', Math.max],
    ['.max', Math.max],
    ['.min', Math.max],
]);
function fixSize(expr) {
    const xform = SIZE_TRANSFORMS.get(expr.op);
    const size = xform === null || xform === void 0 ? void 0 : xform(...expr.args.map(e => { var _a; return Number((_a = e.meta) === null || _a === void 0 ? void 0 : _a.size); }));
    if (size)
        (expr.meta || (expr.meta = {})).size = size;
    return expr;
}
function size(num) {
    return { size: 0 <= num && num < 256 ? 1 : 2 };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9hc20vZXhwci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsS0FBSyxFQUFDLE1BQU0sWUFBWSxDQUFDO0FBa0I3QyxNQUFNLEtBQVcsSUFBSSxDQTJUcEI7QUEzVEQsV0FBaUIsSUFBSTtJQXNCbkIsU0FBZ0IsUUFBUSxDQUFDLElBQVUsRUFBRSxDQUFZO1FBQy9DLFNBQVMsR0FBRyxDQUFDLENBQU87WUFDbEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJO2dCQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3RCLE9BQU8sRUFBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztRQUNoRCxDQUFDO1FBQUEsQ0FBQztRQUNGLFNBQVMsQ0FBQyxDQUFDLENBQU8sRUFBRSxDQUFRO1lBQzFCLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDeEIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLElBQUksTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU07Z0JBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFDM0MsT0FBTyxDQUFDLENBQUM7UUFDWCxDQUFDO1FBQ0QsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakIsQ0FBQztJQVplLGFBQVEsV0FZdkIsQ0FBQTtJQUVELFNBQWdCLFlBQVksQ0FBQyxJQUFVLEVBQUUsQ0FBTTtRQUM3QyxPQUFPLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxD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TSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0QsS0FBSyxNQUFNLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxNQUFNLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FB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TyxDQUFDLENBQUMsQ0FBQztJQUNoQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQUUsT0FBTyxDQUFDLENBQUM7SUFDakMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDaEIsQ0FBQztBQUtELE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQztBQUNqQixNQUFNLEtBQUssR0FBRyxDQUFDLENBQUM7QUFDaEIsTUFBTSxDQUFDLE1BQU0sTUFBTSxHQUFHLElBQUksR0FBRyxDQUF1QjtJQU1sRCxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN4QixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN0QixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFdEIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN0QixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckIsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3RCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyQixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFdEIsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3RCLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUN4QixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7Q0FHdkIsQ0FBQyxDQUFDO0FBRUgsTUFBTSxTQUFTLEdBQUcsSUFBSSxHQUFHLENBQXVCO0lBRTlDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3JCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3JCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3JCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3JCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3JCLENBQUMs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QUFDLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztJQUN0RCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFFRCxTQUFTLElBQUksQ0FBQyxHQUFXO0lBQ3ZCLE9BQU8sRUFBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLEdBQUcsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDO0FBQy9DLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1NvdXJjZUluZm8sIFRva2VufSBmcm9tICcuL3Rva2VuLmpzJztcblxuZXhwb3J0IGludGVyZmFjZSBFeHByIHtcbiAgLy8gb3BlcmF0b3IgKGUuZy4gJysnIG9yICcubWF4Jykgb3IgJ3N5bScsICdudW0nLCBvciAnaW0nXG4gIC8vICAtIHN5bTogYW4gb2Zmc2V0IGludG8gdGhlIHN5bWJvbHMgYXJyYXkgKG9yIHRoZSBuYW1lIGluICdzeW0nKVxuICAvLyAgLSBudW06IGEgbnVtYmVyIGxpdGVyYWwsIG9yIGFuIG9mZnNldCBpbnRvIHRoZSBzeW1ib2xzIGFycmF5LlxuICAvLyAgLSBpbTogYW4gaW1wb3J0IGZyb20gYW5vdGhlciBvYmplY3QgZmlsZSAodXNlcyAnc3ltJykuXG4gIC8vIFRPRE8gLSB3aGF0IGFib3V0IGRpZmZlcmVudCBhZGRyZXNzIHR5cGVzPyBiYW5rIGhpbnQvZXRjP1xuICAvLyAgICAgIC0gZG9lcyBiYW5rIGhpbnQgbmVlZCB0byBnZXQgc3RvcmVkIGluIHRoZSBvYmplY3QgZmlsZT9cbiAgLy8gICAgICAgIC0gcHJvYmFibHkgbm90Li4uP1xuICBvcDogc3RyaW5nO1xuICBhcmdzPzogRXhwcltdO1xuICBudW0/OiBudW1iZXI7XG4gIG1ldGE/OiBFeHByLk1ldGE7XG4gIHN5bT86IHN0cmluZztcbiAgc291cmNlPzogU291cmNlSW5mbztcbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBFeHByIHtcblxuICAvKiogRXh0cmEgaW5mb3JtYXRpb24gZm9yICdudW0nIHZhbHVlcy4gKi9cbiAgZXhwb3J0IGludGVyZmFjZSBNZXRhIHtcbiAgICAvKiogV2hldGhlciB0aGlzIGlzIHJlbGF0aXZlIHRvIHRoZSBzdGFydCBvZiB0aGUgY2h1bmsuICovXG4gICAgcmVsPzogYm9vbGVhbjtcbiAgICAvKiogUmVsYXRpdmUgY2h1bmsgdGhlIHZhbHVlIGlzIGRlZmluZWQgaW4uICovXG4gICAgY2h1bms/OiBudW1iZXI7XG4gICAgLyoqIE9yZyB2YWx1ZSBvZiBjaHVuaywgaWYga25vd24uICovXG4gICAgb3JnPzogbnVtYmVyO1xuICAgIC8qKiBCYW5rIHZhbHVlIG9mIGNodW5rLCBpZiBrbm93bi4gKi9cbiAgICBiYW5rPzogbnVtYmVyO1xuICAgIC8qKiBPZmZzZXQgdmFsdWUgb2YgY2h1bmssIGlmIGtub3duLiAqL1xuICAgIG9mZnNldD86IG51bWJlcjtcbiAgICAvKiogU2l6ZSBoaW50IGZvciBudW1iZXIuICovXG4gICAgc2l6ZT86IG51bWJlcjtcbiAgfVxuXG4gIHR5cGUgUmVjID0gKGV4cHI6IEV4cHIpID0+IEV4cHI7IC8vIHJlY3Vyc2VzIGludG8gY2hpbGRyZW5cbiAgdHlwZSBUcmF2ZXJzZXIgPSAoZXhwcjogRXhwciwgcmVjOiBSZWMsIHBhcmVudD86IEV4cHIpID0+IEV4cHI7XG5cbiAgLyoqIFBlcmZvcm1zIGEgcG9zdC1vcmRlciB0cmF2ZXJzYWwuICovXG4gIGV4cG9ydCBmdW5jdGlvbiB0cmF2ZXJzZShleHByOiBFeHByLCBmOiBUcmF2ZXJzZXIpIHtcbiAgICBmdW5jdGlvbiByZWMoZTogRXhwcikge1xuICAgICAgaWYgKCFlLmFyZ3MpIHJldHVybiBlO1xuICAgICAgcmV0dXJuIHsuLi5lLCBhcmdzOiBlLmFyZ3MubWFwKGMgPT4gdChjLCBlKSl9O1xuICAgIH07XG4gICAgZnVuY3Rpb24gdChlOiBFeHByLCBwPzogRXhwcikge1xuICAgICAgY29uc3Qgc291cmNlID0gZS5zb3VyY2U7XG4gICAgICBlID0gZihlLCByZWMsIHApO1xuICAgICAgaWYgKHNvdXJjZSAmJiAhZS5zb3VyY2UpIGUuc291cmNlID0gc291cmNlO1xuICAgICAgcmV0dXJuIGU7XG4gICAgfVxuICAgIHJldHVybiB0KGV4cHIpO1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIHRyYXZlcnNlUG9zdChleHByOiBFeHByLCBmOiBSZWMpOiBFeHByIHtcbiAgICByZXR1cm4gdHJhdmVyc2UoZXhwciwgKGV4cHIsIHJlYykgPT4gZihyZWMoZXhwcikpKTtcbiAgfVxuXG4gIGV4cG9ydCBmdW5jdGlvbiBldmFsdWF0ZShleHByOiBFeHByKTogRXhwciB7XG4gICAgc3dpdGNoIChleHByLm9wKSB7IC8vIHZhci1hcmcgZnVuY3Rpb25zXG4gICAgICBjYXNlICcubW92ZSc6XG4gICAgICBjYXNlICdpbSc6XG4gICAgICBjYXNlICdzeW0nOlxuICAgICAgICByZXR1cm4gZXhwcjtcbiAgICAgIGNhc2UgJ251bSc6XG4gICAgICAgIGlmIChleHByLm1ldGE/LnJlbCAmJiBleHByLm1ldGEub3JnICE9IG51bGwpIHtcbiAgICAgICAgICBjb25zdCB7cmVsLCAuLi5tZXRhfSA9IGV4cHIubWV0YTtcbiAgICAgICAgICAvLyBUT0RPIC0gcHVsbCBzaXplIGZyb20gbWV0YT9cbiAgICAgICAgICByZXR1cm4ge29wOiAnbnVtJywgbnVtOiBleHByLm51bSEgKyBtZXRhLm9yZyEsIG1ldGF9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBleHByO1xuICAgICAgY2FzZSAnLm1heCc6IHJldHVybiBzYW1lQ2h1bmsoZXhwciwgTWF0aC5tYXgpO1xuICAgICAgY2FzZSAnLm1pbic6IHJldHVybiBzYW1lQ2h1bmsoZXhwciwgTWF0aC5taW4pO1xuICAgICAgZGVmYXVsdDogLy8gZmFsbCB0aHJvdWdoIHRvIGxhdGVyIGNoZWNrc1xuICAgIH1cblxuICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdW5hcmllc1xuICAgIGlmIChleHByLmFyZ3M/Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgc3dpdGNoIChleHByLm9wKSB7XG4gICAgICAgIGNhc2UgJysnOiByZXR1cm4gZXhwci5hcmdzIVswXTtcbiAgICAgICAgY2FzZSAnLSc6IHJldHVybiB1bmFyeShleHByLCB4ID0+IC14KTtcbiAgICAgICAgY2FzZSAnfic6IHJldHVybiB1bmFyeShleHByLCB4ID0+IH54KTtcbiAgICAgICAgY2FzZSAnISc6IHJldHVybiB1bmFyeShleHByLCB4ID0+ICsheCk7XG4gICAgICAgIGNhc2UgJzwnOiByZXR1cm4gdW5hcnkoZXhwciwgeCA9PiB4ICYgMHhmZik7XG4gICAgICAgIGNhc2UgJz4nOiByZXR1cm4gdW5hcnkoZXhwciwgeCA9PiAoeCA+PiA4KSAmIDB4ZmYpO1xuICAgICAgICBjYXNlICdeJzogcmV0dXJuIG51bShleHByLmFyZ3MhWzBdLm1ldGE/LmJhbmspID8/IGV4cHI7XG4gICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihgVW5rbm93biB1bmFyeSBvcGVyYXRvcjogJHtleHByLm9wfWApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHN3aXRjaCAoZXhwci5vcCkge1xuICAgICAgY2FzZSAnKyc6IHJldHVybiBwbHVzKGV4cHIpO1xuICAgICAgY2FzZSAnLSc6IHJldHVybiBtaW51cyhleHByKTtcbiAgICAgIGNhc2UgJyonOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhICogYik7XG4gICAgICBjYXNlICcvJzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gTWF0aC5mbG9vcihhIC8gYikpO1xuICAgICAgY2FzZSAnLm1vZCc6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgJSBiKTtcbiAgICAgIGNhc2UgJyYnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhICYgYik7XG4gICAgICBjYXNlICd8JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSB8IGIpO1xuICAgICAgY2FzZSAnXic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgXiBiKTtcbiAgICAgIGNhc2UgJzw8JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSA8PCBiKTtcbiAgICAgIGNhc2UgJz4+JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSA+Pj4gYik7XG4gICAgICBjYXNlICc8JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gKyhhIDwgYikpO1xuICAgICAgY2FzZSAnPD0nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgPD0gYikpO1xuICAgICAgY2FzZSAnPic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICsoYSA+IGIpKTtcbiAgICAgIGNhc2UgJz49JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gKyhhID49IGIpKTtcbiAgICAgIGNhc2UgJz0nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgPT0gYikpO1xuICAgICAgY2FzZSAnPD4nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgIT0gYikpO1xuICAgICAgY2FzZSAnJiYnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhICYmIGIpO1xuICAgICAgY2FzZSAnfHwnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhIHx8IGIpO1xuICAgICAgY2FzZSAnLnhvcic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICFhICYmIGIgfHwgIWIgJiYgYSB8fCAwKTtcbiAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihgVW5rbm93biBvcGVyYXRvcjogJHtleHByLm9wfWApO1xuICAgIH1cbiAgfVxuXG4gIGV4cG9ydCBmdW5jdGlvbiBpZGVudGlmaWVyKGV4cHI6IEV4cHIpOiBzdHJpbmcge1xuICAgIGlmIChleHByLm9wID09PSAnc3ltJyAmJiBleHByLnN5bSkgcmV0dXJuIGV4cHIuc3ltO1xuICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgaWRlbnRpZmllciBidXQgZ290IG9wOiAke2V4cHIub3B9YCk7XG4gIH1cblxuICAvLyAvKiogUmV0dXJucyB0aGUgaWRlbnRpZmllci4gKi9cbiAgLy8gZXhwb3J0IGZ1bmN0aW9uIGlkZW50aWZpZXIoZXhwcjogRXhwcik6IHN0cmluZyB7XG4gIC8vICAgY29uc3QgdGVybXM6IHN0cmluZ1tdID0gW107XG4gIC8vICAgYXBwZW5kKGV4cHIpO1xuICAvLyAgIHJldHVybiB0ZXJtcy5qb2luKCc6OicpO1xuICAvLyAgIGZ1bmN0aW9uIGFwcGVuZChlOiBFeHByKSB7XG4gIC8vICAgICBpZiAoZS5vcCA9PT0gJ2lkZW50Jykge1xuICAvLyAgICAgICB0ZXJtcy5wdXNoKGUuc3ltISk7XG4gIC8vICAgICB9IGVsc2UgaWYgKGUub3AgPT09ICc6OicpIHtcbiAgLy8gICAgICAgaWYgKGUuYXJncyEubGVuZ3RoID09PSAxKSB0ZXJtcy5wdXNoKCcnKTtcbiAgLy8gICAgICAgZS5hcmdzIS5mb3JFYWNoKGFwcGVuZCk7XG4gIC8vICAgICB9IGVsc2Uge1xuICAvLyAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGlkZW50aWZpZXIgYnV0IGdvdCBvcDogJHtlLm9wfWApO1xuICAvLyAgICAgfVxuICAvLyAgIH1cbiAgLy8gfVxuXG4gIC8qKiBQYXJzZSBhIHNpbmdsZSBleHByZXNzaW9uLCBtdXN0IG9jY3VweSB0aGUgcmVzdCBvZiB0aGUgbGluZS4gKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIHBhcnNlT25seSh0b2tlbnM6IFRva2VuW10sIGluZGV4ID0gMCk6IEV4cHIge1xuICAgIGNvbnN0IFtleHByLCBpXSA9IHBhcnNlKHRva2VucywgaW5kZXgpO1xuICAgIGlmIChpIDwgdG9rZW5zLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBHYXJiYWdlIGFmdGVyIGV4cHJlc3Npb246ICR7VG9rZW4ubmFtZUF0KHRva2Vuc1tpXSl9YCk7XG4gICAgfSBlbHNlIGlmICghZXhwcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBleHByZXNzaW9uP2ApO1xuICAgIH1cbiAgICByZXR1cm4gZXhwcjtcbiAgfVxuXG4gIC8vIFJldHVybnMgW3VuZGVmaW5lZCwgLTFdIGlmIGEgYmFkIHBhcnNlLlxuICAvLyBHaXZlIHVwIG9uIG5vcm1hbCBwYXJzaW5nLCBqdXN0IHVzZSBhIHNodW50aW5nIHlhcmQgYWdhaW4uLi5cbiAgLy8gIC0gYnV0IGhhbmRsZSBwYXJlbnMgcmVjdXJzaXZlbHkuXG4gIGV4cG9ydCBmdW5jdGlvbiBwYXJzZSh0b2tlbnM6IFRva2VuW10sIGluZGV4ID0gMCk6IFtFeHByfHVuZGVmaW5lZCwgbnVtYmVyXSB7XG4vL2NvbnNvbGUubG9nKCdQQVJTRTogdG9rZW5zPScsIHRva2VucywgJ2luZGV4PScsIGluZGV4KTtcbi8vdHJ5IHsgdGhyb3cgbmV3IEVycm9yKCk7IH0gY2F0Y2ggKGUpIHsgY29uc29sZS5sb2coZS5zdGFjayk7IH1cbiAgICBjb25zdCBvcHM6IFtzdHJpbmcsIE9wZXJhdG9yTWV0YV1bXSA9IFtdO1xuICAgIGNvbnN0IGV4cHJzOiBFeHByW10gPSBbXTtcblxuICAgIGZ1bmN0aW9uIHBvcE9wKCkge1xuICAgICAgY29uc3QgW29wLCBbLCwgYXJpdHldXSA9IG9wcy5wb3AoKSE7XG4vL2NvbnNvbGUubG9nKCdwb3AnLCBvcCwgYXJpdHkpO1xuICAgICAgY29uc3QgYXJncyA9IGV4cHJzLnNwbGljZShleHBycy5sZW5ndGggLSBhcml0eSwgYXJpdHkpO1xuICAgICAgaWYgKGFyZ3MubGVuZ3RoICE9PSBhcml0eSkgdGhyb3cgbmV3IEVycm9yKCdzaHVudGluZyBwYXJzZSBmYWlsZWQ/Jyk7XG4gICAgICBleHBycy5wdXNoKGZpeFNpemUoe29wLCBhcmdzfSkpO1xuICAgIH1cblxuICAgIGxldCB2YWwgPSB0cnVlO1xuICAgIGxldCBpID0gaW5kZXg7XG4gICAgZm9yICg7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGZyb250ID0gdG9rZW5zW2ldO1xuLy9jb25zb2xlLmxvZygnZXhwcnM6JyxleHBycywnb3BzOicsb3BzLCd0b2s6Jyxmcm9udCk7XG4gICAgICBpZiAodmFsKSB7XG4gICAgICAgIC8vIGxvb2tpbmcgZm9yIGEgdmFsdWU6IGxpdGVyYWwsIGJhbGFuY2VkIHBhcmVucywgb3IgcHJlZml4IG9wLlxuICAgICAgICBpZiAoZnJvbnQudG9rZW4gPT09ICdjcycgfHwgZnJvbnQudG9rZW4gPT09ICdvcCcpIHtcbiAgICAgICAgICBjb25zdCBtYXBwZWQgPSBOQU1FX01BUC5nZXQoZnJvbnQuc3RyKTtcbiAgICAgICAgICBjb25zdCBwcmVmaXggPSBQUkVGSVhPUFMuZ2V0KG1hcHBlZCA/PyBmcm9udC5zdHIpO1xuICAgICAgICAgIGlmIChwcmVmaXgpIHtcbiAgICAgICAgICAgIG9wcy5wdXNoKFtmcm9udC5zdHIsIHByZWZpeF0pO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZnJvbnQudG9rZW4gPT09ICdjcycpIHtcbiAgICAgICAgICAgIGNvbnN0IG9wID0gZnJvbnQuc3RyO1xuICAgICAgICAgICAgaWYgKCFGVU5DVElPTlMuaGFzKG9wKSkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHN1Y2ggZnVuY3Rpb246ICR7VG9rZW4ubmFtZUF0KGZyb250KX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG5leHQgPSB0b2tlbnNbaSArIDFdO1xuICAgICAgICAgICAgaWYgKG5leHQ/LnRva2VuICE9PSAnbHAnKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQmFkIGZ1bmNhbGw6ICR7VG9rZW4ubmFtZUF0KG5leHQgPz8gZnJvbnQpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgY2xvc2UgPSBUb2tlbi5maW5kQmFsYW5jZWQodG9rZW5zLCBpICsgMSk7XG4gICAgICAgICAgICBpZiAoY2xvc2UgPCAwKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTmV2ZXIgY2xvc2VkOiAke1Rva2VuLm5hbWVBdChuZXh0KX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGFyZ3M6IEV4cHJbXSA9IFtdO1xuICAgICAgICAgICAgZm9yIChjb25zdCBhcmcgb2YgVG9rZW4ucGFyc2VBcmdMaXN0KHRva2VucywgaSArIDIsIGNsb3NlKSkge1xuICAgICAgICAgICAgICBhcmdzLnB1c2gocGFyc2VPbmx5KGFyZykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaSA9IGNsb3NlO1xuICAgICAgICAgICAgZXhwcnMucHVzaChmaXhTaXplKHtvcCwgYXJnc30pKTtcbiAgICAgICAgICAgIHZhbCA9IGZhbHNlO1xuICAgICAgICAgIH0gZWxzZSBpZiAoVG9rZW4uZXEoZnJvbnQsIFRva2VuLlNUQVIpKSB7XG4gICAgICAgICAgICBleHBycy5wdXNoKHtvcDogJ3N5bScsIHN5bTogJyonfSk7XG4gICAgICAgICAgICB2YWwgPSBmYWxzZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHByZWZpeCBvcGVyYXRvcjogJHtUb2tlbi5uYW1lQXQoZnJvbnQpfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChmcm9udC50b2tlbiA9PT0gJ2xwJykge1xuICAgICAgICAgIC8vIGZpbmQgYmFsYW5jZWQgcGFyZW5zXG4gICAgICAgICAgY29uc3QgY2xvc2UgPSBUb2tlbi5maW5kQmFsYW5jZWQodG9rZW5zLCBpKTtcbiAgICAgICAgICBpZiAoY2xvc2UgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGNsb3NlIHBhcmVuOiAke1Rva2VuLm5hbWVBdChmcm9udCl9YCk7XG4gICAgICAgICAgfSAvLyByZXR1cm4gW3VuZGVmaW5lZCwgLTFdO1xuICAgICAgICAgIGNvbnN0IGUgPSBwYXJzZU9ubHkodG9rZW5zLnNsaWNlKGkgKyAxLCBjbG9zZSkpO1xuICAgICAgICAgIGV4cHJzLnB1c2goZSk7XG4gICAgICAgICAgaSA9IGNsb3NlO1xuICAgICAgICAgIHZhbCA9IGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKGZyb250LnRva2VuID09PSAnaWRlbnQnKSB7XG4gICAgICAgICAgLy8gYWRkIHN5bWJvbFxuICAgICAgICAgIGV4cHJzLnB1c2goe29wOiAnc3ltJywgc3ltOiBmcm9udC5zdHJ9KTtcbiAgICAgICAgICAvLyBUT0RPIC0gdXNlIHNjb3BlIGluZm9ybWF0aW9uIHRvIGRldGVybWluZSBzaXplP1xuICAgICAgICAgIHZhbCA9IGZhbHNlO1xuICAgICAgICB9IGVsc2UgaWYgKGZyb250LnRva2VuID09PSAnbnVtJykge1xuICAgICAgICAgIC8vIGFkZCBudW1iZXJcbiAgICAgICAgICBjb25zdCBudW0gPSBmcm9udC5udW07XG4gICAgICAgICAgZXhwcnMucHVzaCh7b3A6ICdudW0nLCBudW0sIG1ldGE6IHNpemUobnVtKX0pO1xuICAgICAgICAgIHZhbCA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGJhZCB0b2tlbj8/XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBCYWQgZXhwcmVzc2lvbiB0b2tlbjogJHtUb2tlbi5uYW1lQXQoZnJvbnQpfWApO1xuICAgICAgICAgIC8vIHJldHVybiBbdW5kZWZpbmVkLCAtMV07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGxvb2tpbmcgZm9yIGFuIGluZml4IG9wZXJhdG9yIG9yIEVPTC5cbiAgICAgICAgaWYgKFRva2VuLmVxKGZyb250LCBUb2tlbi5DT01NQSkgLyogfHwgVG9rZW4uZXEoZnJvbnQsIFRva2VuLlJQKSAqLykge1xuICAgICAgICAgIC8vIFRPRE8gLSBpcyBycGFyZW4gb2theT8gdXN1YWxseSBzaG91bGQgaGF2ZSBleHRyYWN0ZWQgdGhlIGJhbGFuY2VkXG4gICAgICAgICAgLy8gcGFyZW4gb3V0IGZpcnN0P1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmcm9udC50b2tlbiA9PT0gJ2NzJyB8fCBmcm9udC50b2tlbiA9PT0gJ29wJykge1xuICAgICAgICAgIGNvbnN0IG1hcHBlZCA9IE5BTUVfTUFQLmdldChmcm9udC5zdHIpO1xuICAgICAgICAgIGNvbnN0IG9wID0gQklOT1BTLmdldChtYXBwZWQgPz8gZnJvbnQuc3RyKTtcbiAgICAgICAgICBpZiAoIW9wKSBicmVhazsgLy8gd2UncmUgYXQgdGhlIGVuZC4uLj8gIG9yIGlmIG5vIG9wLlxuICAgICAgICAgIC8vIHNlZSBpZiBhbnl0aGluZyB0byB0aGUgbGVmdCBpcyBmYXN0ZXIuXG4gICAgICAgICAgd2hpbGUgKG9wcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHRvcCA9IG9wc1tvcHMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICBjb25zdCBjbXAgPSBjb21wYXJlT3AodG9wWzFdLCBvcCk7XG4gICAgICAgICAgICBpZiAoY21wIDwgMCkgYnJlYWs7XG4gICAgICAgICAgICBpZiAoY21wID09PSAwKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICAgIGBNaXhpbmcgJHt0b3BbMF19IGFuZCAke2Zyb250LnN0cn0gbmVlZHMgZXhwbGljaXQgcGFyZW5zLiR7XG4gICAgICAgICAgICAgICAgICAgVG9rZW4uYXQoZnJvbnQpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcG9wT3AoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3BzLnB1c2goW2Zyb250LnN0ciwgb3BdKTtcbiAgICAgICAgICB2YWwgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vdGhyb3cgbmV3IEVycm9yKGBHYXJiYWdlIGFmdGVyIGV4cHJlc3Npb246ICR7VG9rZW4ubmFtZUF0KGZyb250KX1gKTtcbi8vY29uc29sZS5sb2coJ2JhZCB2YWx1ZScsIGksIGZyb250KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbi8vY29uc29sZS5sb2coJ2V4cHJzOicsZXhwcnMsJ29wczonLG9wcyk7XG4gICAgLy8gTm93IHBvcCBhbGwgdGhlIG9wc1xuICAgIHdoaWxlIChvcHMubGVuZ3RoKSBwb3BPcCgpO1xuLy9jb25zb2xlLmxvZygncG9zdC1wb3A6JywgZXhwcnMpO1xuICAgIGlmIChleHBycy5sZW5ndGggIT09IDEpIHRocm93IG5ldyBFcnJvcihgc2h1bnRpbmcgcGFyc2UgZmFpbGVkP2ApO1xuICAgIGlmICh0b2tlbnNbaW5kZXhdLnNvdXJjZSkgZXhwcnNbMF0uc291cmNlID0gdG9rZW5zW2luZGV4XS5zb3VyY2U7XG4gICAgcmV0dXJuIFtleHByc1swXSwgaV07XG4gIH1cblxuXG4gIC8vIHdvcmtzIG9uIGFic29sdXRlIG51bWJlcnMsIG9yIHJlbGF0aXZlIG51bWJlcnMgaWYgYWxsIGluIHNhbWUgY2h1bmsuXG4gIC8vIG1heSBub3QgbWl4IHJlbGF0aXZlICsgYWJzb2x1dGUuXG4gIGZ1bmN0aW9uIHNhbWVDaHVuayhleHByOiBFeHByLCBmOiAoLi4ubnVtczogbnVtYmVyW10pID0+IG51bWJlcik6IEV4cHIge1xuICAgIHRocm93IG5ldyBFcnJvcigpO1xuICB9XG5cbiAgZnVuY3Rpb24gbnVtKG51bTogbnVtYmVyfHVuZGVmaW5lZCk6IEV4cHJ8dW5kZWZpbmVkIHtcbiAgICBpZiAobnVtID09IG51bGwpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIHtvcDogJ251bScsIG51bSwgbWV0YTogc2l6ZShudW0pfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVuYXJ5KGV4cHI6IEV4cHIsIGY6ICh4OiBudW1iZXIpID0+IG51bWJlcik6IEV4cHIge1xuICAgIC8vIHJlcXVpcmUgYWJzb2x1dGVcbiAgICBjb25zdCBhcmcgPSBleHByLmFyZ3MhWzBdO1xuICAgIGlmICghaXNBYnMoYXJnKSkgcmV0dXJuIGV4cHI7XG4gICAgY29uc3QgbnVtID0gZihhcmcubnVtISk7XG4gICAgcmV0dXJuIHtvcDogJ251bScsIG51bSwgbWV0YTogc2l6ZShudW0pfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJpbmFyeShleHByOiBFeHByLCBmOiAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IG51bWJlcik6IEV4cHIge1xuICAgIC8vIHJlcXVpcmUgYm90aCB0byBiZSBhYnNvbHV0ZVxuICAgIGNvbnN0IFthLCBiXSA9IGV4cHIuYXJncyE7XG4gICAgaWYgKCFpc0FicyhhKSB8fCAhaXNBYnMoYikpIHJldHVybiBleHByO1xuICAgIGNvbnN0IG51bSA9IGYoYS5udW0hLCBiLm51bSEpO1xuICAgIHJldHVybiB7b3A6ICdudW0nLCBudW0sIG1ldGE6IHNpemUobnVtKX07XG4gIH1cblxuICBmdW5jdGlvbiBwbHVzKGV4cHI6IEV4cHIpOiBFeHByIHtcbiAgICAvLyBhbGxvdyBzb21lIHJlbGF0aXZlLCBidXQgb25seSBpZiBhZGRpbmcgYSBub24tYWRkcmVzcz9cbiAgICBjb25zdCBbYSwgYl0gPSBleHByLmFyZ3MhO1xuICAgIGlmIChhLm9wICE9PSAnbnVtJyB8fCBiLm9wICE9PSAnbnVtJykgcmV0dXJuIGV4cHI7XG4gICAgY29uc3Qgb3V0OiBFeHByID0ge29wOiAnbnVtJywgbnVtOiBhLm51bSEgKyBiLm51bSF9O1xuICAgIGlmIChhLm1ldGEgfHwgYi5tZXRhKSB7XG4gICAgICBpZiAoYS5tZXRhPy5yZWwgJiYgYi5tZXRhPy5yZWwpIHJldHVybiBleHByOyAvLyBiYXNpY2FsbHkgbm9uc2Vuc2VcbiAgICAgIGlmIChhLm1ldGE/LnJlbCkge1xuICAgICAgICBvdXQubWV0YSA9IGEubWV0YTtcbiAgICAgIH0gZWxzZSBpZiAoYi5tZXRhPy5yZWwpIHtcbiAgICAgICAgb3V0Lm1ldGEgPSBiLm1ldGE7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghb3V0Lm1ldGE/LnJlbCAmJiBvdXQubWV0YT8uc2l6ZSA9PSBudWxsKSB7XG4gICAgICAob3V0Lm1ldGEgfHwgKG91dC5tZXRhID0ge30pKS5zaXplID0gc2l6ZShvdXQubnVtISkuc2l6ZTtcbiAgICB9XG4gICAgcmV0dXJuIG91dDtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1pbnVzKGV4cHI6IEV4cHIpOiBFeHByIHtcbiAgICAvLyBhbGxvdyByZWwgLSByZWwgZm9yIGRlbHRhXG4gICAgY29uc3QgW2EsIGJdID0gZXhwci5hcmdzITtcbiAgICBpZiAoYS5vcCAhPT0gJ251bScgfHwgYi5vcCAhPT0gJ251bScpIHJldHVybiBleHByO1xuICAgIGNvbnN0IG91dDogRXhwciA9IHtvcDogJ251bScsIG51bTogYS5udW0hIC0gYi5udW0hfTtcbiAgICBpZiAoYi5tZXRhPy5yZWwpIHtcbiAgICAgIHJldHVybiBhLm1ldGE/LnJlbCAmJiBhLm1ldGEuY2h1bmsgPT09IGIubWV0YS5jaHVuayA/IG91dCA6IGV4cHI7XG4gICAgfVxuICAgIGlmIChhLm1ldGE/LnJlbCkgb3V0Lm1ldGEgPSBhLm1ldGE7XG4gICAgaWYgKCFvdXQubWV0YT8ucmVsICYmIG91dC5tZXRhPy5zaXplID09IG51bGwpIHtcbiAgICAgIChvdXQubWV0YSB8fCAob3V0Lm1ldGEgPSB7fSkpLnNpemUgPSBzaXplKG91dC5udW0hKS5zaXplO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xuICB9XG5cbiAgZnVuY3Rpb24gaXNBYnMoZXhwcjogRXhwcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBleHByLm9wID09PSAnbnVtJyAmJiAhZXhwci5tZXRhPy5yZWw7XG4gIH1cbn1cblxuXG5cbi8vIFJldHVybnMgPjAgaWYgdG9wIGlzIGZhc3RlciwgPDAgaWYgdG9wIGlzIHNsb3dlciwgYW5kIDAgaWYgY2FuJ3QgbWl4XG5mdW5jdGlvbiBjb21wYXJlT3AodG9wOiBPcGVyYXRvck1ldGEsIG5leHQ6IE9wZXJhdG9yTWV0YSk6IG51bWJlciB7XG4gIGlmICh0b3BbMF0gPiBuZXh0WzBdKSByZXR1cm4gMTtcbiAgaWYgKHRvcFswXSA8IG5leHRbMF0pIHJldHVybiAtMTtcbiAgaWYgKHRvcFsxXSAhPT0gbmV4dFsxXSkgcmV0dXJuIDA7XG4gIHJldHVybiB0b3BbMV07XG59XG5cblxuLy8gcHJlY2VkZW5jZSwgYXNzb2NpYXRpdml0eSwgYXJpdHlcbnR5cGUgT3BlcmF0b3JNZXRhID0gcmVhZG9ubHkgW251bWJlciwgbnVtYmVyLCBudW1iZXJdO1xuY29uc3QgQklOQVJZID0gMjtcbmNvbnN0IFVOQVJZID0gMTtcbmV4cG9ydCBjb25zdCBCSU5PUFMgPSBuZXcgTWFwPHN0cmluZywgT3BlcmF0b3JNZXRhPihbXG4gIC8vIFNjb3Bpbmcgb3BlcmF0b3JcbiAgLy8gWyc6OicsIFs4LCAxLCBCSU5BUlldXSxcbiAgLy8gTWVtb3J5IGhpbnRzXG4gIC8vWyc6JywgWzYsIDBdXSxcbiAgLy8gTXVsdGlwbGljYXRpdmUgb3BlcmF0b3JzOiBub3RlIHRoYXQgYml0d2lzZSBhbmQgYXJpdGhtZXRpYyBjYW5ub3QgYXNzb2NpYXRlXG4gIFsnKicsIFs1LCA0LCBCSU5BUlldXSxcbiAgWycvJywgWzUsIDQsIEJJTkFSWV1dLFxuICBbJy5tb2QnLCBbNSwgMywgQklOQVJZXV0sXG4gIFsnJicsIFs1LCAyLCBCSU5BUlldXSxcbiAgWydeJywgWzUsIDEsIEJJTkFSWV1dLFxuICBbJzw8JywgWzUsIDAsIEJJTkFSWV1dLFxuICBbJz4+JywgWzUsIDAsIEJJTkFSWV1dLFxuICAvLyBBcml0aG1ldGljIG9wZXJhdG9yczogbm90ZSB0aGF0IGJpdHdpc2UgYW5kIGFyaXRobWV0aWMgY2Fubm90IGFzc29jaWF0ZVxuICBbJysnLCBbNCwgMiwgQklOQVJZXV0sXG4gIFsnLScsIFs0LCAyLCBCSU5BUlldXSxcbiAgWyd8JywgWzQsIDEsIEJJTkFSWV1dLFxuICAvLyBDb21wYXJpc29uIG9wZXJhdG9yc1xuICBbJzwnLCBbMywgMCwgQklOQVJZXV0sXG4gIFsnPD0nLCBbMywgMCwgQklOQVJZXV0sXG4gIFsnPicsIFszLCAwLCBCSU5BUlldXSxcbiAgWyc+PScsIFszLCAwLCBCSU5BUlldXSxcbiAgWyc9JywgWzMsIDAsIEJJTkFSWV1dLFxuICBbJzw+JywgWzMsIDAsIEJJTkFSWV1dLFxuICAvLyBMb2dpY2FsIG9wZXJhdG9yczogZGlmZmVyZW50IGtpbmRzIGNhbm5vdCBhc3NvY2lhdGVcbiAgWycmJicsIFsyLCAzLCBCSU5BUlldXSxcbiAgWycueG9yJywgWzIsIDIsIEJJTkFSWV1dLFxuICBbJ3x8JywgWzIsIDEsIEJJTkFSWV1dLFxuICAvLyBDb21tYVxuICAvL1snLCcsIFsxLCAxXV0sXG5dKTtcblxuY29uc3QgUFJFRklYT1BTID0gbmV3IE1hcDxzdHJpbmcsIE9wZXJhdG9yTWV0YT4oW1xuICAvLyBbJzo6JywgWzksIC0xLCBVTkFSWV1dLCAvLyBnbG9iYWwgc2NvcGVcbiAgWycrJywgWzksIC0xLCBVTkFSWV1dLFxuICBbJy0nLCBbOSwgLTEsIFVOQVJZXV0sXG4gIFsnficsIFs5LCAtMSwgVU5BUlldXSxcbiAgWyc8JywgWzksIC0xLCBVTkFSWV1dLFxuICBbJz4nLCBbOSwgLTEsIFVOQVJZXV0sXG4gIFsnXicsIFs5LCAtMSwgVU5BUlldXSxcbiAgWychJywgWzIsIC0xLCBVTkFSWV1dLFxuXSk7XG5cbi8vIFRPRE8gLSBza2lwMSBhbmQgc2tpcDIgbWFjcm9zXG4vLyAubWFjcm8gc2tpcDFcbi8vICAgLmJ5dGUgJDJjXG4vLyAuZW5kbWFjcm9cbi8vIC5tYWNybyBza2lwMlxuLy8gICAuYnl0ZSAkNGNcbi8vICAgLmFzc2VydCAuYnl0ZWF0KCogKyAyKSA8ICQyMCAub3IgXFxcbi8vICAgICAgICAgICAuYnl0ZWF0KCogKyAyKSA+PSAkNjAgLm9yIFxcXG4vLyAgICAgICAgICAgLmJ5dGVhdCgqICsgMSkgJiAkMDcgLmluIFsyLDMsNF1cbi8vIC5lbmRtYWNyb1xuLy8gTk9URTogZGFuZ2Vyb3VzIHJlYWRzIGFyZSAyMDAyLCAyMDA0LCAyMDA3IChwbHVzIG1pcnJvcnMpLCA0MDE1XG4vLyBUaGVuIHRoZSBhc3NlbWJsZXIgbmVlZHMgdG8gdW5kZXJzdGFuZCB0aGUgZmxvdyBvZiB0aGVzZSB0d28gb3BzLi4uXG4vLyBvciBqdXN0IGRpc2Fzc2VtYmxlIGl0IG9uIHRoZSBmbHk/XG5jb25zdCBGVU5DVElPTlMgPSBuZXcgU2V0PHN0cmluZz4oW1xuICAnLmJ5dGVhdCcsXG4gICcud29yZGF0JyxcbiAgJy5tYXgnLCAnLm1pbicsXG5dKTtcblxuY29uc3QgTkFNRV9NQVAgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPihbXG4gIFsnLmJpdGFuZCcsICcmJ10sXG4gIFsnLmJpdHhvcicsICdeJ10sXG4gIFsnLmJpdG9yJywgJ3wnXSxcbiAgWycuc2hsJywgJzw8J10sXG4gIFsnLnNocicsICc+PiddLFxuICBbJy5hbmQnLCAnJiYnXSxcbiAgWycub3InLCAnfHwnXSxcbiAgWycuYml0bm90JywgJ34nXSxcbiAgWycubG9ieXRlJywgJzwnXSxcbiAgWycuaGlieXRlJywgJz4nXSxcbiAgWycuYmFua2J5dGUnLCAnXiddLCAvLyA/Pz8gaG93IHRvIGltcGxlbWVudCBvbiBudW1iZXI/XG4gIFsnLm5vdCcsICchJ10sXG5dKTtcblxuY29uc3QgU0laRV9UUkFOU0ZPUk1TID0gbmV3IE1hcDxzdHJpbmcsICguLi5hcmdzOiBudW1iZXJbXSkgPT4gbnVtYmVyPihbXG4gIC8vIHVuYXJ5OiBiYW5rIGJ5dGU7IGJpbmFyeTogYml0eG9yXG4gIFsnXicsICguLi5hcmdzKSA9PiBhcmdzLmxlbmd0aCA9PT0gMSA/IDEgOiBNYXRoLm1heCguLi5hcmdzKV0sXG4gIFsnPCcsICgpID0+IDFdLCAvLyB1bmFyeSAobG9ieXRlKSBhbmQgYmluYXJ5IChjbXApIGJvdGggc2luZ2xlLWJ5dGVcbiAgWyc+JywgKCkgPT4gMV0sIC8vIHVuYXJ5IChoaWJ5dGUpIGFuZCBiaW5hcnkgKGNtcCkgYm90aCBzaW5nbGUtYnl0ZVxuICBbJyEnLCAoKSA9PiAxXSwgLy8gbm90IGFsd2F5cyAwIG9yIDFcbiAgWyc8PScsICgpID0+IDFdLCAvLyBjbXBcbiAgWyc+PScsICgpID0+IDFdLCAvLyBjbXBcbiAgWyc8PicsICgpID0+IDFdLCAvLyBjbXBcbiAgWyc9JywgKCkgPT4gMV0sIC8vIGNtcFxuICAvLyBiaXR3aXNlIGFuZCBsb2dpY2FsIG9wZXJhdG9yIHJldHVybiBtYXhcbiAgWycmJywgTWF0aC5tYXhdLFxuICBbJyYmJywgTWF0aC5tYXhdLFxuICBbJ3wnLCBNYXRoLm1heF0sXG4gIFsnfHwnLCBNYXRoLm1heF0sXG4gIFsnLnhvcicsIE1hdGgubWF4XSxcbiAgWycubWF4JywgTWF0aC5tYXhdLFxuICBbJy5taW4nLCBNYXRoLm1heF0sIC8vIGNvdWxkIHVzZSBtaW4sIGJ1dCBtYXkgbm90IGJlIHNhZmUgdy8gbmVnYXRpdmVzXG5dKTtcbiAgXG5mdW5jdGlvbiBmaXhTaXplKGV4cHI6IEV4cHIpOiBFeHByIHtcbiAgY29uc3QgeGZvcm0gPSBTSVpFX1RSQU5TRk9STVMuZ2V0KGV4cHIub3ApO1xuICBjb25zdCBzaXplID0geGZvcm0/LiguLi5leHByLmFyZ3MhLm1hcChlID0+IE51bWJlcihlLm1ldGE/LnNpemUpKSk7XG4gIGlmIChzaXplKSAoZXhwci5tZXRhIHx8IChleHByLm1ldGEgPSB7fSkpLnNpemUgPSBzaXplO1xuICByZXR1cm4gZXhwcjtcbn1cblxuZnVuY3Rpb24gc2l6ZShudW06IG51bWJlcik6IEV4cHIuTWV0YSB7XG4gIHJldHVybiB7c2l6ZTogMCA8PSBudW0gJiYgbnVtIDwgMjU2ID8gMSA6IDJ9O1xufVxuXG4vLyBmdW5jdGlvbiBmYWlsKG1zZzogc3RyaW5nKTogbmV2ZXIge1xuLy8gICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbi8vIH1cbiJdfQ==