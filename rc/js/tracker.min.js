(function(){
const global=window;'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(d,e){function f(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(c,a-b.length)+b}},"es8","es3");$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill("Object.entries",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push([d,a[d]]);return b}},"es8","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=b[c];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");$jscomp.polyfill("Object.values",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push(a[d]);return b}},"es8","es3");
$jscomp.polyfill("String.prototype.padEnd",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,null,"padStart");return b+$jscomp.stringPadding(c,a-b.length)}},"es8","es3");const LOG$$module$js$6502=!0;
class Assembler$$module$js$6502{constructor(){this.labels={};this.allChunks=[]}assemble(a,b="input"){b=new File$$module$js$6502(this.labels,b);for(const c of a.split("\n"))b.ingest(c);a=b.assemble();this.allChunks.push(...a)}chunks(){return[...this.allChunks]}patch(){return Patch$$module$js$6502.from(this.allChunks)}patchRom(a){buildRomPatch$$module$js$6502(this.patch()).apply(a);this.allChunks=[]}expand(a){const [b=null,...c]=this.labels[a]||[];if(null==b)throw Error(`Missing label: ${a}`);if(c.length)throw Error(`Non-unique label: ${a}`);
return 0>b?~b:b}}
class File$$module$js$6502{constructor(a,b){this.labels=a;this.filename=b;this.lines=[];this.pc=0;this.lineNumber=-1;this.lineContents="";this.conditions=[];this.assembling=!0}addLine(a){this.lines.push(a.orig(this.filename,this.lineNumber,this.lineContents))}addLabel(a,b){if("number"!==typeof b)throw Error("Expected a number");a=this.labels[a]||(this.labels[a]=[]);const c=find$$module$js$6502(a,b);0>c&&a.splice(~c,0,b)}parseNumber(a){a=parseNumber$$module$js$6502(a,!0);return"number"===typeof a?
a:(new Context$$module$js$6502(this.labels)).mapLabel(a)}ingest(a){this.lineNumber++;this.lineContents=a;a=a.replace(/;.*/,"");a=a.replace(/\s+/g," ");a=a.replace(/\s$/g,"");var b;if(b=/^\s*\.if(n?)def\s+(\S+)/i.exec(a))a=b[2]in this.labels,this.conditions.push(b[1]?!a:a),this.assembling=this.conditions.every((a)=>a);else if(b=/^\s*\.else/i.exec(a))this.conditions.push(!this.conditions.pop()),this.assembling=this.conditions.every((a)=>a);else if(b=/^\s*\.endif/i.exec(a))this.conditions.pop(),this.assembling=
this.conditions.every((a)=>a);else if(this.assembling)if(b=/^\s*\.org\s+(\S+)/i.exec(a))this.addLine(new OrgLine$$module$js$6502(this.pc=parseNumber$$module$js$6502(b[1])));else if(b=/^\s*\.skip\s+(.+)/i.exec(a))this.addLine(new OrgLine$$module$js$6502(this.pc+=this.parseNumber(b[1])));else if(b=/^\s*\.assert\s+(<\s*)?(\S+)/i.exec(a))this.addLine(new AssertLine$$module$js$6502(this.pc=parseNumber$$module$js$6502(b[2]),!b[1]));else if(b=/^\s*\.bank\s+(\S+)\s+(\S+)\s*:\s*(\S+)/i.exec(a)){const [,a,
c,f]=b;this.addLine(new BankLine$$module$js$6502(parseNumber$$module$js$6502(a),parseNumber$$module$js$6502(c),parseNumber$$module$js$6502(f)))}else if(b=/^\s*\.(byte|word)\s+(.*)/i.exec(a))b=("word"===b[1]?WordLine$$module$js$6502:ByteLine$$module$js$6502).parse(b[2]),this.addLine(b),this.pc+=b.size();else if(b=/^\s*\.res\s+([^,]+)(?:,\s*(.+))?/i.exec(a))b=ByteLine$$module$js$6502.parseRes(this.parseNumber(b[1]),this.parseNumber(b[2]||"0")),this.addLine(b),this.pc+=b.size();else if(b=/^define\s+(\S+)\s+(.*)/.exec(a))this.addLabel(b[1],
this.parseNumber(b[2]));else{if(b=/^(\S+?):(.*)$/.exec(a)){var c=b[1];a=" "+b[2];this.addLabel(c,~this.pc)}else if(b=/^((?:[-+]+\s+)+)(.*)$/.exec(a)){a=b[1];for(c of a.trim().split(" "))this.addLabel(c,~this.pc);a=" "+b[2]}if(b=/^\s+([a-z]{3})(\s+.*)?$/.exec(a))b=new Opcode$$module$js$6502(b[1],(b[2]||"").trim(),this.pc),this.addLine(b),this.pc+=b.size();else if(/\S/.test(a))throw Error(`Could not parse line ${a} at ${this.filename}:${this.lineNumber}`);}}assemble(){var a=new Context$$module$js$6502(this.labels),
b=[];const c=[],d=(a,b)=>{throw Error(`Collision at $${b.toString(16)}:\n  written at ${c[b].source()}\n  written at ${a.source()}`);};for(var e of this.lines){try{e.expand(a)}catch(g){throw b=g.stack.replace(`Error: ${g.message}`,""),Error(`${g.message}${` from line ${e.origLineNumber+1}: \`${e.origContent}\``}${b}\n================`);}e instanceof OrgLine$$module$js$6502&&null!=b[e.pc]&&d(e,e.pc);for(const f of e.bytes())null!=b[a.pc]&&d(e,a.pc),c[a.pc]=e,b[a.pc++]=f}a=[];for(var f in b)Number(f)-
1 in b||a.push(Number(f));e=[];for(const c of a){f=[];for(a=c;a in b;a++)f.push(b[a]);e.push(new Chunk$$module$js$6502(c,f))}if(this.conditions.length)throw Error("Unterminated .if");return e}}class AbstractLine$$module$js$6502{constructor(){this.origFile="";this.origLineNumber=-1;this.origContent=""}orig(a,b,c){this.origFile=a;this.origLineNumber=b;this.origContent=c;return this}source(){return`${this.origFile}:${this.origLineNumber+1}  ${this.origContent}`}}
class ByteLine$$module$js$6502 extends AbstractLine$$module$js$6502{constructor(a){super();this.bytesInternal=a}static parse(a){const b=[];for(let c of a.split(","))c=c.trim(),(a=/^"(.*)"$/.exec(c))?b.push(...[...a[1]].map((a)=>a.charCodeAt(0))):b.push(parseNumber$$module$js$6502(c));return new ByteLine$$module$js$6502(b)}static parseRes(a,b){return new ByteLine$$module$js$6502(Array(a).fill(b))}bytes(){return[...this.bytesInternal]}size(){return this.bytesInternal.length}expand(){}}
class WordLine$$module$js$6502 extends AbstractLine$$module$js$6502{constructor(a){super();this.words=a}static parse(a){const b=[];for(let c of a.split(","))c=c.trim(),c=c.replace(/[()]/g,""),b.push(parseNumber$$module$js$6502(c,!0));return new WordLine$$module$js$6502(b)}bytes(){const a=[];for(const b of this.words)a.push(b&255),a.push(b>>>8);return a}size(){return 2*this.words.length}expand(a){for(let b=0;b<this.words.length;b++)"string"===typeof this.words[b]&&(this.words[b]=a.map(this.words[b]))}}
class OrgLine$$module$js$6502 extends AbstractLine$$module$js$6502{constructor(a){super();this.pc=a}bytes(){return[]}size(){return 0}expand(a){a.pc=this.pc}}
class AssertLine$$module$js$6502 extends AbstractLine$$module$js$6502{constructor(a,b){super();this.pc=a;this.exact=b}bytes(){return[]}size(){return 0}expand(a){if(this.exact?a.pc!==this.pc:a.pc>this.pc)throw Error(`Misalignment: expected ${this.exact?"":"< "}$${this.pc.toString(16)} but was $${a.pc.toString(16)}`);!this.exact&&LOG$$module$js$6502&&console.log(`Free: ${this.pc-a.pc} bytes between $${a.pc.toString(16)} and $${this.pc.toString(16)}`)}}
class BankLine$$module$js$6502 extends AbstractLine$$module$js$6502{constructor(a,b,c){super();this.prg=a;this.cpu=b;this.length=c}bytes(){return[]}size(){return 0}expand(a){a.updateBank(this.prg,this.cpu,this.length)}}
class Context$$module$js$6502{constructor(a){this.labels=a;this.pc=0;this.cpuToPrg=[];this.prgToCpu=[]}updateBank(a,b,c){for(var d=0;d<c;d++){var e=b+d,f=this.cpuToPrg[e];null!=f&&(this.prgToCpu[f]=null,this.cpuToPrg[e]=null)}for(d=0;d<c;d++)e=b+d,f=a+d,this.prgToCpu[f]=e,this.cpuToPrg[e]=f}mapLabel(a,b){var c=/([^-+]+)([-+])(.*)/.exec(a);if(c)return a=this.map(parseNumber$$module$js$6502(c[1].trim(),!0),b),b=this.map(parseNumber$$module$js$6502(c[3].trim(),!0),b),"-"===c[2]?a-b:a+b;if(c=/([^*]+)[*](.*)/.exec(a))return a=
this.map(parseNumber$$module$js$6502(c[1].trim(),!0),b),b=this.map(parseNumber$$module$js$6502(c[2].trim(),!0),b),a*b;if(c=/([<>])(.*)/.exec(a))return b=this.map(parseNumber$$module$js$6502(c[2].trim(),!0),b),"<"===c[1]?b&255:b>>>8&255;c=this.labels[a];if(!c)throw Error(`Label not found: ${a}`);if(null==b){if(1<c.length)throw Error(`Ambiguous label: ${a}`);return c[0]}b=~(b+2);const d=find$$module$js$6502(c,b);if(0<=d)return c[d];if(-1===d)return c[0];if(d===~c.length)return c[c.length-1];c=c.slice(~d-
1,~d+1);return a.startsWith("-")?c[1]:a.startsWith("+")?c[0]:b<(c[0]+c[1])/2?c[0]:c[1]}mapPrgToCpu(a){const b=this.prgToCpu[a];if(null==b)throw Error(`PRG address unmapped: $${a.toString(16)}`);return b}map(a,b){if(null==a)return a;"string"===typeof a&&(a=this.mapLabel(a,b));0>a&&(a=this.mapPrgToCpu(~a));return a}}
class Chunk$$module$js$6502 extends Uint8Array{constructor(a,b){super(b.length);this.start=a;this.set(b)}apply(a){a.subarray(this.start,this.start+this.length).set(this)}shift(a){return new Chunk$$module$js$6502(this.start+a,this)}}
class Patch$$module$js$6502{constructor(a){this.data=a}static from(a){const b=[];var c=8;for(var d of a)a=new Uint8Array(d.length+5),a[0]=d.start>>>16,a[1]=d.start>>>8&255,a[2]=d.start&255,a[3]=d.length>>>8,a[4]=d.length&255,a.set(d,5),b.push(a),c+=a.length;c=new Uint8Array(c);d=5;c[0]=80;c[1]=65;c[2]=84;c[3]=67;c[4]=72;for(const a of b)c.subarray(d,d+a.length).set(a),d+=a.length;c[d]=69;c[d+1]=79;c[d+2]=70;return new Patch$$module$js$6502(c)}apply(a){for(const b of this)b.apply(a)}*[Symbol.iterator](){let a=
5;for(;a<this.data.length-3;){const b=this.data[a+3]<<8|this.data[a+4];yield new Chunk$$module$js$6502(this.data[a]<<16|this.data[a+1]<<8|this.data[a+2],this.data.subarray(a+5,a+5+b));a+=b+5}}toHexString(){return[...this.data].map((a)=>a.toString(16).padStart(2,"0")).join("")}}
const assemble$$module$js$6502=(a,b="input")=>{b=new File$$module$js$6502({},b);for(const c of a.split("\n"))b.ingest(c);a=b.assemble();return Patch$$module$js$6502.from(a)},buildRomPatch$$module$js$6502=(a,b,c=262144)=>{a=[...a].map((a)=>a.shift(16));b=[...b||[]].map((a)=>a.shift(16+c));return Patch$$module$js$6502.from([...a,...b])};
class Opcode$$module$js$6502 extends AbstractLine$$module$js$6502{constructor(a,b,c){super();this.mnemonic=a;this.pcInternal=c;this.arg=findMode$$module$js$6502(a,b)}get pc(){return this.pcInternal}size(){return 1+this.arg[1]}bytes(){let a=this.arg[2];if("Relative"===this.arg[0]&&(a-=this.pc+2,!(128>a&&-128<=a)))throw Error(`Too far to branch: ${a} at ${this.source()}`);var b=opcodes$$module$js$6502[this.mnemonic][this.arg[0]];if(null==b)throw Error(`No opcode: ${this.mnemonic} ${this.arg[0]}`);b=
[b];let c=this.arg[1];for(;c--;)b.push(a&255),a>>>=8;return b}expand(a){this.arg[2]=a.map(this.arg[2],this.pc);this.pcInternal=a.map(~this.pc)}}
const find$$module$js$6502=(a,b)=>{let c=0,d=a.length-1;if(0>d||b<a[0])return-1;var e=a[d];if(b===e)return d;if(b>e)return~a.length;for(;1<d-c;)e=c+d>>1,b<a[e]?d=e:c=e;return b===a[c]?c:~d},findMode$$module$js$6502=(a,b)=>{for(const [d,e]of modes$$module$js$6502){var c=d.exec(b);if(c){c=e(c[1]);if(!(a in opcodes$$module$js$6502))throw Error(`Bad mnemonic: ${a}`);if(c[0]in opcodes$$module$js$6502[a])return c}}throw Error(`Could not find mode for ${a} ${b}
Expected one of [${Object.keys(opcodes$$module$js$6502[a]).join(", ")}]`);},modes$$module$js$6502=[[/^$/,()=>["Implied",0,0]],[/^#(.+)$/,(a)=>["Immediate",1,parseNumber$$module$js$6502(a,!0)]],[/^(\$..)$/,(a)=>["ZeroPage",1,parseNumber$$module$js$6502(a,!0)]],[/^(\$..),x$/,(a)=>["ZeroPageX",1,parseNumber$$module$js$6502(a,!0)]],[/^(\$..),y$/,(a)=>["ZeroPageY",1,parseNumber$$module$js$6502(a,!0)]],[/^\((\$..),x\)$/,(a)=>["PreindexedIndirect",1,parseNumber$$module$js$6502(a,!0)]],[/^\((\$..)\),y$/,
(a)=>["PostindexedIndirect",1,parseNumber$$module$js$6502(a,!0)]],[/^\((.+)\)$/,(a)=>["IndirectAbsolute",2,parseNumber$$module$js$6502(a,!0)]],[/^(.+),x$/,(a)=>["AbsoluteX",2,parseNumber$$module$js$6502(a,!0)]],[/^(.+),y$/,(a)=>["AbsoluteY",2,parseNumber$$module$js$6502(a,!0)]],[/^(.+)$/,(a)=>["Absolute",2,parseNumber$$module$js$6502(a,!0)]],[/^(.+)$/,(a)=>["Relative",1,parseNumber$$module$js$6502(a,!0)]]];
function parseNumber$$module$js$6502(a,b=!1){if(a.startsWith("$"))return Number.parseInt(a.substring(1),16);if(a.startsWith("%"))return Number.parseInt(a.substring(1),2);if(a.startsWith("0"))return Number.parseInt(a,8);const c=Number.parseInt(a,10);if(!Number.isNaN(c))return c;if(b)return a;throw Error(`Bad number: ${a}`);}
const opcodes$$module$js$6502={adc:{Absolute:109,AbsoluteX:125,AbsoluteY:121,Immediate:105,PostindexedIndirect:113,PreindexedIndirect:97,ZeroPage:101,ZeroPageX:117},and:{Absolute:45,AbsoluteX:61,AbsoluteY:57,Immediate:41,PostindexedIndirect:49,PreindexedIndirect:33,ZeroPage:37,ZeroPageX:53},asl:{Absolute:14,AbsoluteX:30,Implied:10,ZeroPage:6,ZeroPageX:22},bcc:{Relative:144},bcs:{Relative:176},beq:{Relative:240},bit:{Absolute:44,ZeroPage:36},bmi:{Relative:48},bne:{Relative:208},bpl:{Relative:16},brk:{Implied:0},
bvc:{Relative:80},bvs:{Relative:112},clc:{Implied:24},cld:{Implied:216},cli:{Implied:88},clv:{Implied:184},cmp:{Absolute:205,AbsoluteX:221,AbsoluteY:217,Immediate:201,PostindexedIndirect:209,PreindexedIndirect:193,ZeroPage:197,ZeroPageX:213},cpx:{Absolute:236,Immediate:224,ZeroPage:228},cpy:{Absolute:204,Immediate:192,ZeroPage:196},dec:{Absolute:206,AbsoluteX:222,ZeroPage:198,ZeroPageX:214},dex:{Implied:202},dey:{Implied:136},eor:{Absolute:77,AbsoluteX:93,AbsoluteY:89,Immediate:73,PostindexedIndirect:81,
PreindexedIndirect:65,ZeroPage:69,ZeroPageX:85},inc:{Absolute:238,AbsoluteX:254,ZeroPage:230,ZeroPageX:246},inx:{Implied:232},iny:{Implied:200},jmp:{Absolute:76,IndirectAbsolute:108},jsr:{Absolute:32},lda:{Absolute:173,AbsoluteX:189,AbsoluteY:185,Immediate:169,PostindexedIndirect:177,PreindexedIndirect:161,ZeroPage:165,ZeroPageX:181},ldx:{Absolute:174,AbsoluteY:190,Immediate:162,ZeroPage:166,ZeroPageY:182},ldy:{Absolute:172,AbsoluteX:188,Immediate:160,ZeroPage:164,ZeroPageX:180},lsr:{Absolute:78,
AbsoluteX:94,Implied:74,ZeroPage:70,ZeroPageX:86},nop:{Implied:234},ora:{Absolute:13,AbsoluteX:29,AbsoluteY:25,Immediate:9,PostindexedIndirect:17,PreindexedIndirect:1,ZeroPage:5,ZeroPageX:21},pha:{Implied:72},php:{Implied:8},pla:{Implied:104},plp:{Implied:40},rol:{Absolute:46,AbsoluteX:62,Implied:42,ZeroPage:38,ZeroPageX:54},ror:{Absolute:110,AbsoluteX:126,Implied:106,ZeroPage:102,ZeroPageX:118},rti:{Implied:64},rts:{Implied:96},sbc:{Absolute:237,AbsoluteX:253,AbsoluteY:249,Immediate:233,PostindexedIndirect:241,
PreindexedIndirect:225,ZeroPage:229,ZeroPageX:245},sec:{Implied:56},sed:{Implied:248},sei:{Implied:120},sta:{Absolute:141,AbsoluteX:157,AbsoluteY:153,PostindexedIndirect:145,PreindexedIndirect:129,ZeroPage:133,ZeroPageX:149},stx:{Absolute:142,ZeroPage:134,ZeroPageY:150},sty:{Absolute:140,ZeroPage:132,ZeroPageX:148},tax:{Implied:170},tay:{Implied:168},tsx:{Implied:186},txa:{Implied:138},txs:{Implied:154},tya:{Implied:152}};var module$js$6502={};module$js$6502.Assembler=Assembler$$module$js$6502;
module$js$6502.assemble=assemble$$module$js$6502;module$js$6502.buildRomPatch=buildRomPatch$$module$js$6502;let assertionsEnabled$$module$js$assert=!0;function disableAsserts$$module$js$assert(){assertionsEnabled$$module$js$assert=!1}function assert$$module$js$assert(a){if(assertionsEnabled$$module$js$assert&&!a)throw Error("impossible");}function fail$$module$js$assert(){if(assertionsEnabled$$module$js$assert)throw Error("impossible");}var module$js$assert={};module$js$assert.disableAsserts=disableAsserts$$module$js$assert;module$js$assert.assert=assert$$module$js$assert;module$js$assert.fail=fail$$module$js$assert;const BitsArray$$module$js$bits_array={of:(...a)=>{const b=[];for(const c of a)b[c>>>5]=(b[c>>>5]||0)|1<<c;return b},from:(a)=>{const b=[];for(const c of a)b[c>>>5]=(b[c>>>5]||0)|1<<c;return b},containsAll:(a,b)=>{for(let c=Math.max(a.length,b.length)-1;0<=c;c--)if((b[c]||0)&~(a[c]||0))return!1;return!0},difference:(a,b)=>{const c=Array(Math.max(a.length,b.length));for(let d=Math.max(a.length,b.length)-1;0<=d;d--)c[d]=(a[d]||0)&~(b[d]||0);return c},with:(a,b)=>{a=[...a];a[b>>>5]=(a[b>>>5]||0)|1<<
b;return a},without:(a,b)=>{a=[...a];a[b>>>5]=(a[b>>>5]||0)&~(1<<b);return a},has:(a,b)=>!!((a[b>>>5]||0)&1<<b),bits:(a)=>{const b=[];for(let c=0;c<a.length;c++){let d=a[c],e=32;for(;d;){const a=Math.clz32(d)+1;e-=a;d<<=a;32===a&&(d=0);b.push(c<<5|e)}}return b},clone:(a)=>[...a],empty:(a)=>a.every((a)=>!a)};var module$js$bits_array={};module$js$bits_array.BitsArray=BitsArray$$module$js$bits_array;const BitsBigInt$$module$js$bits_bigint={of:(...a)=>{let b=ZERO$$module$js$bits_bigint;for(const c of a)b|=ONE$$module$js$bits_bigint<<BigInt(c);return b},from:(a)=>{let b=ZERO$$module$js$bits_bigint;for(const c of a)b|=ONE$$module$js$bits_bigint<<BigInt(c);return b},containsAll:(a,b)=>!(b&~a),with:(a,b)=>a|ONE$$module$js$bits_bigint<<BigInt(b),without:(a,b)=>a&~(ONE$$module$js$bits_bigint<<BigInt(b)),has:(a,b)=>!!(a&ONE$$module$js$bits_bigint<<BigInt(b)),bits:(a)=>{const b=[];let c=0;for(;a;){let d=
Number(a&MAX_UINT32$$module$js$bits_bigint),e=32;for(;d;){const a=Math.clz32(d)+1;e-=a;d<<=a;32===a&&(d=0);b.push(c|e)}a>>=THIRTY_TWO$$module$js$bits_bigint;c+=32}return b},clone:(a)=>a,empty:(a)=>!a,difference:(a,b)=>a&~b},BIGINT_OK$$module$js$bits_bigint="function"===typeof BigInt&&"bigint"===typeof BigInt(0),ZERO$$module$js$bits_bigint=BIGINT_OK$$module$js$bits_bigint&&BigInt(0),ONE$$module$js$bits_bigint=BIGINT_OK$$module$js$bits_bigint&&BigInt(1),MAX_UINT32$$module$js$bits_bigint=BIGINT_OK$$module$js$bits_bigint&&
BigInt(4294967295),THIRTY_TWO$$module$js$bits_bigint=BIGINT_OK$$module$js$bits_bigint&&BigInt(32);var module$js$bits_bigint={};module$js$bits_bigint.BitsBigInt=BitsBigInt$$module$js$bits_bigint;module$js$bits_bigint.BIGINT_OK=BIGINT_OK$$module$js$bits_bigint;const Bits$$module$js$bits=BIGINT_OK$$module$js$bits_bigint?BitsBigInt$$module$js$bits_bigint:BitsArray$$module$js$bits_array;var module$js$bits={};module$js$bits.Bits=Bits$$module$js$bits;let table$$module$js$crc32;
const buildTable$$module$js$crc32=()=>{let a;table$$module$js$crc32=new Uint32Array(256);for(let b=0;256>b;b++){a=b;for(let b=0;8>b;b++)a=a&1?3988292384^a>>>1:a>>>1;table$$module$js$crc32[b]=a}},USE_TEXT_ENCODER$$module$js$crc32=!1,strToBytes$$module$js$crc32=USE_TEXT_ENCODER$$module$js$crc32&&"function"===typeof TextEncoder?(a)=>(new TextEncoder).encode(a):(a)=>a.split("").map((a)=>a.charCodeAt(0)),crc32$$module$js$crc32=(a)=>{table$$module$js$crc32||buildTable$$module$js$crc32();"string"===typeof a&&
(a=strToBytes$$module$js$crc32(a));let b=-1;for(let c=0,d=a.length;c<d;c++)b=b>>>8^table$$module$js$crc32[(b^a[c])&255];return(b^-1)>>>0};var module$js$crc32={};module$js$crc32.crc32=crc32$$module$js$crc32;const DEBUG_MODE_FLAGS$$module$js$flags$debug_mode={section:"Debug Mode",prefix:"D",text:"These options are helpful for exploring or debugging.  Note that,\n      while they do not directly affect any randomization, they\n      <i>do</i> factor into the seed to prevent cheating, and they\n      will remove the option to generate a seed for racing.",flags:[{flag:"Ds",name:"Generate a spoiler log",text:"Note: <b>this will change the placement of items</b> compared to a\n      seed generated without this flag turned on."},
{flag:"Di",name:"Player never dies"}]};var module$js$flags$debug_mode={};module$js$flags$debug_mode.DEBUG_MODE_FLAGS=DEBUG_MODE_FLAGS$$module$js$flags$debug_mode;const EASY_MODE_FLAGS$$module$js$flags$easy_mode={section:"Easy Mode",text:"The following options make parts of the game easier.",prefix:"E",flags:[{flag:"Ed",name:"Decrease enemy damage",text:"Enemy attack power will be significantly decreased in the early game\n           (by a factor of 3).  The gap will narrow in the mid-game and eventually\n           phase out at scaling level 40."},{flag:"Es",name:"Guarantee starting sword",text:"The Leaf elder is guaranteed to give a sword.  It will not be\n           required to deal with any enemies before finding the first sword."},
{flag:"Er",name:"Guarantee refresh",text:"Guarantees the Refresh spell will be available before fighting Tetrarchs."},{flag:"Em",name:"Extra buff medical herb",text:"Buff Medical Herb to heal 96 instead of 64 and Fruit of Power to\n           restore 64 MP instead of 48.",conflict:/Hm/},{flag:"Ex",name:"Experience scales faster",text:'Less grinding will be required to "keep up" with the game difficulty.',conflict:/Hx/}]};var module$js$flags$easy_mode={};module$js$flags$easy_mode.EASY_MODE_FLAGS=EASY_MODE_FLAGS$$module$js$flags$easy_mode;const GLITCH_FIX_FLAGS$$module$js$flags$glitch_fixes={section:"Glitch Fixes",prefix:"F",text:"Alternatively, glitches may be patched out of the game and made unusable.\n         These flags are exclusive with the flags that require the glitch.",flags:[{flag:"Fs",name:"Disable shop glitch",text:"Items may no longer be purchased for neighboring prices.  This makes\n           money actually mean something.  To compensate, gold drops money\n           will be scaled up somewhat."},{flag:"Fc",name:"Disable sword charge glitch",
text:"Sword charge glitch will no longer work.  It will be impossible to\n           achieve charge levels without having correct inventory.",conflict:/Gc/},{flag:"Fp",name:"Disable teleport skip",text:"Mt Sabre North cannot be entered from Cordel Plans without the\n           Teleport spell, even via glitch.",conflict:/Gp/},{flag:"Fr",name:"Disable rabbit skip",text:"Mt Sabre North cannot be entered from Cordel Plans without talking to\n           the rabbit in leaf.",conflict:/Gr/},{flag:"Ft",name:"Disable statue glitch",
text:"Statues will instead always push downwards, making it impossible to\n           glitch through statues for progression.",conflict:/Gt/},{flag:"Fw",name:"Disable wild warp",text:"Wild warp will only teleport back to Mezame shrine (to prevent\n           game-breaking soft-locks).",conflict:/[GT]w/}]};var module$js$flags$glitch_fixes={};module$js$flags$glitch_fixes.GLITCH_FIX_FLAGS=GLITCH_FIX_FLAGS$$module$js$flags$glitch_fixes;const GLITCH_FLAGS$$module$js$flags$glitches={section:"Glitches",prefix:"G",text:"The routing logic can be made aware of the following\n      glitches.  If selected, it will assume that the glitch can be\n      performed when verifying that a game is winnable.  Enabling\n      these glitches tends to increase the randomness of the shuffle,\n      since there are more valid options.",flags:[{flag:"Gc",hard:!0,name:"Sword charge glitch may be required",text:"Progression may require using the sword charge glitch to destroy walls or\n           form bridges without actually possessing the correct orb.",
conflict:/Fc/},{flag:"Gf",name:"Ghetto flight may be required",text:"Progression may require using Rabbit Boots and the dolphin to reach Swan\n           before the Angry Sea can be calmed and before Flight is available."},{flag:"Gp",name:"Teleport skip may be required",text:"Progression may require entering Mt. Sabre North from Cordel Plain\n           without the Teleport spell (flying over the river to avoid the\n           trigger).",conflict:/Fp/},{flag:"Gr",name:"Rabbit skip may be required",
text:"Progression may require entering Mt. Sabre North from Cordel Plain\n           without talking to the rabbit in Leaf after the abduction.",conflict:/Fr/},{flag:"Gt",name:"Statue glitch may be required",text:"Progression may require glitching past guards without Change or Paralysis,\n           or people turned to stone without a Flute of Lime.  The logic ensures that \n           using the Flute of Lime on the two statues will not break the game since\n           it can be used twice.",conflict:/Ft/},
{flag:"Gw",hard:!0,name:"Wild warp may be required",text:'Progression may require using "wild warp" (holding A and B on controller 1\n           and tapping A on controller 2) to travel to parts of the game that would\n           otherwise be unreachable.',conflict:/Fw/}]};var module$js$flags$glitches={};module$js$flags$glitches.GLITCH_FLAGS=GLITCH_FLAGS$$module$js$flags$glitches;const HARD_MODE_FLAGS$$module$js$flags$hard_mode={section:"Hard mode",prefix:"H",flags:[{flag:"Hw",hard:!0,name:"Battle magic not guaranteed",text:"Normally, the logic will guarantee that level 3 sword charges are\n             available before fighting the tetrarchs (with the exception of Karmine,\n             who only requires level 2).  This disables that check."},{flag:"Hb",hard:!0,name:"Barrier not guaranteed",text:"Normally, the logic will guarantee Barrier (or else refresh and shield\n             ring) before entering Stxy, the Fortress, or fighting Karmine.  This\n             disables that check."},
{flag:"Hm",hard:!0,name:"Don't buff medical herb or fruit of power",text:"Medical Herb is not buffed to heal 64 damage, which is helpful to make\n             up for cases where Refresh is unavailable early.  Fruit of Power is not\n             buffed to restore 48 MP.",conflict:/Em/},{flag:"Hg",hard:!0,name:"Gas mask not guaranteed",text:"The logic will not guarantee gas mask before needing to enter the swamp.\n             Gas mask is still guaranteed to kill the insect."},{flag:"Hs",hard:!0,name:"Matching sword not guaranteed",
text:'Player may be required to fight bosses with the wrong sword, which\n             may require using "tink strats" dealing 1 damage per hit.'},{flag:"Hx",hard:!0,name:"Experience scales slower",text:'More grinding will be required to "keep up" with the difficulty.',conflict:/Ex/},{flag:"Hc",hard:!0,name:"Charge shots only",text:"Stabbing is completely ineffective.  Only charged shots work."},{flag:"Hd",hard:!0,name:"Buff Dyna",text:"Makes the Dyna fight a bit more of a challenge.  Side pods will fire\n             significantly more.  The safe spot has been removed.  The counter\n             attacks pass through barrier.  Side pods can now be killed."},
{flag:"Hz",hard:!0,name:"Blackout mode",text:"All caves and fortresses are permanently dark."},{flag:"Hh",hard:!0,name:"Hardcore mode",text:"Checkpoints and saves are removed."}]};var module$js$flags$hard_mode={};module$js$flags$hard_mode.HARD_MODE_FLAGS=HARD_MODE_FLAGS$$module$js$flags$hard_mode;const ITEM_FLAGS$$module$js$flags$items={section:"Items",prefix:"S",text:"Items are broken into five pools: <i>key items</i> includes all\n            unique items; <i>consumable items</i> includes anything that can be\n            dropped; <i>magic</i> is the eight spells; and <i>traps</i> are the\n            12 trap chests found in various places. These pools can be shuffled\n            together, kept separate, or left unshuffled.",flags:[{flag:"Sk",name:"Shuffle key items"},{flag:"Sm",name:"Shuffle magics"},
{flag:"Sc",name:"Shuffle consumables"},{flag:"Sct",name:"Shuffle consumables with traps"},{flag:"Skm",name:"Shuffle key items with magic"},{flag:"Skt",name:"Shuffle key items with traps"},{flag:"Sck",hard:!0,name:"Shuffle consumables with key items"},{flag:"Scm",hard:!0,name:"Shuffle consumables with magic"},{flag:"Skmt",hard:!0,name:"Shuffle key, magic, and traps"},{flag:"Sckm",hard:!0,name:"Shuffle key, consumables, and magic"},{flag:"Sckt",hard:!0,name:"Shuffle key, consumables, and traps"},{flag:"Sckmt",
hard:!0,name:"Shuffle all items and traps together"}]};var module$js$flags$items={};module$js$flags$items.ITEM_FLAGS=ITEM_FLAGS$$module$js$flags$items;const MONSTER_FLAGS$$module$js$flags$monsters={section:"Monsters",text:"Monster stats are always normalized by scaling level.",prefix:"M",flags:[{flag:"Mr",name:"Randomize monsters",text:"Monster locations are shuffled, with the exception of sea creatures\n             and tower robots."},{flag:"Me",name:"Shuffle monster weaknesses",text:"Monster and boss elemental weaknesses are shuffled."},{flag:"Mt",hard:!0,name:"Shuffle tower robots",text:"Tower robots will be shuffled into the normal pool.  At some\n             point, normal monsters may be shuffled into the tower as well."}]};
var module$js$flags$monsters={};module$js$flags$monsters.MONSTER_FLAGS=MONSTER_FLAGS$$module$js$flags$monsters;const ROUTING_FLAGS$$module$js$flags$routing={section:"Routing",prefix:"R",flags:[{flag:"Rs",name:"Story Mode",text:"Draygon 2 won't spawn unless you have all four swords and have\n           defeated all major bosses of the tetrarchy."},{flag:"Rt",name:"Sword of Thunder teleports to Shyron",text:"Normally when acquiring the thunder sword, the player is instantly\n           teleported to Shyron. This flag maintains that behavior regardless of\n           where it is found (immediately activating the warp point; talking\n           to Asina will teleport back to the Shrine of Mezame, in case no other\n           means of return is available).  Disabling this flag means that the\n           Sword of Thunder will act like all other items and not teleport."},
{flag:"Rd",name:"Require healing dolphin to return fog lamp",text:"Normally the fog lamp cannot be returned without healing the dolphin\n           to acquire the shell flute (so as not to be stranded).  Continuity\n           suggests that actually healing the dolphin should also be required,\n           but we've found that this makes the dolphin a lot less useful.  By\n           default the fog lamp can be returned before healing the dolphin.  This\n           flag adds the extra requirement for better continuity."},
{flag:"Rp",name:"Wind-waterfall passage",text:"Opens a passage between Valley of Wind (lower right side) and\n           Lime Tree Valley."},{flag:"Rr",name:"Deo requires telepathy",text:"Deo's item is additionally blocked on telepathy."},{flag:"Ro",name:"Orbs not required to break walls",text:"Walls can be broken and bridges formed with level 1 shots.  Orbs and\n           bracelets are no longer considered progression items (except for\n           Tornado bracelet for Tornel on Mt Sabre)."}]};
var module$js$flags$routing={};module$js$flags$routing.ROUTING_FLAGS=ROUTING_FLAGS$$module$js$flags$routing;const SHOP_FLAGS$$module$js$flags$shops={section:"Shops",prefix:"P",text:"Prices are always normalized by scaling level: prices at tool shops\n           and inns double every 10 scaling levels, while prices at armor shops\n           halve every 12 scaling levels ",flags:[{flag:"Ps",name:"Shuffle shop contents",text:"This includes normalizing prices via the scaling level, as well as a\n             random variance for each shop: base prices may vary \u00b150% for the same\n             item at different; inn prices may vary \u00b162.5%."}]};
var module$js$flags$shops={};module$js$flags$shops.SHOP_FLAGS=SHOP_FLAGS$$module$js$flags$shops;const TWEAK_FLAGS$$module$js$flags$tweaks={section:"Tweaks",prefix:"T",flags:[{flag:"Ta",name:"Automatically equip orbs and bracelets",text:"Adds a quality-of-life improvement to automatically equip the\n             corresponding orb/bracelet whenever changing swords."},{flag:"Tb",name:"Buff bonus items",text:"Leather Boots are changed to Speed Boots, which increase player walking\n             speed (this allows climbing up the slope to access the Tornado Bracelet\n             chest, which is taken into consideration by the logic).  Deo's pendant\n             restores MP while moving.  Rabbit boots enable sword charging up to\n             level 2 while walking (level 3 still requires being stationary, so as\n             to prevent wasting tons of magic)."},
{flag:"Tm",name:"Randomize music"},{flag:"Tp",name:"Randomize sprite palettes"},{flag:"Tw",name:"Randomize wild warp",text:"Wild warp will go to Mezame Shrine and 15 other random locations.",conflict:/Fw/}]};var module$js$flags$tweaks={};module$js$flags$tweaks.TWEAK_FLAGS=TWEAK_FLAGS$$module$js$flags$tweaks;const WORLD_FLAGS$$module$js$flags$world={section:"World",prefix:"W",flags:[{flag:"Wt",name:"Randomize trade-in items",text:"Items expected by various NPCs will be shuffled: specifically,\n             Statue of Onyx, Kirisa Plant, Love Pendant, Ivory Statue, Fog\n             Lamp, and Flute of Lime (for Akahana).  Rage will expect a\n             random sword, and Tornel will expect a random bracelet."},{flag:"Wu",hard:!0,name:"Unidentified key items",text:"Item names will be generic and effects will be shuffled.  This\n             includes keys, flutes, lamps, and statues."},
{flag:"Ww",name:"Randomize elements to break walls",text:'Walls will require a randomized element to break.  Normal rock and\n             ice walls will indicate the required element by the color (light\n             grey or yellow for wind, blue for fire, bright orange ("embers") for\n             water, or dark grey ("steel") for thunder.  The element to break\n             these walls is the same throughout an area.  Iron walls require a\n             one-off random element, with no visual cue, and two walls in the\n             same area may have different requirements.'}]};
var module$js$flags$world={};module$js$flags$world.WORLD_FLAGS=WORLD_FLAGS$$module$js$flags$world;class Deque$$module$js$util{constructor(){this.buffer=Array(16);this.mask=15;this.size=this.end=this.start=0}get length(){return this.size}upsize(a){for(;this.mask<a;)this.end<=this.start&&(this.start+=this.mask+1),this.mask=this.mask<<1|1,this.buffer=this.buffer.concat(this.buffer);this.size=a}push(...a){this.upsize(this.size+a.length);for(const b of a)this.buffer[this.end]=b,this.end=this.end+1&this.mask}pop(){if(this.size)return this.end=this.end-1&this.mask,this.size--,this.buffer[this.end]}peek(){if(this.size)return this.buffer[this.end-
1&this.mask]}unshift(...a){this.upsize(this.size+a.length);for(const b of a)this.start=this.start-1&this.mask,this.buffer[this.start]=b}shift(){if(this.size){var a=this.buffer[this.start];this.start=this.start+1&this.mask;this.size--;return a}}front(){if(this.size)return this.buffer[this.start]}toString(){const a=Array(this.size);for(let b=0;b<this.size;b++)a[b]=this.buffer[this.start+b&this.mask];return`[${a.join(", ")}]`}}
const breakLines$$module$js$util=(a,b)=>{a=a.trim();const c=[];for(;a.length>b;){let d=a.substring(0,b).lastIndexOf(" ");0>d&&(d=b);c.push(a.substring(0,d).trim());a=a.substring(d).trim()}c.push(a.trim());return c};class UsageError$$module$js$util extends Error{}
class SuffixTrie$$module$js$util{constructor(a=""){this.key=a;this.next=new Map}get(a){let b=this;for(let c=a.length-1;0<=c&&b;c++)b=b.next.get(a[c]);return b&&b.data}with(a){let b=this.next.get(a);b||this.next.set(a,b=new SuffixTrie$$module$js$util(a+this.key));return b}set(a,b){let c=this;for(let b=a.length-1;0<=b&&c;b++)c=c.with(a[b]);c.data=b}*values(){const a=[this];for(;a.length;){const b=a.pop();b.data&&(yield b.data);a.push(...b.next.values())}}}
class DefaultMap$$module$js$util extends Map{constructor(a,b){super(b);this.supplier=a}get(a){let b=super.get(a);null==b&&super.set(a,b=this.supplier(a));return b}}class IndexedSet$$module$js$util{constructor(){this.forward=[];this.reverse=new Map}add(a){let b=this.reverse.get(a);null==b&&this.reverse.set(a,b=this.forward.push(a)-1);return b}get(a){return this.forward[a]}}var iters$$module$js$util;
(function(a){a.concat=function*(...a){for(const b of a)yield*b};a.map=function*(a,c){for(const b of a)yield c(b)};a.filter=function*(a,c){for(const b of a)c(b)&&(yield b)};a.flatMap=function*(a,c){for(const b of a)yield*c(b)};a.count=function(a){let b=0;for(const c of a)b++;return b}})(iters$$module$js$util||(iters$$module$js$util={}));const INVALIDATED$$module$js$util=Symbol("Invalidated"),SIZE$$module$js$util=Symbol("Size");
class SetMultimapSetView$$module$js$util{constructor(a,b,c){this.ownerMap=a;this.ownerKey=b;this.currentSet=c}getCurrentSet(){if(!this.currentSet||this.currentSet[INVALIDATED$$module$js$util])this.currentSet=this.ownerMap.get(this.ownerKey)||new Set;return this.currentSet}mutateSet(a){const b=this.getCurrentSet(),c=b.size;try{return a(b)}finally{this.ownerMap[SIZE$$module$js$util]+=b.size-c,b.size||(this.ownerMap.delete(this.ownerKey),b[INVALIDATED$$module$js$util]=!0)}}add(a){this.mutateSet((b)=>
b.add(a));return this}has(a){return this.getCurrentSet().has(a)}clear(){this.mutateSet((a)=>a.clear())}delete(a){return this.mutateSet((b)=>b.delete(a))}[Symbol.iterator](){return this.getCurrentSet()[Symbol.iterator]()}values(){return this.getCurrentSet().values()}keys(){return this.getCurrentSet().keys()}entries(){return this.getCurrentSet().entries()}forEach(a,b){this.getCurrentSet().forEach(a,b)}get size(){return this.getCurrentSet().size}get [Symbol.toStringTag](){return"Set"}}
Reflect.setPrototypeOf(SetMultimapSetView$$module$js$util.prototype,Set.prototype);class SetMultimap$$module$js$util{constructor(a=[]){this.map=new Map;this.map[SIZE$$module$js$util]=0;for(const [b,c]of a)this.add(b,c)}get size(){return this.map[SIZE$$module$js$util]}get(a){return new SetMultimapSetView$$module$js$util(this.map,a,this.map.get(a))}add(a,b){let c=this.map.get(a);c||this.map.set(a,c=new Set);a=c.size;c.add(b);this.map[SIZE$$module$js$util]+=c.size-a}}
class Multiset$$module$js$util{constructor(a=[]){this.entries=new DefaultMap$$module$js$util(()=>0,a)}add(a){this.entries.set(a,this.entries.get(a)+1)}delete(a){const b=this.entries.get(a)-1;0<b?this.entries.set(a,b):this.entries.delete(a)}unique(){return this.entries.size}count(a){return this.entries.has(a)?this.entries.get(a):0}[Symbol.iterator](){return this.entries.entries()}}function assertNever$$module$js$util(a){throw Error(`non-exhaustive check: ${a}`);}
function isNonNull$$module$js$util(a){return null!=a}var module$js$util={};module$js$util.Deque=Deque$$module$js$util;module$js$util.breakLines=breakLines$$module$js$util;module$js$util.UsageError=UsageError$$module$js$util;module$js$util.SuffixTrie=SuffixTrie$$module$js$util;module$js$util.DefaultMap=DefaultMap$$module$js$util;module$js$util.IndexedSet=IndexedSet$$module$js$util;module$js$util.iters=iters$$module$js$util;module$js$util.SetMultimap=SetMultimap$$module$js$util;
module$js$util.Multiset=Multiset$$module$js$util;module$js$util.assertNever=assertNever$$module$js$util;module$js$util.isNonNull=isNonNull$$module$js$util;const REPEATABLE_FLAGS$$module$js$flagset=new Set(["S"]),PRESETS$$module$js$flagset=[{title:"Casual",descr:"Basic flags for a relatively easy playthrough.",flags:"Ds Edmrsx Fw Mr Rp Sc Sk Sm Tab"},{title:"Intermediate",descr:"Slightly more challenge than Casual but still approachable.",flags:"Ds Edms Fsw Gt Mr Ps Rpt Sct Skm Tab",default:!0},{title:"Full Shuffle",descr:"Slightly harder than intermediate, with full shuffle and no spoiler log.",flags:"Em Fsw Gt Mert Ps Rprt Sckmt Tabmp Wtuw"},{title:"Glitchless",
descr:"Full shuffle but with no glitches.",flags:"Em Fcpstw Mert Ps Rprt Sckmt Tab Wtuw"},{title:"Advanced",descr:"A balanced randomization with quite a bit more difficulty.",flags:"Fsw Gfprt Hbdgw Mert Ps Roprst Sckt Sm Tabmp Wtuw"},{title:"Ludicrous",descr:"Pulls out all the stops, may require superhuman feats.",flags:"Fs Gcfprtw Hbdgmswxz Mert Ps Roprst Sckmt Tabmp Wtuw"},{title:"Mattrick",descr:"Not for the faint of heart. Good luck...",flags:"Fcprsw Gt Hbdhwx Mert Ps Ropst Sckmt Tabmp Wtuw"},
{title:"Tournament: Swiss Round",descr:"Quick-paced full-shuffle flags for Swiss Round of 2019 Tournament",flags:"Es Fcprsw Gt Hd Mr Ps Rpt Sckmt Tab"}],PRESETS_BY_KEY$$module$js$flagset={};for(const {title:a,flags:b}of PRESETS$$module$js$flagset)PRESETS_BY_KEY$$module$js$flagset[`@${a.replace(/ /g,"").toLowerCase()}`]=b;
const FLAGS$$module$js$flagset=[ITEM_FLAGS$$module$js$flags$items,WORLD_FLAGS$$module$js$flags$world,MONSTER_FLAGS$$module$js$flags$monsters,SHOP_FLAGS$$module$js$flags$shops,HARD_MODE_FLAGS$$module$js$flags$hard_mode,TWEAK_FLAGS$$module$js$flags$tweaks,ROUTING_FLAGS$$module$js$flags$routing,GLITCH_FLAGS$$module$js$flags$glitches,GLITCH_FIX_FLAGS$$module$js$flags$glitch_fixes,EASY_MODE_FLAGS$$module$js$flags$easy_mode,DEBUG_MODE_FLAGS$$module$js$flags$debug_mode];
class FlagSet$$module$js$flagset{constructor(a="RtGftTab"){if(a.startsWith("@")){var b=PRESETS_BY_KEY$$module$js$flagset[a.toLowerCase()];if(!b)throw new UsageError$$module$js$util(`Unknown preset: ${a}`);a=b}this.flags={};a=a.replace(/[^A-Za-z0-9!]/g,"");b=/([A-Z])([a-z0-9!]+)/g;for(var c;c=b.exec(a);){const [,a,b]=c;c=REPEATABLE_FLAGS$$module$js$flagset.has(a)?[b]:b;for(const b of c)this.set(a+b,!0)}}get(a){return this.flags[a]||[]}set(a,b){const c=a[0],d=a.substring(1);b?(this.removeConflicts(a),
a=(this.flags[c]||[]).filter((a)=>a!==d),a.push(d),a.sort(),this.flags[c]=a):(a=(this.flags[c]||[]).filter((a)=>a!==d),a.length?this.flags[c]=a:delete this.flags[c])}check(a){const b=this.flags[a[0]];return!!(b&&0<=b.indexOf(a.substring(1)))}autoEquipBracelet(){return this.check("Ta")}buffDeosPendant(){return this.check("Tb")}leatherBootsGiveSpeed(){return this.check("Tb")}rabbitBootsChargeWhileWalking(){return this.check("Tb")}randomizeMusic(){return this.check("Tm")}shuffleSpritePalettes(){return this.check("Tp")}shuffleMonsters(){return this.check("Mr")}shuffleShops(){return this.check("Ps")}bargainHunting(){return this.shuffleShops()}shuffleTowerMonsters(){return this.check("Mt")}shuffleMonsterElements(){return this.check("Me")}shuffleBossElements(){return this.shuffleMonsterElements()}doubleBuffMedicalHerb(){return this.check("Em")}buffMedicalHerb(){return!this.check("Hm")}decreaseEnemyDamage(){return this.check("Ed")}neverDie(){return this.check("Di")}chargeShotsOnly(){return this.check("Hc")}barrierRequiresCalmSea(){return!0}paralysisRequiresPrisonKey(){return!0}sealedCaveRequiresWindmill(){return!0}connectLimeTreeToLeaf(){return this.check("Rp")}storyMode(){return this.check("Rs")}requireHealedDolphinToRide(){return this.check("Rd")}saharaRabbitsRequireTelepathy(){return this.check("Rr")}teleportOnThunderSword(){return this.check("Rt")}orbsOptional(){return this.check("Ro")}randomizeMaps(){return!1}randomizeTrades(){return this.check("Wt")}unidentifiedItems(){return this.check("Wu")}randomizeWalls(){return this.check("Ww")}guaranteeSword(){return this.check("Es")}guaranteeSwordMagic(){return!this.check("Hw")}guaranteeMatchingSword(){return!this.check("Hs")}guaranteeGasMask(){return!this.check("Hg")}guaranteeBarrier(){return!this.check("Hb")}guaranteeRefresh(){return this.check("Er")}disableSwordChargeGlitch(){return this.check("Fc")}disableTeleportSkip(){return this.check("Fp")}disableRabbitSkip(){return this.check("Fr")}disableShopGlitch(){return this.check("Fs")}disableStatueGlitch(){return this.check("Ft")}assumeSwordChargeGlitch(){return this.check("Gc")}assumeGhettoFlight(){return this.check("Gf")}assumeTeleportSkip(){return this.check("Gp")}assumeRabbitSkip(){return this.check("Gr")}assumeStatueGlitch(){return this.check("Gt")}assumeTriggerGlitch(){return!1}assumeWildWarp(){return this.check("Gw")}nerfWildWarp(){return this.check("Fw")}allowWildWarp(){return!this.nerfWildWarp()}randomizeWildWarp(){return this.check("Tw")}blackoutMode(){return this.check("Hz")}hardcoreMode(){return this.check("Hh")}buffDyna(){return this.check("Hd")}expScalingFactor(){return this.check("Hx")?
.25:this.check("Ex")?2.5:1}removeConflicts(a){const b=this.exclusiveFlags(a);if(b)for(const c in this.flags)this.flags.hasOwnProperty(c)&&(a=this.flags[c].filter((a)=>!b.test(c+a)),a.length?this.flags[c]=a:delete this.flags[c])}toStringKey(a){return REPEATABLE_FLAGS$$module$js$flagset.has(a)?[...this.flags[a]].sort().map((b)=>a+b).join(" "):a+[...this.flags[a]].sort().join("")}exclusiveFlags(a){if(a.startsWith("S"))return new RegExp(`S.*[${a.substring(1)}]`);const b=this.getFlagForName(a);if(null==
b)throw Error(`Unknown flag: ${a}`);return b.conflict}getFlagForName(a){return FLAGS$$module$js$flagset.find((b)=>a.startsWith(b.prefix)).flags.find((b)=>b.flag===a)}toString(){const a=Object.keys(this.flags);a.sort();return a.map((a)=>this.toStringKey(a)).join(" ")}}var module$js$flagset={};module$js$flagset.PRESETS=PRESETS$$module$js$flagset;module$js$flagset.FLAGS=FLAGS$$module$js$flagset;module$js$flagset.FlagSet=FlagSet$$module$js$flagset;const Edge$$module$js$graph={of:(...a)=>a.map((a)=>a.uid)};class Node$$module$js$graph{constructor(a,b){this.graph=a;this.name=b;this.uid=a.nodes.length;a.nodes.push(this)}get nodeType(){return"Node"}toString(){return`${this.nodeType} ${this.name}`}edges(a){return[]}write(){}}
class Graph$$module$js$graph{constructor(a){this.rom=a;this.nodes=[]}traverse({wanted:a,dfs:b=!1}={}){const c=new Deque$$module$js$util,d=new Map,e=new Map;for(var f of this.nodes)for(var g of f.edges()){var h=g.join(" ");for(let a=1;a<g.length;a++){const b=g[a];e.has(b)||e.set(b,new Map);e.get(b).set(h,g)}1===g.length&&(h=g[0],d.has(h)||(c.push(h),d.set(h,g)))}a=new Set((a||this.nodes).map((a)=>a instanceof Node$$module$js$graph?a.uid:a));for(f=new Map;a.size&&c.length;){g=b?c.pop():c.shift();a.delete(g);
a:for(const a of(e.get(g)||f).values())if(g=a[0],!d.has(g)){for(h=1;h<a.length;h++)if(!d.has(a[h]))continue a;d.set(g,a);c.push(g)}}return{path:[...d.values()].map(([a,...b])=>{const c=(a)=>[this.nodes[a]];return[a,[...c(a)," (",b.map((a)=>c(a).join("").replace(/\s+\(.*\)/,"")).join(", "),")"].join("")]}),seen:d,win:!a.size}}}
class SparseDependencyGraph$$module$js$graph{constructor(a){this.nodes=Array(a).fill(0).map(()=>new Map);this.finalized=Array(a).fill(!1)}addRoute(a){const b=a[0];if(this.finalized[b])throw Error(`Attempted to add a route for finalized node ${b}`);let c=new Set;for(let b=a.length-1;1<=b;b--)c.add(a[b]);for(;;){a=!1;for(var d of c){if(d===b)return[];if(this.finalized[d]){a=this.nodes[d];if(!a.size)return[];c.delete(d);if(1===a.size){for(const b of a.values().next().value)c.add(b);a=!0;break}d=new Map;
for(var e of a.values())for(var f of this.addRoute([b,...c,...e]))d.set(f.label,f);return[...d.values()]}}if(!a)break}e=[...c].sort();c=new Set(e);e=e.join(" ");f=this.nodes[b];if(f.has(e))return[];for(const [a,b]of f){if(containsAll$$module$js$graph(c,b))return[];containsAll$$module$js$graph(b,c)&&f.delete(a)}f.set(e,c);return[{target:b,deps:c,label:`${b}:${e}`}]}finalize(a){if(!this.finalized[a]){this.finalized[a]=!0;for(let b=0;b<this.nodes.length;b++){const c=this.nodes[b];if(c.size)for(const [d,
e]of c)if(e.has(a)){const a=this.finalized[b];this.finalized[b]=!1;c.delete(d);this.addRoute([b,...e.values()]);this.finalized[b]=a}}}}}const containsAll$$module$js$graph=(a,b)=>{if(a.size<b.size)return!1;for(const c of b)if(!a.has(c))return!1;return!0};var module$js$graph={};module$js$graph.Edge=Edge$$module$js$graph;module$js$graph.Node=Node$$module$js$graph;module$js$graph.Graph=Graph$$module$js$graph;module$js$graph.SparseDependencyGraph=SparseDependencyGraph$$module$js$graph;function seq$$module$js$rom$util(a,b=(a)=>a){return Array(a).fill(0).map((a,d)=>b(d))}function slice$$module$js$rom$util(a,b,c){return a.slice(b,b+c)}function tuple$$module$js$rom$util(a,b,c){return Array.from(a.slice(b,b+c))}function signed$$module$js$rom$util(a){return 128>a?a:a-256}function unsigned$$module$js$rom$util(a){return 0>a?a+256:a}function varSlice$$module$js$rom$util(a,b,c,d,e=Infinity,f){f||(f=(a)=>a);const g=[];for(;b+c<=e&&a[b]!==d;)g.push(f(a.slice(b,b+c))),b+=c;return g}
function addr$$module$js$rom$util(a,b,c=0){return(a[b]|a[b+1]<<8)+c}function group$$module$js$rom$util(a,b,c){c||(c=(a)=>a);return seq$$module$js$rom$util(Math.max(0,Math.floor(b.length/a)),(d)=>c(slice$$module$js$rom$util(b,d*a,a)))}function reverseBits$$module$js$rom$util(a){return 65793*(2050*a&139536|32800*a&558144)>>>16&255}function countBits$$module$js$rom$util(a){a-=a>>1&85;a=(a&51)+(a>>2&51);return a+(a>>4)&15}
function hex$$module$js$rom$util(a){return null!=a?a.toString(16).padStart(2,"0"):String(a)}function hex4$$module$js$rom$util(a){return a.toString(16).padStart(4,"0")}function hex5$$module$js$rom$util(a){return a.toString(16).padStart(5,"0")}function concatIterables$$module$js$rom$util(a){const b=[];for(const c of a)for(const a of c)b.push(a);return b}function readBigEndian$$module$js$rom$util(a,b){return a[b]<<8|a[b+1]}function readLittleEndian$$module$js$rom$util(a,b){return a[b+1]<<8|a[b]}
function readString$$module$js$rom$util(a,b,c=0){const d=[];for(;a[b]!=c;)d.push(a[b++]);return String.fromCharCode(...d)}function writeLittleEndian$$module$js$rom$util(a,b,c){a[b]=c&255;a[b+1]=c>>>8}function writeString$$module$js$rom$util(a,b,c){for(let d=0,e=c.length;d<e;d++)a[b+d]=c.charCodeAt(d)}function write$$module$js$rom$util(a,b,c){a.subarray(b,b+c.length).set(c)}
class FlagListType$$module$js$rom$util{constructor(a,b){this.last=a;this.clear=b}read(a,b=0){const c=[];for(;;){const e=a[b++];var d=a[b++];d|=(e&3)<<8;c.push(e&this.clear?~d:d);if(e&this.last)return c}}bytes(a){const b=[];for(let c=0;c<a.length;c++){let d=a[c];0>d&&(d=this.clear<<8|~d);c===a.length-1&&(d|=this.last<<8);b.push(d>>>8);b.push(d&255)}return b}write(a,b,c=0){b=this.bytes(b);for(let d=0;d<b.length;d++)a[d+c]=b[d]}}
const DIALOG_FLAGS$$module$js$rom$util=new FlagListType$$module$js$rom$util(64,128),ITEM_GET_FLAGS$$module$js$rom$util=new FlagListType$$module$js$rom$util(64,128),SPAWN_CONDITION_FLAGS$$module$js$rom$util=new FlagListType$$module$js$rom$util(128,32);
class DataTuple$$module$js$rom$util{constructor(a){this.data=a}[Symbol.iterator](){return this.data[Symbol.iterator]()}hex(){return Array.from(this.data,hex$$module$js$rom$util).join(" ")}clone(){return new this.constructor(this.data)}static make(a,b){const c=class extends DataTuple$$module$js$rom$util{constructor(b=Array(a).fill(0)){super(b)}static of(a){const b=new c;for(const [c,d]of Object.entries(a))b[c]=d;return b}static from(b,d=0){return new c(tuple$$module$js$rom$util(b,d,a))}},d={};for(const a in b)d[a]=
"function"===typeof b[a]?{value:b[a]}:b[a];Object.defineProperties(c.prototype,d);return c}static prop(...a){return{get(){let b=0;for(const [c,d=255,e=0]of a)b|=(this.data[c]&d)>>>(0>e?0:e)<<(0>e?-e:0);return b},set(b){for(const [c,d=255,e=0]of a)this.data[c]=this.data[c]&~d|b>>>(0>e?-e:0)<<(0>e?0:e)&d}}}static booleanProp(a){const b=DataTuple$$module$js$rom$util.prop(a);return{get(){return!!b.get.call(this)},set(a){b.set.call(this,+a)}}}}
const watchArray$$module$js$rom$util=(a,b)=>new Proxy(a,{get(a,d){let c=a[d];if("subarray"===d)return(c,d)=>{const e=a.subarray(c,d);return c<=b&&b<d?watchArray$$module$js$rom$util(e,b-c):e};if("set"===d)return(c)=>{console.log(`Setting overlapping array ${b}`);debugger;a.set(c)};"function"===typeof c&&(c=c.bind(a));return c},set(a,d,e,f){if(d==b){console.log(`Writing ${b.toString(16)}`);debugger}a[d]=e;return!0}});var module$js$rom$util={};module$js$rom$util.seq=seq$$module$js$rom$util;
module$js$rom$util.slice=slice$$module$js$rom$util;module$js$rom$util.tuple=tuple$$module$js$rom$util;module$js$rom$util.signed=signed$$module$js$rom$util;module$js$rom$util.unsigned=unsigned$$module$js$rom$util;module$js$rom$util.varSlice=varSlice$$module$js$rom$util;module$js$rom$util.addr=addr$$module$js$rom$util;module$js$rom$util.group=group$$module$js$rom$util;module$js$rom$util.reverseBits=reverseBits$$module$js$rom$util;module$js$rom$util.countBits=countBits$$module$js$rom$util;
module$js$rom$util.hex=hex$$module$js$rom$util;module$js$rom$util.hex4=hex4$$module$js$rom$util;module$js$rom$util.hex5=hex5$$module$js$rom$util;module$js$rom$util.concatIterables=concatIterables$$module$js$rom$util;module$js$rom$util.readBigEndian=readBigEndian$$module$js$rom$util;module$js$rom$util.readLittleEndian=readLittleEndian$$module$js$rom$util;module$js$rom$util.readString=readString$$module$js$rom$util;module$js$rom$util.writeLittleEndian=writeLittleEndian$$module$js$rom$util;
module$js$rom$util.writeString=writeString$$module$js$rom$util;module$js$rom$util.write=write$$module$js$rom$util;module$js$rom$util.FlagListType=FlagListType$$module$js$rom$util;module$js$rom$util.DIALOG_FLAGS=DIALOG_FLAGS$$module$js$rom$util;module$js$rom$util.ITEM_GET_FLAGS=ITEM_GET_FLAGS$$module$js$rom$util;module$js$rom$util.SPAWN_CONDITION_FLAGS=SPAWN_CONDITION_FLAGS$$module$js$rom$util;module$js$rom$util.DataTuple=DataTuple$$module$js$rom$util;module$js$rom$util.watchArray=watchArray$$module$js$rom$util;class TrackerNode$$module$js$nodes extends Node$$module$js$graph{constructor(a,b,c){super(a,c);this.type=b}get nodeType(){return"Tracker"}edges({}={}){return[]}}TrackerNode$$module$js$nodes.OFF_ROUTE=1;TrackerNode$$module$js$nodes.GLITCH=2;TrackerNode$$module$js$nodes.HARD=3;class Option$$module$js$nodes extends Node$$module$js$graph{constructor(a,b,c){super(a,b);this.value=c}get nodeType(){return"Option"}edges(){return this.value?[Edge$$module$js$graph.of(this)]:[]}}
class Slot$$module$js$nodes extends Node$$module$js$graph{constructor(a,b,c,d,e=[]){super(a,b);this.item=c;this.slots=e;this.isInvisible=this.requiresUnique=!1;this.slotName=b;this.slotIndex=d;this.slotType=c instanceof Magic$$module$js$nodes?"magic":"consumable";this.vanillaItemName=c.name;this.itemIndex=d}get nodeType(){return"Slot"}toString(){return`${super.toString()} [${this.vanillaItemName} $${this.slotIndex.toString(16).padStart(2,"0")}]`}edges(){return null!=this.item&&null!=this.itemIndex?
[Edge$$module$js$graph.of(this.item,this)]:[]}isFixed(){return!1}isMimic(){return 112<=this.itemIndex}requireUnique(){this.requiresUnique=!0;return this}canHoldMimic(){return this instanceof Chest$$module$js$nodes&&!this.isInvisible}needsChest(){const a=this.itemIndex;return 13<=a&&36>=a||38===a||72<a}isChest(){return(this instanceof Chest$$module$js$nodes||this instanceof BossDrop$$module$js$nodes)&&9!==this.slotIndex}get name2(){return this.item.name===this.vanillaItemName?this.name:`${this.item.name} [${this.vanillaItemName}]`}set(a,
b){this.item=a;this.itemIndex=b}write(){if(this.slots){var a=this.graph.rom;if(a)for(const b of this.slots)b(a,this)}}swap(a){const b=this.item,c=this.itemIndex;this.set(a.item,a.itemIndex);a.set(b,c)}key(){this.slotType="key";return this}bonus(){this.slotType="bonus";return this}direct(a){this.slots.push((b,c)=>{write$$module$js$nodes(b.prg,a,c.itemIndex)});return this}fromPerson(a,b,c=0){this.slots.push((a,e)=>{a.npcs[b].data[c]=e.itemIndex});return this}npcSpawn(a,b,c=0){this.slots.push((d,e)=>
{d=d.npcs[a].spawnConditions;null==b&&(b=getFirst$$module$js$nodes(d.keys()));d=d.get(b);if(!d)throw Error(`No spawn found for NPC $${hex$$module$js$rom$util(a)} @ $${hex$$module$js$rom$util(b)}`);d[c]=setItem$$module$js$nodes(d[c],e)});return this}dialog(a,b,c=0,d){this.slots.push((e,f)=>{e=e.npcs[a].localDialogs;null==b&&(b=getFirst$$module$js$nodes(e.keys()));e=e.get(b);if(!e)throw Error(`No dialog found for NPC $${hex$$module$js$rom$util(a)} @ $${hex$$module$js$rom$util(b)}`);e=e[c];if(!e)throw Error(`No such dialog ${c}`);
null==d?e.condition=setItem$$module$js$nodes(e.condition,f):e.flags[d]=setItem$$module$js$nodes(e.flags[d],f)});return this}trigger(a,b=0,c){this.slots.push((d,e)=>{d=d.triggers[a&127];null==c?d.conditions[b]=setItem$$module$js$nodes(d.conditions[b],e):d.flags[c]=setItem$$module$js$nodes(d.flags[c],e)});return this}}class FixedSlot$$module$js$nodes extends Slot$$module$js$nodes{isFixed(){return!0}}class BossDrop$$module$js$nodes extends Slot$$module$js$nodes{get nodeType(){return"BossDrop"}}
class Chest$$module$js$nodes extends Slot$$module$js$nodes{constructor(a,b,c,d){super(a,b,c,d);this.spawnSlot=null;this.isInvisible=!1}get nodeType(){return"Chest"}objectSlot(a,b){this.spawnSlot=b;this.slots.push((c,d)=>{c=c.locations[a];if(!c||!c.used)throw Error(`No such location: $${hex$$module$js$rom$util(a)}`);c=c.spawns[b-13];if(!c||!c.isChest())throw Error(`No chest $${hex$$module$js$rom$util(b)} on $${hex$$module$js$rom$util(a)}`);c.timed=!1;c.id=Math.min(d.itemIndex,112)});return this}invisible(a){this.isInvisible=
!0;return this.direct(a)}}
class ItemGet$$module$js$nodes extends Node$$module$js$graph{constructor(a,b,c){super(a,c);this.id=b;this.shufflePriority=1;this.inventoryRow="unique"}get nodeType(){return"ItemGet"}chest(a=this.name+" chest",b=this.id){return new Chest$$module$js$nodes(this.graph,a,this,b)}fromPerson(a,b,c=0){return new Slot$$module$js$nodes(this.graph,a,this,this.id,[(a,e)=>{a.npcs[b].data[c]=e.itemIndex}])}bossDrop(a,b,c=this.id){return new BossDrop$$module$js$nodes(this.graph,a,this,c,[(a,c)=>{a.bossKills[b].itemDrop=
c.itemIndex}])}direct(a,b){return new Slot$$module$js$nodes(this.graph,a,this,this.id,[(a,d)=>{write$$module$js$nodes(a.prg,b,d.itemIndex)}])}fixed(){return new FixedSlot$$module$js$nodes(this.graph,this.name,this,this.id)}weight(a){this.shufflePriority=a;return this}consumable(){this.inventoryRow="consumable";return this}armor(){this.inventoryRow="armor";return this}}class Item$$module$js$nodes extends ItemGet$$module$js$nodes{get nodeType(){return"Item"}}
class Magic$$module$js$nodes extends ItemGet$$module$js$nodes{get nodeType(){return"Magic"}}class Trigger$$module$js$nodes extends Node$$module$js$graph{constructor(a,b){super(a,b);this.slot=null;this.reqs=[]}get nodeType(){return"Trigger"}edges(){const a=[...this.reqs];this.slot&&a.push(Edge$$module$js$graph.of(this.slot,this));return a}get(a){if(this.slot)throw Error("already have a slot");this.slot=a;return this}}
class Condition$$module$js$nodes extends Node$$module$js$graph{constructor(a,b){super(a,b);this.options=[]}get nodeType(){return"Condition"}edges(){return this.options.map((a)=>Edge$$module$js$graph.of(this,...a))}option(...a){this.options.push(a.map((a)=>a instanceof Slot$$module$js$nodes?a.item:a));return this}}
class Boss$$module$js$nodes extends Trigger$$module$js$nodes{constructor(a,b,c,...d){super(a,c);this.index=b;this.deps=d.map((a)=>a instanceof Slot$$module$js$nodes?a.item:a)}get nodeType(){return"Boss"}}class Area$$module$js$nodes extends Node$$module$js$graph{get nodeType(){return"Area"}}
class Connection$$module$js$nodes{constructor(a,b,c=!1,d=[]){this.from=a;this.to=b;this.bidi=c;this.deps=d.map((a)=>a instanceof Slot$$module$js$nodes?a.item:a)}reverse(){return new Connection$$module$js$nodes(this.to,this.from,this.bidi,this.deps)}}
class Location$$module$js$nodes extends Node$$module$js$graph{constructor(a,b,c,d){super(a,c.name+": "+d);this.id=b;this.area=c;this.connections=[];this.chests=[];this.type=this.bossNode=null;this.isEnd=this.isStart=!1;this.sells=[];this.simpleName=d}get nodeType(){return"Location"}toString(){return`Location ${this.id.toString(16).padStart(2,"0")} ${this.name}`}edges(){const a=[];for(const b of this.connections)a.push(Edge$$module$js$graph.of(b.to,b.from,...b.deps,...b.from.bossNode?[b.from.bossNode]:
[])),b.bidi&&a.push(Edge$$module$js$graph.of(b.from,b.to,...b.deps,...b.to.bossNode?[b.to.bossNode]:[]));for(const b of this.chests)a.push(Edge$$module$js$graph.of(b,this));this.isStart&&a.push(Edge$$module$js$graph.of(this));return a}addConnection(a){a.from.connections.push(a);a.to.connections.push(a);return this}from(a,...b){return this.addConnection(new Connection$$module$js$nodes(a,this,!1,b))}to(a,...b){return this.addConnection(new Connection$$module$js$nodes(this,a,!1,b))}connect(a,...b){return this.addConnection(new Connection$$module$js$nodes(a,
this,!0,b))}connectTo(a,...b){return this.addConnection(new Connection$$module$js$nodes(this,a,!0,b))}chest(a,b,c){a instanceof Slot$$module$js$nodes&&!(a instanceof Chest$$module$js$nodes)&&null!=c&&(a=a.item);a instanceof ItemGet$$module$js$nodes&&(a=a.chest(void 0,c));b=a.objectSlot(this.id,b);this.chests.push(b);112<=b.itemIndex&&(b.slotType="trap");if(!b.slotName||b.slotName.endsWith(" chest"))b.slotName=a.name+" in "+this.area.name;return this}trigger(a,...b){b=b.map((a)=>a instanceof Slot$$module$js$nodes?
a.item:a);a.reqs.push(Edge$$module$js$graph.of(a,this,...b));return this}boss(a){this.bossNode=a;a.reqs.push(Edge$$module$js$graph.of(a,this,...a.deps));return this}overworld(){this.type="overworld";return this}town(){this.type="town";return this}cave(){this.type="cave";return this}sea(){this.type="sea";return this}fortress(){this.type="fortress";return this}house(){this.type="house";return this}shop(...a){this.type="house";this.sells=a.map((a)=>a instanceof Slot$$module$js$nodes?a.item:a);return this}misc(){this.type=
"misc";return this}start(){this.isStart=!0;return this}end(){this.isEnd=!0;return this}fullName(){const a=[this.simpleName];this.bossNode&&a.push(this.bossNode.name);return a.join("\\n")}write(){if(this.sells.length){var a=this.graph.rom;if(!a)throw Error("Cannot write without a rom");for(const b of a.shops)if(b.location===this.id)for(a=0;4>a;a++)b.contents[a]=this.sells[a]?this.sells[a].id:255}}}
class WorldGraph$$module$js$nodes extends Graph$$module$js$graph{write(){for(const a of this.nodes)a.write()}shuffleShops(a){const b={shops:[],items:[]},c={shops:[],items:[]};for(var d of this.nodes)if(d instanceof Location$$module$js$nodes&&d.sells.length){var e="armor"===d.sells[0].inventoryRow?b:c;e.shops.push(d);for(let a=0;4>a;a++)e.items.push(d.sells[a]||null);d.sells=[]}a.shuffle(b.items);a.shuffle(c.items);for(const {shops:f,items:g}of[b,c])for(a=0;g.length&&1E5>a;)d=g.pop(),e=f[a++%f.length],
d&&(0<=e.sells.indexOf(d)||4<=e.sells.length?g.push(d):e.sells.push(d));for(const {shops:a}of[b,c])for(const b of a)b.sells.sort((a,b)=>a.id-b.id)}integrate({tracker:a=!1}={}){var b=!a;const c=new SparseDependencyGraph$$module$js$graph(this.nodes.length);var d=[],e=[];const f=new Set,g=new Map;var h=[];const k=[],l=[],m=[],n=[],p=new Set;for(const a of this.nodes)if(a instanceof Location$$module$js$nodes){if(a.isStart){const [b]=c.addRoute([a.uid]);g.set(b.label,b)}d[a.uid]=[];e[a.uid]=[];for(const b of a.connections)f.has(b)||
(f.add(b),b.bidi&&f.add(b.reverse()));for(const b of a.chests)c.addRoute([b.uid,a.uid])}else if(a instanceof ItemGet$$module$js$nodes&&"Medical Herb"===a.name&&(c.addRoute([a.uid]),c.finalize(a.uid)),a instanceof Option$$module$js$nodes)h.push(a);else if(a instanceof TrackerNode$$module$js$nodes)k.push(a);else if(a instanceof Condition$$module$js$nodes)l.push(a);else if(a instanceof Trigger$$module$js$nodes)m.push(a);else if(a instanceof ItemGet$$module$js$nodes)n.push(a);else if(a instanceof Slot$$module$js$nodes)p.add(a);
else if(!(a instanceof Area$$module$js$nodes))throw Error(`Unknown node type: ${a.nodeType}`);for(const a of f)d[a.from.uid].push(a),e[a.to.uid].push(a);e=(b)=>{for(const d of b){for(const b of d.edges({tracker:a}))c.addRoute(b);c.finalize(d.uid)}};e(h);b&&e(k);e(m);for(const a of g.values()){b=a.target;for(const e of d[b]){b=[e.to.uid,...a.deps];for(h=e.deps.length-1;0<=h;h--)b.push(e.deps[h].uid);e.from.bossNode&&b.push(e.from.bossNode.uid);for(const a of c.addRoute(b))g.has(a.label)||g.set(a.label,
a)}}e(l);for(d=0;d<this.nodes.length;d++)this.nodes[d]instanceof ItemGet$$module$js$nodes||this.nodes[d]instanceof TrackerNode$$module$js$nodes||c.finalize(d);d=new LocationList$$module$js$nodes(this);for(const a of p)for(const b of c.nodes[a.uid].values())d.addRoute([a.uid,...b]);return d}}
class LocationList$$module$js$nodes{constructor(a){this.worldGraph=a;this.uidToLocation=[];this.locationToUid=[];this.uidToItem=[];this.itemToUid=[];this.routes=[];this.unlocks=[];this.win=null}item(a){return this.worldGraph.nodes[this.itemToUid[a]]}location(a){return this.worldGraph.nodes[this.locationToUid[a]]}addRoute(a){let b=Bits$$module$js$bits.of(),c=-1;const d=[];for(let f=a.length-1;0<=f;f--){var e=f?this.uidToItem:this.uidToLocation;const g=f?this.itemToUid:this.locationToUid,h=a[f];let k=
e[h];null==k&&(k=g.length,g.push(h),e[h]=k,e=this.worldGraph.nodes[h],!f&&e instanceof Slot$$module$js$nodes&&e.isFixed()&&(this.win=k));f?(b=Bits$$module$js$bits.with(b,k),d.push(this.unlocks[k]||(this.unlocks[k]=new Set))):c=k}(this.routes[c]||(this.routes[c]=[])).push(b);for(const a of d)a.add(c)}canReach(a,b){a=this.routes[this.uidToLocation[a.uid]];for(let c=0,d=a.length;c<d;c++)if(Bits$$module$js$bits.containsAll(b,a[c]))return!0;return!1}traverse(a=Bits$$module$js$bits.of(),b=[]){a=Bits$$module$js$bits.clone(a);
const c=new Set,d=new Set;for(var e=0;e<this.locationToUid.length;e++)d.add(e);for(const f of d)if(d.delete(f),!c.has(f)){e=this.routes[f];for(let g=0,h=e.length;g<h;g++)if(Bits$$module$js$bits.containsAll(a,e[g])){c.add(f);if(b[f]){a=Bits$$module$js$bits.with(a,b[f]);for(const a of this.unlocks[b[f]])d.add(a)}break}}return c}traverseDepths(a){let b=Bits$$module$js$bits.of(),c=0;const d=[],e={},f=new Set;for(var g=0;g<this.locationToUid.length;g++)f.add(g);f.add(e);for(const h of f)if(f.delete(h),
"number"!==typeof h)f.size&&f.add(e),c++;else if(null==d[h]){g=this.routes[h];for(let e=0,l=g.length;e<l;e++)if(Bits$$module$js$bits.containsAll(b,g[e])){d[h]=c;if(a[h]){b=Bits$$module$js$bits.with(b,a[h]);for(const b of this.unlocks[a[h]])f.add(b)}break}}return d}toString(){const a=[];for(let b=0;b<this.routes.length;b++){const c=this.location(b),d=this.routes[b],e=[];for(let a=0,b=d.length;a<b;a++){const b=[];for(const c of Bits$$module$js$bits.bits(d[a]))b.push(this.item(c));e.push("("+b.join(" & ")+
")")}a.push(`${c}: ${e.join(" | ")}`)}return a.join("\n")}assumedFill(a,b=(a,b)=>!0,c=FillStrategy$$module$js$nodes){const d=c.shuffleItems(this.itemToUid.map((a)=>this.worldGraph.nodes[a]),a);let e=Bits$$module$js$bits.from(d);const f=Array(this.locationToUid.length).fill(null);for(;d.length;){const g=d.pop();if(!Bits$$module$js$bits.has(e,g))continue;const h=this.item(g);e=Bits$$module$js$bits.without(e,g);const k=[...this.traverse(e,f)].filter((a)=>null==f[a]);c.shuffleSlots(h,k,a);let l=!1;for(const a of k)if(null==
f[a]&&a!==this.win&&b(this.location(a),h)){if(100<a)throw Error("Something went horribly wrong");f[a]=g;l=!0;break}if(!l)return null}return f}}const FillStrategy$$module$js$nodes={shuffleSlots:(a,b,c)=>{c.shuffle(b)},shuffleItems:(a,b)=>{const c=[];for(let b=0;b<a.length;b++){const {shufflePriority:d=1}=a[b];for(let a=0;a<d;a++)c.push(b)}b.shuffle(c);return c}},write$$module$js$nodes=(a,b,c)=>{a[b]=c};function getFirst$$module$js$nodes(a){for(const b of a)return b;throw Error("Empty iterable");}
function setItem$$module$js$nodes(a,b){return 0>a?~(512|b.itemIndex):512|b.itemIndex}var module$js$nodes={};module$js$nodes.TrackerNode=TrackerNode$$module$js$nodes;module$js$nodes.Option=Option$$module$js$nodes;module$js$nodes.Slot=Slot$$module$js$nodes;module$js$nodes.FixedSlot=FixedSlot$$module$js$nodes;module$js$nodes.BossDrop=BossDrop$$module$js$nodes;module$js$nodes.Chest=Chest$$module$js$nodes;module$js$nodes.ItemGet=ItemGet$$module$js$nodes;module$js$nodes.Item=Item$$module$js$nodes;
module$js$nodes.Magic=Magic$$module$js$nodes;module$js$nodes.Trigger=Trigger$$module$js$nodes;module$js$nodes.Condition=Condition$$module$js$nodes;module$js$nodes.Boss=Boss$$module$js$nodes;module$js$nodes.Area=Area$$module$js$nodes;module$js$nodes.Connection=Connection$$module$js$nodes;module$js$nodes.Location=Location$$module$js$nodes;module$js$nodes.WorldGraph=WorldGraph$$module$js$nodes;module$js$nodes.LocationList=LocationList$$module$js$nodes;module$js$nodes.FillStrategy=FillStrategy$$module$js$nodes;const generate$$module$js$depgraph=(a,b)=>{a=void 0===a?new FlagSet$$module$js$flagset:a;const c=new WorldGraph$$module$js$nodes(b),d=(a,b)=>new Option$$module$js$nodes(c,a,void 0===b?!0:b),e=(a,b,...d)=>new Boss$$module$js$nodes(c,a,b,...d),f=new TrackerNode$$module$js$nodes(c,TrackerNode$$module$js$nodes.GLITCH,"Glitch"),g=new TrackerNode$$module$js$nodes(c,TrackerNode$$module$js$nodes.HARD,"Hard"),h=(a,b,c)=>a.value?a:f,k=d("Leather Boots grant speed",a.leatherBootsGiveSpeed()),l=h(d("Assume ghetto flight",
a.assumeGhettoFlight())),m=h(d("Assume statue glitch",a.assumeStatueGlitch())),n=d("Allow statue glitch",!a.disableStatueGlitch()),p=h(d("Assume teleport skip",a.assumeTeleportSkip())),q=d("Allow teleport skip",!a.disableTeleportSkip()),r=h(d("Assume rabbit skip",a.assumeRabbitSkip())),v=h(d("Allow rabbit skip",!a.disableRabbitSkip())),t=h(d("Assume sword charge glitch",a.assumeSwordChargeGlitch())),w=d("Allow sword charge glitch",!a.disableSwordChargeGlitch()),D=h(d("Assume wild warp",a.assumeWildWarp())),
E=d("Allow wild warp",a.allowWildWarp()),u=d("Sword magic optional",!a.guaranteeSwordMagic()),z=d("Matching sword optional",!a.guaranteeMatchingSword()),Y=d("Gas mask optional",!a.guaranteeGasMask()),Z=d("Healed dolphin optional",!a.requireHealedDolphinToRide()),Qd=d("Calm sea optional",!a.barrierRequiresCalmSea()),Rd=d("Prison key optional",!a.paralysisRequiresPrisonKey()),Sd=d("Windmill optional",!a.sealedCaveRequiresWindmill()),Td=d("Sword of Thunder teleports to Shyron",a.teleportOnThunderSword()),
Xb=d("Barrier magic optional",!a.guaranteeBarrier()),Yb=d("Refresh magic optional",!a.guaranteeRefresh()),Ud=d("Telepathy optional for Deo",!a.saharaRabbitsRequireTelepathy()),Vd=d("Lime Tree connects to Leaf",a.connectLimeTreeToLeaf()),Wd=d("Buffed medical herb",a.buffMedicalHerb()),Sa=d("Orbs optional",a.orbsOptional()),S=(new Item$$module$js$nodes(c,0,"Sword of Wind")).weight(a.guaranteeSword()?10:5).fromPerson("Leaf elder",13).npcSpawn(94,16,1).dialog(13,192,2).key(),T=(new Item$$module$js$nodes(c,
1,"Sword of Fire")).weight(a.guaranteeSword()?10:5).fromPerson("Oak elder",29).dialog(29,void 0,3).key(),O=(new Item$$module$js$nodes(c,2,"Sword of Water")).weight(10).chest().key(),M=(new Item$$module$js$nodes(c,3,"Sword of Thunder")).weight(15).chest().key(),qb=(new Item$$module$js$nodes(c,4,"Crystalis")).fixed(),Ka=(new Item$$module$js$nodes(c,5,"Ball of Wind")).chest().key(),La=(new Item$$module$js$nodes(c,6,"Tornado Bracelet")).chest().key(),Ta=(new Item$$module$js$nodes(c,7,"Ball of Fire")).bossDrop("Insect",
1).dialog(30,void 0,2).dialog(32,void 0,0).dialog(33,void 0,0).dialog(34,void 0,0).dialog(96,30,0).dialog(29,void 0,2).dialog(31,void 0,1).npcSpawn(193).key(),Ua=(new Item$$module$js$nodes(c,8,"Flame Bracelet")).bossDrop("Kelbesque 1",2).npcSpawn(194).key(),Va=(new Item$$module$js$nodes(c,9,"Ball of Water")).weight(5).direct("Rage",250679).npcSpawn(195).key(),Wa=(new Item$$module$js$nodes(c,10,"Blizzard Bracelet")).weight(5).chest().key(),Xa=(new Item$$module$js$nodes(c,11,"Ball of Thunder")).bossDrop("Mado 1",
5).trigger(154,1).key(),Ya=(new Item$$module$js$nodes(c,12,"Storm Bracelet")).chest().key(),Zb=(new Item$$module$js$nodes(c,13,"Carapace Shield")).armor(),Xd=(new Item$$module$js$nodes(c,14,"Bronze Shield")).armor(),$b=(new Item$$module$js$nodes(c,15,"Platinum Shield")).armor(),ac=(new Item$$module$js$nodes(c,16,"Mirrored Shield")).armor(),Yd=(new Item$$module$js$nodes(c,17,"Ceramic Shield")).armor(),rb=(new Item$$module$js$nodes(c,18,"Sacred Shield")).armor().bossDrop("Mado 2",8).npcSpawn(199).bonus(),
bc=(new Item$$module$js$nodes(c,19,"Battle Shield")).armor(),Zd=(new Item$$module$js$nodes(c,20,"Psycho Shield")).armor(),$d=(new Item$$module$js$nodes(c,21,"Tanned Hide")).armor(),ae=(new Item$$module$js$nodes(c,22,"Leather Armor")).armor(),be=(new Item$$module$js$nodes(c,23,"Bronze Armor")).armor(),cc=(new Item$$module$js$nodes(c,24,"Platinmum Armor")).armor(),ce=(new Item$$module$js$nodes(c,25,"Soldier Suit")).armor(),dc=(new Item$$module$js$nodes(c,26,"Ceramic Suit")).armor(),de=(new Item$$module$js$nodes(c,
27,"Battle Suit")).armor(),ee=(new Item$$module$js$nodes(c,28,"Psycho Armor")).armor().bossDrop("Draygon 1",10).npcSpawn(203).trigger(159).npcSpawn(131).key(),J=(new Item$$module$js$nodes(c,29,"Medical Herb")).consumable(),N=(new Item$$module$js$nodes(c,30,"Antidote")).consumable(),ya=(new Item$$module$js$nodes(c,31,"Lysis Plant")).consumable(),sb=(new Item$$module$js$nodes(c,32,"Fruit of Lime")).consumable(),P=(new Item$$module$js$nodes(c,33,"Fruit of Power")).consumable(),aa=(new Item$$module$js$nodes(c,
34,"Magic Ring")).consumable(),tb=(new Item$$module$js$nodes(c,35,"Fruit of Repun")).consumable().bossDrop("Sabera 2",7).npcSpawn(198).key(),U=(new Item$$module$js$nodes(c,36,"Warp Boots")).consumable(),ec=(new Item$$module$js$nodes(c,37,"Statue of Onyx")).chest("Cordel grass").invisible(254882).key(),ub=(new Item$$module$js$nodes(c,38,"Opel Statue")).consumable().bossDrop("Kelbesque 2",6).npcSpawn(197).key(),fc=(new Item$$module$js$nodes(c,39,"Insect Flute")).fromPerson("Oak mother",30).dialog(30,
void 0,1).key(),vb=(new Item$$module$js$nodes(c,40,"Flute of Lime")).fromPerson("Portoa queen",56).fromPerson("Asina secondary",98,1).dialog(56,void 0,4).key(),Za=(new Item$$module$js$nodes(c,41,"Gas Mask")).direct("Akahana in Brynmaer",251902).npcSpawn(22,24).key(),fe=(new Item$$module$js$nodes(c,42,"Power Ring")).chest().bonus(),ge=(new Item$$module$js$nodes(c,43,"Warrior Ring")).fromPerson("Akahana's friend",84).dialog(84,void 0,2).bonus(),he=(new Item$$module$js$nodes(c,44,"Iron Necklace")).chest().bonus(),
ie=(new Item$$module$js$nodes(c,45,"Deo's Pendant")).fromPerson("Deo",90).dialog(90,void 0,0).bonus(),wb=(new Item$$module$js$nodes(c,46,"Rabbit Boots")).bossDrop("Vampire 1",0).npcSpawn(192).key(),gc=((a,b)=>new Item$$module$js$nodes(c,a,b))(47,a.leatherBootsGiveSpeed()?"Speed Boots":"Leather Boots").chest().bonus(),hc=(new Item$$module$js$nodes(c,48,"Shield Ring")).direct("Akahana in waterfall cave",250543).bonus(),xb=(new Item$$module$js$nodes(c,49,"Alarm Flute")).fromPerson("Zebu's student",20,
1).key(),ic=(new Item$$module$js$nodes(c,50,"Windmill Key")).fromPerson("Windmill guard",20).dialog(20,14,0).npcSpawn(20,14,1).key(),yb=(new Item$$module$js$nodes(c,51,"Key to Prison")).chest().key(),jc=(new Item$$module$js$nodes(c,52,"Key to Styx")).fromPerson("Zebu in Shyron",94,1).trigger(128,2).dialog(94,242,0).dialog(98,242,0).key(),kc=(new Item$$module$js$nodes(c,53,"Fog Lamp")).chest().key(),zb=(new Item$$module$js$nodes(c,54,"Shell Flute")).fromPerson("Dolphin",99,1).npcSpawn(99).key(),lc=
(new Item$$module$js$nodes(c,55,"Eye Glasses")).fromPerson("Clark",68).dialog(68,233,1).key(),mc=(new Item$$module$js$nodes(c,56,"Broken Statue")).bossDrop("Sabera 1",4).npcSpawn(127,101).npcSpawn(9).npcSpawn(10).npcSpawn(69).npcSpawn(70).npcSpawn(71).npcSpawn(132).npcSpawn(142).dialog(61).dialog(62).dialog(63).dialog(64).dialog(65).dialog(66).dialog(67).dialog(68,233).trigger(182).key(),nc=(new Item$$module$js$nodes(c,57,"Glowing Lamp")).direct("Kensu in lighthouse",250638).npcSpawn(126,98,1).key(),
oc=(new Item$$module$js$nodes(c,59,"Love Pendant")).chest("Underground channel").invisible(254890).key(),pc=(new Item$$module$js$nodes(c,60,"Kirisa Plant")).chest("Kirisa meadow").invisible(254886).key(),Ab=(new Item$$module$js$nodes(c,61,"Ivory Statue")).bossDrop("Karmine",9).npcSpawn(200).key(),qc=(new Item$$module$js$nodes(c,62,"Bow of Moon")).fromPerson("Aryllis",35).direct(251624).dialog(35,void 0,1).key(),rc=(new Item$$module$js$nodes(c,63,"Bow of Sun")).chest().key(),sc=(new Item$$module$js$nodes(c,
64,"Bow of Truth")).fromPerson("Azteca",131).npcSpawn(131,156,1).dialog(131,void 0,0).key(),$a=(new Magic$$module$js$nodes(c,65,"Refresh")).fromPerson("Zebu at windmill",94).requireUnique().direct(251665).dialog(94,16,3).trigger(180,1),Ma=(new Magic$$module$js$nodes(c,66,"Paralysis")).direct("Zebu at Mt. Sabre summit",251477).requireUnique().trigger(141).trigger(178),ka=(new Magic$$module$js$nodes(c,67,"Telepathy")).direct("Tornel at Stom's house",223220).npcSpawn(95,30,1).trigger(133,1),tc=(new Magic$$module$js$nodes(c,
68,"Teleport")).fromPerson("Tornel on Mt. Sabre",95).dialog(95,33,0),je=(new Magic$$module$js$nodes(c,69,"Recover")).direct("Asina in Portoa",250361),uc=(new Magic$$module$js$nodes(c,70,"Barrier")).direct("Asina on Angry sea",251609).requireUnique().trigger(132,0),sa=(new Magic$$module$js$nodes(c,71,"Change")).direct("Kensu in Swan",251614).npcSpawn(116,241,1).npcSpawn(126,241,1),G=(new Magic$$module$js$nodes(c,72,"Flight")).weight(15).direct("Kensu in Draygonia Fortress",250255),ke=P.bossDrop("Vampire 2",
12,97).npcSpawn(204).key(),Q=new Item$$module$js$nodes(c,112,"Mimic"),vc=(new Trigger$$module$js$nodes(c,"Talked to Leaf Elder")).get(S),wc=(new Trigger$$module$js$nodes(c,"Talked to Leaf Student")).get(xb),Bb=new Trigger$$module$js$nodes(c,"Talked to Zebu in cave"),le=(new Trigger$$module$js$nodes(c,"Woke up Windmill Guard")).get(ic),Na=new Trigger$$module$js$nodes(c,"Started Windmill"),xc=(new Trigger$$module$js$nodes(c,"Learned Refresh")).get($a),me=(new Trigger$$module$js$nodes(c,"Gave Statue to Akahana")).get(Za),
ne=(new Trigger$$module$js$nodes(c,"Fought Stom")).get(ka),yc=new Trigger$$module$js$nodes(c,"Visited Oak"),zc=new Trigger$$module$js$nodes(c,"Talked to Oak Mother"),Cb=new Trigger$$module$js$nodes(c,"Rescued Oak Child"),oe=(new Trigger$$module$js$nodes(c,"Talked to Oak Mother Again")).get(fc),pe=(new Trigger$$module$js$nodes(c,"Talked to Oak Elder")).get(T),qe=(new Trigger$$module$js$nodes(c,"Talked to Tornel on Mt Sabre")).get(tc),Ac=new Trigger$$module$js$nodes(c,"Villagers Abducted"),Bc=new Trigger$$module$js$nodes(c,
"Talked to Rabbit in Leaf"),re=(new Trigger$$module$js$nodes(c,"Learned Paralysis")).get(Ma),Cc=new Trigger$$module$js$nodes(c,"Talked to Portoa Queen"),Dc=new Trigger$$module$js$nodes(c,"Talked to Fortune Teller"),Ec=new Trigger$$module$js$nodes(c,"Visited Underground Channel"),se=(new Trigger$$module$js$nodes(c,"Sent to Waterfall Cave")).get(vb),te=(new Trigger$$module$js$nodes(c,"Cured Akahana")).get(hc),Fc=(new Trigger$$module$js$nodes(c,"Talked to Rage")).get(Va),Gc=new Trigger$$module$js$nodes(c,
"Mesia recording played"),Hc=(new Trigger$$module$js$nodes(c,"Talked to Asina")).get(je),Ic=(new Trigger$$module$js$nodes(c,"Healed Dolphin")).get(zb),Db=new Trigger$$module$js$nodes(c,"Returned Fog Lamp"),Jc=new Trigger$$module$js$nodes(c,"Talked to Kensu in Cabin"),Kc=new Trigger$$module$js$nodes(c,"Talked to Joel Elder"),ue=(new Trigger$$module$js$nodes(c,"Talked to Clark")).get(lc),ve=(new Trigger$$module$js$nodes(c,"Talked to Kensu in Lighthouse")).get(nc),Eb=new Trigger$$module$js$nodes(c,"Calmed the Angry Sea"),
we=(new Trigger$$module$js$nodes(c,"Learned Barrier")).get(uc),Lc=new Trigger$$module$js$nodes(c,"Talked to Stom in Swan Hut"),Mc=new Trigger$$module$js$nodes(c,"Talked to Kensu in Swan tavern"),Nc=new Trigger$$module$js$nodes(c,"Talked to Kensu at Swan dance"),xe=(new Trigger$$module$js$nodes(c,"Returned Kensu's love pendant")).get(sa),ye=(new Trigger$$module$js$nodes(c,"Talked to Amazones Queen")).get(qc),Fb=new Trigger$$module$js$nodes(c,"Entered Shyron"),ze=(new Trigger$$module$js$nodes(c,"Talked to Zebu in Shyron")).get(jc),
Oc=new Trigger$$module$js$nodes(c,"Shyron Massacre"),Ae=(new Trigger$$module$js$nodes(c,"Saved Kensu")).get(G),Be=(new Trigger$$module$js$nodes(c,"Talked to Deo")).get(ie),Ce=(new Trigger$$module$js$nodes(c,"Talked to Akahana's Friend")).get(ge),De=(new Trigger$$module$js$nodes(c,"Get Bow of Truth")).get(sc),Ee=(new Trigger$$module$js$nodes(c,"Forged Crystalis")).get(qb),ab=(new Condition$$module$js$nodes(c,"Sword charge glitch")).option(t,w),Fe=(new Condition$$module$js$nodes(c,"Rabbit skip")).option(r,
v),Ge=(new Condition$$module$js$nodes(c,"Teleport skip")).option(p,q),bb=(new Condition$$module$js$nodes(c,"Statue glitch")).option(m,n),He=(new Condition$$module$js$nodes(c,"Wild warp")).option(D,E),cb=(new Condition$$module$js$nodes(c,"Any level 2 sword")).option(S,Ka).option(S,La).option(T,Ta).option(T,Ua).option(O,Va).option(O,Wa).option(M,Xa).option(M,Ya),A=(new Condition$$module$js$nodes(c,"Destroy stone")).option(S,Sa).option(S,Ka).option(S,La).option(ab,S,cb),B=(new Condition$$module$js$nodes(c,
"Destroy ice")).option(T,Sa).option(T,Ta).option(T,Ua).option(ab,T,cb),x=(new Condition$$module$js$nodes(c,"Cross rivers")).option(O,Sa).option(O,Va).option(O,Wa).option(G).option(ab,O,cb),za=(new Condition$$module$js$nodes(c,"Destroy iron")).option(M,Sa).option(M,Xa).option(M,Ya).option(ab,M,cb),V=(new Condition$$module$js$nodes(c,"Any sword")).option(S).option(T).option(O).option(M),Ie=(new Condition$$module$js$nodes(c,"Match insect sword (fire/water/thunder)")).option(T).option(O).option(M).option(Za,
z.value?z:g,S),Je=(new Condition$$module$js$nodes(c,"Match vampire 2 sword (wind/water/thunder)")).option(S).option(O).option(M).option(z.value?z:g,T),Pc=(new Condition$$module$js$nodes(c,"Speed boots")).option(gc,k),Qc=(new Condition$$module$js$nodes(c,"Climb slopes")).option(wb).option(G).option(Pc),Ke=(new Condition$$module$js$nodes(c,"Enter Mt Sabre North (rabbit)")).option(Bc).option(Fe),Le=(new Condition$$module$js$nodes(c,"Enter Mt Sabre North (Teleport)")).option(tc).option(Ge,G),Rc=(new Condition$$module$js$nodes(c,
"Asina in her room")).option(Gc),Me=(new Condition$$module$js$nodes(c,"Paralysis or Asina revealed")).option(Ma).option(Rc).option(bb),Sc=(new Condition$$module$js$nodes(c,"Ride dolphin")).option(zb,Jc),Ne=(new Condition$$module$js$nodes(c,"Ghetto flight")).option(l,Sc,wb),fa=(new Condition$$module$js$nodes(c,"Cross sea")).option(Sc).option(G),Oe=(new Condition$$module$js$nodes(c,"Cross whirlpool")).option(Eb).option(G).option(Ne),W=(new Condition$$module$js$nodes(c,"Refresh if needed")).option(Yb.value?
Yb:g).option($a),Tc=(new Condition$$module$js$nodes(c,"Wind magic")).option(u.value?u:g,W).option(Ka,La,W),Uc=(new Condition$$module$js$nodes(c,"Fire magic")).option(u.value?u:g,W).option(Ta,Ua,W),Vc=(new Condition$$module$js$nodes(c,"Water magic")).option(u.value?u:g,W).option(u,W).option(Va,Wa,W),Pe=(new Condition$$module$js$nodes(c,"Thunder magic")).option(u.value?u:g,W).option(u,W).option(Xa,W).option(Ya,W),Qe=(new Condition$$module$js$nodes(c,"Flute of lime or glitch")).option(vb).option(bb),
Re=(new Condition$$module$js$nodes(c,"Change or glitch")).option(sa).option(bb),Se=(new Condition$$module$js$nodes(c,"Change or glitch or paralysis")).option(sa).option(bb).option(Ma),Gb=(new Condition$$module$js$nodes(c,"Pass shooting statues")).option(uc).option(V,Xb.value?Xb:g).option($a,hc),Te=(new Condition$$module$js$nodes(c,"Healed dolphin if required")).option(Ic).option(Z),Wc=(new Condition$$module$js$nodes(c,"Match sword of wind")).option(S).option(z.value?z:g,V),Xc=(new Condition$$module$js$nodes(c,
"Match sword of fire")).option(T).option(z.value?z:g,V),Yc=(new Condition$$module$js$nodes(c,"Match sword of water")).option(O).option(z.value?z:g,V),Ue=(new Condition$$module$js$nodes(c,"Match sword of thunder")).option(M).option(z.value?z:g,V),Ve=(new Condition$$module$js$nodes(c,"Swamp run possible")).option(V,Pc).option(V,Wd).option(V,$a),We=(new Condition$$module$js$nodes(c,"Insect possible to kill")).option(Za),db=(new Condition$$module$js$nodes(c,"Travel swamp")).option(Za).option(Y.value?
Y:g,Ve),Xe=(new Condition$$module$js$nodes(c,"Calmed sea if required")).option(Eb).option(Qd),Ye=(new Condition$$module$js$nodes(c,"Started windmill if required")).option(Na).option(Sd),Ze=(new Condition$$module$js$nodes(c,"Telepathy if required for Deo")).option(ka).option(Ud),$e=e(0,"Vampire 1",V).get(wb),af=e(1,"Insect",fc,Ie,We).get(Ta),bf=e(2,"Kelbesque 1",Wc,Tc).get(Ua),cf=e(12,"Vampire 2",Je).get(ke),Zc=e(4,"Sabera 1",Xc,Uc).get(mc),df=e(5,"Mado 1",Yc,Vc).get(Xa),ef=e(6,"Kelbesque 2",Wc,Tc).get(ub),
ff=e(7,"Sabera 2",Xc,Uc).get(tb),gf=e(8,"Mado 2",Yc,Vc).get(rb),hf=e(9,"Karmine",Ue,Pe).get(Ab),jf=e(10,"Draygon 1",V).get(ee),kf=e(-1,"Statues",rc,qc),lf=e(11,"Draygon 2",V,sc),mf=e(13,"Dyna",qb),nf=(new Condition$$module$js$nodes(c,"Opened prison if required")).option(yb).option(Rd),ba=new Area$$module$js$nodes(c,"Leaf"),Aa=new Area$$module$js$nodes(c,"Valley of Wind"),X=new Area$$module$js$nodes(c,"Sealed Cave"),ta=new Area$$module$js$nodes(c,"Cordel Plain"),Ba=new Area$$module$js$nodes(c,"Brynmaer"),
Ca=new Area$$module$js$nodes(c,"Amazones"),H=new Area$$module$js$nodes(c,"Mt Sabre West"),y=new Area$$module$js$nodes(c,"Mt Sabre North"),eb=new Area$$module$js$nodes(c,"Nadare's"),Oa=new Area$$module$js$nodes(c,"Oak"),la=new Area$$module$js$nodes(c,"Waterfall Valley"),F=new Area$$module$js$nodes(c,"Portoa"),ma=new Area$$module$js$nodes(c,"Waterfall Cave"),I=new Area$$module$js$nodes(c,"Fog Lamp Cave"),na=new Area$$module$js$nodes(c,"Kirisa Plant Cave"),ua=new Area$$module$js$nodes(c,"Angry Sea"),
oa=new Area$$module$js$nodes(c,"Joel"),L=new Area$$module$js$nodes(c,"Evil Spirit Island"),pa=new Area$$module$js$nodes(c,"Sabera's Castle"),ca=new Area$$module$js$nodes(c,"Swan"),C=new Area$$module$js$nodes(c,"Mt Hydra"),qa=new Area$$module$js$nodes(c,"Shyron"),va=new Area$$module$js$nodes(c,"Styx"),wa=new Area$$module$js$nodes(c,"Goa"),fb=new Area$$module$js$nodes(c,"Draygonia Fortress 1"),da=new Area$$module$js$nodes(c,"Draygonia Fortress 2"),Da=new Area$$module$js$nodes(c,"Draygonia Fortress 3"),
R=new Area$$module$js$nodes(c,"Draygonia Fortress 4"),K=new Area$$module$js$nodes(c,"Oasis Cave"),ea=new Area$$module$js$nodes(c,"Sahara"),Ea=new Area$$module$js$nodes(c,"Pyramid Front"),ha=new Area$$module$js$nodes(c,"Pyramid Back"),ia=new Area$$module$js$nodes(c,"Tower"),Hb=(new Location$$module$js$nodes(c,0,ba,"Start")).overworld().start(),of=(new Location$$module$js$nodes(c,0,ba,"Mezame Shrine")).overworld().from(Hb),pf=(new Location$$module$js$nodes(c,1,ba,"Outside Start")).overworld().connect(of),
ra=(new Location$$module$js$nodes(c,2,ba,"Town")).town().connect(pf),Pa=(new Location$$module$js$nodes(c,3,Aa,"Main")).overworld().connect(ra).trigger(xc,Na),$c=(new Location$$module$js$nodes(c,3,Aa,"Outside Windmill")).overworld(),ad=(new Location$$module$js$nodes(c,4,X,"Tunnel 1 (entrance)")).cave().from(Pa,Na),qf=(new Location$$module$js$nodes(c,5,X,"Tunnel 2 (over bridge)")).cave().connect(ad),rf=(new Location$$module$js$nodes(c,6,X,"Tunnel 6 (herb dead end)")).cave().chest(J,15),bd=(new Location$$module$js$nodes(c,
7,X,"Tunnel 4a (ball corridor)")).cave().chest(J,20,80).chest(Ka,21);(new Location$$module$js$nodes(c,7,X,"Tunnel 4b (antidote dead end)")).cave().connect(bd,A).chest(N,19);const sf=(new Location$$module$js$nodes(c,8,X,"Tunnel 5 (warp boots dead end)")).cave().chest(U,14),tf=(new Location$$module$js$nodes(c,9,X,"Tunnel 3a (branch, front)")).cave().connect(qf).connectTo(bd).connectTo(sf),uf=(new Location$$module$js$nodes(c,9,X,"Tunnel 3b (branch, back)")).cave().connect(tf,A).connectTo(rf),vf=(new Location$$module$js$nodes(c,
10,X,"Tunnel 7 (boss)")).cave().connect(uf).boss($e),wf=(new Location$$module$js$nodes(c,12,X,"Tunnel 8a (exit, above wall)")).cave().connect(vf),xf=(new Location$$module$js$nodes(c,12,X,"Tunnel 8b (exit, below wall")).cave().connect(wf,A);(new Location$$module$js$nodes(c,14,Aa,"Windmill Cave")).cave().connect(Pa).connectTo($c).trigger(le,xb,Bb);(new Location$$module$js$nodes(c,15,Aa,"Windmill")).misc().connect($c).trigger(Na,ic);const yf=(new Location$$module$js$nodes(c,16,Aa,"Zebu's Cave Front")).cave().connect(Pa).trigger(Bb,
vc,wc).trigger(xc,Na,Bb),zf=(new Location$$module$js$nodes(c,16,Aa,"Zebu's Cave Back")).cave().trigger(Ac).connect(yf,B),Af=(new Location$$module$js$nodes(c,17,H,"Tunnel 1 (to Zebu)")).cave().connect(zf),Fa=(new Location$$module$js$nodes(c,20,ta,"West")).overworld().connect(xf,Ye),Bf=(new Location$$module$js$nodes(c,20,ta,"South")).overworld().connect(Fa,x),cd=(new Location$$module$js$nodes(c,21,ta,"East")).overworld().connect(Fa).chest(ec,24),Qa=(new Location$$module$js$nodes(c,24,Ba,"Town")).town().connect(Fa).trigger(me,
ec),Cf=(new Location$$module$js$nodes(c,25,ta,"Outside Stom's House")).town().connect(Fa),Ib=(new Location$$module$js$nodes(c,26,ta,"Swamp")).overworld().connect(cd,db).trigger(Cb,zc,db);(new Location$$module$js$nodes(c,26,ta,"Swamp Insect Area")).overworld().connect(Ib,db).boss(af);const gb=(new Location$$module$js$nodes(c,27,Ca,"Town")).town().connect(Bf),hb=(new Location$$module$js$nodes(c,28,Oa,"Town")).town().connect(Ib,db).trigger(yc);(new Location$$module$js$nodes(c,30,ta,"Stom's House")).house().connect(Cf).trigger(ne,
yc);const Ga=(new Location$$module$js$nodes(c,32,H,"Entrance")).overworld().connect(Fa).connect(Af),Df=(new Location$$module$js$nodes(c,32,H,"Up Slope")).overworld().from(Ga,Qc).to(Ga),Ef=(new Location$$module$js$nodes(c,32,H,"Dead End (warp boots)")).overworld().chest(U,24,106),dd=(new Location$$module$js$nodes(c,33,H,"Upper")).overworld().from(Ga,G).to(Ga),Ff=(new Location$$module$js$nodes(c,33,H,"Tornel Dead End")).overworld().trigger(qe,Ka,La).chest(aa,23,105),ed=(new Location$$module$js$nodes(c,
34,H,"Tunnel 2a (fork at start)")).cave().connect(Ga);(new Location$$module$js$nodes(c,34,H,"Tunnel 2b (left branch to dead end)")).cave().connect(ed,B).connectTo(Ef);const Gf=(new Location$$module$js$nodes(c,34,H,"Tunnel 2c (right branch to upper)")).cave().connect(ed,B),Hf=(new Location$$module$js$nodes(c,35,H,"Tunnel 3a (tunnel to upper, with herb chest)")).cave().connect(Gf).chest(J,23,82),If=(new Location$$module$js$nodes(c,35,H,"Tunnel 3b (tunnel to upper, branch below ice)")).cave().connect(Hf,
B).connectTo(dd),fd=(new Location$$module$js$nodes(c,36,H,"Tunnel 4a (branch to upper or Tornel)")).cave().connect(If);(new Location$$module$js$nodes(c,36,H,"Tunnel 4b (out to upper)")).cave().connect(fd,B).connectTo(dd);const Jf=(new Location$$module$js$nodes(c,37,H,"Tunnel 5 (tiny connector)")).cave().connect(fd),Kf=(new Location$$module$js$nodes(c,38,H,"Tunnel 6a (exit to Tornel, above ice)")).cave().connect(Jf);(new Location$$module$js$nodes(c,38,H,"Tunnel 6b (exit to Tornel, below ice)")).cave().connect(Kf,
B).connectTo(Ff);const Lf=(new Location$$module$js$nodes(c,39,H,"Tunnel 7a (tornado bracelet, lower)")).cave().connect(Df),Mf=(new Location$$module$js$nodes(c,39,H,"Tunnel 7b (tornado bracelet, middle)")).cave().connect(Lf,B);(new Location$$module$js$nodes(c,39,H,"Tunnel 7c (tornado bracelet, upper)")).cave().connect(Mf,B).chest(La,25);const ib=(new Location$$module$js$nodes(c,40,y,"Entrance")).overworld().connect(cd,Le,Ke),jb=(new Location$$module$js$nodes(c,40,y,"Upper")).overworld().from(ib,G).to(ib),
Jb=(new Location$$module$js$nodes(c,40,y,"Summit (boss)")).overworld().from(jb,G).to(jb).boss(bf),gd=(new Location$$module$js$nodes(c,41,y,"Connector")).overworld(),Kb=(new Location$$module$js$nodes(c,41,y,"Middle Left")).overworld(),Nf=(new Location$$module$js$nodes(c,41,y,"Middle Right")).overworld().from(Kb,Qc).to(Kb),hd=(new Location$$module$js$nodes(c,42,y,"Tunnel 2a (from entrance to connector)")).cave().connectTo(gd);(new Location$$module$js$nodes(c,42,y,"Tunnel 2b (under bridge, to antidote)")).cave().connect(hd,
B).chest(N,23,94);const id=(new Location$$module$js$nodes(c,43,y,"Tunnel 3a (branch after connector)")).cave().connect(gd),Of=(new Location$$module$js$nodes(c,43,y,"Tunnel 3b (right branch)")).cave().connect(id,B),Pf=(new Location$$module$js$nodes(c,43,y,"Tunnel 3c (upper branch)")).cave().connect(id,B);(new Location$$module$js$nodes(c,44,y,"Tunnel 4 (over bridge, to middle)")).cave().connect(Pf).connectTo(Kb);const jd=(new Location$$module$js$nodes(c,45,y,"Tunnel 5a (E-shaped, from right branch)")).cave().connect(Of).connectTo(Nf);
(new Location$$module$js$nodes(c,45,y,"Tunnel 5b (dead-end with herb)")).cave().connect(jd,B).chest(J,22,83);const Qf=(new Location$$module$js$nodes(c,46,y,"Tunne; 6a (S-shaped hall, right)")).cave().connect(jd),Rf=(new Location$$module$js$nodes(c,46,y,"Tunne; 6b (S-shaped hall, middle)")).cave().connect(Qf,B),Sf=(new Location$$module$js$nodes(c,46,y,"Tunnel 6c (S-shaped hall, left)")).cave().connect(Rf,B),kd=(new Location$$module$js$nodes(c,47,y,"Prison (hallway)")).cave().connect(jb),Tf=(new Location$$module$js$nodes(c,
48,y,"Left Cell (shopkeepers)")).cave().from(kd,B);(new Location$$module$js$nodes(c,49,y,"Left Cell 2 (back, with prison key)")).cave().from(Tf,B).chest(yb,13);const Uf=(new Location$$module$js$nodes(c,50,y,"Right Cell (villagers)")).cave().from(kd,B),Vf=(new Location$$module$js$nodes(c,51,y,"Tunnel 8 (behind right cell, toward summit)")).cave().from(Uf,B);(new Location$$module$js$nodes(c,52,y,"Tunnel 9 (connector to summit)")).cave().connect(Vf).connectTo(Jb);const Wf=(new Location$$module$js$nodes(c,
53,y,"Summit Cave (front)")).cave().from(Jb,yb).to(Jb),Xf=(new Location$$module$js$nodes(c,53,y,"Summit Cave (behind ice)")).cave().connect(Wf,B).trigger(re);(new Location$$module$js$nodes(c,56,y,"Tunnel 1 (leads from main entrance)")).cave().connect(ib).connectTo(hd);(new Location$$module$js$nodes(c,57,y,"Tunnel 7 (to upper)")).cave().connect(Sf).connectTo(jb);const Yf=(new Location$$module$js$nodes(c,60,eb,"Inn")).shop(),Zf=(new Location$$module$js$nodes(c,61,eb,"Tool Shop")).shop(J,N,P,U),$f=(new Location$$module$js$nodes(c,
62,eb,"Back Room")).house(),Lb=(new Location$$module$js$nodes(c,64,la,"Summit")).overworld().connect(Xf,nf),kb=(new Location$$module$js$nodes(c,64,la,"Northwest")).overworld().from(Lb).to(Lb,G),ag=(new Location$$module$js$nodes(c,64,la,"Northeast")).overworld().connect(kb,x),ld=(new Location$$module$js$nodes(c,65,la,"Southwest")).overworld().connect(kb),bg=(new Location$$module$js$nodes(c,65,la,"Southeast")).overworld().connect(ld,x),md=(new Location$$module$js$nodes(c,66,la,"Lime Tree Valley")).overworld().connect(ld).connect(Pa,
Vd),cg=(new Location$$module$js$nodes(c,67,la,"Lime Tree Lake (Rage)")).cave().connect(md).trigger(Fc,O),dg=(new Location$$module$js$nodes(c,68,na,"Tunnel 1a (entrance)")).cave().connect(bg),eg=(new Location$$module$js$nodes(c,68,na,"Tunnel 1b (behind wall)")).cave().connect(dg,A),nd=(new Location$$module$js$nodes(c,69,na,"Tunnel 2a (main path, before wall)")).cave().connect(eg);(new Location$$module$js$nodes(c,69,na,"Tunnel 2b (dead end, antidote)")).cave().connect(nd,A).chest(N,25,95);const fg=
(new Location$$module$js$nodes(c,69,na,"Tunnel 2c (main path, after wall)")).cave().connect(nd,A),gg=(new Location$$module$js$nodes(c,70,na,"Tunnel 3a (last room, before wall)")).cave().connect(fg),hg=(new Location$$module$js$nodes(c,70,na,"Tunnel 3b (last room, after wall)")).cave().connect(gg,A);(new Location$$module$js$nodes(c,71,na,"Meadow")).overworld().connect(hg).chest(pc,14);const ig=(new Location$$module$js$nodes(c,72,I,"Tunnel 1a (entrance)")).cave().connect(ag),od=(new Location$$module$js$nodes(c,
72,I,"Tunnel 1b (past wall)")).cave().connect(ig,A);(new Location$$module$js$nodes(c,72,I,"Tunnel 1c (dead end, lysisPlant)")).cave().connect(od,A).chest(ya,24);const jg=(new Location$$module$js$nodes(c,73,I,"Tunnel 2 (tiny connector)")).cave().connect(od),pd=(new Location$$module$js$nodes(c,74,I,"Tunnel 3a (upper branch)")).cave().connect(jg);(new Location$$module$js$nodes(c,74,I,"Tunnel 3b (dead end, mimic)")).cave().connect(pd,A).chest(Q,21,112);const qd=(new Location$$module$js$nodes(c,74,I,"Tunnel 3c (short passage with mimic)")).cave().connect(pd,
A).chest(Q,22,113),kg=(new Location$$module$js$nodes(c,74,I,"Tunnel 3d (lower branch)")).cave().connect(qd,A);(new Location$$module$js$nodes(c,75,I,"Dead end loop")).cave().connect(kg);const rd=(new Location$$module$js$nodes(c,76,I,"Tunnel 4a (right branch over bridge)")).cave().connect(qd),lg=(new Location$$module$js$nodes(c,76,I,"Tunnel 4b (past wall over bridge)")).cave().connect(rd,A),mg=(new Location$$module$js$nodes(c,77,I,"Tunnel 5a (from left branch)")).cave().connect(rd),ng=(new Location$$module$js$nodes(c,
77,I,"Tunnel 5b (reconvergence)")).cave().connect(mg,A).connect(lg),og=(new Location$$module$js$nodes(c,77,I,"Tunnel 5c (between walls)")).cave().connect(ng,A),pg=(new Location$$module$js$nodes(c,77,I,"Tunnel 5d (under bridge)")).cave().connect(og,A),qg=(new Location$$module$js$nodes(c,78,I,"Tunnel 6a (over second bridge)")).cave().connect(pg),rg=(new Location$$module$js$nodes(c,78,I,"Tunnel 6b (past wall)")).cave().connect(qg,A),sg=(new Location$$module$js$nodes(c,79,I,"Tunnel 7a (under second bridge)")).cave().connect(rg);
(new Location$$module$js$nodes(c,79,I,"Tunnel 7b (fog lamp)")).cave().connect(sg,A).chest(kc,19);const xa=(new Location$$module$js$nodes(c,80,F,"Town")).town().connect(kb),sd=(new Location$$module$js$nodes(c,81,F,"Fishherman Island")).town().connect(xa);(new Location$$module$js$nodes(c,82,la,"Mesia Shrine")).cave().trigger(Gc).connect(cg,x,Fc);const td=(new Location$$module$js$nodes(c,84,ma,"Tunnel 1a (entrance)")).cave().connect(kb);(new Location$$module$js$nodes(c,84,ma,"Tunnel 1b (dead end, mimic)")).cave().connect(td,
B).chest(Q,19,114);const tg=(new Location$$module$js$nodes(c,84,ma,"Tunnel 1c (past ice)")).cave().connect(td,B),ug=(new Location$$module$js$nodes(c,85,ma,"Tunnel 2 (stoned pair)")).cave().connect(tg),Mb=(new Location$$module$js$nodes(c,86,ma,"Tunnel 3 (wide medusa hallways)")).cave().connect(ug,Qe),vg=(new Location$$module$js$nodes(c,87,ma,"Tunnel 4a (left entrance)")).cave().from(Mb,B).chest(ac.chest().bonus(),25).trigger(te,vb);(new Location$$module$js$nodes(c,87,ma,"Tunnel 4b (right entrance)")).cave().from(Mb,
B).connect(vg,G);(new Location$$module$js$nodes(c,87,ma,"Tunnel 4c (sword of water)")).cave().connect(Mb,B).chest(O,24);const ud=(new Location$$module$js$nodes(c,88,ia,"Entrance")).misc(),wg=(new Location$$module$js$nodes(c,89,ia,"Level 1")).misc().from(ud),xg=(new Location$$module$js$nodes(c,90,ia,"Level 2")).misc().from(wg),yg=(new Location$$module$js$nodes(c,91,ia,"Level 3")).misc().from(xg),vd=(new Location$$module$js$nodes(c,92,ia,"Outside Mesia Room")).misc().from(yg),zg=(new Location$$module$js$nodes(c,
93,ia,"Outside Dyna Room")).misc().from(vd,qb);(new Location$$module$js$nodes(c,94,ia,"Mesia")).misc().connect(vd).trigger(Ee);const Ag=(new Location$$module$js$nodes(c,95,ia,"Dyna")).misc().from(zg).boss(mf);(new Location$$module$js$nodes(c,95,ia,"Win")).misc().from(Ag).end();const Nb=(new Location$$module$js$nodes(c,96,ua,"Cabin Beach")).sea().from(sd,Db),Ha=(new Location$$module$js$nodes(c,96,ua,"South")).sea().connect(Nb,fa),Bg=(new Location$$module$js$nodes(c,96,ua,"Joel Beach")).sea().connect(Ha,
fa),wd=(new Location$$module$js$nodes(c,96,oa,"Outside Lighthouse")).sea();(new Location$$module$js$nodes(c,96,ua,"Altar")).sea().connect(Ha,fa).trigger(Eb,nc,mc);const Cg=(new Location$$module$js$nodes(c,96,ua,"North")).sea().to(Ha,fa).from(Ha,fa,Oe).trigger(we,Xe),Dg=(new Location$$module$js$nodes(c,96,ua,"Swan Beach")).sea().connect(Cg,fa);(new Location$$module$js$nodes(c,97,ua,"Cabin")).misc().connect(Nb).trigger(Jc,Db);(new Location$$module$js$nodes(c,98,oa,"Lighthouse")).misc().connect(wd).trigger(ve,
xb);const lb=(new Location$$module$js$nodes(c,100,F,"Underground Channel 1 (from throne room)")).sea().trigger(Ec),Eg=(new Location$$module$js$nodes(c,100,F,"Underground Channel 2 (to fortune teller)")).sea().connect(lb,x),xd=(new Location$$module$js$nodes(c,100,F,"Underground Channel 3 (from fortune teller)")).sea().connect(lb,G),yd=(new Location$$module$js$nodes(c,100,F,"Underground Channel 4 (asina)")).sea().connect(xd,x),Fg=(new Location$$module$js$nodes(c,100,F,"Underground Channel 5 (dolphin)")).sea().connect(yd,
x).trigger(Ic,J,Hc);(new Location$$module$js$nodes(c,100,F,"Underground Channel 6 (water)")).sea().connect(Fg,fa).connectTo(Ha,fa).chest(oc,17);const Ob=(new Location$$module$js$nodes(c,101,L,"Zombie Town")).town(),Gg=(new Location$$module$js$nodes(c,104,L,"Tunnel 1 (entrance)")).sea().connect(Ha,Kc,fa),zd=(new Location$$module$js$nodes(c,105,L,"Tunnel 2a (start)")).cave().connect(Gg);(new Location$$module$js$nodes(c,105,L,"Tunnel 2b (dead end to left)")).cave().connect(zd,x);const Hg=(new Location$$module$js$nodes(c,
105,L,"Tunnel 2c (across first river)")).cave().connect(zd,x),Ad=(new Location$$module$js$nodes(c,105,L,"Tunnel 2d (across second river)")).cave().connect(Hg,x);(new Location$$module$js$nodes(c,105,L,"Tunnel 2e (dead end, magic ring)")).cave().connect(Ad,A).chest(aa,29);const Ig=(new Location$$module$js$nodes(c,105,L,"Tunnel 2f (stair down)")).cave().connect(Ad,A),Jg=(new Location$$module$js$nodes(c,106,L,"Tunnel 3a (main area)")).cave().connect(Ig).connectTo(Ob).chest(ya,25,92),Kg=(new Location$$module$js$nodes(c,
106,L,"Tunnel 3b (left area toward items)")).cave().connect(Jg,A),Lg=(new Location$$module$js$nodes(c,107,L,"Tunnel 4a (right side, mimic)")).cave().connect(Kg).chest(Q,14,115);(new Location$$module$js$nodes(c,107,L,"Tunnel 4b (left side, iron necklace)")).cave().connect(Lg,x).chest(he,15);const Pb=(new Location$$module$js$nodes(c,108,pa,"Floor 1")).fortress().connect(Ob),Mg=(new Location$$module$js$nodes(c,108,pa,"Miniboss")).fortress().boss(cf).connect(Pb);(new Location$$module$js$nodes(c,109,pa,
"Floor 2a (left stair)")).fortress().connect(Pb).chest(P,19);const Ng=(new Location$$module$js$nodes(c,109,pa,"Floor 2b (right stair)")).fortress().connect(Mg).chest(J,30,85),Og=(new Location$$module$js$nodes(c,110,pa,"Floor 3a (toward boss)")).fortress().connect(Ng),Bd=(new Location$$module$js$nodes(c,110,pa,"Floor 3b (boss room)")).fortress().connect(Og);(new Location$$module$js$nodes(c,110,pa,"Boss")).fortress().boss(Zc).connect(Bd);(new Location$$module$js$nodes(c,110,pa,"Floor 3c (back room trap)")).fortress().from(Bd).to(Pb);
const Pg=(new Location$$module$js$nodes(c,112,oa,"Secret Passage")).cave().connectTo(wd),mb=(new Location$$module$js$nodes(c,113,oa,"Town")).town().connect(Bg),ja=(new Location$$module$js$nodes(c,114,ca,"Town")).town().connect(Dg),Qg=(new Location$$module$js$nodes(c,115,ca,"Inside Gate")).overworld().connect(ja),Rg=(new Location$$module$js$nodes(c,115,ca,"Outside Gate")).overworld().from(Qg,sa),nb=(new Location$$module$js$nodes(c,120,wa,"Valley")).overworld().connect(Rg),Qb=(new Location$$module$js$nodes(c,
124,C,"Entrance")).overworld().connect(nb),Sg=(new Location$$module$js$nodes(c,124,C,"Over first river toward Shyron")).overworld().connect(Qb,x),Cd=(new Location$$module$js$nodes(c,124,C,"After first tunnel")).overworld(),Dd=(new Location$$module$js$nodes(c,124,C,"Door to Styx")).overworld().connect(Cd,x),Tg=(new Location$$module$js$nodes(c,124,C,"Dead end (no item)")).overworld(),Ug=(new Location$$module$js$nodes(c,124,C,"Dead end (fruit of lime)")).overworld().chest(sb,26),Vg=(new Location$$module$js$nodes(c,
124,C,"Dead end (magic ring)")).overworld().chest(aa,25,101),Ed=(new Location$$module$js$nodes(c,124,C,"Outside tunnel to bow")).overworld();(new Location$$module$js$nodes(c,124,C,"Floating island (bow of sun)")).overworld().connect(Ed,G).chest(rc,24);const Wg=(new Location$$module$js$nodes(c,125,C,"Tunnel 1 (to Shyron)")).cave().connect(Sg),Xg=(new Location$$module$js$nodes(c,126,C,"Outside Shyron")).overworld().connect(Wg);(new Location$$module$js$nodes(c,127,C,"Tunnel 2 (fork)")).cave().connect(Qb).connectTo(Ug).connectTo(Cd);
const Fd=(new Location$$module$js$nodes(c,128,C,"Tunnel 3 (caves)")).cave().connect(Dd).connect(Tg),Gd=(new Location$$module$js$nodes(c,129,C,"Tunnel 4 (left branch of cave)")).cave().connect(Fd);(new Location$$module$js$nodes(c,130,C,"Tunnel 5 (dead end, medical herb)")).cave().connect(Gd).chest(J,15,86);const Yg=(new Location$$module$js$nodes(c,131,C,"Tunnel 6a (left-then-right)")).cave().connect(Gd),Zg=(new Location$$module$js$nodes(c,131,C,"Tunnel 6b (past wall)")).cave().connect(Yg,A),$g=(new Location$$module$js$nodes(c,
132,C,"Tunnel 7 (wide hall)")).cave().connect(Zg);(new Location$$module$js$nodes(c,133,C,"Tunnel 8 (red slimes)")).cave().from($g,A).connectTo(Ed).chest(Q,23,116);const ah=(new Location$$module$js$nodes(c,134,C,"Tunnel 9 (right branch, infinite loop)")).cave().connect(Fd),bh=(new Location$$module$js$nodes(c,135,C,"Tunnel 10a (toward magic ring)")).cave().connect(ah);(new Location$$module$js$nodes(c,135,C,"Tunnel 10b (past wall)")).cave().connect(bh,A).connectTo(Vg);const Hd=(new Location$$module$js$nodes(c,
136,va,"Entrance")).fortress().from(Dd,jc,Gb),ch=(new Location$$module$js$nodes(c,137,va,"Left branch")).fortress().connect(Hd).chest(Q,19,117),dh=(new Location$$module$js$nodes(c,137,va,"Left branch, past one bridge")).fortress().connect(ch,x),eh=(new Location$$module$js$nodes(c,137,va,"Left branch, past two bridges")).fortress().connect(dh,x).chest(J,29,87),fh=(new Location$$module$js$nodes(c,137,va,"Right branch")).fortress().connect(Hd);(new Location$$module$js$nodes(c,137,va,"Right branch, across water")).fortress().connect(fh,
G).chest(Q,20,118).chest(Q,21,119).chest(Zd,28);(new Location$$module$js$nodes(c,138,va,"Upper floor")).fortress().connect(eh).chest(M,27);const Ia=(new Location$$module$js$nodes(c,140,qa,"Town")).town().connect(Xg,Re).trigger(Fb),Ra=(new Location$$module$js$nodes(c,142,wa,"Town")).town().connect(nb),Id=(new Location$$module$js$nodes(c,143,K,"Draygonia Fortress Basement 1 (front)")).fortress();(new Location$$module$js$nodes(c,143,K,"Draygonia Fortress Basement 2 (power ring)")).fortress().connect(Id,
za).chest(fe,15);const Rb=(new Location$$module$js$nodes(c,144,wa,"Desert 1")).overworld().connect(nb),ob=(new Location$$module$js$nodes(c,145,K,"Area 1 (from entrance)")).cave().chest(gc,26),Jd=(new Location$$module$js$nodes(c,145,K,"Area 2 (across top bridge)")).cave().connect(ob,x);(new Location$$module$js$nodes(c,145,K,"Area 3 (dead-end across top-right bridge)")).cave().connect(Jd,x);const gh=(new Location$$module$js$nodes(c,145,K,"Area 4 (left across middle-right bridge)")).cave().connect(Jd,
x),hh=(new Location$$module$js$nodes(c,145,K,"Area 5 (bottom edge)")).cave().connect(gh,x),ih=(new Location$$module$js$nodes(c,145,K,"Area 6 (bottom island)")).cave().connect(hh,x),jh=(new Location$$module$js$nodes(c,145,K,"Area 7 (bottom inner ring)")).cave().connect(ih,x),kh=(new Location$$module$js$nodes(c,145,K,"Area 8 (left outer ring)")).cave().connect(jh,x).connect(ob,x).chest(P,27,100),lh=(new Location$$module$js$nodes(c,145,K,"Area 9 (top left inner ring)")).cave().connect(kh,x),mh=(new Location$$module$js$nodes(c,
145,K,"Area 10 (top right inner ring)")).cave().connect(lh,x);(new Location$$module$js$nodes(c,145,K,"Area 11 (center)")).cave().connect(mh,x).connectTo(Id);(new Location$$module$js$nodes(c,145,K,"Area 12 (top center islands)")).cave().connect(ob,G).chest(de,28);const nh=(new Location$$module$js$nodes(c,146,ea,"Desert Cave 1")).cave().connect(Rb,G),Ja=(new Location$$module$js$nodes(c,147,ea,"Town")).town(),oh=(new Location$$module$js$nodes(c,148,ea,"Outside Cave")).overworld().connect(Ja),ph=(new Location$$module$js$nodes(c,
149,ea,"Desert Cave 2")).cave().connect(oh);(new Location$$module$js$nodes(c,150,ea,"Meadow")).overworld().connect(nh).connectTo(Ja).trigger(Be,sa,Ze);const Sb=(new Location$$module$js$nodes(c,152,ea,"Desert 2")).overworld().connect(ph),qh=(new Location$$module$js$nodes(c,156,Ea,"Entrance")).fortress().connect(Sb,G),rh=(new Location$$module$js$nodes(c,156,Ea,"Azteca")).fortress().trigger(De),sh=(new Location$$module$js$nodes(c,157,Ea,"Fork")).fortress().connect(qh),Kd=(new Location$$module$js$nodes(c,
158,Ea,"Main")).fortress().connect(sh);(new Location$$module$js$nodes(c,158,Ea,"Treasure Chest (magic ring)")).fortress().connect(Kd).chest(aa,27,108);(new Location$$module$js$nodes(c,159,Ea,"Draygon")).fortress().connect(Kd).to(rh).boss(jf);const th=(new Location$$module$js$nodes(c,160,ha,"Entrance")).fortress().connect(Sb,G),uh=(new Location$$module$js$nodes(c,160,ha,"Statues")).fortress().connect(th).boss(kf),vh=(new Location$$module$js$nodes(c,161,ha,"Hall 1")).fortress().connect(uh),Tb=(new Location$$module$js$nodes(c,
162,ha,"Branch")).fortress().connect(vh);(new Location$$module$js$nodes(c,163,ha,"Left Dead End")).fortress().connect(Tb).chest(Q,13,120);(new Location$$module$js$nodes(c,164,ha,"Right Dead End")).fortress().connect(Tb);const wh=(new Location$$module$js$nodes(c,165,ha,"Hall 2")).fortress().connect(Tb).chest(ub,26,109),xh=(new Location$$module$js$nodes(c,166,ha,"Draygon 2")).fortress().connect(wh).boss(lf);(new Location$$module$js$nodes(c,167,ha,"Teleporter")).fortress().from(xh).to(ud);const Ld=(new Location$$module$js$nodes(c,
168,fb,"Entrance")).fortress().connect(Ra,Gb).trigger(Oc,M),yh=(new Location$$module$js$nodes(c,169,fb,"Main")).fortress().from(Ld,za),zh=(new Location$$module$js$nodes(c,169,fb,"Boss")).fortress().connect(yh).boss(ef),Ah=(new Location$$module$js$nodes(c,170,fb,"Zebu")).fortress().connect(zh),pb=(new Location$$module$js$nodes(c,171,da,"Entrance")).fortress().connect(Ah);(new Location$$module$js$nodes(c,171,da,"Dead End Behind Iron (fruit of power)")).fortress().connect(pb,za).chest(P,28,98);(new Location$$module$js$nodes(c,
171,da,"Dead End Loop Across Closer Bridges")).fortress().connect(pb,x).connect(pb,x);const Bh=(new Location$$module$js$nodes(c,171,da,"Across First Bridge (fruit of repun)")).fortress().connect(pb,x).chest(tb,30,102),Ub=(new Location$$module$js$nodes(c,171,da,"Across Second Bridge")).fortress().connect(Bh,x);(new Location$$module$js$nodes(c,171,da,"Dead End Across Two Bridges ()")).fortress().connect(Ub,x).connect(Ub,x).chest(ya,29,93);const Ch=(new Location$$module$js$nodes(c,171,da,"Across Third Bridge")).fortress().connect(Ub,
x),Dh=(new Location$$module$js$nodes(c,171,da,"Exit Behind Iron Door")).fortress().connect(Ch,za),Eh=(new Location$$module$js$nodes(c,172,da,"Boss")).fortress().connect(Dh).boss(ff),Fh=(new Location$$module$js$nodes(c,172,da,"Tornel")).fortress().connect(Eh),Md=(new Location$$module$js$nodes(c,173,Da,"Lower")).fortress().connect(Fh).chest(ub,26,99).chest(aa,27,111),Gh=(new Location$$module$js$nodes(c,174,Da,"Upper Loop")).fortress().connect(Md).chest(N,22,96);(new Location$$module$js$nodes(c,174,
Da,"Upper Loop Behind Wall (magic ring)")).fortress().connect(Gh,za).chest(aa,23,107);const Hh=(new Location$$module$js$nodes(c,175,Da,"Upper Passage (toward Mado)")).fortress().connect(Md).chest(aa,27,84),Vb=(new Location$$module$js$nodes(c,176,R,"Initial Fork")).fortress(),Ih=(new Location$$module$js$nodes(c,177,R,"Left Branch")).fortress().connect(Vb),Nd=(new Location$$module$js$nodes(c,178,R,"Main Area (right branch, over bridges)")).fortress().connect(Vb),Jh=(new Location$$module$js$nodes(c,
179,R,"U-shaped Passage (between floors)")).fortress().connect(Nd),Kh=(new Location$$module$js$nodes(c,180,R,"Main Area Lower (under bridge)")).fortress().connect(Ih).connect(Nd).connect(Jh),Od=(new Location$$module$js$nodes(c,180,R,"Behind Iron Wall")).fortress().connect(Kh,za),Lh=(new Location$$module$js$nodes(c,181,R,"Lower")).fortress().connect(Od).chest(Q,13,121).chest(Q,14,122).chest(Q,15,123).chest(aa,23,88).chest(U,24,110),Mh=(new Location$$module$js$nodes(c,182,R,"Boss Corridor")).fortress().connect(Lh),
Nh=(new Location$$module$js$nodes(c,182,R,"Boss")).fortress().connect(Mh,Gb).boss(hf);(new Location$$module$js$nodes(c,182,R,"Behind Boss (stormBracelet)")).fortress().connect(Nh).chest(Ya,18);const Pd=(new Location$$module$js$nodes(c,183,R,"Exit Stairs")).fortress(),Oh=(new Location$$module$js$nodes(c,184,K,"Entrance Back (behind river)")).cave().connect(Pd).chest(P,13,90);(new Location$$module$js$nodes(c,184,K,"Entrance Front")).cave().connect(Oh,G).connectTo(Rb).connectTo(ob);const Ph=(new Location$$module$js$nodes(c,
185,Da,"Boss")).fortress().connect(Hh).boss(gf);(new Location$$module$js$nodes(c,185,Da,"Asina")).fortress().connect(Ph).connectTo(Vb);(new Location$$module$js$nodes(c,186,R,"Kensu")).fortress().connect(Od).connectTo(Pd).trigger(Ae,Ab);(new Location$$module$js$nodes(c,187,wa,"House")).house().connect(Ra).trigger(Ce,sa,Ab);(new Location$$module$js$nodes(c,188,wa,"Inn")).shop().connect(Ra,Fb);(new Location$$module$js$nodes(c,190,wa,"Tool Shop")).shop(J,N,U,P).connect(Ra,Fb);(new Location$$module$js$nodes(c,
191,wa,"Tavern")).shop().connect(Ra);(new Location$$module$js$nodes(c,192,ba,"Elder House")).house().connect(ra).trigger(vc);(new Location$$module$js$nodes(c,193,ba,"Rabbit Hut")).house().connect(ra).trigger(Bc,Ac,ka);(new Location$$module$js$nodes(c,194,ba,"Inn")).shop().connect(ra);(new Location$$module$js$nodes(c,195,ba,"Tool Shop")).shop(J,N,U,P).connect(ra);(new Location$$module$js$nodes(c,196,ba,"Armor Shop")).shop($d,Zb).connect(ra);(new Location$$module$js$nodes(c,197,ba,"Student House")).house().connect(ra).trigger(wc);
(new Location$$module$js$nodes(c,198,Ba,"Tavern")).house().connect(Qa);(new Location$$module$js$nodes(c,199,Ba,"Pawn Shop")).shop().connect(Qa);(new Location$$module$js$nodes(c,200,Ba,"Inn")).shop().connect(Qa);(new Location$$module$js$nodes(c,201,Ba,"Armor Shop")).shop(ae,Zb,Xd).connect(Qa);(new Location$$module$js$nodes(c,203,Ba,"Tool Shop")).shop(J,N,U).connect(Qa);(new Location$$module$js$nodes(c,205,Oa,"Elder House")).house().from(hb,ka).trigger(pe,Cb);(new Location$$module$js$nodes(c,206,Oa,
"Mother's House")).house().from(hb,ka).trigger(zc,ka).trigger(oe,Cb);(new Location$$module$js$nodes(c,207,Oa,"Tool Shop")).shop(J,N,P).from(hb,ka);(new Location$$module$js$nodes(c,208,Oa,"Inn")).shop().from(hb,ka);(new Location$$module$js$nodes(c,209,Ca,"Inn")).shop().connect(gb);(new Location$$module$js$nodes(c,210,Ca,"Tool Shop")).shop(U,P,ya).connect(gb);(new Location$$module$js$nodes(c,211,Ca,"Armor Shop")).shop(cc,$b,ac,rb).connect(gb);const Qh=(new Location$$module$js$nodes(c,212,Ca,"Queen's House")).house().from(gb,
Se).trigger(ye,sa,pc);(new Location$$module$js$nodes(c,213,eb,"Nadare's")).house().connect(ib).connectTo(Yf).connectTo(Zf).connectTo($f);(new Location$$module$js$nodes(c,214,F,"Fisherman's House")).house().connect(sd).trigger(Db,kc,zb,Te);const Wb=(new Location$$module$js$nodes(c,215,F,"Palace Entrance")).house().connect(xa);(new Location$$module$js$nodes(c,216,F,"Fortune Teller Front")).house().connect(xa).trigger(Dc,Cc);(new Location$$module$js$nodes(c,216,F,"Fortune Teller Back")).house().connect(Eg).connect(xd);
(new Location$$module$js$nodes(c,217,F,"Pawn Shop")).shop().connect(xa);(new Location$$module$js$nodes(c,218,F,"Armor Shop")).shop(be,cc,$b).connect(xa);(new Location$$module$js$nodes(c,220,F,"Inn")).shop().connect(xa);(new Location$$module$js$nodes(c,221,F,"Tool Shop")).shop(J,ya,sb,U).connect(xa);(new Location$$module$js$nodes(c,222,F,"Palace Left")).house().connect(Wb);(new Location$$module$js$nodes(c,223,F,"Palace Throne Room")).house().connect(Wb).to(lb,Me).from(lb).trigger(Cc).trigger(se,Dc,
Ec);(new Location$$module$js$nodes(c,224,F,"Palace Right")).house().connect(Wb);(new Location$$module$js$nodes(c,225,F,"Asina's Room")).house().connect(yd).trigger(Hc,Rc);(new Location$$module$js$nodes(c,226,Ca,"Queen Downstairs")).house().connect(Qh).chest(Wa,13);(new Location$$module$js$nodes(c,227,oa,"Elder's House")).house().connect(mb).trigger(Kc);(new Location$$module$js$nodes(c,228,oa,"Shed")).house().connect(mb).to(Pg,lc);(new Location$$module$js$nodes(c,229,oa,"Tool Shop")).shop(J,N,P,ya).connect(mb);
(new Location$$module$js$nodes(c,231,oa,"Inn")).shop().connect(mb);const Rh=(new Location$$module$js$nodes(c,232,L,"Zombie Town House")).house().connect(Ob);(new Location$$module$js$nodes(c,233,L,"Zombie Town Basement")).house().connect(Rh).trigger(ue,Zc);(new Location$$module$js$nodes(c,235,ca,"Tool Shop")).shop(J,N,P,U).connect(ja);(new Location$$module$js$nodes(c,236,ca,"Stom's Hut")).house().connect(ja).trigger(Lc);(new Location$$module$js$nodes(c,237,ca,"Inn")).shop().connect(ja);(new Location$$module$js$nodes(c,
238,ca,"Armor Shop")).shop(ce,dc,Yd,bc).connect(ja);(new Location$$module$js$nodes(c,239,ca,"Tavern")).house().connect(ja).trigger(Mc,Lc,Ma);(new Location$$module$js$nodes(c,240,ca,"Pawn Shop")).shop().connect(ja);(new Location$$module$js$nodes(c,241,ca,"Dance Hall")).house().connect(ja).trigger(Nc,Mc,Ma).trigger(xe,Nc,oc);const Sh=(new Location$$module$js$nodes(c,242,qa,"Temple (pre-massacre)")).fortress().connect(Ia).from(Hb,M,Td).trigger(ze);(new Location$$module$js$nodes(c,242,qa,"Temple (post-massacre)")).fortress().from(Sh,
Oc).boss(df);(new Location$$module$js$nodes(c,243,qa,"Training Hall")).house().connect(Ia);(new Location$$module$js$nodes(c,244,qa,"Hospital")).house().connect(Ia);(new Location$$module$js$nodes(c,245,qa,"Armor Shop")).shop(dc,rb,bc).connect(Ia);(new Location$$module$js$nodes(c,246,qa,"Tool Shop")).shop(J,N,sb,aa).connect(Ia);(new Location$$module$js$nodes(c,247,qa,"Inn")).shop().connect(Ia);(new Location$$module$js$nodes(c,248,ea,"Inn")).shop().connect(Ja);(new Location$$module$js$nodes(c,249,ea,
"Tool Shop")).shop(N,U,tb,aa).connect(Ja);(new Location$$module$js$nodes(c,250,ea,"Elder's House")).house().connect(Ja);(new Location$$module$js$nodes(c,251,ea,"Pawn Shop")).house().connect(Ja);const Th=[ra,Pa,ad,Fa,Ib,Ga,Lb,md,Nb,ja,nb,Qb,Rb,Ld,Sb];for(const a of Th)a.from(Hb,He);return c},shuffle$$module$js$depgraph=(a,b,c,d,e)=>{d=void 0===d?new FlagSet$$module$js$flagset("Sbkm Sct"):d;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const f=generate$$module$js$depgraph(d,a);d.shuffleShops()&&
f.shuffleShops(b);const g=f.nodes.filter((a)=>a instanceof Slot$$module$js$nodes&&a.slots&&a.slotName);var h={};for(var k of g)if(k instanceof Slot$$module$js$nodes&&k.slots){var l=k.slotType[0];(h[l]=h[l]||[]).push(k)}k=[];l=[];var m={};for(var n of d.get("S")){var p=[];for(var q of n){m[q]=!0;for(var r of h[q])p.push(r),l.push([r,k.length])}k.push(p)}for(var v of"bc")if(m[v])for(n=h[v],q=n.map((a)=>[a.item,a.itemIndex]),b.shuffle(q),r=0;r<n.length;r++)n[r].set(q[r][0],q[r][1]);p=(a)=>g.find((b)=>
b.vanillaItemName===a);h=p("Sword of Wind");v=p("Sword of Fire");n=p("Ball of Wind");q=p("Ball of Fire");r=p("Statue of Onyx");p=p("Gas Mask");m.k&&b.nextInt(2)&&(v.swap(h),q.swap(n));m.k&&!b.nextInt(3)&&r.swap(p);m=[1,1,1,1,2,2,2,3,3,3,5,5,8,13];h=[];e&&e.addTasks(10);for(v=0;1E3>v;v++){e&&0===v%100&&(yield new Promise(requestAnimationFrame),e.addCompleted(1));b.shuffle(l);for(var t of k)b.shuffle(t);n=k.map(()=>-1);q=m[b.nextInt(m.length)];r=[];p=(a,b)=>a.itemIndex===b.itemIndex||a.isMimic()&&!b.canHoldMimic()||
b.isMimic()&&!a.canHoldMimic()||a.needsChest()&&!b.isChest()||b.needsChest()&&!a.isChest()?!1:!0;for(let a=0;a<q;a++){const [b,c]=l[a],d=k[c][++n[c]];p(b,d)&&(b.swap(d),r.push([b,d]))}if(!r.length)continue;const {win:a,path:c}=f.traverse({wanted:g,dfs:!1});if(a)h=c;else for(;r.length;){const [a,b]=r.pop();a.swap(b)}}a&&f.write();if(c){c.items=[];c.route=[];for(const a of h){const [b,d]=a;c.route.push(d);t=f.nodes[b];t instanceof Slot$$module$js$nodes&&!t.isFixed()&&null!=t.slotName&&(k=t.slotName,
0>k.indexOf(t.vanillaItemName)&&(k+=` (normally ${t.vanillaItemName})`),c.items.push({itemIndex:t.itemIndex,itemName:t.item.name,origName:t.vanillaItemName,slotIndex:t.slotIndex,slotName:t.slotName,text:`${t.item.name}: ${k}`}))}}})},shuffle2$$module$js$depgraph=(a,b,c,d,e)=>{d=void 0===d?new FlagSet$$module$js$flagset("Sbkm Sct"):d;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const f=generate$$module$js$depgraph(d,a);d.shuffleShops()&&f.shuffleShops(b);const g=f.integrate();e&&
e.addTasks(1E3);for(let h=0;1E3>h;h++){if(yield shuffle3$$module$js$depgraph(f,g,a,b,c,d,e)){console.log(`success after ${h} attempts`);return}e&&(e.addCompleted(1),0===h%50&&(yield new Promise(requestAnimationFrame)))}return shuffle$$module$js$depgraph(a,b,c,d,e)})},shuffle3$$module$js$depgraph=(a,b,c,d,e,f,g)=>{f=void 0===f?new FlagSet$$module$js$flagset("Sbkm Sct"):f;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const g=e&&e.stats;var k=a.nodes.filter((a)=>a instanceof Slot$$module$js$nodes&&
a.slots&&!a.isFixed());const l=new Map(d.shuffle(k.map((a)=>[a,[a.item,a.itemIndex]]))),m=new Set(d.shuffle(k)),n=new Map,p={};g&&g.seeds++;f.get("S").forEach((a,b)=>{for(const c of a)p[c]=b});for(var q of m)n.set(q.item,q);const r=new Set,v=(a,b)=>{if(null==p[a.slotType?a.slotType[0]:"c"])return a===b;if(b.isMimic()&&!a.canHoldMimic()||"unique"!==b.item.inventoryRow&&a.requiresUnique||"armor"===b.item.inventoryRow&&!a.isChest())return!1;if(f.guaranteeSword()){if(0===a.slotIndex)return 4>b.item.id;
if(4>b.item.id&&(r.add(b),4===r.size))return 0===a.slotIndex}return p[a.slotType?a.slotType[0]:"c"]===p[b.slotType?b.slotType[0]:"c"]};q=b.assumedFill(d,(a,b)=>v(a,n.get(b)));if(null==q){g&&g.endState.key++;return!1;throw Error("Could not fill!");}const t=new Map;for(var w=0;w<q.length;w++){var D=q[w];if(null!=D){var E=n.get(b.item(D));D=l.get(E);l.delete(E);E=b.location(w);t.set(E,D);m.delete(E)}}w=(a,b,c)=>{c=void 0===c?"":c;for(const c of m)if(v(c,a))return t.set(c,b),m.delete(c),l.delete(a),!0;
g&&("traps"===c?g.endState.traps++:"chest"===c?g.endState.chest++:g.endState.misc++);return!1};for(var u of l){const [a,b]=u;if(a.isMimic()&&!w(a,b,"traps"))return!1}for(const a of l){const [b,c]=a;if(b.needsChest()&&!w(b,c,"chest"))return!1}for(const a of l){const [b,c]=a;if(!w(b,c))return!1}for(const a of t){const [b,c]=a;b.set(...c)}const {win:z,path:Y}=a.traverse({wanted:k,dfs:!1});if(!z)return g&&g.endState.no_win++,!1;c&&a.write();if(!e)return!0;g&&(g.endState.success++,g.analyze(a,b,q));e.items=
[];e.route=[];for(const b of Y){const [c,d]=b;e.route.push(d);k=a.nodes[c];k instanceof Slot$$module$js$nodes&&!k.isFixed()&&(u=k.slotName,0>u.indexOf(k.vanillaItemName)&&(u+=` (normally ${k.vanillaItemName})`),e.items.push({itemIndex:k.itemIndex,itemName:k.item.name,origName:k.vanillaItemName,slotIndex:k.slotIndex,slotName:k.slotName,text:`${k.item.name}: ${u}`}))}return!0})};var module$js$depgraph={};module$js$depgraph.generate=generate$$module$js$depgraph;module$js$depgraph.shuffle=shuffle$$module$js$depgraph;
module$js$depgraph.shuffle2=shuffle2$$module$js$depgraph;module$js$depgraph.shuffle3=shuffle3$$module$js$depgraph;class FetchReader$$module$js$fetchreader{constructor(a){this.path=void 0===a?"js/":a}read(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return a in STATIC$$module$js$fetchreader?STATIC$$module$js$fetchreader[a]:yield(yield fetch(b.path+a)).text()})}}const STATIC$$module$js$fetchreader={};var module$js$fetchreader={};module$js$fetchreader.FetchReader=FetchReader$$module$js$fetchreader;var Event$$module$js$graph$condition;
(function(a){a.STARTED_WINDMILL=Condition$$module$js$graph$condition(10);a.LEAF_ELDER=Condition$$module$js$graph$condition(11);a.UNDERGROUND_CHANNEL=Condition$$module$js$graph$condition(24);a.MESIA_RECORDING=Condition$$module$js$graph$condition(27);a.QUEEN_REVEALED=Condition$$module$js$graph$condition(30);a.RETURNED_FOG_LAMP=Condition$$module$js$graph$condition(33);a.GENERALS_DEFEATED=Condition$$module$js$graph$condition(36);a.HEALED_DOLPHIN=Condition$$module$js$graph$condition(37);a.ENTERED_SHYRON=
Condition$$module$js$graph$condition(38);a.SHYRON_MASSACRE=Condition$$module$js$graph$condition(39);a.LEAF_ABDUCTION=Condition$$module$js$graph$condition(56);a.ZEBU_CAVE=Condition$$module$js$graph$condition(58);a.ZEBU_SHYRON=Condition$$module$js$graph$condition(59);a.RESCUED_CHILD=Condition$$module$js$graph$condition(69);a.DWARF_MOTHER=Condition$$module$js$graph$condition(82);a.DWARF_CHILD=Condition$$module$js$graph$condition(83);a.STOM_IN_SWAN=Condition$$module$js$graph$condition(97);a.DRAYGON1=
Condition$$module$js$graph$condition(108);a.FOUND_KENSU=Condition$$module$js$graph$condition(114);a.SHELL_FLUTE=Condition$$module$js$graph$condition(139);a.RIDE_DOLPHIN=Condition$$module$js$graph$condition(155);a.ZEBU_STUDENT=Condition$$module$js$graph$condition(165);a.LEAF_RABBIT=Condition$$module$js$graph$condition(169);a.CALMED_SEA=Condition$$module$js$graph$condition(643);a.OPENED_JOEL_SHED=Condition$$module$js$graph$condition(647);a.OPENED_CRYPT=Condition$$module$js$graph$condition(654);a.OPENED_STYX=
Condition$$module$js$graph$condition(688);a.OPENED_SWAN=Condition$$module$js$graph$condition(691);a.OPENED_PRISON=Condition$$module$js$graph$condition(728);a.OPENED_SEALED_CAVE=Condition$$module$js$graph$condition(750);a.WARP_OAK=Condition$$module$js$graph$condition(759);a.WARP_JOEL=Condition$$module$js$graph$condition(763)})(Event$$module$js$graph$condition||(Event$$module$js$graph$condition={}));var Capability$$module$js$graph$condition;
(function(a){a.SWORD=Condition$$module$js$graph$condition(-1);a.MONEY=Condition$$module$js$graph$condition(-2);a.BREAK_STONE=Condition$$module$js$graph$condition(-3);a.BREAK_ICE=Condition$$module$js$graph$condition(-4);a.FORM_BRIDGE=Condition$$module$js$graph$condition(-5);a.BREAK_IRON=Condition$$module$js$graph$condition(-6);a.TRAVEL_SWAMP=Condition$$module$js$graph$condition(-7);a.CLIMB_WATERFALL=Condition$$module$js$graph$condition(-8);a.BUY_HEALING=Condition$$module$js$graph$condition(-9);a.BUY_WARP=
Condition$$module$js$graph$condition(-10);a.SHOOTING_STATUE=Condition$$module$js$graph$condition(-11);a.CLIMB_SLOPE=Condition$$module$js$graph$condition(-12)})(Capability$$module$js$graph$condition||(Capability$$module$js$graph$condition={}));function Boss$$module$js$graph$condition(a){return Condition$$module$js$graph$condition(256|a)}
(function(a){a.VAMPIRE1=a(0);a.INSECT=a(1);a.KELBESQUE1=a(2);a.RAGE=a(3);a.SABERA1=a(4);a.MADO1=a(5);a.KELBESQUE2=a(6);a.SABERA2=a(7);a.MADO2=a(8);a.KARMINE=a(9);a.DRAYGON1=a(10);a.DRAYGON2=a(11);a.VAMPIRE2=a(12)})(Boss$$module$js$graph$condition||(Boss$$module$js$graph$condition={}));function Item$$module$js$graph$condition(a){if(112<=a)throw Error(`expected item: ${a.toString(16)}`);return Condition$$module$js$graph$condition(512|a)}
(function(a){a.SWORD_OF_WIND=a(0);a.SWORD_OF_FIRE=a(1);a.SWORD_OF_WATER=a(2);a.SWORD_OF_THUNDER=a(3);a.CRYSTALIS=a(4);a.ORB_OF_WIND=a(5);a.TORNADO_BRACELET=a(6);a.ORB_OF_FIRE=a(7);a.FLAME_BRACELET=a(8);a.ORB_OF_WATER=a(9);a.BLIZZARD_BRACELET=a(10);a.ORB_OF_THUNDER=a(11);a.STORM_BRACELET=a(12);a.MEDICAL_HERB=a(29);a.WARP_BOOTS=a(36);a.STATUE_OF_ONYX=a(37);a.INSECT_FLUTE=a(39);a.FLUTE_OF_LIME=a(40);a.GAS_MASK=a(41);a.POWER_RING=a(42);a.WARRIOR_RING=a(43);a.IRON_NECKLACE=a(44);a.DEOS_PENDANT=a(45);a.RABBIT_BOOTS=
a(46);a.LEATHER_BOOTS=a(47);a.SHIELD_RING=a(48);a.ALARM_FLUTE=a(49);a.WINDMILL_KEY=a(50);a.KEY_TO_PRISON=a(51);a.KEY_TO_STYX=a(52);a.FOG_LAMP=a(53);a.SHELL_FLUTE=a(54);a.EYE_GLASSES=a(55);a.BROKEN_STATUE=a(56);a.GLOWING_LAMP=a(57);a.STATUE_OF_GOLD=and$$module$js$graph$condition(a.BROKEN_STATUE,a.GLOWING_LAMP);a.LOVE_PENDANT=a(59);a.KIRISA_PLANT=a(60);a.IVORY_STATUE=a(61);a.BOW_OF_MOON=a(62);a.BOW_OF_SUN=a(63);a.BOW_OF_TRUTH=a(64)})(Item$$module$js$graph$condition||(Item$$module$js$graph$condition=
{}));var Magic$$module$js$graph$condition;(function(a){a.REFRESH=Item$$module$js$graph$condition(65);a.PARALYSIS=Item$$module$js$graph$condition(66);a.TELEPATHY=Item$$module$js$graph$condition(67);a.TELEPORT=Item$$module$js$graph$condition(68);a.RECOVER=Item$$module$js$graph$condition(69);a.BARRIER=Item$$module$js$graph$condition(70);a.CHANGE=Item$$module$js$graph$condition(71);a.FLIGHT=Item$$module$js$graph$condition(72)})(Magic$$module$js$graph$condition||(Magic$$module$js$graph$condition={}));
var WallType$$module$js$graph$condition;(function(a){a[a.WIND=0]="WIND";a[a.FIRE=1]="FIRE";a[a.WATER=2]="WATER";a[a.THUNDER=3]="THUNDER"})(WallType$$module$js$graph$condition||(WallType$$module$js$graph$condition={}));
class MutableRequirement$$module$js$graph$condition{constructor(){this.map=new Map}[Symbol.iterator](){return this.map.values()}add(a,b){for(const a of b)if(Array.isArray(a))throw Error();if(this.map.has(a))return!1;for(const a of this.map){const [c,e]=a;if(containsAll$$module$js$graph$condition(b,e))return!1;containsAll$$module$js$graph$condition(e,b)&&this.map.delete(c)}this.map.set(a,b);return!0}addAll(a){for(const b of a)this.addList(b)}addList(a){a=[...new Set(a)].sort();const b=new Set(a);this.add(a.join(" "),
b)}restrict(a){const b=[...this.map.values()];this.map.clear();for(const c of b)for(const b of a)this.addList([...c,...b])}freeze(){return[...this].map((a)=>[...a])}}const containsAll$$module$js$graph$condition=(a,b)=>{if(a.size<b.size)return!1;for(const c of b)if(!a.has(c))return!1;return!0};function Condition$$module$js$graph$condition(a){return[[a]]}function and$$module$js$graph$condition(...a){return[[].concat(...a.map((a)=>a[0]))]}
function or$$module$js$graph$condition(...a){return[].concat(...a)}function meet$$module$js$graph$condition(a,b){const c=new MutableRequirement$$module$js$graph$condition;for(const d of a)for(const a of b)c.addList([...d,...a]);return c.freeze()}const meetReq$$module$js$graph$condition=meet$$module$js$graph$condition;(function(a){a.OPEN=[[]]})(Condition$$module$js$graph$condition||(Condition$$module$js$graph$condition={}));
function Slot$$module$js$graph$condition(a){return"number"===typeof a?a:a[0][0]}(function(a){a.item=function(a){return a|512}})(Slot$$module$js$graph$condition||(Slot$$module$js$graph$condition={}));var Check$$module$js$graph$condition;(function(a){a.chest=function(a){return{slot:Slot$$module$js$graph$condition(512|a)}}})(Check$$module$js$graph$condition||(Check$$module$js$graph$condition={}));var Terrain$$module$js$graph$condition;
(function(a){a.seamless=memoize$$module$js$graph$condition((a)=>Object.assign({},a));a.meet=function(a,c){const b={};if(a.enter||c.enter)b.enter=meet$$module$js$graph$condition(a.enter||[[]],c.enter||[[]]);if(a.exit||c.exit)b.exit=meet$$module$js$graph$condition(a.exit||[[]],c.exit||[[]]);if(a.exitSouth||c.exitSouth)b.exitSouth=meet$$module$js$graph$condition(a.exitSouth||[[]],c.exitSouth||[[]]);return b};a.join=function(a,c){const b={};if(a.enter||c.enter)b.enter=(a.enter||[[]]).concat(c.enter||
[[]]);if(a.exit||c.exit)b.exit=(a.exit||[[]]).concat(c.exit||[[]]);if(a.exitSouth||c.exitSouth)b.exitSouth=(a.exitSouth||[[]]).concat(c.exitSouth||[[]]);return b};a.flag=function(a){return{enter:Condition$$module$js$graph$condition(a)}}})(Terrain$$module$js$graph$condition||(Terrain$$module$js$graph$condition={}));function memoize$$module$js$graph$condition(a){const b=new WeakMap,c={};return(d)=>{let e=b.get(d);void 0===e?(e=a(d),b.set(d,void 0===e?c:e)):e===c&&(e=void 0);return e}}
function memoize2$$module$js$graph$condition(a){const b=new WeakMap,c={};return(d,e)=>{let f=b.get(d);void 0==f&&b.set(d,f=new WeakMap);let g=f.get(e);void 0===g?(g=a(d,e),f.set(e,void 0===g?c:g)):g===c&&(g=void 0);return g}}var module$js$graph$condition={};module$js$graph$condition.Event=Event$$module$js$graph$condition;module$js$graph$condition.Capability=Capability$$module$js$graph$condition;module$js$graph$condition.Boss=Boss$$module$js$graph$condition;module$js$graph$condition.Item=Item$$module$js$graph$condition;
module$js$graph$condition.Magic=Magic$$module$js$graph$condition;module$js$graph$condition.WallType=WallType$$module$js$graph$condition;module$js$graph$condition.MutableRequirement=MutableRequirement$$module$js$graph$condition;module$js$graph$condition.Condition=Condition$$module$js$graph$condition;module$js$graph$condition.and=and$$module$js$graph$condition;module$js$graph$condition.or=or$$module$js$graph$condition;module$js$graph$condition.meet=meet$$module$js$graph$condition;
module$js$graph$condition.Slot=Slot$$module$js$graph$condition;module$js$graph$condition.Check=Check$$module$js$graph$condition;module$js$graph$condition.Terrain=Terrain$$module$js$graph$condition;module$js$graph$condition.memoize=memoize$$module$js$graph$condition;module$js$graph$condition.memoize2=memoize2$$module$js$graph$condition;function TileId$$module$js$graph$geometry(a){return a}
(function(a){a.from=function({id:a},{x:c,y:d}){return a<<16|d>>>8<<12|c>>>8<<8|(d>>>4&15)<<4|c>>>4&15};a.add=function(a,c,d){if(c){for(c=(a&240)+(c<<4);240<=c;){if(61440<=(a&61440))return-1;c-=240;a+=4096}for(;0>c;){if(!(a&61440))return-1;c+=240;a-=4096}a=a&-241|c}if(d){for(d=(a&15)+d;16<=d;){if(1792<=(a&3840))return-1;d-=16;a+=256}for(;0>d;){if(!(a&3840))return-1;d+=16;a-=256}a=a&-16|d}return a}})(TileId$$module$js$graph$geometry||(TileId$$module$js$graph$geometry={}));
function ScreenId$$module$js$graph$geometry(a){return a}(function(a){a.from=(a,c)=>"number"!==typeof a&&c?a.id<<8|c.y>>>8<<4|c.x>>>8:Number(a)>>>8;a.fromTile=function(a){return a>>>8}})(ScreenId$$module$js$graph$geometry||(ScreenId$$module$js$graph$geometry={}));function TilePair$$module$js$graph$geometry(a){return a}
(function(a){a.of=function(a,c){return 16777216*a+c};a.split=function(a){return[Math.floor(a/16777216),a%16777216]}})(TilePair$$module$js$graph$geometry||(TilePair$$module$js$graph$geometry={}));
class Neighbors$$module$js$graph$geometry{constructor(a,b){this.tiles=a;this.exits=b;this.south=new Set;this.other=new Set}addAdjacent(a,b,c){const d=this.tiles.find(a),e=this.tiles.find(b);this.exits.has(b)||this.other.add(TilePair$$module$js$graph$geometry.of(e,d));this.exits.has(a)||(c?this.south:this.other).add(TilePair$$module$js$graph$geometry.of(d,e))}addExit(a,b){a=this.tiles.find(a);b=this.tiles.find(b);this.other.add(TilePair$$module$js$graph$geometry.of(a,b))}*[Symbol.iterator](){const a=
new Set;let b=!0;for(const c of module$js$util.iters.concat(this.south,[-1],this.other)){if(-1===c){b=!1;continue}let [d,e]=TilePair$$module$js$graph$geometry.split(c);d=this.tiles.find(d);e=this.tiles.find(e);const f=TilePair$$module$js$graph$geometry.of(d,e);a.has(f)||(a.add(f),yield{from:d,to:e,south:b})}}}var module$js$graph$geometry={};module$js$graph$geometry.TileId=TileId$$module$js$graph$geometry;module$js$graph$geometry.ScreenId=ScreenId$$module$js$graph$geometry;
module$js$graph$geometry.TilePair=TilePair$$module$js$graph$geometry;module$js$graph$geometry.Neighbors=Neighbors$$module$js$graph$geometry;class Entity$$module$js$rom$entity{constructor(a,b){this.rom=a;this.id=b}write(a){}toString(){return`${this.constructor.name} $${hex$$module$js$rom$util(this.id)}`}}var module$js$rom$entity={};module$js$rom$entity.Entity=Entity$$module$js$rom$entity;var ShopType$$module$js$rom$shop;(function(a){a[a.ARMOR=0]="ARMOR";a[a.TOOL=1]="TOOL";a[a.INN=2]="INN";a[a.PAWN=3]="PAWN"})(ShopType$$module$js$rom$shop||(ShopType$$module$js$rom$shop={}));
const SHOP_TYPES$$module$js$rom$shop=[ShopType$$module$js$rom$shop.ARMOR,ShopType$$module$js$rom$shop.TOOL,ShopType$$module$js$rom$shop.INN,ShopType$$module$js$rom$shop.PAWN],CONTENTS_ADDRESSES$$module$js$rom$shop=[(a,b)=>a?a:VANILLA_ARMOR_SHOP_ITEMS$$module$js$rom$shop,(a,b)=>a?a+4*b:VANILLA_TOOL_SHOP_ITEMS$$module$js$rom$shop,(a,b)=>0,(a,b)=>0],CONTENTS_COUNTS$$module$js$rom$shop=[4,4,0,0],PRICES_ADDRESSES$$module$js$rom$shop=[(a,b)=>a?a+8*b:VANILLA_ARMOR_SHOP_PRICES$$module$js$rom$shop,(a,b)=>
a?a+12*b:VANILLA_TOOL_SHOP_PRICES$$module$js$rom$shop,(a,b)=>a?a+16*b:VANILLA_INN_PRICES$$module$js$rom$shop,(a,b)=>0],PRICES_COUNTS$$module$js$rom$shop=[4,4,1,0];
class Shop$$module$js$rom$shop extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.type=SHOP_TYPES$$module$js$rom$shop[b&3];this.index=b>>>2;if(a.shopDataTablesAddress)this.location=a.prg[a.shopDataTablesAddress+17*a.shopCount+b];else{b=255;for(let d=0;33>d&&255===b;d++){if(a.prg[VANILLA_SHOP_INDICES$$module$js$rom$shop+d]!==this.index)continue;const e=a.prg[VANILLA_SHOP_LOCATIONS$$module$js$rom$shop+d];for(var c of a.locations[e].spawns)if(4===c.type&&a.objects[c.id].data[25]===
32+this.type){b=e;break}}this.location=b}c=a.shopDataTablesAddress?(b)=>a.prg[this.pricesAddress+b]/32:(b)=>readLittleEndian$$module$js$rom$util(a.prg,this.pricesAddress+2*b);this.contents=tuple$$module$js$rom$util(a.prg,this.contentsAddress,CONTENTS_COUNTS$$module$js$rom$shop[this.type]);this.prices=seq$$module$js$rom$util(PRICES_COUNTS$$module$js$rom$shop[this.type],c);this.used=255!==this.location}get contentsAddress(){return CONTENTS_ADDRESSES$$module$js$rom$shop[this.type](this.rom.shopDataTablesAddress,
this.rom.shopCount)+4*this.index}get pricesAddress(){const a=this.rom.shopDataTablesAddress;return PRICES_ADDRESSES$$module$js$rom$shop[this.type](a,this.rom.shopCount)+(a?1:2)*PRICES_COUNTS$$module$js$rom$shop[this.type]*this.index}updateShopkeeper(){throw Error("not implemented");}write(a){const b=this.rom.shopDataTablesAddress,c=a.rom;a=b?(a,b)=>c[this.pricesAddress+a]=Math.round(32*b):(a,b)=>writeLittleEndian$$module$js$rom$util(c,this.pricesAddress+2*a,b);for(var d=0;d<CONTENTS_COUNTS$$module$js$rom$shop[this.type];d++)c[this.contentsAddress+
d]=null!=this.contents[d]?this.contents[d]:255;for(d=0;d<PRICES_COUNTS$$module$js$rom$shop[this.type];d++)a(d,this.prices[d]||0);b&&(c[b+17*this.rom.shopCount+this.id]=this.location)}}
const VANILLA_SHOP_LOCATIONS$$module$js$rom$shop=139092,VANILLA_SHOP_INDICES$$module$js$rom$shop=139125,VANILLA_ARMOR_SHOP_ITEMS$$module$js$rom$shop=138660,VANILLA_ARMOR_SHOP_PRICES$$module$js$rom$shop=138704,VANILLA_TOOL_SHOP_ITEMS$$module$js$rom$shop=138792,VANILLA_TOOL_SHOP_PRICES$$module$js$rom$shop=138836,VANILLA_INN_PRICES$$module$js$rom$shop=138924;var module$js$rom$shop={};module$js$rom$shop.ShopType=ShopType$$module$js$rom$shop;module$js$rom$shop.Shop=Shop$$module$js$rom$shop;const RELEVANT_FLAGS$$module$js$graph$overlay=[10,11,24,27,30,33,36,37,38,39,56,58,59,69,82,83,97,114,139,155,165,169,256,257,258,259,260,261,262,263,264,265,266,267,268,512,513,514,515,517,518,519,520,521,522,523,524,566,579,580,643,750,759,763],FLAG_MAP$$module$js$graph$overlay=new Map([[10,module$js$graph$condition.Event.STARTED_WINDMILL],[19,module$js$graph$condition.Boss.SABERA1],[23,module$js$graph$condition.Item.SWORD_OF_WATER],[40,module$js$graph$condition.Magic.CHANGE],[41,module$js$graph$condition.Magic.CHANGE],
[42,module$js$graph$condition.Magic.CHANGE],[43,module$js$graph$condition.Magic.CHANGE],[108,module$js$graph$condition.Boss.DRAYGON1],[139,module$js$graph$condition.Item.SHELL_FLUTE]]),TRIGGER_ACTION_ITEMS$$module$js$graph$overlay={8:module$js$graph$condition.Slot(module$js$graph$condition.Magic.PARALYSIS),11:module$js$graph$condition.Slot(module$js$graph$condition.Magic.BARRIER),15:module$js$graph$condition.Slot(module$js$graph$condition.Magic.REFRESH),24:module$js$graph$condition.Slot(module$js$graph$condition.Magic.TELEPATHY)},
SWORDS$$module$js$graph$overlay=[module$js$graph$condition.Item.SWORD_OF_WIND,module$js$graph$condition.Item.SWORD_OF_FIRE,module$js$graph$condition.Item.SWORD_OF_WATER,module$js$graph$condition.Item.SWORD_OF_THUNDER],SWORD_POWERS$$module$js$graph$overlay=[[module$js$graph$condition.Item.ORB_OF_WIND,module$js$graph$condition.Item.TORNADO_BRACELET],[module$js$graph$condition.Item.ORB_OF_FIRE,module$js$graph$condition.Item.FLAME_BRACELET],[module$js$graph$condition.Item.ORB_OF_WATER,module$js$graph$condition.Item.BLIZZARD_BRACELET],
[module$js$graph$condition.Item.ORB_OF_THUNDER,module$js$graph$condition.Item.STORM_BRACELET]];
function swordRequirement$$module$js$graph$overlay(a,b){b=1===b?SWORDS$$module$js$graph$overlay[a]:3===b?and$$module$js$graph$condition(SWORDS$$module$js$graph$overlay[a],...SWORD_POWERS$$module$js$graph$overlay[a]):or$$module$js$graph$condition(...SWORD_POWERS$$module$js$graph$overlay[a].map((b)=>and$$module$js$graph$condition(SWORDS$$module$js$graph$overlay[a],b)));if(Array.isArray(b[0][0]))throw Error();return b}
class Overlay$$module$js$graph$overlay{constructor(a,b,c){this.rom=a;this.flags=b;this.tracker=c;this.relevantFlags=new Set;this.tradeIns=new Map;this.shootingStatues=new Set;for(const a of RELEVANT_FLAGS$$module$js$graph$overlay)this.relevantFlags.add(a);for(const d of a.items)if(d.tradeIn)for(b=29===d.id?module$js$graph$condition.Capability.BUY_HEALING:module$js$graph$condition.Item(d.id),c=0;c<d.tradeIn.length;c+=6)this.tradeIns.set(d.tradeIn[c],b);for(const b of a.locations)for(const a of b.spawns)a.isMonster()&&
63===a.id&&this.shootingStatues.add(module$js$graph$geometry.ScreenId.from(b,a))}bossRequirements(a){if(a===this.rom.bosses.rage)return this.tracker&&this.flags.randomizeTrades()?module$js$graph$condition.Capability.SWORD:module$js$graph$condition.Condition(this.rom.npcs[195].localDialogs.get(-1)[0].condition);var b=a.object;const c=new MutableRequirement$$module$js$graph$condition;if(this.tracker&&this.flags.shuffleBossElements())c.addAll(module$js$graph$condition.Capability.SWORD);else if(this.flags.guaranteeMatchingSword()){var d=
this.flags.guaranteeSwordMagic()?a.swordLevel:1;b=this.rom.objects[b];for(let a=0;4>a;a++)b.isVulnerable(a)&&c.addAll(swordRequirement$$module$js$graph$overlay(a,d))}else c.addAll(module$js$graph$condition.Capability.SWORD);d=[];this.flags.guaranteeRefresh()&&d.push(module$js$graph$condition.Magic.REFRESH);a===this.rom.bosses.insect&&d.push(module$js$graph$condition.Item.INSECT_FLUTE,module$js$graph$condition.Item.GAS_MASK);a===this.rom.bosses.draygon2&&(d.push(module$js$graph$condition.Item.BOW_OF_TRUTH),
this.flags.storyMode()&&d.push(module$js$graph$condition.Boss.KELBESQUE1,module$js$graph$condition.Boss.KELBESQUE2,module$js$graph$condition.Boss.SABERA1,module$js$graph$condition.Boss.SABERA2,module$js$graph$condition.Boss.MADO1,module$js$graph$condition.Boss.MADO2,module$js$graph$condition.Boss.KARMINE,module$js$graph$condition.Boss.DRAYGON1,module$js$graph$condition.Item.SWORD_OF_WIND,module$js$graph$condition.Item.SWORD_OF_FIRE,module$js$graph$condition.Item.SWORD_OF_WATER,module$js$graph$condition.Item.SWORD_OF_THUNDER));
d.length&&c.restrict(and$$module$js$graph$condition(...d));return c.freeze()}locations(){const a=[];a.push({tile:module$js$graph$geometry.TileId(983176),slot:module$js$graph$condition.Slot(module$js$graph$condition.Event.STARTED_WINDMILL),condition:module$js$graph$condition.Item.WINDMILL_KEY},{tile:module$js$graph$geometry.TileId(14942344),slot:module$js$graph$condition.Slot(module$js$graph$condition.Event.OPENED_JOEL_SHED),condition:module$js$graph$condition.Item.EYE_GLASSES});for(const b of this.rom.shops){if(195===
b.location||246===b.location)continue;if(!b.used)continue;if(b.type!==module$js$rom$shop.ShopType.TOOL)continue;const c={tile:module$js$graph$geometry.TileId(b.location<<16|136),condition:module$js$graph$condition.Capability.MONEY};for(const d of b.contents)d===(module$js$graph$condition.Item.MEDICAL_HERB[0][0]&255)?a.push(Object.assign({},c,{slot:module$js$graph$condition.Slot(module$js$graph$condition.Capability.BUY_HEALING)})):d===(module$js$graph$condition.Item.WARP_BOOTS[0][0]&255)&&a.push(Object.assign({},
c,{slot:module$js$graph$condition.Slot(module$js$graph$condition.Capability.BUY_WARP)}))}return a}makeTerrain(a,b){var c=b>>>16;a&=38;26===c&&(a|=8);if(96===c||104===c)a|=16;100===c&&144>(b&61680)&&(a|=16);this.shootingStatues.has(module$js$graph$geometry.ScreenId.fromTile(b))&&(a|=1);if(a&32){c=(a)=>{const b=this.rom.locations[a>>>16];return this.rom.tileEffects[b.tileEffects-179].effects[this.rom.screens[b.screens[(a&61440)>>>12][(a&3840)>>>8]].tiles[a&255]]};let d=b,e=-1;for(;c(d)&32;)d=module$js$graph$geometry.TileId.add(d,
1,0),e++;for(;c(b)&32;)b=module$js$graph$geometry.TileId.add(b,-1,0),e++;6>e?a&=-33:9>e&&(a|=64)}return TERRAINS$$module$js$graph$overlay[a]}extraRoutes(){const a=[],b=(a,b)=>{a=this.rom.locations[a];return module$js$graph$geometry.TileId.from(a,a.entrances[void 0===b?0:b])};a.push({tile:b(0)});this.flags.teleportOnThunderSword()&&a.push({tile:b(242),condition:or$$module$js$graph$condition(and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_THUNDER,module$js$graph$condition.Capability.BUY_WARP),
and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_THUNDER,module$js$graph$condition.Magic.TELEPORT))});if(this.flags.assumeWildWarp())for(const c of this.rom.wildWarp.locations)a.push({tile:b(c)});return a}extraEdges(){const a=[];a.push({from:module$js$graph$geometry.TileId(5308552),to:module$js$graph$geometry.TileId(6325896),condition:module$js$graph$condition.Event.RETURNED_FOG_LAMP});return a}trigger(a){function b(a){if(0>a)return~b(~a);const c=FLAG_MAP$$module$js$graph$overlay.get(a);
return null!=c?c[0][0]:a}switch(a){case 154:return{check:[{condition:meet$$module$js$graph$condition(module$js$graph$condition.Event.SHYRON_MASSACRE,this.bossRequirements(this.rom.bosses.mado1)),slot:module$js$graph$condition.Slot(module$js$graph$condition.Boss.MADO1)}]};case 170:return{check:[{condition:and$$module$js$graph$condition(module$js$graph$condition.Event.DWARF_CHILD,module$js$graph$condition.Capability.BUY_WARP),slot:module$js$graph$condition.Slot(module$js$graph$condition.Event.RESCUED_CHILD)}]};
case 173:return{check:[{condition:module$js$graph$condition.Item.KEY_TO_PRISON,slot:module$js$graph$condition.Slot(module$js$graph$condition.Event.OPENED_PRISON)}]};case 174:return{check:[{condition:module$js$graph$condition.Item.KEY_TO_STYX,slot:module$js$graph$condition.Slot(module$js$graph$condition.Event.OPENED_STYX)}]};case 175:return{check:[{condition:module$js$graph$condition.Item.STATUE_OF_GOLD,slot:module$js$graph$condition.Slot(module$js$graph$condition.Event.CALMED_SEA)}]};case 177:return{check:[{condition:and$$module$js$graph$condition(module$js$graph$condition.Item.BOW_OF_SUN,
module$js$graph$condition.Item.BOW_OF_MOON),slot:module$js$graph$condition.Slot(module$js$graph$condition.Event.OPENED_CRYPT)}]}}var c=this.rom.triggers[a&127];if(!c||!c.used)throw Error(`Unknown trigger: ${hex$$module$js$rom$util(a)}`);const d=(a)=>this.relevantFlags.has(a);a=(a)=>0<a&&this.relevantFlags.has(a);var e=TRIGGER_ACTION_ITEMS$$module$js$graph$overlay[c.message.action];const f=and$$module$js$graph$condition(...c.conditions.map(b).filter(a).map(module$js$graph$condition.Condition));if(25===
c.message.action){e={};134!==c.id||this.flags.assumeRabbitSkip()||(e.dx=[-32,-16,0,16]);186!==c.id||this.flags.disableTeleportSkip()||this.flags.assumeTeleportSkip()||(e.extraLocations=[this.rom.locations.cordelPlainsWest]);const a=c.conditions.map((a)=>0>a&&d(~b(a))?module$js$graph$condition.Condition(~b(a)):null).filter((a)=>null!=a);if(a&&a.length)return Object.assign({},e,{terrain:{exit:or$$module$js$graph$condition(...a)}})}else if(null!=e)return{check:[{condition:f,slot:e}]};c=c.flags.filter(a);
return c.length?{check:c.map((a)=>({condition:f,slot:module$js$graph$condition.Slot(a)}))}:{}}npc(a,b){function c(...a){if(!f.terrain)throw Error("Missing terrain for guard");f.terrain.exit=or$$module$js$graph$condition(f.terrain.exit||[],...a)}const d=this.rom.npcs[a];if(!d||!d.used)throw Error(`Unknown trigger: ${hex$$module$js$rom$util(a)}`);const e=d.spawnConditions.get(b.id)||[],f={check:[]};d.data[2]&4&&(f.terrain={exit:this.flags.assumeStatueGlitch()?[[]]:or$$module$js$graph$condition(...e.map((a)=>
FLAG_MAP$$module$js$graph$overlay.get(a)||(this.relevantFlags.has(a)?module$js$graph$condition.Condition(a):[])))});switch(a){case 20:if(b.spawns.find((a)=>a.isNpc()&&21===a.id))return{};case 37:f.hitbox={x0:0,x1:2,y0:0,y1:1};c(module$js$graph$condition.Magic.CHANGE,module$js$graph$condition.Magic.PARALYSIS);break;case 45:delete f.terrain;break;case 51:c(module$js$graph$condition.Magic.PARALYSIS);break;case 56:223===b.id&&(f.hitbox={x0:0,x1:1,y0:2,y1:3});break;case 78:f.hitbox={x0:-1,x1:2,y0:0,y1:1};
c(module$js$graph$condition.Magic.CHANGE,module$js$graph$condition.Event.ENTERED_SHYRON);break;case 128:c(...e.map((a)=>module$js$graph$condition.Condition(~a)));break;case 133:c(module$js$graph$condition.Item.FLUTE_OF_LIME)}const g=[];var h=(a)=>{0>=a||(a=FLAG_MAP$$module$js$graph$overlay.get(a)||(this.relevantFlags.has(a)?module$js$graph$condition.Condition(a):null),null!=a&&g.push(a))};for(var k of e)h(k);var l=this.tradeIns.get(a);if(null!=l){k=function(a,...c){c=and$$module$js$graph$condition(...g,
b,...c);f.check.push({slot:a,condition:c})};const b=l;l=k;this.tracker&&this.flags.randomizeTrades()&&(l=(a,...b)=>{const c=or$$module$js$graph$condition(...[module$js$graph$condition.Item.STATUE_OF_ONYX,module$js$graph$condition.Item.FOG_LAMP,module$js$graph$condition.Item.LOVE_PENDANT,module$js$graph$condition.Item.KIRISA_PLANT,module$js$graph$condition.Item.IVORY_STATUE].map((a)=>and$$module$js$graph$condition(...g,a,...b)));f.check.push({slot:a,condition:c})});switch(a){case 21:k(module$js$graph$condition.Slot(module$js$graph$condition.Item.WINDMILL_KEY));
break;case 35:f.hitbox={x0:-1,x1:2,y0:-1,y1:2};l(module$js$graph$condition.Slot(module$js$graph$condition.Item.BOW_OF_MOON),module$js$graph$condition.Magic.CHANGE);break;case 99:f.hitbox={x0:-1,x1:2,y0:-1,y1:2};k(module$js$graph$condition.Slot(module$js$graph$condition.Event.HEALED_DOLPHIN));k(module$js$graph$condition.Slot(module$js$graph$condition.Item.SHELL_FLUTE));break;case 100:l(module$js$graph$condition.Slot(module$js$graph$condition.Event.RETURNED_FOG_LAMP),...this.flags.requireHealedDolphinToRide()?
[module$js$graph$condition.Event.HEALED_DOLPHIN]:[]);break;case 107:k(module$js$graph$condition.Slot(module$js$graph$condition.Item.GLOWING_LAMP));break;case 117:l(module$js$graph$condition.Slot(module$js$graph$condition.Magic.FLIGHT));break;case 116:l(module$js$graph$condition.Slot(module$js$graph$condition.Magic.CHANGE),module$js$graph$condition.Magic.PARALYSIS,module$js$graph$condition.Event.FOUND_KENSU);break;case 130:l(module$js$graph$condition.Slot(module$js$graph$condition.Item.GAS_MASK));
break;case 136:k(module$js$graph$condition.Slot(module$js$graph$condition.Item.SHIELD_RING))}}if(132===a)return{check:[{condition:this.bossRequirements(this.rom.bosses.sabera1),slot:module$js$graph$condition.Slot(module$js$graph$condition.Boss.SABERA1)}]};if(29===a)return a=module$js$graph$condition.Slot(module$js$graph$condition.Item.SWORD_OF_FIRE),{check:[{condition:and$$module$js$graph$condition(module$js$graph$condition.Magic.TELEPATHY,module$js$graph$condition.Boss.INSECT),slot:a},{condition:module$js$graph$condition.Event.RESCUED_CHILD,
slot:a}]};if(31===a)return(a=this.rom.npcs[a].spawnConditions.get(b.id))&&a.includes(69)?{}:{check:[{condition:module$js$graph$condition.Event.DWARF_MOTHER,slot:module$js$graph$condition.Slot(module$js$graph$condition.Event.DWARF_CHILD)}]};for(var m of d.globalDialogs)h(~m.condition);for(const c of d.localDialogs.get(b.id)||d.localDialogs.get(-1)||[])if(!e.includes(~c.condition)){b=(b=FLAG_MAP$$module$js$graph$overlay.get(c.condition))?[b]:this.relevantFlags.has(c.condition)?[module$js$graph$condition.Condition(c.condition)]:
[];h=and$$module$js$graph$condition(...b,...g);m=FLAG_MAP$$module$js$graph$overlay.get(~c.condition)||(this.relevantFlags.has(~c.condition)?module$js$graph$condition.Condition(~c.condition):null);null!=m&&g.push(m);m=c.message.action;3===m?f.check.push({slot:module$js$graph$condition.Slot.item(d.data[0]),condition:h}):17===m||9===m?f.check.push({slot:module$js$graph$condition.Slot.item(d.data[1]),condition:h}):16===m?f.check.push({slot:module$js$graph$condition.Slot(module$js$graph$condition.Magic.RECOVER),
condition:h}):8===m&&45===a&&f.check.push({slot:module$js$graph$condition.Slot(module$js$graph$condition.Event.OPENED_SWAN),condition:h});for(const a of c.flags)(m=(m=FLAG_MAP$$module$js$graph$overlay.get(a))?m:this.relevantFlags.has(a)?module$js$graph$condition.Condition(a):null)&&f.check.push({slot:module$js$graph$condition.Slot(m),condition:h});if(b.length&&e.includes(c.condition))break}return f}capabilities(){var a=module$js$graph$condition.Item.SWORD_OF_WIND;let b=module$js$graph$condition.Item.SWORD_OF_FIRE,
c=module$js$graph$condition.Item.SWORD_OF_WATER,d=module$js$graph$condition.Item.SWORD_OF_THUNDER;if(!this.flags.orbsOptional()&&(a=or$$module$js$graph$condition(and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_WIND,module$js$graph$condition.Item.ORB_OF_WIND),and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_WIND,module$js$graph$condition.Item.TORNADO_BRACELET)),b=or$$module$js$graph$condition(and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_FIRE,
module$js$graph$condition.Item.ORB_OF_FIRE),and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_FIRE,module$js$graph$condition.Item.FLAME_BRACELET)),c=or$$module$js$graph$condition(and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_WATER,module$js$graph$condition.Item.ORB_OF_WATER),and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_WATER,module$js$graph$condition.Item.BLIZZARD_BRACELET)),d=or$$module$js$graph$condition(and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_THUNDER,
module$js$graph$condition.Item.ORB_OF_THUNDER),and$$module$js$graph$condition(module$js$graph$condition.Item.SWORD_OF_THUNDER,module$js$graph$condition.Item.STORM_BRACELET)),this.flags.assumeSwordChargeGlitch())){var e=function(a){const b=a[0][0];return f.map((a)=>a[0]===b?a:[b,...a])};const f=or$$module$js$graph$condition(a,b,c,d);a=e(module$js$graph$condition.Item.SWORD_OF_WIND);b=e(module$js$graph$condition.Item.SWORD_OF_FIRE);c=e(module$js$graph$condition.Item.SWORD_OF_WATER);d=e(module$js$graph$condition.Item.SWORD_OF_THUNDER)}a=
[[module$js$graph$condition.Capability.SWORD,module$js$graph$condition.Item.SWORD_OF_WIND,module$js$graph$condition.Item.SWORD_OF_FIRE,module$js$graph$condition.Item.SWORD_OF_WATER,module$js$graph$condition.Item.SWORD_OF_THUNDER],[module$js$graph$condition.Capability.BREAK_STONE,a],[module$js$graph$condition.Capability.BREAK_ICE,b],[module$js$graph$condition.Capability.FORM_BRIDGE,c],[module$js$graph$condition.Capability.BREAK_IRON,d],[module$js$graph$condition.Capability.MONEY,module$js$graph$condition.Capability.SWORD],
[module$js$graph$condition.Capability.CLIMB_WATERFALL,module$js$graph$condition.Magic.FLIGHT],[module$js$graph$condition.Capability.SHOOTING_STATUE,module$js$graph$condition.Magic.BARRIER],[module$js$graph$condition.Capability.CLIMB_SLOPE,module$js$graph$condition.Item.RABBIT_BOOTS,module$js$graph$condition.Magic.FLIGHT],[module$js$graph$condition.Event.GENERALS_DEFEATED,module$js$graph$condition.Item.IVORY_STATUE],[module$js$graph$condition.Event.OPENED_SEALED_CAVE,module$js$graph$condition.Event.STARTED_WINDMILL]];
this.flags.assumeGhettoFlight()&&a.push([module$js$graph$condition.Capability.CLIMB_WATERFALL,and$$module$js$graph$condition(module$js$graph$condition.Event.RIDE_DOLPHIN,module$js$graph$condition.Item.RABBIT_BOOTS)]);this.flags.guaranteeBarrier()||a.push([module$js$graph$condition.Capability.SHOOTING_STATUE,and$$module$js$graph$condition(module$js$graph$condition.Capability.MONEY,module$js$graph$condition.Capability.BUY_HEALING),and$$module$js$graph$condition(module$js$graph$condition.Capability.MONEY,
module$js$graph$condition.Item.SHIELD_RING),and$$module$js$graph$condition(module$js$graph$condition.Capability.MONEY,module$js$graph$condition.Magic.REFRESH)]);this.flags.leatherBootsGiveSpeed()&&a.push([module$js$graph$condition.Capability.CLIMB_SLOPE,module$js$graph$condition.Item.LEATHER_BOOTS]);for(const b of this.rom.bosses)null!=b.kill&&null!=b.drop&&a.push([module$js$graph$condition.Item(b.drop),module$js$graph$condition.Boss(b.kill)]);a.push([module$js$graph$condition.Item.ORB_OF_WATER,module$js$graph$condition.Boss.RAGE]);
this.flags.guaranteeGasMask()?a.push([module$js$graph$condition.Capability.TRAVEL_SWAMP,module$js$graph$condition.Item.GAS_MASK]):a.push([module$js$graph$condition.Capability.TRAVEL_SWAMP,or$$module$js$graph$condition(module$js$graph$condition.Item.GAS_MASK,and$$module$js$graph$condition(module$js$graph$condition.Capability.MONEY,module$js$graph$condition.Item.MEDICAL_HERB),and$$module$js$graph$condition(module$js$graph$condition.Capability.MONEY,module$js$graph$condition.Magic.REFRESH))]);return a.map((a)=>
{var [b,...c]=a;return{capability:b,condition:or$$module$js$graph$condition(...c)}})}wallCapability(a){return{flag:[module$js$graph$condition.Capability.BREAK_STONE,module$js$graph$condition.Capability.BREAK_ICE,module$js$graph$condition.Capability.FORM_BRIDGE,module$js$graph$condition.Capability.BREAK_IRON][a][0][0]}}}
const TERRAINS$$module$js$graph$overlay=(()=>{function a(a){if(!(a&4)){var b={};18===(a&18)?(a&32&&(b.exit=module$js$graph$condition.Capability.CLIMB_WATERFALL),b.enter=or$$module$js$graph$condition(module$js$graph$condition.Event.RIDE_DOLPHIN,module$js$graph$condition.Magic.FLIGHT)):(a&64?b.exit=module$js$graph$condition.Capability.CLIMB_SLOPE:a&32&&(b.exit=module$js$graph$condition.Magic.FLIGHT),a&2&&(b.enter=module$js$graph$condition.Magic.FLIGHT));a&8&&(b.enter=(b.enter||[[]]).map((a)=>module$js$graph$condition.Capability.TRAVEL_SWAMP[0].concat(a)));
a&1&&(b.enter=(b.enter||[[]]).map((a)=>module$js$graph$condition.Capability.SHOOTING_STATUE[0].concat(a)));return b}}const b=[];for(let c=0;128>c;c++)b[c]=a(c);return b})();var module$js$graph$overlay={};module$js$graph$overlay.Overlay=Overlay$$module$js$graph$overlay;class Routes$$module$js$graph$routes{constructor(){this.routes=new DefaultMap$$module$js$util(()=>new MutableRequirement$$module$js$graph$condition);this.edges=new DefaultMap$$module$js$util(()=>new Map)}addEdge(a,b,c){const d=LabeledRoute$$module$js$graph$routes(a,c);this.edges.get(b).set(d.label,d);for(const d of this.routes.get(b))this.addRoute(a,[...d,...c])}addRoute(a,b){const c=new Map,d=new Set;a=LabeledRoute$$module$js$graph$routes(a,b);c.set(a.label,a);for(a=c.values();;){const {value:b,
done:f}=a.next();if(f)break;d.add(b.label);c.delete(b.label);for(const a of this.addRouteInternal(b))d.has(a.label)||(c.delete(a.label),c.set(a.label,a))}}addRouteInternal({target:a,depsLabel:b,deps:c}){if(!this.routes.get(a).add(b,c))return[];b=new Map;for(const d of this.edges.get(a).values())a=LabeledRoute$$module$js$graph$routes(d.target,[...c,...d.deps]),b.set(a.label,a);return b.values()}}
function LabeledRoute$$module$js$graph$routes(a,b){var c=[...new Set(b)].sort();b=new Set(c);c=c.join(" ");return{target:a,deps:b,label:`${a}:${c}`,depsLabel:c}}var module$js$graph$routes={};module$js$graph$routes.Routes=Routes$$module$js$graph$routes;module$js$graph$routes.LabeledRoute=LabeledRoute$$module$js$graph$routes;class GenericFill$$module$js$graph$shuffle{constructor(){this.slots=[];this.items=[]}set(a,b){if(null!=this.slots[a])throw Error(`already filled slot ${a}`);if(null!=this.items[b])throw Error(`already filled item ${b}`);this.slots[a]=b;this.items[b]=a}hasSlot(a){return null!=this.slots[a]}hasItem(a){return null!=this.items[a]}}
function expandFill$$module$js$graph$shuffle(a,b){const c=new GenericFill$$module$js$graph$shuffle;for(let d=a.fixed;d<a.items.length;d++)c.set(a.slots[b.items[d]].item,a.items[d].item);return c}function newFill$$module$js$graph$shuffle(){return new GenericFill$$module$js$graph$shuffle}
function traverse$$module$js$graph$shuffle(a,b,c){c=Bits$$module$js$bits.clone(c);const d=new Set,e=new Set;for(var f=0;f<a.slots.length;f++){if(null==a.graph[f])throw console.dir(a),Error(`adding bad node ${f} (${a.slots[f].name}) from slot`);e.add(f)}for(const g of e)if(e.delete(g),!d.has(g)){f=a.graph[g];if(null==f)throw Error(`not in graph: ${g}`);for(let h=0,k=f.length;h<k;h++)if(Bits$$module$js$bits.containsAll(c,f[h])){d.add(g);f=g<a.fixed?g:b.slots[g];if(null!=f){c=Bits$$module$js$bits.with(c,
f);for(const b of a.unlocks[f]||[]){if(null==a.graph[b])throw console.dir(a),Error(`adding bad node ${b} from unlock ${f}`);e.add(b)}}break}}return d}
function traverseFill$$module$js$graph$shuffle(a,b){var c=[];for(var d of a.items)null!=d.item&&(c[d.item]=d.index);d=[];for(var e of a.slots)null!=e.item&&null!=b.slots[e.item]&&(d[e.index]=c[b.slots[e.item]]);b=[];c=Bits$$module$js$bits.of();e=new Set;const f=new Set;for(var g=0;g<a.slots.length;g++)f.add(g);for(const h of f)if(f.delete(h),!e.has(h)){g=a.graph[h];for(let k=0,l=g.length;k<l;k++)if(Bits$$module$js$bits.containsAll(c,g[k])){b.push([h,...Bits$$module$js$bits.bits(g[k])]);e.add(h);g=
h<a.fixed?h:d[h];if(null!=g){c=Bits$$module$js$bits.with(c,g);for(const b of a.unlocks[g]||[])f.add(b)}break}}return b}var Type$$module$js$graph$shuffle;(function(a){a[a.EMPTY=0]="EMPTY";a[a.MIMIC=1]="MIMIC";a[a.CONSUMABLE=2]="CONSUMABLE";a[a.KEY=3]="KEY";a[a.BOSS_DROP=4]="BOSS_DROP";a[a.NPC=5]="NPC";a[a.MAGIC=6]="MAGIC";a[a.TRIGGER=7]="TRIGGER"})(Type$$module$js$graph$shuffle||(Type$$module$js$graph$shuffle={}));
class ShuffleRules$$module$js$graph$shuffle{constructor(a,b){this.rom=a;this.pools=new Map;const c=new Set([65,66,70]),d=new Set,e=new Set;for(var f of a.locations)if(f.used)for(var g of f.spawns)g.isInvisible()?e.add(g.id):g.isChest()&&(null!=f.bossId()?e.add(g.id):d.add(g.id));for(const b of a.bosses)null!=b.drop&&e.add(b.drop);this.slotTypes=seq$$module$js$rom$util(124,(b)=>{if(c.has(b))return Type$$module$js$graph$shuffle.TRIGGER;if(112<=b)return Type$$module$js$graph$shuffle.MIMIC;if(72>=b&&
65<=b)return Type$$module$js$graph$shuffle.MAGIC;const f=a.items[b];return d.has(b)?f&&f.unique?Type$$module$js$graph$shuffle.KEY:Type$$module$js$graph$shuffle.CONSUMABLE:e.has(b)?Type$$module$js$graph$shuffle.BOSS_DROP:f&&f.unique?Type$$module$js$graph$shuffle.NPC:Type$$module$js$graph$shuffle.EMPTY});b=b.get("S")||[];for(f=0;f<b.length;f++)g=b[f],/c/.test(g)&&this.pools.set(Type$$module$js$graph$shuffle.CONSUMABLE,f+1),/t/.test(g)&&this.pools.set(Type$$module$js$graph$shuffle.MIMIC,f+1),/k/.test(g)&&
(this.pools.set(Type$$module$js$graph$shuffle.KEY,f+1),this.pools.set(Type$$module$js$graph$shuffle.BOSS_DROP,f+1),this.pools.set(Type$$module$js$graph$shuffle.NPC,f+1)),/m/.test(g)&&(this.pools.set(Type$$module$js$graph$shuffle.MAGIC,f+1),this.pools.set(Type$$module$js$graph$shuffle.TRIGGER,f+1))}fits(a,b){if(a===b)return!0;const c=this.slotTypes[a]||Type$$module$js$graph$shuffle.EMPTY;a=this.pools.get(c);if(null==a)return!1;if(112<=b){if(c>Type$$module$js$graph$shuffle.KEY)return!1;b=this.pools.get(Type$$module$js$graph$shuffle.MIMIC)}else if(72>=
b&&65<=b)b=this.pools.get(Type$$module$js$graph$shuffle.MAGIC);else if(65>b&&this.rom.items[b].unique)b=this.pools.get(Type$$module$js$graph$shuffle.KEY);else if(null==this.pools.get(Type$$module$js$graph$shuffle.CONSUMABLE)&&this.slotTypes[b]===Type$$module$js$graph$shuffle.BOSS_DROP)b=this.pools.get(Type$$module$js$graph$shuffle.BOSS_DROP);else{if(c===Type$$module$js$graph$shuffle.TRIGGER)return!1;b=this.pools.get(Type$$module$js$graph$shuffle.CONSUMABLE)}return null==b?!1:a===b?!0:b===this.pools.get(Type$$module$js$graph$shuffle.CONSUMABLE)}shouldShuffle(a){return null!=
this.pools.get(this.slotTypes[a]||0)}isEarly(a){a=this.slotTypes[a]||Type$$module$js$graph$shuffle.EMPTY;if(a>=Type$$module$js$graph$shuffle.TRIGGER)return!0;a=this.pools.get(a);const b=this.pools.get(Type$$module$js$graph$shuffle.CONSUMABLE),c=this.pools.get(Type$$module$js$graph$shuffle.MIMIC);return a!==b&&a!==c}}
class AssumedFill$$module$js$graph$shuffle{constructor(a,b){this.rom=a;this.flags=b;this.shuffleRules=new ShuffleRules$$module$js$graph$shuffle(a,b)}fits(a,b){return this.shuffleRules.fits(a,b)}items(a,b){const c=[];for(const b of a.items)if(null!=b.item){a=1;if(0===b.item||1===b.item)a=5;2===b.item&&(a=10);if(3===b.item||72===b.item)a=15;for(let d=0;d<a;d++)c.push(b.index)}b.shuffle(c);return c}shuffle(a,b,c,d){d=void 0===d?2E3:d;const e=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){c&&
c.addTasks(Math.floor(d/100));for(let p=0;p<d;p++){c&&99===p%100&&(yield new Promise(requestAnimationFrame),c.addCompleted(1));var f=e.items(a,b);let q=Bits$$module$js$bits.from(new Set(f));var g=new GenericFill$$module$js$graph$shuffle,h=new Map,k=new Map,l=[];for(var m=a.fixed;m<a.items.length;m++){var n=a.items[m].item;null!=n&&(h.set(n,m),e.shuffleRules.shouldShuffle(n)||l.push(n))}for(m=a.fixed;m<a.slots.length;m++)n=a.slots[m].item,null!=n&&k.set(n,m);for(const a of l)l=h.get(a),m=k.get(a),
null!=m&&null!=l&&(g.set(m,l),q=Bits$$module$js$bits.without(q,l));e.flags.guaranteeSword()&&(l=b.nextInt(4),h=h.get(l),k=k.get(0),null==h||null==k||g.hasSlot(k)||g.hasItem(h)||(g.set(k,h),q=Bits$$module$js$bits.without(q,h)));if(e.fillInternal(a,b,g,f,q,Math.floor(p/5)))if(f=traverse$$module$js$graph$shuffle(a,g,Bits$$module$js$bits.of()),f.size!==a.slots.length)console.error("unexpected size mismatch!",f,a);else if(g=e.fill(a,expandFill$$module$js$graph$shuffle(a,g),b),null!=g)return c&&c.addCompleted(Math.floor((d-
p)/100)),g}return null})}fillInternal(a,b,c,d,e,f){for(let k=d.pop();null!=k;k=d.pop()){if(!Bits$$module$js$bits.has(e,k))continue;var g=a.items[k].item;if(null==g)throw Error(`bad item: ${Object.entries(a.items[k])}`);e=Bits$$module$js$bits.without(e,k);var h=[...traverse$$module$js$graph$shuffle(a,c,e)];b.shuffle(h);let l=!1;for(const b of h){const d=a.slots[b].item;if(null!=d&&!c.hasSlot(b)&&this.fits(d,g)){c.set(b,k);l=!0;break}}if(!l){if(0<f--){for(const f of h)if(h=a.slots[f].item,null!=h&&
this.fits(h,g)){g=c.slots[f];c.slots[f]=c.items[g]=void 0;e=Bits$$module$js$bits.with(e,g);d.push(g);b.shuffle(d);c.set(f,k);l=!0;break}if(l)continue}return!1}}return!0}fill(a,b,c){const d=new Set;for(var e of a.slots)null!=e.item&&d.add(e.item);const f=[],g=[],h=[];a=[];e=[];for(let c=0;124>c;c++)112>c&&!d.has(c)?b.hasSlot(c)!==b.hasItem(c)&&console.error("MISMATCH",c):b.hasSlot(c)||b.hasItem(c)||this.shuffleRules.shouldShuffle(c)?(b.hasSlot(c)||(this.shuffleRules.isEarly(c)?a.push(c):e.push(c)),
b.hasItem(c)||(72>=c&&this.rom.items[c].unique?f.push(c):112>c?g.push(c):h.push(c))):b.set(c,c);c.shuffle(a);c.shuffle(e);c.shuffle(f);c.shuffle(g);for(const d of module$js$util.iters.concat(f,h,g)){c=!1;for(const f of[a,e]){if(c)break;for(const a of f)if(this.fits(a,d)){b.set(a,d);c=!0;f.splice(f.indexOf(a),1);break}}if(!c)return null}return b}}var module$js$graph$shuffle={};module$js$graph$shuffle.newFill=newFill$$module$js$graph$shuffle;module$js$graph$shuffle.traverse=traverse$$module$js$graph$shuffle;
module$js$graph$shuffle.traverseFill=traverseFill$$module$js$graph$shuffle;module$js$graph$shuffle.ShuffleRules=ShuffleRules$$module$js$graph$shuffle;module$js$graph$shuffle.AssumedFill=AssumedFill$$module$js$graph$shuffle;class UnionFind$$module$js$unionfind{constructor(){this.data=new Map;this.sizes=new Map}find(a){if(a!==a)throw"nan";this.data.has(a)||(this.data.set(a,a),this.sizes.set(a,1));let b;for(;!Object.is(b=this.data.get(a),a);)this.data.set(a,a=this.data.get(b));return a}union(a){this.find(a[0]);for(let b=1;b<a.length;b++){if(a[b]!==a[b])throw"nan";this.unionInternal(a[0],a[b])}}unionInternal(a,b){a=this.find(a);b=this.find(b);if(a!==b){var c=this.sizes.get(a),d=this.sizes.get(b);c<d?(this.sizes.set(b,c+
d),this.data.set(a,b)):(this.sizes.set(a,c+d),this.data.set(b,a))}}sets(){const a=new Map;for(const b of this.data.keys()){const c=this.find(b);let d=a.get(c);d||a.set(c,d=new Set);d.add(b)}return[...a.values()]}map(){const a=new DefaultMap$$module$js$util(()=>new Set);for(const b of this.data.keys()){let c=a.get(this.find(b));a.set(b,c);c.add(b)}return a}roots(){const a=new Set;for(const b of this.data.keys())a.add(this.find(b));return[...a]}}var module$js$unionfind={};
module$js$unionfind.UnionFind=UnionFind$$module$js$unionfind;class World$$module$js$graph$world{constructor(a,b,c){this.rom=a;this.tiles=b;this.graph=c}traverse(a,b){const {spoiler:c}=this.rom;if(c){for(var d=-512;768>d;d++)c.addCondition(d,conditionName$$module$js$graph$world(d,this.rom));for(const e of traverseFill$$module$js$graph$shuffle(a,b)){const [f,...g]=e;{d=a.slots[f].condition;const e=g.map((b)=>a.items[b].condition);c.addCheck(d,e,b.slots[a.slots[f].item])}}}}static build(a,b,c){return build$$module$js$graph$world(a,b,c)}}
function build$$module$js$graph$world(a,b,c){b=void 0===b?new FlagSet$$module$js$flagset("@FullShuffle"):b;c=void 0===c?!1:c;const d=new Overlay$$module$js$graph$overlay(a,b,c),e=new Map,f=new Map,g=new Map,h=new Map,k=new DefaultMap$$module$js$util(()=>new Set),l=new Map,m=new Set;for(const b of a.locations){var n=function(a,b){const c=e.get(a);c&&e.set(a,module$js$graph$condition.Terrain.meet(c,b))};if(!b.used)continue;const c=b.extended?256:0,t=a.tilesets[(b.tileset&127)>>2],r=a.tileEffects[b.tileEffects-
179];for(const a of b.spawns)a.isWall()&&f.set(module$js$graph$geometry.ScreenId.from(b,a),a.id&3);for(let g=0,h=b.height;g<h;g++){const h=b.screens[g],k=b.id<<8|g<<4;for(let g=0,l=b.width;g<l;g++){var p=function(a,b){if(!w)throw Error("flag expected");return b?a?v(a,b):module$js$graph$condition.Terrain.meet({enter:module$js$graph$condition.Condition(w.flag)},b):a};const l=a.screens[h[g]|c],m=module$js$graph$geometry.ScreenId(k|g),n=m&255,q=f.get(m),w=null!=q?d.wallCapability(q):b.flags.find((a)=>
a.yx===n),v=memoize2$$module$js$graph$condition((a,b)=>{if(!w)throw Error("flag expected");b=Object.assign({},b,{enter:meet$$module$js$graph$condition(b.enter||[[]],module$js$graph$condition.Condition(w.flag))});return module$js$graph$condition.Terrain.join(a,b)});for(let a=0;240>a;a++){const b=module$js$graph$geometry.TileId(m<<8|a);let f=l.tiles[a];w&&751===w.flag&&32>f&&(f=t.alternates[f]);let g=d.makeTerrain(c?0:r.effects[f]&38,b);if(32>f&&t.alternates[f]!=f&&w&&751!==w.flag){const a=d.makeTerrain(r.effects[t.alternates[f]],
b);g=p(g,a)}g&&e.set(b,g)}}}for(const a of b.exits)if(a.entrance&32){const c=module$js$graph$geometry.TileId.from(b,a);m.add(c);const d=e.get(c);d&&e.set(c,module$js$graph$condition.Terrain.seamless(d))}for(const c of b.spawns)if(c.isTrigger()){const a=d.trigger(c.id);if(a.terrain||a.check){let {x:d,y:e}=c;d+=8;for(const c of[b,...a.extraLocations||[]])for(const b of a.dx||[-16,0])for(const f of[-16,0]){const g=module$js$graph$geometry.TileId.from(c,{x:d+b,y:e+f});a.terrain&&n(g,a.terrain);for(const b of a.check||
[])k.get(g).add(b)}}}else if(c.isNpc()){h.set(module$js$graph$geometry.TileId.from(b,c),c.id);const a=d.npc(c.id,b);if(a.terrain||a.check){let {x:d,y:e}=c,{x0:f,x1:g,y0:h,y1:l}=a.hitbox||{x0:0,y0:0,x1:1,y1:1};for(let c=f;c<g;c++)for(let f=h;f<l;f++){const g=module$js$graph$geometry.TileId.from(b,{x:d+16*c,y:e+16*f});a.terrain&&n(g,a.terrain);for(const b of a.check||[])k.get(g).add(b)}}}else if(c.isBoss())g.set(module$js$graph$geometry.TileId.from(b,c),c.id);else if(c.isChest())k.get(module$js$graph$geometry.TileId.from(b,
c)).add(module$js$graph$condition.Check.chest(c.id));else if(c.isMonster()){const d=a.objects[c.monsterId];d.goldDrop&&l.set(module$js$graph$geometry.TileId.from(b,c),d.elements)}}for(const b of g){const [c,f]=b;{const b=c>>16,g=195!==f?a.bosses.fromLocation(b):a.bosses.rage;if(160===b||95===b)continue;if(!g||null==g.kill)throw Error(`bad boss at loc ${b.toString(16)}`);const h=module$js$graph$condition.Boss(g.kill),l=memoize$$module$js$graph$condition((a)=>module$js$graph$condition.Terrain.meet(a,
{exit:h,exitSouth:h})),m=c&-256,n=d.bossRequirements(g),t={slot:module$js$graph$condition.Slot(h),condition:n};for(let a=0;240>a;a++){const b=module$js$graph$geometry.TileId(m|a),c=e.get(b);c&&(e.set(b,l(c)),k.get(b).add(t))}}}for(const a of d.locations()||[])k.get(a.tile).add(a);const q=new UnionFind$$module$js$unionfind;for(const a of e){const [b,c]=a;{const a=module$js$graph$geometry.TileId.add(b,0,1);e.get(a)===c&&q.union([b,a]);const d=module$js$graph$geometry.TileId.add(b,1,0);e.get(d)===c&&
q.union([b,d])}}const r=new Set;for(const b of a.locations)if(b.used)for(const c of b.exits){const {dest:d,entrance:e}=c,f=module$js$graph$geometry.TileId.from(b,c),g=e&32?module$js$graph$geometry.TileId(f&65535|d<<16):module$js$graph$geometry.TileId.from({id:d},a.locations[d].entrances[e]);r.add(module$js$graph$geometry.TilePair.of(q.find(f),q.find(g)))}for(const a of r){const [b,c]=module$js$graph$geometry.TilePair.split(a);if(e.get(b)!==e.get(c))continue;const d=module$js$graph$geometry.TilePair.of(c,
b);r.has(d)&&(q.union([b,c]),r.delete(a),r.delete(d))}const v=new Neighbors$$module$js$graph$geometry(q,m);for(const a of e){const [b,c]=a;{const a=module$js$graph$geometry.TileId.add(b,0,1),d=e.get(a);d&&d!==c&&v.addAdjacent(b,a,!1);const f=module$js$graph$geometry.TileId.add(b,1,0),g=e.get(f);g&&g!==c&&v.addAdjacent(b,f,!0)}}for(const a of r){const [b,c]=module$js$graph$geometry.TilePair.split(a);e.has(b)&&e.has(c)&&v.addExit(b,c)}const t=new Routes$$module$js$graph$routes;for(const a of d.extraRoutes())for(const b of a.condition||
[[]])t.addRoute(q.find(a.tile),b);for(const a of d.extraEdges()){const {from:b,to:c,condition:d}=a;for(const a of d||[[]])t.addEdge(q.find(c),q.find(b),a)}for(const a of v){const {from:b,to:c,south:d}=a;{const a=e.get(b),f=e.get(c);if(!a||!f)throw Error(`missing terrain ${a?c:b}`);for(const e of(d?a.exitSouth:a.exit)||[[]])for(const a of f.enter||[[]])t.addEdge(c,b,[...a,...e])}}const w=new DefaultMap$$module$js$util(()=>new MutableRequirement$$module$js$graph$condition);for(const a of d.capabilities()){const {condition:b=
[[]],capability:c}=a;w.get(module$js$graph$condition.Slot(c)).addAll(b)}for(const a of k){const [b,c]=a;{const a=q.find(b);if(b!==a){for(const b of c)k.get(a).add(b);k.delete(b)}}}for(const a of k){const [b,c]=a;for(const a of c){const {slot:c,condition:d=[[]]}=a;{const a=w.get(c);for(const c of d)for(const d of t.routes.get(b)||[])a.addList([...c,...d])}}}if(DEBUG$$module$js$graph$world&&"undefined"!==typeof window){var D=function(a,b){b=void 0===b?E:b;a=[...a];return a.length?"("+a.map((a)=>[...a].map(b).join(" & ")).join(") |\n     (")+
")":"no route"},E=function(a){return 0>a?"~"+(~a).toString(16).padStart(2,"0"):a.toString(16).padStart(3,"0")};const b=window;console.log(b.roots=(b.tiles=q).roots());console.log([...b.neighbors=v]);console.log(b.ll=t);b.area=(a,b)=>{b=void 0===b?E:b;const c=[...q.sets().filter((b)=>b.has(a))[0]].map((a)=>a.toString(16).padStart(6,"0")),d=D(t.routes.get(q.find(a)),b),e=[],f=q.find(a);for(const a of(t.edges.get(f)||new Map).values())e.push(`\nto ${a.target.toString(16)} if (${[...a.deps].map(b).join(" & ")})`);
for(const a of t.edges){const [c,d]=a;for(const a of d.values())a.target===f&&e.push(`\nfrom ${c.toString(16)} if (${[...a.deps].map(b).join(" & ")})`)}return`${hex$$module$js$rom$util(f)}\n${(function(a,b,c){const d=[];for(let e=0;e<a.length;e+=b)d.push(a.slice(e,e+b).join(c));return d})(c,16," ").join("\n")}\ncount = ${c.length}\nroutes = ${d}${e.join("")}`};b.whatFlag=(b)=>conditionName$$module$js$graph$world(b,a);b.reqs=w;console.log("reqs\n"+[...w].sort((a,b)=>{[a]=a;[b]=b;return a-b}).map((a)=>
{var [c,d]=a;return`${b.whatFlag(c)}: ${D(d,b.whatFlag)}`}).join("\n"));b.reqs.check=(a,b)=>{b=void 0===b?E:b;return`${b(a)}: ${D(w.get(module$js$graph$condition.Slot(a)),b)}`};b.reqs.check2=(a)=>b.reqs.check(a,b.whatFlag)}let u=isItem$$module$js$graph$world;c&&(u=function(a){return isItem$$module$js$graph$world(a)||b.shuffleBossElements()&&isBoss$$module$js$graph$world(a)?!0:!1});return new World$$module$js$graph$world(a,q,makeGraph$$module$js$graph$world(w,a,u))}
function isBoss$$module$js$graph$world(a){return 256<=~a&&272>~a}function isItem$$module$js$graph$world(a){return 512<=a&&640>a}
function makeGraph$$module$js$graph$world(a,b,c){function d(a,c){return{name:conditionName$$module$js$graph$world(a,b),condition:a,index:c}}function e(a,b){return Object.assign(d(a,b+n),{item:a&127})}function f(a){const c=p.get(a);if(null==c)throw Error(`Missing item $${a.toString(16)}: ${conditionName$$module$js$graph$world(a,b)}`);return c}var g=new Set,h=new Set;for(var k of a){const [a,b]=k;h.add(a);for(var l of b)for(var m of l)g.add(m)}g.add(module$js$graph$condition.Boss.DRAYGON2[0][0]);k=
[...g].filter((a)=>!c(a)).sort();g=[...g].filter(c).sort();l=[...h].filter(c).sort();const n=k.length;h=k.map(d);g=g.map(e);m=l.map(e);g=[...h,...g];k=[...h,...m];const p=new Map(g.map((a,b)=>[a.condition,b])),q=new Map(k.map((a,b)=>[a.condition,b]));l=[];const r=[];for(var v of a){const [c,d]=v;a=q.get(c);if(null==a)MAYBE_MISSING_SLOTS$$module$js$graph$world.has(c)||console.error(`Nothing depended on $${c.toString(16)}: ${conditionName$$module$js$graph$world(c,b)}`);else for(const b of d){const c=
[...b].map(f);(l[a]||(l[a]=[])).push(Bits$$module$js$bits.from(c));for(const b of c)(r[b]||(r[b]=new Set)).add(a)}}for(var t of[...h,...m])l[t.index]&&l[t.index].length||(v=t.condition,console.error(`Nothing provided $${v.toString(16)}: ${conditionName$$module$js$graph$world(v,b)} (index ${t.index})`));DEBUG$$module$js$graph$world&&console.log(l);t=r.map((a)=>[...a]);return{fixed:n,slots:k,items:g,graph:l,unlocks:t,rom:b}}const MAYBE_MISSING_SLOTS$$module$js$graph$world=new Set([37,38,169,580]);
function conditionName$$module$js$graph$world(a,b){const c={Boss:module$js$graph$condition.Boss,Event:module$js$graph$condition.Event,Capability:module$js$graph$condition.Capability,Item:module$js$graph$condition.Item,Magic:module$js$graph$condition.Magic};for(const b in c){const d=c[b];for(const b in d)if(d[b]===a||Array.isArray(d[b])&&d[b][0][0]===a)return b.replace(/([A-Z])([A-Z]+)/g,(a,b,c)=>b+c.toLowerCase()).replace(/_/g," ")}for(const c of b.locations)if(c.used)for(const b of c.flags)if(b.flag===
a)return`Location ${c.id.toString(16)} (${c.name}) Flag ${b.ys},${b.xs}`;return 0>a?`~${(~a).toString(16).padStart(2,"0")}`:a.toString(16).padStart(2,"0")}const DEBUG$$module$js$graph$world=!1;var module$js$graph$world={};module$js$graph$world.World=World$$module$js$graph$world;var Path$$module$js$maze$types;(function(a){a.generate=function*(a,c,d){for(;;)yield generatePath$$module$js$maze$types(a,c,d)}})(Path$$module$js$maze$types||(Path$$module$js$maze$types={}));
function*generatePath$$module$js$maze$types(a,b,c){function d(){b--;return 0}function e(){[b,c]=[-c,b-1];return-1}function f(){[b,c]=[c,1-b];return 1}for(;1!==b||0!==c;)0<b&&.5>a.next()?(yield d(),2<b&&.5>a.next()&&(yield d())):a.next()<(0>b?.1:.5)?yield d():0<c?yield f():0>c?yield e():yield.5>a.next()?e():f()}var DirMask$$module$js$maze$types;(function(a){a.of=function(...a){let b=0;for(let c of a)b|=1<<c;return b}})(DirMask$$module$js$maze$types||(DirMask$$module$js$maze$types={}));var Dir$$module$js$maze$types;
(function(a){a.ALL=[0,1,2,3];a.DELTA=[-16,1,16,-1];a.inv=function(a){return a^2};a.edgeMask=function(a){return 15<<(a<<2)};a.shift=function(a){return a<<2};a.turn=function(a,c){return a+c&3};a.allEdge=function*(b,c,d){const e=b?c<<4:d,f=b&1?16:1;for(b=b===a.RIGHT?d-1:b===a.DOWN?c-1<<4:0;b<e;b+=f)yield b};a.UP=0;a.RIGHT=1;a.DOWN=2;a.LEFT=3})(Dir$$module$js$maze$types||(Dir$$module$js$maze$types={}));var Pos$$module$js$maze$types;
(function(a){a.plus=function(a,c){return a+Dir$$module$js$maze$types.DELTA[c]};a.relative=function(a,c,d){const b=(d>>>4)-(a>>>4);a=(d&15)-(a&15);if(0===c)return[-b,a];if(1===c)return[a,b];if(2===c)return[b,-a];if(3===c)return[-a,-b];throw Error(`impossible: ${c}`);}})(Pos$$module$js$maze$types||(Pos$$module$js$maze$types={}));var Scr$$module$js$maze$types;
(function(a){a.edge=function(a,c){return a>>>(c<<2)&15};a.numExits=function(a){let b=0;for(let c=0;4>c;c++)a&15&&b++,a>>>=4;return b};a.fromExits=function(a,c){let b=0;for(let d=0;4>d;d++)b<<=4,a&8&&(b|=c),a=(a&7)<<1;return b}})(Scr$$module$js$maze$types||(Scr$$module$js$maze$types={}));var module$js$maze$types={};module$js$maze$types.Path=Path$$module$js$maze$types;module$js$maze$types.DirMask=DirMask$$module$js$maze$types;module$js$maze$types.Dir=Dir$$module$js$maze$types;
module$js$maze$types.Pos=Pos$$module$js$maze$types;module$js$maze$types.Scr=Scr$$module$js$maze$types;function Spec$$module$js$maze$spec(a,b,c,...d){const e=[],f=[],g=[];let h=!1,k=!1,l=!1,m=void 0,n=!1;for(let a of d)"string"===typeof a?"fixed"===a?k=!0:"flag"===a?l=!0:"pit"===a?n=!0:"deadend"===a?h=!0:assertNever$$module$js$util(a):"number"===typeof a?e.push(connection$$module$js$maze$spec(a)):a instanceof Stair$$module$js$maze$spec?g.push(a):a instanceof Wall$$module$js$maze$spec?m=a:a instanceof Poi$$module$js$maze$spec?f.push(a):assertNever$$module$js$util(a);return{edges:a,tile:b,icon:c,connections:e,
deadEnd:h,fixed:k,flag:l,wall:m,pit:n,poi:f,stairs:g}}class Stair$$module$js$maze$spec{constructor(a,b,c){this.dir=a;this.entrance=b;this.exit=c}static up(a,b){return new Stair$$module$js$maze$spec(module$js$maze$types.Dir.UP,a,b)}static down(a,b){return new Stair$$module$js$maze$spec(module$js$maze$types.Dir.DOWN,a,b)}}
class Wall$$module$js$maze$spec{constructor(a,b,c,d){this.type=a;this.tile=b;this.a=c;this.b=d}connections(a){if(!a)return[connection$$module$js$maze$spec(this.a),connection$$module$js$maze$spec(this.b)];a=this.b;let b=this.a;for(;a;)a>>=4,b<<=4;return[connection$$module$js$maze$spec(b|this.b)]}}function wall$$module$js$maze$spec(a,[b,c]){return new Wall$$module$js$maze$spec("wall",a,b,c)}function bridge$$module$js$maze$spec(a,[b,c]){return new Wall$$module$js$maze$spec("bridge",a,b,c)}
class Poi$$module$js$maze$spec{constructor(a,b,c){this.priority=a;this.dy=b;this.dx=c}}function poi$$module$js$maze$spec(a,b=112,c=120){return new Poi$$module$js$maze$spec(a,b,c)}function connection$$module$js$maze$spec(a){const b=[];for(;a;)b.push((a&3)<<(a&4)|(a&8?a&4?256:4096:0)),a>>>=4;return b}
const EDGE_TYPES$$module$js$maze$spec={1:{[module$js$maze$types.Dir.DOWN]:{entrance:57216,exits:[230,231,232,233]},[module$js$maze$types.Dir.UP]:{entrance:12416,exits:[38,39,40,41]}},6:{[module$js$maze$types.Dir.DOWN]:{entrance:57216,exits:[231,232]},[module$js$maze$types.Dir.UP]:{entrance:12416,exits:[39,40]}}},EMPTY_CAVE_SCREEN$$module$js$maze$spec=Spec$$module$js$maze$spec(0,128," "),BASIC_CAVE_SCREENS$$module$js$maze$spec=[Spec$$module$js$maze$spec(257,129,"\u2502",42,poi$$module$js$maze$spec(4)),
Spec$$module$js$maze$spec(4112,130,"\u2500",110,poi$$module$js$maze$spec(4)),Spec$$module$js$maze$spec(272,131,"\u250c",174,poi$$module$js$maze$spec(2)),Spec$$module$js$maze$spec(4352,132,"\u2510",106,poi$$module$js$maze$spec(2)),Spec$$module$js$maze$spec(17,133,"\u2514",46,poi$$module$js$maze$spec(2)),Spec$$module$js$maze$spec(4097,134,"\u2518",38,poi$$module$js$maze$spec(2)),Spec$$module$js$maze$spec(273,135,"\u251c",686,poi$$module$js$maze$spec(3)),Spec$$module$js$maze$spec(4369,136,"\u253c",9902,
poi$$module$js$maze$spec(3)),Spec$$module$js$maze$spec(4353,137,"\u2524",618,poi$$module$js$maze$spec(3)),Spec$$module$js$maze$spec(4368,138,"\u252c",1710,poi$$module$js$maze$spec(3)),Spec$$module$js$maze$spec(4113,139,"\u2534",622,poi$$module$js$maze$spec(3)),Spec$$module$js$maze$spec(131329,140,"\u250b",42),Spec$$module$js$maze$spec(1048833,141,"\u256b","fixed",42),Spec$$module$js$maze$spec(1052688,142,"\u256b","fixed",110),Spec$$module$js$maze$spec(65793,143,"\u2506",wall$$module$js$maze$spec(135,
[2,10])),Spec$$module$js$maze$spec(69648,144,"\u2504",wall$$module$js$maze$spec(103,[2,10])),Spec$$module$js$maze$spec(69649,148,"\u2538",wall$$module$js$maze$spec(55,[2,110])),Spec$$module$js$maze$spec(135184,149,"\u2538",110,Stair$$module$js$maze$spec.up(16512,55)),Spec$$module$js$maze$spec(69632,150,"\u251a",6,Stair$$module$js$maze$spec.up(16432,50)),Spec$$module$js$maze$spec(135168,151,"\u2512",6,Stair$$module$js$maze$spec.down(44848,178)),Spec$$module$js$maze$spec(65552,152,"\u2516",14,Stair$$module$js$maze$spec.up(16592,
60)),Spec$$module$js$maze$spec(131088,153,"\u250e",14,Stair$$module$js$maze$spec.down(45008,188)),Spec$$module$js$maze$spec(131073,154,"\u2579",2,Stair$$module$js$maze$spec.down(8064,39)),Spec$$module$js$maze$spec(131328,154,"\u257b",10,Stair$$module$js$maze$spec.up(53376,199)),Spec$$module$js$maze$spec(262401,155," ",2,10,"deadend"),Spec$$module$js$maze$spec(1,155,"\u2575",2,poi$$module$js$maze$spec(0,-48,120),"deadend"),Spec$$module$js$maze$spec(256,155,"\u2577",10,poi$$module$js$maze$spec(0,272,
120),"deadend"),Spec$$module$js$maze$spec(266256,156," ",6,14,"deadend"),Spec$$module$js$maze$spec(16,156,"\u2576",14,poi$$module$js$maze$spec(0,112,264),"deadend"),Spec$$module$js$maze$spec(4096,156,"\u2574",6,poi$$module$js$maze$spec(0,112,-40),"deadend"),Spec$$module$js$maze$spec(1537,158,"\u257d",42)],BOSS_CAVE_SCREENS$$module$js$maze$spec=[Spec$$module$js$maze$spec(29046,145,"\u2564","fixed",42,poi$$module$js$maze$spec(1,96,120)),Spec$$module$js$maze$spec(459009,145,"\u2564","fixed",42,poi$$module$js$maze$spec(1,
96,120)),Spec$$module$js$maze$spec(94582,146,"\u2564","fixed",wall$$module$js$maze$spec(39,[2,10]),poi$$module$js$maze$spec(1,96,120)),Spec$$module$js$maze$spec(112,128,"\u2558"),Spec$$module$js$maze$spec(28672,128,"\u255b")],RIVER_SCREENS$$module$js$maze$spec=[Spec$$module$js$maze$spec(13107,211,"\u256c",21,61,bridge$$module$js$maze$spec(182,[121,191]),poi$$module$js$maze$spec(4,0,152)),Spec$$module$js$maze$spec(771,212,"\u2551",25,59),Spec$$module$js$maze$spec(12336,213,"\u2550",93,127),Spec$$module$js$maze$spec(66307,
214,"\u2551",bridge$$module$js$maze$spec(135,[25,59])),Spec$$module$js$maze$spec(77872,215,"\u2550",bridge$$module$js$maze$spec(134,[93,127])),Spec$$module$js$maze$spec(816,216,"\u2554",157,191),Spec$$module$js$maze$spec(13056,217,"\u2557",91,121),Spec$$module$js$maze$spec(51,218,"\u255a",31,61),Spec$$module$js$maze$spec(12291,219,"\u255d",21,55),Spec$$module$js$maze$spec(12337,220,"\u2567",605,127),Spec$$module$js$maze$spec(12592,221,"\u2564",93,1967),Spec$$module$js$maze$spec(4867,222,"\u2562",
361,59),Spec$$module$js$maze$spec(787,223,"\u255f",25,958),Spec$$module$js$maze$spec(525059,240," ",1,3,9,11,"deadend"),Spec$$module$js$maze$spec(3,240," ",1,3,poi$$module$js$maze$spec(1,-48,72),poi$$module$js$maze$spec(1,-48,152),"deadend"),Spec$$module$js$maze$spec(768,240," ",9,11,poi$$module$js$maze$spec(1,272,72),poi$$module$js$maze$spec(1,272,152),"deadend"),Spec$$module$js$maze$spec(536624,241," ",5,7,13,15,"deadend"),Spec$$module$js$maze$spec(48,241," ",13,15,poi$$module$js$maze$spec(1,96,
264),poi$$module$js$maze$spec(1,160,264),"deadend"),Spec$$module$js$maze$spec(12288,241," ",5,7,poi$$module$js$maze$spec(1,96,-40),poi$$module$js$maze$spec(1,160,-40),"deadend"),Spec$$module$js$maze$spec(65539,242,"\u2568",bridge$$module$js$maze$spec(23,[1,3])),Spec$$module$js$maze$spec(66304,242,"\u2565",bridge$$module$js$maze$spec(198,[9,11])),Spec$$module$js$maze$spec(13104,243,"\u2566",93,121,191),Spec$$module$js$maze$spec(12339,244,"\u2569",21,61,127),Spec$$module$js$maze$spec(131843,245,"\u2560",
25,3,11,poi$$module$js$maze$spec(1,192,152),poi$$module$js$maze$spec(1,64,152)),Spec$$module$js$maze$spec(262915,246,"\u2563",1,9,59,poi$$module$js$maze$spec(1,176,72),poi$$module$js$maze$spec(1,48,72))],WIDE_SCREENS$$module$js$maze$spec=[Spec$$module$js$maze$spec(2,113,"\u253b",2,Stair$$module$js$maze$spec.down(53120,215)),Spec$$module$js$maze$spec(514,114,"\u2503",42),Spec$$module$js$maze$spec(34,224,"\u2516",46),Spec$$module$js$maze$spec(8194,225,"\u251a",38),Spec$$module$js$maze$spec(544,226,
"\u250e",174),Spec$$module$js$maze$spec(8704,227,"\u2512",106),Spec$$module$js$maze$spec(66050,229,"\u254f","fixed",2,10),Spec$$module$js$maze$spec(8738,230,"\u2542",9902),Spec$$module$js$maze$spec(8226,231,"\u2538",622),Spec$$module$js$maze$spec(8736,232,"\u2530",1710),Spec$$module$js$maze$spec(513,233,"\u257d","fixed",wall$$module$js$maze$spec(55,[2,10])),Spec$$module$js$maze$spec(8224,234,"\u2500",110),Spec$$module$js$maze$spec(66049,253,"\u257d","fixed",42)],WIDE_SET$$module$js$maze$spec=new Set([128,
...WIDE_SCREENS$$module$js$maze$spec.map((a)=>a.tile)]),PIT_SCREENS$$module$js$maze$spec=[Spec$$module$js$maze$spec(528400,235,"\u2508","pit",110),Spec$$module$js$maze$spec(524545,236,"\u250a","pit",42)],SPIKE_SCREENS$$module$js$maze$spec=[Spec$$module$js$maze$spec(260,237,"\u257f",42),Spec$$module$js$maze$spec(1025,238,"\u257d",42),Spec$$module$js$maze$spec(5140,239,"\u2542",9902),Spec$$module$js$maze$spec(1028,247,"\u2503",42)],SWAMP_SCREENS$$module$js$maze$spec=[Spec$$module$js$maze$spec(0,127,
" "),Spec$$module$js$maze$spec(1,-1,"\u2575",1),Spec$$module$js$maze$spec(16,118,"\u2576",13),Spec$$module$js$maze$spec(17,121,"\u2514",29),Spec$$module$js$maze$spec(256,-2,"\u2577",9),Spec$$module$js$maze$spec(257,-3,"\u2502",25),Spec$$module$js$maze$spec(272,-4,"\u250c",157),Spec$$module$js$maze$spec(273,-5,"\u251c",413),Spec$$module$js$maze$spec(4096,123,"\u2574",5),Spec$$module$js$maze$spec(4097,117,"\u2518",21),Spec$$module$js$maze$spec(4112,-6,"\u2500",93),Spec$$module$js$maze$spec(4113,125,
"\u2534",349),Spec$$module$js$maze$spec(4352,126,"\u2510",89),Spec$$module$js$maze$spec(4353,120,"\u2524",345),Spec$$module$js$maze$spec(4368,122,"\u252c",1437),Spec$$module$js$maze$spec(4369,119,"\u253c",5533),Spec$$module$js$maze$spec(61936,124,"\u2564","fixed",9),Spec$$module$js$maze$spec(61440,127,"\u255d","fixed"),Spec$$module$js$maze$spec(240,127,"\u255a","fixed"),Spec$$module$js$maze$spec(65552,118,"\u2576","fixed","flag",13),Spec$$module$js$maze$spec(65792,-2,"\u2577","fixed","flag",9),Spec$$module$js$maze$spec(65808,
-4,"\u250c","fixed","flag",157),Spec$$module$js$maze$spec(69632,123,"\u2574","fixed","flag",5),Spec$$module$js$maze$spec(69648,-6,"\u2500","fixed","flag",93),Spec$$module$js$maze$spec(69888,126,"\u2510","fixed","flag",89),Spec$$module$js$maze$spec(69904,122,"\u252c","fixed","flag",1437)],GOA1_SCREENS$$module$js$maze$spec=[Spec$$module$js$maze$spec(0,128," "),Spec$$module$js$maze$spec(17,224,"\u2514","flag",31,46,61),Spec$$module$js$maze$spec(257,228,"\u2502","flag",1194411),Spec$$module$js$maze$spec(272,
226,"\u250c","flag",157,174,191),Spec$$module$js$maze$spec(4097,225,"\u2518","flag",21,38,55),Spec$$module$js$maze$spec(4112,234,"\u2500",93,110,127),Spec$$module$js$maze$spec(4113,231,"\u2534","flag",21,622,61,127),Spec$$module$js$maze$spec(4352,227,"\u2510","flag",91,106,121),Spec$$module$js$maze$spec(4368,232,"\u252c","flag",93,1710,121,191),Spec$$module$js$maze$spec(4369,230,"\u253c","flag",21,9902,61,121,191),Spec$$module$js$maze$spec(65553,224,"\u2514","fixed",46,61),Spec$$module$js$maze$spec(65793,
228,"\u2502","fixed",4779),Spec$$module$js$maze$spec(65808,226,"\u250c","fixed",174,191),Spec$$module$js$maze$spec(69633,225,"\u2518","fixed",21,38),Spec$$module$js$maze$spec(69649,231,"\u2534","fixed",622,127),Spec$$module$js$maze$spec(69888,227,"\u2510","fixed",106,121),Spec$$module$js$maze$spec(69904,232,"\u252c","fixed",93,1710),Spec$$module$js$maze$spec(69905,230,"\u253c","fixed",21,9902,191),Spec$$module$js$maze$spec(131329,229,"\u250a","fixed","flag",5019),Spec$$module$js$maze$spec(196865,
229,"\u250a","fixed",57),Spec$$module$js$maze$spec(61681,113,"\u257d","fixed",42),Spec$$module$js$maze$spec(240,128,"\u2588","fixed"),Spec$$module$js$maze$spec(61440,128,"\u2588","fixed"),Spec$$module$js$maze$spec(65520,115,"\u2550","fixed"),Spec$$module$js$maze$spec(61951,114,"\u2564","fixed"),Spec$$module$js$maze$spec(4080,128,"\u2554","fixed"),Spec$$module$js$maze$spec(65280,128,"\u2557","fixed"),Spec$$module$js$maze$spec(255,128,"\u255a","fixed"),Spec$$module$js$maze$spec(61455,128,"\u255d","fixed")],
ALL_CAVE_SCREENS$$module$js$maze$spec=[BASIC_CAVE_SCREENS$$module$js$maze$spec,BOSS_CAVE_SCREENS$$module$js$maze$spec,RIVER_SCREENS$$module$js$maze$spec,WIDE_SCREENS$$module$js$maze$spec,PIT_SCREENS$$module$js$maze$spec,SPIKE_SCREENS$$module$js$maze$spec],RIVER_TILES$$module$js$maze$spec=new Set(RIVER_SCREENS$$module$js$maze$spec.map((a)=>a.tile)),BITCOUNT$$module$js$maze$spec=[0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4];
class SpecSet$$module$js$maze$spec{constructor(a,b){this.specSets=a;this.empty=b;this.fixedTiles=new Map;this.deadEndTiles=new Set;this.edgesByTile=new Map;this.stairsByTile=new Map;this.stairScreens=new Map;this.walls=new Map;for(const b of module$js$util.iters.concat(...a)){for(const c of module$js$maze$types.Dir.ALL)(a=b.edges>>module$js$maze$types.Dir.shift(c)&15)&&7!=(a&7)&&this.edgesByTile.set(b.tile,(this.edgesByTile.get(b.tile)||0)|1<<c);for(const a of b.stairs)this.stairsByTile.set(b.tile<<
8|(a.entrance&61440)>>8|(a.entrance&240)>>4,a.dir),this.stairScreens.set(b.edges,[a.dir,{entrance:a.entrance,exits:[a.exit,a.exit+1]}]);b.wall&&this.walls.set(b.tile,b.wall.type);128!=b.tile&&b.fixed&&(this.fixedTiles.has(b.tile)||this.fixedTiles.set(b.tile,b));b.deadEnd&&this.deadEndTiles.add(b.tile)}}survey(a){let b=0,c=0,d=0,e=0,f=0,g=0,h=!0,k=!1;const l=new Map,m=new Map,n=new Map,p=new Multiset$$module$js$util,q=[];this.empty&&q.push(this.empty);var r=new Set([].concat(...a.screens));for(var v of this.specSets)for(var t of v)if(128!==
t.tile&&r.has(t.tile)){q.push(...v);break}if(164===a.tileset)for(r=q.length-1;0<=r;r--)69648===q[r].edges&&q.splice(r,1);r=new Set([...a.reachableTiles(!0).keys()].map((a)=>a>>>8));v=new Map(a.entrances.map((b,c)=>{for(const d of a.exits)if(20>Math.abs(d.x-b.x)&&20>Math.abs(d.y-b.y))return[c,d.dest<<8|d.entrance];return null}).filter(isNonNull$$module$js$util));for(t=0;t<a.entrances.length;t++){var w=a.entrances[t],D=this.stairsByTile.get(a.screens[w.screen>>>4][w.screen&15]<<8|w.tile);if(null!=D){var E=
v.get(t);if(null==E)throw Error("Could not find exit");l.set(w.screen,{entrance:t,exit:E,dir:D})}}for(t=0;t<a.height;t++)for(w=0,t||(w|=1),t===a.height-1&&(w|=4),D=0;D<a.width;D++){E=t<<4|D;if(!r.has(E))continue;w&=-11;D||(w|=8);D===a.width-1&&(w|=2);var u=a.screens[t][D];p.add(u);if(128===u)continue;WIDE_SET$$module$js$maze$spec.has(u)?k=!0:h=!1;b++;RIVER_TILES$$module$js$maze$spec.has(u)&&g++;let q=this.edgesByTile.get(u);if(null==q)throw Error(`Bad tile: ${hex$$module$js$rom$util(u)}`);var z=BITCOUNT$$module$js$maze$spec[q]+
(l.has(E)?1:0);154===u&&(z=2);if(155===u||156==u||240==u||241==u)z=1;1===z&&c++;2<z&&(d+=z-2);z=this.walls.get(u);"wall"===z&&e++;"bridge"===z&&f++;z=this.fixedTiles.get(u);this.deadEndTiles.has(u)&&(q=0);for(var Y of module$js$maze$types.Dir.ALL)if(q&w&1<<Y){u=null;for(var Z=0;Z<a.entrances.length;Z++)if(a.entrances[Z].screen===E&&matchesDir$$module$js$maze$spec(a.entrances[Z].tile,Y)){u=Z;break}if(null!=u){Z=v.get(u);if(null==Z)throw Error("Could not find exit");m.set(E,{entrance:u,exit:Z,dir:Y})}}null!=
z&&n.set(E,z)}if(g)for(const [a,b]of n)29046===b.edges&&(Y=q.find((a)=>459009===a.edges))&&n.set(a,Y);if(h!=k)throw Error("Found inconsistent use of wide tiles");return{size:b,rivers:g,deadEnds:c,branches:d,walls:e,bridges:f,stairs:l,edges:m,fixed:n,tiles:p,wide:h,specs:q,specSet:this}}}SpecSet$$module$js$maze$spec.CAVE=new SpecSet$$module$js$maze$spec(ALL_CAVE_SCREENS$$module$js$maze$spec,EMPTY_CAVE_SCREEN$$module$js$maze$spec);
function matchesDir$$module$js$maze$spec(a,b){return 0===b?4>a>>>4:1===b?13<(a&15):2===b?12<a>>>4:3===b?2>(a&15):!1}function readScreen$$module$js$maze$spec(a){const b=a.split(/ +/g).map((a)=>parseInt(a,16));for(const c of b)if("number"!=typeof c||isNaN(c))throw Error(`Bad screen: ${c} in ${a}`);return b}function write2d$$module$js$maze$spec(a,b,c){for(let d=0;d<c.length;d++)for(let e=0;e<c[d].length;e++){const f=c[d][e];null!=f&&(a[b+(d<<4|e)]=f)}}var module$js$maze$spec={};
module$js$maze$spec.Spec=Spec$$module$js$maze$spec;module$js$maze$spec.Stair=Stair$$module$js$maze$spec;module$js$maze$spec.Wall=Wall$$module$js$maze$spec;module$js$maze$spec.wall=wall$$module$js$maze$spec;module$js$maze$spec.bridge=bridge$$module$js$maze$spec;module$js$maze$spec.Poi=Poi$$module$js$maze$spec;module$js$maze$spec.poi=poi$$module$js$maze$spec;module$js$maze$spec.EDGE_TYPES=EDGE_TYPES$$module$js$maze$spec;module$js$maze$spec.SWAMP_SCREENS=SWAMP_SCREENS$$module$js$maze$spec;
module$js$maze$spec.GOA1_SCREENS=GOA1_SCREENS$$module$js$maze$spec;module$js$maze$spec.SpecSet=SpecSet$$module$js$maze$spec;module$js$maze$spec.readScreen=readScreen$$module$js$maze$spec;module$js$maze$spec.write2d=write2d$$module$js$maze$spec;class Location$$module$js$rom$location extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.mapDataPointer=82688+(b<<1);this.mapDataBase=readLittleEndian$$module$js$rom$util(a.prg,this.mapDataPointer)+49152;this.name=locationNames$$module$js$rom$location[this.id]||"";this.key=locationKeys$$module$js$rom$location[this.id]||"";this.used=49152<this.mapDataBase&&!!this.name;this.layoutBase=readLittleEndian$$module$js$rom$util(a.prg,this.mapDataBase)+49152;this.graphicsBase=readLittleEndian$$module$js$rom$util(a.prg,
this.mapDataBase+2)+49152;this.entrancesBase=readLittleEndian$$module$js$rom$util(a.prg,this.mapDataBase+4)+49152;this.exitsBase=readLittleEndian$$module$js$rom$util(a.prg,this.mapDataBase+6)+49152;this.flagsBase=readLittleEndian$$module$js$rom$util(a.prg,this.mapDataBase+8)+49152;let c=this.layoutBase!==this.mapDataBase+10,d=this.exitsBase-this.entrancesBase;this.exits=(()=>{const b=[];let f=this.exitsBase;for(;!(a.prg[f]&128);)b.push(new Exit$$module$js$rom$location(a.prg.slice(f,f+4))),f+=4;255!==
a.prg[f]&&(c=!!(a.prg[f]&64),d=(a.prg[f]&31)<<2);return b})();this.pitsBase=c?readLittleEndian$$module$js$rom$util(a.prg,this.mapDataBase+10)+49152:0;this.bgm=a.prg[this.layoutBase];this.layoutWidth=a.prg[this.layoutBase+1];this.layoutHeight=a.prg[this.layoutBase+2];this.animation=a.prg[this.layoutBase+3];this.extended=a.prg[this.layoutBase+4];this.screens=seq$$module$js$rom$util(this.height,(b)=>tuple$$module$js$rom$util(a.prg,this.layoutBase+5+b*this.width,this.width));this.tilePalettes=tuple$$module$js$rom$util(a.prg,
this.graphicsBase,3);this.tileset=a.prg[this.graphicsBase+3];this.tileEffects=a.prg[this.graphicsBase+4];this.tilePatterns=tuple$$module$js$rom$util(a.prg,this.graphicsBase+5,2);this.entrances=group$$module$js$rom$util(4,a.prg.slice(this.entrancesBase,this.entrancesBase+d),(a)=>new Entrance$$module$js$rom$location(a));this.flags=varSlice$$module$js$rom$util(a.prg,this.flagsBase,2,255,Infinity,(a)=>new Flag$$module$js$rom$location(a));this.pits=this.pitsBase?varSlice$$module$js$rom$util(a.prg,this.pitsBase,
4,255,Infinity,(a)=>new Pit$$module$js$rom$location(a)):[];this.npcDataPointer=102913+(b<<1);this.npcDataBase=readLittleEndian$$module$js$rom$util(a.prg,this.npcDataPointer)+65536;this.spritePalettes=(this.hasSpawns=65536!==this.npcDataBase)?tuple$$module$js$rom$util(a.prg,this.npcDataBase+1,2):[0,0];this.spritePatterns=this.hasSpawns?tuple$$module$js$rom$util(a.prg,this.npcDataBase+3,2):[0,0];this.spawns=this.hasSpawns?varSlice$$module$js$rom$util(a.prg,this.npcDataBase+5,4,255,Infinity,(a)=>new Spawn$$module$js$rom$location(a)):
[]}spawn(a){const b=this.spawns[a-13];if(!b)throw Error(`Expected spawn $${hex$$module$js$rom$util(a)}`);return b}get width(){return this.layoutWidth+1}set width(a){this.layoutWidth=a-1}get height(){return this.layoutHeight+1}set height(a){this.layoutHeight=a-1}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(b.used){var c=[];if(b.hasSpawns){var d=[0,...b.spritePalettes,...b.spritePatterns,...concatIterables$$module$js$rom$util(b.spawns),255];c.push(a.write(d,
98304,114687,`NpcData ${hex$$module$js$rom$util(b.id)}`).then((c)=>writeLittleEndian$$module$js$rom$util(a.rom,b.npcDataPointer,c-65536)))}d=(c,d)=>a.write(c,81920,98303,`${d} ${hex$$module$js$rom$util(b.id)}`);var e=[b.bgm,b.layoutWidth,b.layoutHeight,b.animation,b.extended,...concatIterables$$module$js$rom$util(b.screens)],f=[...b.tilePalettes,b.tileset,b.tileEffects,...b.tilePatterns];if(1===b.height){for(var g of b.entrances)191<g.y&&(g.y=191);for(var h of b.exits)12<h.yt&&(h.yt=12)}g=concatIterables$$module$js$rom$util(b.entrances);
h=[...concatIterables$$module$js$rom$util(b.exits),128|(b.pits.length?64:0)|b.entrances.length];var k=[...concatIterables$$module$js$rom$util(b.flags),255],l=concatIterables$$module$js$rom$util(b.pits),[m,n,p,q,r,v]=yield Promise.all([d(e,"Layout"),d(f,"Graphics"),d(g,"Entrances"),d(h,"Exits"),d(k,"Flags"),...l.length?[d(l,"Pits")]:[]]);e=[m&255,(m>>>8)-192,n&255,(n>>>8)-192,p&255,(p>>>8)-192,q&255,(q>>>8)-192,r&255,(r>>>8)-192,...v?[v&255,(v>>8)-192]:[]];d=yield d(e,"MapData");writeLittleEndian$$module$js$rom$util(a.rom,
b.mapDataPointer,d-49152);yield Promise.all(c);c=b.bossId();if(null!=c&&95!==b.id){d=readLittleEndian$$module$js$rom$util(a.rom,129387+2*c)+81920;e=[,,,b.bgm,,...b.tilePalettes,,,,b.spritePalettes[0],,,,,,,,b.animation];for(f=0;f<e.length;f++)g=e[f],null!=g&&(a.rom[d+f]=g);a.rom[128961+5*c]=b.spritePalettes[1]}}})}allScreens(){const a=new Set,b=this.extended?256:0;for(const c of this.screens)for(const d of c)a.add(this.rom.screens[d+b]);return a}bossId(){for(let a=0;14>a;a++)if(this.rom.prg[129373+
a]===this.id)return a}neighbors(a){a=void 0===a?!1:a;const b=new Set,c=(d)=>{for(const e of d.exits)(d=this.rom.locations[e.dest])&&d.used&&d!==this&&!b.has(d)&&(b.add(d),a&&NEXUSES$$module$js$rom$location[d.key]&&c(d))};c(this);return b}hasDolphin(){return 96===this.id||100===this.id||104===this.id}reachableTiles(a){a=void 0===a?!1:a;this.hasDolphin()&&(a=!0);const b=new Set(this.exits.map((a)=>a.screen<<8|a.tile));var c=new UnionFind$$module$js$unionfind;const d=this.rom.tileset(this.tileset),e=
this.rom.tileEffects[this.tileEffects-179];var f=new Set;for(let c=0;c<this.height;c++){const h=this.screens[c];for(let k=0;k<this.width;k++){const l=this.rom.screens[h[k]|(this.extended?256:0)],m=c<<4|k,q=this.flags.find((a)=>a.screen===m);for(let c=0;240>c;c++){const h=m<<8|c;if(b.has(h))continue;let k=l.tiles[c];var g=e.effects[k];g=a?g&4:g&6;q&&g&&32>k&&d.alternates[k]!=k&&(k=d.alternates[k],g=e.effects[k],g=a?g&4:g&6);g||f.add(h)}}}for(let b of f)a=15===(b&15)?b+241:b+1,f.has(a)&&c.union([b,
a]),a=224===(b&240)?b+3872:b+16,f.has(a)&&c.union([b,a]);f=c.map();c=new Set;for(var h of this.entrances)c.add(f.get(h.screen<<8|h.tile)||new Set);h=new Map;for(const a of c)for(const b of a)h.set(b,e.effects[this.rom.screens[this.screens[b>>>12][b>>>8&15]|(this.extended?256:0)].tiles[b&255]]);return h}screenMover(){const a=new DefaultMap$$module$js$util(()=>[]),b=module$js$util.iters.concat(this.spawns,this.exits,this.entrances);for(const c of b)a.get(c.screen).push(c);return(b,d)=>{for(const c of a.get(b))c.screen=
d}}moveScreen(a,b){const c=module$js$util.iters.concat(this.spawns,this.exits,this.entrances);for(const d of c)d.screen===a&&(d.screen=b)}monsterPlacer(a){const b=BOSS_SCREENS$$module$js$rom$location[this.key],c=this.reachableTiles(!1),d=new Map([...c.keys()].map((a)=>[a,0])),e=[],f=[],g=[],h=[],k=[],l=this.hasDolphin()?37:39;for(const a of d){const [k,m]=a;{const a=this.screens[k>>>12][k>>>8&15];if(a!==b){for(const a of neighbors$$module$js$rom$location(k,this.width,this.height))d.has(a)||d.set(a,
m+1);m||c.get(k)&l||e.push(k);26===this.id?240===this.rom.screens[a].tiles[k&255]&&h.push(k):2<=m&&4>=m&&h.push(k);3<=m&&7>=m&&f.push(k);12<=m&&g.push(k)}}}return(b)=>{var c=b.placement();c=[..."normal"===c?e:"moth"===c?f:"bird"===c?g:"plant"===c?h:assertNever$$module$js$util(c)];a:for(;c.length;){var d=a.nextInt(c.length),[l]=c.splice(d,1);d=(l&3840)>>>4|l&15;l=(l&61440)>>>8|(l&240)>>>4;const e=b.clearance();for(const a of k){const [,b,c,f]=a;if(Math.pow(l-c,2)+Math.pow(d-b,2)<Math.pow(e+f,2))continue a}for(const a of this.entrances){const {x:b,
y:c}=a;if(Math.pow(l-(c>>4),2)+Math.pow(d-(b>>4),2)<Math.pow(e+1,2))continue a}k.push([b,d,l,e]);return(l&240|(d&240)>>>4)<<8|(l&15)<<4|d&15}}}}function neighbors$$module$js$rom$location(a,b,c){const d=[],e=a&61680,f=a&3855;e<(c-1<<12|224)&&d.push(224===(a&240)?a+3872:a+16);e&&d.push(0===(a&240)?a-3872:a-16);f<(b-1<<8|15)&&d.push(15===(a&15)?a+241:a+1);f&&d.push(0===(a&15)?a-241:a-1);return d}
const Entrance$$module$js$rom$location=DataTuple$$module$js$rom$util.make(4,{x:DataTuple$$module$js$rom$util.prop([0],[1,255,-8]),y:DataTuple$$module$js$rom$util.prop([2],[3,255,-8]),screen:DataTuple$$module$js$rom$util.prop([3,15,-4],[1,15]),tile:DataTuple$$module$js$rom$util.prop([2,240],[0,240,4]),coord:DataTuple$$module$js$rom$util.prop([2,255,-8],[0,255]),toString(){return`Entrance ${this.hex()}: (${hex$$module$js$rom$util(this.x)}, ${hex$$module$js$rom$util(this.y)})`}}),Exit$$module$js$rom$location=
DataTuple$$module$js$rom$util.make(4,{x:DataTuple$$module$js$rom$util.prop([0,255,-4]),xt:DataTuple$$module$js$rom$util.prop([0]),y:DataTuple$$module$js$rom$util.prop([1,255,-4]),yt:DataTuple$$module$js$rom$util.prop([1]),screen:DataTuple$$module$js$rom$util.prop([1,240],[0,240,4]),tile:DataTuple$$module$js$rom$util.prop([1,15,-4],[0,15]),dest:DataTuple$$module$js$rom$util.prop([2]),entrance:DataTuple$$module$js$rom$util.prop([3]),toString(){return`Exit ${this.hex()}: (${hex$$module$js$rom$util(this.x)}, ${hex$$module$js$rom$util(this.y)}) => ${this.dest}:${this.entrance}`}}),
Flag$$module$js$rom$location=DataTuple$$module$js$rom$util.make(2,{flag:{get(){return this.data[0]|512},set(a){if(512!==(a&-256))throw Error(`bad flag: ${hex$$module$js$rom$util(a)}`);this.data[0]=a&255}},x:DataTuple$$module$js$rom$util.prop([1,7,-8]),xs:DataTuple$$module$js$rom$util.prop([1,7]),y:DataTuple$$module$js$rom$util.prop([1,240,-4]),ys:DataTuple$$module$js$rom$util.prop([1,240,4]),yx:DataTuple$$module$js$rom$util.prop([1]),screen:DataTuple$$module$js$rom$util.prop([1]),toString(){return`Flag ${this.hex()}: (${hex$$module$js$rom$util(this.xs)}, ${hex$$module$js$rom$util(this.ys)}) @ ${hex$$module$js$rom$util(this.flag)}`}}),
Pit$$module$js$rom$location=DataTuple$$module$js$rom$util.make(4,{fromXs:DataTuple$$module$js$rom$util.prop([1,112,4]),toXs:DataTuple$$module$js$rom$util.prop([1,7]),fromYs:DataTuple$$module$js$rom$util.prop([3,240,4]),toYs:DataTuple$$module$js$rom$util.prop([3,15]),dest:DataTuple$$module$js$rom$util.prop([0]),toString(){return`Pit ${this.hex()}: (${hex$$module$js$rom$util(this.fromXs)}, ${hex$$module$js$rom$util(this.fromYs)}) => ${hex$$module$js$rom$util(this.dest)}:(${hex$$module$js$rom$util(this.toXs)}, ${hex$$module$js$rom$util(this.toYs)})`}}),
Spawn$$module$js$rom$location=DataTuple$$module$js$rom$util.make(4,{y:DataTuple$$module$js$rom$util.prop([0,255,-4]),yt:DataTuple$$module$js$rom$util.prop([0]),timed:DataTuple$$module$js$rom$util.booleanProp([1,128,7]),x:DataTuple$$module$js$rom$util.prop([1,127,-4],[2,64,3]),xt:DataTuple$$module$js$rom$util.prop([1,127]),screen:DataTuple$$module$js$rom$util.prop([0,240],[1,112,4]),tile:DataTuple$$module$js$rom$util.prop([0,15,-4],[1,15]),patternBank:DataTuple$$module$js$rom$util.prop([2,128,7]),
type:DataTuple$$module$js$rom$util.prop([2,7]),id:DataTuple$$module$js$rom$util.prop([3]),used:{get(){return 254!==this.data[0]},set(a){this.data[0]=a?0:254}},monsterId:{get(){return this.id+80&255},set(a){this.id=a-80&255}},isChest(){return 2===this.type&&128>this.id},isInvisible(){return this.isChest()&&!!(this.data[2]&32)},isTrigger(){return 2===this.type&&128<=this.id},isNpc(){return 1===this.type&&192>this.id},isBoss(){return 1===this.type&&192<=this.id},isMonster(){return 0===this.type},isWall(){return!(3!==
this.type||!(4>this.id||this.data[2]&32))},isShootingWall(a){return this.isWall()&&!!(this.data[2]&32?this.data[2]&16:143===a.id||168===a.id)},wallType(){if(3!==this.type)return"";const a=this.data[2]&32?this.id>>>4:this.id;return 4<=a?"":2===a?"bridge":"wall"},wallElement(){return this.isWall()?this.id&3:-1},toString(){return`Spawn ${this.hex()}: (${hex$$module$js$rom$util(this.x)}, ${hex$$module$js$rom$util(this.y)}) ${this.timed?"timed":"fixed"} ${this.type}:${hex$$module$js$rom$util(this.id)}`}}),
LOCATIONS$$module$js$rom$location={mezameShrine:[0,"Mezame Shrine"],leafOutsideStart:[1,"Leaf - Outside Start"],leaf:[2,"Leaf"],valleyOfWind:[3,"Valley of Wind"],sealedCave1:[4,"Sealed Cave 1"],sealedCave2:[5,"Sealed Cave 2"],sealedCave6:[6,"Sealed Cave 6"],sealedCave4:[7,"Sealed Cave 4"],sealedCave5:[8,"Sealed Cave 5"],sealedCave3:[9,"Sealed Cave 3"],sealedCave7:[10,"Sealed Cave 7"],sealedCave8:[12,"Sealed Cave 8"],windmillCave:[14,"Windmill Cave"],windmill:[15,"Windmill"],zebuCave:[16,"Zebu Cave"],
mtSabreWestCave1:[17,"Mt Sabre West - Cave 1"],cordelPlainsWest:[20,"Cordel Plains West"],cordelPlainsEast:[21,"Cordel Plains East"],brynmaer:[24,"Brynmaer"],outsideStomHouse:[25,"Outside Stom House"],swamp:[26,"Swamp"],amazones:[27,"Amazones"],oak:[28,"Oak"],stomHouse:[30,"Stom House"],mtSabreWestLower:[32,"Mt Sabre West - Lower"],mtSabreWestUpper:[33,"Mt Sabre West - Upper"],mtSabreWestCave2:[34,"Mt Sabre West - Cave 2"],mtSabreWestCave3:[35,"Mt Sabre West - Cave 3"],mtSabreWestCave4:[36,"Mt Sabre West - Cave 4"],
mtSabreWestCave5:[37,"Mt Sabre West - Cave 5"],mtSabreWestCave6:[38,"Mt Sabre West - Cave 6"],mtSabreWestCave7:[39,"Mt Sabre West - Cave 7"],mtSabreNorthMain:[40,"Mt Sabre North - Main"],mtSabreNorthMiddle:[41,"Mt Sabre North - Middle"],mtSabreNorthCave2:[42,"Mt Sabre North - Cave 2"],mtSabreNorthCave3:[43,"Mt Sabre North - Cave 3"],mtSabreNorthCave4:[44,"Mt Sabre North - Cave 4"],mtSabreNorthCave5:[45,"Mt Sabre North - Cave 5"],mtSabreNorthCave6:[46,"Mt Sabre North - Cave 6"],mtSabreNorthPrisonHall:[47,
"Mt Sabre North - Prison Hall"],mtSabreNorthLeftCell:[48,"Mt Sabre North - Left Cell"],mtSabreNorthLeftCell2:[49,"Mt Sabre North - Left Cell 2"],mtSabreNorthRightCell:[50,"Mt Sabre North - Right Cell"],mtSabreNorthCave8:[51,"Mt Sabre North - Cave 8"],mtSabreNorthCave9:[52,"Mt Sabre North - Cave 9"],mtSabreNorthSummitCave:[53,"Mt Sabre North - Summit Cave"],mtSabreNorthCave1:[56,"Mt Sabre North - Cave 1"],mtSabreNorthCave7:[57,"Mt Sabre North - Cave 7"],nadareInn:[60,"Nadare - Inn"],nadareToolShop:[61,
"Nadare - Tool Shop"],nadareBackRoom:[62,"Nadare - Back Room"],waterfallValleyNorth:[64,"Waterfall Valley North"],waterfallValleySouth:[65,"Waterfall Valley South"],limeTreeValley:[66,"Lime Tree Valley"],limeTreeLake:[67,"Lime Tree Lake"],kirisaPlantCave1:[68,"Kirisa Plant Cave 1"],kirisaPlantCave2:[69,"Kirisa Plant Cave 2"],kirisaPlantCave3:[70,"Kirisa Plant Cave 3"],kirisaMeadow:[71,"Kirisa Meadow"],fogLampCave1:[72,"Fog Lamp Cave 1"],fogLampCave2:[73,"Fog Lamp Cave 2"],fogLampCave3:[74,"Fog Lamp Cave 3"],
fogLampCaveDeadEnd:[75,"Fog Lamp Cave Dead End"],fogLampCave4:[76,"Fog Lamp Cave 4"],fogLampCave5:[77,"Fog Lamp Cave 5"],fogLampCave6:[78,"Fog Lamp Cave 6"],fogLampCave7:[79,"Fog Lamp Cave 7"],portoa:[80,"Portoa"],portoaFishermanIsland:[81,"Portoa - Fisherman Island"],mesiaShrine:[82,"Mesia Shrine"],waterfallCave1:[84,"Waterfall Cave 1"],waterfallCave2:[85,"Waterfall Cave 2"],waterfallCave3:[86,"Waterfall Cave 3"],waterfallCave4:[87,"Waterfall Cave 4"],towerEntrance:[88,"Tower - Entrance"],tower1:[89,
"Tower 1"],tower2:[90,"Tower 2"],tower3:[91,"Tower 3"],towerOutsideMesia:[92,"Tower - Outside Mesia"],towerOutsideDyna:[93,"Tower - Outside Dyna"],towerMesia:[94,"Tower - Mesia"],towerDyna:[95,"Tower - Dyna"],angrySea:[96,"Angry Sea"],boatHouse:[97,"Boat House"],joelLighthouse:[98,"Joel - Lighthouse"],undergroundChannel:[100,"Underground Channel"],zombieTown:[101,"Zombie Town"],evilSpiritIsland1:[104,"Evil Spirit Island 1"],evilSpiritIsland2:[105,"Evil Spirit Island 2"],evilSpiritIsland3:[106,"Evil Spirit Island 3"],
evilSpiritIsland4:[107,"Evil Spirit Island 4"],saberaPalace1:[108,"Sabera Palace 1"],saberaPalace2:[109,"Sabera Palace 2"],saberaPalace3:[110,"Sabera Palace 3"],joelSecretPassage:[112,"Joel - Secret Passage"],joel:[113,"Joel"],swan:[114,"Swan"],swanGate:[115,"Swan - Gate"],goaValley:[120,"Goa Valley"],mtHydra:[124,"Mt Hydra"],mtHydraCave1:[125,"Mt Hydra - Cave 1"],mtHydraOutsideShyron:[126,"Mt Hydra - Outside Shyron"],mtHydraCave2:[127,"Mt Hydra - Cave 2"],mtHydraCave3:[128,"Mt Hydra - Cave 3"],mtHydraCave4:[129,
"Mt Hydra - Cave 4"],mtHydraCave5:[130,"Mt Hydra - Cave 5"],mtHydraCave6:[131,"Mt Hydra - Cave 6"],mtHydraCave7:[132,"Mt Hydra - Cave 7"],mtHydraCave8:[133,"Mt Hydra - Cave 8"],mtHydraCave9:[134,"Mt Hydra - Cave 9"],mtHydraCave10:[135,"Mt Hydra - Cave 10"],styx1:[136,"Styx 1"],styx2:[137,"Styx 2"],styx3:[138,"Styx 3"],shyron:[140,"Shyron"],goa:[142,"Goa"],goaFortressOasisEntrance:[143,"Goa Fortress - Oasis Entrance"],desert1:[144,"Desert 1"],oasisCaveMain:[145,"Oasis Cave - Main"],desertCave1:[146,
"Desert Cave 1"],sahara:[147,"Sahara"],saharaOutsideCave:[148,"Sahara - Outside Cave"],desertCave2:[149,"Desert Cave 2"],saharaMeadow:[150,"Sahara Meadow"],desert2:[152,"Desert 2"],pyramidEntrance:[156,"Pyramid - Entrance"],pyramidBranch:[157,"Pyramid - Branch"],pyramidMain:[158,"Pyramid - Main"],pyramidDraygon:[159,"Pyramid - Draygon"],cryptEntrance:[160,"Crypt - Entrance"],cryptHall1:[161,"Crypt - Hall 1"],cryptBranch:[162,"Crypt - Branch"],cryptDeadEndLeft:[163,"Crypt - Dead End Left"],cryptDeadEndRight:[164,
"Crypt - Dead End Right"],cryptHall2:[165,"Crypt - Hall 2"],cryptDraygon2:[166,"Crypt - Draygon 2"],cryptTeleporter:[167,"Crypt - Teleporter"],goaFortressEntrance:[168,"Goa Fortress - Entrance"],goaFortressKelbesque:[169,"Goa Fortress - Kelbesque"],goaFortressZebu:[170,"Goa Fortress - Zebu"],goaFortressSabera:[171,"Goa Fortress - Sabera"],goaFortressTornel:[172,"Goa Fortress - Tornel"],goaFortressMado1:[173,"Goa Fortress - Mado 1"],goaFortressMado2:[174,"Goa Fortress - Mado 2"],goaFortressMado3:[175,
"Goa Fortress - Mado 3"],goaFortressKarmine1:[176,"Goa Fortress - Karmine 1"],goaFortressKarmine2:[177,"Goa Fortress - Karmine 2"],goaFortressKarmine3:[178,"Goa Fortress - Karmine 3"],goaFortressKarmine4:[179,"Goa Fortress - Karmine 4"],goaFortressKarmine5:[180,"Goa Fortress - Karmine 5"],goaFortressKarmine6:[181,"Goa Fortress - Karmine 6"],goaFortressKarmine7:[182,"Goa Fortress - Karmine 7"],goaFortressExit:[183,"Goa Fortress - Exit"],oasisCaveEntrance:[184,"Oasis Cave - Entrance"],goaFortressAsina:[185,
"Goa Fortress - Asina"],goaFortressKensu:[186,"Goa Fortress - Kensu"],goaHouse:[187,"Goa - House"],goaInn:[188,"Goa - Inn"],goaToolShop:[190,"Goa - Tool Shop"],goaTavern:[191,"Goa - Tavern"],leafElderHouse:[192,"Leaf - Elder House"],leafRabbitHut:[193,"Leaf - Rabbit Hut"],leafInn:[194,"Leaf - Inn"],leafToolShop:[195,"Leaf - Tool Shop"],leafArmorShop:[196,"Leaf - Armor Shop"],leafStudentHouse:[197,"Leaf - Student House"],brynmaerTavern:[198,"Brynmaer - Tavern"],brynmaerPawnShop:[199,"Brynmaer - Pawn Shop"],
brynmaerInn:[200,"Brynmaer - Inn"],brynmaerArmorShop:[201,"Brynmaer - Armor Shop"],brynmaerItemShop:[203,"Brynmaer - Item Shop"],oakElderHouse:[205,"Oak - Elder House"],oakMotherHouse:[206,"Oak - Mother House"],oakToolShop:[207,"Oak - Tool Shop"],oakInn:[208,"Oak - Inn"],amazonesInn:[209,"Amazones - Inn"],amazonesItemShop:[210,"Amazones - Item Shop"],amazonesArmorShop:[211,"Amazones - Armor Shop"],amazonesElder:[212,"Amazones - Elder"],nadare:[213,"Nadare"],portoaFishermanHouse:[214,"Portoa - Fisherman House"],
portoaPalaceEntrance:[215,"Portoa - Palace Entrance"],portoaFortuneTeller:[216,"Portoa - Fortune Teller"],portoaPawnShop:[217,"Portoa - Pawn Shop"],portoaArmorShop:[218,"Portoa - Armor Shop"],portoaInn:[220,"Portoa - Inn"],portoaToolShop:[221,"Portoa - Tool Shop"],portoaPalaceLeft:[222,"Portoa - Palace Left"],portoaPalaceThroneRoom:[223,"Portoa - Palace Throne Room"],portoaPalaceRight:[224,"Portoa - Palace Right"],portoaAsinaRoom:[225,"Portoa - Asina Room"],amazonesElderDownstairs:[226,"Amazones - Elder Downstairs"],
joelElderHouse:[227,"Joel - Elder House"],joelShed:[228,"Joel - Shed"],joelToolShop:[229,"Joel - Tool Shop"],joelInn:[231,"Joel - Inn"],zombieTownHouse:[232,"Zombie Town - House"],zombieTownHouseBasement:[233,"Zombie Town - House Basement"],swanToolShop:[235,"Swan - Tool Shop"],swanStomHut:[236,"Swan - Stom Hut"],swanInn:[237,"Swan - Inn"],swanArmorShop:[238,"Swan - Armor Shop"],swanTavern:[239,"Swan - Tavern"],swanPawnShop:[240,"Swan - Pawn Shop"],swanDanceHall:[241,"Swan - Dance Hall"],shyronFortress:[242,
"Shyron - Fortress"],shyronTrainingHall:[243,"Shyron - Training Hall"],shyronHospital:[244,"Shyron - Hospital"],shyronArmorShop:[245,"Shyron - Armor Shop"],shyronToolShop:[246,"Shyron - Tool Shop"],shyronInn:[247,"Shyron - Inn"],saharaInn:[248,"Sahara - Inn"],saharaToolShop:[249,"Sahara - Tool Shop"],saharaElderHouse:[250,"Sahara - Elder House"],saharaPawnShop:[251,"Sahara - Pawn Shop"]},locationNames$$module$js$rom$location=(()=>{const a=[];for(const b of Object.keys(LOCATIONS$$module$js$rom$location)){const [c,
d]=LOCATIONS$$module$js$rom$location[b];a[c]=d}return a})(),locationKeys$$module$js$rom$location=(()=>{const a=[];for(const b of Object.keys(LOCATIONS$$module$js$rom$location)){const [c]=LOCATIONS$$module$js$rom$location[b];a[c]=b}return a})(),NEXUSES$$module$js$rom$location={mtSabreWestLower:!0,mtSabreWestUpper:!0,mtSabreNorthMain:!0,mtSabreNorthMiddle:!0,mtSabreNorthCave1:!0,mtSabreNorthCave2:!0,mtHydra:!0,mtHydraOutsideShyron:!0,mtHydraCave1:!0},BOSS_SCREENS$$module$js$rom$location={sealedCave7:145,
swamp:124,mtSabreNorthMain:181,saberaPalace1:253,saberaPalace3:253,shyronFortress:112,goaFortressKelbesque:115,goaFortressTornel:145,goaFortressAsina:145,goaFortressKarmine7:253,pyramidDraygon:249,cryptDraygon2:250,towerDyna:92};var module$js$rom$location={};module$js$rom$location.Location=Location$$module$js$rom$location;module$js$rom$location.Entrance=Entrance$$module$js$rom$location;module$js$rom$location.Exit=Exit$$module$js$rom$location;module$js$rom$location.Flag=Flag$$module$js$rom$location;
module$js$rom$location.Pit=Pit$$module$js$rom$location;module$js$rom$location.Spawn=Spawn$$module$js$rom$location;module$js$rom$location.LOCATIONS=LOCATIONS$$module$js$rom$location;const EMPTY_ITERATOR$$module$js$rom$constraint={next(){return{done:!0}}},NONE$$module$js$rom$constraint={get size(){return 0},has(){return!1},[Symbol.iterator](){return EMPTY_ITERATOR$$module$js$rom$constraint}},ALL$$module$js$rom$constraint={get size(){return Infinity},has(){return!0},[Symbol.iterator](){throw Error("cannot iterate");}};
class Bit$$module$js$rom$constraint{constructor(a){this.bit=a}get size(){return 1}has(a){return a===this.bit}[Symbol.iterator](){return[this.bit][Symbol.iterator]()}}function bit$$module$js$rom$constraint(a){return new Bit$$module$js$rom$constraint(a)}var CSet$$module$js$rom$constraint;
(function(a){a.intersect=function(a,c){if(a===ALL$$module$js$rom$constraint||!c.size)return c;if(c===ALL$$module$js$rom$constraint||!a.size)return a;const b=new Set;for(const d of a)c.has(d)&&b.add(d);return b.size?b:NONE$$module$js$rom$constraint};a.union=function(a,c){if(a===ALL$$module$js$rom$constraint||!c.size)return a;if(c===ALL$$module$js$rom$constraint||!a.size)return c;a=new Set(a);for(const b of c)a.add(b);return a};a.isSubset=function(a,c){if(c===ALL$$module$js$rom$constraint||!a.size)return!0;
if(a.size>c.size)return!1;for(const b of a)if(!c.has(b))return!1;return!0};a.label=function(a){return a===ALL$$module$js$rom$constraint?"all":[...a].sort().join(" ")}})(CSet$$module$js$rom$constraint||(CSet$$module$js$rom$constraint={}));
class Constraint$$module$js$rom$constraint{constructor(a,b,c){this.fixed=a;this.float=b;this.shift=c}get pat0(){return this.fixed[0]}get pat1(){return this.fixed[1]}get pal2(){return this.fixed[2]}get pal3(){return this.fixed[3]}static get ALL(){return new Constraint$$module$js$rom$constraint([ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],[],0)}static get NONE(){return new Constraint$$module$js$rom$constraint([NONE$$module$js$rom$constraint,
NONE$$module$js$rom$constraint,NONE$$module$js$rom$constraint,NONE$$module$js$rom$constraint],[],0)}static get MIMIC(){return new Constraint$$module$js$rom$constraint([ALL$$module$js$rom$constraint,bit$$module$js$rom$constraint(108),ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],[],2)}static get TREASURE_CHEST(){return new Constraint$$module$js$rom$constraint([ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],[TREASURE_CHEST_BANKS$$module$js$rom$constraint],
0)}static get BOSS(){return new Constraint$$module$js$rom$constraint([TREASURE_CHEST_BANKS$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],[],0)}static get COIN(){return new Constraint$$module$js$rom$constraint([COIN_BANKS$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],[],0)}static get STOM_FIGHT(){return new Constraint$$module$js$rom$constraint([ALL$$module$js$rom$constraint,
new Set([77]),ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],[],0)}static get GUARDIAN_STATUE(){return new Constraint$$module$js$rom$constraint([new Set([116]),new Set([98]),ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],[],0)}static get SHOOTING_WALL(){return new Constraint$$module$js$rom$constraint([new Set([97]),ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],[],0)}static get KENSU_CHEST(){return new Constraint$$module$js$rom$constraint([new Set([81]),
ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],[],0)}static forLocation(a){switch(a){case 3:return new Constraint$$module$js$rom$constraint([ALL$$module$js$rom$constraint,bit$$module$js$rom$constraint(96),ALL$$module$js$rom$constraint,bit$$module$js$rom$constraint(32)],[],0);case 96:case 100:case 104:return new Constraint$$module$js$rom$constraint([ALL$$module$js$rom$constraint,bit$$module$js$rom$constraint(82),ALL$$module$js$rom$constraint,bit$$module$js$rom$constraint(8)],
[],0)}return Constraint$$module$js$rom$constraint.ALL}static fromSpawn(a,b,c,d,e){const [f,...g]=b;(e=e&&2===f&&!g.length)&&d.patternBank&&(b=new Set([3]));const h=e||!b.has(2)?ALL$$module$js$rom$constraint:bit$$module$js$rom$constraint(c.spritePatterns[0]);b=e||!b.has(3)?ALL$$module$js$rom$constraint:bit$$module$js$rom$constraint(c.spritePatterns[1]);d=e?[bit$$module$js$rom$constraint(c.spritePatterns[d.patternBank])]:[];e=a.has(2)?bit$$module$js$rom$constraint(c.spritePalettes[0]):ALL$$module$js$rom$constraint;
a=a.has(3)?bit$$module$js$rom$constraint(c.spritePalettes[1]):ALL$$module$js$rom$constraint;return new Constraint$$module$js$rom$constraint([h,b,e,a],d,0)}ignorePalette(){return new Constraint$$module$js$rom$constraint([this.fixed[0],this.fixed[1],ALL$$module$js$rom$constraint,ALL$$module$js$rom$constraint],this.float,this.shift)}shufflePalette(a,b){const c=[...this.fixed];for(let d=2;4>d;d++){if(c[d]===ALL$$module$js$rom$constraint)continue;const e=Math.floor(5-Math.log2(a.nextInt(15)+2)),f=c[d]=
new Set;for(let c=0;c<e;c++)f.add(a.pick(b))}return new Constraint$$module$js$rom$constraint(c,this.float,this.shift)}shifted(){return new Constraint$$module$js$rom$constraint(this.fixed,this.float,this.shift|2)}join(a){const b=seq$$module$js$rom$util(4,(b)=>CSet$$module$js$rom$constraint.union(this.fixed[b],a.fixed[b]));if(this.float.length!=a.float.length)throw console.dir(this),console.dir(a),Error(`incompatible float: ${this.float} ${a.float}`);const c=seq$$module$js$rom$util(this.float.length,
(b)=>CSet$$module$js$rom$constraint.union(this.float[b],a.float[b]));return new Constraint$$module$js$rom$constraint(b,c,this.shift|a.shift)}fix(a,b){var c=b?(a)=>b.nextInt(a):()=>0;const d=b?(a)=>b.pick([...a]):(a)=>a[Symbol.iterator]().next().value,e=[...this.fixed];if(this.float.length){c=c(2);const a=1-c;c<this.float.length&&(e[0]=CSet$$module$js$rom$constraint.intersect(e[0],this.float[c]));a<this.float.length&&(e[1]=CSet$$module$js$rom$constraint.intersect(e[1],this.float[a]))}e[0]!==ALL$$module$js$rom$constraint&&
(a.spritePatterns[0]=d([...e[0]]));e[1]!==ALL$$module$js$rom$constraint&&(a.spritePatterns[1]=d([...e[1]]));e[2]!==ALL$$module$js$rom$constraint&&(a.spritePalettes[0]=d([...e[2]]));e[3]!==ALL$$module$js$rom$constraint&&(a.spritePalettes[1]=d([...e[3]]))}meet(a,b=!1){a=this.tryMeet(a,b);if(!a)throw Error("Could not reconcile patterns");return a}tryMeet(a,b=!1){const c=[];let d=this.shift|a.shift;for(var e=0;4>e;e++){var f=CSet$$module$js$rom$constraint.intersect(this.fixed[e],a.fixed[e]);if(!f.size){if(!b||
2>e)return;f=CSet$$module$js$rom$constraint.union(this.fixed[e],a.fixed[e])}c.push(f)}e=new Map;b=[];for(var g of module$js$util.iters.concat(this.float,a.float)){if(g===ALL$$module$js$rom$constraint)throw Error("Unexpected unconstrained float");a=!1;for(var h of g)if(f=e.get(h),null!=f){for(var k of b[f])e.delete(k);b[f]=CSet$$module$js$rom$constraint.intersect(b[f],g);for(const a of b[f])e.set(a,f);a=!0;break}if(a)break;for(const a of g)e.set(a,b.length);b.push(g);if(2<b.length)return}for(g=0;g<
b.length;g++)for(h=0;2>h;h++)if(!CSet$$module$js$rom$constraint.intersect(b[g],c[h]).size){k=c[1-h]=CSet$$module$js$rom$constraint.intersect(b[g],c[1-h]);d|=1<<1-h;if(!k.size)return;b.splice(g,1);g=-1;break}return new Constraint$$module$js$rom$constraint(c,b,d)}}
const TREASURE_CHEST_BANKS$$module$js$rom$constraint=new Set([94,95,96,97,100,101,102,103,104,105,106,108,109,110,111,112,116,117,118,119]),COIN_BANKS$$module$js$rom$constraint=new Set([94,95,96,97,99,100,101,102,103,104,105,106,107,108,109,110,111,112,116,117,118,119]);var module$js$rom$constraint={};module$js$rom$constraint.Constraint=Constraint$$module$js$rom$constraint;class ObjectData$$module$js$rom$objectdata extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.used=!0;this.name="";this.pointer=109568+(b<<1);this.base=readLittleEndian$$module$js$rom$util(a.prg,this.pointer)+65536;this.sfx=a.prg[this.base];this.data=[];b=this.base+1;let c=0;for(let d=0;32>d;d++)d&7||(c=a.prg[b++]),this.data.push(c&128?a.prg[b++]:0),c<<=1}serialize(){const a=[this.sfx];for(let b=0;4>b;b++){const c=a.length;a.push(0);for(let d=0;8>d;d++)this.data[8*b+d]&&(a[c]|=
128>>>d,a.push(this.data[8*b+d]))}return a}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const c=yield a.write(b.serialize(),106496,114687,`Object ${hex$$module$js$rom$util(b.id)}`);writeLittleEndian$$module$js$rom$util(a.rom,b.pointer,c-65536)})}get(a){return this.data[a-768>>>5]}parents(){return[]}locations(){return this.rom.locations.filter((a)=>a.used&&a.spawns.some((a)=>a.isMonster()&&a.monsterId===this.id))}palettes(a){if(34===this.action)return[3];let b=
this.data[0];42===this.action&&(b=this.data[31]|1);41===this.action&&(b=107);38===this.action&&(b=156);a=(void 0===a?0:a)&&this.child?this.rom.metasprites[this.rom.objects[this.rom.adHocSpawns[this.child].objectId].data[0]]:null;return[...new Set([...this.rom.metasprites[b].palettes(),...a?a.palettes():[]])]}isVulnerable(a){return!(this.elements&1<<a)}isShadow(){return 123===this.id||140===this.id}get metasprite(){return METASPRITE$$module$js$rom$objectdata.get(this.data)}set metasprite(a){METASPRITE$$module$js$rom$objectdata.set(this.data,
a)}get speed(){return SPEED$$module$js$rom$objectdata.get(this.data)}set speed(a){SPEED$$module$js$rom$objectdata.set(this.data,a)}get collisionPlane(){return COLLISION_PLANE$$module$js$rom$objectdata.get(this.data)}set collisionPlane(a){COLLISION_PLANE$$module$js$rom$objectdata.set(this.data,a)}get hitbox(){return HITBOX$$module$js$rom$objectdata.get(this.data)}set hitbox(a){HITBOX$$module$js$rom$objectdata.set(this.data,a)}get hp(){return HP$$module$js$rom$objectdata.get(this.data)}set hp(a){HP$$module$js$rom$objectdata.set(this.data,
a)}get atk(){return ATK$$module$js$rom$objectdata.get(this.data)}set atk(a){ATK$$module$js$rom$objectdata.set(this.data,a)}get def(){return DEF$$module$js$rom$objectdata.get(this.data)}set def(a){DEF$$module$js$rom$objectdata.set(this.data,a)}get level(){return LEVEL$$module$js$rom$objectdata.get(this.data)}set level(a){LEVEL$$module$js$rom$objectdata.set(this.data,a)}get poison(){return!!POISON$$module$js$rom$objectdata.get(this.data)}set poison(a){POISON$$module$js$rom$objectdata.set(this.data,
a?1:0)}get child(){return CHILD$$module$js$rom$objectdata.get(this.data)}set child(a){CHILD$$module$js$rom$objectdata.set(this.data,a)}get terrainSusceptibility(){return TERRAIN_SUSCEPTIBILITY$$module$js$rom$objectdata.get(this.data)}set terrainSusceptibility(a){TERRAIN_SUSCEPTIBILITY$$module$js$rom$objectdata.set(this.data,a)}get immobile(){return!!IMMOBILE$$module$js$rom$objectdata.get(this.data)}set immobile(a){IMMOBILE$$module$js$rom$objectdata.set(this.data,a?1:0)}get action(){return ACTION$$module$js$rom$objectdata.get(this.data)}set action(a){ACTION$$module$js$rom$objectdata.set(this.data,
a)}get replacement(){return REPLACEMENT$$module$js$rom$objectdata.get(this.data)}set replacement(a){REPLACEMENT$$module$js$rom$objectdata.set(this.data,a)}get goldDrop(){return GOLD_DROP$$module$js$rom$objectdata.get(this.data)}set goldDrop(a){GOLD_DROP$$module$js$rom$objectdata.set(this.data,a)}get elements(){return ELEMENTS$$module$js$rom$objectdata.get(this.data)}set elements(a){ELEMENTS$$module$js$rom$objectdata.set(this.data,a)}get expReward(){return EXP_REWARD$$module$js$rom$objectdata.get(this.data)}set expReward(a){EXP_REWARD$$module$js$rom$objectdata.set(this.data,
a)}get attackType(){return ATTACK_TYPE$$module$js$rom$objectdata.get(this.data)}set attackType(a){ATTACK_TYPE$$module$js$rom$objectdata.set(this.data,a)}get statusEffect(){return STATUS_EFFECT$$module$js$rom$objectdata.get(this.data)}set statusEffect(a){STATUS_EFFECT$$module$js$rom$objectdata.set(this.data,a)}}function prop$$module$js$rom$objectdata(...a){return new Stat$$module$js$rom$objectdata(...a)}
class Stat$$module$js$rom$objectdata{constructor(...a){this.spec=a}get(a){let b=0;for(const c of this.spec){const [d,e=255,f=0]=c;b|=(a[d-768>>>5]&e)>>>(0>f?0:f)<<(0>f?-f:0)}return b}set(a,b){for(const c of this.spec){const [d,e=255,f=0]=c;{const c=d-768>>>5;a[c]=a[c]&~e|b>>>(0>f?-f:0)<<(0>f?0:f)&e}}}}
const METASPRITE$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([768]),SPEED$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([832,15]),COLLISION_PLANE$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([928,240,4]),HITBOX$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1056,64,2],[928,15]),HP$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([960]),ATK$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([992]),DEF$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1024]),
LEVEL$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1056,31]),POISON$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1056,128,7]),CHILD$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1088]),TERRAIN_SUSCEPTIBILITY$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1120]),IMMOBILE$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1184,128,7]),ACTION$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1184,127]),REPLACEMENT$$module$js$rom$objectdata=
prop$$module$js$rom$objectdata([1216]),GOLD_DROP$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1280,240,4]),ELEMENTS$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1280,15]),EXP_REWARD$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1312]),ATTACK_TYPE$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1344]),STATUS_EFFECT$$module$js$rom$objectdata=prop$$module$js$rom$objectdata([1376,15]);var module$js$rom$objectdata={};module$js$rom$objectdata.ObjectData=ObjectData$$module$js$rom$objectdata;class Monster$$module$js$rom$monster extends ObjectData$$module$js$rom$objectdata{constructor(a,b){var [c,d,e,f={}]=b;super(a,d);this.constraint=Constraint$$module$js$rom$constraint.ALL;this.name=c;a=(level$$module$js$rom$monster(e)+this.level)/2;b=a+playerSword$$module$js$rom$monster(e,this.elements);this.hits=(this.hp+1)/(b-this.def);this.sdef=this.def/b;a=Math.min(255,Math.max(16,32+16*a));this.satk=(this.atk-expectedPlayerDefense$$module$js$rom$monster(e,this.attackType))/a;this.extraDifficulty=
f.difficulty||0;this.monsterClass=f.monsterClass;a=processExpReward$$module$js$rom$monster(this.expReward)/baselineExp$$module$js$rom$monster(e);this.wealth=(b=VANILLA_GOLD_DROPS$$module$js$rom$monster[this.goldDrop]/baselineGold$$module$js$rom$monster(e))&&b/(a+b)}placement(){const a=ACTION_SCRIPTS$$module$js$rom$monster.get(this.action);return a&&a.placement||"normal"}clearance(){const a=ACTION_SCRIPTS$$module$js$rom$monster.get(this.action);return a&&a.large?6:3}totalDifficulty(){return this.toughness()+
this.attack()+this.statusDifficulty()+this.immunities()+this.movement()}collectDifficulty(a,b){let c=a(this);var d=this.spawnedChild();d&&(c=b(c,d.collectDifficulty(a,b)));(d=this.spawnedReplacement())&&(c=b(c,d.collectDifficulty(a,b)));return c}toughness(){return this.collectDifficulty((a)=>lookup$$module$js$rom$monster(a.hits,0,[2,1],[3,2],[5,3],[7,4],[10,5],[13,6]),Math.max)}attack(){return this.collectDifficulty((a)=>a.attackType&&a.statusEffect?0:lookup$$module$js$rom$monster(a.satk,0,[.04,1],
[.08,2],[.13,3],[.18,4],[.25,5],[.33,6]),Math.max)}addStatusEffects(a){this.attackType&&this.statusEffect?a.add(this.statusEffect):!this.attackType&&this.poison&&a.add(0);var b=this.spawnedReplacement();b&&b.addStatusEffects(a);(b=this.spawnedChild())&&b.addStatusEffects(a)}statusDifficulty(){const a=new Set;this.addStatusEffects(a);let b=0;for(const c of a)b+=STATUS_DIFFICULTY$$module$js$rom$monster[c];return b}immunities(){let a=0,b=this.elements;for(;b;)b&1&&a++,b>>>=1;return a&&1<<a-1}movement(){return this.collectDifficulty((a)=>
{const b=ACTION_SCRIPTS$$module$js$rom$monster.get(a.action),c=a.spawnedChild();a=a.extraDifficulty;b&&(a+=b.movement||0,b.large&&a++,c&&!c.statusEffect&&(a+=b.projectile||0));167===this.metasprite&&(a+=2);return a},(a,b)=>a+b)}spawnedChild(){var a=ACTION_SCRIPTS$$module$js$rom$monster.get(this.action);if(a&&a.child&&(a=(a=this.rom.adHocSpawns[this.child])&&a.objectId,null!=a))return a=this.rom.objects[a],a instanceof Monster$$module$js$rom$monster?a:void 0}spawnedReplacement(){if(this.replacement){var a=
this.rom.objects[this.replacement];return a instanceof Monster$$module$js$rom$monster?a:void 0}}totalReward(){return this.totalDifficulty()/4}normalizedGold(){if(!this.wealth)return 0;const a=this.totalDifficulty()*this.wealth*.6;return Math.max(1,Math.min(15,Math.round(a)))}normalizedExp(){if(1===this.wealth)return 0;const a=.488+this.totalDifficulty()*(1-this.wealth)*.256;return Math.max(1,Math.min(255,Math.round(32*a)))}}
function processExpReward$$module$js$rom$monster(a){return 128>a?a:(a&127)<<4}function baselineExp$$module$js$rom$monster(a){return Math.pow(2,a/5-1)}const STATUS_DIFFICULTY$$module$js$rom$monster=[2,1,3,2,4],VANILLA_GOLD_DROPS$$module$js$rom$monster=[0,1,2,4,8,16,30,50,100,200,400,50,100,200,400,500];function baselineGold$$module$js$rom$monster(a){return Math.pow(2,a/7-1)}
const ACTION_SCRIPTS$$module$js$rom$monster=new Map([[16,{}],[17,{}],[22,{}],[23,{}],[27,{}],[29,{child:!0}],[30,{}],[31,{}],[32,{movement:1}],[33,{child:!0,large:!0,movement:2}],[34,{child:!0,movement:3}],[36,{movement:3}],[37,{movement:3}],[38,{child:!0,projectile:1,movement:3}],[39,{child:!0,projectile:1,movement:3}],[40,{child:!0,projectile:2,movement:3,metasprites:()=>[101,145]}],[41,{child:!0,movement:5,metasprites:()=>[107,104]}],[42,{child:!0,projectile:1,movement:4,metasprites:(a)=>[0,1,
2,3].map((b)=>b+a.data[31])}],[43,{movement:4}],[44,{child:!0}],[46,{child:!0,large:!0,projectile:2,movement:3}],[47,{}],[52,{child:!0}],[56,{}],[60,{}],[64,{child:!0,moth:!0,movement:4,placement:"moth"}],[65,{child:!0,movement:3}],[68,{movement:3}],[69,{child:!0,bird:!0,projectile:2,movement:5,placement:"bird"}],[76,{child:!0,stationary:!0,projectile:3,placement:"plant"}],[77,{child:!0,stationary:!0,projectile:3}],[78,{child:!0,stationary:!0}],[87,{}],[88,{}],[92,{child:!0,projectile:3,movement:1}],
[93,{bird:!0,movement:6,placement:"bird"}],[94,{child:!0,projectile:1,movement:4,metasprites:(a)=>[0,1,2,3].map((b)=>b+a.data[31])}],[96,{boss:!0}],[97,{}],[99,{boss:!0}],[100,{boss:!0}],[102,{boss:!0}],[103,{boss:!0}],[104,{boss:!0}],[106,{boss:!0}],[107,{boss:!0}],[112,{boss:!0}],[127,{boss:!0}]]);function level$$module$js$rom$monster(a){return 24>a?1+a/3:(a+12)/4}
function playerSword$$module$js$rom$monster(a,b){b=void 0===b?0:b;a=10>a?1:18>a?2:38>a?4:8;for(let c=a;c;c>>>=1)if(!(c&b))return c<<1;return a<<1}function expectedPlayerDefense$$module$js$rom$monster(a,b){return level$$module$js$rom$monster(a)+playerArmor$$module$js$rom$monster(a,b)}
function playerArmor$$module$js$rom$monster(a,b){return b?lookup$$module$js$rom$monster(a,2,[6,6],[18,8],[25,12],[30,18],[37,24],[42,32]):lookup$$module$js$rom$monster(a,2,[6,6],[18,10],[25,14],[30,18],[40,24],[46,32])}function lookup$$module$js$rom$monster(a,b,...c){for(let b=c.length-1;0<=b;b--){const [d,f]=c[b];if(a>=d)return f}return b}var module$js$rom$monster={};module$js$rom$monster.Monster=Monster$$module$js$rom$monster;module$js$rom$monster.ACTION_SCRIPTS=ACTION_SCRIPTS$$module$js$rom$monster;class Maze$$module$js$maze$maze{constructor(a,b,c,d,e){this.random=a;this.height=b;this.width=c;this.extraTiles=e;this.extraTilesMap=[];this.map=Array(b<<4).fill(void 0);this.screens=new Map(d.map((a)=>[a.edges,a]));this.allPos=new Set([].concat(...seq$$module$js$rom$util(b,(a)=>seq$$module$js$rom$util(c,(b)=>a<<4|b))));this.allPosArray=[...this.allPos];a=new DefaultMap$$module$js$util(()=>[]);for(const b of this.screens){const [c,e]=b;if(!e.fixed)for(const b of module$js$maze$types.Dir.ALL)d=15<<
(b<<2),c&d&&a.get(c&~d&65535).push([b,c])}this.screenExtensions=a;this.border=Array(b<<4).fill(0);e&&(this.counts=new Multiset$$module$js$util)}*alternates(){for(const a of this.allPos){const b=this.map[a];if(null!=b)for(let c=65536;2097152>c;c<<=1){const d=b|c,e=this.screens.get(d);b&c||!e||(yield[a,c,d,e])}}}saveExcursion(a){let b=[...this.map],c=this.counts?[...this.counts]:null,d=[...this.border];try{if(a())return!0}catch(e){throw this.map=b,this.border=d,c&&(this.counts=new Multiset$$module$js$util(c)),
e;}this.map=b;this.border=d;c&&(this.counts=new Multiset$$module$js$util(c));return!1}*extensions(){const a=new UnionFind$$module$js$unionfind,b=[];for(const d of this.allPos){var c=this.map[d];if(null==c)for(const b of[d-1,d-16])this.empty(b)&&a.union([d,b]);else for(const a of this.screenExtensions.get(c&65535)){const [e,g]=a;c=module$js$maze$types.Pos.plus(d,e);!this.map[c]&&this.inBounds(c)&&b.push([d,g,e,0])}}for(const c of b){const [b,,d]=c;c[3]=a.find(module$js$maze$types.Pos.plus(b,d))<<4|
module$js$maze$types.Scr.edge(c[1],c[2]);yield c}}*eligible(a,b){b=void 0===b?{}:b;const {allowed:c,skipAlternates:d,maxExits:e,edge:f,fuzzy:g,stair:h}=b;var k=null!=f?f|f<<4|f<<8|f<<12:void 0;let l=b=0,m=0;for(var n of module$js$maze$types.Dir.ALL){var p=module$js$maze$types.Dir.edgeMask(n),q=module$js$maze$types.Dir.edgeMask(module$js$maze$types.Dir.inv(n));let c=this.get(a,n);null==c&&(c=k);null!=c&&(m|=((c&q)>>>8|(c&q)<<8)&65535,b|=p,g&&this.isFixed(module$js$maze$types.Pos.plus(a,n))&&(l|=p))}g||
(l=b);a=m&l;n=[];k=Infinity;p=c?module$js$util.iters.map(c,(a)=>[a,this.screens.get(a)]):this.screens;for(const c of p){const [f,t]=c;if(!t)throw Error("Bad Scr in 'allowed'!");if(!(t.fixed||d&&t.edges&-65536||null!=h&&!t.stairs.some((a)=>a.dir===h)||null==h&&t.stairs.length||(f&l)!==a||e&&module$js$maze$types.Scr.numExits(f)>e))if(g){p=0;q=f&b^m;for(const a of module$js$maze$types.Dir.ALL)q&15<<module$js$maze$types.Dir.shift(a)&&p++;p<k?(k=p,n=[f]):p===k&&n.push(f)}else yield f}g&&(yield*n)}fill(a,
b){b=void 0===b?{}:b;if(b.force&&b.fuzzy)throw Error("invalid");const c=[...this.eligible(a,b)];if(!c.length){if(b.deleteNeighbors)for(const c of module$js$maze$types.Dir.ALL)b=module$js$maze$types.Pos.plus(a,c),this.isFixed(b)||this.setInternal(b,null);return!1}if(b.fuzzy)return this.setAndUpdate(a,this.random.pick(c),b);this.set(a,this.random.pick(c),b);return!0}fillPath(a,b,c,d,e){e=void 0===e?{}:e;return this.saveExcursion(()=>{var f=[...c];for(const c of f){f=module$js$maze$types.Dir.turn(b,
c);a=module$js$maze$types.Pos.plus(a,b);let g=module$js$maze$types.Scr.fromExits(module$js$maze$types.DirMask.of(module$js$maze$types.Dir.inv(b),f),d);const k=e.pathAlternatives&&e.pathAlternatives.get(g);k&&(g|=this.random.pick(k)<<16);if(!this.trySet(a,g,e))return!1;b=f}return this.fill(module$js$maze$types.Pos.plus(a,b),Object.assign({},e,{maxExits:2}))})}fillAll(a){a=void 0===a?{}:a;const b=a.shuffleOrder?this.random.shuffle([...this.allPos]):this.allPos;for(const c of b)if(null==this.map[c]&&
!this.fill(c,a)){a.print&&console.log(`Could not fill ${hex$$module$js$rom$util(c)}\n${this.show()}`);if(a.fuzzy)return!1;throw Error(`Could not fill ${hex$$module$js$rom$util(c)}`);}return!0}randomPos(){return this.random.pick(this.allPosArray)}addScreen(a){for(const b of this.random.shuffle([...this.allPos]))if(null==this.map[b]&&this.trySet(b,a))return b}addDeadEnd(){return!1}addLoop(a){a=void 0===a?{}:a;var b=new DefaultMap$$module$js$util(()=>[]);for(var c of this.extensions()){const [a,d,e,
f]=c;b.get(f).push([a,d,e,f&15])}b=[...b.values()];this.random.shuffle(b);do if(c=b.pop(),!c)return!1;while(2>c.length);this.random.shuffle(c);const [[d,e,f,g],[h,k,l]]=c;return this.saveExcursion(()=>{this.replace(d,e);this.replace(h,k);var b=module$js$maze$types.Pos.plus(h,l);if(module$js$maze$types.Pos.plus(d,f)===b)return this.fill(b,Object.assign({},a,{maxExits:2,replace:!0}));const [c,p]=module$js$maze$types.Pos.relative(d,f,b);b=0;for(const e of module$js$maze$types.Path.generate(this.random,
c,p)){if(this.fillPath(d,f,e,g,Object.assign({},a,{replace:!0})))break;if(20<++b)return!1}return!0})}connect(a,b,c,d,e){null==b&&(b=this.findEmptyDir(a));if(null==b)return!1;const f=module$js$maze$types.Scr.edge(this.map[a]||0,b);if(null==c){c=[];for(var g of this.extensions()){const [a,b,,d]=g;(d&15)===f&&c.push([a,b,0])}if(!c.length)return!1;g=this.random.pick(c);this.replace(c=g[0],g[1])}null==d&&(d=this.findEmptyDir(c));if(null==b||null==d)return!1;if(f!==module$js$maze$types.Scr.edge(this.map[c]||
0,d))throw Error("Incompatible exit types");c=module$js$maze$types.Pos.plus(c,d);const [h,k]=module$js$maze$types.Pos.relative(a,b,c);d=0;for(const c of module$js$maze$types.Path.generate(this.random,h,k)){if(this.fillPath(a,b,c,f,e))break;if(20<++d)return!1}return!0}findEmptyDir(a){const b=this.map[a];if(null==b)return null;const c=[];for(const d of module$js$maze$types.Dir.ALL)module$js$maze$types.Scr.edge(b,d)&&this.empty(module$js$maze$types.Pos.plus(a,d))&&c.push(d);return 1===c.length?c[0]:
null}inBounds(a){return 0<=a&&(a&15)<this.width&&a>>>4<this.height}isFixed(a){if(!this.inBounds(a))return!0;a=this.map[a];if(null==a)return!1;a=this.screens.get(a);return!(null==a||!a.fixed&&!a.stairs.length)}density(){return this.allPosArray.filter((a)=>this.map[a]).length/(this.width*this.height)}size(){return this.allPosArray.filter((a)=>this.map[a]).length}trim(){const a=new Set;for(var b of this.screens.values())b.edges||a.add(b.tile);b=(b)=>!this.map[b]||a.has(this.screens.get(this.map[b]).tile);
for(const a=0;seq$$module$js$rom$util(this.width,(b)=>a<<4|b).every(b);)this.map.splice(0,16),this.border.splice(0,16),this.height--;for(let a=this.height-1;0<=a&&seq$$module$js$rom$util(this.width,(b)=>a<<4|b).every(b);a--)this.map.splice(this.height-1<<4,16),this.border.splice(this.height-1<<4,16),this.height--;for(const a=0;seq$$module$js$rom$util(this.height,(b)=>b<<4|a).every(b);){for(var c=this.height-1;0<=c;c--)delete this.map[c<<4|a],this.border[c<<4|a]=0;this.map.push(this.map.shift());this.width--}for(let a=
this.width-1;0<=a&&seq$$module$js$rom$util(this.height,(b)=>b<<4|a).every(b);a--){for(c=this.height-1;0<=c;c--)delete this.map[c<<4|a],this.border[c<<4|a]=0;this.width--}}*[Symbol.iterator](){for(const a of this.allPos){const b=this.map[a];null!=b&&(yield[a,b])}}get(a,b){const c=null!=b?module$js$maze$types.Pos.plus(a,b):a;return this.inBounds(c)?this.map[c]:this.border[a]&15<<((b^2)<<2)}getEdge(a,b){a=this.map[a];if(null!=a)return a>>module$js$maze$types.Dir.shift(b)&15}getSpec(a){a=this.map[a];
return null!=a?this.screens.get(a):a}setBorder(a,b,c){if(!this.inBounds(a)||this.inBounds(module$js$maze$types.Pos.plus(a,b)))throw Error(`Not on border: ${hex$$module$js$rom$util(a)}, ${b}`);if(null!=this.map[a])throw Error("Must set border first.");b=(b^2)<<2;if(this.border[a]&15<<b)throw Error("Border already set");this.border[a]|=c<<b}replaceEdge(a,b,c){const d=module$js$maze$types.Pos.plus(a,b);if(!this.inBounds(a))throw Error(`Out of bounds ${hex$$module$js$rom$util(a)}`);if(!this.inBounds(d))throw Error(`Out of bounds ${hex$$module$js$rom$util(d)}`);
let e=this.map[a],f=this.map[d];if(null==e)throw Error(`No screen for ${hex$$module$js$rom$util(a)}`);if(null==f)throw Error(`No screen for ${hex$$module$js$rom$util(d)}`);const g=module$js$maze$types.Dir.edgeMask(b),h=c<<module$js$maze$types.Dir.shift(b),k=module$js$maze$types.Dir.edgeMask(module$js$maze$types.Dir.inv(b));b=c<<module$js$maze$types.Dir.shift(module$js$maze$types.Dir.inv(b));e=e&~g|h;f=f&~k|b;if(!this.screens.has(e)||!this.screens.has(f))return!1;this.setInternal(a,e);this.setInternal(d,
f);return!0}setAndUpdate(a,b,c){c=void 0===c?{}:c;return this.saveExcursion(()=>{const d="function"===typeof c.fuzzy?c.fuzzy(c):Object.assign({},c,{fuzzy:c.fuzzy&&c.fuzzy-1,replace:!0});this.setInternal(a,b);for(const b of module$js$maze$types.Dir.ALL)if(!this.checkFit(a,b)){const c=module$js$maze$types.Pos.plus(a,b);if(this.isFixed(c)||!this.fill(c,d))return!1}return!0})}set(a,b,c){c=void 0===c?{}:c;if(!(c.force||(c.replace?this.fits(a,b):this.fitsAndEmpty(a,b))))throw c=this.map[a],c=null!=c?hex5$$module$js$rom$util(c):
"empty",Error(`Cannot overwrite ${hex$$module$js$rom$util(a)} (${c}) with ${hex5$$module$js$rom$util(b)}`);if(!this.screens.has(b))throw Error(`No such screen ${hex5$$module$js$rom$util(b)}`);this.inBounds(a)&&this.setInternal(a,b)}trySet(a,b,c){c=void 0===c?{}:c;if(!(c.force||(c.replace?this.fits(a,b):this.fitsAndEmpty(a,b))))return!1;if(!this.screens.has(b))throw Error(`No such screen ${hex5$$module$js$rom$util(b)}`);this.setInternal(a,b);return!0}replace(a,b){if(!this.fits(a,b)||!this.inBounds(a))throw Error(`Cannot place ${hex5$$module$js$rom$util(b)} at ${hex$$module$js$rom$util(a)}`);
if(!this.screens.has(b))throw Error(`No such screen ${hex5$$module$js$rom$util(b)}`);this.setInternal(a,b)}delete(a){this.setInternal(a,null)}setInternal(a,b){const c=this.map[a];null==b?(this.map[a]=void 0,this.counts&&null!=c&&this.counts.delete(c)):(this.map[a]=b,this.counts&&(null!=c&&this.counts.delete(c),this.counts.add(b)))}fitsAndEmpty(a,b){return this.empty(a)&&this.fits(a,b)}empty(a){return null==this.map[a]&&this.inBounds(a)}fits(a,b){for(const c of module$js$maze$types.Dir.ALL){const d=
this.get(a,c);if(null!=d&&module$js$maze$types.Scr.edge(b,c)!==module$js$maze$types.Scr.edge(d,module$js$maze$types.Dir.inv(c)))return!1}return!0}checkFit(a,b){const c=this.get(a);a=this.get(a,b);return null==c||null==a?!0:module$js$maze$types.Scr.edge(c,b)!==module$js$maze$types.Scr.edge(a,module$js$maze$types.Dir.inv(b))?!1:!0}traverse(a){a=void 0===a?{}:a;var b=new Set(a.without||[]),c=!a.noFlagged,d=new UnionFind$$module$js$unionfind;for(const f of this.allPos)if(!b.has(f)){var e=this.map[f];
if(null!=e&&(e=this.screens.get(e),null!=e)){for(const a of e.connections)d.union(a.map((a)=>(f<<8)+a));if(e.wall)for(const a of e.wall.connections(c))d.union(a.map((a)=>(f<<8)+a));a.flight&&e.connections.length&&!e.deadEnd&&d.union(e.connections.map((a)=>(f<<8)+a[0]))}}a=new Map;d=d.sets();for(b=0;b<d.length;b++){c=d[b];for(const b of c)a.set(b,c)}return a}consolidate(a,b,c){if(!this.counts||!this.extraTiles)throw Error("Cannot run consolidate without counts.");var d=new Set(a);const e=new Set;for(var f of this.screens.values())f.fixed||
(0>f.tile||d.has(f.tile))&&e.add(f.edges);d=new Set;for(var g of this.counts)[f]=g,e.has(f)||d.add(f);g=d.size+a.length;for(d=1E3;this.counts.unique()>g&&--d;){var h=[...this.counts].filter((a)=>e.has(a[0])).sort((a,b)=>b[1]-a[1]).map((a)=>a[0]);f=new Set(h.slice(0,a.length));h=new Set(h.slice(a.length));const c=this.random.shuffle([...this.allPos]);for(var k of c)if(h.has(this.map[k])&&this.tryConsolidate(k,f,h,b))break}if(!d)return!1;b=new Set([...this.counts].filter((a)=>e.has(a[0])).map((a)=>
a[0]));a=[];for(var l of e){k=this.screens.get(l);if(!k)throw Error("missing spec");0<=k.tile&&(b.has(l)?b.delete(l):a.push(k.tile))}for(const d of b){l=a.pop();b=this.screens.get(d);if(null==l||!b)throw Error("No available screen");c.screens[l].tiles.splice(0,240,...this.extraTiles[~b.tile]);this.extraTilesMap[~b.tile]=l}return!0}tryConsolidate(a,b,c,d){const e=this.map[a];if(null==e)throw Error("Expected defined");for(const g of this.random.shuffle([...b])){const h=e^g;for(const e of module$js$maze$types.Dir.ALL){var f=
module$js$maze$types.Dir.edgeMask(e);if(h&~f)continue;const k=module$js$maze$types.Pos.plus(a,e);f=this.map[k];if(null==f)break;if(!c.has(f)&&!b.has(f))break;const m=g>>>module$js$maze$types.Dir.shift(e)&15,n=module$js$maze$types.Dir.inv(e),p=module$js$maze$types.Dir.edgeMask(n),q=f&~p|m<<module$js$maze$types.Dir.shift(n);if(c.has(q)&&!c.has(f))break;if(this.saveExcursion(()=>{this.setInternal(a,g);this.setInternal(k,q);return d()}))return!0}}return!1}show(a){a=void 0===a?!1:a;const b=" "+seq$$module$js$rom$util(this.width).join("")+
"\n",c=seq$$module$js$rom$util(this.height,(b)=>b.toString(16)+seq$$module$js$rom$util(this.width,(c)=>{c=this.map[b<<4|c];if(a)return" "+(c||0).toString(16).padStart(5,"0");if(null==c)return" ";var d=this.screens.get(c);if(d)return d.icon;d=0;for(const a of module$js$maze$types.Dir.ALL)c&15<<(a<<2)&&(d|=1<<(a<<2));return UNICODE_TILES$$module$js$maze$maze[d]||" "}).join("")).join("\n");return b+c}write(a,b){for(var c of a.flags)b.add(c.flag);c=0;const d={wall:[],bridge:[]};for(var e of a.spawns){var f=
e.wallType();f&&d[f].push(e);"wall"===f&&(c=e.wallElement())}a.flags=[];a.width=this.width;a.height=this.height;for(e=0;e<this.height;e++)for(a.screens[e]=[],f=0;f<this.width;f++){const h=e<<4|f;var g=this.map[h];if(null==g)throw Error(`Missing screen at pos ${hex$$module$js$rom$util(h)}`);const k=this.screens.get(g);if(!k)throw Error(`Missing spec for ${hex5$$module$js$rom$util(g)} at ${hex$$module$js$rom$util(h)}`);a.screens[e].push(0>k.tile?this.extraTilesMap[~k.tile]:k.tile);k.flag&&a.flags.push(Flag$$module$js$rom$location.of({screen:h,
flag:751}));k.wall&&(a.flags.push(Flag$$module$js$rom$location.of({screen:h,flag:pop$$module$js$maze$maze(b)})),(g=d[k.wall.type].pop())||(g=Spawn$$module$js$rom$location.of({screen:h,tile:k.wall.tile,type:3,id:"wall"===k.wall.type?c:2}),a.spawns.push(g)),g.screen=h,g.tile=k.wall.tile)}}finish(a,b){this.trim();a=new MazeFinisher$$module$js$maze$maze(this,b,a,this.random);if(!a.shuffleFixed())return fail$$module$js$maze$maze("could not shuffle fixed",this);if(!a.placeExits())return fail$$module$js$maze$maze("could not place exits",
this);this.write(b,new Set);a.placeNpcs();b.rom.spoiler&&b.rom.spoiler.addMaze(b.id,b.name,this.show());return!0}}const DEBUG$$module$js$maze$maze=!1;function fail$$module$js$maze$maze(a,b){DEBUG$$module$js$maze$maze&&console.error(`Reroll: ${a}`);b&&DEBUG$$module$js$maze$maze&&console.log(b.show());return!1}
class MazeFinisher$$module$js$maze$maze{constructor(a,b,c,d){this.maze=a;this.loc=b;this.survey=c;this.random=d;this.poi=new DefaultMap$$module$js$util(()=>[]);this.fixedPos=new DefaultMap$$module$js$util(()=>[]);this.posMapping=new Map;this.allEdges=[[],[],[],[]];this.fixedEdges=[[],[],[],[]];this.allStairs=[[],[],[],[]];this.stairDisplacements=new Map;for(var e of a){const [a,c]=e;b=this.maze.getSpec(a);b.fixed&&this.fixedPos.get(c).push(a);for(const c of b.poi){const {priority:b,dy:d,dx:e}=c;this.poi.get(b).push([((a&
240)<<4)+d,((a&15)<<8)+e])}}for(const b of module$js$maze$types.Dir.ALL)for(const c of module$js$maze$types.Dir.allEdge(b,a.height,a.width))(e=a.get(c))&&(e=module$js$maze$types.Scr.edge(e,b))&&7!=e&&(a.getSpec(c).fixed?this.fixedEdges[b].push(c):this.allEdges[b].push(c));for(const b of a){const [d,e]=b;a=c.specSet.stairScreens.get(e);null!=a&&this.allStairs[a[0]].push([d,a[1]])}}shuffleFixed(){for(var a of this.fixedPos.values())this.random.shuffle(a);for(const b of this.survey.fixed){const [c,d]=
b;a=this.fixedPos.get(d.edges).pop();if(null==a)return!1;this.posMapping.set(c,a)}return!0}placeExits(){this.loc.exits=[];for(var a of module$js$maze$types.Dir.ALL)this.random.shuffle(this.allEdges[a]),this.random.shuffle(this.fixedEdges[a]);this.random.shuffle(this.allStairs[module$js$maze$types.Dir.UP]);this.random.shuffle(this.allStairs[module$js$maze$types.Dir.DOWN]);for(var b of this.survey.edges){const [e,f]=b;a=(this.survey.fixed.has(e)?this.fixedEdges:this.allEdges)[f.dir].pop();if(null==
a)return!1;this.posMapping.set(e,a);var c=module$js$maze$types.Scr.edge(this.maze.get(a),f.dir);c=EDGE_TYPES$$module$js$maze$spec[c][f.dir];this.loc.entrances[f.entrance]=Entrance$$module$js$rom$location.of({screen:a,coord:c.entrance});for(var d of c.exits)this.loc.exits.push(Exit$$module$js$rom$location.of({screen:a,tile:d,dest:f.exit>>>8,entrance:f.exit&255}))}for(const e of this.survey.stairs){const [f,g]=e;b=this.allStairs[g.dir].pop();if(null==b)throw Error("missing stair");this.posMapping.set(f,
b[0]);d=this.loc.entrances[g.entrance];a=d.tile&15;c=d.tile>>>4;d.screen=b[0];d.coord=b[1].entrance;this.stairDisplacements.set(f,[(d.tile>>>4)-c,(d.tile&15)-a]);for(const a of b[1].exits)this.loc.exits.push(Exit$$module$js$rom$location.of({screen:b[0],tile:a,dest:g.exit>>>8,entrance:g.exit&255}))}return!0}placeMonster(a,b){const c=this.loc.rom.objects[a.monsterId];c instanceof Monster$$module$js$rom$monster&&(b=b(c),null==b?(console.error(`no valid location for ${hex$$module$js$rom$util(c.id)} in ${hex$$module$js$rom$util(this.loc.id)}`),
a.used=!1):(a.screen=b>>>8,a.tile=b&255))}placeNpcs(){const a=new Map,b=this.loc.monsterPlacer(this.random);for(const e of this.loc.spawns)if(3!==e.type)if(e.isMonster())this.placeMonster(e,b);else{var c=a.get(e.y<<12|e.x);if(null!=c)e.y=c>>>12,e.x=c&4095;else{c=e.screen;var d=this.posMapping.get(c);if(null!=d){if(e.screen=d,c=this.stairDisplacements.get(c),null!=c){const [a,b]=c;e.yt+=a;e.xt+=b}}else if(e.isTrigger())140===e.id?e.screen=this.posMapping.get(33)-16:console.error(`unhandled trigger: ${e.id}`);
else{c=[...this.poi.keys()].sort((a,b)=>a-b);if(!c.length)throw Error("no poi");for(const b of c){c=this.poi.get(b);if(!c.length)continue;d=e.y<<12|e.x;const f=this.random.nextInt(c.length);[[e.y,e.x]]=c.splice(f,1);a.set(d,e.y<<12|e.x);c.length||this.poi.delete(b);break}}}}}}function pop$$module$js$maze$maze(a){for(const b of a)return a.delete(b),b;throw Error("cannot pop from empty set");}
const UNICODE_TILES$$module$js$maze$maze={4112:"\u2500",257:"\u2502",272:"\u250c",4352:"\u2510",17:"\u2514",4097:"\u2518",273:"\u251c",4353:"\u2524",4368:"\u252c",4113:"\u2534",4369:"\u253c",4096:"\u2574",1:"\u2575",16:"\u2576",256:"\u2577"};var module$js$maze$maze={};module$js$maze$maze.Maze=Maze$$module$js$maze$maze;const DEBUG$$module$js$maze$cave=!1,ATTEMPTS$$module$js$maze$cave=100;
class BasicCaveShuffle$$module$js$maze$cave{constructor(a,b){this.loc=a;this.random=b;this.survey=SpecSet$$module$js$maze$spec.CAVE.survey(a)}shuffle(){for(let b=0;b<ATTEMPTS$$module$js$maze$cave;b++){const b=this.w=Math.max(1,Math.min(8,this.pickWidth()));var a=this.h=Math.max(1,Math.min(16,this.pickHeight()));this.allPos=seq$$module$js$rom$util(b*a,(a)=>a%b|Math.floor(a/b)<<4);this.density=this.survey.size/b/a;this.walls=this.survey.walls;this.bridges=this.survey.bridges;this.fixed=new Set;a=new Maze$$module$js$maze$maze(this.random,
this.h,this.w,this.survey.specs);if(this.tryShuffle(a))return}throw Error(`Could not shuffle ${hex$$module$js$rom$util(this.loc.id)} ${this.loc.name}`);}check(a){a=a.traverse();return 2<a.size&&a.values().next().value.size===a.size}pickWidth(){return this.loc.width+Math.floor(this.random.nextInt(5)/3)}pickHeight(){return this.loc.height+Math.floor(this.random.nextInt(5)/3)}tryShuffle(a){DEBUG$$module$js$maze$cave&&console.log(`Shuffle ${this.loc.name}`);if(!this.initializeFixedScreens(a))return!1;
DEBUG$$module$js$maze$cave&&console.log(`Initialized\n${a.show()}`);if(!this.initialFillMaze(a))return!1;DEBUG$$module$js$maze$cave&&console.log(`Initial fill\n${a.show()}`);if(!this.refineMaze(a))return!1;DEBUG$$module$js$maze$cave&&console.log(`Refined\n${a.show()}`);if(!this.addFeatures(a))return!1;DEBUG$$module$js$maze$cave&&console.log(`Features\n${a.show()}`);return this.finish(a)}initializeFixedScreens(a){for(var b of this.survey.edges){const [e,g]=b;for(var c of this.random.ishuffle(this.edges(g.dir)))if(!this.fixed.has(c)){this.fixed.add(c);
var d=this.survey.fixed.get(e);if(null==d)a.setBorder(c,g.dir,6);else{if(1===this.h)return!1;a.setBorder(c,g.dir,d.edges>>>module$js$maze$types.Dir.shift(g.dir)&15);fixBorders$$module$js$maze$cave(a,c,d.edges);a.set(c,d.edges);d.wall&&this.walls--}break}}for(var e of this.survey.fixed){const [b,c]=e;if(!this.survey.edges.has(b))for(const b of this.random.ishuffle(this.allPos))if(!this.fixed.has(b)&&a.saveExcursion(()=>{fixBorders$$module$js$maze$cave(a,b,c.edges);return a.trySet(b,c.edges)})){this.fixed.add(b);
c.wall&&this.walls--;break}}b=[...this.survey.stairs.values()];c=0;for(d=0;10>c&&d<b.length;c++)e=a.randomPos(),!this.fixed.has(e)&&a.fill(e,{stair:b[d].dir})&&(this.fixed.add(e),c=0,d++);return 10<=c?fail$$module$js$maze$cave("could not add all stairs"):!0}initialFillMaze(a,b){b=void 0===b?{}:b;b=Object.assign({},{edge:1,fuzzy:1,shuffleOrder:!0,skipAlternates:!0},b);return a.fillAll(b)?!0:fail$$module$js$maze$cave("could not fill open",a)}refineMaze(a,b){b=void 0===b?{}:b;if(!this.check(a))return fail$$module$js$maze$cave("check failed after initial setup",
a);const c=Object.assign({},{skipAlternates:!0},b.fill||{});for(const b of this.random.shuffle([...a])){const [d]=b;if(a.density()<=this.density)break;a.isFixed(d)||this.fixed.has(d)||!a.saveExcursion(()=>a.setAndUpdate(d,0,c)&&this.check(a))||this.postRefine(a,d)}return this.removeTightCycles(a)}postRefine(a,b){}removeTightCycles(a){for(let b=1;b<this.h;b++)for(let c=1;c<this.w;c++){const d=b<<4|c;if(!isTightCycle$$module$js$maze$cave(a,d))continue;let e=!1;for(const b of this.random.ishuffle(module$js$maze$types.Dir.ALL)){const c=
2>b?d-1:d-16;a.saveExcursion(()=>a.replaceEdge(c,b,0)&&this.check(a))&&(e=!0)}if(!e)return fail$$module$js$maze$cave("failed to remove tight cycle")}return!0}addFeatures(a){const b=new Set,c=[...a.alternates()];for(const f of[140])if(this.survey.tiles.count(f)){var d=this.random.shuffle(c.filter((a)=>a[3].tile===f));if(d.length<this.survey.tiles.count(f))return fail$$module$js$maze$cave("could not add stair hallway");for(var e=this.survey.tiles.count(f)-1;0<=e;e--)a.replace(d[e][0],d[e][2]),b.add(d[e][0])}for(const f of["wall",
"bridge"]){d=this.random.shuffle(c.filter((a)=>a[3].wall&&a[3].wall.type===f));e="wall"===f?this.walls:this.bridges;for(let c=0;c<e;c++){const e=d.pop();if(null==e)return fail$$module$js$maze$cave(`could not add ${f} ${c}`);b.has(e[0])?c--:(a.replace(e[0],e[2]),b.add(e[0]))}}return!0}finish(a){DEBUG$$module$js$maze$cave&&console.log(`finish:\n${a.show()}`);return a.finish(this.survey,this.loc)}edges(a){const b=a===module$js$maze$types.Dir.RIGHT?this.w-1:a===module$js$maze$types.Dir.DOWN?this.h-1:
0;return a&1?seq$$module$js$rom$util(this.h,(a)=>a<<4|b):seq$$module$js$rom$util(this.w,(a)=>b<<4|a)}randomEdge(a){const b=this.random.nextInt(a&1?this.h:this.w),c=a===module$js$maze$types.Dir.RIGHT?this.w-1:a===module$js$maze$types.Dir.DOWN?this.h-1:0;return a&1?b<<4|c:c<<4|b}retry(a,b,c){for(let d=0;d<c;d++)if(a.saveExcursion(b))return!0;return!1}}
class WideCaveShuffle$$module$js$maze$cave extends BasicCaveShuffle$$module$js$maze$cave{initialFillMaze(a){const b=[...this.fixed];if(!a.connect(b[0],null,b[1],null))return!1;for(let c=2;c<b.length;c++)if(!a.connect(b[c]))return!1;a.fillAll({edge:0});return!0}refineMaze(){return!0}addFeatures(){return!0}}
class WaterfallRiverCaveShuffle$$module$js$maze$cave extends BasicCaveShuffle$$module$js$maze$cave{initializeFixedScreens(a){const b=(b,c)=>{this.fixed.add(b);a.set(b,c)},c=1+this.random.nextInt(this.w-2);var d=this.random.nextInt(c),e=this.w-1-this.random.nextInt(this.w-c-1);const f=this.h-1<<4;b(f+d,131073);b(f+e,131073);b(f+c,3);b(c,768);d=[];for(e=1;e<this.h-1;e+=2)d.push(4867),d.push(787);this.random.shuffle(d);for(e=1;e<this.h-1;e++)b((e<<4)+c,d.pop());return!0}check(a){a=a.traverse();const b=
[...new Set(a.values())].map((a)=>a.size);return 2===b.length&&b[0]+b[1]===a.size&&2<b[0]&&2<b[1]}}class CycleCaveShuffle$$module$js$maze$cave extends BasicCaveShuffle$$module$js$maze$cave{check(a){const b=[...a].filter((b)=>{b=[...a.traverse({without:[b[0]]})];return b.length&&b[0][1].size===b.length});if(!b.length)return!1;for(let c=0;c<b.length;c++)for(let d=0;d<c;d++){const e=[...a.traverse({without:[b[c][0],b[d][0]]})];if(e.length&&e[0][1].size!==e.length)return!0}return!1}}
class TightCycleCaveShuffle$$module$js$maze$cave extends CycleCaveShuffle$$module$js$maze$cave{removeTightCycles(){return!0}}
class RiverCaveShuffle$$module$js$maze$cave extends BasicCaveShuffle$$module$js$maze$cave{constructor(){super(...arguments);this.addBridge=new Map([[12336,77872],[771,66307],[3,65539],[768,66304]]);this.removeBridge=new Map([[77872,[0,8]],[66307,[0,2,2,2,4,4,4,8]],[65539,[0]],[66304,[0]]]);this.stairScreens=new Map([[module$js$maze$types.Dir.DOWN,[135168,131088,131073]],[module$js$maze$types.Dir.UP,[135184,69632,65552,131328]]]);this.riverPathAlternatives=new Map([[771,[1]],[12336,[1]]]);this.initialRiverAllowed=
[66307,77872,51,816,13056,12291];this.riverLoopAllowed=[66307,77872,66307,77872,525059,536624,51,816,13056,12291,12339,13104,13107]}tryShuffle(a){this.landPartitions=[];this.river=new Set;if(!this.retry(a,()=>this.makeInitialRiver(a),5))return!1;DEBUG$$module$js$maze$cave&&console.log(`Initial river:\n${a.show()}`);if(!this.retry(a,()=>this.branchRiver(a),5))return!1;DEBUG$$module$js$maze$cave&&console.log(`Branched river:\n${a.show()}`);if(!this.retry(a,()=>this.connectLand(a),3))return!1;DEBUG$$module$js$maze$cave&&
console.log(`Connected land:\n${a.show()}`);if(!this.retry(a,()=>this.removeBridges(a),5))return!1;DEBUG$$module$js$maze$cave&&console.log(`Removed bridges:\n${a.show(!0)}`);if(!this.retry(a,()=>this.addStairs(a),3))return!1;DEBUG$$module$js$maze$cave&&console.log(`Added stairs:\n${a.show()}`);for(const a of this.river)this.fixed.add(a);if(!this.refineMaze(a))return!1;for(const a of this.river)this.fixed.delete(a);this.bridges=0;if(!this.addFeatures(a))return!1;DEBUG$$module$js$maze$cave&&console.log(`Features\n${a.show()}\n${a.show(!0)}`);
a.fillAll({edge:0});return this.finish(a)}makeInitialRiver(a){var b=this.random.nextInt(this.h-2)+1;const c=b<this.h/2?66304:65539;var d=this.random.nextInt(this.h-2)+1;const e=d<this.h/2?66304:65539;b<<=4;d=d<<4|this.w-1;a.set(b,c);a.set(d,e);return a.connect(b,null,d,null,{allowed:this.initialRiverAllowed,pathAlternatives:this.riverPathAlternatives})?!0:!1}branchRiver(a){const b=this.survey.rivers/this.w/this.h;for(let c=0;10>c&&a.density()<b;c++)a.addLoop({allowed:this.riverLoopAllowed,pathAlternatives:this.riverPathAlternatives})&&
(c=0);for(const b of this.allPos)a.get(b)&&this.river.add(b);return!0}connectLand(a){if(!this.initialFillMaze(a))return!1;var b=a.traverse();b=[...new Set(b.values())];a:for(const d of b){b=new Set;for(const a of d){var c=a>>8;if(this.river.has(c))continue a;b.add(c);a&15?a&240||b.add(c-16):b.add(c-1)}this.landPartitions.push(b);c=!1;for(const d of this.random.ishuffle([...b]))for(const b of module$js$maze$types.Dir.ALL){const e=module$js$maze$types.Pos.plus(d,b);if((a.get(e)&65535)===(b&1?771:12336)){c=
1<<(b<<2);a.setAndUpdate(d,a.get(d)|c,{replace:!0});c=!0;if(this.random.nextInt(2))break;continue a}}if(c)continue a;if(2<b.size)return!1;for(const c of b)a.delete(c),this.landPartitions.pop()}return this.check(a)}removeBridges(a){for(const b of this.random.ishuffle([...this.river])){const c=a.get(b);if(null==c)throw Error(`expected a screen at ${hex$$module$js$rom$util(b)}`);for(const d of this.random.ishuffle(this.removeBridge.get(c)||[]))if(a.saveExcursion(()=>{a.replace(b,c&65535|d<<16);return this.check(a)}))break}return module$js$util.iters.count(module$js$util.iters.filter(this.river,
(b)=>(b=a.getSpec(b).wall)?"bridge"===b.type:!1))<=this.survey.bridges}addStairs(a){if(this.survey.edges.size)throw Error(`Unexpected edge: ${this.survey.edges}`);a:for(const b of this.survey.fixed.values()){for(const c of this.random.ishuffle(this.allPos))if(!this.fixed.has(c)&&!this.river.has(c)&&a.saveExcursion(()=>a.setAndUpdate(c,b.edges,{replace:!0,skipAlternates:!0})&&this.check(a))){this.fixed.add(c);continue a}return fail$$module$js$maze$cave(`Could not place fixed screen ${hex$$module$js$rom$util(b.edges)}`)}const b=
new Map;for(var c of this.landPartitions)for(var d of c)b.set(d,c);c=[...this.survey.stairs];d=new Set;for(const e of this.random.ishuffle([...b.keys()])){if(!c.length)break;const f=b.get(e);if(!d.has(f)&&!this.fixed.has(e))for(const b of this.stairScreens.get(c[0][1].dir))if(a.saveExcursion(()=>a.setAndUpdate(e,b,{replace:!0,skipAlternates:!0})&&this.check(a))){c.shift();this.fixed.add(e);d.add(f);break}}return c.length?!1:!0}}
class EvilSpiritRiverCaveShuffle_old$$module$js$maze$cave extends BasicCaveShuffle$$module$js$maze$cave{constructor(){super(...arguments);this.goodScrs=new Set([3,48,768,12288,51,771,12291,816,12336,13056,12339,13104,13107]);this.badScrs=new Set([13059,771])}initializeFixedScreens(a){this.density=this.survey.rivers/this.w/this.h;this.phase="river";this.fixedRiver=new Set;if(!this.initializeRiver(a)||!this.refineMaze(a))return!1;for(var b of this.allPos){var c=a.get(b);if(c){var d=13059===c?module$js$maze$types.Dir.LEFT:
819===c?module$js$maze$types.Dir.RIGHT:null;if(null!=d){d=module$js$maze$types.Pos.plus(b,d);if(a.get(d))return!1;a.replace(d,c^13107)}}}for(const b of this.allPos)a.get(b)?this.fixed.add(b):a.delete(b);for(const d of this.allPos){b=a.get(d);if(!b)continue;if(b!==((b<<8|b>>8)&65535))continue;c=(b<<4|b>>4)&this.random.pick([4352,17]);const e=b|c;a.saveExcursion(()=>a.setAndUpdate(d,e))}if(!super.initializeFixedScreens(a))return!1;this.density=this.survey.size/this.w/this.h;this.phase="cave";return!0}postRefine(a,
b){if("river"===this.phase)for(const c of module$js$maze$types.Dir.ALL){const d=a.get(b,c);null!=d&&this.badScrs.has(d)&&a.saveExcursion(()=>a.tryConsolidate(module$js$maze$types.Pos.plus(b,c),this.goodScrs,this.badScrs,()=>this.check(a)))}}initializeRiver(a){for(let b=0;b<this.h;b++)for(let c=0;c<this.w;c++){let d=13107;const e=b<<4|c;0===b&&(d&=65520);b===this.h-1&&(d&=61695);0===c&&(d&=4095);c===this.w-1&&(d&=65295);a.set(e,d)}for(const b of[0,this.w-1])for(const c of this.random.ishuffle(seq$$module$js$rom$util(this.h-
3,(a)=>a+2)))if(a=c<<4|b,this.fixed.add(a),this.fixedRiver.add(a),this.random.nextInt(2))break;return!0}check(a){if("cave"===this.phase)return super.check(a);if([...this.fixedRiver].some((b)=>!a.get(b)))return!1;const b=a.traverse({flight:!0}),c=[...new Set(b.values())].map((a)=>a.size);return 1===c.length&&c[0]===b.size}}function fail$$module$js$maze$cave(a,b){console.error(`Reroll: ${a}`);b&&DEBUG$$module$js$maze$cave&&console.log(b.show());return!1}
function isTightCycle$$module$js$maze$cave(a,b){const c=a.get(b-17)||0;a=a.get(b)||0;return!!(c&3840&&c&240&&a&61440&&a&15)}function fixBorders$$module$js$maze$cave(a,b,c){try{for(const d of module$js$maze$types.Dir.ALL)a.inBounds(module$js$maze$types.Pos.plus(b,d))||7!==(c>>module$js$maze$types.Dir.shift(d)&7)||a.setBorder(b,d,7)}catch(d){}}
const STRATEGIES$$module$js$maze$cave=new Map([[39,CycleCaveShuffle$$module$js$maze$cave],[75,TightCycleCaveShuffle$$module$js$maze$cave],[84,CycleCaveShuffle$$module$js$maze$cave],[86,WideCaveShuffle$$module$js$maze$cave],[87,WaterfallRiverCaveShuffle$$module$js$maze$cave],[105,RiverCaveShuffle$$module$js$maze$cave],[132,WideCaveShuffle$$module$js$maze$cave],[171,RiverCaveShuffle$$module$js$maze$cave]]);
function shuffleCave$$module$js$maze$cave(a,b){(new (STRATEGIES$$module$js$maze$cave.get(a.id)||BasicCaveShuffle$$module$js$maze$cave)(a,b)).shuffle()}var module$js$maze$cave={};module$js$maze$cave.shuffleCave=shuffleCave$$module$js$maze$cave;function shuffleGoa1$$module$js$maze$goa(a,b,c=1500){extendGoaScreens$$module$js$maze$goa(a);const d=a.locations.goaFortressKelbesque;var e=d.width;const f=d.height;a:for(let l=0;l<c;l++){var g=function(a,b=65536){const c=l.get(a);if(null==c)throw Error(`Cannot flag empty screen ${hex$$module$js$rom$util(a)}`);l.replace(a,c|b);if(h())return!0;l.replace(a,c);return!1},h=function(){const a=l.traverse(),b=a.get(q);return!b||!r.filter((a)=>b.has(a)).length||b.size<.8*a.size?!1:!0},k=function(a,b){l.set(a,
b,{force:!0})};const l=new Maze$$module$js$maze$maze(b,f,e,GOA1_SCREENS$$module$js$maze$spec),n=f-1<<4|b.nextInt(e),p=b.nextInt(e),q=n<<8|2,r=[p+32<<8|1,p+32<<8|3];k(n,61681);k(n-1,240);k(n+1,61440);k(p,65520);k(p-1,4080);k(p+1,65280);k(p+16,61951);k(p+15,255);k(p+17,61455);if(!l.connect(n,module$js$maze$types.Dir.UP,p+16,module$js$maze$types.Dir.DOWN))continue a;if(257===l.get(p+32)||257===l.get(n-16))continue a;for(k=0;10>k&&.65>l.density();k++)l.addLoop()&&(k=0);if(.45>l.density())continue a;if(!h())continue a;
for(const [a,c]of l)if(257===c&&257===l.get(a+16)&&(k=b.shuffle([0,16]),!g(a+k[0],131072)&&!g(a+k[1],131072)))continue a;for(const [a,c]of b.shuffle([...l.alternates()]))g(a,c);l.fillAll({edge:0});d.moveScreen(6,p);d.moveScreen(131,n);l.write(d,new Set);b=d.monsterPlacer(b);for(const f of d.spawns)f.isMonster()&&(c=a.objects[f.monsterId],c instanceof Monster$$module$js$rom$monster&&(e=b(c),null==e?(console.error(`no valid location for ${hex$$module$js$rom$util(c.id)} in ${hex$$module$js$rom$util(d.id)}`),
f.used=!1):(f.screen=e>>>8,f.tile=e&255)));a.spoiler&&a.spoiler.addMaze(d.id,d.name,l.show());return}throw Error(`unable to shuffle goa1 after ${c} attempts`);}
function extendGoaScreens$$module$js$maze$goa(a){for(var b of[140,164,168]){const c=a.tileset(b);c.alternates[25]=25;c.alternates[27]=27}a.swapMetatiles([164,140],[43,[25,197],-199],[186,[27,197],-197]);a.swapMetatiles([168],[[23,84],-26],[[24,88],-28]);a.swapMetatiles([136],[25,-198],[27,-198]);b=[[25,25],[27,27]];write2d$$module$js$maze$spec(a.screens[224].tiles,97,b);write2d$$module$js$maze$spec(a.screens[225].tiles,109,b);write2d$$module$js$maze$spec(a.screens[226].tiles,145,b);write2d$$module$js$maze$spec(a.screens[227].tiles,
157,b);write2d$$module$js$maze$spec(a.screens[228].tiles,65,b);write2d$$module$js$maze$spec(a.screens[228].tiles,141,b);write2d$$module$js$maze$spec(a.screens[229].tiles,97,b);write2d$$module$js$maze$spec(a.screens[229].tiles,173,b);write2d$$module$js$maze$spec(a.screens[230].tiles,13,b);write2d$$module$js$maze$spec(a.screens[230].tiles,209,b);write2d$$module$js$maze$spec(a.screens[231].tiles,1,b);write2d$$module$js$maze$spec(a.screens[231].tiles,13,b);write2d$$module$js$maze$spec(a.screens[232].tiles,
209,b);write2d$$module$js$maze$spec(a.screens[232].tiles,221,b);a.locations[169].flags.push(Flag$$module$js$rom$location.of({screen:16,flag:751}),Flag$$module$js$rom$location.of({screen:32,flag:751}),Flag$$module$js$rom$location.of({screen:33,flag:751}),Flag$$module$js$rom$location.of({screen:36,flag:751}),Flag$$module$js$rom$location.of({screen:37,flag:751}),Flag$$module$js$rom$location.of({screen:48,flag:751}),Flag$$module$js$rom$location.of({screen:49,flag:751}),Flag$$module$js$rom$location.of({screen:51,
flag:751}),Flag$$module$js$rom$location.of({screen:52,flag:751}),Flag$$module$js$rom$location.of({screen:65,flag:751}),Flag$$module$js$rom$location.of({screen:84,flag:751}),Flag$$module$js$rom$location.of({screen:98,flag:751}),Flag$$module$js$rom$location.of({screen:100,flag:751}),Flag$$module$js$rom$location.of({screen:114,flag:751}),Flag$$module$js$rom$location.of({screen:116,flag:512}));a.locations.waterfallCave3.tileset=136}var module$js$maze$goa={};module$js$maze$goa.shuffleGoa1=shuffleGoa1$$module$js$maze$goa;
module$js$maze$goa.extendGoaScreens=extendGoaScreens$$module$js$maze$goa;function shufflePyramid$$module$js$maze$pyramid(a,b){function c(a,b,c){d.exits[2*a].dest=d.exits[2*a+1].dest=b;d.exits[2*a].entrance=d.exits[2*a+1].entrance=c}const d=a.locations.pyramidMain,e="dudududuudududduu".split("");let f="u";.5>b.next()&&(d.screens[0][3]=132,d.screens[0][2]=153,e[16]=f="d",d.entrances[12].screen=d.entrances[16].screen,d.entrances[12].coord=d.entrances[16].coord,d.exits[24].screen=d.exits[32].screen,d.exits[24].tile=d.exits[32].tile,d.exits[25].screen=d.exits[33].screen,d.exits[25].tile=
d.exits[33].tile,d.entrances[16].screen=2,d.entrances[16].coord=45008,d.exits[32].screen=d.exits[33].screen=2,d.exits[32].tile=188,d.exits[33].tile=189,a=a.locations.pyramidDraygon,a.width=2,a.screens[0].push(154),a.screens[1].push(253),a.screens[2]=[224,225],a.exits[0].screen=a.exits[1].screen=1,a.exits[0].tile=199,a.exits[1].tile=200,a.entrances[0].screen=1,a.entrances[0].coord=53376);a={u:[],d:[]};for(var g=0;g<e.length;g++)a[e[g]].push(g);b.shuffle(a.u);b.shuffle(a.d);var h=a[f].pop();g=[];g[16]=
d.entrances[h];c(h,159,0);var k=a.u.pop();g[1]=d.entrances[k];c(k,157,2);var l=a.d.pop();"u"===f&&14===l&&12===k?[l]=a.d.splice(0,1,l):"d"===f&&(14===l&&16===h||16===l&&14===h)&&([l]=a.d.splice(0,1,l));g[0]=d.entrances[l];c(l,157,1);do{h={u:[...a.u],d:[...a.d]};k={u:[...a.u],d:[...a.d]};b.shuffle(k.u);b.shuffle(k.d);l={u:"d",d:"u"};for(let a=2;16>a;a++){const b=h[e[a]].pop(),f=k[l[e[a]]].pop();if(null==b||null==f)throw Error("impossible");g[a]=d.entrances[b];c(f,158,a)}h=d.exits[24];k=d.exits[28];
if("u"!==f||h.dest!==k.dest||d.entrances[14]!==g[h.entrance]||d.entrances[12]!==g[k.entrance])break}while(1);d.entrances=g}var module$js$maze$pyramid={};module$js$maze$pyramid.shufflePyramid=shufflePyramid$$module$js$maze$pyramid;function shuffleSwamp$$module$js$maze$swamp(a,b,c=100){extendSwampScreens$$module$js$maze$swamp(a);const d=a.locations.swamp,e=d.width,f=d.height,g=[SCR_U$$module$js$maze$swamp,SCR_D$$module$js$maze$swamp,SCR_UD$$module$js$maze$swamp,SCR_DR$$module$js$maze$swamp,SCR_URD$$module$js$maze$swamp,SCR_LR$$module$js$maze$swamp],h=[117,118,119,120,121,122,123,125,126];for(let k=0;k<c;k){const c=new Maze$$module$js$maze$maze(b,f,e,SWAMP_SCREENS$$module$js$maze$spec,g);if(tryShuffleSwamp$$module$js$maze$swamp(a,
b,d,c,h))return}console.error(`Failed to shuhffle swamp after ${c} attempts.`)}
function tryShuffleSwamp$$module$js$maze$swamp(a,b,c,d,e){function f(){const a=d.traverse(),b=a.get(m);return b&&b.size===a.size||!1}const g=d.width,h=d.height,[k,l]=(()=>{let a,c;do a=b.nextInt(g),c=b.nextInt(h);while(2>a||2>c);return[a,c<<4]})();d.setBorder(l,module$js$maze$types.Dir.LEFT,1);d.set(k,61936,{force:!0});d.set(k-1,240,{force:!0});d.set(k+1,61440,{force:!0});d.fillAll({edge:1});const m=l<<8|16;var n=[...d].map((a)=>a[0]);for(var p=Math.floor(.6*g*h);p;p--){const a=b.pick(n),c=b.pick(module$js$maze$types.Dir.ALL),
e=module$js$maze$types.Pos.plus(a,c);!d.isFixed(a)&&!d.isFixed(e)&&d.get(a)&module$js$maze$types.Dir.edgeMask(c)?d.saveExcursion(()=>d.replaceEdge(a,c,0)?!!(d.get(a)&&d.get(e)&&f()):!1):p++}if(!d.consolidate(e,f,a))return!1;const [q,r]=b.pick([...d.alternates()]);if(65536!=r)throw Error(`unexpected alt: ${hex$$module$js$rom$util(r)}`);d.replace(q,d.get(q)|r);c.moveScreen(48,l);c.moveScreen(4,k);d.write(c,new Set);e=[];n=[];for(const [a,b]of d)a!==k&&a!==q&&(1!==b&&16!==b&&256!==b&&4096!==b||e.push(a),
17!==b&&272!==b&&4352!==b&&4097!==b||n.push(a));var v=a.screens[c.screens[q>>4][q&15]].tiles;p=0;for(let a=0;240>a;a++)if(3===v[a]){p=a;break}c.entrances[1].screen=q;c.entrances[1].tile=p+17;for(v=0;2>v;v++)c.exits[5+v].screen=q,c.exits[5+v].tile=p+v;e=b.pick(e.length?e:n);c.spawns[1].screen=e;e=c.monsterPlacer(b);for(const b of c.spawns)b.isMonster()&&(n=a.objects[b.monsterId],n instanceof Monster$$module$js$rom$monster&&(p=e(n),null==p?(console.error(`no valid location for ${hex$$module$js$rom$util(n.id)} in ${hex$$module$js$rom$util(c.id)}`),
b.used=!1):(b.screen=p>>>8,b.tile=p&255)));a.spoiler&&a.spoiler.addMaze(c.id,c.name,d.show());return!0}
const SCR_U$$module$js$maze$swamp=readScreen$$module$js$maze$spec("c8 c8 c8 c8 cf f6 c7 ad c4 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 b8 b9 c3 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 b7 b8 ad ad d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 c2 c3 b7 b8 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 b6 c2 b7 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 ad ad b9 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 ad ad ad ad d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 b9 b8 ad ad d2 e2 c8 c8 c8 c8\n     c8 c8 c8 c8 e3 f6 c3 c3 b8 b6 d2 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 e3 fd ad ad fc e2 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 ff fb fb fa c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8"),SCR_D$$module$js$maze$swamp=
readScreen$$module$js$maze$spec("c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 cd c9 c9 ca c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 cd eb a0 a0 cb ca c8 c8 c8 c8 c8\n     c8 c8 c8 c8 cf a0 f9 f5 f7 f8 cb cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf a0 ed 08 09 a0 a0 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf db ee 0c 0b ef a0 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d0 d1 03 03 d8 db cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 c7 ad ad ae d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 ad b9 b7 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 c2 c3 c3 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 c5 c3 c3 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 b6 c2 c3 c3 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 b8 b6 b6 b6 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 b7 b7 b7 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 b7 b7 b8 b6 d2 cc c8 c8 c8 c8"),
SCR_UD$$module$js$maze$swamp=readScreen$$module$js$maze$spec("c8 c8 c8 c8 cf d3 b6 b6 c6 b6 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 b6 c3 c7 b6 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f5 c3 c7 b6 b6 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 b6 b6 c6 c5 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d9 b6 c6 c3 c7 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f5 c3 c3 c3 c3 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d9 ad c2 c3 c3 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d9 c4 c5 c3 c3 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f5 b7 b7 b8 b6 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d9 c2 b8 b6 b6 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d9 b6 c2 b7 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d9 b6 b6 b6 b6 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 b7 b7 b8 b6 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 b9 b7 b7 b7 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 b7 b7 c7 b6 d2 cc c8 c8 c8 c8"),
SCR_DR$$module$js$maze$swamp=readScreen$$module$js$maze$spec("c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 cd c9 c9 c9 c9 c9 c9 c9 c9 c9\n     c8 c8 c8 c8 c8 cd a0 a0 a0 e8 04 a0 e8 a0 a0 e4\n     c8 c8 c8 c8 cf f8 a0 f0 f1 f5 f5 f7 e9 f4 f7 e5\n     c8 c8 c8 c8 cf f6 f7 f8 f2 ea 06 aa e9 f0 f1 e6\n     c8 c8 c8 c8 cf a0 dd e0 f3 e0 07 0c ea db f3 e7\n     c8 c8 c8 c8 cf db d5 d0 d1 d1 03 03 d0 d1 da da\n     c8 c8 c8 c8 cf d5 af c4 c4 ad ad ad ad ad c4 ad\n     c8 c8 c8 c8 cf d3 b9 c3 c3 b8 ad ad ad c2 b7 b8\n     c8 c8 c8 c8 cf f6 c3 c3 c3 c3 b8 ad ad ad ad ad\n     c8 c8 c8 c8 cf f6 c7 ad c2 c3 c7 fc fb fb fb fb\n     c8 c8 c8 c8 cf d3 ad ad ad ad d6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 b9 b8 ad b9 f6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf f6 c7 ad b9 c7 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 b6 b9 c3 b8 d2 cc c8 c8 c8 c8"),
SCR_URD$$module$js$maze$swamp=readScreen$$module$js$maze$spec("c8 c8 c8 c8 cf d3 c4 c3 c3 c3 f7 f8 ca c8 c8 c8\n     c8 c8 c8 c8 cf f5 c3 c3 c3 c3 f7 f7 a0 ca c9 c9\n     c8 c8 c8 c8 cf f6 c3 c3 b8 b6 d2 cf cf e8 e4 a0\n     c8 c8 c8 c8 cf f5 b7 c3 b7 b8 d2 f0 f1 e9 e5 cf\n     c8 c8 c8 c8 cf d3 c2 b8 c2 b8 d8 db cf ea e6 cf\n     c8 c8 c8 c8 cf d3 ad ad ad ad ae d4 f3 dd e7 cf\n     c8 c8 c8 c8 cf d3 ad ad ad ad ad ae d0 d1 d0 d1\n     c8 c8 c8 c8 cf d3 c2 c3 c3 b7 b8 ad ad ad ad ad\n     c8 c8 c8 c8 cf d3 ad ad c2 b7 b7 b7 b8 c4 ad ad\n     c8 c8 c8 c8 cf d3 ad ad b6 b9 b7 b7 b7 b7 b8 ad\n     c8 c8 c8 c8 cf d3 ad c4 c3 b7 b8 fc fb fb fb fb\n     c8 c8 c8 c8 cf d3 b6 ad ad ad d6 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 ad ad ad ad d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 c4 c3 b7 b8 d2 cc c8 c8 c8 c8\n     c8 c8 c8 c8 cf d3 b6 b9 b7 b7 f6 cc c8 c8 c8 c8"),
SCR_LR$$module$js$maze$swamp=readScreen$$module$js$maze$spec("c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8\n     c9 c9 c9 c9 c9 c9 c9 c9 c9 c9 c9 c9 c9 c9 c9 c9\n     a0 e4 e8 eb e4 a0 a0 a0 eb eb e8 f0 f1 a0 e4 a0\n     a0 e5 e9 f9 f5 f6 f6 f7 ec f9 f7 f8 f2 a0 e5 a0\n     a0 e6 f0 f1 e6 e0 08 09 ed de ea de f2 a0 e6 a0\n     db e7 db f3 e7 e1 0c 0b dd df e0 df f3 db e7 e0\n     d0 d1 da da d0 d1 03 03 d0 d1 d0 d1 da da da da\n     ad c4 ad ad ad ad ad ad ad ad ad ad ad ad ad ad\n     c2 c5 b8 c6 c4 c4 b9 c7 c4 c5 c5 c7 ad ad ad ad\n     ad ad ad ad c2 c3 c3 c3 c3 c3 c7 ad ad ad ad ad\n     fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb\n     c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8\n     c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8 c8");
function extendSwampScreens$$module$js$maze$swamp(a){a.swapMetatiles([160],[[3,172],-219],[[4,170],-229],[[5,170],-230],[[6,170],-231],[[7,170],-232],[[8,170],-241],[[9,170],-242],[[10,170],-243],[[11,170],-244],[[12,170],-221],[[13,170],-222]);write2d$$module$js$maze$spec(a.screens[127].tiles,0,[[168,204],[168,204],[168,204],[168,204],[168,204],[168,204],[168,204],[168,204],[168,204],[210,204],[210,204],[210,204],[210,226],[226,200]]);write2d$$module$js$maze$spec(a.screens[118].tiles,76,[[8,9],[12,
11],[3,3]]);write2d$$module$js$maze$spec(a.screens[122].tiles,37,[[,,4],[8,9,5],[,10,6],[,11,7],[,3,3]]);write2d$$module$js$maze$spec(a.screens[123].tiles,36,[[4],[],[6],[7,13],[3,3]]);write2d$$module$js$maze$spec(a.screens[126].tiles,71,[[8,9],[12,11],[3,3]])}var module$js$maze$swamp={};module$js$maze$swamp.shuffleSwamp=shuffleSwamp$$module$js$maze$swamp;module$js$maze$swamp.extendSwampScreens=extendSwampScreens$$module$js$maze$swamp;function compressMapData$$module$js$pass$compressmapdata(a){if(!a.compressedMapData){a.compressedMapData=!0;for(const b of a.locations)b.extended&&(b.extended=7);a.screens[1792]=a.screens[256];a.screens[1793]=a.screens[257];a.screens[1794]=a.screens[258];delete a.screens[256];delete a.screens[257];delete a.screens[258]}}var module$js$pass$compressmapdata={};module$js$pass$compressmapdata.compressMapData=compressMapData$$module$js$pass$compressmapdata;const MessageId$$module$js$rom$messageid=DataTuple$$module$js$rom$util.make(2,{action:DataTuple$$module$js$rom$util.prop([0,248,3]),part:DataTuple$$module$js$rom$util.prop([0,7,-3],[1,224,5]),index:DataTuple$$module$js$rom$util.prop([1,31]),toString(){const a=this.action?` (action ${hex$$module$js$rom$util(this.action)})`:"";return`MessageId ${this.hex()}: (${hex$$module$js$rom$util(this.part)}:${hex$$module$js$rom$util(this.index)}${a}`},mid(){return`${hex$$module$js$rom$util(this.part)}:${hex$$module$js$rom$util(this.index)}`},
nonzero(){return!(!this.part&&!this.index)}});var module$js$rom$messageid={};module$js$rom$messageid.MessageId=MessageId$$module$js$rom$messageid;class Npc$$module$js$rom$npc extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.spawnConditions=new Map;this.localDialogs=new Map;this.used=!UNUSED_NPCS$$module$js$rom$npc.has(b)&&(143>b||192<=b);var c=195>=b;this.dataBase=33008|(b&252)<<6|(b&3)<<2;this.data=tuple$$module$js$rom$util(a.prg,this.dataBase,4);this.spawnPointer=116192+(b<<1);for(var d=this.spawnBase=readLittleEndian$$module$js$rom$util(a.prg,this.spawnPointer)+81920,e;this.used&&255!==(e=a.prg[d++]);){const b=SPAWN_CONDITION_FLAGS$$module$js$rom$util.read(a.prg,
d);d+=2*b.length;this.spawnConditions.set(e,b)}this.dialogPointer=117085+(b<<1);this.dialogBase=c?addr$$module$js$rom$util(a.prg,this.dialogPointer,81920):0;this.globalDialogs=[];if(c){for(c=this.dialogBase;;){const [b,d]=GlobalDialog$$module$js$rom$npc.parse(a.prg,c);c+=4;b.condition&&this.globalDialogs.push(b);if(d)break}for(d=[];;){e=a.prg[c++];if(255===e)break;d.push([e,a.prg[c++]])}d.length||d.push([-1,0]);e=c;for(const b of d){const [f,h]=b;d=[];this.localDialogs.set(f,d);for(c=e+h;;){const [b,
e]=LocalDialog$$module$js$rom$npc.parse(a.prg,c);c+=b.byteLength();d.push(b);if(e)break}}}for(const c in NAMES$$module$js$rom$npc)NAMES$$module$js$rom$npc.hasOwnProperty(c)&&(a=NAMES$$module$js$rom$npc[c],a[0]===b&&(this.name=a[1],2<a.length&&(this.itemNames=a.slice(2,4))))}spawnConditionsBytes(){const a=[];for(const b of this.spawnConditions){const [c,d]=b;a.push(c,...SPAWN_CONDITION_FLAGS$$module$js$rom$util.bytes(d))}a.push(255);return a}hasDialog(){return!(!this.globalDialogs.length&&!this.localDialogs.size)}*allDialogs(){yield*this.globalDialogs;
for(const a of this.localDialogs.values())yield*a}dialogBytes(){function a(a){const b=[];for(let c=0;c<a.length;c++)b.push(...a[c].bytes(c===a.length-1));return b}if(!this.hasDialog())return[];const b=[];this.globalDialogs.length?b.push(...a(this.globalDialogs)):b.push(128,0,0,0);const c=[],d=new Map;for(const e of this.localDialogs){const [f,g]=e;{const e=a(g),k=e.join(","),l=d.get(k);null!=l?b.push(f,l):(d.set(k,c.length),-1!==f&&b.push(f,c.length),c.push(...e))}}c.length&&b.push(255,...c);return b}link(a){this.spawnConditions=
this.rom.npcs[a].spawnConditions;this.linkDialog(a)}linkDialog(a){a=this.rom.npcs[a];this.globalDialogs=a.globalDialogs;this.localDialogs=a.localDialogs}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(b.used){var c=[];a.rom.subarray(b.dataBase,b.dataBase+4).set(b.data);c.push(a.write(b.spawnConditionsBytes(),114688,122879,`SpawnCondition ${hex$$module$js$rom$util(b.id)}`).then((c)=>writeLittleEndian$$module$js$rom$util(a.rom,b.spawnPointer,c-81920)));b.hasDialog()&&
c.push(a.write(b.dialogBytes(),114688,122879,`Dialog ${hex$$module$js$rom$util(b.id)}`).then((c)=>writeLittleEndian$$module$js$rom$util(a.rom,b.dialogPointer,c-81920)));yield Promise.all(c)}})}}
class GlobalDialog$$module$js$rom$npc{constructor(a,b){this.condition=a;this.message=b}static of(a,b){const [c,d,e=0]=b;return new GlobalDialog$$module$js$rom$npc(a,MessageId$$module$js$rom$messageid.of({part:c,index:d,action:e}))}static parse(a,b){b=void 0===b?0:b;const c=readBigEndian$$module$js$rom$util(a,b);a=MessageId$$module$js$rom$messageid.from(a,b+2);b=c&1023;const d=!!(c&32768);c&8192&&(b=~b);return[new GlobalDialog$$module$js$rom$npc(b,a),d]}bytes(a){let b=this.condition;0>b&&(b=~b|8192);
a&&(b|=32768);return[b>>>8,b&255,...this.message.data]}}
class LocalDialog$$module$js$rom$npc{constructor(a,b,c,d){this.condition=a;this.message=b;this.update=c;this.flags=d}clone(){return LocalDialog$$module$js$rom$npc.parse(this.bytes(!1))[0]}static parse(a,b){b=void 0===b?0:b;const c=readBigEndian$$module$js$rom$util(a,b),d=MessageId$$module$js$rom$messageid.from(a,b+2),e=a[b+4];let f=c&1023;const g=!!(c&32768);c&8192&&(f=~f);a=c&16384?DIALOG_FLAGS$$module$js$rom$util.read(a,b+5):[];return[new LocalDialog$$module$js$rom$npc(f,d,e,a),g]}static of(a,b,
c){c=void 0===c?[]:c;const [d,e,f=0]=b;return new LocalDialog$$module$js$rom$npc(a,MessageId$$module$js$rom$messageid.of({part:d,index:e,action:f}),0,c)}byteLength(){return 5+2*this.flags.length}bytes(a){let b=this.condition;0>b&&(b=~b|8192);a&&(b|=32768);this.flags.length&&(b|=16384);return[b>>>8,b&255,...this.message.data,this.update,...DIALOG_FLAGS$$module$js$rom$util.bytes(this.flags)]}}
const UNUSED_NPCS$$module$js$rom$npc=new Set([49,60,106,115,130,134,135,137,138,139,140,141]),NAMES$$module$js$rom$npc={leafElder:[13,"Leaf elder"],leafRabbit:[19,"Leaf rabbit"],windmillGuard:[20,"Windmill guard","in cave","in house"],windmillGuardSleeping:[21,"Sleeping windmill guard"],akahanaShyron:[22,"Akahana in Shyron"],oakElder:[29,"Oak elder"],oakMother:[30,"Oak mother"],dwarfChild:[31,"Dwarf child"],aryllis:[35,"Aryllis"],portoaQueen:[56,"Portoa queen"],fortuneTeller:[57,"Fortune teller"],
clark:[68,"Clark"],brokahana:[84,"Akahana's friend"],deo:[90,"Deo"],zebu:[94,"Zebu","in cave","in Shyron"],tornel:[95,"Tornel"],stom:[96,"Stom"],mesiaShrine:[97,"Mesia in Shrine"],asina:[98,"Asina","in back room",""],hurtDolphin:[99,"Hurt dolphin"],fisherman:[100,"Fisherman"],kensuCabin:[104,"Kensu in cabin"],kensuSleeping:[107,"Sleeping kensu"],kensuSwan:[116,"Kensu in Swan"],kensuSlime:[117,"Slimed Kensu"],kensuLighthouse:[126,"Kensu in lighthouse"],akahanaBrynmaer:[130,"Akahana in Brynmaer"],azteca:[131,
"Azteca"],fakeMesia:[132,"Fake Mesia"],akahanaStoned:[136,"Stoned Akahana"],mesia:[142,"Mesia"],rage:[195,"Rage"]};var module$js$rom$npc={};module$js$rom$npc.Npc=Npc$$module$js$rom$npc;module$js$rom$npc.GlobalDialog=GlobalDialog$$module$js$rom$npc;module$js$rom$npc.LocalDialog=LocalDialog$$module$js$rom$npc;module$js$rom$npc.NAMES=NAMES$$module$js$rom$npc;function deterministic$$module$js$pass$deterministic(a,b){fixCoinSprites$$module$js$pass$deterministic(a);fixMimics$$module$js$pass$deterministic(a);makeBraceletsProgressive$$module$js$pass$deterministic(a);addTowerExit$$module$js$pass$deterministic(a);closeCaveEntrances$$module$js$pass$deterministic(a,b);reversibleSwanGate$$module$js$pass$deterministic(a);adjustGoaFortressTriggers$$module$js$pass$deterministic(a);preventNpcDespawns$$module$js$pass$deterministic(a,b);b.requireHealedDolphinToRide()&&
requireHealedDolphin$$module$js$pass$deterministic(a);b.saharaRabbitsRequireTelepathy()&&requireTelepathyForDeo$$module$js$pass$deterministic(a);adjustItemNames$$module$js$pass$deterministic(a,b);alarmFluteIsKeyItem$$module$js$pass$deterministic(a);b.teleportOnThunderSword()?teleportOnThunderSword$$module$js$pass$deterministic(a):noTeleportOnThunderSword$$module$js$pass$deterministic(a);undergroundChannelLandBridge$$module$js$pass$deterministic(a);b.connectLimeTreeToLeaf()&&connectLimeTreeToLeaf$$module$js$pass$deterministic(a);
simplifyInvisibleChests$$module$js$pass$deterministic(a);addCordelWestTriggers$$module$js$pass$deterministic(a,b);b.disableRabbitSkip()&&fixRabbitSkip$$module$js$pass$deterministic(a);fixReverseWalls$$module$js$pass$deterministic(a);b.chargeShotsOnly()&&disableStabs$$module$js$pass$deterministic(a);b.orbsOptional()&&orbsOptional$$module$js$pass$deterministic(a)}
function fixCoinSprites$$module$js$pass$deterministic(a){for(const b of[96,100,101,102,103,104,105,106,107,108,109,111])for(const c of[0,1,2])a.patterns[b<<6|c].pixels=a.patterns[6016|c].pixels;a.objects[12].metasprite=169}function fixReverseWalls$$module$js$pass$deterministic(a){for(const b in[4,5,8,9])a.tileEffects[9].effects[b]=24,a.tileEffects[2].effects[b]=24}
function undergroundChannelLandBridge$$module$js$pass$deterministic(a){({tiles:a}=a.screens[161]);a[40]=159;a[55]=35;a[56]=35;a[57]=33;a[71]=141;a[72]=143;a[86]=153;a[87]=154;a[88]=140}function fixMimics$$module$js$pass$deterministic(a){let b=112;for(const c of a.locations)for(const a of c.spawns)a.isChest()&&(a.timed=!1,112<=a.id&&(a.id=b++))}
function adjustGoaFortressTriggers$$module$js$pass$deterministic(a){a=a.locations;a.goaFortressKelbesque.spawns[0].x-=8;a.goaFortressZebu.spawns.splice(1,1);a.goaFortressTornel.spawns.splice(2,1);a.goaFortressAsina.spawns.splice(2,1)}
function alarmFluteIsKeyItem$$module$js$pass$deterministic(a){const {waterfallCave4:b}=a.locations;a.npcs[20].data[1]=49;a.itemGets[49].inventoryRowStart=32;a.items[49].unique=!0;a.items[49].basePrice=0;const c=[[33,.72],[31,.9]];let d=0;for(const b of a.shops)if(b.type===module$js$rom$shop.ShopType.TOOL)for(let e=0,g=b.contents.length;e<g;e++){if(49!==b.contents[e])continue;const [f,g]=c[d++%c.length];b.contents[e]=f;a.shopDataTablesAddress&&(b.prices[e]=Math.round(b.prices[e]*g))}a.itemGets[91].itemId=
29;b.spawn(25).id=16}function requireHealedDolphin$$module$js$pass$deterministic(a){a.npcs[100].spawnConditions.set(214,[566,37]);a=a.npcs[123].localDialogs.get(-1);a.unshift(a[0].clone());a[0].condition=-38;a[1].condition=-567}function requireTelepathyForDeo$$module$js$pass$deterministic(a){a.npcs[89].globalDialogs.push(GlobalDialog$$module$js$rom$npc.of(-580,[26,18]));a.npcs[90].globalDialogs.push(GlobalDialog$$module$js$rom$npc.of(-580,[26,19]))}
function teleportOnThunderSword$$module$js$pass$deterministic(a){a.itemGets[3].flags.push(765);for(const b of[0,1,3])for(const c of[242,244])a.npcs[98].localDialogs.get(c)[b].message.action=31}function noTeleportOnThunderSword$$module$js$pass$deterministic(a){a.itemGets[3].acquisitionAction.action=22}
function adjustItemNames$$module$js$pass$deterministic(a,b){b.leatherBootsGiveSpeed()&&(b=a.items[47],b.menuName="Speed Boots",b.messageName="Speed Boots");for(b=5;12>b;b+=2)a.items[b].menuName=a.items[b].menuName.replace("Ball","Orb"),a.items[b].messageName=a.items[b].messageName.replace("Ball","Orb")}
function makeBraceletsProgressive$$module$js$pass$deterministic(a){a=a.npcs[95];var b=a.localDialogs.get(33);b=[b[0],b[2],b[2].clone(),b[1]];b[1].condition=-519;b[2].condition=-518;b[3].condition=-1;a.localDialogs.set(33,b)}function simplifyInvisibleChests$$module$js$pass$deterministic(a){for(const b of[a.locations.cordelPlainsEast,a.locations.undergroundChannel,a.locations.kirisaMeadow])for(const a of b.spawns)a.isChest()&&(a.data[2]|=32)}
function addCordelWestTriggers$$module$js$pass$deterministic(a,b){const {cordelPlainsEast:c,cordelPlainsWest:d}=a.locations;for(const a of c.spawns)(a.isChest()||b.disableTeleportSkip()&&a.isTrigger())&&d.spawns.push(a.clone())}function fixRabbitSkip$$module$js$pass$deterministic(a){for(const b of a.locations.mtSabreNorthMain.spawns)b.isTrigger()&&134===b.id&&1856===b.x&&(b.x+=16,b.y+=16)}
function addTowerExit$$module$js$pass$deterministic(a){const {towerEntrance:b,cryptTeleporter:c}=a.locations;a=c.entrances.length;const d=c.id;c.entrances.push(Entrance$$module$js$rom$location.of({tile:104}));b.exits.push(Exit$$module$js$rom$location.of({tile:87,dest:d,entrance:a}));b.exits.push(Exit$$module$js$rom$location.of({tile:88,dest:d,entrance:a}))}
function connectLimeTreeToLeaf$$module$js$pass$deterministic(a){const {valleyOfWind:b,limeTreeValley:c}=a.locations;b.screens[5][4]=16;c.screens[1][0]=26;c.screens[2][0]=12;a=b.entrances.push(Entrance$$module$js$rom$location.of({x:1263,y:1400}))-1;const d=c.entrances.push(Entrance$$module$js$rom$location.of({x:16,y:448}))-1;b.exits.push(Exit$$module$js$rom$location.of({x:1264,y:1376,dest:66,entrance:d}),Exit$$module$js$rom$location.of({x:1264,y:1392,dest:66,entrance:d}));c.exits.push(Exit$$module$js$rom$location.of({x:0,
y:432,dest:3,entrance:a}),Exit$$module$js$rom$location.of({x:0,y:448,dest:3,entrance:a}))}
function closeCaveEntrances$$module$js$pass$deterministic(a,b){function c(a,b,c){for(const d of a.flags)if(d.yx===b){d.flag=c;return}throw Error(`Could not find flag to replace at ${a}:${b}`);}a.locations.valleyOfWind.entrances[1].y+=16;a.swapMetatiles([144],[7,[1,0],-194],[14,[2,0],-194],[32,[3,10],-216],[33,[4,10],-216]);a.swapMetatiles([148,156],[104,[1,0],-194],[131,[2,0],-194],[136,[3,10],-216],[137,[4,10],-216]);a.screens[10].tiles[56]=1;a.screens[10].tiles[57]=2;a.screens[10].tiles[72]=3;a.screens[10].tiles[73]=
4;a.screens[21].tiles[121]=1;a.screens[21].tiles[122]=2;a.screens[21].tiles[137]=3;a.screens[21].tiles[138]=4;a.screens[25].tiles[72]=1;a.screens[25].tiles[73]=2;a.screens[25].tiles[88]=3;a.screens[25].tiles[89]=4;a.screens[62].tiles[86]=1;a.screens[62].tiles[87]=2;a.screens[62].tiles[102]=3;a.screens[62].tiles[103]=4;const {valleyOfWind:d,cordelPlainsWest:e,cordelPlainsEast:f,waterfallValleyNorth:g,waterfallValleySouth:h,kirisaMeadow:k,saharaOutsideCave:l,desert2:m}=a.locations;a=[[d,48],[e,48],
[f,48],[g,0],[g,20],[h,116],[k,16],[l,0],[m,65]];for(const [b,c]of a)b.flags.push(Flag$$module$js$rom$location.of({yx:c,flag:751}));b.paralysisRequiresPrisonKey()&&(c(e,48,750),c(f,48,750),c(g,0,728),b=Spawn$$module$js$rom$location.of({y:96,x:96,type:4,id:44}),a=Spawn$$module$js$rom$location.of({y:112,x:112,type:2,id:173}),g.spawns.splice(1,0,b),g.spawns.push(a))}
const eastCave$$module$js$pass$deterministic=(a)=>{console.log(a,[[156,132,128,131,156],[128,129,131,134,128],[131,136,137,128,128],[129,140,133,130,132],[154,133,156,152,134]],[[156,132,155,128,155],[128,129,129,128,129],[128,135,139,138,134],[128,140,128,133,132],[156,134,128,128,154]])};
function reversibleSwanGate$$module$js$pass$deterministic(a){a.locations[115].spawns.push(Spawn$$module$js$rom$location.of({xt:10,yt:2,type:1,id:45}),Spawn$$module$js$rom$location.of({xt:11,yt:2,type:1,id:45}),Spawn$$module$js$rom$location.of({xt:14,yt:10,type:2,id:179}));a.npcs[45].localDialogs.get(115)[0].flags.push(269);a.trigger(179).conditions.push(269)}
function preventNpcDespawns$$module$js$pass$deterministic(a,b){function c(a,b){const c=a.indexOf(b);if(0>c)throw Error(`Could not find element ${b} in ${a}`);a.splice(c,1)}function d(b,c=-1){const d=a.npcs[b].localDialogs.get(c);if(!d)throw Error(`Missing dialog $${hex$$module$js$rom$util(b)} at $${hex$$module$js$rom$util(c)}`);return d}function e(b,c){const d=a.npcs[b].spawnConditions.get(c);if(!d)throw Error(`Missing spawn condition $${hex$$module$js$rom$util(b)} at $${hex$$module$js$rom$util(c)}`);
return d}function f(a){a.reverse();for(let b=0;b<a.length;b++){const c=a[b+1];a[b].condition=c?~c.condition:-1}}a.npcs[116].link(126);a.npcs[116].used=!0;a.npcs[116].data=[...a.npcs[126].data];a.locations.swanDanceHall.spawns.find((a)=>a.isNpc()&&126===a.id).id=116;a.items[59].tradeIn[0]=116;a.npcs[136].linkDialog(22);a.npcs[130].used=!0;a.npcs[130].link(22);a.npcs[130].data=[...a.npcs[22].data];a.locations.brynmaer.spawns.find((a)=>a.isNpc()&&22===a.id).id=130;a.items[37].tradeIn[0]=130;d(19)[2].condition=
71;d(19)[2].flags=[169];d(19)[3].flags=[169];e(20,14)[1]=-137;c(e(22,87),-82);c(e(136,87),-82);var g=d(29);g[0].message.action=3;g[1].message.action=3;g[2].message.action=3;g[3].message.action=3;const h=d(30);(()=>{const [b,c,d,e]=h;e.condition=-70;c.condition=-1;a.npcs[30].localDialogs.set(-1,[e,d,b,c])})();for(const a of[32,33,34,124,125])f(d(a));g=d(31);g.unshift(...g.splice(1,1));a.npcs[51].spawnConditions.set(223,[-33,-28]);d(52)[1].condition=27;d(56)[3].message.action=3;d(56)[4].flags.push(156);
e(56,223)[1]=-28;e(56,225)[0]=27;d(56)[1].condition=27;e(57,216)[1]=-28;a.npcs[68].spawnConditions.set(233,[-142]);a.npcs[68].spawnConditions.set(228,[141]);a.npcs[94].localDialogs.set(16,[LocalDialog$$module$js$rom$npc.of(-59,[0,26],[58]),LocalDialog$$module$js$rom$npc.of(13,[0,29]),LocalDialog$$module$js$rom$npc.of(56,[0,28]),LocalDialog$$module$js$rom$npc.of(57,[0,29]),LocalDialog$$module$js$rom$npc.of(10,[0,27,3]),LocalDialog$$module$js$rom$npc.of(-1,[0,29])]);c(e(94,16),-82);a.npcs[95].spawnConditions.delete(33);
a.npcs[96].spawnConditions.delete(30);g=a.npcs[98];g.data[1]=40;d(g.id,225)[0].message.action=17;d(g.id,225)[2].message.action=17;c(e(g.id,225),-144);a.npcs[104].spawnConditions.set(97,[-156,33]);d(104)[0].message.action=2;d(195)[0].condition=514;a.npcs[196].spawnConditions.delete(242);a.npcs[203].spawnConditions.set(166,[-654]);g=a.npcs[94].localDialogs.get(242);g.unshift(...g.splice(1,1));a.trigger(128).conditions=[-40,59,515];a.trigger(129).conditions=[];b.barrierRequiresCalmSea()&&a.trigger(132).conditions.push(643);
a.trigger(140).conditions.push(58);a.trigger(141).used=!1;for(const b of a.locations.mtSabreNorthSummitCave.spawns)b.isTrigger()&&141===b.id&&(b.id=178);(function(a,b){b=a.findIndex(b);if(0>b)throw Error(`Could not find element in ${a}`);a.splice(b,1)})(a.locations.waterfallValleyNorth.spawns,(a)=>a.isTrigger()&&141===a.id);a.trigger(178).conditions.push(258);a.trigger(178).flags.push(-133,-134,13);a.trigger(140).conditions.push(-259);a.trigger(134).conditions.push(-259);a.prg[123043]=192;a.prg[123044]=
0;a.trigger(186).conditions[0]=-581;a.trigger(187).conditions[1]=-28;({zombieTown:b}=a.locations);b.spawns=b.spawns.filter((a)=>!a.isTrigger()||138!=a.id);for(const b of a.npcs)for(const a of b.allDialogs())14===a.condition&&(a.condition=579),-15===a.condition&&(a.condition=-580)}function disableStabs$$module$js$pass$deterministic(a){for(const b of[8,9,39])a.objects[b].collisionPlane=0}
function orbsOptional$$module$js$pass$deterministic(a){for(const b of[16,20,24,29])a.objects[b].terrainSusceptibility&=-5,a.objects[b].level=2}var module$js$pass$deterministic={};module$js$pass$deterministic.deterministic=deterministic$$module$js$pass$deterministic;function shuffleTrades$$module$js$pass$shuffletrades(a,b,c){if(b.randomizeTrades()){b=[[a.items[37],0,"Akahana"],[a.items[53],0,"Fisherman"],[a.items[59],0,"Kensu"],[a.items[60],0,"Aryllis"],[a.items[61],0,"Slimed Kensu"]];var d=[];for(const [a,c,g]of b){if(!a.tradeIn)throw Error(`Expected trade-in for ${a.id}`);d.push([g,a.tradeIn.slice(c,c+6)])}c.shuffle(d);for(const [c,f]of b){const [b,e]=d.pop();c.tradeIn.splice(f,6,...e);a.spoiler&&a.spoiler.addTrade(c.id,c.messageName,b);35===e[0]&&(a.prg[251061]=
c.id-28)}b=a.items[c.nextInt(4)];a.npcs[195].localDialogs.get(-1)[0].condition=512|b.id;a.spoiler&&a.spoiler.addTrade(b.id,b.messageName,"Rage");c=a.items[2*c.nextInt(4)+6];for(const d of a.npcs[95].localDialogs.values())for(b=2;b<d.length;b++)if(3===d[b].message.action){d[b-2].condition=~(512|c.id-1);d[b-1].condition=~(512|c.id);a.spoiler&&a.spoiler.addTrade(c.id,c.messageName,"Tornel");break}}}
function buildTradeInMap$$module$js$pass$shuffletrades(a){const b=new Map;for(const c of a.items)if(c.tradeIn)for(a=0;a<c.tradeIn.length;a+=6)b.set(c.tradeIn[a],c.id);return b}var module$js$pass$shuffletrades={};module$js$pass$shuffletrades.shuffleTrades=shuffleTrades$$module$js$pass$shuffletrades;module$js$pass$shuffletrades.buildTradeInMap=buildTradeInMap$$module$js$pass$shuffletrades;function fixDialog$$module$js$pass$fixdialog(a){function b(a){d(a,"teach you the magic of","bestow upon you the")}function c(b){b=a.items[a.itemGets[b].itemId];return`[${hex$$module$js$rom$util(b.id)}:${b.messageName}]`}function d(b,c,d){const [e,f]=b.split(":").map((a)=>parseInt(a,16));b=a.messages.parts[e][f];b.text=b.text.replace(c,d)}d("03:06",",","");var e=buildTradeInMap$$module$js$pass$shuffletrades(a),f=a.npcs[94];65>f.data[0]&&b("00:1b");d("00:1b","[41:Refresh]",c(f.data[0]));if(f=e.get(130))d("02:01",
"an unusual statue",vague$$module$js$pass$fixdialog(f)),d("02:02","a statue",`the ${commonNoun$$module$js$pass$fixdialog(f)}`);d("02:02","[29:Gas Mask]",c(a.prg[251902]));f=a.prg[223220];65>f&&b("03:01");d("03:01","[43:Telepathy]",c(f));f=a.npcs[95];var g=findTornelTradeIn$$module$js$pass$fixdialog(f);d("03:01","[06:Tornado Bracelet]",c(g));d("05:0a","[06:Tornado Bracelet]",c(g));d("05:0a","[44:Teleport]",c(f.data[0]));f=e.get(100);null!=f&&(d("09:01","[35:Fog Lamp]",c(f)),d("09:04","[35:Fog Lamp]",
c(f)),d("09:05","[35:Fog Lamp]",c(f)),d("09:06","lamp",commonNoun$$module$js$pass$fixdialog(f)));d("0a:0c","[28:Flute of Lime]",c(a.npcs[56].data[0]));f=a.prg[250361];65>f&&b("0b:01");d("0b:01","[45:Recover]",c(f));f=a.prg[251609];65>f&&(d("0b:01","teach you\n the magic of","give you\n "),b("1d:12"));d("0b:01","[46:Barrier]",c(f));d("1d:12","[46:Barrier]",c(f));f=function(...b){for(const c of b){b=a.locations[c];for(const c of b.spawns)if(c.isChest()&&72>c.id&&a.items[a.itemGets[c.id].itemId].unique)return c.id}return-1}(68,
69,70,71,72,73,74,75,76,77,78,79);0<=f?d("0d:00","[35:Fog Lamp]",c(f)):d("0d:00","that a [35:Fog Lamp] was","there was treasure");f=a.npcs[195].localDialogs.get(-1)[0].condition&255;g=a.prg[250679];d("0e:03","[02:Sword of Water]",c(f));d("0e:03","[09:Ball of Water]",c(g));d("10:0c","that's","is");d("10:0c",/, is in the\+lighthouse/,"");f=e.get(35);null!=f&&(d("12:05","[3c:Kirisa Plant]",c(f)),d("12:10","the plant",`the ${commonNoun$$module$js$pass$fixdialog(f)}`),d("12:10","[3c:Kirisa Plant]",c(f)),
f=`Our illustrious chief seeks ${vague$$module$js$pass$fixdialog(f)}.`,d("12:09",/[^]*/,f),d("12:0a",/[^]*/,f));f=e.get(116);null!=f&&d("13:02","[3b:Love Pendant]",c(f));f=a.prg[251614];65>f&&d("13:02","teachs+you the magic of","bestow\n upon you the");d("13:02","[47:Change]",c(f));e=e.get(117);null!=e&&(d("18:06","[3d:Ivory Statue]",c(e)),d("18:07","[3d:Ivory Statue]",c(e)));d("18:06","It's in a room","{0b:Karmine} is");e=a.prg[250255];65>e&&d("18:07","teach","give");d("18:07","[48:Flight]",c(e));
e=a.prg[251477];65>e&&b("1c:10");d("1c:10","[42:Paralysis]",c(e));d("20:06","Statue of Gold",c(58))}function findTornelTradeIn$$module$js$pass$fixdialog(a){for(const b of a.localDialogs.values())for(a=2;a<b.length;a++){const c=~b[a].condition;if(516<c&&524>=c&&!(c&1))return c&255}return 6}
function vague$$module$js$pass$fixdialog(a){switch(a){case 37:return"an unusual statue";case 40:return"a rare instrument";case 53:return"a brilliant lamp";case 59:return"a beautiful charm";case 60:return"a fragrant plant";case 61:return"an exotic statue"}fail$$module$js$assert();return"a valuable item"}
function commonNoun$$module$js$pass$fixdialog(a){switch(a){case 37:return"statue";case 40:return"instrument";case 53:return"lamp";case 59:return"pendant";case 60:return"plant";case 61:return"statue"}fail$$module$js$assert();return"item"}var module$js$pass$fixdialog={};module$js$pass$fixdialog.fixDialog=fixDialog$$module$js$pass$fixdialog;function shuffleMazes$$module$js$pass$shufflemazes(a,b){shufflePyramid$$module$js$maze$pyramid(a,b);shuffleSwamp$$module$js$maze$swamp(a,b);shuffleGoa1$$module$js$maze$goa(a,b);for(const c of SHUFFLED_CAVES$$module$js$pass$shufflemazes)shuffleCave$$module$js$maze$cave(a.locations[c],b)}function prepareScreens$$module$js$pass$shufflemazes(a){extendGoaScreens$$module$js$maze$goa(a)}
const SHUFFLED_CAVES$$module$js$pass$shufflemazes=[4,5,6,7,8,9,10,12,14,16,17,34,35,36,37,38,39,42,43,44,45,46,49,51,52,53,56,57,68,69,70,72,73,74,75,76,77,78,79,84,85,86,87,105,112,125,127,128,129,130,131,132,133,134,135,143,146,149,157,171,176,177,178,179];var module$js$pass$shufflemazes={};module$js$pass$shufflemazes.shuffleMazes=shuffleMazes$$module$js$pass$shufflemazes;module$js$pass$shufflemazes.prepareScreens=prepareScreens$$module$js$pass$shufflemazes;class TileEffects$$module$js$rom$tileeffects extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.base=b<<8&8191|73728;this.effects=tuple$$module$js$rom$util(a.prg,this.base,256)}write(a){for(let b=0;256>b;b++)a.rom[this.base+b]=this.effects[b]}}TileEffects$$module$js$rom$tileeffects.PIT=1;TileEffects$$module$js$rom$tileeffects.NO_WALK=2;TileEffects$$module$js$rom$tileeffects.IMPASSIBLE=4;TileEffects$$module$js$rom$tileeffects.ALTERNATIVE=8;
TileEffects$$module$js$rom$tileeffects.BEHIND=16;TileEffects$$module$js$rom$tileeffects.SLOPE=32;TileEffects$$module$js$rom$tileeffects.SLOW=64;TileEffects$$module$js$rom$tileeffects.PAIN=128;var module$js$rom$tileeffects={};module$js$rom$tileeffects.TileEffects=TileEffects$$module$js$rom$tileeffects;class MapScreen$$module$js$rom$mapscreen{constructor(a,b){function c(c){var d=OVERRIDE$$module$js$rom$mapscreen.get(c|f);if(null!=d)return d;c=a.tiles[c];d=e[c];32>c&&d&TileEffects$$module$js$rom$tileeffects.ALTERNATIVE&&(d=e[b.alternates[c]]);return!(d&(TileEffects$$module$js$rom$tileeffects.NO_WALK|TileEffects$$module$js$rom$tileeffects.IMPASSIBLE))}this.screen=a;this.tileset=b;this.partition=new Map;this.partitions=[];var d=new UnionFind$$module$js$unionfind;const e=b.effects().effects,f=a.id<<
8;for(let a=0;15>a;a++)for(let b=0;16>b;b++){const e=a<<4|b;c(e)&&(a&&c(e-16)&&d.union([e,e-16]),b&&c(e-1)&&d.union([e,e-1]))}for(var g of d.sets()){d=null;for(var h of g)if(isPerimeter$$module$js$rom$mapscreen(h)||136===h)d||this.partitions.push(d=new Set),d.add(h),this.partition.set(h,this.partitions.length-1)}g=[0,0,0,0];for(h=15;0<=h;h--)for(d=0;4>d;d++)g[d]<<=1,this.partition.has(2>d?d?h<<4|15:h:2===d?224|h:h<<4)&&(g[d]|=1);this.edges=g}}
function isPerimeter$$module$js$rom$mapscreen(a){const b=a&15;a&=240;return!a||224===a||!b||15===b}const OVERRIDE$$module$js$rom$mapscreen=new Map([...rows$$module$js$rom$mapscreen([[29184,4080],[29408,4080],[29664,4080],[39680,960],[39904,960],[64992,4080]]),...cols$$module$js$rom$mapscreen([[31744,0],[31759,0]])]);function*rows$$module$js$rom$mapscreen(a){for(const [b,c]of a)for(a=0;16>a;a++)yield[b|a,!!(c&1<<a)]}
function*cols$$module$js$rom$mapscreen(a){for(const [b,c]of a)for(a=0;15>a;a++)yield[b|a<<4,!!(c&1<<a)]}
class MapBuilder$$module$js$rom$mapscreen{constructor(a,b,c,d,e){this.tileset=a;this.random=c;this.height=d;this.width=e;this.screens=[];this.edges=new DefaultMap$$module$js$util(()=>new Set);this.eligible=[];this.constraints=[];this.inBounds=new Set;for(var f of b)for(b=0;4>b;b++)this.edges.get(b|a.screens[f].edges[b]<<2).add(f);for(a=0;a<d;a++)for(f=0;f<e;f++)this.inBounds.add(a<<4|f)}isInBounds(a){return 0<=a&&a>>>4<this.height&&(a&15)<this.width}reset(){this.eligible=[];this.constraints=[];for(const a of this.inBounds)0>
this.screens[a]||(this.screens[a]=void 0,delete this.constraints[a]);for(const a of this.inBounds)this.initConstraints(a)}initConstraints(a){delete this.constraints[a];for(let c of Dir$$module$js$rom$mapscreen){var b=a+DELTA$$module$js$rom$mapscreen[c];this.inBounds.has(b)?(b=this.screens[b],null!=b&&(b=0>b?~b:b,this.addConstraint(a,c,this.tileset.screens[b].edges[c^2]))):this.addConstraint(a,c,0)}}addConstraint(a,b,c){if(this.inBounds.has(a)&&null==this.screens[a]){var d=this.constraints[a];d||(this.constraints[a]=
d=[],this.eligible.push(a));d[b]=c}}deleteConstraint(a,b){if(a=this.constraints[a]){delete a[b];for(b=a.length-1;0<=b;b--)if(null!=a[b])return;b=this.eligible.findIndex((a)=>null!=a);0<=b&&this.eligible.splice(b,1)}}fill(a){let b;for(;null!=(b=this.findEmpty())&&0<=a;){const c=this.pickScreen(b);null!=c?this.setScreen(b,c):(this.deleteOneNeighbor(b),a--)}return null==b}findEmpty(){const a=this.random.shuffle([...this.inBounds]);for(const b of a)if(null==this.screens[b]&&(this.constraints[b]||[]).some((a)=>
null!=a))return b}deleteSomeScreens(){const a=[];for(var b of this.inBounds)0<=this.screens[b]&&a.push(b);this.random.shuffle(a);b=1+this.random.nextInt(a.length-1);for(const c of a.slice(0,b))this.deleteScreen(c)}traverse(){var a=new UnionFind$$module$js$unionfind;for(const d of this.inBounds){var b=this.screens[d];b=this.tileset.screens[0>b?~b:b].partitions.map((a)=>[...a].map((a)=>{a|=d<<8;224===(a&240)&&(a+=32);15===(a&15)&&(a+=1);return a}));for(var c of b)a.union(c)}a=a.sets();c=new Map;for(b=
0;b<a.length;b++)for(const d of a[b])c.set(d,b);return c}deleteOneNeighbor(a){var b=this.random.shuffle([...Dir$$module$js$rom$mapscreen]);for(const c of b)if(b=a+DELTA$$module$js$rom$mapscreen[c],this.inBounds.has(b)&&0<=this.screens[b]){this.deleteScreen(b);return}throw Error("Could not find a neighbor to delete!");}pickScreen(a){a=this.constraints[a];for(let d=0;d<a.length;d++){var b=a[d];if(null!=b){b=this.edges.get(d|b<<2);var c=c?intersect$$module$js$rom$mapscreen(c,b):b}}if(c&&c.size)return c=
[...c],this.random.pick(c)}setScreen(a,b){if(null!=this.screens[a])throw Error("screen already set");this.screens[a]=b;delete this.constraints[a];b=this.tileset.screens[b].edges;for(const c of Dir$$module$js$rom$mapscreen)this.addConstraint(a+DELTA$$module$js$rom$mapscreen[c],opposite$$module$js$rom$mapscreen(c),b[c])}deleteScreen(a){var b=this.screens[a];this.screens[a]=void 0;if(null!=b){if(0>b)throw Error("Cannot delete fixed screen");for(const c of Dir$$module$js$rom$mapscreen)b=a+DELTA$$module$js$rom$mapscreen[c],
this.inBounds.has(b)&&this.deleteConstraint(b,opposite$$module$js$rom$mapscreen(c));this.initConstraints(a)}}}const Dir$$module$js$rom$mapscreen=[0,1,2,3],DELTA$$module$js$rom$mapscreen=[-16,1,16,-1];function opposite$$module$js$rom$mapscreen(a){return a^2}function intersect$$module$js$rom$mapscreen(a,b){const c=new Set;for(const d of a)b.has(d)&&c.add(d);return c}var module$js$rom$mapscreen={};module$js$rom$mapscreen.MapScreen=MapScreen$$module$js$rom$mapscreen;
module$js$rom$mapscreen.MapBuilder=MapBuilder$$module$js$rom$mapscreen;class Tileset$$module$js$rom$tileset extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);b&=63;this.tileBase=65536|b<<8;this.attrBase=77824|b<<4;this.alternatesBase=81408|b<<3;this.tiles=seq$$module$js$rom$util(4,(b)=>tuple$$module$js$rom$util(a.prg,this.tileBase|b<<8,256));this.attrs=seq$$module$js$rom$util(256,(b)=>a.prg[this.attrBase|b>>2]>>((b&3)<<1)&3);this.alternates=tuple$$module$js$rom$util(a.prg,this.alternatesBase,32)}get screens(){return this.lazyScreens?this.lazyScreens:this.lazyScreens=
seq$$module$js$rom$util(256,(a)=>new MapScreen$$module$js$rom$mapscreen(this.rom.screens[a],this))}write(a){for(var b=0;256>b;b++){32>b&&(a.rom[this.alternatesBase+b]=this.alternates[b]);for(var c=0;4>c;c++)a.rom[this.tileBase+(c<<8)+b]=this.tiles[c][b]}for(b=0;64>b;b++)c=b<<2,a.rom[this.attrBase+b]=this.attrs[c]&3|(this.attrs[c+1]&3)<<2|(this.attrs[c+2]&3)<<4|(this.attrs[c+3]&3)<<6}effects(){let a=this.id>>>2&15;168===this.id&&(a=2);172===this.id&&a--;return this.rom.tileEffects[a]}}
const NONE$$module$js$rom$tileset=0,TRIM$$module$js$rom$tileset=1,MAIN$$module$js$rom$tileset=2;
function paletteTypes$$module$js$rom$tileset(a,b){switch(b){case 26:return[MAIN$$module$js$rom$tileset,MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,(a,b,e)=>a[3]===b[3]&&b[3]===e[3]];case 67:return[MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,TRIM$$module$js$rom$tileset];case 87:return[MAIN$$module$js$rom$tileset,NONE$$module$js$rom$tileset,NONE$$module$js$rom$tileset];case 96:return[MAIN$$module$js$rom$tileset,MAIN$$module$js$rom$tileset,MAIN$$module$js$rom$tileset,(a,b,e)=>
a[2]===e[2]];case 100:case 104:return[MAIN$$module$js$rom$tileset,NONE$$module$js$rom$tileset,TRIM$$module$js$rom$tileset];case 124:return[MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,TRIM$$module$js$rom$tileset]}switch(a){case 128:case 132:return[MAIN$$module$js$rom$tileset,MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,(a,b)=>a[3]===b[3]];case 136:return[MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,NONE$$module$js$rom$tileset];case 140:return[MAIN$$module$js$rom$tileset,
TRIM$$module$js$rom$tileset,MAIN$$module$js$rom$tileset];case 144:return[MAIN$$module$js$rom$tileset,MAIN$$module$js$rom$tileset,MAIN$$module$js$rom$tileset];case 148:return[MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,(a,b)=>a[3]===b[3]];case 152:return[TRIM$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,TRIM$$module$js$rom$tileset];case 156:return[MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,MAIN$$module$js$rom$tileset];case 160:return[TRIM$$module$js$rom$tileset,
TRIM$$module$js$rom$tileset,TRIM$$module$js$rom$tileset];case 164:return[MAIN$$module$js$rom$tileset,MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset];case 168:return[MAIN$$module$js$rom$tileset,MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset];case 172:return[MAIN$$module$js$rom$tileset,TRIM$$module$js$rom$tileset,MAIN$$module$js$rom$tileset]}throw Error(`unxpected: ${a}`);}
const ALLOWED_PALETTES$$module$js$rom$tileset=new Map([["path",[...r$$module$js$rom$tileset(0,18),...r$$module$js$rom$tileset(21,27),...r$$module$js$rom$tileset(30,37),...r$$module$js$rom$tileset(38,43),...r$$module$js$rom$tileset(44,48),...r$$module$js$rom$tileset(57,63),66,...r$$module$js$rom$tileset(68,72),...r$$module$js$rom$tileset(77,89),...r$$module$js$rom$tileset(128,132),135,...r$$module$js$rom$tileset(139,147)]],["mountain",[1,...r$$module$js$rom$tileset(3,7),...r$$module$js$rom$tileset(8,
11),12,13,14,...r$$module$js$rom$tileset(17,24),25,26,28,29,30,32,33,35,39,42,43,47,49,51,54,55,56,57,60,66,68,70,75,76,79,83,88,...r$$module$js$rom$tileset(128,133),135,136,139,142]],["trees",[1,2,4,6,...r$$module$js$rom$tileset(7,15),...r$$module$js$rom$tileset(20,24),26,28,30,32,35,39,41,42,43,46,47,49,51,55,56,57,60,61,67,68,70,73,74,75,79,82,87,110,...r$$module$js$rom$tileset(128,133),135,136,...r$$module$js$rom$tileset(139,144)]]]),TERRAIN_BY_PALETTE$$module$js$rom$tileset=new Map([[128,["path",
"mountain","trees"]],[132,["mountain-path","brick","trees"]],[136,["cave wall/ground","cave bridge",""]],[140,["floor","fire","accept"]],[144,["trees","mountain","grass"]],[148,["water/ground","mountain","shallows"]],[152,["door","room","rocks"]],[156,["mountain/ground","trees","desert"]],[160,["ground","trees","some haze"]],[164,["","",""]],[168,["","",""]],[172,["","",""]]]);function r$$module$js$rom$tileset(a,b){return Array(b-a).fill(0).map((b,d)=>d+a)}var module$js$rom$tileset={};
module$js$rom$tileset.Tileset=Tileset$$module$js$rom$tileset;module$js$rom$tileset.paletteTypes=paletteTypes$$module$js$rom$tileset;function shufflePalettes$$module$js$pass$shufflepalettes(a,b,c){(new Shuffle$$module$js$pass$shufflepalettes(a,b,c)).shuffle()}
class Shuffle$$module$js$pass$shufflepalettes{constructor(a,b,c){this.rom=a;this.flags=b;this.random=c}shuffle(){this.shuffleBackgrounds()}shuffleBackgrounds(){if(this.flags.shuffleSpritePalettes()){var a=this.rom.locations.partition((a)=>a,function(a,b){return a.tilePalettes[0]===b.tilePalettes[0]&&a.tilePalettes[1]===b.tilePalettes[1]&&a.tilePalettes[2]===b.tilePalettes[2]&&a.tileEffects===b.tileEffects},!0),b=[new Map,new Map];for(var c of a){var d=c[1];for(let a=0;2>a;a++)for(let c=0;2>c;c++){let e=
b[a].get(d.tilePatterns[c]);e||b[a].set(d.tilePatterns[c],e=new Set);e.add(d.tilePalettes[a])}}for(const e of a){c=e[1];a=[new Set,new Set];for(d=0;2>d;d++)a[d]=new Set([...b[d].get(c.tilePatterns[0]),...b[d].get(c.tilePatterns[1])]);c=this.random.pick([...a[0]]);a=this.random.pick([...a[1]]);for(const b of e[0])b.tilePalettes[0]=c,b.tilePalettes[1]=a}}}shuffleBackgrounds2(){if(this.flags.shuffleSpritePalettes()){var a=[new Set,new Set];for(var b of this.rom.locations)if(b.used){var c=paletteTypes$$module$js$rom$tileset(this.rom.tilesets[(b.tileset&
127)>>2].id,b.id);for(var d=0;3>d;d++)for(var e=0;e<c[e];e++)a[e].add(b.tilePalettes[e])}b=this.rom.locations.partition((a)=>a,function(a,b){return a.tilePalettes[0]===b.tilePalettes[0]&&a.tilePalettes[1]===b.tilePalettes[1]&&a.tilePalettes[2]===b.tilePalettes[2]},!0);var f=a.map((a)=>[...a]);for(const g of b){const h=g[1],k=paletteTypes$$module$js$rom$tileset(h.tileset,h.id);for(a=0;1E3>a;a++){b=seq$$module$js$rom$util(3,(a)=>k[a]?this.random.pick(f[k[a]-1]):h.tilePalettes[a]);c=b.map((a)=>this.rom.palettes[a].colors);
d=!0;for(const a of g[0])if([,,,e]=paletteTypes$$module$js$rom$tileset(a.tileset,a.id),e&&!e(c[0],c[1],c[2])){d=!1;break}if(d)for(const a of g[0])a.tilePalettes=[b[0],b[1],b[2]]}}}}}var module$js$pass$shufflepalettes={};module$js$pass$shufflepalettes.shufflePalettes=shufflePalettes$$module$js$pass$shufflepalettes;const KEY_NAMES$$module$js$pass$unidentifieditems="Curious Key;Bronze Key;Silver Key;Ancient Key;Small Key;Shiny Key;Mysterious Key;Magic Key".split(";"),FLUTE_NAMES$$module$js$pass$unidentifieditems="Wooden Flute;Metal Flute;Horn of Plenty;Ocarina;Pan Pipes;Bugle;Bagpipes;Kazoo;Magic Whistle;Dog Whistle;Recorder;Accordion;Harmonica;Sousaphone;Violin;Cello".split(";"),LAMP_NAMES$$module$js$pass$unidentifieditems="Bronze Lamp;Magic Lamp;Dull Lamp;Shimmering Lamp;Oil Lamp;Broken Lamp".split(";"),STATUE_NAMES$$module$js$pass$unidentifieditems=
"Rusty Statue;Forbidden Statue;Golden Idol;Strange Statue;Glass Statue;Burt Figurine;Draygon Figurine;Karmine Figurine;Mado Figurine;Sabera Figurine;Kelbesque Figurine;Copper Statue;White Statue;Invisible Statue;Mattrick Figurine;Dragondarch Statue;Overswarm Statue;Trueblue83 Statue".split(";");
function unidentifiedItems$$module$js$pass$unidentifieditems(a,b,c){if(b.unidentifiedItems()){var d=(...b)=>b.map((b)=>a.items[b]);b=d(50,51,52);var e=d(39,40,49,54),f=d(53,57);d=d(37,56,58,61);for(const [g,[...h]]of[[b,KEY_NAMES$$module$js$pass$unidentifieditems],[e,FLUTE_NAMES$$module$js$pass$unidentifieditems],[f,LAMP_NAMES$$module$js$pass$unidentifieditems],[d,STATUE_NAMES$$module$js$pass$unidentifieditems]]){c.shuffle(h);b=c.shuffle([0,1,2,3]);for(const c of g)e=h.pop(),a.spoiler&&a.spoiler.addUnidentifiedItem(c.id,
c.messageName,e),c.menuName=c.messageName=e,c.palette=b.pop()}}}var module$js$pass$unidentifieditems={};module$js$pass$unidentifieditems.unidentifiedItems=unidentifiedItems$$module$js$pass$unidentifieditems;const IM1$$module$js$random=2147483563,IM2$$module$js$random=2147483399,AM$$module$js$random=1/IM1$$module$js$random,IMM1$$module$js$random=IM1$$module$js$random-1,IA1$$module$js$random=40014,IA2$$module$js$random=40692,IQ1$$module$js$random=53668,IQ2$$module$js$random=52774,IR1$$module$js$random=12211,IR2$$module$js$random=3791,NTAB$$module$js$random=32,NDIV$$module$js$random=1+Math.floor(IMM1$$module$js$random/NTAB$$module$js$random),EPS$$module$js$random=1.2E-7,RNMX$$module$js$random=1-EPS$$module$js$random;
class Random$$module$js$random{constructor(a=Math.floor(4294967296*Math.random())){this.iy=this.idum2=this.idum=0;this.iv=[];this.z1=null;this.seed(a)}static newSeed(){return Math.floor(4294967296*Math.random())}seed(a){this.idum2=this.idum=Math.max(1,Math.floor(a));this.iy=0;this.iv=Array(NTAB$$module$js$random).fill(0);for(a=NTAB$$module$js$random+7;0<=a;a--){const b=Math.floor(this.idum/IQ1$$module$js$random);this.idum=IA1$$module$js$random*(this.idum-b*IQ1$$module$js$random)-b*IR1$$module$js$random;
0>this.idum&&(this.idum+=IM1$$module$js$random);a<NTAB$$module$js$random&&(this.iv[a]=this.idum)}this.iy=this.iv[0]}next(){var a=Math.floor(this.idum/IQ1$$module$js$random);this.idum=IA1$$module$js$random*(this.idum-a*IQ1$$module$js$random)-a*IR1$$module$js$random;0>this.idum&&(this.idum+=IM1$$module$js$random);a=Math.floor(this.idum2/IQ2$$module$js$random);this.idum2=IA2$$module$js$random*(this.idum2-a*IQ2$$module$js$random)-a*IR2$$module$js$random;0>this.idum2&&(this.idum2+=IM2$$module$js$random);
a=Math.floor(this.iy/NDIV$$module$js$random);this.iy=this.iv[a]-this.idum2;this.iv[a]=this.idum;1>this.iy&&(this.iy+=IMM1$$module$js$random);return Math.min(AM$$module$js$random*this.iy,RNMX$$module$js$random)}nextInt(a){return Math.floor(this.next()*a)}nextNormal(a=0,b=1,c=-Infinity,d=Infinity){for(;;){let e=this.z1;if(null==e){const a=Math.sqrt(-2*Math.log(this.next())),b=TWOPI$$module$js$random*this.next();e=a*Math.cos(b);this.z1=a*Math.sin(b)}else this.z1=null;e=a+e*b;if(e>=c&&e<=d)return e}}shuffle(a){for(let b=
a.length;b;){const c=this.nextInt(b--);[a[b],a[c]]=[a[c],a[b]]}return a}*ishuffle(a){const b=[];if(!Array.isArray(a)){if(hasSize$$module$js$random(a)){var c=a[Symbol.iterator]();for(var d=0;d<a.size;d++){const e=this.nextInt(a.size-d),f=Math.max(d,e);for(;b.length<=f;)b.push(c.next().value);yield b[e];b[e]=b[d]}return}a=[...a]}if(!Array.isArray(a))throw Error("impossible");for(c=0;c<a.length;c++)d=c+this.nextInt(a.length-c),yield d in b?b[d]:a[d],b[d]=c in b?b[c]:a[c]}pick(a){if(!a.length)throw Error("empty array");
return a[this.nextInt(a.length)]}pickWeighted(a){if(!a.length)throw Error("empty array");var b=0;for(const [c]of a)b+=c;b*=this.next();for(const [c,d]of a){if(b<c)return d;b-=c}throw Error("bad weights");}bitGenerator(){let a=0,b=0;return()=>{a||(a=32,b=this.nextInt(4294967296));a--;const c=!(b&1);b>>>=1;return c}}}function hasSize$$module$js$random(a){return"size"in a}const TWOPI$$module$js$random=2*Math.PI;var module$js$random={};module$js$random.Random=Random$$module$js$random;class AdHocSpawn$$module$js$rom$adhocspawn extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.base=(b<<2)+171008;this.data=tuple$$module$js$rom$util(a.prg,this.base,4)}get slotRangeLower(){return this.data[0]}set slotRangeLower(a){this.data[0]=a}get slotRangeUpper(){return this.data[1]}set slotRangeUpper(a){this.data[1]=a}get objectId(){return this.data[2]}set objectId(a){this.data[2]=a}get count(){return this.data[3]}set count(a){this.data[3]=a}write(a){a.rom.subarray(this.base,
this.base+4).set(this.data)}}var module$js$rom$adhocspawn={};module$js$rom$adhocspawn.AdHocSpawn=AdHocSpawn$$module$js$rom$adhocspawn;class BossKill$$module$js$rom$bosskill extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.pointer=129387+2*b;this.base=readLittleEndian$$module$js$rom$util(a.prg,this.pointer)+81920;this.data=a.prg.slice(this.base,this.base+21);this.palettes=this.data.subarray(5,13);this.patterns=this.data.subarray(13,19)}get routine(){const a=readLittleEndian$$module$js$rom$util(this.data,0);return a&&a+81920}set routine(a){writeLittleEndian$$module$js$rom$util(this.data,0,a?a-81920:0)}get restoreMusic(){return this.data[3]}set restoreMusic(a){this.data[3]=
a}get itemDrop(){return this.data[4]}set itemDrop(a){this.data[4]=a}get restoreAnimation(){return this.data[19]}set restoreAnimation(a){this.data[19]=a}get explode(){return!!this.data[20]}set explode(a){this.data[20]=a?1:0}write(a){for(const b of[0,1,4])a.rom[this.base+b]=this.data[b]}}var module$js$rom$bosskill={};module$js$rom$bosskill.BossKill=BossKill$$module$js$rom$bosskill;class Bosses$$module$js$rom$bosses{constructor(a){this.rom=a;this.all=[this.vampire1=new Boss$$module$js$rom$bosses(this,"Vampire 1",192,0,!0),this.insect=new Boss$$module$js$rom$bosses(this,"Insect",193,1),this.kelbesque1=(new Boss$$module$js$rom$bosses(this,"Kelbesque 1",194,2,!0)).sword(3),this.rage=new Boss$$module$js$rom$bosses(this,"Rage",195,3),this.sabera1=(new Boss$$module$js$rom$bosses(this,"Sabera 1",132,4,!0,222574)).sword(3),this.vampire2=new Boss$$module$js$rom$bosses(this,"Vampire 2",
204,12,!0),this.mado1=(new Boss$$module$js$rom$bosses(this,"Mado 1",-1,5,!0,251936)).sword(3),this.kelbesque2=(new Boss$$module$js$rom$bosses(this,"Kelbesque 2",197,6,!0)).sword(3),this.sabera2=(new Boss$$module$js$rom$bosses(this,"Sabera 2",198,7,!0)).sword(3),this.mado2=(new Boss$$module$js$rom$bosses(this,"Mado 2",199,8,!0)).sword(3),this.karmine=(new Boss$$module$js$rom$bosses(this,"Karmine",200,9,!0)).sword(2),this.draygon1=(new Boss$$module$js$rom$bosses(this,"Draygon 1",203,10)).sword(2),this.statueOfMoon=
new Boss$$module$js$rom$bosses(this,"Statue of Moon",201),this.statueOfSun=new Boss$$module$js$rom$bosses(this,"Statue of Sun",202),this.draygon2=(new Boss$$module$js$rom$bosses(this,"Draygon 2",203,11)).sword(3),this.dyna=new Boss$$module$js$rom$bosses(this,"Dyna",-1,13)]}fromLocation(a){return this.all.find((b)=>b.location===a)}fromBossKill(a){return this.all.find((b)=>b.kill===a)}fromObject(a){return this.all.find((b)=>b.object===a)}[Symbol.iterator](){return this.all[Symbol.iterator]()}}
class Boss$$module$js$rom$bosses{constructor(a,b,c,d,e,f){this.bosses=a;this.name=b;this.npc=c;this.kill=d;this.shuffled=e;this.swordLevel=1;this.objectAddress=f||33008|(c&252)<<6|(c&3)<<2|1;this.object=a.rom.prg[this.objectAddress];({prg:a}=a.rom);null!=d&&(b=81920+readLittleEndian$$module$js$rom$util(a,129387+2*d),b=a[b+4],255!==b&&(this.drop=b),this.location=a[129373+d])}sword(a){this.swordLevel=a;return this}}var module$js$rom$bosses={};module$js$rom$bosses.Bosses=Bosses$$module$js$rom$bosses;
module$js$rom$bosses.Boss=Boss$$module$js$rom$bosses;class Hitbox$$module$js$rom$hitbox extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.base=218769+(b<<2);this.coordinates=tuple$$module$js$rom$util(a.prg,this.base,4)}get w(){return this.coordinates[1]}set w(a){this.coordinates[1]=a}get x0(){return signed$$module$js$rom$util(this.coordinates[0])}set x0(a){this.coordinates[0]=unsigned$$module$js$rom$util(a)}get x1(){return this.x0+this.w}get h(){return this.coordinates[3]}set h(a){this.coordinates[3]=a}get y0(){return signed$$module$js$rom$util(this.coordinates[2])}set y0(a){this.coordinates[2]=
unsigned$$module$js$rom$util(a)}get y1(){return this.y0+this.h}write(a){a.rom.subarray(this.base,this.base+4).set(this.coordinates)}}var module$js$rom$hitbox={};module$js$rom$hitbox.Hitbox=Hitbox$$module$js$rom$hitbox;const ITEM_USE_DATA_TABLE$$module$js$rom$item=121826,ITEM_DATA_TABLE$$module$js$rom$item=135152,SELECTED_ITEM_TABLE$$module$js$rom$item=135227,VANILLA_PAWN_PRICE_TABLE$$module$js$rom$item=138946,MENU_NAME_TABLE$$module$js$rom$item=135302,MESSAGE_NAME_TABLE$$module$js$rom$item=166492,MENU_NAME_ENCODE$$module$js$rom$item=[["Sword","\n\x0B\f"],[" of ","\\]"],["Bracelet","<=>["],["Shield","\r\u000e\u000f"],["Armor","{\u0011\u0012"],["Magic","#%("],["Power","\u0013\u0014\u0015"],["Item","\u0016\u0017^"]];
class Item$$module$js$rom$item extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.itemUseDataPointer=ITEM_USE_DATA_TABLE$$module$js$rom$item+2*b;this.itemUseDataBase=readLittleEndian$$module$js$rom$util(a.prg,this.itemUseDataPointer)+81920;this.itemDataPointer=ITEM_DATA_TABLE$$module$js$rom$item+b;this.itemDataValue=a.prg[this.itemDataPointer];this.selectedItemPointer=SELECTED_ITEM_TABLE$$module$js$rom$item+b;this.selectedItemValue=a.prg[this.selectedItemPointer];if(null!=a.shopDataTablesAddress){const c=
a.shopDataTablesAddress+21*a.shopCount+2*a.scalingLevels+2*(b-13);this.basePrice=13<=b&&39>b?readLittleEndian$$module$js$rom$util(a.prg,c):0}else this.basePrice=2*readLittleEndian$$module$js$rom$util(a.prg,VANILLA_PAWN_PRICE_TABLE$$module$js$rom$item+2*b);this.messageNamePointer=MESSAGE_NAME_TABLE$$module$js$rom$item+2*b;this.messageNameBase=readLittleEndian$$module$js$rom$util(a.prg,this.messageNamePointer)+131072;this.messageName=readString$$module$js$rom$util(a.prg,this.messageNameBase);this.menuNamePointer=
MENU_NAME_TABLE$$module$js$rom$item+2*b;this.menuNameBase=readLittleEndian$$module$js$rom$util(a.prg,this.menuNamePointer)+98304;this.menuName=MENU_NAME_ENCODE$$module$js$rom$item.reduce((a,b)=>{var [c,d]=b;return a.replace(d,c)},readString$$module$js$rom$util(a.prg,this.menuNameBase,255));this.tradeIn=(b=TRADE_INS$$module$js$rom$item.get(b))?tuple$$module$js$rom$util(a.prg,this.itemUseDataBase,6*b):void 0}itemUseMessages(){const a=new Map;for(const b of ITEM_USE_MESSAGE$$module$js$rom$item.get(this.id)||
[]){const c=MessageId$$module$js$rom$messageid.from(this.rom.prg,this.itemUseDataBase+b);a.set(c.mid(),c)}return[...a.values()]}setName(a){this.messageName=this.menuName=a}get palette(){return this.itemDataValue&3}set palette(a){this.itemDataValue=this.itemDataValue&-4|a&3}get unique(){return!!(this.itemDataValue&64)}set unique(a){this.itemDataValue=this.itemDataValue&-65|(a?64:0)}get worn(){return!!(this.itemDataValue&32)}set worn(a){this.itemDataValue=this.itemDataValue&-33|(a?32:0)}get solid(){return!!(this.itemDataValue&
128)}set solid(a){this.itemDataValue=this.itemDataValue&-129|(a?128:0)}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){a.rom[b.itemDataPointer]=b.itemDataValue;a.rom[b.selectedItemPointer]=b.selectedItemValue;null!=b.rom.shopDataTablesAddress?13<=b.id&&39>b.id&&writeLittleEndian$$module$js$rom$util(a.rom,b.rom.shopDataTablesAddress+21*b.rom.shopCount+2*b.rom.scalingLevels+2*(b.id-13),b.basePrice):writeLittleEndian$$module$js$rom$util(a.rom,VANILLA_PAWN_PRICE_TABLE$$module$js$rom$item+
2*b.id,b.basePrice>>>1);var c=MENU_NAME_ENCODE$$module$js$rom$item.reduce((a,b)=>{var [c,d]=b;return a.replace(c,d)},b.menuName);c=yield a.write([...stringToBytes$$module$js$rom$item(c),255],131072,139263,`ItemMenuName ${hex$$module$js$rom$util(b.id)}`);writeLittleEndian$$module$js$rom$util(a.rom,b.menuNamePointer,c-98304);b.tradeIn&&(c=b.itemUseDataBase,a.rom.subarray(c,c+b.tradeIn.length).set(b.tradeIn))})}}
const stringToBytes$$module$js$rom$item=(a)=>seq$$module$js$rom$util(a.length,(b)=>a.charCodeAt(b)),TRADE_INS$$module$js$rom$item=new Map([[29,1],[37,1],[40,4],[49,2],[53,1],[59,1],[60,1],[61,1]]),ITEM_USE_MESSAGE$$module$js$rom$item=new Map([[29,[2,6]],[30,[0]],[31,[0]],[32,[0]],[33,[0]],[34,[0]],[35,[0]],[37,[2]],[40,[2,8,14,20]],[50,[1]],[51,[2]],[52,[2]],[53,[2]],[54,[2]],[55,[1]],[57,[0]],[58,[2]],[59,[2]],[60,[2]],[61,[2]],[62,[2]],[63,[2]],[64,[2]]]);var module$js$rom$item={};
module$js$rom$item.Item=Item$$module$js$rom$item;class ItemGet$$module$js$rom$itemget extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.itemPointer=122214+b;this.itemId=a.prg[this.itemPointer];this.tablePointer=121600+2*b;let c=this.tableBase=readLittleEndian$$module$js$rom$util(a.prg,this.tablePointer)+81920;this.inventoryRowStart=a.prg[c++];this.inventoryRowLength=a.prg[c++];this.acquisitionAction=MessageId$$module$js$rom$messageid.from(a.prg,c);this.flags=ITEM_GET_FLAGS$$module$js$rom$util.read(a.prg,c+2);this.key=254===a.prg[c+
2+2*this.flags.length+1];0!==b&&this.tableBase===readLittleEndian$$module$js$rom$util(a.prg,122214)+81920&&(this.key=!1,this.flags=[])}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){a.rom[b.itemPointer]=b.itemId;var c=[b.inventoryRowStart,b.inventoryRowLength,...b.acquisitionAction.data,...ITEM_GET_FLAGS$$module$js$rom$util.bytes(b.flags),b.key?254:255];c=yield a.write(c,118784,126975,`ItemGetData ${hex$$module$js$rom$util(b.id)}`);writeLittleEndian$$module$js$rom$util(a.rom,
b.tablePointer,c-81920)})}}var module$js$rom$itemget={};module$js$rom$itemget.ItemGet=ItemGet$$module$js$rom$itemget;class LocationsClass$$module$js$rom$locations extends Array{constructor(a){super(256);this.rom=a;for(let b=0;256>b;b++)this[b]=new Location$$module$js$rom$location(a,b);for(const b of Object.keys(LOCATIONS$$module$js$rom$location))[a]=LOCATIONS$$module$js$rom$location[b],this[b]=this[a]}static get [Symbol.species](){return Array}partition(a,b=(a,b)=>a===b,c=!1){const d=new Set,e=[];for(let f of this){if(d.has(f)||!f.used)continue;d.add(f);const g=a(f),h=[],k=[f];for(;k.length;){const e=k.pop();h.push(e);
for(const f of e.neighbors(c))!d.has(f)&&b(a(f),g)&&(d.add(f),k.push(f))}e.push([[...h],g])}return e}}const namesTyped$$module$js$rom$locations=LOCATIONS$$module$js$rom$location,Locations$$module$js$rom$locations=LocationsClass$$module$js$rom$locations;var module$js$rom$locations={};module$js$rom$locations.Locations=LocationsClass$$module$js$rom$locations;class DataTable$$module$js$rom$messages extends Array{constructor(a,b,c,d,e){e=void 0===e?1<d?(...a)=>a:(a)=>a:e;super(c);this.rom=a;this.base=b;this.count=c;this.width=d;for(let f=0;f<c;f++)this[f]=e(...slice$$module$js$rom$util(a.prg,b+f*d,d))}}
class AddressTable$$module$js$rom$messages extends Array{constructor(a,b,c,d,e){e=void 0===e?(a)=>a:e;super(c);this.rom=a;this.base=b;this.count=c;this.offset=d;this.addresses=seq$$module$js$rom$util(this.count,(c)=>(c=readLittleEndian$$module$js$rom$util(a.prg,b+2*c))&&c+d);for(let a=0;a<c;a++)this[a]=e(this.addresses[a],a,this.addresses)}}const DELIMITERS$$module$js$rom$messages=new Map([[6,"{}"],[7,"[]"]]);
class Message$$module$js$rom$messages{constructor(a,b,c,d,e){this.messages=a;this.part=b;this.id=c;this.addr=d;this.pointer=e;this.bytes=[];this.hex="";b=a.rom.prg;c=[];for(e=d;d&&b[e];e++){const f=b[e];this.bytes.push(f);if(1===f){if(e!==d&&3!==b[e-1])throw Error(`Unexpected start message signal at ${e.toString(16)}`);}else if(2===f)c.push("\n ");else if(3===f)c.push(`${Messages$$module$js$rom$messages.CONTINUED}\n`);else if(4===f)c.push("{:HERO:}");else if(8===f)c.push("[:ITEM:]");else if(5<=f&&
9>=f){const d=b[++e];if(9===f){c.push(" ".repeat(d));continue}const h=DELIMITERS$$module$js$rom$messages.get(f);h&&(c.push(h[0]),c.push(d.toString(16).padStart(2,"0")),c.push(":"));c.push(a.extraWords[f][d]);h&&c.push(h[1]);PUNCTUATION$$module$js$rom$messages[String.fromCharCode(b[e+1])]||c.push(" ")}else if(128<=f)c.push(a.basicWords[f-128]),PUNCTUATION$$module$js$rom$messages[String.fromCharCode(b[e+1])]||c.push(" ");else if(32<=f)c.push(String.fromCharCode(f));else throw Error(`Non-exhaustive switch: ${f} at ${e.toString(16)}`);
}this.text=c.join("")}mid(){return`${hex$$module$js$rom$util(this.part)}:${hex$$module$js$rom$util(this.id)}`}fixText(){function a(d,h,k){h=void 0===h?d.length:h;if(29<e+h){if(k){d=k.split(/\s+/);for(h=0;h<d.length;h++)h&&(f||a(" "),f=!0),a(d[h]);return}b()}" "===d?(c.push(...g," "),g=[]):g.push(d);e+=h;f=d.endsWith(" ")}function b(){e=1+g.reduce((a,b)=>a+b.length,0);3<++d?(c.push("#\n "),d=0):c.push("\n ");f=!0}if(!this.checkText()){var c=[],d=0,e=0,f=!1,g=[];for(let b=0;b<this.text.length;b++){var h=
this.text[b],k=this.text[b+1];/\s/.test(h)?(f||a(" "),f=!0):"{"===h?(":"===k?a("{:HERO:}",6):(h=this.text.indexOf(":",b),h=Number.parseInt(this.text.substring(b+1,h),16),k=this.messages.extraWords[6][h],a(`{${h.toString(16)}:${k}}`,k.length,k)),b=this.text.indexOf("}",b)):"["===h?(":"===k?a("[:ITEM:]",Math.max(...this.messages.rom.items.map((a)=>a.messageName.length))):(h=this.text.indexOf(":",b),h=Number.parseInt(this.text.substring(b+1,h),16),k=this.messages.rom.items[h].messageName,a(`[${h.toString(16)}:${k}]`,
k.length,k)),b=this.text.indexOf("]",b)):a(h)}c.push(...g);this.text=c.join("")}}checkText(){let a=0,b=0;for(let d=0;d<this.text.length;d++){const e=this.text[d];var c=this.text[d+1];if("\n"===e){if(a++,b=1,3<a)return!1}else if("#"===e)"\n"===c&&d++,a=b=0;else if("{"===e||"["===e){if(":"===c){if(b="{"===e?b+6:b+Math.max(...this.messages.rom.items.map((a)=>a.messageName.length)),28<b)return!1}else c=this.text.indexOf(":",d),c=Number.parseInt(this.text.substring(d+1,c),16),b+=("{"===e?this.messages.extraWords[6][c]:
this.messages.rom.items[c].messageName).length;d=this.text.indexOf(CLOSERS$$module$js$rom$messages[e],d)}else b++;if(29<b&&" "!==e)return!1}return!0}}const PUNCTUATION$$module$js$rom$messages={"\x00":!0," ":!0,"!":!0,"'":!0,",":!0,".":!0,":":!0,";":!0,"?":!0,_:!0,"\n":!0,"#":!0};
class Messages$$module$js$rom$messages{constructor(a){this.rom=a;const b=readLittleEndian$$module$js$rom$util(a.prg,165636)+131072,c=readLittleEndian$$module$js$rom$util(a.prg,165514)+131072,d=readLittleEndian$$module$js$rom$util(a.prg,165589)+131072,e=readLittleEndian$$module$js$rom$util(a.prg,165609)+131072,f=(b)=>readString$$module$js$rom$util(a.prg,b);this.basicWords=new AddressTable$$module$js$rom$messages(a,b,128,131072,f);this.extraWords={5:new AddressTable$$module$js$rom$messages(a,c,d-c>>>
1,131072,f),6:new AddressTable$$module$js$rom$messages(a,d,36,131072,f),7:new AddressTable$$module$js$rom$messages(a,e,74,131072,f)};this.banks=new DataTable$$module$js$rom$messages(a,164862,36,1);this.parts=new AddressTable$$module$js$rom$messages(a,164898,34,131072,(b,c,d)=>new AddressTable$$module$js$rom$messages(a,b,33===c?3:d[c+1]-b>>>1,(this.banks[c]<<13)-40960,(a,d)=>new Message$$module$js$rom$messages(this,c,d,a,b+2*d)))}*messages(a){for(const b of this.parts)if(a)for(const c of b)a.has(c.mid())&&
(yield c);else yield*b}uses(){function a(a,c){a="string"===typeof a?a:a.mid();const d=b.get(a)||new Set;d.add(c);b.set(a,d)}const b=new Map;for(var c of this.rom.triggers)c.message.nonzero()&&a(c.message,`Trigger $${hex$$module$js$rom$util(c.id)}`);for(const b of this.rom.items)for(const c of b.itemUseMessages())c.nonzero()&&a(c,`Item $${hex$$module$js$rom$util(b.id)}`);for(var d of this.rom.npcs){for(const b of d.globalDialogs)a(b.message,`NPC $${hex$$module$js$rom$util(d.id)}`);for(const b of d.localDialogs){const [e,
g]=b;c=0<=e?` @ $${hex$$module$js$rom$util(e)}`:"";for(const b of g)a(b.message,`NPC $${hex$$module$js$rom$util(d.id)}${c}`)}}for(const b of this.rom.telepathy.sages){for(const c of b.defaultMessages)a(c,`Telepathy ${b.sage}`);for(const c of b.messageGroups)for(const e of c.messages){[,...d]=e;for(const c of d)a(c,`Telepathy ${b.sage}`)}}for(const b of HARDCODED_MESSAGES$$module$js$rom$messages)a(b,"Hardcoded");return b}buildAbbreviationTable(a){a=void 0===a?this.uses():a;const b=[];var c=new Map;
const d=new Map;for(var e of this.messages(a)){e.fixText();a=e.mid();var f=c.get(e.addr);if(f=null!=f&&d.get(f))f.push(a);else{c.set(e.addr,a);d.set(a,[]);f=e.text;var g=[];for(let c=0,d=f.length;c<=d;c++){var h=f[c],k=CLOSERS$$module$js$rom$messages[h];if(PUNCTUATION$$module$js$rom$messages[h]||k||c===d){var l=f[c+1];k&&(c=Math.max(c,f.indexOf(k,c)));if(g.length){k=" "!==h&&"'"!==h||!l||PUNCTUATION$$module$js$rom$messages[l]?"":h;l=g.join("");var m=b.length;h=l.length+(" "===h?1:0);g=[];b.push({str:l,
id:m,chain:k,bytes:h,used:0,suffixes:new Set,mid:a})}}else g.push(h)}}}c=new Map;for(e=b.length-1;0<=e;e--)for(a=b[e],f=a.bytes-2;0<=f;f--)for(g=a.str.substring(f),h=0,k=a,l=a.bytes-f-1;;){(m=c.get(g))||c.set(g,m={chains:h,missing:f,saving:-g.length,str:g,words:new Set});m.words.add(e);m.saving+=l;for(let a=h;0<=a;a--)b[e+a].suffixes.add(m);if(!k.chain)break;g+=k.chain;k=b[e+ ++h];g+=k.str;l+=k.bytes}e=new Set;a=[];f=(a,b)=>{({saving:a}=a);({saving:b}=b);return b-a};g=[...c.values()].sort(f);for(h=
0;g.length&&h<MAX_TABLE_LENGTH$$module$js$rom$messages;){e.has(g[0].str)&&(g.sort(f),e.clear());const {str:n,saving:p,missing:q,words:r,chains:v}=g.shift();if(0>=p)break;h+=n.length+3;k=a.length;l=new Set;for(const a of r){m=b[a];for(const a of[m.mid,...d.get(m.mid)||[]])l.add(a)}a.push({bytes:128>k?[k+128]:[5,k-128],mids:l,str:n});for(const a of r)for(k=0;k<=v;k++){l=b[a+k];m=l.bytes-(k?0:q);for(const a of l.suffixes)a.saving-=m-l.used,e.add(a.str);l.used=m}if(128===a.length){for(const a of c.values())a.saving-=
a.words.size;g.sort(f);e.clear()}}return a}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){function c(b,c){writeLittleEndian$$module$js$rom$util(a.rom,b,c-131072);writeLittleEndian$$module$js$rom$util(a.rom,b+5,c+1-131072)}var d=b.uses(),e=b.buildAbbreviationTable(d),f=166053,g=f+2*(e.length+b.rom.items.length+b.extraWords[6].count);c(165636,f);for(let b=0,d=e.length;b<d;b++)128===b&&c(165514,f),writeLittleEndian$$module$js$rom$util(a.rom,f,g),f+=2,writeString$$module$js$rom$util(a.rom,
g,e[b].str),g+=e[b].str.length,a.rom[g++]=0;128>e.length&&c(165514,f);c(165589,f);const h=b.extraWords[6];for(const b of h)writeLittleEndian$$module$js$rom$util(a.rom,f,g),f+=2,writeString$$module$js$rom$util(a.rom,g,b),g+=b.length,a.rom[g++]=0;c(165609,f);c(165769,f);for(const c of b.rom.items)writeLittleEndian$$module$js$rom$util(a.rom,f,g),f+=2,writeString$$module$js$rom$util(a.rom,g,c.messageName),g+=c.messageName.length,a.rom[g++]=0;f=new Map;for(var k of e)for(var l of k.mids)(e=f.get(l))||
f.set(l,e=[]),e.push(k);for(var m of f.values())m.sort((a,b)=>{({str:{length:a}}=a);({str:{length:b}}=b);return b-a});k=seq$$module$js$rom$util(b.parts.length,()=>[]);for(var n of b.messages(d)){l=n.text;l=l.replace(/([\[{])([^\]}]*)[\]}](.|$)/g,(a,b,c,d)=>{if(d&&!PUNCTUATION$$module$js$rom$messages[d])return a;" "===d&&(d="");if("["===b&&":ITEM:"===c)return`[8]${d}`;if("{"===b&&":HERO:"===c)return`[4]${d}`;c=/^([0-9a-f]+):/.exec(c);if(!c)throw Error(`Bad message text: ${a}`);a=Number.parseInt(c[1],
16);return`[${"{"===b?6:7}][${a}]${d}`});for(var p of f.get(n.mid())||[]){const {str:a,bytes:b}=p;l=l.replace(new RegExp(a+"( [ &0-9]|.|$)","g"),(a,c)=>{if(c&&!PUNCTUATION$$module$js$rom$messages[c])return a;" "===c&&(c="");return b.map((a)=>`[${a}]`).join("")+c})}m=["[01]"];d=[];d.push(1);for(let a=0,b=l.length;a<b;a++)if(e=l[a],e===Messages$$module$js$rom$messages.CONTINUED)d.push(3,1),m.push("[03][01]"),"\n"===l[a+1]&&a++;else if("\n"===e)d.push(2)," "===l[a+1]&&a++,m.push("[02]");else if("["===
e){e=l.indexOf("]",a);if(0>=e)throw Error(`bad text: ${l}`);g=Number(l.substring(a+1,e));if(isNaN(g))throw Error(`bad text: ${l}`);d.push(g);m.push(`[${hex$$module$js$rom$util(g)}]`);a=e}else if(" "===e&&" "===l[a+1]){for(e=a+2;" "===l[e];)e++;d.push(9,e-a);m.push(`[09][${hex$$module$js$rom$util(e-a)}]`);a=e-1}else d.push(e.charCodeAt(0)),m.push(e);d.push(0);m.push("[0]");n.bytes=d;n.hex=m.join("");l=b.banks[n.part]<<13;const c=l-40960;k[n.part][n.id]=a.write(d,l,l+8192,`Message ${n.mid()}`).then((a)=>
a-c)}n=yield Promise.all(k.map((a)=>Promise.all(a)));p=163840;for(f=0;f<n.length;f++){d=[];for(k=0;k<n[f].length;k++)writeLittleEndian$$module$js$rom$util(d,2*k,n[f][k]);a.rom.subarray(p,p+d.length).set(d);writeLittleEndian$$module$js$rom$util(a.rom,164898+2*f,p-131072);p+=d.length}for(n=0;n<b.banks.length;n++)a.rom[164862+n]=b.banks[n];yield Promise.all([])})}}Messages$$module$js$rom$messages.CONTINUED="#";
const MAX_TABLE_LENGTH$$module$js$rom$messages=1250,CLOSERS$$module$js$rom$messages={"{":"}","[":"]"},HARDCODED_MESSAGES$$module$js$rom$messages=new Set("20:1d 1b:0f 1b:10 1b:11 1b:12 1b:05 1b:06 1b:07 1f:00 13:00 0b:01 20:0c 20:0f 1c:11 0e:05 16:00 16:02 16:04 16:06 20:11 21:00 21:02 21:01 06:00 18:00 18:02 18:04 18:08 1b:03 1b:00 1b:00 06:01 10:13 19:05 20:14 20:15 20:17 20:02 20:0d 20:19 20:1a 20:1b 03:01 03:02 10:10 10:11 10:12 0c:04 0c:05 03:03 20:0e 20:13".split(" "));
var module$js$rom$messages={};module$js$rom$messages.Messages=Messages$$module$js$rom$messages;module$js$rom$messages.HARDCODED_MESSAGES=HARDCODED_MESSAGES$$module$js$rom$messages;const METASPRITE_TABLE$$module$js$rom$metasprite=230492;
class Metasprite$$module$js$rom$metasprite extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.mirrored=null;this.pointer=METASPRITE_TABLE$$module$js$rom$metasprite+(this.id<<1);this.base=readLittleEndian$$module$js$rom$util(a.prg,this.pointer)+196608;this.used=229376<=this.base;if(255===a.prg[this.base]){const c=readLittleEndian$$module$js$rom$util(a.prg,this.base+1);for(let b=0;256>b;b++)if(readLittleEndian$$module$js$rom$util(a.prg,METASPRITE_TABLE$$module$js$rom$metasprite+(b<<
1))===c){this.mirrored=b;break}if(null==this.mirrored)throw Error(`could not find mirrored sprite for ${hex$$module$js$rom$util(b)}: ${hex$$module$js$rom$util(c)}`);this.frames=this.frameMask=this.size=0;this.sprites=[]}else this.mirrored=null,this.size=a.prg[this.base],this.frameMask=a.prg[this.base+1],this.frames=this.frameMask+1,this.sprites=seq$$module$js$rom$util(this.frames,(b)=>{b=this.base+2+4*b*this.size;const c=[];for(let d=0;d<this.size&&128!==a.prg[b+4*d];d++)c.push(tuple$$module$js$rom$util(a.prg,
b+4*d,4));return c})}patternBanks(a=0){if(!this.used)return[];let b=this;b.mirrored&&(b=this.rom.metasprites[b.mirrored]);const c=new Set;for(const d of b.sprites)for(const [b,,,f]of d){if(128===b)break;c.add(f+a>>>6&255)}return[...c]}palettes(){if(!this.used)return[];let a=this;a.mirrored&&(a=this.rom.metasprites[a.mirrored]);const b=new Set;for(const c of a.sprites)for(const [a,,e]of c){if(128===a)break;b.add(e&3)}return[...b]}}var module$js$rom$metasprite={};
module$js$rom$metasprite.Metasprite=Metasprite$$module$js$rom$metasprite;class ObjectsClass$$module$js$rom$objects extends Array{constructor(a){super(256);this.rom=a;a=new Map;const b=ALL_MONSTERS$$module$js$rom$objects;for(var c in b){const d=b[c];a.set(d[1],[c,d])}for(c=0;256>c;c++)if(a.has(c)){const [b,e]=a.get(c);this[c]=this[b]=new Monster$$module$js$rom$monster(this.rom,e)}else this[c]=new ObjectData$$module$js$rom$objectdata(this.rom,c)}static get [Symbol.species](){return Array}}
const Objects$$module$js$rom$objects=ObjectsClass$$module$js$rom$objects,BIRD$$module$js$rom$objects={monsterClass:"BIRD"},BRAIN$$module$js$rom$objects={monsterClass:"BRAIN"},ENTITY$$module$js$rom$objects={monsterClass:"ENTITY"},EYE$$module$js$rom$objects={monsterClass:"EYE"},GOLEM$$module$js$rom$objects={monsterClass:"GOLEM"},JELLY$$module$js$rom$objects={monsterClass:"JELLY"},MOSQUITO$$module$js$rom$objects={monsterClass:"MOSQUITO"},MUSHROOM$$module$js$rom$objects={monsterClass:"MUSHROOM"},PUDDLE$$module$js$rom$objects=
{monsterClass:"PUDDLE"},SLIME$$module$js$rom$objects={monsterClass:"SLIME"},SOLDIER$$module$js$rom$objects={monsterClass:"SOLDIER"},SPIDER$$module$js$rom$objects={monsterClass:"SPIDER"},WRAITH$$module$js$rom$objects={monsterClass:"WRAITH"},WYVERN$$module$js$rom$objects={monsterClass:"WYVERN"},ZOMBIE$$module$js$rom$objects={monsterClass:"ZOMBIE"},MONSTERS$$module$js$rom$objects={wraith1:["Wraith 1",75,28,WRAITH$$module$js$rom$objects],wraith2:["Wraith 2",79,28,WRAITH$$module$js$rom$objects],blueSlime:["Blue Slime",
80,1,SLIME$$module$js$rom$objects],weretiger:["Weretiger",81,1],greenJelly:["Green Jelly",82,4,JELLY$$module$js$rom$objects],redSlime:["Red Slime",83,4,SLIME$$module$js$rom$objects],rockGolem:["Rock Golem",84,4,GOLEM$$module$js$rom$objects],blueBat:["Blue Bat",85,4],greenWyvern:["Green Wyvern",86,4,WYVERN$$module$js$rom$objects],orc:["Orc",88,6],redMosquito:["Red Mosquito",89,10,MOSQUITO$$module$js$rom$objects],blueMushroom:["Blue Mushroom",90,10,MUSHROOM$$module$js$rom$objects],swampTomato:["Swamp Tomato",
91,10],blueMosquito:["Blue Mosquito",92,23,MOSQUITO$$module$js$rom$objects],swampPlant:["Swamp Plant",93,10],largeBlueSlime:["Large Blue Slime",95,11,SLIME$$module$js$rom$objects],iceZombie:["Ice Zombie",96,12,ZOMBIE$$module$js$rom$objects],greenBrain:["Green Brain",97,12,BRAIN$$module$js$rom$objects],greenSpider:["Green Spider",98,12,SPIDER$$module$js$rom$objects],redWyvern:["Red Wyvern",99,12,WYVERN$$module$js$rom$objects],soldier:["Soldier",100,14,SOLDIER$$module$js$rom$objects],iceEntity:["Ice Entity",
101,14,ENTITY$$module$js$rom$objects],redBrain:["Red Brain",102,14,BRAIN$$module$js$rom$objects],iceGolem:["Ice Golem",103,14,GOLEM$$module$js$rom$objects],largeRedSlime:["Large Red Slime",105,18,SLIME$$module$js$rom$objects],troll:["Troll",106,18],redJelly:["Red Jelly",107,18,JELLY$$module$js$rom$objects],medusa:["Medusa",108,19],crab:["Crab",109,19],medusaHead:["Medusa Head",110,20],bird:["Bird",111,20,BIRD$$module$js$rom$objects],redMushroom:["Red Mushroom",113,21,MUSHROOM$$module$js$rom$objects],
earthEntity:["Earth Entity",114,22,ENTITY$$module$js$rom$objects],mimic:["Mimic",115,22],redSpider:["Red Spider",116,22,SPIDER$$module$js$rom$objects],fishman:["Fishman",117,25],jellyfish:["Jellyfish",118,25],kraken:["Kraken",119,25],darkGreenWyvern:["Dark Green Wyvern",120,27,WYVERN$$module$js$rom$objects],sandZombie:["Sand Zombie",121,38,ZOMBIE$$module$js$rom$objects],wraithShadow1:["Wraith Shadow 1",123,28,WRAITH$$module$js$rom$objects],moth:["Moth",124,28,{difficulty:3}],archer:["Archer",128,
33,SOLDIER$$module$js$rom$objects],bomberBird:["Bomber Bird",129,33,BIRD$$module$js$rom$objects],lavaBlob:["Lava Blob",130,37,PUDDLE$$module$js$rom$objects],flailGuy:["Flail Guy",132,37],blueEye:["Blue Eye",133,37,EYE$$module$js$rom$objects],salamander:["Salamander",134,37],sorceror:["Sorceror",135,37],mado1:["Mado 1",136,37],knight:["Knight",137,41,{difficulty:1}],devil:["Devil",138,41],wraitShadow2:["Wraith Shadow 2",140,41,WRAITH$$module$js$rom$objects],tarantula:["Tarantula",145,41],skeleton:["Skeleton",
146,41],purpleEye:["Purple Eye",148,41,EYE$$module$js$rom$objects],flailKnight:["Flail Knight",149,41],scorpion:["Scorpion",150,41],sandBlob:["Sand Blob",152,44,PUDDLE$$module$js$rom$objects],mummy:["Mummy",153,44],warlock:["Warlock",154,46],brownRobot:["Brown Robot",160,47,{difficulty:1}],whiteRobot:["White Robot",161,47],towerSentinel:["Tower Sentinel",162,47],helicopter:["Helicopter",163,47]},OBJECTS$$module$js$rom$objects={verticalPlatform:["Vertical Platform",126,28],horizotalPlatform:["Horizontal Platform",
127,28],glitch1:["Glitch",141,41],glitch2:["Glitch",142,41],guardianStatue:["Guardian Statue",143,41],statueOfSun:["Statue of Sun",156,47],statueOfMoon:["Statue of Moon",157,47],crumblingVerticalPlatform:["Crumbling Vertical Platform",159,47],glitch3:["Glitch",166,41]},BOSSES$$module$js$rom$objects={vampire1:["Vampire 1",87,5],giantInsect:["Giant Insect",94,11],kelbesque1:["Kelbesque 1",104,15],sabera1:["Sabera 1",125,29],kelbesque2:["Kelbesque 2",139,41],sabera2:["Sabera 2",144,41],mado2:["Mado 2",
147,41],karmine:["Karmine",151,41],draygon1:["Draygon 1",155,45],draygon2:["Draygon 2",158,47],dyna:["Dyna",164,47],vampire2:["Vampire 2",165,28],dynaPod:["Dyna Pod",180,47]},PROJECTILES$$module$js$rom$objects={sorcerorShot:["Sorceror Shot",63,37],paralysisPowderSource:["Paralysis Powder Source",77,23],dynaCounter:["Dyna Counter",184,47],dynaLaser:["Dyna Laser",185,47],dynaBubble:["Dyna Bubble",186,47],vampire2Bat:["Vampire 2 Bat",188,28],brownRobotLaserSource:["Brown Robot Laser Source",190,47],
draygon2Fireball:["Draygon 2 Fireball",191,47],vampire1Bat:["Vampire 1 Bat",193,5],giantInsectFireball:["Giant Insect Fireball",195,11],greenMosquito:["Green Monsquito",196,11],kelbesque1Rock:["Kelbesque 1 Rock",197,15],sabera1Balls:["Sabera 1 Balls",198,29],kelbesque2Fire:["Kelbesque 2 Fire",199,41],sabera2Fire:["Sabera 2 Fire",200,41],sabera2Balls:["Sabera 2 Balls",201,41],karmineBalls:["Karmine Balls",202,41],statueBalls:["Statue Balls",203,47],draygon1Lightning:["Draygon 1 Lightning",204,45],
draygon2Laser:["Draygon 2 Laser",205,47],draygon2Breath:["Draygon 2 Breath",206,47],birdBomb:["Bird Bomb",224,33],greenMosquitoShot:["Green Mosquito Shot",226,11],paralysisBeam:["Paralysis Beam",227,25],stoneGaze:["Stone Gaze",228,19],rockGolemRock:["Rock Golem Rock",229,4],curseBeam:["Curse Beam",230,41],mpDrainWeb:["MP Drain Web",231,41],fishmanTrident:["Fishman Triden",232,25],orcAxe:["Orc Axe",233,6],swampPollen:["Swamp Pollen",234,10],paralysisPowder:["Paralysis Powder",235,23],soldierSword:["Soldier Sword",
236,14],iceGolemRock:["Ice Golem Rock",237,14],trollAxe:["Troll Axe",238,18],krakenInk:["Kraken Ink",239,25],archerArrow:["Archer Arrow",240,33],knightSword:["Knight Sword",242,41],mothResidue:["Moth Residue",243,28],brownRobotLaser:["Brown Robot Laser",244,47],whiteRobotLaser:["White Robot Laser",245,47],towerSentinelLaser:["Tower Sentinel Laser",246,47],skeletonShot:["Skeleton Shot",247,41],blobShot:["Blob Shot",248,37],flailKnightFlail:["Flail Knight Flail",249,41],flailGuyFlail:["Flail Guy Flail",
250,37],madoShuriken:["Mado Shuriken",252,37],guardianStatueMissile:["Guardian Statue Missile",253,36],demonWallFire:["Demon Wall Fire",254,37]},ALL_MONSTERS$$module$js$rom$objects=Object.assign({},MONSTERS$$module$js$rom$objects,OBJECTS$$module$js$rom$objects,BOSSES$$module$js$rom$objects,PROJECTILES$$module$js$rom$objects),CHECK$$module$js$rom$objects=ALL_MONSTERS$$module$js$rom$objects;var module$js$rom$objects={};module$js$rom$objects.ObjectsClass=ObjectsClass$$module$js$rom$objects;
module$js$rom$objects.Objects=ObjectsClass$$module$js$rom$objects;module$js$rom$objects.MONSTERS=MONSTERS$$module$js$rom$objects;var RomOption$$module$js$rom$option;(function(a){a.bit=(a,c)=>new RomOptionBit$$module$js$rom$option(a,c);a.byte=(a)=>new RomOptionByte$$module$js$rom$option(a);a.address=(a)=>new RomOptionAddress$$module$js$rom$option(a)})(RomOption$$module$js$rom$option||(RomOption$$module$js$rom$option={}));
class RomOptionBit$$module$js$rom$option{constructor(a,b){this.address=a;this.bit=b}get(a){return!!(a[this.address]&1<<this.bit)}set(a,b){const c=1<<this.bit;a[this.address]=b?a[this.address]|c:a[this.address]&~c}}class RomOptionByte$$module$js$rom$option{constructor(a){this.address=a}get(a){return a[this.address]}set(a,b){a[this.address]=b&255}}
class RomOptionAddress$$module$js$rom$option{constructor(a){this.address=a}get(a){return a[this.address]<<16|a[this.address+1]<<8|a[this.address+2]}set(a,b){a[this.address]=b>>>16&255;a[this.address+1]=b>>>8&255;a[this.address+2]=b&255}}var module$js$rom$option={};module$js$rom$option.RomOption=RomOption$$module$js$rom$option;class Palette$$module$js$rom$palette extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.base=(b&3)<<2|(b&252)<<6|16624;this.colors=tuple$$module$js$rom$util(a.prg,this.base,4)}color(a){return this.colors[a]&63}}var module$js$rom$palette={};module$js$rom$palette.Palette=Palette$$module$js$rom$palette;class Pattern$$module$js$rom$pattern extends Entity$$module$js$rom$entity{constructor(a,b,c){super(a,b);this.pixels=c||tuple$$module$js$rom$util(a.chr,b<<4,16)}pixelAt(a,b){return(this.pixels[a|8]>>b&1)<<1|this.pixels[a]>>b&1}flipH(){return new Pattern$$module$js$rom$pattern(this.rom,-1,this.pixels.map(reverseBits$$module$js$rom$util))}flipV(){return new Pattern$$module$js$rom$pattern(this.rom,-1,seq$$module$js$rom$util(16,(a)=>this.pixels[a&8|~a&7]))}flip(a){let b=this;a&Flip$$module$js$rom$pattern.HORIZONTAL&&
(b=b.flipH());a&Flip$$module$js$rom$pattern.VERTICAL&&(b=b.flipV());return b}write(a){const b=this.id<<4;a.chr.subarray(b,b+16).set(this.pixels)}}var Flip$$module$js$rom$pattern;(function(a){a[a.HORIZONTAL=64]="HORIZONTAL";a[a.VERTICAL=128]="VERTICAL"})(Flip$$module$js$rom$pattern||(Flip$$module$js$rom$pattern={}));var module$js$rom$pattern={};module$js$rom$pattern.Pattern=Pattern$$module$js$rom$pattern;module$js$rom$pattern.Flip=Flip$$module$js$rom$pattern;class Screen$$module$js$rom$screen extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.base=(255<b?64+b:b)<<8;this.tiles=tuple$$module$js$rom$util(a.prg,this.base,240)}allTilesSet(){return new Set(this.tiles)}write(a){if(256>this.id)a.rom.subarray(this.base,this.base+240).set(this.tiles);else for(let b=0;192>b;b++)a.rom[this.base+b]=this.tiles[b]}}var module$js$rom$screen={};module$js$rom$screen.Screen=Screen$$module$js$rom$screen;var Sage$$module$js$rom$telepathy;(function(a){a[a.TORNEL=0]="TORNEL";a[a.ZEBU=1]="ZEBU";a[a.ASINA=2]="ASINA";a[a.KENSU=3]="KENSU"})(Sage$$module$js$rom$telepathy||(Sage$$module$js$rom$telepathy={}));var DefaultMessage$$module$js$rom$telepathy;(function(a){a[a.INSUFFICIENT_MAGIC=0]="INSUFFICIENT_MAGIC";a[a.FREE_MAGIC=1]="FREE_MAGIC";a[a.IGNORED=2]="IGNORED";a[a.DEFAULT=3]="DEFAULT"})(DefaultMessage$$module$js$rom$telepathy||(DefaultMessage$$module$js$rom$telepathy={}));
const RESULT_TABLE$$module$js$rom$telepathy=115247,VANILLA_LEVELS_TABLE$$module$js$rom$telepathy=115219,VANILLA_LOCATION_TABLE$$module$js$rom$telepathy=121076,VANILLA_MAIN_TABLE$$module$js$rom$telepathy=121332,VANILLA_DEFAULTS_TABLE$$module$js$rom$telepathy=121388;
class Telepathy$$module$js$rom$telepathy{constructor(a){this.rom=a;this.sages=seq$$module$js$rom$util(4,(a)=>new SageData$$module$js$rom$telepathy(this,a));this.resultTable=tuple$$module$js$rom$util(a.prg,RESULT_TABLE$$module$js$rom$telepathy,64);a.telepathyTablesAddress?(this.groupsByLocation=[],this.minimumLevels=[]):(this.groupsByLocation=tuple$$module$js$rom$util(a.prg,VANILLA_LOCATION_TABLE$$module$js$rom$telepathy,256),this.minimumLevels=tuple$$module$js$rom$util(a.prg,VANILLA_LEVELS_TABLE$$module$js$rom$telepathy,
7))}write(a){let b=this.rom.telepathyTablesAddress;const c=[];if(b){write$$module$js$rom$util(a.rom,RESULT_TABLE$$module$js$rom$telepathy,this.resultTable.map((a)=>4>a?a:a>>>1));for(let f=0;4>f;f++){var d=this.sages[f];for(var e=1;4>e;e++)write$$module$js$rom$util(a.rom,b+8*e+2*f,this.sages[f].defaultMessages[e].data);c.push(a.write(d.messageGroups[0].bytes(),114688,122880,`Sage ${f}`).then((c)=>writeLittleEndian$$module$js$rom$util(a.rom,b+2*f,c-81920)))}}else for(write$$module$js$rom$util(a.rom,
RESULT_TABLE$$module$js$rom$telepathy,this.resultTable),write$$module$js$rom$util(a.rom,VANILLA_LEVELS_TABLE$$module$js$rom$telepathy,this.minimumLevels),write$$module$js$rom$util(a.rom,VANILLA_LOCATION_TABLE$$module$js$rom$telepathy,this.groupsByLocation),d=0;4>d;d++){e=this.sages[d];b=VANILLA_DEFAULTS_TABLE$$module$js$rom$telepathy+2*d;for(let c=0;4>c;c++)write$$module$js$rom$util(a.rom,b+8*c,e.defaultMessages[c].data);b=VANILLA_MAIN_TABLE$$module$js$rom$telepathy+2*d;for(let f=0,g=e.messageGroups.length;f<
g;f++)c.push(a.write(e.messageGroups[f].bytes(),114688,122880,`Sage ${d}`).then((c)=>writeLittleEndian$$module$js$rom$util(a.rom,b+8*f,c-81920)))}return Promise.all(c).then(()=>{})}}
class SageData$$module$js$rom$telepathy{constructor(a,b){this.telepathy=a;this.sage=b;const c=a.rom;let d,e;c.telepathyTablesAddress?(e=d=c.telepathyTablesAddress+2*b,a=1):(d=VANILLA_DEFAULTS_TABLE$$module$js$rom$telepathy+2*b,e=VANILLA_MAIN_TABLE$$module$js$rom$telepathy+2*b,a=7);this.defaultMessages=seq$$module$js$rom$util(4,(a)=>MessageId$$module$js$rom$messageid.from(c.prg,d+8*a));this.messageGroups=seq$$module$js$rom$util(a,(a)=>TelepathyMessageGroup$$module$js$rom$telepathy.from(c.prg,e+8*a))}}
class TelepathyMessageGroup$$module$js$rom$telepathy{constructor(a){this.messages=a}bytes(){const a=[];for(let b=0,c=this.messages.length;b<c;b++){const [d,e,f]=this.messages[b];let g=0<=d?d:8192|~d;b===c-1&&(g|=32768);f&&(g|=16384);a.push(g>>=8,g&255,...e.data,...f?f.data:[])}return a}static from(a,b){const c=new TelepathyMessageGroup$$module$js$rom$telepathy([]);b=readLittleEndian$$module$js$rom$util(a,b)+81920;let d=0;for(;!(d&32768);){d=readBigEndian$$module$js$rom$util(a,b);b+=2;var e=d&8191;
d&8192&&(e=~e);e=[e,MessageId$$module$js$rom$messageid.from(a,b)];b+=2;d&16384&&(e.push(MessageId$$module$js$rom$messageid.from(a,b)),b+=2);c.messages.push(e)}return c}}var module$js$rom$telepathy={};module$js$rom$telepathy.Sage=Sage$$module$js$rom$telepathy;module$js$rom$telepathy.DefaultMessage=DefaultMessage$$module$js$rom$telepathy;module$js$rom$telepathy.Telepathy=Telepathy$$module$js$rom$telepathy;module$js$rom$telepathy.SageData=SageData$$module$js$rom$telepathy;
module$js$rom$telepathy.TelepathyMessageGroup=TelepathyMessageGroup$$module$js$rom$telepathy;class TileAnimation$$module$js$rom$tileanimation extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.base=255865+(b<<3);this.pages=tuple$$module$js$rom$util(a.prg,this.base,8)}}var module$js$rom$tileanimation={};module$js$rom$tileanimation.TileAnimation=TileAnimation$$module$js$rom$tileanimation;const UNUSED_TRIGGERS$$module$js$rom$trigger=new Set([135,136,137,143,147,150,152,155,156,157,158,159,160,181,185,190,192]);
class Trigger$$module$js$rom$trigger extends Entity$$module$js$rom$entity{constructor(a,b){super(a,b);this.used=!UNUSED_TRIGGERS$$module$js$rom$trigger.has(b);this.pointer=123258+((b&127)<<1);this.base=addr$$module$js$rom$util(a.prg,this.pointer,81920);this.conditions=[];this.message=new MessageId$$module$js$rom$messageid;this.flags=[];let c=this.base;do{b=readBigEndian$$module$js$rom$util(a.prg,c);var d=b&4095;this.conditions.push(b&8192?~d:d);c+=2}while(!(b&32768));this.message=MessageId$$module$js$rom$messageid.from(a.prg,
c);do c+=2,b=readBigEndian$$module$js$rom$util(a.prg,c),d=b&4095,this.flags.push(b&32768?~d:d);while(!(b&16384))}bytes(){const a=[];this.conditions.length||this.conditions.push(-1);for(var b=0;b<this.conditions.length;b++){var c=this.conditions[b];0>c&&(c=~c|8192);b===this.conditions.length-1&&(c|=32768);a.push(c>>>8,c&255)}a.push(...this.message.data);this.flags.length||this.flags.push(-1);for(b=0;b<this.flags.length;b++)c=this.flags[b],0>c&&(c=~c|32768),b===this.flags.length-1&&(c|=16384),a.push(c>>>
8,c&255);return a}write(a,b){b=void 0===b?123258:b;const c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(c.used){var d=yield a.write(c.bytes(),122880,131071,`Trigger ${hex$$module$js$rom$util(c.id)}`);a.rom[b+2*(c.id&127)]=d&255;a.rom[b+2*(c.id&127)+1]=(d>>>8)-64}})}}var module$js$rom$trigger={};module$js$rom$trigger.Trigger=Trigger$$module$js$rom$trigger;class WildWarp$$module$js$rom$wildwarp{constructor(a){this.rom=a;this.locations=tuple$$module$js$rom$util(a.prg,ADDRESS$$module$js$rom$wildwarp,COUNT$$module$js$rom$wildwarp)}write(a){a.rom.subarray(ADDRESS$$module$js$rom$wildwarp,ADDRESS$$module$js$rom$wildwarp+COUNT$$module$js$rom$wildwarp).set(this.locations)}}const ADDRESS$$module$js$rom$wildwarp=248812,COUNT$$module$js$rom$wildwarp=16;var module$js$rom$wildwarp={};module$js$rom$wildwarp.WildWarp=WildWarp$$module$js$rom$wildwarp;function page$$module$js$rom$writer(a){return a>>>13}class Chunk$$module$js$rom$writer{constructor(a,b){this.start=a;this.end=b;this.page=page$$module$js$rom$writer(a);if(page$$module$js$rom$writer(b-1)!==this.page)throw Error("Chunk spans pages");this.pos=a}free(){return this.end-this.pos}find(a,b){for(let c=this.start;c<=this.pos-a.length;c++){let d=!0;for(let e=0;e<a.length;e++)if(b[c+e]!==a[e]){d=!1;break}if(d)return c}return-1}}
class Writer$$module$js$rom$writer{constructor(a,b){this.rom=a;this.chr=b;this.chunks=[];this.writes=[];this.promises=[];this.free=[]}alloc(a,b){for(;page$$module$js$rom$writer(b-1)>page$$module$js$rom$writer(a);){const b=page$$module$js$rom$writer(a)+1<<13;this.addChunk(new Chunk$$module$js$rom$writer(a,b-1));a=b}this.addChunk(new Chunk$$module$js$rom$writer(a,b))}addChunk(a){this.chunks.push(a);this.free[a.page]=(this.free[a.page]||0)+a.free()}write(a,b,c,d){const e=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const f=
page$$module$js$rom$writer(b),g=page$$module$js$rom$writer(c-1),h=new Promise((b,c)=>{e.writes.push({data:a,resolve:b,reject:c,startPage:f,endPage:g,name:d})});e.promises.push(h.catch(()=>{}));return h})}commit(){const a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){for(;a.writes.length;){var b=a.writes;a.writes=[];const c=a.promises;a.promises=[];b.sort((a,b)=>a.endPage-a.startPage-(b.endPage-b.startPage)||b.data.length-a.data.length);for(const c of b)b=a.find(c),0<=b?c.resolve(b):
a.writeOne(c);yield Promise.all(c);yield 0;yield 0;yield 0}})}find(a){var {data:b,startPage:c,endPage:d}=a;for(const e of this.chunks)if(!(e.page<c||e.page>d)&&(a=e.find(b,this.rom),0<=a))return a;return-1}writeOne(a){for(const b of this.chunks)if(!(b.page<a.startPage||b.page>a.endPage||b.free()<a.data.length)){this.rom.subarray(b.pos,b.pos+a.data.length).set(a.data);a.resolve(b.pos);this.free[b.page]-=a.data.length;b.pos+=a.data.length;return}console.log(`${a.name}: WRITE FAILED ${a.data.length} bytes: ${Array.from(a.data,
hex$$module$js$rom$util).join(" ")}`);a.reject(Error(`Could not find sufficient chunk in ${hex$$module$js$rom$util(a.startPage)}..${hex$$module$js$rom$util(a.endPage)} to write ${a.name}: ${a.data}`))}}var module$js$rom$writer={};module$js$rom$writer.Writer=Writer$$module$js$rom$writer;class Rom$$module$js$rom{constructor(a){const b=16+(a[6]&4?512:0),c=b+16384*a[4];this.prg=a.subarray(b,c);this.chr=a.subarray(c);this.shopCount=Rom$$module$js$rom.SHOP_COUNT.get(a);this.scalingLevels=Rom$$module$js$rom.SCALING_LEVELS.get(a);this.uniqueItemTableAddress=Rom$$module$js$rom.UNIQUE_ITEM_TABLE.get(a);this.shopDataTablesAddress=Rom$$module$js$rom.SHOP_DATA_TABLES.get(a);this.telepathyTablesAddress=Rom$$module$js$rom.TELEPATHY_TABLES.get(a);this.omitItemGetDataSuffix=Rom$$module$js$rom.OMIT_ITEM_GET_DATA_SUFFIX.get(a);
this.omitLocalDialogSuffix=Rom$$module$js$rom.OMIT_LOCAL_DIALOG_SUFFIX.get(a);this.compressedMapData=Rom$$module$js$rom.COMPRESSED_MAPDATA.get(a);for(const a of ADJUSTMENTS$$module$js$rom){const [b,c,d]=a;this.prg[b]===c&&(this.prg[b]=d)}this.screens=seq$$module$js$rom$util(259,(a)=>new Screen$$module$js$rom$screen(this,a));this.tilesets=seq$$module$js$rom$util(12,(a)=>new Tileset$$module$js$rom$tileset(this,a<<2|128));this.tileEffects=seq$$module$js$rom$util(11,(a)=>new TileEffects$$module$js$rom$tileeffects(this,
a+179));this.triggers=seq$$module$js$rom$util(67,(a)=>new Trigger$$module$js$rom$trigger(this,128|a));this.patterns=seq$$module$js$rom$util(this.chr.length>>4,(a)=>new Pattern$$module$js$rom$pattern(this,a));this.palettes=seq$$module$js$rom$util(256,(a)=>new Palette$$module$js$rom$palette(this,a));this.locations=new LocationsClass$$module$js$rom$locations(this);this.tileAnimations=seq$$module$js$rom$util(4,(a)=>new TileAnimation$$module$js$rom$tileanimation(this,a));this.hitboxes=seq$$module$js$rom$util(24,
(a)=>new Hitbox$$module$js$rom$hitbox(this,a));this.objects=new ObjectsClass$$module$js$rom$objects(this);this.adHocSpawns=seq$$module$js$rom$util(96,(a)=>new AdHocSpawn$$module$js$rom$adhocspawn(this,a));this.metasprites=seq$$module$js$rom$util(256,(a)=>new Metasprite$$module$js$rom$metasprite(this,a));this.messages=new Messages$$module$js$rom$messages(this);this.telepathy=new Telepathy$$module$js$rom$telepathy(this);this.itemGets=seq$$module$js$rom$util(113,(a)=>new ItemGet$$module$js$rom$itemget(this,
a));this.items=seq$$module$js$rom$util(73,(a)=>new Item$$module$js$rom$item(this,a));this.shops=seq$$module$js$rom$util(44,(a)=>new Shop$$module$js$rom$shop(this,a));this.npcs=seq$$module$js$rom$util(205,(a)=>new Npc$$module$js$rom$npc(this,a));this.bossKills=seq$$module$js$rom$util(14,(a)=>new BossKill$$module$js$rom$bosskill(this,a));this.bosses=new Bosses$$module$js$rom$bosses(this);this.wildWarp=new WildWarp$$module$js$rom$wildwarp(this)}trigger(a){if(128>a||255<a)throw Error(`Bad trigger id $${hex$$module$js$rom$util(a)}`);
return this.triggers[a&127]}tileset(a){if(128>a||172<a||a&3)throw Error(`Bad tileset id $${hex$$module$js$rom$util(a)}`);return this.tilesets[(a&127)>>>2]}get projectiles(){const a=new Set;for(const b of this.objects.filter((a)=>a instanceof Monster$$module$js$rom$monster))b.child&&a.add(this.objects[this.adHocSpawns[b.child].objectId]);return[...a].sort((a,c)=>a.id-c.id)}get monsterGraphics(){const a={};for(const b of this.locations)if(b.used&&b.hasSpawns)for(const c of b.spawns)if(!(c.data[2]&7)){const d=
c.data[2]&128?1:0,e=hex$$module$js$rom$util(c.data[3]+80);(a[e]=a[e]||{})[`${d}:${b.spritePatterns[d].toString(16)}:${b.spritePalettes[d].toString(16)}`]={pal:b.spritePalettes[d],pat:b.spritePatterns[d],slot:d}}return a}get locationMonsters(){const a={};for(const b of this.locations){if(!b.used||!b.hasSpawns)continue;const c=a["$"+hex$$module$js$rom$util(b.id)]={};for(const a of b.spawns)if(!(a.data[2]&7)){const b=a.data[2]&128?1:0,d=a.data[3]+80;c[`${b}:${d.toString(16)}`]=(c[`${b}:${d.toString(16)}`]||
0)+1}}return a}writeData(){const a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){Rom$$module$js$rom.SHOP_COUNT.set(a.prg,a.shopCount);Rom$$module$js$rom.SCALING_LEVELS.set(a.prg,a.scalingLevels);Rom$$module$js$rom.UNIQUE_ITEM_TABLE.set(a.prg,a.uniqueItemTableAddress);Rom$$module$js$rom.SHOP_DATA_TABLES.set(a.prg,a.shopDataTablesAddress);Rom$$module$js$rom.OMIT_ITEM_GET_DATA_SUFFIX.set(a.prg,a.omitItemGetDataSuffix);Rom$$module$js$rom.OMIT_LOCAL_DIALOG_SUFFIX.set(a.prg,a.omitLocalDialogSuffix);
Rom$$module$js$rom.COMPRESSED_MAPDATA.set(a.prg,a.compressedMapData);const b=new Writer$$module$js$rom$writer(a.prg,a.chr);b.alloc(83192,97792);b.alloc(103417,109568);b.alloc(110080,113920);b.alloc(116602,117085);b.alloc(117477,121076);b.alloc(122342,122981);b.alloc(123392,123840);b.alloc(135450,136296);b.alloc(172032,195584);a.telepathyTablesAddress?b.alloc(121076,121600):b.alloc(121420,121600);const c=[],d=(a)=>{for(const d of a)c.push(d.write(b))};d(a.locations);d(a.objects);d(a.hitboxes);d(a.triggers);
d(a.npcs);d(a.tilesets);d(a.tileEffects);d(a.screens);d(a.adHocSpawns);d(a.itemGets);d(a.items);d(a.shops);d(a.bossKills);d(a.patterns);a.wildWarp.write(b);c.push(a.telepathy.write(b));c.push(a.messages.write(b));c.push(b.commit());yield Promise.all(c).then(()=>{})})}analyzeTiles(){}disjointTilesets(){var a=[];for(var b of this.locations){if(!b.used)continue;var c=b.tileset;const d=b.extended?256:0;for(const e of b.screens)for(const b of e)(a[b+d]||(a[b+d]=new Set)).add(c)}b=seq$$module$js$rom$util(256,
()=>new UnionFind$$module$js$unionfind);for(c=0;c<a.length;c++)if(a[c])for(var d of this.screens[c].allTilesSet())b[d].union([...a[c]]);for(a=0;a<b.length;a++)d=b[a].sets().map((a)=>[...a].map(hex$$module$js$rom$util).join(" ")).join(" | "),console.log(`Tile ${hex$$module$js$rom$util(a)}: ${d}`)}swapMetatiles(a,...b){var c=new Map,d=seq$$module$js$rom$util(256);const e=new Map,f=(a)=>Array.isArray(a)?a[0]:0>a?~a:a;for(var g of b){for(var h=0;h<g.length-1;h++)if(Array.isArray(g[h])){var k=g[h];e.set(k[0],
k[1]);g[h]=k[0]}for(h=0;h<g.length-1;h++){k=g[h];const a=g[h+1];0>k||0>a||(c.set(a,k),d[a]=k)}}g=new Set;c=new Set;a=new Set(a);for(var l of this.locations)if(l.used&&a.has(l.tileset)){c.add(l.tileEffects);for(var m of l.allScreens())g.add(m)}for(var n of g)for(let a=0,b=n.tiles.length;a<b;a++)n.tiles[a]=d[n.tiles[a]];for(var p of a){d=this.tilesets[(p&127)>>>2];for(var q of b)for(l=0;l<q.length-1;l++){m=f(q[l]);n=f(q[l+1]);for(a=0;4>a;a++)d.tiles[a][m]=d.tiles[a][n];d.attrs[m]=d.attrs[n];if(32>n&&
d.alternates[n]!==n){if(32<=m)throw Error(`Cannot unflag: ${p} ${m} ${n} ${d.alternates[n]}`);d.alternates[m]=d.alternates[n]}}for(var r of e){const [a,b]=r;d.alternates[a]=b}}for(const a of c){p=this.tileEffects[a-179];for(const a of b)for(q=0;q<a.length-1;q++)r=f(a[q]),d=f(a[q+1]),p.effects[r]=p.effects[d];for(const a of e.keys())p.effects[a]|=8}}static load(a,b){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const c=yield pickFile$$module$js$rom(b);a&&(yield a(c));return new Rom$$module$js$rom(c)})}}
Rom$$module$js$rom.OMIT_ITEM_GET_DATA_SUFFIX=module$js$rom$option.RomOption.bit(82624,0);Rom$$module$js$rom.OMIT_LOCAL_DIALOG_SUFFIX=module$js$rom$option.RomOption.bit(82624,1);Rom$$module$js$rom.COMPRESSED_MAPDATA=module$js$rom$option.RomOption.bit(82624,2);Rom$$module$js$rom.SHOP_COUNT=module$js$rom$option.RomOption.byte(82625);Rom$$module$js$rom.SCALING_LEVELS=module$js$rom$option.RomOption.byte(82626);Rom$$module$js$rom.UNIQUE_ITEM_TABLE=module$js$rom$option.RomOption.address(82640);
Rom$$module$js$rom.SHOP_DATA_TABLES=module$js$rom$option.RomOption.address(82643);Rom$$module$js$rom.TELEPATHY_TABLES=module$js$rom$option.RomOption.address(82646);
function pickFile$$module$js$rom(a){a||(a=(a)=>document.body.appendChild(a));return new Promise((a)=>{if("#reset"!==window.location.hash){const b=localStorage.getItem("rom");if(b)return a(Uint8Array.from(Array(b.length/2).fill(0).map((a,c)=>Number.parseInt(b[2*c]+b[2*c+1],16))))}const b=document.createElement("input");document.body.appendChild(b);b.type="file";b.addEventListener("change",()=>{const c=b.files[0],e=new FileReader;e.addEventListener("loadend",()=>{const c=new Uint8Array(e.result),d=
Array.from(c,hex$$module$js$rom$util).join("");localStorage.setItem("rom",d);b.remove();a(c)});e.readAsArrayBuffer(c)})})}const EXPECTED_CRC32$$module$js$rom=466849842,ADJUSTMENTS$$module$js$rom=[[79430,2,6],[83306,0,255],[84715,9,255],[85433,8,128],[87133,255,0],[89007,240,128],[89014,223,128],[89015,150,128],[91391,11,10],[96298,16,1],[96343,16,1],[106242,64,128],[106243,51,50],[118533,71,72],[119569,32,160],[119570,48,0],[118777,96,224],[182928,2,0],[193907,2,0],[195300,95,0]];
var module$js$rom={};module$js$rom.Rom=Rom$$module$js$rom;module$js$rom.EXPECTED_CRC32=EXPECTED_CRC32$$module$js$rom;class ChestSlot$$module$js$rom$slots{constructor(a,b,c){this.slot=a;this.location=b;this.spawn=c}set(a,b){const c=a.locations[this.location].spawns[this.spawn];c.id=b;112<=b&&(c.patternBank=1);a.spoiler&&a.spoiler.addSlot(this.slot,`Chest in ${a.locations[this.location].name}`,b)}}class HardcodedSlot$$module$js$rom$slots{constructor(a,b,c){this.slot=a;this.address=b;this.name=c}set(a,b){a.prg[this.address]=b;this.name&&a.spoiler&&a.spoiler.addSlot(this.slot,this.name||"",b)}}
class BossDropSlot$$module$js$rom$slots{constructor(a,b){this.slot=a;this.boss=b}set(a,b){if(112<=b)throw Error("no mimics on bosses");a.bossKills[this.boss].itemDrop=b;a.spoiler&&a.spoiler.addSlot(this.slot,a.bosses.fromBossKill(this.boss).name,b)}}
class PersonDataSlot$$module$js$rom$slots{constructor(a,b,c){this.slot=a;this.person=b;this.index=c}set(a,b){if(112<=b)throw Error("no mimics on people");a.npcs[this.person].data[this.index]=b;if(a.spoiler){var c=a.npcs[this.person];let d=c&&c.name;c&&c.itemNames&&(d=(c=c.itemNames[this.index])?d+" "+c:void 0);a.spoiler.addSlot(this.slot,d||"",b)}}}
class Slots$$module$js$rom$slots{constructor(a){function b(a){c[a.slot].push(a)}this.rom=a;const c=seq$$module$js$rom$util(128,()=>[]);for(const c of a.locations)if(c.used)for(let a=0;a<c.spawns.length;a++){const d=c.spawns[a];d.isChest()&&b(new ChestSlot$$module$js$rom$slots(d.id,c.id,a))}for(const c of a.npcs)if(c.used&&c.hasDialog)for(const a of c.localDialogs.values())for(const d of a)switch(d.message.action){case 3:b(new PersonDataSlot$$module$js$rom$slots(c.data[0],c.id,0));break;case 9:case 17:b(new PersonDataSlot$$module$js$rom$slots(c.data[1],
c.id,1))}for(const c of a.bosses)3!==c.kill&&13!==c.kill&&null!=c.kill&&null!=c.drop&&b(new BossDropSlot$$module$js$rom$slots(c.drop,c.kill));for(const [a,c]of hardcodedItems$$module$js$rom$slots)b(new HardcodedSlot$$module$js$rom$slots(this.rom.prg[a],a,c));extraSlots$$module$js$rom$slots.forEach(b);this.slots=c}update(a){for(var b=0;b<a.length;b++)if(null!=a[b])for(var c of this.slots[b])c.set(this.rom,a[b]);b=this.rom.itemGets.map(()=>[]);for(const d of this.rom.itemGets){({id:c}=d);for(const e of d.flags){if(-1===
e)continue;const d=preservedItemGetFlags$$module$js$rom$slots.has(e)?c:a[c];(b[d]||[]).push(e)}}for(const a of this.rom.itemGets)a.flags=b[a.id]}}
const hardcodedItems$$module$js$rom$slots=[[223220,"Stom fight"],[250255,"Slimed Kensu"],[250361,"Asina"],[250543,"Stoned Akahana"],[250638,"Lighthouse Kensu"],[250679,"Rage"],[251477,"Mt Sabre summit trigger"],[251609,"Whirlpool trigger"],[251614,"Swan Kensu"],[251624,"Aryllis"],[251665],[251902,"Akahana statue trade-in"]],extraSlots$$module$js$rom$slots=[new PersonDataSlot$$module$js$rom$slots(54,99,1)];function update$$module$js$rom$slots(a,b){(new Slots$$module$js$rom$slots(a)).update(b)}
const preservedItemGetFlags$$module$js$rom$slots=new Set([36,139,765]);var module$js$rom$slots={};module$js$rom$slots.update=update$$module$js$rom$slots;class Spoiler$$module$js$rom$spoiler{constructor(a){this.rom=a;this.slots=[];this.route=[];this.mazes=[];this.trades=[];this.walls=[];this.unidentifiedItems=[];this.wildWarps=[];this.slotNames=[];this.conditionNames={}}addCondition(a,b){this.conditionNames[a]=b}addCheck(a,b,c){this.route.push(new Check$$module$js$rom$spoiler(this,a,b,c))}addSlot(a,b,c){this.slots[a]=new Slot$$module$js$rom$spoiler(this.rom,a,b,c);b&&(this.slotNames[512|a]=b)}addMaze(a,b,c){this.mazes.push({id:a,name:b,maze:c})}addTrade(a,
b,c){this.trades.push({itemId:a,item:b,npc:c})}addUnidentifiedItem(a,b,c){this.unidentifiedItems.push({itemId:a,oldName:b,newName:c})}addWall(a,b,c){this.walls.push({location:a,oldElement:b,newElement:c})}addWildWarp(a,b){this.wildWarps.push({id:a,name:b})}formatCondition(a,b){return 512>a||640<=a?this.conditionNames[a]||conditionHex$$module$js$rom$spoiler(a):null==b?slotToItem$$module$js$rom$spoiler(this.rom,a&255):`${this.slotNames[a]||conditionHex$$module$js$rom$spoiler(a)} (${this.formatCondition(b|
512)})`}}class Check$$module$js$rom$spoiler{constructor(a,b,c,d){this.spoiler=a;this.condition=b;this.deps=c;this.item=d}toString(){return`${this.spoiler.formatCondition(this.condition,this.item)}: [${this.deps.map((a)=>this.spoiler.formatCondition(a)).join(", ")}]`}}function conditionHex$$module$js$rom$spoiler(a){return 0>a?"~"+~a.toString(16).padStart(2,"0"):a.toString(16).padStart(3,"0")}
class Slot$$module$js$rom$spoiler{constructor(a,b,c,d){this.slot=b;this.slotName=c;this.item=d;this.itemName=slotToItem$$module$js$rom$spoiler(a,d);this.originalItem=slotToItem$$module$js$rom$spoiler(a,b)}toString(){return`${this.itemName}: ${this.slotName} (${this.originalItem})`}}function slotToItem$$module$js$rom$spoiler(a,b){return 112<=b?"Mimic":a.items[a.itemGets[b].itemId].messageName}var module$js$rom$spoiler={};module$js$rom$spoiler.Spoiler=Spoiler$$module$js$rom$spoiler;const version$$module$js$version="object"===typeof __VERSION__?__VERSION__:{},STATUS$$module$js$version=version$$module$js$version.STATUS||"unstable",VERSION$$module$js$version=version$$module$js$version.VERSION||"HEAD",LABEL$$module$js$version=version$$module$js$version.LABEL||"HEAD",HASH$$module$js$version=version$$module$js$version.HASH||"HEAD",DATE$$module$js$version=version$$module$js$version.DATE||new Date;var module$js$version={};module$js$version.STATUS=STATUS$$module$js$version;
module$js$version.VERSION=VERSION$$module$js$version;module$js$version.LABEL=LABEL$$module$js$version;module$js$version.HASH=HASH$$module$js$version;module$js$version.DATE=DATE$$module$js$version;class Graphics$$module$js$rom$graphics{constructor(a){this.rom=a;this.monsterConstraints=new Map;this.npcConstraints=new Map;this.allSpritePalettes=new Set;var b=new DefaultMap$$module$js$util(()=>[]);for(var c of a.locations)if(c.used)for(var d=0;d<c.spawns.length;d++){const a=c.spawns[d];a.used&&(a.isMonster()?b.get(a.monsterId).push([c,d,a]):(a.isNpc()||a.isBoss())&&b.get(~a.id).push([c,d,a]))}for(const [e,f]of b)if(0>e){b=a.npcs[~e];c=[b.data[3]];if(!a.metasprites[c[0]])throw Error(`bad NPC: ${~e}`);
208===b.data[2]&&c.push(192);b=this.computeConstraint(c,f,!0,128>b.data[2]?b.data[2]&112:0);95===~e&&(b=b.ignorePalette());this.npcConstraints.set(~e,b)}else{b=Constraint$$module$js$rom$constraint.ALL;c=this.rom.objects[e];if(!(c instanceof Monster$$module$js$rom$monster))throw Error(`expected monster: ${c} from ${f}`);for(const g of allObjects$$module$js$rom$graphics(a,c)){d=ACTION_SCRIPTS$$module$js$rom$monster.get(g.action);d=this.computeConstraint((d&&d.metasprites||(()=>[g.metasprite]))(g),f,
g.id===e,g.data[1]);d=b.meet(d);if(!d)throw Error(`Bad meet for ${e} with ${g.id}`);d&&(b=d)}this.monsterConstraints.set(c.id,b);c.constraint=b}}getMonsterConstraint(a,b){const c=this.monsterConstraints.get(b)||Constraint$$module$js$rom$constraint.NONE;return 88!==(a&88)&&this.rom.objects[b].goldDrop?c.meet(Constraint$$module$js$rom$constraint.COIN)||Constraint$$module$js$rom$constraint.NONE:c}getNpcConstraint(a,b){const c=this.npcConstraints.get(b)||Constraint$$module$js$rom$constraint.NONE;return 30===
a&&96===b?c.meet(Constraint$$module$js$rom$constraint.STOM_FIGHT):160===a&&201===b?c.meet(Constraint$$module$js$rom$constraint.GUARDIAN_STATUE):c}shufflePalettes(a){const b=[...this.allSpritePalettes];for(const [c,d]of this.monsterConstraints)this.monsterConstraints.set(c,d.shufflePalette(a,b));for(const [c,d]of this.npcConstraints)this.npcConstraints.set(c,d.shufflePalette(a,b))}configure(a,b){if(b.used){var c=b.isMonster()?this.monsterConstraints.get(b.monsterId):b.isNpc()?this.npcConstraints.get(b.id):
b.isChest()?112>b.id?Constraint$$module$js$rom$constraint.TREASURE_CHEST:Constraint$$module$js$rom$constraint.MIMIC:void 0;if(c){if(3===c.shift||2<=c.float.length)throw Error("don't know what to do with two floats");if(!c.float.length)b.patternBank=Number(2===c.shift);else if(c.float[0].has(a.spritePatterns[0]))b.patternBank=0;else if(c.float[0].has(a.spritePatterns[1]))b.patternBank=1;else if(b.isMonster())throw Error("no matching pattern bank");}}}computeConstraint(a,b,c,d=0){const e=new Set,f=
new Set;for(const b of a.map((a)=>this.rom.metasprites[a])){for(const a of b.palettes())f.add(a);for(const a of b.patternBanks(d))e.add(a)}c=c&&1==e.size&&2===[...e][0];a=new Map;for(const [d,,e]of b)a.set(e.patternBank&&c?~d.id:d.id,e);b=void 0;for(let [d,h]of a){a=this.rom.locations[0>d?~d:d];for(const b of f)1<b&&this.allSpritePalettes.add(a.spritePalettes[b-2]);a=Constraint$$module$js$rom$constraint.fromSpawn(f,e,a,h,c);b=b?b.join(a):a;!c&&h.patternBank&&(b=b.shifted())}if(!b)throw Error("Expected child to appear");
return b}}function*allObjects$$module$js$rom$graphics(a,b){yield b;var c=b.spawnedReplacement();c&&(yield*allObjects$$module$js$rom$graphics(a,c));(c=b.spawnedChild())&&(yield*allObjects$$module$js$rom$graphics(a,c));80===b.id&&(yield a.objects[95]);83===b.id&&(yield a.objects[105])}var module$js$rom$graphics={};module$js$rom$graphics.Graphics=Graphics$$module$js$rom$graphics;var $jscompDefaultExport$$module$js$patch={apply(a,b,c){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let d;b.seed||(b.seed=parseSeed$$module$js$patch("").toString(16),window.location.hash+="&seed="+b.seed);d=b.flags?new FlagSet$$module$js$flagset(String(b.flags)):new FlagSet$$module$js$flagset("@FullShuffle");for(const a in b)"false"===b[a]&&(b[a]=!1);yield shuffle$$module$js$patch(a,parseSeed$$module$js$patch(String(b.seed)),d,new FetchReader$$module$js$fetchreader(c))})}};
function parseSeed$$module$js$patch(a){return a?/^[0-9a-f]{1,8}$/i.test(a)?Number.parseInt(a,16):crc32$$module$js$crc32(a):Random$$module$js$random.newSeed()}
function shuffle$$module$js$patch(a,b,c,d,e,f){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){function g(b){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){l.assemble(yield d.read(b),b);l.patchRom(a)})}if("number"!==typeof b)throw Error("Bad seed");var h=crc32$$module$js$crc32(b.toString(16).padStart(8,"0")+String(c))>>>0;const k={_ALLOW_TELEPORT_OUT_OF_BOSS:c.hardcoreMode()&&c.shuffleBossElements(),_ALLOW_TELEPORT_OUT_OF_TOWER:!0,_AUTO_EQUIP_BRACELET:c.autoEquipBracelet(),
_BARRIER_REQUIRES_CALM_SEA:c.barrierRequiresCalmSea(),_BUFF_DEOS_PENDANT:c.buffDeosPendant(),_BUFF_DYNA:c.buffDyna(),_CHECK_FLAG0:!0,_CTRL1_SHORTCUTS:!0,_CUSTOM_SHOOTING_WALLS:!0,_DEBUG_DIALOG:6076===b,_DISABLE_SHOP_GLITCH:c.disableShopGlitch(),_DISABLE_STATUE_GLITCH:c.disableStatueGlitch(),_DISABLE_SWORD_CHARGE_GLITCH:c.disableSwordChargeGlitch(),_DISABLE_TRIGGER_SKIP:!0,_DISABLE_WILD_WARP:!1,_DISPLAY_DIFFICULTY:!0,_EXTRA_PITY_MP:!0,_FIX_COIN_SPRITES:!0,_FIX_OPEL_STATUE:!0,_FIX_SHAKING:!0,_FIX_VAMPIRE:!0,
_HARDCORE_MODE:c.hardcoreMode(),_LEATHER_BOOTS_GIVE_SPEED:c.leatherBootsGiveSpeed(),_NERF_FLIGHT:!0,_NERF_WILD_WARP:c.nerfWildWarp(),_NEVER_DIE:c.neverDie(),_NORMALIZE_SHOP_PRICES:!0,_PITY_HP_AND_MP:!0,_PROGRESSIVE_BRACELET:!0,_RABBIT_BOOTS_CHARGE_WHILE_WALKING:c.rabbitBootsChargeWhileWalking(),_REQUIRE_HEALED_DOLPHIN_TO_RIDE:c.requireHealedDolphinToRide(),_REVERSIBLE_SWAN_GATE:!0,_SAHARA_RABBITS_REQUIRE_TELEPATHY:c.saharaRabbitsRequireTelepathy(),_SIMPLIFY_INVISIBLE_CHESTS:!0,_TELEPORT_ON_THUNDER_SWORD:c.teleportOnThunderSword(),
_UNIDENTIFIED_ITEMS:c.unidentifiedItems()},l=new Assembler$$module$js$6502;var m=Object.keys(k).filter((a)=>k[a]).map((a)=>`define ${a} 1\n`).join("");l.assemble(m,"flags.s");yield g("preshuffle.s");h=new Random$$module$js$random(h);m=new Rom$$module$js$rom(a);"object"==typeof window&&(window.rom=m);m.spoiler=new Spoiler$$module$js$rom$spoiler(m);e&&(e.spoiler=m.spoiler);deterministic$$module$js$pass$deterministic(m,c);yield g("postparse.s");m.scalingLevels=48;m.uniqueItemTableAddress=l.expand("KeyItemData");
c.shuffleShops()&&shuffleShops$$module$js$patch(m,c,h);randomizeWalls$$module$js$patch(m,c,h);c.randomizeWildWarp()&&shuffleWildWarp$$module$js$patch(m,c,h);rescaleMonsters$$module$js$patch(m,c,h);unidentifiedItems$$module$js$pass$unidentifieditems(m,c,h);shuffleTrades$$module$js$pass$shuffletrades(m,c,h);c.randomizeMaps()&&shuffleMazes$$module$js$pass$shufflemazes(m,h);const n=World$$module$js$graph$world.build(m,c),p=yield(new AssumedFill$$module$js$graph$shuffle(m,c)).shuffle(n.graph,h,f);if(p)n.traverse(n.graph,
p),update$$module$js$rom$slots(m,p.slots);else return-1;rescaleShops$$module$js$patch(m,l,c.bargainHunting()?h:void 0);normalizeSwords$$module$js$patch(m,c,h);c.shuffleMonsters()&&shuffleMonsters$$module$js$patch(m,c,h);identifyKeyItemsForDifficultyBuffs$$module$js$patch(m);c.doubleBuffMedicalHerb()?(a[115996]*=2,a[115962]*=3):c.buffMedicalHerb()&&(a[115996]+=16,a[115962]*=2);c.storyMode()&&storyMode$$module$js$patch(m);shuffleMusic$$module$js$patch(m,c,h);shufflePalettes$$module$js$pass$shufflepalettes(m,
c,h);c.blackoutMode()&&blackoutMode$$module$js$patch(m);misc$$module$js$patch(m,c,h);fixDialog$$module$js$pass$fixdialog(m);c.buffDyna()&&buffDyna$$module$js$patch(m,c);yield m.writeData();buffDyna$$module$js$patch(m,c);return yield postParsedShuffle$$module$js$patch(a,h,b,c,l,g)})}
function postParsedShuffle$$module$js$patch(a,b,c,d,e,f){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){yield f("postshuffle.s");updateDifficultyScalingTables$$module$js$patch(a,d,e);updateCoinDrops$$module$js$patch(a,d);shuffleRandomNumbers$$module$js$patch(a,b);return stampVersionSeedAndHash$$module$js$patch(a,c,d)})}
function misc$$module$js$patch(a,b,c){a.messages.parts[2][2].text="\n{01:Akahana} is handed a statue.#\nThanks for finding that.\nI was totally gonna sell\nit for tons of cash.#\nHere, have this lame\n[29:Gas Mask] or something.";a.messages.parts[0][14].text="It's dangerous to go alone! Take this.";a.messages.parts[0][14].fixText()}
function shuffleShops$$module$js$patch(a,b,c){b={[module$js$rom$shop.ShopType.ARMOR]:{contents:[],shops:[]},[module$js$rom$shop.ShopType.TOOL]:{contents:[],shops:[]}};for(var d of a.shops)d.used&&255!==d.location&&(a=b[d.type])&&(a.contents.push(...d.contents.filter((a)=>255!==a)),a.shops.push(d),d.contents=[]);for(const e of Object.values(b))for(d=null,a=[...e.contents],c.shuffle(a);a.length;){d&&d.length||(d&&a.shift(),d=[...e.shops,...e.shops,...e.shops,...e.shops],c.shuffle(d));const b=a[0],g=
d[0];4>g.contents.length&&!g.contents.includes(b)&&(g.contents.push(b),a.shift());d.shift()}for(const a of Object.values(b))for(const b of a.shops){for(;4>b.contents.length;)b.contents.push(255);b.contents.sort((a,b)=>a-b)}}
function randomizeWalls$$module$js$patch(a,b,c){if(b.randomizeWalls()){b=[[5,56],[17],[106],[20]];var d=a.locations.partition((a)=>a.tilePalettes.join(" "),void 0,!0);for(const f of d){var [e]=f;{d=c.nextInt(4);const f=c.pick(b[d]);let h=!1;for(const b of e)for(const g of b.spawns)if(g.isWall()&&(e=g.data[2]&32?g.id>>>4&3:g.id&3,2!==e))if(3===e){const d=c.nextInt(4);a.spoiler&&a.spoiler.addWall(b.name,e,d);g.data[2]|=32;g.id=48|d}else!h&&a.spoiler&&(a.spoiler.addWall(b.name,e,d),h=!0),g.data[2]|=
32,g.id=e<<4|d,b.tilePalettes[2]=f}}}}
function shuffleMusic$$module$js$patch(a,b,c){if(b.randomizeMusic()){class g{constructor(a){this.addr=a}get bgm(){return a.prg[this.addr]}set bgm(b){a.prg[this.addr]=b}partition(){return[[this],this.bgm]}}var d=a.locations.partition((a)=>95!==a.id?a.bgm:0).filter((a)=>a[1]);b=[];var e=[],f=[124088,124560,125339,126129,126479,126851,127367,127761,228400].map((a)=>(new g(a)).partition());for(const a of d){d=0;for(const b of a[0])for(const a of b.spawns)a.isMonster()&&d++;(d>=a[0].length?e:b).push(a)}(function(a){var b=
a.map((a)=>a[1]);b=[...new Set(b)];for(const d of a){[a]=d;{const d=b[c.nextInt(b.length)];for(const b of a)b.bgm=d}}})([...b,...e,...f])}}function shuffleWildWarp$$module$js$patch(a,b,c){b=[];for(const c of a.locations)c&&c.used&&c.id&&!c.extended&&88!==(c.id&248)&&b.push(c);c.shuffle(b);a.wildWarp.locations=[];for(const c of[...b.slice(0,15).sort((a,b)=>a.id-b.id)])a.wildWarp.locations.push(c.id),a.spoiler&&a.spoiler.addWildWarp(c.id,c.name);a.wildWarp.locations.push(0)}
function buffDyna$$module$js$patch(a,b){a.objects[184].collisionPlane=1;a.objects[184].immobile=!0;a.objects[185].collisionPlane=1;a.objects[185].immobile=!0;a.objects[51].collisionPlane=2;a.adHocSpawns[40].slotRangeLower=28;a.adHocSpawns[41].slotRangeUpper=28;a.adHocSpawns[42].slotRangeUpper=28}
function blackoutMode$$module$js$patch(a){var b=generate$$module$js$depgraph();for(const c of b.nodes)b=c.type,"Location"!==c.nodeType||"cave"!==b&&"fortress"!==b||a.locations[c.id].tilePalettes.fill(154)}
const storyMode$$module$js$patch=(a)=>{const b=[~a.npcs[194].spawnConditions.get(40)[0],~a.npcs[132].spawnConditions.get(110)[0],~a.trigger(154).conditions[1],~a.npcs[197].spawnConditions.get(169)[0],~a.npcs[198].spawnConditions.get(172)[0],~a.npcs[199].spawnConditions.get(185)[0],~a.npcs[200].spawnConditions.get(182)[0],~a.npcs[203].spawnConditions.get(159)[0],512,513,514,515];a.npcs[203].spawnConditions.get(166).push(...b)};
function stampVersionSeedAndHash$$module$js$patch(a,b,c){const d=crc32$$module$js$crc32(a),e=d.toString(16).padStart(8,"0").toUpperCase(),f="unstable"===STATUS$$module$js$version?HASH$$module$js$version.substring(0,7).padStart(7,"0").toUpperCase()+"     ":VERSION$$module$js$version.substring(0,12).padEnd(12," "),g=b.toString(16).padStart(8,"0").toUpperCase();b=(b,c)=>{for(let d=0;d<c.length;d++)a[b+16+d]=c.charCodeAt(d)};const h=(a,b)=>{const c=[];for(let d=0;d<a.length||d<b.length;d++)c.push(a[d]||
" "),c.push(b[d]||" ");return c.join("")};b(161743,h("  VERSION     SEED      ",`  ${f}${g}`));c=String(c);let k;if(46<c.length){if(92<c.length)throw Error("Flag string way too long!");k=c.substring(46,92).padEnd(46," ");c=c.substring(0,46)}c=c.padEnd(46," ");b(161791,h(c.substring(0,23),c.substring(23)));k&&b(161839,h(k.substring(0,23),k.substring(23)));b(161925,h(e.substring(0,4),e.substring(4)));b(153366,"RANDOMIZER");"unstable"===STATUS$$module$js$version&&b(153404,"BETA");return d}
const patchBytes$$module$js$patch=(a,b,c)=>{for(let d=0;d<c.length;d++)a[b+d]=c[d]},patchWords$$module$js$patch=(a,b,c)=>{for(let d=0;d<2*c.length;d+=2)a[b+d]=c[d>>>1]&255,a[b+d+1]=c[d>>>1]>>>8},updateCoinDrops$$module$js$patch=(a,b)=>{a=a.subarray(16);b.disableShopGlitch()?patchWords$$module$js$patch(a,216030,[0,5,10,15,25,40,65,105,170,275,445,600,700,800,900,1E3]):patchWords$$module$js$patch(a,216030,[0,1,2,4,8,16,30,50,100,200,300,400,500,600,700,800])},updateDifficultyScalingTables$$module$js$patch=
(a,b,c)=>{a=a.subarray(16);const d=seq$$module$js$rom$util(48,(a)=>a);patchBytes$$module$js$patch(a,c.expand("DiffAtk"),d.map((a)=>Math.round(40+15*a/4)));patchBytes$$module$js$patch(a,c.expand("DiffDef"),d.map((a)=>4*a));const e=b.decreaseEnemyDamage()?16:48,f=b.decreaseEnemyDamage()?6:5.5;patchBytes$$module$js$patch(a,c.expand("DiffHP"),d.map((a)=>Math.min(255,e+Math.round(a*f))));const g=b.expScalingFactor();patchBytes$$module$js$patch(a,c.expand("DiffExp"),d.map((a)=>{a=Math.floor(4*Math.pow(2,
(16+9*a)/32)*g);return 128>a?a:Math.min(255,128+(a>>4))}));patchBytes$$module$js$patch(a,216E3,[0,2,6,10,14,18,32,24,20,0,2,6,10,14,18,16,32,20])},rescaleShops$$module$js$patch=(a,b,c)=>{a.shopCount=11;a.shopDataTablesAddress=b.expand("ShopData");writeLittleEndian$$module$js$rom$util(a.prg,b.expand("InnBasePrice"),20);for(const b of a.shops)if(b.type!==module$js$rom$shop.ShopType.PAWN)for(let a=0,d=b.prices.length;a<d;a++)b.prices[a]=128>b.contents[a]?c?c.nextNormal(1,.3,.5,1.5):1:b.type!==module$js$rom$shop.ShopType.INN?
0:c?c.nextNormal(1,.5,.375,1.625):1;c=seq$$module$js$rom$util(48,(a)=>a);patchBytes$$module$js$patch(a.prg,b.expand("ToolShopScaling"),c.map((a)=>Math.round(8*Math.pow(2,a/10))));patchBytes$$module$js$patch(a.prg,b.expand("ArmorShopScaling"),c.map((a)=>Math.round(8*Math.pow(2,(47-a)/12))));for(b=13;39>b;b++)a.items[b].basePrice=BASE_PRICES$$module$js$patch[b]},BASE_PRICES$$module$js$patch={13:4,14:16,15:50,16:325,17:1E3,18:2E3,19:4E3,21:6,22:20,23:75,24:250,25:1E3,26:4800,29:25,30:30,31:45,32:40,
33:36,34:200,35:150,36:80,38:300};function normalizeSwords$$module$js$patch(a,b,c){a.objects[16].atk=3;a.objects[17].atk=6;a.objects[18].atk=8;a.objects[24].atk=3;a.objects[19].atk=5;a.objects[25].atk=5;a.objects[23].atk=7;a.objects[26].atk=7;a.objects[20].atk=3;a.objects[21].atk=6;a.objects[22].atk=8;a.objects[28].atk=3;a.objects[30].atk=5;a.objects[27].atk=7;a.objects[31].atk=7}
function rescaleMonsters$$module$js$patch(a,b,c){var d=new Set(seq$$module$js$rom$util(256,(a)=>a).filter((b)=>b in a.objects));for(var e of SCALED_MONSTERS$$module$js$patch){var [f]=e;d.delete(f)}for(var g of SCALED_MONSTERS$$module$js$patch){const [b,c]=g;for(const e of d)a.objects[b].base===a.objects[e].base&&(SCALED_MONSTERS$$module$js$patch.set(e,c),d.delete(b))}for(const b of[200,249,250])a.objects[b].attackType=240<b?254:255,a.objects[b].statusEffect=0;a.objects[125].elements|=8;e=new Set([87,
94,104,125,136,151,155,158]);d=new Set([80,83,95,105]);for(const h of SCALED_MONSTERS$$module$js$patch){const [k,{sdef:l,swrd:m,hits:n,satk:p,dgld:q,sexp:r}]=h;f=a.objects[k].data;g=e.has(k)?1:0;f[2]|=128;f[6]=n;f[7]=p;f[8]=l|m<<4;f[16]=f[16]&15|q<<4;f[17]=r;(g?b.shuffleBossElements():b.shuffleMonsterElements())&&!d.has(k)&&(f=[...a.objects[k].elements.toString(2).padStart(4,"0")],c.shuffle(f),a.objects[k].elements=Number.parseInt(f.join(""),2))}if(b.shuffleMonsterElements()){b=c.nextInt(4);a.prg[217645]=
b+1;for(const c of d)a.objects[c].elements=1<<b}}
const shuffleMonsters$$module$js$patch=(a,b,c)=>{const d=new Graphics$$module$js$rom$graphics(a);b.shuffleSpritePalettes()&&d.shufflePalettes(c);b=new MonsterPool$$module$js$patch(b,{});for(const c of a.locations)c.used&&b.populate(c);b.shuffle(c,d)},identifyKeyItemsForDifficultyBuffs$$module$js$patch=(a)=>{for(let b=0;73>b;b++){const c=1<<(b&7),d=123152+(b>>>3);a.prg[d]=a.prg[d]&~c|(a.prg[135152+b]&64||49===b?c:0)}},SCALED_MONSTERS$$module$js$patch=new Map([[63,"p","Sorceror shot",,,,19,,,],[75,
"m","wraith??",2,,2,22,4,61],[79,"m","wraith",1,,2,20,4,61],[80,"m","Blue Slime",,,1,16,2,32],[81,"m","Weretiger",,,1,21,4,40],[82,"m","Green Jelly",4,,3,16,4,36],[83,"m","Red Slime",6,,4,16,4,48],[84,"m","Rock Golem",6,,11,24,6,85],[85,"m","Blue Bat",,,,4,,32],[86,"m","Green Wyvern",4,,4,24,6,52],[87,"b","Vampire",3,,12,18,,,],[88,"m","Orc",3,,4,21,4,57],[89,"m","Red Flying Swamp Insect",3,,1,21,4,57],[90,"m","Blue Mushroom",2,,1,21,4,44],[91,"m","Swamp Tomato",3,,2,35,4,52],[92,"m","Flying Meadow Insect",
3,,3,23,4,81],[93,"m","Swamp Plant",,,,,,36],[94,"b","Insect",,1,8,6,,,],[95,"m","Large Blue Slime",5,,3,20,4,52],[96,"m","Ice Zombie",5,,7,14,4,57],[97,"m","Green Living Rock",,,1,9,4,28],[98,"m","Green Spider",4,,4,22,4,44],[99,"m","Red/Purple Wyvern",3,,4,30,4,65],[100,"m","Draygonia Soldier",6,,11,36,4,89],[101,"m","Ice Entity",3,,2,24,4,52],[102,"m","Red Living Rock",,,1,13,4,40],[103,"m","Ice Golem",7,2,11,28,4,81],[104,"b","Kelbesque",4,6,12,29,,,],[105,"m","Giant Red Slime",7,,40,90,4,102],
[106,"m","Troll",2,,3,24,4,65],[107,"m","Red Jelly",2,,2,14,4,44],[108,"m","Medusa",3,,4,36,8,77],[109,"m","Red Crab",2,,1,21,4,44],[110,"m","Medusa Head",,,1,29,4,36],[111,"m","Evil Bird",,,2,30,6,65],[113,"m","Red/Purple Mushroom",3,,5,19,6,69],[114,"m","Violet Earth Entity",3,,3,18,6,61],[115,"m","Mimic",,,3,26,15,73],[116,"m","Red Spider",3,,4,22,6,48],[117,"m","Fishman",4,,6,19,5,61],[118,"m","Jellyfish",,,3,14,3,48],[119,"m","Kraken",5,,11,25,7,73],[120,"m","Dark Green Wyvern",4,,5,21,5,61],
[121,"m","Sand Monster",5,,8,6,4,57],[123,"m","Wraith Shadow 1",,,,9,7,44],[124,"m","Killer Moth",,,2,35,,77],[125,"b","Sabera",3,7,13,24,,,],[128,"m","Draygonia Archer",1,,3,20,6,61],[129,"m","Evil Bomber Bird",,,1,19,4,65],[130,"m","Lavaman/blob",3,,3,24,6,85],[132,"m","Lizardman (w/ flail(",2,,3,30,6,81],[133,"m","Giant Eye",3,,5,33,4,81],[134,"m","Salamander",2,,4,29,8,77],[135,"m","Sorceror",2,,5,31,6,65],[136,"b","Mado",4,8,10,30,,,],[137,"m","Draygonia Knight",2,,3,24,4,77],[138,"m","Devil",
,,1,18,4,52],[139,"b","Kelbesque 2",4,6,11,27,,,],[140,"m","Wraith Shadow 2",,,,17,4,48],[144,"b","Sabera 2",5,7,21,27,,,],[145,"m","Tarantula",3,,3,21,6,73],[146,"m","Skeleton",,,4,30,6,69],[147,"b","Mado 2",4,8,11,25,,,],[148,"m","Purple Giant Eye",4,,10,23,6,102],[149,"m","Black Knight (w/ flail)",3,,7,26,6,89],[150,"m","Scorpion",3,,5,29,2,73],[151,"b","Karmine",4,,14,26,,,],[152,"m","Sandman/blob",3,,5,36,6,98],[153,"m","Mummy",5,,19,36,6,110],[154,"m","Tomb Guardian",7,,60,37,6,106],[155,"b",
"Draygon",5,6,16,41,,,],[158,"b","Draygon 2",7,6,28,40,,,],[160,"m","Ground Sentry (1)",4,,6,26,,73],[161,"m","Tower Defense Mech (2)",5,,8,36,,85],[162,"m","Tower Sentinel",,,1,,,32],[163,"m","Air Sentry",3,,2,26,,65],[165,"b","Vampire 2",3,,12,27,,,],[164,"b","Dyna",6,5,32,,,,],[180,"b","dyna pod",6,5,48,26,,,],[184,"p","dyna counter",15,,,42,,,],[185,"p","dyna laser",15,,,42,,,],[186,"p","dyna bubble",,,,36,,,],[188,"m","vamp2 bat",,,,16,,15],[191,"p","draygon2 fireball",,,,26,,,],[193,"m","vamp1 bat",
,,,16,,15],[195,"p","giant insect spit",,,,35,,,],[196,"m","summoned insect",4,,2,42,,98],[197,"p","kelby1 rock",,,,22,,,],[198,"p","sabera1 balls",,,,19,,,],[199,"p","kelby2 fireballs",,,,11,,,],[200,"p","sabera2 fire",,,1,6,,,],[201,"p","sabera2 balls",,,,17,,,],[202,"p","karmine balls",,,,25,,,],[203,"p","sun/moon statue fireballs",,,,39,,,],[204,"p","draygon1 lightning",,,,37,,,],[205,"p","draygon2 laser",,,,36,,,],[206,"p","draygon2 breath",,,,36,,,],[224,"p","evil bomber bird bomb",,,,2,,,],
[226,"p","summoned insect bomb",,,,47,,,],[227,"p","paralysis beam",,,,23,,,],[228,"p","stone gaze",,,,33,,,],[229,"p","rock golem rock",,,,24,,,],[230,"p","curse beam",,,,10,,,],[231,"p","mp drain web",,,,11,,,],[232,"p","fishman trident",,,,15,,,],[233,"p","orc axe",,,,24,,,],[234,"p","Swamp Pollen",,,,37,,,],[235,"p","paralysis powder",,,,17,,,],[236,"p","draygonia solider sword",,,,28,,,],[237,"p","ice golem rock",,,,20,,,],[238,"p","troll axe",,,,27,,,],[239,"p","kraken ink",,,,24,,,],[240,"p",
"draygonia archer arrow",,,,12,,,],[241,"p","??? unused",,,,16,,,],[242,"p","draygonia knight sword",,,,9,,,],[243,"p","moth residue",,,,19,,,],[244,"p","ground sentry laser",,,,13,,,],[245,"p","tower defense mech laser",,,,23,,,],[246,"p","tower sentinel laser",,,,8,,,],[247,"p","skeleton shot",,,,11,,,],[248,"p","lavaman shot",,,,14,,,],[249,"p","black knight flail",,,,18,,,],[250,"p","lizardman flail",,,,21,,,],[252,"p","mado shuriken",,,,36,,,],[253,"p","guardian statue missile",,,,23,,,],[254,
"p","demon wall fire",,,,23,,,]].map((a)=>{var [b,c,d,e=0,f=0,g=0,h=0,k=0,l=0]=a;return[b,{id:b,type:c,name:d,sdef:e,swrd:f,hits:g,satk:h,dgld:k,sexp:l}]}));
class MonsterPool$$module$js$patch{constructor(a,b){this.flags=a;this.report=b;this.monsters=[];this.used=[];this.locations=[]}populate(a){var b=MONSTER_ADJUSTMENTS$$module$js$patch[a.id]||{},c=Object.assign({},b);const d=void 0===b.skip?!1:b.skip;b=void 0===b.tower?!1:b.tower;c=(delete c.maxFlyers,delete c.nonFlyers,delete c.skip,delete c.tower,delete c.fixedSlots,c);for(var e of Object.keys(c))throw Error(`Unexpected property '${e}' in MONSTER_ADJUSTMENTS[${a.id}]`);var f=!0===d||!this.flags.shuffleTowerMonsters()&&
b||!a.spritePatterns||!a.spritePalettes;e=[];c=[];b=12;for(const d of f?[]:a.spawns){++b;if(!d.used||!d.isMonster())continue;f=d.monsterId;if(f in UNTOUCHED_MONSTERS$$module$js$patch||!SCALED_MONSTERS$$module$js$patch.has(f)||"m"!==SCALED_MONSTERS$$module$js$patch.get(f).type)continue;var g=a.rom.objects[f];if(!g)continue;const k=d.patternBank,m=a.spritePatterns[k];var h=g.palettes(!0);g=h.includes(2)?a.spritePalettes[0]:void 0;h=h.includes(3)?a.spritePalettes[1]:void 0;e.push({id:f,pat:m,pal2:g,
pal3:h,patBank:k});(this.report[`start-${f.toString(16)}`]=this.report[`start-${f.toString(16)}`]||[]).push("$"+a.id.toString(16));c.push(b)}if(!e.length||d)c=[];this.locations.push({location:a,slots:c});this.monsters.push(...e)}shuffle(a,b){this.report["pre-shuffle locations"]=this.locations.map((a)=>a.location.id);this.report["pre-shuffle monsters"]=this.monsters.map((a)=>a.id);a.shuffle(this.locations);a.shuffle(this.monsters);this.report["post-shuffle locations"]=this.locations.map((a)=>a.location.id);
for(this.report["post-shuffle monsters"]=this.monsters.map((a)=>a.id);this.locations.length;){const {location:e,slots:f}=this.locations.pop(),g=this.report["$"+e.id.toString(16).padStart(2,"0")]=[],{maxFlyers:h=0,nonFlyers:k={},tower:l=!1}=MONSTER_ADJUSTMENTS$$module$js$patch[e.id]||{};if(l)continue;let m=h,n=Constraint$$module$js$rom$constraint.forLocation(e.id);e.bossId();for(const a of e.spawns)if(a.isChest()&&!a.isInvisible())n=112>a.id?n.meet(Constraint$$module$js$rom$constraint.TREASURE_CHEST,
!0):n.meet(Constraint$$module$js$rom$constraint.MIMIC,!0);else if(a.isNpc()||a.isBoss()){var c=b.getNpcConstraint(e.id,a.id);n=n.meet(c,!0);a.isNpc()&&107===a.id&&(n=n.meet(Constraint$$module$js$rom$constraint.KENSU_CHEST,!0))}else a.isMonster()&&UNTOUCHED_MONSTERS$$module$js$patch[a.monsterId]?(c=b.getMonsterConstraint(e.id,a.monsterId),n=n.meet(c,!0)):a.isShootingWall(e)&&(n=n.meet(Constraint$$module$js$rom$constraint.SHOOTING_WALL,!0));g.push(`Initial pass: ${n.fixed.map((a)=>Infinity>a.size?"["+
[...a].join(", ")+"]":"all")}`);const p=new Map;c=(a)=>{var c=e.rom.objects[a.id];if(c.monsterClass){var d=p.get(c.monsterClass);if(null!=d&&d!==a.id)return!1}d=FLYERS$$module$js$patch.has(a.id);var h=MOTHS_AND_BATS$$module$js$patch.has(a.id);if(d){if(!m)return!1;--m}const l=b.getMonsterConstraint(e.id,a.id);let r=n.tryMeet(l);!r&&Infinity>n.pal2.size&&Infinity>n.pal3.size&&this.flags.shuffleSpritePalettes()&&(r=n.tryMeet(l,!0));if(!r)return!1;if(q){var u=e.rom.objects[a.id];if(!(u instanceof Monster$$module$js$rom$monster))throw Error(`non-monster: ${u}`);
u=q(u);if(null==u)return!1}g.push(`  Adding ${a.id.toString(16)}: ${r}`);n=r;c.monsterClass&&p.set(c.monsterClass,a.id);c=0;if(d||h)for(d=0;d<f.length;d++){if(f[d]in k){c=d;break}}else for(d=0;d<f.length;d++)if(!(f[d]in k)){c=d;break}(this.report[`mon-${a.id.toString(16)}`]=this.report[`mon-${a.id.toString(16)}`]||[]).push("$"+e.id.toString(16));d=f[c];h=e.spawns[d-13];q?(h.screen=u>>>8,h.tile=u&255):d in k&&(h.y+=16*k[d][0],h.x+=16*k[d][1]);h.monsterId=a.id;g.push(`    slot ${d.toString(16)}: ${h}`);
f.splice(c,1);return!0};const q=f.length&&this.flags.randomizeMaps()?e.monsterPlacer(a):null;if(m&&f.length)for(var d=0;d<Math.min(40,this.monsters.length);d++)FLYERS$$module$js$patch.has(this.monsters[d].id)&&c(this.monsters[d])&&this.monsters.splice(d,1);for(d=0;d<this.monsters.length&&f.length;d++)if(c(this.monsters[d])){const [a]=this.monsters.splice(d,1);FLYERS$$module$js$patch.has(a.id)||this.used.push(a);d--}for(d=0;d<this.used.length&&f.length;d++)c(this.used[d])&&(this.used.push(...this.used.splice(d,
1)),d--);n.fix(e,a);if(f.length){console.error(`Failed to fill location ${e.id.toString(16)}: ${f.length} remaining`);for(const a of f)c=e.spawns[a-13],c.x=c.y=0,c.id=176,c.data[0]=254}for(const a of e.spawns)b.configure(e,a)}}}
const FLYERS$$module$js$patch=new Set([89,92,110,111,129,138,163,196]),MOTHS_AND_BATS$$module$js$patch=new Set([85,93,124,188,193]),MONSTER_ADJUSTMENTS$$module$js$patch={[3]:{fixedSlots:{pat1:96},maxFlyers:2},[7]:{nonFlyers:{[15]:[0,-3],[16]:[-10,0],[17]:[0,4]}},[20]:{maxFlyers:2},[21]:{maxFlyers:2},[26]:{fixedSlots:{pal3:35,pat1:79},maxFlyers:2,nonFlyers:{[16]:[4,0],[17]:[5,0],[18]:[4,0],[19]:[5,0],[20]:[4,0],[21]:[4,0]}},[27]:{skip:!0},[32]:{maxFlyers:1},[33]:{fixedSlots:{pat1:80},maxFlyers:1},
[39]:{nonFlyers:{[13]:[0,16]}},[40]:{maxFlyers:1},[41]:{maxFlyers:1},[43]:{nonFlyers:{[20]:[32,-8]}},[64]:{maxFlyers:2,nonFlyers:{[19]:[12,-16]}},[65]:{maxFlyers:2,nonFlyers:{[21]:[0,-6]}},[66]:{maxFlyers:2,nonFlyers:{[13]:[0,8],[14]:[-8,8]}},[71]:{maxFlyers:1,nonFlyers:{[13]:[-8,-8]}},[74]:{maxFlyers:1,nonFlyers:{[14]:[4,0],[15]:[0,-3],[16]:[0,4]}},[76]:{},[77]:{maxFlyers:1},[78]:{maxFlyers:1},[79]:{},[87]:{fixedSlots:{pat1:77}},[89]:{tower:!0},[90]:{tower:!0},[91]:{tower:!0},[96]:{fixedSlots:{pal3:8,
pat1:82},maxFlyers:2,skip:!0},[100]:{fixedSlots:{pal3:8,pat1:82},skip:!0},[104]:{fixedSlots:{pal3:8,pat1:82},skip:!0},[105]:{maxFlyers:1,nonFlyers:{[23]:[4,6]}},[106]:{maxFlyers:1,nonFlyers:{[21]:[0,24]}},[108]:{maxFlyers:1,nonFlyers:{[23]:[0,24]}},[109]:{maxFlyers:1,nonFlyers:{[17]:[16,0],[27]:[0,0],[28]:[6,0]}},[120]:{maxFlyers:1,nonFlyers:{[22]:[-8,-8]}},[124]:{maxFlyers:1,nonFlyers:{[21]:[-39,84]}},[132]:{nonFlyers:{[18]:[0,-4],[19]:[0,4],[20]:[-6,0],[21]:[14,12]}},[136]:{maxFlyers:1},[137]:{maxFlyers:1},
[138]:{maxFlyers:1,nonFlyers:{[13]:[7,0],[14]:[0,0],[15]:[7,3],[16]:[0,6],[17]:[11,-16]}},[143]:{skip:!0},[144]:{maxFlyers:2,nonFlyers:{[20]:[-11,-3],[21]:[0,16]}},[145]:{maxFlyers:2,nonFlyers:{[24]:[0,14],[25]:[4,-16]}},[152]:{maxFlyers:2,nonFlyers:{[20]:[-6,6],[21]:[0,-16]}},[158]:{maxFlyers:2},[162]:{maxFlyers:1,nonFlyers:{[18]:[0,11],[19]:[6,0]}},[165]:{nonFlyers:{[23]:[6,6],[24]:[-6,0],[25]:[-1,-7]}},[166]:{skip:!0},[168]:{skip:!0},[169]:{maxFlyers:2,nonFlyers:{[22]:[26,-16],[23]:[0,32]}},[171]:{maxFlyers:2,
nonFlyers:{[13]:[1,0],[14]:[2,-2]}},[173]:{maxFlyers:2,nonFlyers:{[24]:[0,8],[25]:[0,-8]}},[175]:{nonFlyers:{[13]:[0,0],[14]:[0,0],[19]:[59,-38]}},[180]:{maxFlyers:2,nonFlyers:{[17]:[6,0],[18]:[0,6]}},[215]:{skip:!0}},UNTOUCHED_MONSTERS$$module$js$patch={[126]:!0,[127]:!0,[131]:!0,[141]:!0,[142]:!0,[143]:!0,[159]:!0,[166]:!0},shuffleRandomNumbers$$module$js$patch=(a,b)=>{a=a.subarray(219124,219188);b.shuffle(a)};var module$js$patch={};module$js$patch.default=$jscompDefaultExport$$module$js$patch;
module$js$patch.parseSeed=parseSeed$$module$js$patch;module$js$patch.shuffle=shuffle$$module$js$patch;module$js$patch.stampVersionSeedAndHash=stampVersionSeedAndHash$$module$js$patch;Array.prototype.flatMap||Object.defineProperties(Array.prototype,{flatMap:{value(a){const b=[];let c=0;for(const d of this){let e=a(d,c++);"function"!==typeof e[Symbol.iterator]&&(e=[e]);e=[...e];e.length&&b.push(...e)}return b}}});const FullRomImage$$module$js$romimage={of:(a)=>a},PrgImage$$module$js$romimage={of:(a)=>a.subarray(16,262160)},ChrImage$$module$js$romimage={of:(a)=>a.subarray(262160)};var module$js$romimage={};module$js$romimage.FullRomImage=FullRomImage$$module$js$romimage;module$js$romimage.PrgImage=PrgImage$$module$js$romimage;module$js$romimage.ChrImage=ChrImage$$module$js$romimage;const BOSS_OBJECT_ADDRESS$$module$js$rom$boss=[[45297,!0],[45301,!1],[45305,!0],[45309,!1],[222574,!0],[251936,!0],[45557,!0],[45561,!0],[45565,!0],[45809,!0],[45813,!1],[45817,!1],[45821,!1],[46065,!0]];function shuffleBosses$$module$js$rom$boss(a,b){const c=BOSS_OBJECT_ADDRESS$$module$js$rom$boss.filter(([,a])=>a).map(([a])=>a),d=c.map((b)=>a.prg[b]);b.shuffle(d);for(b=0;b<c.length;b++)a.prg[c[b]]=d[b]}var module$js$rom$boss={};module$js$rom$boss.shuffleBosses=shuffleBosses$$module$js$rom$boss;function uint1$$module$js$rom$ints(a){return a&1}function uint2$$module$js$rom$ints(a){return a&3}function uint3$$module$js$rom$ints(a){return a&7}function uint4$$module$js$rom$ints(a){return a&15}function uint5$$module$js$rom$ints(a){return a&31}function uint6$$module$js$rom$ints(a){return a&63}function uint7$$module$js$rom$ints(a){return a&127}function uint8$$module$js$rom$ints(a){return a&255}function int8$$module$js$rom$ints(a){a=uint8$$module$js$rom$ints(a);return 128>a?a:a-256}
var module$js$rom$ints={};module$js$rom$ints.uint1=uint1$$module$js$rom$ints;module$js$rom$ints.uint2=uint2$$module$js$rom$ints;module$js$rom$ints.uint3=uint3$$module$js$rom$ints;module$js$rom$ints.uint4=uint4$$module$js$rom$ints;module$js$rom$ints.uint5=uint5$$module$js$rom$ints;module$js$rom$ints.uint6=uint6$$module$js$rom$ints;module$js$rom$ints.uint7=uint7$$module$js$rom$ints;module$js$rom$ints.uint8=uint8$$module$js$rom$ints;module$js$rom$ints.int8=int8$$module$js$rom$ints;class Speeds$$module$js$rom$speeds{constructor(a){this.rom=a}}const ADDRESS_TABLE$$module$js$rom$speeds=214204;var module$js$rom$speeds={};module$js$rom$speeds.Speeds=Speeds$$module$js$rom$speeds;const ITEMS$$module$js$tracker="\nsword-of-wind $00\nsword-of-fire $01\nsword-of-water $02\nsword-of-thunder $03\nwindmill-key $32\nstatue-of-onyx $25\ninsect-flute $27\nkey-to-prison $33\nflute-of-lime $28\n\nball-of-wind $05 \nball-of-fire $07\nball-of-water $09\nball-of-thunder $0b\nkirisa-plant $3c\nalarm-flute $31\nfog-lamp $35\nshell-flute $36\nbroken-statue $38\neye-glasses $37\nglowing-lamp $39\n\ntornado-bracelet $06\nflame-bracelet $08\nblizzard-bracelet $0a\nstorm-bracelet $0c\nlove-pendant $3b\nkey-to-styx $34\nopel-statue $26\nsacred-shield $12\nivory-statue $3d\n\nrabbit-boots $2e\ngas-mask $29\nshield-ring $30\niron-necklace $2c\nleather-boots $2f\npower-ring $2a\nwarrior-ring $2b\ndeos-pendant $2d\nbow-of-moon $3e\nbow-of-sun $3f\n\nrefresh $41\nparalysis $42\ntelepathy $43\nteleport $44\nrecover $45\nbarrier $46\nchange $47\nflight $48\npsycho-armor $1c\nbow-of-truth $40\n",
SLOTS$$module$js$tracker=[[0,121,192],[1,274,176],[2,335,123],[3,77,10],[5,89,107],[6,115,224],[7,282,187],[8,47,182],[9,251,232],[10,206,249],[11,83,63],[12,23,9],[18,49,48],[20,77,2],[118,70,3],[119,84,3],[27,168,96],[28,199,110],[29,82,95],[30,82,101],[31,346,147],[112,346,153],[113,346,159],[32,126,52],[33,227,97],[34,256,73],[35,58,115],[36,82,113],[37,189,180],[38,18,172],[39,267,185],[40,275,147],[41,147,206],[42,172,104],[43,203,5],[44,249,69],[45,191,110],[46,89,99],[47,164,104],[48,319,
123],[114,320,130],[50,105,94],[51,64,198],[52,83,71],[53,345,140],[54,301,119],[55,233,118],[56,234,88],[57,295,92],[59,274,117],[60,338,226],[61,23,17],[62,206,241],[63,101,6],[64,207,110],[65,92,117],[66,279,126],[67,202,138],[68,124,202],[69,304,128],[70,248,35],[71,277,3],[72,15,25],[80,82,107],[82,134,219],[83,59,219],[84,52,55],[85,241,97],[86,123,23],[116,115,3],[87,70,9],[117,84,9],[88,32,38],[121,32,16],[122,40,16],[123,40,38],[90,161,97],[16,327,123],[92,256,79],[93,36,139],[94,14,229],
[95,345,225],[96,18,94],[97,234,96],[98,18,118],[99,36,54],[100,175,97],[101,139,40],[102,66,160],[105,131,201],[106,76,226],[107,18,100],[108,193,103],[120,199,103],[109,205,103],[115,256,67],[110,24,38],[111,44,97]],KEY$$module$js$tracker=new Set([16,18,35,38,97]),BOSSES$$module$js$tracker=new Map([[-257,46],[-258,7],[-259,8],[-260,9],[-261,56],[-262,11],[-263,38],[-264,35],[-265,18],[-266,61],[-267,28],[-269,97]]),TRADES$$module$js$tracker=new Set([41,62,68,71,72]);
class Graph$$module$js$tracker{constructor(a,b,c){this.rom=a;this.world=b;this.flags=c;this.slots=new Map;this.items=new Map;this.slotElts=new Map;this.has=Bits$$module$js$bits.of();window.GRAPH=this;this.grid=document.getElementsByClassName("grid")[0];this.map=document.getElementsByClassName("map")[0];c=Bits$$module$js$bits.of();for(var d of b.graph.slots){const {item:a,index:b}=d;null!=a&&this.slots.set(a,b)}for(const e of b.graph.items){const {item:b,index:g}=e;null!=b&&(this.items.set(b,g),(d=
a.items[b])&&!d.unique&&(c=Bits$$module$js$bits.with(c,g)))}this.unusedItems=b.graph.items.length;this.has=this.always=c;this.grid.addEventListener("click",(a)=>{let b=a.target;for(;b&&!b.dataset.index;)b=b.parentElement;if(b){var c=Number(b.dataset.index),d=b.classList.toggle("got");b.dataset.item&&(this.has=d?Bits$$module$js$bits.with(this.has,c):Bits$$module$js$bits.without(this.has,c));this.update();a.preventDefault()}})}addSlot(a,b,c){const d=this.slots.get(a);if(null==d){debugger;throw Error();
}const e=document.createElement("div"),f=this.rom.itemGets[a],g=f&&this.rom.items[f.itemId];if(g&&g.unique||KEY$$module$js$tracker.has(a))e.classList.add("key"),b--,c--;b--;c--;e.dataset.index=String(d);e.style.left=b+"px";e.style.top=c+"px";b=document.createElement("div");e.appendChild(b);b.textContent=112<=a?"Mimic":this.rom.items[f.itemId].messageName.replace(" ","\u00a0");this.flags.randomizeTrades()&&TRADES$$module$js$tracker.has(a)&&e.classList.add("boss");this.slotElts.set(d,e);this.map.appendChild(e)}addItem(a,
b){b=Number.parseInt(b.substring(1),16);a=document.getElementsByClassName(a)[0];var c=document.createElement("div");a.appendChild(c);c=this.items.get(b);null==c&&this.items.set(b,c=this.unusedItems++);a.dataset.index=String(c);a.dataset.item=String(c)}addExtraFlags(){var a=this.world.graph;for(const b of a.slots.slice(a.fixed))if(a=(a=BOSSES$$module$js$tracker.get(b.condition))&&this.slots.get(a),null!=a){a=this.slotElts.get(a);if(null==a)throw Error("expected");this.slotElts.delete(Number(a.dataset.index));
this.slotElts.set(b.index,a);a.classList.add("boss");a.dataset.index=String(b.index);a.dataset.item=String(b.index)}}update(){for(var a of this.slotElts.values())a.dataset.state=a.classList.contains("got")?"":"blocked";for(const b of traverse$$module$js$graph$shuffle(this.world.graph,newFill$$module$js$graph$shuffle(),this.has))(a=this.slotElts.get(b))&&!a.classList.contains("got")&&(a.dataset.state="available")}}let flags$$module$js$tracker="Rlpt Tb";
for(const a of location.hash.substring(1).split("&")){const [b,c]=a.split("=");"flags"===b&&(flags$$module$js$tracker=decodeURIComponent(c))}
function main$$module$js$tracker(){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const a=yield Rom$$module$js$rom.load(),b=new FlagSet$$module$js$flagset(flags$$module$js$tracker);deterministic$$module$js$pass$deterministic(a,b);const c=World$$module$js$graph$world.build(a,b,!0),d=new Graph$$module$js$tracker(a,c,b);for(let a of ITEMS$$module$js$tracker.split("\n"))(a=a.replace(/#.*/,"").trim())&&d.addItem(...a.split(/ +/g));for(const a of SLOTS$$module$js$tracker)d.addSlot(...a);
d.addExtraFlags();d.update();document.getElementById("toggle-map").addEventListener("click",()=>{d.map.classList.toggle("hidden")});document.getElementById("clear-all").addEventListener("click",()=>{for(const a of d.grid.querySelectorAll(".got"))a.classList.remove("got");d.has=d.always;d.update()})})}main$$module$js$tracker();var module$js$tracker={};
}).call(this)
