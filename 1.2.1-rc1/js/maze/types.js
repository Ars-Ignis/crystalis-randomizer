export var Path;
(function (Path) {
    function* generate(random, forward, right) {
        while (true) {
            yield generatePath(random, forward, right);
        }
    }
    Path.generate = generate;
})(Path || (Path = {}));
function* generatePath(random, forward, right) {
    function advance() {
        forward--;
        return 0;
    }
    function turnLeft() {
        [forward, right] = [-right, forward - 1];
        return -1;
    }
    function turnRight() {
        [forward, right] = [right, 1 - forward];
        return 1;
    }
    while (forward !== 1 || right !== 0) {
        if (forward > 0 && random.next() < 0.5) {
            yield advance();
            if (forward > 2 && random.next() < 0.5)
                yield advance();
            continue;
        }
        if (random.next() < (forward < 0 ? 0.1 : 0.5)) {
            yield advance();
            continue;
        }
        if (right > 0) {
            yield turnRight();
            continue;
        }
        if (right < 0) {
            yield turnLeft();
            continue;
        }
        yield (random.next() < 0.5 ? turnLeft() : turnRight());
    }
}
export var DirMask;
(function (DirMask) {
    function of(...dirs) {
        let mask = 0;
        for (let dir of dirs) {
            mask |= (1 << dir);
        }
        return mask;
    }
    DirMask.of = of;
})(DirMask || (DirMask = {}));
export var Dir;
(function (Dir) {
    Dir.ALL = [0, 1, 2, 3];
    Dir.DELTA = [-16, 1, 16, -1];
    function inv(dir) {
        return (dir ^ 2);
    }
    Dir.inv = inv;
    function edgeMask(dir) {
        return 0xf << (dir << 2);
    }
    Dir.edgeMask = edgeMask;
    function shift(dir) {
        return dir << 2;
    }
    Dir.shift = shift;
    function turn(dir, change) {
        return ((dir + change) & 3);
    }
    Dir.turn = turn;
    function* allEdge(dir, height, width) {
        const extent = dir ? height << 4 : width;
        const incr = dir & 1 ? 16 : 1;
        const start = dir === Dir.RIGHT ? width - 1 : dir === Dir.DOWN ? (height - 1) << 4 : 0;
        for (let i = start; i < extent; i += incr) {
            yield i;
        }
    }
    Dir.allEdge = allEdge;
    Dir.UP = 0;
    Dir.RIGHT = 1;
    Dir.DOWN = 2;
    Dir.LEFT = 3;
})(Dir || (Dir = {}));
export var Pos;
(function (Pos) {
    function plus(pos, dir) {
        return (pos + Dir.DELTA[dir]);
    }
    Pos.plus = plus;
    function relative(p1, d1, p2) {
        const dy = (p2 >>> 4) - (p1 >>> 4);
        const dx = (p2 & 0xf) - (p1 & 0xf);
        if (d1 === 0)
            return [-dy, dx];
        if (d1 === 1)
            return [dx, dy];
        if (d1 === 2)
            return [dy, -dx];
        if (d1 === 3)
            return [-dx, -dy];
        throw new Error(`impossible: ${d1}`);
    }
    Pos.relative = relative;
})(Pos || (Pos = {}));
export var Scr;
(function (Scr) {
    function edge(screen, dir) {
        return (screen >>> (dir << 2)) & 0xf;
    }
    Scr.edge = edge;
    function numExits(screen) {
        let count = 0;
        for (let i = 0; i < 4; i++) {
            if (screen & 0xf)
                count++;
            screen = (screen >>> 4);
        }
        return count;
    }
    Scr.numExits = numExits;
    function fromExits(dirMask, exitType) {
        let screen = 0;
        for (let i = 0; i < 4; i++) {
            screen <<= 4;
            if (dirMask & 8)
                screen |= exitType;
            dirMask = ((dirMask & 7) << 1);
        }
        return screen;
    }
    Scr.fromExits = fromExits;
})(Scr || (Scr = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvbWF6ZS90eXBlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFNQSxNQUFNLEtBQVcsSUFBSSxDQU9wQjtBQVBELFdBQWlCLElBQUk7SUFDbkIsUUFBZSxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQWMsRUFBRSxPQUFlLEVBQUUsS0FBYTtRQUV0RSxPQUFPLElBQUksRUFBRTtZQUNYLE1BQU0sWUFBWSxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDNUM7SUFDSCxDQUFDO0lBTGdCLGFBQVEsV0FLeEIsQ0FBQTtBQUNILENBQUMsRUFQZ0IsSUFBSSxLQUFKLElBQUksUUFPcEI7QUFFRCxRQUFRLENBQUMsQ0FBQyxZQUFZLENBQUMsTUFBYyxFQUFFLE9BQWUsRUFBRSxLQUFhO0lBQ25FLFNBQVMsT0FBTztRQUNkLE9BQU8sRUFBRSxDQUFDO1FBQ1YsT0FBTyxDQUFDLENBQUM7SUFDWCxDQUFDO0lBQ0QsU0FBUyxRQUFRO1FBQ2YsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDekMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUNaLENBQUM7SUFDRCxTQUFTLFNBQVM7UUFDaEIsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDO1FBQ3hDLE9BQU8sQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUNELE9BQU8sT0FBTyxLQUFLLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQyxFQUFFO1FBQ25DLElBQUksT0FBTyxHQUFHLENBQUMsSUFBSSxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsR0FBRyxFQUFFO1lBQ3RDLE1BQU0sT0FBTyxFQUFFLENBQUM7WUFFaEIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLEVBQUUsR0FBRyxHQUFHO2dCQUFFLE1BQU0sT0FBTyxFQUFFLENBQUM7WUFDeEQsU0FBUztTQUNWO1FBRUQsSUFBSSxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQzdDLE1BQU0sT0FBTyxFQUFFLENBQUM7WUFDaEIsU0FBUztTQUNWO1FBQ0QsSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFO1lBQ2IsTUFBTSxTQUFTLEVBQUUsQ0FBQztZQUNsQixTQUFTO1NBQ1Y7UUFDRCxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUU7WUFDYixNQUFNLFFBQVEsRUFBRSxDQUFDO1lBQ2pCLFNBQVM7U0FDVjtRQUNELE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQztLQUN4RDtBQUNILENBQUM7QUFNRCxNQUFNLEtBQVcsT0FBTyxDQVF2QjtBQVJELFdBQWlCLE9BQU87SUFDdEIsU0FBZ0IsRUFBRSxDQUFDLEdBQUcsSUFBb0I7UUFDeEMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDO1FBQ2IsS0FBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUU7WUFDcEIsSUFBSSxJQUFJLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1NBQ3BCO1FBQ0QsT0FBTyxJQUFlLENBQUM7SUFDekIsQ0FBQztJQU5lLFVBQUUsS0FNakIsQ0FBQTtBQUNILENBQUMsRUFSZ0IsT0FBTyxLQUFQLE9BQU8sUUFRdkI7QUFTRCxNQUFNLEtBQVcsR0FBRyxDQStCbkI7QUEvQkQsV0FBaUIsR0FBRztJQUNMLE9BQUcsR0FBbUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQVUsQ0FBQztJQUU1QyxTQUFLLEdBQXNCLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pELFNBQWdCLEdBQUcsQ0FBQyxHQUFRO1FBQzFCLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFRLENBQUM7SUFDMUIsQ0FBQztJQUZlLE9BQUcsTUFFbEIsQ0FBQTtJQUNELFNBQWdCLFFBQVEsQ0FBQyxHQUFRO1FBQy9CLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzNCLENBQUM7SUFGZSxZQUFRLFdBRXZCLENBQUE7SUFDRCxTQUFnQixLQUFLLENBQUMsR0FBUTtRQUM1QixPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDbEIsQ0FBQztJQUZlLFNBQUssUUFFcEIsQ0FBQTtJQUNELFNBQWdCLElBQUksQ0FBQyxHQUFRLEVBQUUsTUFBYztRQUMzQyxPQUFPLENBQUMsQ0FBQyxHQUFHLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFRLENBQUM7SUFDckMsQ0FBQztJQUZlLFFBQUksT0FFbkIsQ0FBQTtJQUNELFFBQWUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFRLEVBQ1IsTUFBYyxFQUNkLEtBQWE7UUFDcEMsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDekMsTUFBTSxJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUIsTUFBTSxLQUFLLEdBQ1AsR0FBRyxLQUFLLElBQUEsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssSUFBQSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JFLEtBQUssSUFBSSxDQUFDLEdBQUcsS0FBSyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsQ0FBQyxJQUFJLElBQUksRUFBRTtZQUN6QyxNQUFNLENBQVEsQ0FBQztTQUNoQjtJQUNILENBQUM7SUFWZ0IsV0FBTyxVQVV2QixDQUFBO0lBQ1ksTUFBRSxHQUFHLENBQVEsQ0FBQztJQUNkLFNBQUssR0FBRyxDQUFRLENBQUM7SUFDakIsUUFBSSxHQUFHLENBQVEsQ0FBQztJQUNoQixRQUFJLEdBQUcsQ0FBUSxDQUFDO0FBQy9CLENBQUMsRUEvQmdCLEdBQUcsS0FBSCxHQUFHLFFBK0JuQjtBQUtELE1BQU0sS0FBVyxHQUFHLENBaUJuQjtBQWpCRCxXQUFpQixHQUFHO0lBQ2xCLFNBQWdCLElBQUksQ0FBQyxHQUFRLEVBQUUsR0FBUTtRQUNyQyxPQUFPLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQVEsQ0FBQztJQUN2QyxDQUFDO0lBRmUsUUFBSSxPQUVuQixDQUFBO0lBS0QsU0FBZ0IsUUFBUSxDQUFDLEVBQU8sRUFBRSxFQUFPLEVBQUUsRUFBTztRQUNoRCxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNuQyxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUNuQyxJQUFJLEVBQUUsS0FBSyxDQUFDO1lBQUUsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQy9CLElBQUksRUFBRSxLQUFLLENBQUM7WUFBRSxPQUFPLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzlCLElBQUksRUFBRSxLQUFLLENBQUM7WUFBRSxPQUFPLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDL0IsSUFBSSxFQUFFLEtBQUssQ0FBQztZQUFFLE9BQU8sQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2hDLE1BQU0sSUFBSSxLQUFLLENBQUMsZUFBZSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFSZSxZQUFRLFdBUXZCLENBQUE7QUFDSCxDQUFDLEVBakJnQixHQUFHLEtBQUgsR0FBRyxRQWlCbkI7QUFlRCxNQUFNLEtBQVcsR0FBRyxDQXFCbkI7QUFyQkQsV0FBaUIsR0FBRztJQUNsQixTQUFnQixJQUFJLENBQUMsTUFBVyxFQUFFLEdBQVE7UUFDeEMsT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztJQUN2QyxDQUFDO0lBRmUsUUFBSSxPQUVuQixDQUFBO0lBQ0QsU0FBZ0IsUUFBUSxDQUFDLE1BQVc7UUFDbEMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2QsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMxQixJQUFJLE1BQU0sR0FBRyxHQUFHO2dCQUFFLEtBQUssRUFBRSxDQUFDO1lBQzFCLE1BQU0sR0FBRyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQVEsQ0FBQztTQUNoQztRQUNELE9BQU8sS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQVBlLFlBQVEsV0FPdkIsQ0FBQTtJQUNELFNBQWdCLFNBQVMsQ0FBQyxPQUFnQixFQUFFLFFBQWdCO1FBQzFELElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQztRQUNmLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDMUIsTUFBTSxLQUFLLENBQUMsQ0FBQztZQUNiLElBQUksT0FBTyxHQUFHLENBQUM7Z0JBQUUsTUFBTSxJQUFJLFFBQVEsQ0FBQztZQUNwQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQVksQ0FBQztTQUMzQztRQUNELE9BQU8sTUFBYSxDQUFDO0lBQ3ZCLENBQUM7SUFSZSxhQUFTLFlBUXhCLENBQUE7QUFDSCxDQUFDLEVBckJnQixHQUFHLEtBQUgsR0FBRyxRQXFCbkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1JhbmRvbX0gZnJvbSAnLi4vcmFuZG9tLmpzJztcblxuLy8gMCBpcyBzdHJhaWdodCwgLTEgaXMgbGVmdCB0dXJuLCArMSBpcyByaWdodCB0dXJuXG5leHBvcnQgdHlwZSBUdXJuID0gMCB8IC0xIHwgMTtcblxuZXhwb3J0IHR5cGUgUGF0aCA9IEl0ZXJhYmxlSXRlcmF0b3I8VHVybj47XG5leHBvcnQgbmFtZXNwYWNlIFBhdGgge1xuICBleHBvcnQgZnVuY3Rpb24qIGdlbmVyYXRlKHJhbmRvbTogUmFuZG9tLCBmb3J3YXJkOiBudW1iZXIsIHJpZ2h0OiBudW1iZXIpOlxuICAgICAgICAgICAgICAgICAgIEl0ZXJhYmxlSXRlcmF0b3I8UGF0aD4ge1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICB5aWVsZCBnZW5lcmF0ZVBhdGgocmFuZG9tLCBmb3J3YXJkLCByaWdodCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uKiBnZW5lcmF0ZVBhdGgocmFuZG9tOiBSYW5kb20sIGZvcndhcmQ6IG51bWJlciwgcmlnaHQ6IG51bWJlcik6IFBhdGgge1xuICBmdW5jdGlvbiBhZHZhbmNlKCk6IFR1cm4ge1xuICAgIGZvcndhcmQtLTtcbiAgICByZXR1cm4gMDtcbiAgfVxuICBmdW5jdGlvbiB0dXJuTGVmdCgpOiBUdXJuIHtcbiAgICBbZm9yd2FyZCwgcmlnaHRdID0gWy1yaWdodCwgZm9yd2FyZCAtIDFdO1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBmdW5jdGlvbiB0dXJuUmlnaHQoKTogVHVybiB7XG4gICAgW2ZvcndhcmQsIHJpZ2h0XSA9IFtyaWdodCwgMSAtIGZvcndhcmRdO1xuICAgIHJldHVybiAxO1xuICB9XG4gIHdoaWxlIChmb3J3YXJkICE9PSAxIHx8IHJpZ2h0ICE9PSAwKSB7XG4gICAgaWYgKGZvcndhcmQgPiAwICYmIHJhbmRvbS5uZXh0KCkgPCAwLjUpIHtcbiAgICAgIHlpZWxkIGFkdmFuY2UoKTtcbiAgICAgIC8vIGV4dHJhIGNoYW5jZSBvZiBnb2luZyB0d29cbiAgICAgIGlmIChmb3J3YXJkID4gMiAmJiByYW5kb20ubmV4dCgpIDwgMC41KSB5aWVsZCBhZHZhbmNlKCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgLy8gNTAlIGNoYW5jZSBvZiBhZHZhbmNpbmcgbm8gbWF0dGVyIHdoYXQgKHVubGVzcyB0YXJnZXQgYmVoaW5kIHVzKVxuICAgIGlmIChyYW5kb20ubmV4dCgpIDwgKGZvcndhcmQgPCAwID8gMC4xIDogMC41KSkge1xuICAgICAgeWllbGQgYWR2YW5jZSgpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChyaWdodCA+IDApIHtcbiAgICAgIHlpZWxkIHR1cm5SaWdodCgpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChyaWdodCA8IDApIHtcbiAgICAgIHlpZWxkIHR1cm5MZWZ0KCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgeWllbGQgKHJhbmRvbS5uZXh0KCkgPCAwLjUgPyB0dXJuTGVmdCgpIDogdHVyblJpZ2h0KCkpO1xuICB9XG59XG5cblxuLyoqIEEgbWFzayBvZiBkaXJlY3Rpb25zICgxIDw8IERpcikuICovXG5leHBvcnQgdHlwZSBEaXJNYXNrID0gbnVtYmVyICYge19fZGlybWFza19fOiBuZXZlcn07XG5cbmV4cG9ydCBuYW1lc3BhY2UgRGlyTWFzayB7XG4gIGV4cG9ydCBmdW5jdGlvbiBvZiguLi5kaXJzOiByZWFkb25seSBEaXJbXSk6IERpck1hc2sge1xuICAgIGxldCBtYXNrID0gMDtcbiAgICBmb3IgKGxldCBkaXIgb2YgZGlycykge1xuICAgICAgbWFzayB8PSAoMSA8PCBkaXIpO1xuICAgIH1cbiAgICByZXR1cm4gbWFzayBhcyBEaXJNYXNrO1xuICB9XG59XG5cbi8vIFRPRE8gLSBpbnZlcnQgdGhlIHJvdGF0aW9uIGRpcmVjdGlvbiEgID0+ICAxID0gbGVmdCwgMyA9IHJpZ2h0XG4vLyBUaGlzIHdpbGwgYmUgY29uc2lzdGVudCB3aXRoIGhvdyB3ZSBkbyByb3V0ZXMsIGFuZCBpcyBlYXNpZXIgdG9cbi8vIHdvcmsgd2l0aCBiZWNhdXNlIGRpciYyIGNvcnJlc3BvbmRzIHRvIDAvbWF4IGFuZCBkaXImMSBpcyBoL3ZcblxuLyoqIEEgZGlyZWN0aW9uOiAwID0gdXAsIDEgPSByaWdodCwgMiA9IGRvd24sIDMgPSBsZWZ0LiAqL1xuZXhwb3J0IHR5cGUgRGlyID0gbnVtYmVyICYge19fZGlyX186IG5ldmVyfTtcblxuZXhwb3J0IG5hbWVzcGFjZSBEaXIge1xuICBleHBvcnQgY29uc3QgQUxMOiByZWFkb25seSBEaXJbXSA9IFswLCAxLCAyLCAzXSBhcyBEaXJbXTtcbiAgLy9leHBvcnQgY29uc3QgUkVWRVJTRTogcmVhZG9ubHkgRGlyW10gPSBbMywgMiwgMSwgMF0gYXMgRGlyW107XG4gIGV4cG9ydCBjb25zdCBERUxUQTogcmVhZG9ubHkgbnVtYmVyW10gPSBbLTE2LCAxLCAxNiwgLTFdO1xuICBleHBvcnQgZnVuY3Rpb24gaW52KGRpcjogRGlyKTogRGlyIHtcbiAgICByZXR1cm4gKGRpciBeIDIpIGFzIERpcjtcbiAgfVxuICBleHBvcnQgZnVuY3Rpb24gZWRnZU1hc2soZGlyOiBEaXIpOiBudW1iZXIge1xuICAgIHJldHVybiAweGYgPDwgKGRpciA8PCAyKTtcbiAgfVxuICBleHBvcnQgZnVuY3Rpb24gc2hpZnQoZGlyOiBEaXIpOiBudW1iZXIge1xuICAgIHJldHVybiBkaXIgPDwgMjtcbiAgfVxuICBleHBvcnQgZnVuY3Rpb24gdHVybihkaXI6IERpciwgY2hhbmdlOiBudW1iZXIpOiBEaXIge1xuICAgIHJldHVybiAoKGRpciArIGNoYW5nZSkgJiAzKSBhcyBEaXI7XG4gIH1cbiAgZXhwb3J0IGZ1bmN0aW9uKiBhbGxFZGdlKGRpcjogRGlyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogbnVtYmVyKTogSXRlcmFibGVJdGVyYXRvcjxQb3M+IHtcbiAgICBjb25zdCBleHRlbnQgPSBkaXIgPyBoZWlnaHQgPDwgNCA6IHdpZHRoO1xuICAgIGNvbnN0IGluY3IgPSBkaXIgJiAxID8gMTYgOiAxO1xuICAgIGNvbnN0IHN0YXJ0ID1cbiAgICAgICAgZGlyID09PSBSSUdIVCA/IHdpZHRoIC0gMSA6IGRpciA9PT0gRE9XTiA/IChoZWlnaHQgLSAxKSA8PCA0IDogMDtcbiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBleHRlbnQ7IGkgKz0gaW5jcikge1xuICAgICAgeWllbGQgaSBhcyBQb3M7XG4gICAgfVxuICB9XG4gIGV4cG9ydCBjb25zdCBVUCA9IDAgYXMgRGlyO1xuICBleHBvcnQgY29uc3QgUklHSFQgPSAxIGFzIERpcjtcbiAgZXhwb3J0IGNvbnN0IERPV04gPSAyIGFzIERpcjtcbiAgZXhwb3J0IGNvbnN0IExFRlQgPSAzIGFzIERpcjtcbn1cblxuLyoqIEEgcG9zaXRpb24gb24gdGhlIG1hcDogeSBpbiB0aGUgaGlnaCBuaWJibGUsIHggaW4gdGhlIGxvdy4gKi9cbmV4cG9ydCB0eXBlIFBvcyA9IG51bWJlciAmIHtfX3Bvc19fOiBuZXZlcn07XG5cbmV4cG9ydCBuYW1lc3BhY2UgUG9zIHtcbiAgZXhwb3J0IGZ1bmN0aW9uIHBsdXMocG9zOiBQb3MsIGRpcjogRGlyKTogUG9zIHtcbiAgICByZXR1cm4gKHBvcyArIERpci5ERUxUQVtkaXJdKSBhcyBQb3M7XG4gIH1cblxuICAvLyBSZXR1cm5zIFtmb3J3YXJkLCByaWdodF1cbiAgLy8gZS5nLiAocDEgPSA2NSwgZDEgPSB1cCwgcDIgPSAyNCkgdGhlbiBmd2QgPSA0LCBydCA9IC0xXG4gIC8vIGJ1dCB3ZSBuZWVkIHRvIGZpbGwgNTUsIDQ1LCAzNSwgMzQsIDI0IC0gc28gNCByb3dzXG4gIGV4cG9ydCBmdW5jdGlvbiByZWxhdGl2ZShwMTogUG9zLCBkMTogRGlyLCBwMjogUG9zKTogW251bWJlciwgbnVtYmVyXSB7XG4gICAgY29uc3QgZHkgPSAocDIgPj4+IDQpIC0gKHAxID4+PiA0KTtcbiAgICBjb25zdCBkeCA9IChwMiAmIDB4ZikgLSAocDEgJiAweGYpO1xuICAgIGlmIChkMSA9PT0gMCkgcmV0dXJuIFstZHksIGR4XTtcbiAgICBpZiAoZDEgPT09IDEpIHJldHVybiBbZHgsIGR5XTtcbiAgICBpZiAoZDEgPT09IDIpIHJldHVybiBbZHksIC1keF07XG4gICAgaWYgKGQxID09PSAzKSByZXR1cm4gWy1keCwgLWR5XTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYGltcG9zc2libGU6ICR7ZDF9YCk7XG4gIH1cbn1cblxuLyoqXG4gKiAxNiAob3IgbW9yZSkgYml0IG51bWJlciwgaW4gNCBuaWJibGVzLCB3aGVyZSBlYWNoIGNvcnJlc3BvbmRzXG4gKiB0byBkaWZmZXJlbnQgc2NyZWVuIGludGVyZmFjZSB0eXBlcyAoZS5nLiBjbG9zZWQsIG9wZW4sIHJpdmVyLFxuICogZXRjKS4gIFRoZSBoaWdoZXIgYnl0ZSBzdG9yZXMgYW55IGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gKGUuZy5cbiAqIGZsYWcgc3RhdHVzLCBhbHRlcm5hdGl2ZXMsIGV0YykuICBNb3N0IG5pYmJsZXMgd2lsbCBiZSAwIG9yIDFcbiAqIGJ1dCB3ZSBtYXkgdXNlIGUuZy4gJ2YnIGZvciBhIFwiZml4ZWRcIiBzY3JlZW4gdGhhdCBtYXkgbm90IGJlXG4gKiBleHBhbmRlZCwgZXRjLiAgVGhlIG1hcHBpbmcgdG8gYWN0dWFsIHNjcmVlbiAob3Igc2NyZWVuK2ZsYWcpXG4gKiBjb21iaW5hdGlvbnMgaXMgdXAgdG8gdGhlIGNhbGxlci4gIFdlIGNhbiBhbHNvIHVzZSB0aGlzIHRvXG4gKiBkaXN0aW5ndWlzaCBzZXBhcmF0ZSBmbG9vcnMgdW5kZXIvb3ZlciBhIGJyaWRnZSAobWF5YmUgbWFrZSBhXG4gKiB0aHJlZS1sZXZlbCBzZXR1cD8/KSAtIGUuZy4gMTIxMiBmb3IgdGhlIGJyaWRnZSwgMTAyMCBmb3Igc3RhaXJzLlxuICovXG5leHBvcnQgdHlwZSBTY3IgPSBudW1iZXIgJiB7X19zY3JlZW5fXzogbmV2ZXJ9O1xuXG5leHBvcnQgbmFtZXNwYWNlIFNjciB7XG4gIGV4cG9ydCBmdW5jdGlvbiBlZGdlKHNjcmVlbjogU2NyLCBkaXI6IERpcik6IG51bWJlciB7XG4gICAgcmV0dXJuIChzY3JlZW4gPj4+IChkaXIgPDwgMikpICYgMHhmO1xuICB9XG4gIGV4cG9ydCBmdW5jdGlvbiBudW1FeGl0cyhzY3JlZW46IFNjcik6IG51bWJlciB7XG4gICAgbGV0IGNvdW50ID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykge1xuICAgICAgaWYgKHNjcmVlbiAmIDB4ZikgY291bnQrKztcbiAgICAgIHNjcmVlbiA9IChzY3JlZW4gPj4+IDQpIGFzIFNjcjtcbiAgICB9XG4gICAgcmV0dXJuIGNvdW50O1xuICB9XG4gIGV4cG9ydCBmdW5jdGlvbiBmcm9tRXhpdHMoZGlyTWFzazogRGlyTWFzaywgZXhpdFR5cGU6IG51bWJlcik6IFNjciB7XG4gICAgbGV0IHNjcmVlbiA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHtcbiAgICAgIHNjcmVlbiA8PD0gNDtcbiAgICAgIGlmIChkaXJNYXNrICYgOCkgc2NyZWVuIHw9IGV4aXRUeXBlO1xuICAgICAgZGlyTWFzayA9ICgoZGlyTWFzayAmIDcpIDw8IDEpIGFzIERpck1hc2s7XG4gICAgfVxuICAgIHJldHVybiBzY3JlZW4gYXMgU2NyO1xuICB9XG59XG4iXX0=