require('source-map-support').install();
const { describe, it } = require('mocha');
const { expect } = require('chai');
const { tokenize } = require('../dist/js/asm/tokenize.js');
const util = require('util');
const MATCH = Symbol();
describe('tokenize', function () {
    it('should tokenize a source file', function () {
        const toks = strip(tokenize(`
      ; comment is ignored
      label:
        lda #$1f ; also ignored
      .org $1c:$1234
      .ifdef XX
        .define YY
        .define YYZ %10101100
        pla
        sta ($11),y
      .elseif YY
        pha
      .endif`));
        expect(toks).to.eql([
            { token: 'ident', str: 'label' },
            { token: 'op', str: ':' },
            { token: 'eol' },
            { token: 'ident', str: 'lda' },
            { token: 'op', str: '#' },
            { token: 'num', num: 0x1f },
            { token: 'eol' },
            { token: 'cs', str: '.org' },
            { token: 'num', num: 0x1c },
            { token: 'op', str: ':' },
            { token: 'num', num: 0x1234 },
            { token: 'eol' },
            { token: 'cs', str: '.ifdef' },
            { token: 'ident', str: 'XX' },
            { token: 'eol' },
            { token: 'cs', str: '.define' },
            { token: 'ident', str: 'YY' },
            { token: 'eol' },
            { token: 'cs', str: '.define' },
            { token: 'ident', str: 'YYZ' },
            { token: 'num', num: 0b10101100 },
            { token: 'eol' },
            { token: 'ident', str: 'pla' },
            { token: 'eol' },
            { token: 'ident', str: 'sta' },
            { token: 'lp' },
            { token: 'num', num: 0x11 },
            { token: 'rp' },
            { token: 'op', str: ',' },
            { token: 'ident', str: 'y' },
            { token: 'eol' },
            { token: 'cs', str: '.elseif' },
            { token: 'ident', str: 'YY' },
            { token: 'eol' },
            { token: 'ident', str: 'pha' },
            { token: 'eol' },
            { token: 'cs', str: '.endif' },
        ]);
    });
    it('should tokenize a label', function () {
        expect(strip(tokenize('foo:'))).to.eql([
            { token: 'ident', str: 'foo' }, { token: 'op', str: ':' },
        ]);
    });
    it('should ignore comments', function () {
        expect(strip(tokenize('x ; ignored'))).to.eql([
            { token: 'ident', str: 'x' },
        ]);
    });
    it('should tokenize an .assert', function () {
        expect(strip(tokenize('.assert * = $0c:$8000'))).to.eql([
            { token: 'cs', str: '.assert' }, { token: 'op', str: '*' },
            { token: 'op', str: '=' }, { token: 'num', num: 0x0c },
            { token: 'op', str: ':' }, { token: 'num', num: 0x8000 },
        ]);
    });
    it('should tokenize a string literal with escapes', function () {
        expect(strip(tokenize(String.raw `"a\u1234\x12\;\"'"`))).to.eql([
            { token: 'str', str: 'a\u1234\x12;"\'' },
        ]);
    });
    it('should tokenize grouping characters', function () {
        expect(strip(tokenize('{([}])'))).to.eql([
            { token: 'lc' }, { token: 'lp' }, { token: 'lb' },
            { token: 'rc' }, { token: 'rb' }, { token: 'rp' },
        ]);
    });
    it('should tokenize a line with mismatched parens', function () {
        expect(strip(tokenize('qux foo({x}, {y)}, {z})'))).to.eql([
            { token: 'ident', str: 'qux' },
            { token: 'ident', str: 'foo' },
            { token: 'lp' },
            { token: 'lc' },
            { token: 'ident', str: 'x' },
            { token: 'rc' },
            { token: 'op', str: ',' },
            { token: 'lc' },
            { token: 'ident', str: 'y' },
            { token: 'rp' },
            { token: 'rc' },
            { token: 'op', str: ',' },
            { token: 'lc' },
            { token: 'ident', str: 'z' },
            { token: 'rc' },
            { token: 'rp' },
        ]);
    });
    it('should tokenize all kinds of numbers', function () {
        expect(strip(tokenize('123 0123 %10110 $123d'))).to.eql([
            { token: 'num', num: 123 },
            { token: 'num', num: 0o123 },
            { token: 'num', num: 0b10110 },
            { token: 'num', num: 0x123d },
        ]);
    });
    it('should fail to parse a bad number', function () {
        expect(() => {
            [...tokenize('  adc $1g')];
        }).to.throw(Error, /Invalid digits in hex number.*at input.s:0:6: '\$1g'/s);
        expect(() => {
            [...tokenize('  12a')];
        }).to.throw(Error, /Invalid digits in decimal.*at input.s:0:2: '12a'/s);
        expect(() => {
            [...tokenize('  018')];
        }).to.throw(Error, /Invalid digits in octal.*at input.s:0:2: '018'/s);
        expect(() => {
            [...tokenize('  %012')];
        }).to.throw(Error, /Invalid digits in binary.*at input.s:0:2: '%012'/s);
    });
    it('should fail to parse a bad character', function () {
        expect(() => {
            [...tokenize('  `abc')];
        }).to.throw(Error, /Syntax error.*at input.s:0:2: '`abc'/s);
    });
    it('should fail to parse a bad string', function () {
        expect(() => {
            [...tokenize('  "abc')];
        }).to.throw(Error, /EOF while looking for "/);
    });
});
function strip(toks) {
    const out = [...toks].map(t => {
        const { source, ...rest } = t;
        return rest;
    });
    expect(out.pop()).to.eql({ token: 'eof' });
    expect(out.pop()).to.eql({ token: 'eol' });
    return out;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9rZW5pemVfdGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRva2VuaXplX3Rlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDeEMsTUFBTSxFQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUMsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDeEMsTUFBTSxFQUFDLE1BQU0sRUFBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNqQyxNQUFNLEVBQUMsUUFBUSxFQUFDLEdBQUcsT0FBTyxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFDekQsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBRzdCLE1BQU0sS0FBSyxHQUFHLE1BQU0sRUFBRSxDQUFDO0FBRXZCLFFBQVEsQ0FBQyxVQUFVLEVBQUU7SUFDbkIsRUFBRSxDQUFDLCtCQUErQixFQUFFO1FBQ2xDLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7Ozs7Ozs7Ozs7OzthQVluQixDQUFDLENBQUMsQ0FBQztRQUVaLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDO1lBQ2xCLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFDO1lBQzlCLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFDO1lBQ3ZCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQztZQUNkLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFDO1lBQzVCLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFDO1lBQ3ZCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFDO1lBQ3pCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQztZQUNkLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFDO1lBQzFCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFDO1lBQ3pCLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFDO1lBQ3ZCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFDO1lBQzNCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQztZQUNkLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFDO1lBQzVCLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFDO1lBQzNCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQztZQUNkLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFDO1lBQzdCLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFDO1lBQzNCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQztZQUNkLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFDO1lBQzdCLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFDO1lBQzVCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFDO1lBQy9CLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQztZQUNkLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFDO1lBQzVCLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQztZQUNkLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFDO1lBQzVCLEVBQUMsS0FBSyxFQUFFLElBQUksRUFBQztZQUNiLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxF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QUFDLEVBQUUsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDLEVBQUUsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1NBQzVDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLCtDQUErQyxFQUFFO1FBQ2xELE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLHlCQUF5QixDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUM7WUFDeEQsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUM7WUFDNUIsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUM7WUFDNUIsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1lBQ2IsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1lBQ2IsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUM7WUFDMUIsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1lBQ2IsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUM7WUFDdkIsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1lBQ2IsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUM7WUFDMUIsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1lBQ2IsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1lBQ2IsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUM7WUFDdkIsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1lBQ2IsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUM7WUFDMUIsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1lBQ2IsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDO1NBQ2QsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsc0NBQXNDLEVBQUU7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YWxsKCk7XG5jb25zdCB7ZGVzY3JpYmUsIGl0fSA9IHJlcXVpcmUoJ21vY2hhJyk7XG5jb25zdCB7ZXhwZWN0fSA9IHJlcXVpcmUoJ2NoYWknKTtcbmNvbnN0IHt0b2tlbml6ZX0gPSByZXF1aXJlKCcuLi9kaXN0L2pzL2FzbS90b2tlbml6ZS5qcycpO1xuY29uc3QgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcbi8vY29uc3QgdmFsdWUgPSByZXF1aXJlKCcuLi9kaXN0L2pzL2FzbS92YWx1ZS5qcycpO1xuXG5jb25zdCBNQVRDSCA9IFN5bWJvbCgpO1xuXG5kZXNjcmliZSgndG9rZW5pemUnLCBmdW5jdGlvbigpIHtcbiAgaXQoJ3Nob3VsZCB0b2tlbml6ZSBhIHNvdXJjZSBmaWxlJywgZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgdG9rcyA9IHN0cmlwKHRva2VuaXplKGBcbiAgICAgIDsgY29tbWVudCBpcyBpZ25vcmVkXG4gICAgICBsYWJlbDpcbiAgICAgICAgbGRhICMkMWYgOyBhbHNvIGlnbm9yZWRcbiAgICAgIC5vcmcgJDFjOiQxMjM0XG4gICAgICAuaWZkZWYgWFhcbiAgICAgICAgLmRlZmluZSBZWVxuICAgICAgICAuZGVmaW5lIFlZWiAlMTAxMDExMDBcbiAgICAgICAgcGxhXG4gICAgICAgIHN0YSAoJDExKSx5XG4gICAgICAuZWxzZWlmIFlZXG4gICAgICAgIHBoYVxuICAgICAgLmVuZGlmYCkpO1xuXG4gICAgZXhwZWN0KHRva3MpLnRvLmVxbChbXG4gICAgICB7dG9rZW46ICdpZGVudCcsIHN0cjogJ2xhYmVsJ30sXG4gICAgICB7dG9rZW46ICdvcCcsIHN0cjogJzonfSxcbiAgICAgIHt0b2tlbjogJ2VvbCd9LFxuICAgICAge3Rva2VuOiAnaWRlbnQnLCBzdHI6ICdsZGEnfSxcbiAgICAgIHt0b2tlbjogJ29wJywgc3RyOiAnIyd9LFxuICAgICAge3Rva2VuOiAnbnVtJywgbnVtOiAweDFmfSxcbiAgICAgIHt0b2tlbjogJ2VvbCd9LFxuICAgICAge3Rva2VuOiAnY3MnLCBzdHI6ICcub3JnJ30sXG4gICAgICB7dG9rZW46ICdudW0nLCBudW06IDB4MWN9LFxuICAgICAge3Rva2VuOiAnb3AnLCBzdHI6ICc6J30sXG4gICAgICB7dG9rZW46ICdudW0nLCBudW06IDB4MTIzNH0sXG4gICAgICB7dG9rZW46ICdlb2wnfSxcbiAgICAgIHt0b2tlbjogJ2NzJywgc3RyOiAnLmlmZGVmJ30sXG4gICAgICB7dG9rZW46ICdpZGVudCcsIHN0cjogJ1hYJ30sXG4gICAgICB7dG9rZW46ICdlb2wnfSxcbiAgICAgIHt0b2tlbjogJ2NzJywgc3RyOiAnLmRlZmluZSd9LFxuICAgICAge3Rva2VuOiAnaWRlbnQnLCBzdHI6ICdZWSd9LFxuICAgICAge3Rva2VuOiAnZW9sJ30sXG4gICAgICB7dG9rZW46ICdjcycsIHN0cjogJy5kZWZpbmUnfSxcbiAgICAgIHt0b2tlbjogJ2lkZW50Jywgc3RyOiAnWVlaJ30sXG4gICAgICB7dG9rZW46ICdudW0nLCBudW06IDBiMTAxMDExMDB9LFxuICAgICAge3Rva2VuOiAnZW9sJ30sXG4gICAgICB7dG9rZW46ICdpZGVudCcsIHN0cjogJ3BsYSd9LFxuICAgICAge3Rva2VuOiAnZW9sJ30sXG4gICAgICB7dG9rZW46ICdpZGVudCcsIHN0cjogJ3N0YSd9LFxuICAgICAge3Rva2VuOiAnbHAnfSxcbiAgICAgIHt0b2tlbjogJ251bScsIG51bTogMHgxMX0sXG4gICAgICB7dG9rZW46ICdycCd9LFxuICAgICAge3Rva2VuOiAnb3AnLCBzdHI6ICcsJ30sXG4gICAgICB7dG9rZW46ICdpZGVudCcsIHN0cjogJ3knfSxcbiAgICAgIHt0b2tlbjogJ2VvbCd9LFxuICAgICAge3Rva2VuOiAnY3MnLCBzdHI6ICcuZWxzZWlmJ30sXG4gICAgICB7dG9rZW46ICdpZGVudCcsIHN0cjogJ1lZJ30sXG4gICAgICB7dG9rZW46ICdlb2wnfSxcbiAgICAgIHt0b2tlbjogJ2lkZW50Jywgc3RyOiAncGhhJ30sXG4gICAgICB7dG9rZW46ICdlb2wnfSxcbiAgICAgIHt0b2tlbjogJ2NzJywgc3RyOiAnLmVuZGlmJ30sXG4gICAgXSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgdG9rZW5pemUgYSBsYWJlbCcsIGZ1bmN0aW9uKCkgeyBcbiAgICBleHBlY3Qoc3RyaXAodG9rZW5pemUoJ2ZvbzonKSkpLnRvLmVxbChbXG4gICAgICB7dG9rZW46ICdpZGVudCcsIHN0cjogJ2Zvbyd9LCB7dG9rZW46ICdvcCcsIHN0cjogJzonfSxcbiAgICBdKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBpZ25vcmUgY29tbWVudHMnLCBmdW5jdGlvbigpIHsgXG4gICAgZXhwZWN0KHN0cmlwKHRva2VuaXplKCd4IDsgaWdub3JlZCcpKSkudG8uZXFsKFtcbiAgICAgIHt0b2tlbjogJ2lkZW50Jywgc3RyOiAneCd9LFxuICAgIF0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHRva2VuaXplIGFuIC5hc3NlcnQnLCBmdW5jdGlvbigpIHtcbiAgICBleHBlY3Qoc3RyaXAodG9rZW5pemUoJy5hc3NlcnQgKiA9ICQwYzokODAwMCcpKSkudG8uZXFsKFtcbiAgICAgIHt0b2tlbjogJ2NzJywgc3RyOiAnLmFzc2VydCd9LCB7dG9rZW46ICdvcCcsIHN0cjogJyonfSxcbiAgICAgIHt0b2tlbjogJ29wJywgc3RyOiAnPSd9LCB7dG9rZW46ICdudW0nLCBudW06IDB4MGN9LFxuICAgICAge3Rva2VuOiAnb3AnLCBzdHI6ICc6J30sIHt0b2tlbjogJ251bScsIG51bTogMHg4MDAwfSxcbiAgICBdKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB0b2tlbml6ZSBhIHN0cmluZyBsaXRlcmFsIHdpdGggZXNjYXBlcycsIGZ1bmN0aW9uKCkge1xuICAgIGV4cGVjdChzdHJpcCh0b2tlbml6ZShTdHJpbmcucmF3YFwiYVxcdTEyMzRcXHgxMlxcO1xcXCInXCJgKSkpLnRvLmVxbChbXG4gICAgICB7dG9rZW46ICdzdHInLCBzdHI6ICdhXFx1MTIzNFxceDEyO1wiXFwnJ30sXG4gICAgXSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgdG9rZW5pemUgZ3JvdXBpbmcgY2hhcmFjdGVycycsIGZ1bmN0aW9uKCkge1xuICAgIGV4cGVjdChzdHJpcCh0b2tlbml6ZSgneyhbfV0pJykpKS50by5lcWwoW1xuICAgICAge3Rva2VuOiAnbGMnfSwge3Rva2VuOiAnbHAnfSwge3Rva2VuOiAnbGInfSxcbiAgICAgIHt0b2tlbjogJ3JjJ30sIHt0b2tlbjogJ3JiJ30sIHt0b2tlbjogJ3JwJ30sXG4gICAgXSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgdG9rZW5pemUgYSBsaW5lIHdpdGggbWlzbWF0Y2hlZCBwYXJlbnMnLCBmdW5jdGlvbigpIHtcbiAgICBleHBlY3Qoc3RyaXAodG9rZW5pemUoJ3F1eCBmb28oe3h9LCB7eSl9LCB7en0pJykpKS50by5lcWwoW1xuICAgICAge3Rva2VuOiAnaWRlbnQnLCBzdHI6ICdxdXgnfSxcbiAgICAgIHt0b2tlbjogJ2lkZW50Jywgc3RyOiAnZm9vJ30sXG4gICAgICB7dG9rZW46ICdscCd9LFxuICAgICAge3Rva2VuOiAnbGMnfSxcbiAgICAgIHt0b2tlbjogJ2lkZW50Jywgc3RyOiAneCd9LFxuICAgICAge3Rva2VuOiAncmMnfSxcbiAgICAgIHt0b2tlbjogJ29wJywgc3RyOiAnLCd9LFxuICAgICAge3Rva2VuOiAnbGMnfSxcbiAgICAgIHt0b2tlbjogJ2lkZW50Jywgc3RyOiAneSd9LFxuICAgICAge3Rva2VuOiAncnAnfSxcbiAgICAgIHt0b2tlbjogJ3JjJ30sXG4gICAgICB7dG9rZW46ICdvcCcsIHN0cjogJywnfSxcbiAgICAgIHt0b2tlbjogJ2xjJ30sXG4gICAgICB7dG9rZW46ICdpZGVudCcsIHN0cjogJ3onfSxcbiAgICAgIHt0b2tlbjogJ3JjJ30sXG4gICAgICB7dG9rZW46ICdycCd9LFxuICAgIF0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHRva2VuaXplIGFsbCBraW5kcyBvZiBudW1iZXJzJywgZnVuY3Rpb24oKSB7XG4gICAgZXhwZWN0KHN0cmlwKHRva2VuaXplKCcxMjMgMDEyMyAlMTAxMTAgJDEyM2QnKSkpLnRvLmVxbChbXG4gICAgICB7dG9rZW46ICdudW0nLCBudW06IDEyM30sXG4gICAgICB7dG9rZW46ICdudW0nLCBudW06IDBvMTIzfSxcbiAgICAgIHt0b2tlbjogJ251bScsIG51bTogMGIxMDExMH0sXG4gICAgICB7dG9rZW46ICdudW0nLCBudW06IDB4MTIzZH0sXG4gICAgXSk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZmFpbCB0byBwYXJzZSBhIGJhZCBudW1iZXInLCBmdW5jdGlvbigpIHtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgWy4uLnRva2VuaXplKCcgIGFkYyAkMWcnKV07XG4gICAgfSkudG8udGhyb3coRXJyb3IsIC9JbnZhbGlkIGRpZ2l0cyBpbiBoZXggbnVtYmVyLiphdCBpbnB1dC5zOjA6NjogJ1xcJDFnJy9zKTtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgWy4uLnRva2VuaXplKCcgIDEyYScpXTtcbiAgICB9KS50by50aHJvdyhFcnJvciwgL0ludmFsaWQgZGlnaXRzIGluIGRlY2ltYWwuKmF0IGlucHV0LnM6MDoyOiAnMTJhJy9zKTtcbiAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgWy4uLnRva2VuaXplKCcgIDAxOCcpXTtcbiAgICB9KS50by50aHJvdyhFcnJvciwgL0ludmFsaWQgZGlnaXRzIGluIG9jdGFsLiphdCBpbnB1dC5zOjA6MjogJzAxOCcvcyk7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIFsuLi50b2tlbml6ZSgnICAlMDEyJyldO1xuICAgIH0pLnRvLnRocm93KEVycm9yLCAvSW52YWxpZCBkaWdpdHMgaW4gYmluYXJ5LiphdCBpbnB1dC5zOjA6MjogJyUwMTInL3MpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZhaWwgdG8gcGFyc2UgYSBiYWQgY2hhcmFjdGVyJywgZnVuY3Rpb24oKSB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIFsuLi50b2tlbml6ZSgnICBgYWJjJyldO1xuICAgIH0pLnRvLnRocm93KEVycm9yLCAvU3ludGF4IGVycm9yLiphdCBpbnB1dC5zOjA6MjogJ2BhYmMnL3MpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZhaWwgdG8gcGFyc2UgYSBiYWQgc3RyaW5nJywgZnVuY3Rpb24oKSB7XG4gICAgZXhwZWN0KCgpID0+IHtcbiAgICAgIFsuLi50b2tlbml6ZSgnICBcImFiYycpXTtcbiAgICB9KS50by50aHJvdyhFcnJvciwgL0VPRiB3aGlsZSBsb29raW5nIGZvciBcIi8pO1xuICB9KTtcbn0pO1xuXG5mdW5jdGlvbiBzdHJpcCh0b2tzKSB7XG4gIGNvbnN0IG91dCA9IFsuLi50b2tzXS5tYXAodCA9PiB7XG4gICAgY29uc3Qge3NvdXJjZSwgLi4ucmVzdH0gPSB0O1xuICAgIHJldHVybiByZXN0O1xuICB9KTtcbiAgZXhwZWN0KG91dC5wb3AoKSkudG8uZXFsKHt0b2tlbjogJ2VvZid9KTtcbiAgZXhwZWN0KG91dC5wb3AoKSkudG8uZXFsKHt0b2tlbjogJ2VvbCd9KTtcbiAgLy9jb25zb2xlLmxvZyh1dGlsLmluc3BlY3Qob3V0LCB7c2hvd0hpZGRlbjogZmFsc2UsIGRlcHRoOiBudWxsfSkpXG4gIHJldHVybiBvdXQ7XG59XG4iXX0=