export class Spoiler {
    constructor(rom) {
        this.rom = rom;
        this.slots = [];
        this.route = [];
        this.mazes = [];
        this.trades = [];
        this.walls = [];
        this.unidentifiedItems = [];
        this.wildWarps = [];
        this.flags = '';
    }
    addCheck(condition, deps) {
        this.route.push(new Check(this, condition, deps));
    }
    addSlot(slot, slotName, item) {
        this.slots[slot & 0xff] =
            new Slot(this.rom, slot & 0xff, slotName, item & 0xff);
    }
    addMaze(id, name, maze) {
        this.mazes.push({ id, name, maze });
    }
    addTrade(itemId, item, npc) {
        this.trades.push({ itemId, item, npc });
    }
    addUnidentifiedItem(itemId, oldName, newName) {
        this.unidentifiedItems.push({ itemId, oldName, newName });
    }
    addWall(location, oldElement, newElement) {
        this.walls.push({ location, oldElement, newElement });
    }
    addWildWarp(id, name) {
        this.wildWarps.push({ id, name });
    }
    formatCondition(id) {
        var _a;
        return (_a = this.rom.flags[id]) === null || _a === void 0 ? void 0 : _a.name;
    }
    formatConditionList(conditions) {
        var _a;
        const terms = [];
        for (const c of conditions) {
            const f = this.rom.flags[c];
            if ((_a = f) === null || _a === void 0 ? void 0 : _a.logic.track)
                terms.push(f.name);
        }
        return terms.join(', ');
    }
}
class Check {
    constructor(spoiler, condition, deps) {
        this.spoiler = spoiler;
        this.condition = condition;
        this.deps = deps;
    }
    toString() {
        let item = 0;
        if ((this.condition & ~0x7f) === 0x100) {
            item = 0x200 | this.spoiler.rom.slots[this.condition & 0xff];
        }
        return `${this.spoiler.formatCondition(this.condition)}${item ? ` (${this.spoiler.formatCondition(item)})` : ''}: [${this.spoiler.formatConditionList(this.deps)}]`;
    }
}
class Slot {
    constructor(rom, slot, slotName, item) {
        this.slot = slot;
        this.slotName = slotName;
        this.item = item;
        this.itemName = slotToItem(rom, item);
        this.originalItem = slotToItem(rom, slot);
    }
    toString() {
        return `${this.itemName}: ${this.slotName} (${this.originalItem})`;
    }
}
function slotToItem(rom, slot) {
    if (slot >= 0x70)
        return 'Mimic';
    return rom.items[rom.itemGets[slot].itemId].messageName;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BvaWxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vc3BvaWxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFXQSxNQUFNLE9BQU8sT0FBTztJQVlsQixZQUFxQixHQUFRO1FBQVIsUUFBRyxHQUFILEdBQUcsQ0FBSztRQVhwQixVQUFLLEdBQVcsRUFBRSxDQUFDO1FBQ25CLFVBQUssR0FBWSxFQUFFLENBQUM7UUFDcEIsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUNuQixXQUFNLEdBQVksRUFBRSxDQUFDO1FBQ3JCLFVBQUssR0FBVyxFQUFFLENBQUM7UUFDbkIsc0JBQWlCLEdBQXVCLEVBQUUsQ0FBQztRQUMzQyxjQUFTLEdBQWUsRUFBRSxDQUFDO1FBQ3BDLFVBQUssR0FBVyxFQUFFLENBQUM7SUFJYSxDQUFDO0lBRWpDLFFBQVEsQ0FBQyxTQUFpQixFQUFFLElBQXVCO1FBQ2pELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQsT0FBTyxDQUFDLElBQVksRUFBRSxRQUFnQixFQUFFLElBQVk7UUFDbEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ25CLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxHQUFHLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRCxPQUFPLENBQUMsRUFBVSxFQUFFLElBQVksRUFBRSxJQUFZO1FBQzVDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxRQUFRLENBQUMsTUFBYyxFQUFFLElBQVksRUFBRSxHQUFX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USxLQUFLLElBQUksQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDO0lBQ3JFLENBQUM7Q0FDRjtBQUVELFNBQVMsVUFBVSxDQUFDLEdBQVEsRUFBRSxJQUFZO0lBQ3hDLElBQUksSUFBSSxJQUFJLElBQUk7UUFBRSxPQUFPLE9BQU8sQ0FBQztJQUNqQyxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxXQUFXLENBQUM7QUFDMUQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuXG4vKipcbiAqIFN0b3JlcyBvcmdhbml6ZWQgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNodWZmbGUsIGluY2x1ZGluZ1xuICogICAtIHdoaWNoIGl0ZW1zIGFyZSBpbiB3aGljaCBzbG90c1xuICogICAtIGEga25vd24td29ya2luZyByb3V0ZSB0aHJvdWdoIHRoZSBnYW1lXG4gKiAgIC0gd2hpY2ggZW5lbWllcyBhcmUgc2h1ZmZsZSB3aGVyZVxuICogICAtIGVuZW15IHZ1bG5lcmFiaWxpdGllc1xuICogICAtIGxvY2F0aW9uIGNvbm5lY3Rpb25zXG4gKiAgIC0gcm91dGVzIHRvIGVhY2ggYXJlYVxuICovXG5leHBvcnQgY2xhc3MgU3BvaWxlciB7XG4gIHJlYWRvbmx5IHNsb3RzOiBTbG90W10gPSBbXTtcbiAgcmVhZG9ubHkgcm91dGU6IENoZWNrW10gPSBbXTtcbiAgcmVhZG9ubHkgbWF6ZXM6IE1hemVbXSA9IFtdO1xuICByZWFkb25seSB0cmFkZXM6IFRyYWRlW10gPSBbXTtcbiAgcmVhZG9ubHkgd2FsbHM6IFdhbGxbXSA9IFtdO1xuICByZWFkb25seSB1bmlkZW50aWZpZWRJdGVtczogVW5pZGVudGlmaWVkSXRlbVtdID0gW107XG4gIHJlYWRvbmx5IHdpbGRXYXJwczogV2lsZFdhcnBbXSA9IFtdO1xuICBmbGFnczogc3RyaW5nID0gJyc7XG5cbiAgLy8gVE9ETyAtIHNob3BzLCBib3NzIHdlYWtuZXNzZXNcblxuICBjb25zdHJ1Y3RvcihyZWFkb25seSByb206IFJvbSkge31cblxuICBhZGRDaGVjayhjb25kaXRpb246IG51bWJlciwgZGVwczogcmVhZG9ubHkgbnVtYmVyW10pOiB2b2lkIHtcbiAgICB0aGlzLnJvdXRlLnB1c2gobmV3IENoZWNrKHRoaXMsIGNvbmRpdGlvbiwgZGVwcykpO1xuICB9XG5cbiAgYWRkU2xvdChzbG90OiBudW1iZXIsIHNsb3ROYW1lOiBzdHJpbmcsIGl0ZW06IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuc2xvdHNbc2xvdCAmIDB4ZmZdID1cbiAgICAgICAgbmV3IFNsb3QodGhpcy5yb20sIHNsb3QgJiAweGZmLCBzbG90TmFtZSwgaXRlbSAmIDB4ZmYpO1xuICB9XG5cbiAgYWRkTWF6ZShpZDogbnVtYmVyLCBuYW1lOiBzdHJpbmcsIG1hemU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMubWF6ZXMucHVzaCh7aWQsIG5hbWUsIG1hemV9KTtcbiAgfVxuXG4gIGFkZFRyYWRlKGl0ZW1JZDogbnVtYmVyLCBpdGVtOiBzdHJpbmcsIG5wYzogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy50cmFkZXMucHVzaCh7aXRlbUlkLCBpdGVtLCBucGN9KTtcbiAgfVxuXG4gIGFkZFVuaWRlbnRpZmllZEl0ZW0oaXRlbUlkOiBudW1iZXIsIG9sZE5hbWU6IHN0cmluZywgbmV3TmFtZTogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy51bmlkZW50aWZpZWRJdGVtcy5wdXNoKHtpdGVtSWQsIG9sZE5hbWUsIG5ld05hbWV9KTtcbiAgfVxuXG4gIGFkZFdhbGwobG9jYXRpb246IHN0cmluZywgb2xkRWxlbWVudDogbnVtYmVyLCBuZXdFbGVtZW50OiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLndhbGxzLnB1c2goe2xvY2F0aW9uLCBvbGRFbGVtZW50LCBuZXdFbGVtZW50fSk7XG4gIH1cblxuICBhZGRXaWxkV2FycChpZDogbnVtYmVyLCBuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLndpbGRXYXJwcy5wdXNoKHtpZCwgbmFtZX0pO1xuICB9XG5cbiAgZm9ybWF0Q29uZGl0aW9uKGlkOiBudW1iZXIpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnJvbS5mbGFnc1tpZF0/Lm5hbWVcbiAgfVxuXG4gIGZvcm1hdENvbmRpdGlvbkxpc3QoY29uZGl0aW9uczogcmVhZG9ubHkgbnVtYmVyW10pOiBzdHJpbmcge1xuICAgIGNvbnN0IHRlcm1zOiBzdHJpbmdbXSA9IFtdO1xuICAgIGZvciAoY29uc3QgYyBvZiBjb25kaXRpb25zKSB7XG4gICAgICBjb25zdCBmID0gdGhpcy5yb20uZmxhZ3NbY107XG4gICAgICBpZiAoZj8ubG9naWMudHJhY2spIHRlcm1zLnB1c2goZi5uYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIHRlcm1zLmpvaW4oJywgJyk7XG4gIH1cbn1cblxuaW50ZXJmYWNlIE1hemUge1xuICBpZDogbnVtYmVyO1xuICBuYW1lOiBzdHJpbmc7XG4gIG1hemU6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFRyYWRlIHtcbiAgaXRlbUlkOiBudW1iZXI7XG4gIGl0ZW06IHN0cmluZztcbiAgbnBjOiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBVbmlkZW50aWZpZWRJdGVtIHtcbiAgaXRlbUlkOiBudW1iZXI7XG4gIG9sZE5hbWU6IHN0cmluZztcbiAgbmV3TmFtZTogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgV2FsbCB7XG4gIGxvY2F0aW9uOiBzdHJpbmc7XG4gIG9sZEVsZW1lbnQ6IG51bWJlcjtcbiAgbmV3RWxlbWVudDogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgV2lsZFdhcnAge1xuICBpZDogbnVtYmVyO1xuICBuYW1lOiBzdHJpbmc7XG59XG5cbmNsYXNzIENoZWNrIHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgc3BvaWxlcjogU3BvaWxlcixcbiAgICAgICAgICAgICAgcmVhZG9ubHkgY29uZGl0aW9uOiBudW1iZXIsXG4gICAgICAgICAgICAgIHJlYWRvbmx5IGRlcHM6IHJlYWRvbmx5IG51bWJlcltdKSB7fVxuXG4gIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgbGV0IGl0ZW0gPSAwO1xuICAgIGlmICgodGhpcy5jb25kaXRpb24gJiB+MHg3ZikgPT09IDB4MTAwKSB7XG4gICAgICBpdGVtID0gMHgyMDAgfCB0aGlzLnNwb2lsZXIucm9tLnNsb3RzW3RoaXMuY29uZGl0aW9uICYgMHhmZl07XG4gICAgfVxuICAgIHJldHVybiBgJHt0aGlzLnNwb2lsZXIuZm9ybWF0Q29uZGl0aW9uKHRoaXMuY29uZGl0aW9uKX0ke1xuICAgICAgICAgICAgaXRlbSA/IGAgKCR7dGhpcy5zcG9pbGVyLmZvcm1hdENvbmRpdGlvbihpdGVtKX0pYCA6ICcnXG4gICAgICAgICAgICB9OiBbJHt0aGlzLnNwb2lsZXIuZm9ybWF0Q29uZGl0aW9uTGlzdCh0aGlzLmRlcHMpfV1gO1xuICB9XG59XG5cbmNsYXNzIFNsb3Qge1xuICByZWFkb25seSBpdGVtTmFtZTogc3RyaW5nO1xuICByZWFkb25seSBvcmlnaW5hbEl0ZW06IHN0cmluZztcblxuICBjb25zdHJ1Y3Rvcihyb206IFJvbSxcbiAgICAgICAgICAgICAgcmVhZG9ubHkgc2xvdDogbnVtYmVyLFxuICAgICAgICAgICAgICByZWFkb25seSBzbG90TmFtZTogc3RyaW5nLFxuICAgICAgICAgICAgICByZWFkb25seSBpdGVtOiBudW1iZXIpIHtcbiAgICB0aGlzLml0ZW1OYW1lID0gc2xvdFRvSXRlbShyb20sIGl0ZW0pO1xuICAgIHRoaXMub3JpZ2luYWxJdGVtID0gc2xvdFRvSXRlbShyb20sIHNsb3QpO1xuICB9XG5cbiAgdG9TdHJpbmcoKTogc3RyaW5nIHtcbiAgICAvLyBGaWd1cmUgb3V0IHRoZSBuYW1lIG9mIHRoZSBzbG90LCB0aGUgb3JpZ2luYWwgaXRlbSwgZXRjXG4gICAgcmV0dXJuIGAke3RoaXMuaXRlbU5hbWV9OiAke3RoaXMuc2xvdE5hbWV9ICgke3RoaXMub3JpZ2luYWxJdGVtfSlgO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNsb3RUb0l0ZW0ocm9tOiBSb20sIHNsb3Q6IG51bWJlcik6IHN0cmluZyB7XG4gIGlmIChzbG90ID49IDB4NzApIHJldHVybiAnTWltaWMnO1xuICByZXR1cm4gcm9tLml0ZW1zW3JvbS5pdGVtR2V0c1tzbG90XS5pdGVtSWRdLm1lc3NhZ2VOYW1lO1xufVxuIl19