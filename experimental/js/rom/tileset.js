import { Entity } from './entity.js';
import { MapScreen } from './mapscreen.js';
import { seq, tuple } from './util.js';
export class Tileset extends Entity {
    constructor(rom, id) {
        super(rom, id);
        this.tiles = seq(4, q => tuple(rom.prg, this.tileBase | q << 8, 256));
        this.attrs = seq(256, i => rom.prg[this.attrBase | i >> 2] >> ((i & 3) << 1) & 3);
        this.alternates = tuple(rom.prg, this.alternatesBase, 32);
    }
    get map() {
        return this.id & 0x3f;
    }
    get tileBase() {
        return 0x10000 | this.map << 8;
    }
    get attrBase() {
        return 0x13000 | this.map << 4;
    }
    get alternatesBase() {
        return 0x13e00 | this.map << 3;
    }
    get screens() {
        if (this.lazyScreens)
            return this.lazyScreens;
        return this.lazyScreens =
            seq(256, i => new MapScreen(this.rom.screens[i], this));
    }
    write() {
        const attr = seq(0x40, i => {
            const j = i << 2;
            return (this.attrs[j] & 3) | (this.attrs[j + 1] & 3) << 2 |
                (this.attrs[j + 2] & 3) << 4 | (this.attrs[j + 3] & 3) << 6;
        });
        const a = this.rom.assembler();
        a.segment('08', '09');
        a.org(0x8000 | this.map << 8);
        a.byte(...[].concat(...this.tiles));
        a.org(0xb000 | this.map << 4);
        a.byte(...attr);
        a.org(0xbe00 | this.map << 3);
        a.byte(...this.alternates);
        return [a.module()];
    }
    effects() {
        let index = (this.id >>> 2) & 0xf;
        if (this.id === 0xa8)
            index = 2;
        if (this.id === 0xac)
            index--;
        return this.rom.tileEffects[index];
    }
}
const NONE = 0;
const TRIM = 1;
const MAIN = 2;
export function paletteTypes(tileset, location) {
    switch (location) {
        case 0x1a:
            return [MAIN, MAIN, TRIM, (p0, p1, p2) => p0[3] === p1[3] && p1[3] === p2[3]];
        case 0x43:
            return [MAIN, TRIM, TRIM];
        case 0x57:
            return [MAIN, NONE, NONE];
        case 0x60:
            return [MAIN, MAIN, MAIN, (p0, _p1, p2) => p0[2] === p2[2]];
        case 0x64:
        case 0x68:
            return [MAIN, NONE, TRIM];
        case 0x7c:
            return [MAIN, TRIM, TRIM];
    }
    switch (tileset) {
        case 0x80:
        case 0x84:
            return [MAIN, MAIN, TRIM, (p0, p1) => p0[3] === p1[3]];
        case 0x88:
            return [MAIN, TRIM, NONE];
        case 0x8c: return [MAIN, TRIM, MAIN];
        case 0x90: return [MAIN, MAIN, MAIN];
        case 0x94: return [MAIN, TRIM, TRIM, (p0, p1) => p0[3] === p1[3]];
        case 0x98: return [TRIM, TRIM, TRIM];
        case 0x9c: return [MAIN, TRIM, MAIN];
        case 0xa0: return [TRIM, TRIM, TRIM];
        case 0xa4: return [MAIN, MAIN, TRIM];
        case 0xa8: return [MAIN, MAIN, TRIM];
        case 0xac: return [MAIN, TRIM, MAIN];
    }
    throw new Error(`unxpected: ${tileset}`);
}
const ALLOWED_PALETTES = new Map([
    ['path', [...r(0x00, 0x12), ...r(0x15, 0x1b), ...r(0x1e, 0x25),
            ...r(0x26, 0x2b), ...r(0x2c, 0x30), ...r(0x39, 0x3f),
            0x42, ...r(0x44, 0x48), ...r(0x4d, 0x59), ...r(0x80, 0x84),
            0x87, ...r(0x8b, 0x93)]],
    ['mountain', [0x01, ...r(0x03, 0x07), ...r(0x08, 0x0b), 0x0c, 0x0d, 0x0e,
            ...r(0x11, 0x18), 0x19, 0x1a, 0x1c, 0x1d, 0x1e, 0x20, 0x21,
            0x23, 0x27, 0x2a, 0x2b, 0x2f, 0x31, 0x33, 0x36, 0x37, 0x38,
            0x39, 0x3c, 0x42, 0x44, 0x46, 0x4b, 0x4c, 0x4f, 0x53, 0x58,
            ...r(0x80, 0x85), 0x87, 0x88, 0x8b, 0x8e]],
    ['trees', [0x01, 0x02, 0x04, 0x06, ...r(0x07, 0x0f), ...r(0x14, 0x18),
            0x1a, 0x1c, 0x1e, 0x20, 0x23, 0x27, 0x29, 0x2a, 0x2b, 0x2e,
            0x2f, 0x31, 0x33, 0x37, 0x38, 0x39, 0x3c, 0x3d, 0x43, 0x44,
            0x46, 0x49, 0x4a, 0x4b, 0x4f, 0x52, 0x57, 0x6e,
            ...r(0x80, 0x85), 0x87, 0x88, ...r(0x8b, 0x90)]],
]);
const TERRAIN_BY_PALETTE = new Map([
    [0x80, ['path', 'mountain', 'trees']],
    [0x84, ['mountain-path', 'brick', 'trees']],
    [0x88, ['cave wall/ground', 'cave bridge', '']],
    [0x8c, ['floor', 'fire', 'accept']],
    [0x90, ['trees', 'mountain', 'grass']],
    [0x94, ['water/ground', 'mountain', 'shallows']],
    [0x98, ['door', 'room', 'rocks']],
    [0x9c, ['mountain/ground', 'trees', 'desert']],
    [0xa0, ['ground', 'trees', 'some haze']],
    [0xa4, ['', '', '']],
    [0xa8, ['', '', '']],
    [0xac, ['', '', '']],
]);
function r(a, b) {
    return new Array(b - a).fill(0).map((_x, i) => i + a);
}
const [] = [TERRAIN_BY_PALETTE, ALLOWED_PALETTES];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGlsZXNldC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vdGlsZXNldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUMsTUFBTSxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBQ25DLE9BQU8sRUFBQyxTQUFTLEVBQUMsTUFBTSxnQkFBZ0IsQ0FBQztBQUV6QyxPQUFPLEVBQUMsR0FBRyxFQUFFLEtBQUssRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUdyQyxNQUFNLE9BQU8sT0FBUSxTQUFRLE1BQU07SUFRakMsWUFBWSxHQUFRLEVBQUUsRUFBVTtRQUU5QixLQUFLLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLFFBQVEsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDdkUsSUFBSSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2xGLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBRUQsSUFBWSxHQUFHO1FBQ2IsT0FBTyxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQztJQUN4QixDQUFDO0lBRUQsSUFBSSxRQUFRO1FBQ1YsT0FBTyxPQUFPLEdB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QU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztZQUNwRCxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUM7WUFDcEQsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztZQUMxRCxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDbEMsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDM0QsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDMUQsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtZQUMxRCxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO1lBQzFELEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN2RCxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQztZQUMxRCxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJO1lBQzFELElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDMUQsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUk7WUFDOUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7Q0FFNUQsQ0FBQyxDQUFDO0FBY0gsTUFBTSxrQkFBa0IsR0FBRyxJQUFJLEdBQUcsQ0FBNEM7SUFDNUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JDLENBQUMsSUFBSSxFQUFFLENBQUMsZUFBZSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztJQUMzQyxDQUFDLElBQUksRUFBRSxDQUFDLGtCQUFrQixFQUFFLGFBQWEsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUUvQyxDQUFDLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDbkMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBS3RDLENBQUMsSUFBSSxFQUFFLENBQUMsY0FBYyxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUNoRCxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFFakMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFHOUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ3hDLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNwQixDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDcEIsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0NBQ3JCLENBQUMsQ0FBQztBQUVILFNBQVMsQ0FBQyxDQUFDLENBQVMsRUFBRSxDQUFTO0lBQzdCLE9BQU8sSUFBSSxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDeEQsQ0FBQztBQUVELE1BQU0sRUFBRSxHQUFHLENBQUMsa0JBQWtCLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7TW9kdWxlfSBmcm9tICcuLi9hc20vbW9kdWxlLmpzJztcbmltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuaW1wb3J0IHtFbnRpdHl9IGZyb20gJy4vZW50aXR5LmpzJztcbmltcG9ydCB7TWFwU2NyZWVufSBmcm9tICcuL21hcHNjcmVlbi5qcyc7XG5pbXBvcnQge1RpbGVFZmZlY3RzfSBmcm9tICcuL3RpbGVlZmZlY3RzLmpzJztcbmltcG9ydCB7c2VxLCB0dXBsZX0gZnJvbSAnLi91dGlsLmpzJztcblxuLy8gTWFwcHBpbmcgZnJvbSBtZXRhdGlsZSBJRCB0byB0aWxlIHF1YWRzIGFuZCBwYWxldHRlIG51bWJlci5cbmV4cG9ydCBjbGFzcyBUaWxlc2V0IGV4dGVuZHMgRW50aXR5IHtcblxuICB0aWxlczogbnVtYmVyW11bXTsgICAgLy8gdGlsZSBpbmZvLCBvdXRlciBpcyA0IHF1YWRyYW50cyAoVEwsIFRSLCBCTCwgQlIpXG4gIGF0dHJzOiBudW1iZXJbXTsgICAgICAvLyBwYWxldHRlIGluZm9cbiAgYWx0ZXJuYXRlczogbnVtYmVyW107IC8vIDMyLWVsZW1lbnQgbWFwcGluZyBmb3IgZmxhZy1iYXNlZCBhbHRlcm5hdGVzXG5cbiAgcHJpdmF0ZSBsYXp5U2NyZWVucz86IHJlYWRvbmx5IE1hcFNjcmVlbltdO1xuXG4gIGNvbnN0cnVjdG9yKHJvbTogUm9tLCBpZDogbnVtYmVyKSB7XG4gICAgLy8gYGlkYCBpcyBNYXBEYXRhWzFdWzNdLCByYW5nZXMgZnJvbSAkODAuLiRiYyBpbiBpbmNyZW1lbnRzIG9mIDQuXG4gICAgc3VwZXIocm9tLCBpZCk7XG4gICAgdGhpcy50aWxlcyA9IHNlcSg0LCBxID0+IHR1cGxlKHJvbS5wcmcsIHRoaXMudGlsZUJhc2UgfCBxIDw8IDggLCAyNTYpKTtcbiAgICB0aGlzLmF0dHJzID0gc2VxKDI1NiwgaSA9PiByb20ucHJnW3RoaXMuYXR0ckJhc2UgfCBpID4+IDJdID4+ICgoaSAmIDMpIDw8IDEpICYgMyk7XG4gICAgdGhpcy5hbHRlcm5hdGVzID0gdHVwbGUocm9tLnByZywgdGhpcy5hbHRlcm5hdGVzQmFzZSwgMzIpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgbWFwKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuaWQgJiAweDNmO1xuICB9XG5cbiAgZ2V0IHRpbGVCYXNlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIDB4MTAwMDAgfCB0aGlzLm1hcCA8PCA4O1xuICB9XG5cbiAgZ2V0IGF0dHJCYXNlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIDB4MTMwMDAgfCB0aGlzLm1hcCA8PCA0O1xuICB9XG5cbiAgZ2V0IGFsdGVybmF0ZXNCYXNlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIDB4MTNlMDAgfCB0aGlzLm1hcCA8PCAzO1xuICB9XG5cbiAgZ2V0IHNjcmVlbnMoKTogcmVhZG9ubHkgTWFwU2NyZWVuW10ge1xuICAgIGlmICh0aGlzLmxhenlTY3JlZW5zKSByZXR1cm4gdGhpcy5sYXp5U2NyZWVucztcbiAgICByZXR1cm4gdGhpcy5sYXp5U2NyZWVucyA9XG4gICAgICAgIHNlcSgyNTYsIGkgPT4gbmV3IE1hcFNjcmVlbih0aGlzLnJvbS5zY3JlZW5zW2ldLCB0aGlzKSk7XG4gIH1cblxuICB3cml0ZSgpOiBNb2R1bGVbXSB7XG4gICAgY29uc3QgYXR0ciA9IHNlcSgweDQwLCBpID0+IHtcbiAgICAgIGNvbnN0IGogPSBpIDw8IDI7XG4gICAgICByZXR1cm4gKHRoaXMuYXR0cnNbal0gJiAzKSB8ICh0aGlzLmF0dHJzW2ogKyAxXSAmIDMpIDw8IDIgfFxuICAgICAgICAgICAgICh0aGlzLmF0dHJzW2ogKyAyXSAmIDMpIDw8IDQgfCAodGhpcy5hdHRyc1tqICsgM10gJiAzKSA8PCA2O1xuICAgIH0pO1xuICAgIGNvbnN0IGEgPSB0aGlzLnJvbS5hc3NlbWJsZXIoKTtcbiAgICBhLnNlZ21lbnQoJzA4JywgJzA5Jyk7XG4gICAgYS5vcmcoMHg4MDAwIHwgdGhpcy5tYXAgPDwgOCk7XG4gICAgYS5ieXRlKC4uLihbXSBhcyBudW1iZXJbXSkuY29uY2F0KC4uLnRoaXMudGlsZXMpKTtcbiAgICBhLm9yZygweGIwMDAgfCB0aGlzLm1hcCA8PCA0KTtcbiAgICBhLmJ5dGUoLi4uYXR0cik7XG4gICAgYS5vcmcoMHhiZTAwIHwgdGhpcy5tYXAgPDwgMyk7XG4gICAgYS5ieXRlKC4uLnRoaXMuYWx0ZXJuYXRlcyk7XG4gICAgcmV0dXJuIFthLm1vZHVsZSgpXTtcbiAgfVxuXG4gIGVmZmVjdHMoKTogVGlsZUVmZmVjdHMge1xuICAgIC8vIE5PVEU6IGl0J3MgcG9zc2libGUgdGhpcyBjb3VsZCBnZXQgb3V0IG9mIHN5bmMuLi5cbiAgICBsZXQgaW5kZXggPSAodGhpcy5pZCA+Pj4gMikgJiAweGY7XG4gICAgaWYgKHRoaXMuaWQgPT09IDB4YTgpIGluZGV4ID0gMjtcbiAgICBpZiAodGhpcy5pZCA9PT0gMHhhYykgaW5kZXgtLTtcbiAgICByZXR1cm4gdGhpcy5yb20udGlsZUVmZmVjdHNbaW5kZXhdO1xuICB9XG5cbiAgLy8gcGFzc2FnZSh0aWxlSWQ6IG51bWJlciwgdGlsZUVmZmVjdHMgPSB0aGlzLmVmZmVjdHMoKSk6IFRlcnJhaW4ge1xuICAvLyAgIGNvbnN0IGVmZmVjdHMgPSB0aWxlRWZmZWN0cy5lZmZlY3RzO1xuICAvLyAgIC8vIE5vdGU6IGZvciB0aGlzIHB1cnBvc2UsIHBpdHMgY2FuIGJlIHRyYXZlcnNlZCBiZWNhdXNlIHRoZXJlIHNob3VsZCBhbHdheXNcbiAgLy8gICAvLyBiZSBhIHBsYXRmb3JtIGFjcm9zcyBpdC4gIFRoZSBkb2xwaGluIGNvdW50cyBhcyBmbHlpbmcsIGFuZCB3ZSBoYXZlXG4gIC8vICAgLy8gc3BlY2lhbCBsb2dpYyB0byB0cmFuc2xhdGUgdGhhdC5cbiAgLy8gICBjb25zdCBiaXRzID0gZWZmZWN0c1t0aWxlSWRdICYgMHgyNjtcbiAgLy8gICBpZiAoIWJpdHMpIHJldHVybiBQYXNzYWdlLkFMV0FZUztcbiAgLy8gICAvLyBOb3RlOiB0aGlzIHdpbGwgbG9zZSB0aGUgZmxpZ2h0IGJpdCBmcm9tIGFuZ3J5IHNlYSB3YXRlcmZhbGwsIGJ1dFxuICAvLyAgIC8vIHRoYXQncyBwcm9iYWJseSBmaW5lLlxuICAvLyAgIGlmIChiaXRzICYgMHgyMCkgcmV0dXJuIFBhc3NhZ2UuU0xPUEU7XG4gIC8vICAgLy8gVE9ETyAtIHJlcXVpcmUgdGhlIDB4MDggYml0IGJlZm9yZSBjaGVja2luZyBhbHRlcm5hdGU/XG4gIC8vICAgaWYgKHRpbGVJZCA8IDB4MjAgJiYgdGhpcy5hbHRlcm5hdGVzW3RpbGVJZF0gIT09IHRpbGVJZCkge1xuICAvLyAgICAgY29uc3QgYWx0Qml0cyA9IGVmZmVjdHNbdGhpcy5hbHRlcm5hdGVzW3RpbGVJZF1dICYgMHgyNjtcbiAgLy8gICAgIGlmICghYWx0Qml0cykgcmV0dXJuIFBhc3NhZ2UuRkxBRztcbiAgLy8gICB9XG4gIC8vICAgaWYgKCEoYml0cyAmIDB4MDQpKSByZXR1cm4gUGFzc2FnZS5GTFk7XG4gIC8vICAgcmV0dXJuIFBhc3NhZ2UuTkVWRVI7XG4gIC8vIH1cbn1cblxuXG4vLyBleHBvcnQgZW51bSBQYXNzYWdlIHtcbi8vICAgQUxXQVlTID0gMCxcbi8vICAgU0xPUEUgPSAxLFxuLy8gICBGTEFHID0gMixcbi8vICAgRkxZID0gMyxcbi8vICAgTkVWRVIgPSA0LFxuLy8gfVxuXG4vLyBpbnRlcmZhY2UgUGFsZXR0ZUhhbmRsZXIge1xuLy8gICBkb25vcjogc3RyaW5nW107XG4vLyAgIHJlY2VpdmVyOiBzdHJpbmdbXTtcbi8vIH1cblxuLy8gY29uc3QgTUFJTiA9IHtkb25vcjogWydtYWluJywgJ3RyaW0nXSwgcmVjZWl2ZXI6IFsnbWFpbiddfTtcbi8vIGNvbnN0IFRSSU0gPSB7ZG9ub3I6IFsndHJpbSddLCByZWNlaXZlcjogWyd0cmltJ119O1xuLy8gY29uc3QgTk9ORSA9IHtkb25vcjogW10sIHJlY2VpdmVyOiBbXX07XG5jb25zdCBOT05FID0gMDtcbmNvbnN0IFRSSU0gPSAxO1xuY29uc3QgTUFJTiA9IDI7XG50eXBlIFBhbGV0dGVIYW5kbGVyID0gbnVtYmVyO1xuXG50eXBlIFBhbGV0dGUgPSByZWFkb25seSBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXTtcbnR5cGUgUGFsZXR0ZVZhbGlkYXRvciA9IChwMDogUGFsZXR0ZSwgcDE6IFBhbGV0dGUsIHAyOiBQYWxldHRlKSA9PiBib29sZWFuO1xuXG50eXBlIFBhbGV0dGVTcGVjID0gcmVhZG9ubHkgW1BhbGV0dGVIYW5kbGVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYWxldHRlSGFuZGxlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFsZXR0ZUhhbmRsZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhbGV0dGVWYWxpZGF0b3I/XTtcblxuZXhwb3J0IGZ1bmN0aW9uIHBhbGV0dGVUeXBlcyh0aWxlc2V0OiBudW1iZXIsIGxvY2F0aW9uOiBudW1iZXIpOiBQYWxldHRlU3BlYyB7XG4gIC8vIFB1bGwgb3V0IGEgZmV3IHNwZWNpYWwtY2FzZSBsb2NhdGlvbnMuXG4gIC8vIE5PVEU6IHVuZGVyZ3JvdW5kIGNhdmVybiAkNjQgaGFzIG1pZGRsZSBmb3Igd2F0ZXIsIG11c3QgYmUgJDFmXG4gIHN3aXRjaCAobG9jYXRpb24pIHtcbiAgY2FzZSAweDFhOiAvLyB0aWxlc2V0IGEwIHN3YW1wXG4gICAgcmV0dXJuIFtNQUlOLCBNQUlOLCBUUklNLCAocDAsIHAxLCBwMikgPT4gcDBbM10gPT09IHAxWzNdICYmIHAxWzNdID09PSBwMlszXV07XG4gIGNhc2UgMHg0MzogLy8gdGlsZXNldCA5NFxuICAgIHJldHVybiBbTUFJTiwgVFJJTSwgVFJJTV07XG4gIGNhc2UgMHg1NzogLy8gdGlsZWV0IDg4XG4gICAgLy8gZG9uJ3QgaW5jbHVkZSB0aGUgd2F0ZXIgaW4gdGhlIG5vcm1hbCBwb29sLi4uXG4gICAgcmV0dXJuIFtNQUlOLCBOT05FLCBOT05FXTtcbiAgY2FzZSAweDYwOiAvLyB0aWxlc2V0IDk0XG4gICAgcmV0dXJuIFtNQUlOLCBNQUlOLCBNQUlOLCAocDAsIF9wMSwgcDIpID0+IHAwWzJdID09PSBwMlsyXV07XG4gIGNhc2UgMHg2NDogY2FzZSAweDY4OiAvLyB0aWxlc2V0IDg4XG4gICAgLy8gc29tZSB3YXRlciBpbiB0aGlzIGNhdmUgdXNlcyB0aGUgSFVEJ3MgcGFsZXR0ZSBzbyBkb24ndCBzaHVmZmxlIGl0XG4gICAgcmV0dXJuIFtNQUlOLCBOT05FLCBUUklNXTtcbiAgY2FzZSAweDdjOiAvLyB0aWxlc2V0IDljXG4gICAgcmV0dXJuIFtNQUlOLCBUUklNLCBUUklNXTtcbiAgfVxuXG4gIHN3aXRjaCAodGlsZXNldCkge1xuICBjYXNlIDB4ODA6IGNhc2UgMHg4NDpcbiAgICByZXR1cm4gW01BSU4sIE1BSU4sIFRSSU0sIChwMCwgcDEpID0+IHAwWzNdID09PSBwMVszXV07XG4gIGNhc2UgMHg4ODpcbiAgICByZXR1cm4gW01BSU4sIFRSSU0sIE5PTkVdO1xuICBjYXNlIDB4OGM6IHJldHVybiBbTUFJTiwgVFJJTSwgTUFJTl07XG4gIGNhc2UgMHg5MDogcmV0dXJuIFtNQUlOLCBNQUlOLCBNQUlOXTtcbiAgY2FzZSAweDk0OiByZXR1cm4gW01BSU4sIFRSSU0sIFRSSU0sIChwMCwgcDEpID0+IHAwWzNdID09PSBwMVszXV07XG4gIGNhc2UgMHg5ODogcmV0dXJuIFtUUklNLCBUUklNLCBUUklNXTsgLy8gVE9ETyAtIHZhbGlkYXRlPyE/XG4gIGNhc2UgMHg5YzogcmV0dXJuIFtNQUlOLCBUUklNLCBNQUlOXTtcbiAgY2FzZSAweGEwOiByZXR1cm4gW1RSSU0sIFRSSU0sIFRSSU1dO1xuICBjYXNlIDB4YTQ6IHJldHVybiBbTUFJTiwgTUFJTiwgVFJJTV07XG4gIGNhc2UgMHhhODogcmV0dXJuIFtNQUlOLCBNQUlOLCBUUklNXTtcbiAgY2FzZSAweGFjOiByZXR1cm4gW01BSU4sIFRSSU0sIE1BSU5dO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihgdW54cGVjdGVkOiAke3RpbGVzZXR9YCk7XG59XG4vLyAgIFsweDk4LCBbJ2Rvb3InLCAncm9vbScsICdyb2NrcyddXSwgLy8gc2hyaW5lXG4vLyAgIC8vIE5PVEU6IGh5ZHJhIHZlcnkgZGlmZjogKHJvY2svZ3JvdW5kLCBicmlkZ2UsIHJpdmVyKVxuLy8gICBbMHg5YywgWydtb3VudGFpbi9ncm91bmQnLCAndHJlZXMnLCAnZGVzZXJ0J11dLFxuLy8gICAvLyBOT1RFOiB0aGlzIGlzIHN3YW1wLCBidXQgYWxzbyBpbmNsdWRlcyBhbGwgaW5kb29yc1xuLy8gICAvLyBhbGwgMyBuZWVkIHNhbWUgYmcgZm9yIHN3YW1wXG4vLyAgIFsweGEwLCBbJ2dyb3VuZCcsICd0cmVlcycsICdzb21lIGhhemUnXV0sXG4vLyAgIFsweGE0LCBbJycsICcnLCAnJ11dLCAvLyBmb3J0cmVzc1xuLy8gICBbMHhhOCwgWycnLCAnJywgJyddXSwgLy8gaWNlIGNhdmVcbi8vICAgWzB4YWMsIFsnJywgJycsICcnXV0sIC8vIGVuZGdhbWVcbi8vIF0pO1xuXG5jb25zdCBBTExPV0VEX1BBTEVUVEVTID0gbmV3IE1hcDxzdHJpbmcsIHJlYWRvbmx5IG51bWJlcltdPihbXG4gIFsncGF0aCcsIFsuLi5yKDB4MDAsIDB4MTIpLCAuLi5yKDB4MTUsIDB4MWIpLCAuLi5yKDB4MWUsIDB4MjUpLFxuICAgICAgICAgICAgLi4ucigweDI2LCAweDJiKSwgLi4ucigweDJjLCAweDMwKSwgLi4ucigweDM5LCAweDNmKSxcbiAgICAgICAgICAgIDB4NDIsIC4uLnIoMHg0NCwgMHg0OCksIC4uLnIoMHg0ZCwgMHg1OSksIC4uLnIoMHg4MCwgMHg4NCksXG4gICAgICAgICAgICAweDg3LCAuLi5yKDB4OGIsIDB4OTMpXV0sXG4gIFsnbW91bnRhaW4nLCBbMHgwMSwgLi4ucigweDAzLCAweDA3KSwgLi4ucigweDA4LCAweDBiKSwgMHgwYywgMHgwZCwgMHgwZSxcbiAgICAgICAgICAgICAgIC4uLnIoMHgxMSwgMHgxOCksIDB4MTksIDB4MWEsIDB4MWMsIDB4MWQsIDB4MWUsIDB4MjAsIDB4MjEsXG4gICAgICAgICAgICAgICAweDIzLCAweDI3LCAweDJhLCAweDJiLCAweDJmLCAweDMxLCAweDMzLCAweDM2LCAweDM3LCAweDM4LFxuICAgICAgICAgICAgICAgMHgzOSwgMHgzYywgMHg0MiwgMHg0NCwgMHg0NiwgMHg0YiwgMHg0YywgMHg0ZiwgMHg1MywgMHg1OCxcbiAgICAgICAgICAgICAgIC4uLnIoMHg4MCwgMHg4NSksIDB4ODcsIDB4ODgsIDB4OGIsIDB4OGVdXSxcbiAgWyd0cmVlcycsIFsweDAxLCAweDAyLCAweDA0LCAweDA2LCAuLi5yKDB4MDcsIDB4MGYpLCAuLi5yKDB4MTQsIDB4MTgpLFxuICAgICAgICAgICAgIDB4MWEsIDB4MWMsIDB4MWUsIDB4MjAsIDB4MjMsIDB4MjcsIDB4MjksIDB4MmEsIDB4MmIsIDB4MmUsXG4gICAgICAgICAgICAgMHgyZiwgMHgzMSwgMHgzMywgMHgzNywgMHgzOCwgMHgzOSwgMHgzYywgMHgzZCwgMHg0MywgMHg0NCxcbiAgICAgICAgICAgICAweDQ2LCAweDQ5LCAweDRhLCAweDRiLCAweDRmLCAweDUyLCAweDU3LCAweDZlLFxuICAgICAgICAgICAgIC4uLnIoMHg4MCwgMHg4NSksIDB4ODcsIDB4ODgsIC4uLnIoMHg4YiwgMHg5MCldXSxcblxuXSk7XG5cbi8vIGluZmVyIGNvbnN0cmFpbnRzP1xuLy8gIC0gdHJlYXQgQkcgY29sb3Igc2VwYXJhdGVseVxuLy8gICAgLSBmaWd1cmUgb3V0IHdoaWNoIHBhbHMgb24gYSBtYXAgc2hhcmUgc2FtZSBiZ1xuLy8gICAgLSBrZWVwIGJsYWNrIG9uZXMgYmxhY2tcbi8vICAgIC0ga2VlcCBsaWdodCBvbmVzIGxpZ2h0LCBkYXJrIG9uZXMgZGFyaz9cbi8vICAtIGFsbCBzaGFyZWQgY29sb3JzIG1vdmVkIGluIGxvY2tzdGVwP1xuLy8gIC0gY2F0ZWdvcml6ZSBpbmRpdmlkdWFsIGNvbG9ycz9cbi8vICAgIGxvb2sgYXQgaG93IG11Y2ggaXMgdXNlZD8gIG5vIGJyaWdodCBjb2xvcnMgZm9yIHZlcnkgY29tbW9uP1xuLy8gIFRPRE8gLSBmaXggdGhlIG5vLWljZSBCRyBmb3IgaHlkcmEvc3R4eS9nb2EgaW4gdGhlIHRpbGVzZXRcblxuLy8gbmV4dCBzdGVwIC0gbWFrZSBwYXR0ZXJuL3BhbGV0dGUgdmlld2VyIChlZGl0b3I/KVxuXG5jb25zdCBURVJSQUlOX0JZX1BBTEVUVEUgPSBuZXcgTWFwPG51bWJlciwgcmVhZG9ubHkgW3N0cmluZywgc3RyaW5nLCBzdHJpbmddPihbXG4gIFsweDgwLCBbJ3BhdGgnLCAnbW91bnRhaW4nLCAndHJlZXMnXV0sXG4gIFsweDg0LCBbJ21vdW50YWluLXBhdGgnLCAnYnJpY2snLCAndHJlZXMnXV0sXG4gIFsweDg4LCBbJ2NhdmUgd2FsbC9ncm91bmQnLCAnY2F2ZSBicmlkZ2UnLCAnJ11dLFxuICAvLyBOT1RFOiB1bmRlcmdyb3VuZCBjYXZlcm4gJDY0IGhhcyBtaWRkbGUgZm9yIHdhdGVyLCBtdXN0IGJlICQxZlxuICBbMHg4YywgWydmbG9vcicsICdmaXJlJywgJ2FjY2VwdCddXSxcbiAgWzB4OTAsIFsndHJlZXMnLCAnbW91bnRhaW4nLCAnZ3Jhc3MnXV0sXG4gIC8vIE5PVEU6IDAgYW5kIDIgbmVlZCBzYW1lIGJhY2tncm91bmQgZm9yIG9jZWFuXG4gIC8vIGxpbWUgdHJlZSBpcyB2ZXJ5IGRpZmZlcmVudCB1c2FnZTogKHdhdGVyLCB0cmVlIHRydW5rLCB0cmVlcykuXG4gIC8vIG1vdW50YWlucyBhbHNvIGRpZmZlcmVudCAocm9jaywgdHJpbSAob24gMjgvN2MpLCBicmlkZ2UpXG4gIC8vIGZvciBtb3VudGFpbnMsIDAgYW5kIDEgYXJlIHNhbWUtYmdcbiAgWzB4OTQsIFsnd2F0ZXIvZ3JvdW5kJywgJ21vdW50YWluJywgJ3NoYWxsb3dzJ11dLFxuICBbMHg5OCwgWydkb29yJywgJ3Jvb20nLCAncm9ja3MnXV0sIC8vIHNocmluZVxuICAvLyBOT1RFOiBoeWRyYSB2ZXJ5IGRpZmY6IChyb2NrL2dyb3VuZCwgYnJpZGdlLCByaXZlcilcbiAgWzB4OWMsIFsnbW91bnRhaW4vZ3JvdW5kJywgJ3RyZWVzJywgJ2Rlc2VydCddXSxcbiAgLy8gTk9URTogdGhpcyBpcyBzd2FtcCwgYnV0IGFsc28gaW5jbHVkZXMgYWxsIGluZG9vcnNcbiAgLy8gYWxsIDMgbmVlZCBzYW1lIGJnIGZvciBzd2FtcFxuICBbMHhhMCwgWydncm91bmQnLCAndHJlZXMnLCAnc29tZSBoYXplJ11dLFxuICBbMHhhNCwgWycnLCAnJywgJyddXSwgLy8gZm9ydHJlc3NcbiAgWzB4YTgsIFsnJywgJycsICcnXV0sIC8vIGljZSBjYXZlXG4gIFsweGFjLCBbJycsICcnLCAnJ11dLCAvLyBlbmRnYW1lXG5dKTtcblxuZnVuY3Rpb24gcihhOiBudW1iZXIsIGI6IG51bWJlcik6IHJlYWRvbmx5IG51bWJlcltdIHtcbiAgcmV0dXJuIG5ldyBBcnJheShiIC0gYSkuZmlsbCgwKS5tYXAoKF94LCBpKSA9PiBpICsgYSk7XG59XG5cbmNvbnN0IFtdID0gW1RFUlJBSU5fQllfUEFMRVRURSwgQUxMT1dFRF9QQUxFVFRFU107XG4iXX0=