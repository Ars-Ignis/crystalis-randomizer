import { seq } from './util.js';
export function icon(arr) {
    if (arr.length != 1)
        throw new Error('Bad icon input');
    const str = arr[0];
    const lines = str.split('\n');
    const full = lines.slice(1).map(l => l.replace(/^\s*\||\|\s*$/g, ''));
    const short = /\S/.test(lines[0]) ? lines[0][0] : full[1][1];
    return { short, full: [full[0], full[1], full[2]] };
}
export function upStair(tile, width = 2) {
    const y = tile >>> 4;
    const x = tile & 0xf;
    if (width === 1) {
        const dy = y === 0xe ? 0x2800 : 0x1800;
        const entrance = ((y << 12) + dy) | ((x << 4) + 0x0008);
        return {
            type: 'stair:down',
            dir: 2,
            entrance,
            exits: [tile],
        };
    }
    const entrance = y << 12 | ((x << 4) + (width << 3));
    return {
        type: 'stair:up',
        dir: 0,
        entrance,
        exits: seq(width, i => tile - 0x10 + i),
    };
}
export function downStair(tile, width = 2) {
    const y = tile >>> 4;
    const x = tile & 0xf;
    if (width === 1) {
        const entrance = ((y << 12) - 0x0800) | ((x << 4) + 0x0008);
        return {
            type: 'stair:down',
            dir: 2,
            entrance,
            exits: [tile],
        };
    }
    const entrance = y << 12 | 0x0f00 | ((x << 4) + (width << 3));
    return {
        type: 'stair:down',
        dir: 2,
        entrance,
        exits: seq(width, i => tile + 0x10 + i),
    };
}
export function cave(tile, type = 'cave') {
    return { ...upStair(tile), type };
}
export function door(tile, type = 'door') {
    return { ...upStair(tile, 1), type };
}
export function waterfallCave(tile) {
    const y = tile >>> 4;
    const x = tile & 0xf;
    return {
        type: 'cave',
        dir: 0,
        entrance: y << 12 | 0x0f00 | x << 4,
        exits: [tile - 0xf, tile + 1],
    };
}
export function topEdge(left = 7, width = 2) {
    return {
        type: 'edge:top',
        dir: 0,
        entrance: 12288 | ((left << 4) + (width << 3)),
        exits: seq(width, i => 0x20 | (i + left)),
    };
}
export function bottomEdge({ left = 7, width = 2, shift = 0 } = {}) {
    return {
        type: 'edge:bottom',
        dir: 2,
        entrance: 57088 | ((left << 4) + (width << 3) + 16 * shift),
        exits: seq(width, i => 0xe0 | (i + left)),
    };
}
export function bottomEdgeHouse({ left = 7, width = 2, shift = 0 } = {}) {
    return {
        type: 'edge:bottom',
        dir: 2,
        entrance: 44800 | ((left << 4) + (width << 3) + 16 * shift),
        exits: seq(width, i => 0xb0 | (i + left)),
    };
}
export function leftEdge(top = 7, height = 2) {
    return {
        type: 'edge:left',
        dir: 1,
        entrance: ((top << 12) + (height << 11)) | 0x10,
        exits: seq(height, i => (i + top) << 4),
    };
}
export function rightEdge(top = 7, height = 2) {
    return {
        type: 'edge:right',
        dir: 1,
        entrance: ((top << 12) + (height << 11)) | 0xef,
        exits: seq(height, i => (i + top) << 4 | 0xf),
    };
}
export function seamlessVertical(tile, width = 2) {
    return {
        type: 'seamless',
        get dir() { throw new Error('not implemented'); },
        get entrance() { throw new Error('not implemented'); },
        get exits() { throw new Error('not implemented'); },
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWV0YXNjcmVlbmRhdGEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvcm9tL21ldGFzY3JlZW5kYXRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE9BQU8sRUFBQyxHQUFHLEVBQUMsTUFBTSxXQUFXLENBQUM7QUF5RjlCLE1BQU0sVUFBVSxJQUFJLENBQUMsR0FBeUI7SUFDNUMsSUFBSSxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUM7UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDdkQsTUFBTSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRW5CLE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFOUIsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDdEUsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDN0QsT0FBTyxFQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUM7QUFDcEQsQ0FBQztBQXFCRCxNQUFNLFVBQVUsT0FBTyxDQUFDLElBQVksRUFBRSxLQUFLLEdBQUcsQ0FBQztJQUc3QyxNQUFNLENBQUMsR0FB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QUcsR0FBRyxDQUFDO0tBQzlDLENBQUM7QUFDSixDQUFDO0FBR0QsTUFBTSxVQUFVLGdCQUFnQixDQUFDLElBQVksRUFBRSxLQUFLLEdBQUcsQ0FBQztJQUN0RCxPQUFPO1FBQ0wsSUFBSSxFQUFFLFVBQVU7UUFDaEIsSUFBSSxHQUFHLEtBQWEsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6RCxJQUFJLFFBQVEsS0FBYSxNQUFNLElBQUksS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlELElBQUksS0FBSyxLQUFlLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDOUQsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge01ldGFzY3JlZW59IGZyb20gJy4vbWV0YXNjcmVlbi5qcyc7XG5pbXBvcnQge1NjcmVlbkZpeH0gZnJvbSAnLi9zY3JlZW5maXguanMnO1xuaW1wb3J0IHtNZXRhdGlsZXNldHN9IGZyb20gJy4vbWV0YXRpbGVzZXQuanMnO1xuaW1wb3J0IHtzZXF9IGZyb20gJy4vdXRpbC5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcblxuLyoqXG4gKiBNZXRhZGF0YSBhYm91dCB0aGUgbWV0YXNjcmVlbi4gIEJlY2F1c2UgdGhlc2UgYXJlIGNyZWF0ZWQgcGVyIE1ldGFzY3JlZW5zXG4gKiBpbnN0YW5jZSwgdGhleSBjYW4gYWN0dWFsbHkgYmUgbXV0YXRlZCBhcyBuZWVkZWQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTWV0YXNjcmVlbkRhdGEge1xuICAvKipcbiAgICogSWYgdGhlIHNjcmVlbiBleGlzdHMgb3IgaXMgc2hhcmVkIHdpdGggYSBzY3JlZW4gaW4gdGhlIHZhbmlsbGEgcm9tLCB0aGVuXG4gICAqIHRoaXMgaXMgdGhlIHNjcmVlbiBJRCAoMC4uMTAyKS4gIE90aGVyd2lzZSwgaXQgaXMgYSBzcGFyc2UgbmVnYXRpdmUgbnVtYmVyXG4gICAqIHNoYXJlZCBieSBhbGwgdGhlIHNjcmVlbnMgdGhhdCB3aWxsIHVsdGltYXRlbHkgaGF2ZSB0aGUgc2FtZSBJRC5cbiAgICovXG4gIGlkOiBudW1iZXI7XG4gIC8qKiBSZXByZXNlbnRhdGl2ZSBpY29uIGZvciBkZWJ1ZyBwdXJwb3Nlcy4gKi9cbiAgaWNvbj86IEljb247XG4gIC8qKiBMaXN0IG9mIHRpbGVzZXRzIHRoaXMgc2NyZWVuIGFwcGVhcnMgaW4uICovXG4gIHRpbGVzZXRzOiB7W25hbWUgaW4ga2V5b2YgTWV0YXRpbGVzZXRzXT86IHtcbiAgICAvKiogRml4ZXMgbmVlZGVkIGJlZm9yZSBzY3JlZW4gaXMgdXNhYmxlIGluIHRoZSB0aWxlc2V0LiAqL1xuICAgIHJlcXVpcmVzPzogU2NyZWVuRml4W10sXG4gICAgLyoqID8/PyAqL1xuICAgIHR5cGU/OiBzdHJpbmcsIC8vIGZvciB0b3duP1xuICB9fTtcbiAgLyoqIExpc3Qgb2YgZmVhdHVyZXMgcHJlc2VudC4gKi9cbiAgZmVhdHVyZT86IEZlYXR1cmVbXTtcbiAgLyoqIExpc3Qgb2YgZXhpdCBzcGVjcy4gKi9cbiAgZXhpdHM/OiByZWFkb25seSBDb25uZWN0aW9uW107XG4gIC8qKiBTdHJpbmcgKGxlbmd0aCA0KSBvZiBlZGdlIHR5cGVzIGZvciBtYXRjaGluZzogdXAsIGxlZnQsIGRvd24sIHJpZ2h0LiAqL1xuICBlZGdlcz86IHN0cmluZztcbiAgLyoqXG4gICAqIFN0cmluZyBvZiBjb25uZWN0ZWQgYWNjZXNzIHBvaW50cyBmb3Igcm91dGluZywgZ3JvdXBlZCBieSBjb25uZWN0aW9uIHR5cGUuXG4gICAqIFBvaW50cyBhcmUgaGV4IGRpZ2l0cyBbMTIzXSBmb3IgdG9wIGVkZ2UsIFs1NjddIGZvciBsZWZ0LCBbOWFiXSBmb3IgYm90dG9tLFxuICAgKiBvciBbZGVmXSBmb3IgcmlnaHQgZWRnZS4gIFNlcGFyYXRvcnMgYXJlICd8JyBmb3IgaW1wYXNzaWJsZSwgJz0nIGZvciB3YWxsLFxuICAgKiAnOicgZm9yIHdhdGVyIChpLmUuIGZsaWdodCByZXF1aXJlZCksIGFuZCAnLScgZm9yIGJyaWRnZS4gIEdlbmVyYWxseSBvbmx5XG4gICAqIHRoZSBtaWRkbGUgbnVtYmVyIGlzIHVzZWQgZm9yIGVhY2ggZWRnZSAoMjZhZSkgYnV0IGZvciByaXZlcnMgYW5kIGxhYnlyaW50aFxuICAgKiB0aWxlc2V0cywgdGhlIG90aGVyIG51bWJlcnMgYXJlIHVzZWQgYXMgd2VsbCwgY292ZXJpbmcgdGhlIGVkZ2VzIGxpa2Ugc29cbiAgICogYGBgXG4gICAqICAgICAuMTIzLlxuICAgKiAgICAgNSAgIGRcbiAgICogICAgIDYgICBlXG4gICAqICAgICA3ICAgZlxuICAgKiAgICAgLjlhYi5cbiAgICogYGBgXG4gICAqIFRodXMgdGhlIDQgYml0IGluZGljYXRlcyBhIHZlcnRpY2FsIGVkZ2UgYW5kIHRoZSA4IGJpdCBpbmRpY2F0ZXMgdGhhdCBpdCdzXG4gICAqIHRoZSBjb3JyZXNwb25kaW5nIGVkZ2Ugb24gdGhlIG5leHQgdGlsZS5cbiAgICovXG4gIGNvbm5lY3Q/OiBzdHJpbmc7XG4gIC8qKiBUaWxlICh5eCkgdG8gcGxhY2UgdGhlIHdhbGwvYnJpZGdlIGhpdGJveCwgaWYgcHJlc2VudC4gKi9cbiAgd2FsbD86IG51bWJlcjtcbiAgLyoqIEluZm9ybWF0aW9uIGFib3V0IGFueSBtb3ZpbmcgcGxhdGZvcm0gcGxhdGZvcm0uICovXG4gIHBsYXRmb3JtPzoge1xuICAgIC8qKiBUeXBlIG9mIHBsYXRmb3JtLiAqL1xuICAgIHR5cGU6ICdob3Jpem9udGFsJyB8ICd2ZXJ0aWNhbCcsXG4gICAgLyoqIDE2LWJpdCBzY3JlZW4gY29vcmRpbmF0ZXMgKHl5eHgpIG9mIHBsYXRmb3JtIHNwYXduIHBvc2l0aW9uLiAqL1xuICAgIGNvb3JkOiBudW1iZXIsXG4gIH07XG4gIC8qKlxuICAgKiBQb2ludHMgb2YgaW50ZXJlc3Qgb24gdGhpcyBzY3JlZW4uICBFYWNoIGVudHJ5IGlzIGEgcHJpb3JpdHkgKDEgaXMgbW9zdFxuICAgKiByZWxldmFudCwgNSBpcyBsZWFzdCksIGZvbGxvd2VkIGJ5IGEgZGVsdGEteSBhbmQgYSBkZWx0YS14IGluIHBpeGVsc1xuICAgKiBtZWFzdXJlZCBmcm9tIHRoZSB0b3AtbGVmdCBjb3JuZXIgb2YgdGhlIHNjcmVlbi4gIFRoZSBkZWx0YXMgbWF5IGJlXG4gICAqIG5lZ2F0aXZlIG9yIGdyZWF0ZXIgdGhhbiAweGZmLCBpbmRpY2F0aW5nIHRoYXQgdGhlIFBPSSBpcyBhY3R1YWxseSBvbiBhXG4gICAqIG5laWdoYm9yaW5nIHNjcmVlbi4gIERlZmF1bHQgZHk9NzAgYW5kIGR4PTc4LlxuICAgKi9cbiAgcG9pPzogUmVhZG9ubHlBcnJheTxyZWFkb25seSBbbnVtYmVyLCBudW1iZXI/LCBudW1iZXI/XT4sXG5cbiAgLyoqIFVwZGF0ZXMgdG8gYXBwbHkgd2hlbiBhcHBseWluZyB0aGUgZ2l2ZW4gZml4LiAqL1xuICB1cGRhdGU/OiBSZWFkb25seUFycmF5PHJlYWRvbmx5IFtTY3JlZW5GaXgsIFNjcmVlblVwZGF0ZV0+O1xuXG4gIC8qKiBXaGV0aGVyIGEgc3BlY2lhbCBmbGFnIGlzIG5lZWRlZCBmb3IgdGhpcyBzY3JlZW4uICovXG4gIGZsYWc/OiAnYWx3YXlzJyB8ICdjYWxtJyB8ICdjYXZlJyB8ICdib3NzJztcblxuICAvKiogTGlzdCBvZiBkaXJlY3Rpb25zIHRoZSBvdGhlciBzY3JlZW4gbWF5IGJlIGluIHJlbGF0aW9uIHRvIHRoaXMuICovXG4gIGFsbG93ZWQ/OiAoczogTWV0YXNjcmVlbikgPT4gQXJyYXk8MHwxfDJ8Mz47XG59XG5cbmV4cG9ydCB0eXBlIFNjcmVlblVwZGF0ZSA9IChzOiBNZXRhc2NyZWVuLCBzZWVkOiBudW1iZXIsIHJvbTogUm9tKSA9PiBib29sZWFuO1xuXG5leHBvcnQgdHlwZSBGZWF0dXJlID1cbiAgLy8gVE9ETyAtIGNhdmU/IGZvcnRyZXNzPyBlZGdlPyAgd2UgYWxyZWFkeSBoYXZlIGNvbm5lY3Rpb25zIHRvIHRlbGwgdXMuLi5cbiAgJ3BpdCcgfCAnYXJlbmEnIHwgJ3NwaWtlcycgfCAnYnJpZGdlJyB8ICd3YWxsJyB8ICdzdGFpcnMnIHwgJ2VtcHR5JyB8XG4gICdwb3J0b2ExJyB8ICdwb3J0b2EyJyB8ICdwb3J0b2EzJyB8IC8vIHBhdGggZnJvbSBzYWJyZSB0byBwb3J0b2FcbiAgJ2xha2UnIHwgJ292ZXJCcmlkZ2UnIHwgJ3VuZGVyQnJpZGdlJyB8ICd3aGlybHBvb2wnIHxcbiAgJ2xpZ2h0aG91c2UnIHwgJ2NhYmluJyB8ICd3aW5kbWlsbCcgfCAnYWx0YXInIHwgJ3B5cmFtaWQnIHwgJ2NyeXB0JztcblxuZXhwb3J0IGludGVyZmFjZSBJY29uIHtcbiAgc2hvcnQ6IHN0cmluZzsgLy8gc2luZ2xlIGNoYXJhY3RlclxuICBmdWxsOiByZWFkb25seSBbc3RyaW5nLCBzdHJpbmcsIHN0cmluZ107IC8vIDN4MyBncmlkXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpY29uKGFycjogVGVtcGxhdGVTdHJpbmdzQXJyYXkpOiBJY29uIHtcbiAgaWYgKGFyci5sZW5ndGggIT0gMSkgdGhyb3cgbmV3IEVycm9yKCdCYWQgaWNvbiBpbnB1dCcpO1xuICBjb25zdCBzdHIgPSBhcnJbMF07XG4gIC8vIHBhcnNlIHRoZSBzdHJpbmcuXG4gIGNvbnN0IGxpbmVzID0gc3RyLnNwbGl0KCdcXG4nKTtcbiAgLy8gbGluZXMgMS4uMyBhcmUgdGhlIGZ1bGwgaWNvbi5cbiAgY29uc3QgZnVsbCA9IGxpbmVzLnNsaWNlKDEpLm1hcChsID0+IGwucmVwbGFjZSgvXlxccypcXHx8XFx8XFxzKiQvZywgJycpKTtcbiAgY29uc3Qgc2hvcnQgPSAvXFxTLy50ZXN0KGxpbmVzWzBdKSA/IGxpbmVzWzBdWzBdIDogZnVsbFsxXVsxXTtcbiAgcmV0dXJuIHtzaG9ydCwgZnVsbDogW2Z1bGxbMF0sIGZ1bGxbMV0sIGZ1bGxbMl1dfTtcbn1cblxuXG5leHBvcnQgdHlwZSBTdGFpclR5cGUgPSAnc3RhaXI6dXAnIHwgJ3N0YWlyOmRvd24nO1xuZXhwb3J0IHR5cGUgRWRnZVR5cGUgPSAnZWRnZTp0b3AnIHwgJ2VkZ2U6Ym90dG9tJyB8ICdlZGdlOmxlZnQnIHwgJ2VkZ2U6cmlnaHQnO1xuZXhwb3J0IHR5cGUgQ29ubmVjdGlvblR5cGUgPVxuICAgICBTdGFpclR5cGUgfCBFZGdlVHlwZSB8ICdjYXZlJyB8ICdkb29yJyB8ICdmb3J0cmVzcycgfCAnZ2F0ZScgfCAnc3dhbXAnIHxcbiAgICAgJ3NlYW1sZXNzJztcblxuLy8gTk9URTogc3dhbXAgY29ubmVjdHMgdG8gZWRnZTpib3R0b20gZm9yIGNhdmUgb3IgdG93bj9cblxuZXhwb3J0IGludGVyZmFjZSBDb25uZWN0aW9uIHtcbiAgcmVhZG9ubHkgdHlwZTogQ29ubmVjdGlvblR5cGU7XG4gIHJlYWRvbmx5IGRpcjogbnVtYmVyOyAgICAgICAgICAgICAgLy8gMD11cCwgMT1sZWZ0LCAyPWRvd24sIDM9cmlnaHRcbiAgcmVhZG9ubHkgZW50cmFuY2U6IG51bWJlcjsgICAgICAgICAvLyBwb3MgWXlYeFxuICByZWFkb25seSBleGl0czogcmVhZG9ubHkgbnVtYmVyW107IC8vIHRpbGUgWVhcbiAgLy8gVE9ETyAtIHNpbmdsZUhlaWdodEVudHJhbmNlIC0gZm9yIGRpcj0yIGp1c3Qgc3VidHJhY3QgMHgyMCA/P1xuICAvLyBUT0RPIC0gb3Bwb3NpdGUgZGlyZWN0aW9uPyB3YXRlcmZhbGwgY2F2ZSBpcyBhIHJpZ2h0L2Rvd24gbWF0Y2h1cC4uLlxufVxuXG4vKiogQHBhcmFtIHRpbGUgcG9zaXRpb24gb2YgbG93ZXItbGVmdCBtZXRhdGlsZSAoZS5nLiAweDQyIGZvciA0MF8zMCkuICovXG5leHBvcnQgZnVuY3Rpb24gdXBTdGFpcih0aWxlOiBudW1iZXIsIHdpZHRoID0gMik6IENvbm5lY3Rpb24ge1xuICAvLyBmcm9tIG1hcCAwNDogZW50cmFuY2UgNDBfMzAgID0+IGV4aXRzIDMyLDMzXG4gIC8vIGZyb20gbWFwIDE5IChzaW5nbGUtd2lkdGgpOiB0aWxlIDY4ID0+IGVudHJhbmNlIDc4Xzg4LCBleGl0IDY4XG4gIGNvbnN0IHkgPSB0aWxlID4+PiA0O1xuICBjb25zdCB4ID0gdGlsZSAmIDB4ZjtcbiAgaWYgKHdpZHRoID09PSAxKSB7XG4gICAgLy8gVE9ETyAtIHdoYXQgZG9lcyBpdCBtZWFuIGZvciBlbnRyYW5jZSB0byBiZSA+IDB4ZmZmZi4uLj9cbiAgICAvLyAgICAgIC0gc2NyZWVuIDZjIChvYWsgTlcpIGhhcyB0aGlzXG4gICAgY29uc3QgZHkgPSB5ID09PSAweGUgPyAweDI4MDAgOiAweDE4MDA7XG4gICAgY29uc3QgZW50cmFuY2UgPSAoKHkgPDwgMTIpICsgZHkpIHwgKCh4IDw8IDQpICsgMHgwMDA4KTtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogJ3N0YWlyOmRvd24nLFxuICAgICAgZGlyOiAyLFxuICAgICAgZW50cmFuY2UsXG4gICAgICBleGl0czogW3RpbGVdLFxuICAgIH07XG4gIH1cbiAgLy8gVE9ETyAtIGlmIHkgaXMgMHhlIHRoZW4gd2UgbWF5IG5lZWQgdG8gYWRqdXN0IGZvciBzY3JlZW4gZWRnZT9cbiAgY29uc3QgZW50cmFuY2UgPSB5IDw8IDEyIHwgKCh4IDw8IDQpICsgKHdpZHRoIDw8IDMpKTtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnc3RhaXI6dXAnLFxuICAgIGRpcjogMCxcbiAgICBlbnRyYW5jZSxcbiAgICBleGl0czogc2VxKHdpZHRoLCBpID0+IHRpbGUgLSAweDEwICsgaSksXG4gIH07XG59XG5cbi8qKiBAcGFyYW0gdGlsZSBwb3NpdGlvbiBvZiB1cHBlci1sZWZ0IG1ldGF0aWxlIChlLmcuIDB4YTIgZm9yIGFmXzMwKS4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkb3duU3RhaXIodGlsZTogbnVtYmVyLCB3aWR0aCA9IDIpOiBDb25uZWN0aW9uIHtcbiAgLy8gZnJvbSBtYXAgMDU6IGVudHJhbmNlIGFmXzMwICA9PiBleGl0cyBiMixiM1xuICAvLyBmcm9tIG1hcCBkNCAoc2luZ2xlLXdpZHRoKTogdGlsZSA0YyA9PiBlbnRyYW5jZSAzOF9jOCwgZXhpdCA0Y1xuICBjb25zdCB5ID0gdGlsZSA+Pj4gNDtcbiAgY29uc3QgeCA9IHRpbGUgJiAweGY7XG4gIGlmICh3aWR0aCA9PT0gMSkge1xuICAgIGNvbnN0IGVudHJhbmNlID0gKCh5IDw8IDEyKSAtIDB4MDgwMCkgfCAoKHggPDwgNCkgKyAweDAwMDgpO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnc3RhaXI6ZG93bicsXG4gICAgICBkaXI6IDIsXG4gICAgICBlbnRyYW5jZSxcbiAgICAgIGV4aXRzOiBbdGlsZV0sXG4gICAgfTtcbiAgfVxuICBjb25zdCBlbnRyYW5jZSA9IHkgPDwgMTIgfCAweDBmMDAgfCAoKHggPDwgNCkgKyAod2lkdGggPDwgMykpO1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdzdGFpcjpkb3duJyxcbiAgICBkaXI6IDIsXG4gICAgZW50cmFuY2UsXG4gICAgZXhpdHM6IHNlcSh3aWR0aCwgaSA9PiB0aWxlICsgMHgxMCArIGkpLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2F2ZSh0aWxlOiBudW1iZXIsIHR5cGU6IENvbm5lY3Rpb25UeXBlID0gJ2NhdmUnKTogQ29ubmVjdGlvbiB7XG4gIHJldHVybiB7Li4udXBTdGFpcih0aWxlKSwgdHlwZX07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkb29yKHRpbGU6IG51bWJlciwgdHlwZTogQ29ubmVjdGlvblR5cGUgPSAnZG9vcicpOiBDb25uZWN0aW9uIHtcbiAgcmV0dXJuIHsuLi51cFN0YWlyKHRpbGUsIDEpLCB0eXBlfTtcbn1cblxuLyoqIEBwYXJhbSB0aWxlIGJvdHRvbS1sZWZ0IG1ldGF0aWxlICovXG5leHBvcnQgZnVuY3Rpb24gd2F0ZXJmYWxsQ2F2ZSh0aWxlOiBudW1iZXIpOiBDb25uZWN0aW9uIHtcbiAgY29uc3QgeSA9IHRpbGUgPj4+IDQ7XG4gIGNvbnN0IHggPSB0aWxlICYgMHhmO1xuICByZXR1cm4ge1xuICAgIHR5cGU6ICdjYXZlJyxcbiAgICBkaXI6IDAsXG4gICAgZW50cmFuY2U6IHkgPDwgMTIgfCAweDBmMDAgfCB4IDw8IDQsXG4gICAgZXhpdHM6IFt0aWxlIC0gMHhmLCB0aWxlICsgMV0sXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0b3BFZGdlKGxlZnQgPSA3LCB3aWR0aCA9IDIpOiBDb25uZWN0aW9uIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnZWRnZTp0b3AnLFxuICAgIGRpcjogMCxcbiAgICBlbnRyYW5jZTogMHgzMF8wMCB8ICgobGVmdCA8PCA0KSArICh3aWR0aCA8PCAzKSksXG4gICAgZXhpdHM6IHNlcSh3aWR0aCwgaSA9PiAweDIwIHwgKGkgKyBsZWZ0KSksXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBib3R0b21FZGdlKHtsZWZ0ID0gNywgd2lkdGggPSAyLCBzaGlmdCA9IDB9ID0ge30pOiBDb25uZWN0aW9uIHtcbiAgLy8gTk9URTogc29tZSBzY3JlZW5zIGNhbiBiZSB1c2VkIGJvdGggaW4gbm9ybWFsIG1hcHMgYW5kIGluIHNpbmdsZS1oZWlnaHRcbiAgLy8gbWFwcy4gIFdoZW4gdXNlZCBpbiBzaW5nbGUtaGVpZ2h0LCB3ZSBuZWVkIHRvIHN1YnRyYWN0IDIgZnJvbSB0aGUgWSB0aWxlXG4gIC8vIGNvb3JkaW5hdGVzIG9mIHRoZSBlbnRyYW5jZS9leGl0LCBjbGFtcGluZyB0byBiZiAoZW50cmFuY2UpIGFuZCBjIChleGl0KS5cbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnZWRnZTpib3R0b20nLFxuICAgIGRpcjogMixcbiAgICBlbnRyYW5jZTogMHhkZl8wMCB8ICgobGVmdCA8PCA0KSArICh3aWR0aCA8PCAzKSArIDE2ICogc2hpZnQpLFxuICAgIGV4aXRzOiBzZXEod2lkdGgsIGkgPT4gMHhlMCB8IChpICsgbGVmdCkpLFxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYm90dG9tRWRnZUhvdXNlKHtsZWZ0ID0gNyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoaWZ0ID0gMH0gPSB7fSk6IENvbm5lY3Rpb24ge1xuICAvLyBVbmxpa2UgXCJkdWFsLW1vZGVcIiBzY3JlZW5zLCBpbmRvb3JzLW9ubHkgc2NyZWVucyBoYXZlIHRoZWlyIGVudHJhbmNlIGFuXG4gIC8vIGFkZGl0aW9uYWwgdGlsZSB1cCwgYXQgYWYvYi4gIFRoaXMgaGFyZC1jb2RlcyB0aGF0LlxuICByZXR1cm4ge1xuICAgIHR5cGU6ICdlZGdlOmJvdHRvbScsXG4gICAgZGlyOiAyLFxuICAgIGVudHJhbmNlOiAweGFmXzAwIHwgKChsZWZ0IDw8IDQpICsgKHdpZHRoIDw8IDMpICsgMTYgKiBzaGlmdCksXG4gICAgZXhpdHM6IHNlcSh3aWR0aCwgaSA9PiAweGIwIHwgKGkgKyBsZWZ0KSksXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsZWZ0RWRnZSh0b3AgPSA3LCBoZWlnaHQgPSAyKTogQ29ubmVjdGlvbiB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ2VkZ2U6bGVmdCcsXG4gICAgZGlyOiAxLFxuICAgIGVudHJhbmNlOiAoKHRvcCA8PCAxMikgKyAoaGVpZ2h0IDw8IDExKSkgfCAweDEwLFxuICAgIGV4aXRzOiBzZXEoaGVpZ2h0LCBpID0+IChpICsgdG9wKSA8PCA0KSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJpZ2h0RWRnZSh0b3AgPSA3LCBoZWlnaHQgPSAyKTogQ29ubmVjdGlvbiB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogJ2VkZ2U6cmlnaHQnLFxuICAgIGRpcjogMSxcbiAgICBlbnRyYW5jZTogKCh0b3AgPDwgMTIpICsgKGhlaWdodCA8PCAxMSkpIHwgMHhlZixcbiAgICBleGl0czogc2VxKGhlaWdodCwgaSA9PiAoaSArIHRvcCkgPDwgNCB8IDB4ZiksXG4gIH07XG59XG5cbi8qKiBAcGFyYW0gdGlsZSBUb3AtbGVmdCB0aWxlIG9mIHRyYW5zaXRpb24gKGhlaWdodCAyKSAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNlYW1sZXNzVmVydGljYWwodGlsZTogbnVtYmVyLCB3aWR0aCA9IDIpOiBDb25uZWN0aW9uIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiAnc2VhbWxlc3MnLFxuICAgIGdldCBkaXIoKTogbnVtYmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfSxcbiAgICBnZXQgZW50cmFuY2UoKTogbnVtYmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfSxcbiAgICBnZXQgZXhpdHMoKTogbnVtYmVyW10geyB0aHJvdyBuZXcgRXJyb3IoJ25vdCBpbXBsZW1lbnRlZCcpOyB9LFxuICB9O1xufVxuXG5cbiJdfQ==