export function upperCamelToSpaces(upperCamel) {
    return upperCamel.replace(/([a-z])([A-Z0-9])/g, '$1 $2')
        .replace(/Of/g, 'of')
        .replace(/_/g, ' - ');
}
export function seq(x, f = (i) => i) {
    return new Array(x).fill(0).map((_, i) => f(i));
}
export function slice(arr, start, len) {
    return arr.slice(start, start + len);
}
export function tuple(arr, start, len) {
    return Array.from(arr.slice(start, start + len));
}
export function signed(x) {
    return x < 0x80 ? x : x - 0x100;
}
export function unsigned(x) {
    return x < 0 ? x + 0x100 : x;
}
export function varSlice(arr, start, width, sentinel, end = Infinity, func) {
    if (!func)
        func = (x) => x;
    const out = [];
    while (start + width <= end && arr[start] !== sentinel) {
        out.push(func(arr.slice(start, start + width)));
        start += width;
    }
    return out;
}
export function addr(arr, i, offset = 0) {
    return (arr[i] | arr[i + 1] << 8) + offset;
}
export function group(width, arr, func) {
    if (!func)
        func = (x) => x;
    return seq(Math.max(0, Math.floor(arr.length / width)), i => func(slice(arr, i * width, width)));
}
export function reverseBits(x) {
    return ((x * 0x0802 & 0x22110) | (x * 0x8020 & 0x88440)) * 0x10101 >>> 16 & 0xff;
}
export function countBits(x) {
    x -= x >> 1 & 0x55;
    x = (x & 0x33) + (x >> 2 & 0x33);
    return (x + (x >> 4)) & 0xf;
}
export function hex(id) {
    return id != null ? id.toString(16).padStart(2, '0') : String(id);
}
export function hex4(id) {
    return id.toString(16).padStart(4, '0');
}
export function hex5(id) {
    return id.toString(16).padStart(5, '0');
}
export function concatIterables(iters) {
    const out = [];
    for (const iter of iters) {
        for (const elem of iter) {
            out.push(elem);
        }
    }
    return out;
}
export function readBigEndian(data, offset) {
    return data[offset] << 8 | data[offset + 1];
}
export function readLittleEndian(data, offset) {
    return data[offset + 1] << 8 | data[offset];
}
export function readString(arr, address, end = 0) {
    const bytes = [];
    while (arr[address] != end) {
        bytes.push(arr[address++]);
    }
    return String.fromCharCode(...bytes);
}
export function writeLittleEndian(data, offset, value) {
    data[offset] = value & 0xff;
    data[offset + 1] = value >>> 8;
}
export function writeString(arr, address, str) {
    for (let i = 0, len = str.length; i < len; i++) {
        arr[address + i] = str.charCodeAt(i);
    }
}
export function write(data, offset, values) {
    data.subarray(offset, offset + values.length).set(values);
}
export class FlagListType {
    constructor(last, clear) {
        this.last = last;
        this.clear = clear;
    }
    read(data, offset = 0) {
        const flags = [];
        while (true) {
            const hi = data[offset++];
            const lo = data[offset++];
            const flag = (hi & 3) << 8 | lo;
            flags.push(hi & this.clear ? ~flag : flag);
            if (hi & this.last)
                return flags;
        }
    }
    bytes(flags) {
        const bytes = [];
        for (let i = 0; i < flags.length; i++) {
            let flag = flags[i];
            if (flag < 0)
                flag = (this.clear << 8) | ~flag;
            if (i === flags.length - 1)
                flag |= (this.last << 8);
            bytes.push(flag >>> 8);
            bytes.push(flag & 0xff);
        }
        return bytes;
    }
    write(data, flags, offset = 0) {
        const bytes = this.bytes(flags);
        for (let i = 0; i < bytes.length; i++) {
            data[i + offset] = bytes[i];
        }
    }
}
export const DIALOG_FLAGS = new FlagListType(0x40, 0x80);
export const ITEM_GET_FLAGS = new FlagListType(0x40, 0x80);
export const SPAWN_CONDITION_FLAGS = new FlagListType(0x80, 0x20);
export function initializer() {
    const tag = Symbol();
    function f(...args) {
        return { tag, args };
    }
    f.commit = (instance, builder) => {
        for (const prop of Object.getOwnPropertyNames(instance)) {
            const value = instance[prop];
            if (value.tag !== tag)
                continue;
            instance[prop] = builder(prop, ...value.args);
        }
    };
    return f;
}
const PROP_TAG = Symbol('PROP_TAG');
const dataTupleMap = new WeakMap();
function dataTupleActualClass(arg) {
    let result = dataTupleMap.get(arg);
    if (!result) {
        result = class extends DataTuple {
        };
        Object.defineProperties(result, { name: { value: arg.name } });
        Object.assign(result, arg);
        Reflect.setPrototypeOf(result.prototype, arg.prototype);
        const proto = new arg();
        const descriptors = {};
        for (const [prop, descr] of Object.entries(proto)) {
            if (descr && descr[PROP_TAG]) {
                descriptors[prop] = descr;
            }
        }
        Object.defineProperties(result.prototype, descriptors);
        dataTupleMap.set(arg, result);
        dataTupleMap.set(result, result);
    }
    return result;
}
export class DataTuple {
    constructor(arg) {
        this.data = arg;
    }
    static of(inits) {
        return Object.assign(new (dataTupleActualClass(this))(new Array(this.size).fill(0)), inits);
    }
    static from(data, offset = 0) {
        const cls = dataTupleActualClass(this);
        const arg = !offset && data.length === this.size ?
            data : tuple(data, offset, this.size);
        return new cls(arg);
    }
    [Symbol.iterator]() {
        return this.data[Symbol.iterator]();
    }
    hex() {
        return Array.from(this.data, hex).join(' ');
    }
    clone() {
        return new this.constructor(this.data);
    }
    prop(...bits) {
        return {
            get() {
                let value = 0;
                for (const [index, mask = 0xff, shift = 0] of bits) {
                    const lsh = shift < 0 ? -shift : 0;
                    const rsh = shift < 0 ? 0 : shift;
                    value |= ((this.data[index] & mask) >>> rsh) << lsh;
                }
                return value;
            },
            set(value) {
                for (const [index, mask = 0xff, shift = 0] of bits) {
                    const lsh = shift < 0 ? -shift : 0;
                    const rsh = shift < 0 ? 0 : shift;
                    const v = (value >>> lsh) << rsh & mask;
                    this.data[index] = this.data[index] & ~mask | v;
                }
            },
            [PROP_TAG]: true,
        };
    }
    booleanProp(byte, bit) {
        return {
            get() {
                return Boolean(this.data[byte] & (1 << bit));
            },
            set(value) {
                const mask = 1 << bit;
                if (value) {
                    this.data[byte] |= mask;
                }
                else {
                    this.data[byte] &= ~mask;
                }
            },
            [PROP_TAG]: true,
        };
    }
}
export const watchArray = (arr, watch) => {
    const arrayChangeHandler = {
        get(target, property) {
            let v = target[property];
            if (property === 'subarray') {
                return (start, end) => {
                    const sub = target.subarray(start, end);
                    if (start <= watch && watch < end)
                        return watchArray(sub, watch - start);
                    return sub;
                };
            }
            else if (property === 'set') {
                return (val) => {
                    console.log(`Setting overlapping array ${watch}`);
                    debugger;
                    target.set(val);
                };
            }
            if (typeof v === 'function')
                v = v.bind(target);
            return v;
        },
        set(target, property, value, receiver) {
            if (property == watch) {
                console.log(`Writing ${watch.toString(16)}`);
                debugger;
            }
            target[property] = value;
            return true;
        },
    };
    return new Proxy(arr, arrayChangeHandler);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxNQUFNLFVBQVUsa0JBQWtCLENBQUMsVUFBa0I7SUFDbkQsT0FBTyxVQUFVLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLE9BQU8sQ0FBQztTQUNuRCxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQztTQUNwQixPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFPRCxNQUFNLFVBQVUsR0FBRyxDQUFDLENBQVMsRUFBRSxJQUEyQixDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNoRSxPQUFPLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNsRCxDQUFDO0FBU0QsTUFBTSxVQUFVLEtBQUssQ0FBc0IsR0FBTSxFQUFFLEtBQWEsRUFBRSxHQUFXO0lBQzNFLE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZDLENBQUM7QUFNRCxNQUFNLFVBQVUsS0FBSyxDQUFJLEdBQVksRUFBRSxLQUFhLEVBQUUsR0FBVztJQUMvRCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUVELE1BQU0sVUFBVSxNQUFNLENBQUMsQ0FBUztJQUM5QixPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztB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QUFrQixFQUFFLEVBQUU7b0JBQzVCLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLEtBQUssRUFBRSxDQUFDLENBQUM7b0JBRWxELFFBQVEsQ0FBQztvQkFDVCxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNsQixDQUFDLENBQUM7YUFDSDtZQUNELElBQUksT0FBTyxDQUFDLEtBQUssVUFBVTtnQkFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNoRCxPQUFPLENBQUMsQ0FBQztRQUNYLENBQUM7UUFDRCxHQUFHLENBQUMsTUFBVyxFQUFFLFFBQXlCLEVBQUUsS0FBVSxFQUFFLFFBQWE7WUFHbkUsSUFBSSxRQUFRLElBQUksS0FBSyxFQUFFO2dCQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBRTdDLFFBQVEsQ0FBQzthQUNWO1lBQ0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUV6QixPQUFPLElBQUksQ0FBQztRQUNkLENBQUM7S0FDRixDQUFDO0lBQ0YsT0FBTyxJQUFJLEtBQUssQ0FBQyxHQUFHLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztBQUM1QyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBHZW5lcmFsIHV0aWxpdGllcyBmb3Igcm9tIHBhY2thZ2UuXG5cbmV4cG9ydCBmdW5jdGlvbiB1cHBlckNhbWVsVG9TcGFjZXModXBwZXJDYW1lbDogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHVwcGVyQ2FtZWwucmVwbGFjZSgvKFthLXpdKShbQS1aMC05XSkvZywgJyQxICQyJylcbiAgICAgIC5yZXBsYWNlKC9PZi9nLCAnb2YnKVxuICAgICAgLnJlcGxhY2UoL18vZywgJyAtICcpO1xufVxuXG4vKiogUmVtb3ZlcyByZWFkb25seSBmcm9tIGZpZWxkcy4gKi9cbmV4cG9ydCB0eXBlIE11dGFibGU8VD4gPSB7LXJlYWRvbmx5IFtLIGluIGtleW9mKFQpXTogVFtLXX07XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXEoeDogbnVtYmVyKTogbnVtYmVyW107XG5leHBvcnQgZnVuY3Rpb24gc2VxPFQ+KHg6IG51bWJlciwgZj86ICh4OiBudW1iZXIpID0+IFQpOiBUW107XG5leHBvcnQgZnVuY3Rpb24gc2VxKHg6IG51bWJlciwgZjogKHg6IG51bWJlcikgPT4gbnVtYmVyID0gKGkpID0+IGkpOiBudW1iZXJbXSB7XG4gIHJldHVybiBuZXcgQXJyYXkoeCkuZmlsbCgwKS5tYXAoKF8sIGkpID0+IGYoaSkpO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIERhdGE8VD4ge1xuICBbaW5kZXg6IG51bWJlcl06IFQ7XG4gIGxlbmd0aDogbnVtYmVyO1xuICBzbGljZShzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcik6IHRoaXM7XG4gIFtTeW1ib2wuaXRlcmF0b3JdKCk6IEl0ZXJhdG9yPFQ+O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2xpY2U8VCBleHRlbmRzIERhdGE8YW55Pj4oYXJyOiBULCBzdGFydDogbnVtYmVyLCBsZW46IG51bWJlcik6IFQge1xuICByZXR1cm4gYXJyLnNsaWNlKHN0YXJ0LCBzdGFydCArIGxlbik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0dXBsZTxUPihhcnI6IERhdGE8VD4sIHN0YXJ0OiBudW1iZXIsIGxlbjogMik6IFtULCBUXTtcbmV4cG9ydCBmdW5jdGlvbiB0dXBsZTxUPihhcnI6IERhdGE8VD4sIHN0YXJ0OiBudW1iZXIsIGxlbjogMyk6IFtULCBULCBUXTtcbmV4cG9ydCBmdW5jdGlvbiB0dXBsZTxUPihhcnI6IERhdGE8VD4sIHN0YXJ0OiBudW1iZXIsIGxlbjogNCk6IFtULCBULCBULCBUXTtcbmV4cG9ydCBmdW5jdGlvbiB0dXBsZTxUPihhcnI6IERhdGE8VD4sIHN0YXJ0OiBudW1iZXIsIGxlbjogbnVtYmVyKTogVFtdO1xuZXhwb3J0IGZ1bmN0aW9uIHR1cGxlPFQ+KGFycjogRGF0YTxUPiwgc3RhcnQ6IG51bWJlciwgbGVuOiBudW1iZXIpOiBUW10ge1xuICByZXR1cm4gQXJyYXkuZnJvbShhcnIuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgbGVuKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzaWduZWQoeDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIHggPCAweDgwID8geCA6IHggLSAweDEwMDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVuc2lnbmVkKHg6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiB4IDwgMCA/IHggKyAweDEwMCA6IHg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB2YXJTbGljZTxUIGV4dGVuZHMgRGF0YTxudW1iZXI+PihhcnI6IFQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbnRpbmVsOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kPzogbnVtYmVyKTogVFtdO1xuZXhwb3J0IGZ1bmN0aW9uIHZhclNsaWNlPFQgZXh0ZW5kcyBEYXRhPG51bWJlcj4sIFU+KGFycjogVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VudGluZWw6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jOiAoc2xpY2U6IFQpID0+IFUpOiBVW107XG5leHBvcnQgZnVuY3Rpb24gdmFyU2xpY2U8VCBleHRlbmRzIERhdGE8bnVtYmVyPiwgVT4oYXJyOiBULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW50aW5lbDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDogbnVtYmVyID0gSW5maW5pdHksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuYz86IChzbGljZTogVCkgPT4gVSk6IFVbXSB7XG4gIGlmICghZnVuYykgZnVuYyA9ICh4OiBUKSA9PiB4IGFzIGFueTtcbiAgY29uc3Qgb3V0ID0gW107XG4gIHdoaWxlIChzdGFydCArIHdpZHRoIDw9IGVuZCAmJiBhcnJbc3RhcnRdICE9PSBzZW50aW5lbCkge1xuICAgIG91dC5wdXNoKGZ1bmMhKGFyci5zbGljZShzdGFydCwgc3RhcnQgKyB3aWR0aCkpKTtcbiAgICBzdGFydCArPSB3aWR0aDtcbiAgfVxuICByZXR1cm4gb3V0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkcihhcnI6IERhdGE8bnVtYmVyPiwgaTogbnVtYmVyLCBvZmZzZXQ6IG51bWJlciA9IDApOiBudW1iZXIge1xuICByZXR1cm4gKGFycltpXSB8IGFycltpICsgMV0gPDwgOCkgKyBvZmZzZXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBncm91cDxUIGV4dGVuZHMgRGF0YTxhbnk+Pih3aWR0aDogbnVtYmVyLCBhcnI6IFQpOiBUW107XG5leHBvcnQgZnVuY3Rpb24gZ3JvdXA8VCBleHRlbmRzIERhdGE8YW55PiwgVT4od2lkdGg6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnI6IFQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuYzogKHNsaWNlOiBUKSA9PiBVKTogVVtdO1xuXG5leHBvcnQgZnVuY3Rpb24gZ3JvdXA8VCBleHRlbmRzIERhdGE8YW55PiwgVT4od2lkdGg6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcnI6IFQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuYz86IChzbGljZTogVCkgPT4gVSk6IFVbXSB7XG4gIGlmICghZnVuYykgZnVuYyA9ICh4OiBUKSA9PiB4IGFzIGFueTtcbiAgcmV0dXJuIHNlcShcbiAgICAgIE1hdGgubWF4KDAsIE1hdGguZmxvb3IoYXJyLmxlbmd0aCAvIHdpZHRoKSksXG4gICAgICBpID0+IGZ1bmMhKHNsaWNlKGFyciwgaSAqIHdpZHRoLCB3aWR0aCkpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJldmVyc2VCaXRzKHg6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiAoKHggKiAweDA4MDIgJiAweDIyMTEwKSB8ICh4ICogMHg4MDIwICYgMHg4ODQ0MCkpICogMHgxMDEwMSA+Pj4gMTYgJiAweGZmO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY291bnRCaXRzKHg6IG51bWJlcik6IG51bWJlciB7XG4gIHggLT0geCA+PiAxICYgMHg1NTtcbiAgeCA9ICh4ICYgMHgzMykgKyAoeCA+PiAyICYgMHgzMyk7XG4gIHJldHVybiAoeCArICh4ID4+IDQpKSAmIDB4Zjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhleChpZDogbnVtYmVyKTogc3RyaW5nIHtcbiAgcmV0dXJuIGlkICE9IG51bGwgPyBpZC50b1N0cmluZygxNikucGFkU3RhcnQoMiwgJzAnKSA6IFN0cmluZyhpZCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoZXg0KGlkOiBudW1iZXIpOiBzdHJpbmcge1xuICByZXR1cm4gaWQudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDQsICcwJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoZXg1KGlkOiBudW1iZXIpOiBzdHJpbmcge1xuICByZXR1cm4gaWQudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDUsICcwJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb25jYXRJdGVyYWJsZXMoaXRlcnM6IEl0ZXJhYmxlPG51bWJlcj5bXSk6IG51bWJlcltdIHtcbiAgY29uc3Qgb3V0OiBudW1iZXJbXSA9IFtdO1xuICBmb3IgKGNvbnN0IGl0ZXIgb2YgaXRlcnMpIHtcbiAgICBmb3IgKGNvbnN0IGVsZW0gb2YgaXRlcikge1xuICAgICAgb3V0LnB1c2goZWxlbSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBvdXQ7XG4gIC8vIHJldHVybiBbXS5jb25jYXQoLi4uaXRlcnMubWFwKEFycmF5LmZyb20pKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRCaWdFbmRpYW4oZGF0YTogRGF0YTxudW1iZXI+LCBvZmZzZXQ6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiBkYXRhW29mZnNldF0gPDwgOCB8IGRhdGFbb2Zmc2V0ICsgMV07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkTGl0dGxlRW5kaWFuKGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gZGF0YVtvZmZzZXQgKyAxXSA8PCA4IHwgZGF0YVtvZmZzZXRdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZFN0cmluZyhhcnI6IERhdGE8bnVtYmVyPiwgYWRkcmVzczogbnVtYmVyLCBlbmQ6IG51bWJlciA9IDApOiBzdHJpbmcge1xuICBjb25zdCBieXRlcyA9IFtdO1xuICB3aGlsZSAoYXJyW2FkZHJlc3NdICE9IGVuZCkge1xuICAgIGJ5dGVzLnB1c2goYXJyW2FkZHJlc3MrK10pO1xuICB9XG4gIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmJ5dGVzKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdyaXRlTGl0dGxlRW5kaWFuKGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIsIHZhbHVlOiBudW1iZXIpIHtcbiAgZGF0YVtvZmZzZXRdID0gdmFsdWUgJiAweGZmO1xuICBkYXRhW29mZnNldCArIDFdID0gdmFsdWUgPj4+IDg7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3cml0ZVN0cmluZyhhcnI6IERhdGE8bnVtYmVyPiwgYWRkcmVzczogbnVtYmVyLCBzdHI6IHN0cmluZykge1xuICBmb3IgKGxldCBpID0gMCwgbGVuID0gc3RyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgYXJyW2FkZHJlc3MgKyBpXSA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3cml0ZShkYXRhOiBVaW50OEFycmF5LCBvZmZzZXQ6IG51bWJlciwgdmFsdWVzOiBEYXRhPG51bWJlcj4pIHtcbiAgZGF0YS5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIHZhbHVlcy5sZW5ndGgpLnNldCh2YWx1ZXMpO1xufVxuXG5leHBvcnQgY2xhc3MgRmxhZ0xpc3RUeXBlIHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgbGFzdDogbnVtYmVyLCByZWFkb25seSBjbGVhcjogbnVtYmVyKSB7fVxuXG4gIHJlYWQoZGF0YTogRGF0YTxudW1iZXI+LCBvZmZzZXQ6IG51bWJlciA9IDApOiBudW1iZXJbXSB7XG4gICAgLy8gVE9ETyAtIGRvIHdlIGV2ZXIgbmVlZCB0byBpbnZlcnQgY2xlYXIvbGFzdD8gIElmIHNvLCB1c2UgfiBhcyBzaWduYWwuXG4gICAgY29uc3QgZmxhZ3MgPSBbXTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgY29uc3QgaGkgPSBkYXRhW29mZnNldCsrXTtcbiAgICAgIGNvbnN0IGxvID0gZGF0YVtvZmZzZXQrK107XG4gICAgICBjb25zdCBmbGFnID0gKGhpICYgMykgPDwgOCB8IGxvO1xuICAgICAgZmxhZ3MucHVzaChoaSAmIHRoaXMuY2xlYXIgPyB+ZmxhZyA6IGZsYWcpO1xuICAgICAgaWYgKGhpICYgdGhpcy5sYXN0KSByZXR1cm4gZmxhZ3M7XG4gICAgfVxuICB9XG5cbiAgYnl0ZXMoZmxhZ3M6IG51bWJlcltdKTogbnVtYmVyW10ge1xuICAgIGNvbnN0IGJ5dGVzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmbGFncy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IGZsYWcgPSBmbGFnc1tpXTtcbiAgICAgIGlmIChmbGFnIDwgMCkgZmxhZyA9ICh0aGlzLmNsZWFyIDw8IDgpIHwgfmZsYWc7XG4gICAgICBpZiAoaSA9PT0gZmxhZ3MubGVuZ3RoIC0gMSkgZmxhZyB8PSAodGhpcy5sYXN0IDw8IDgpO1xuICAgICAgYnl0ZXMucHVzaChmbGFnID4+PiA4KTtcbiAgICAgIGJ5dGVzLnB1c2goZmxhZyAmIDB4ZmYpO1xuICAgIH1cbiAgICByZXR1cm4gYnl0ZXM7XG4gIH1cblxuICB3cml0ZShkYXRhOiBEYXRhPG51bWJlcj4sIGZsYWdzOiBudW1iZXJbXSwgb2Zmc2V0OiBudW1iZXIgPSAwKSB7XG4gICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzKGZsYWdzKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ5dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBkYXRhW2kgKyBvZmZzZXRdID0gYnl0ZXNbaV07XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBESUFMT0dfRkxBR1MgPSBuZXcgRmxhZ0xpc3RUeXBlKDB4NDAsIDB4ODApO1xuZXhwb3J0IGNvbnN0IElURU1fR0VUX0ZMQUdTID0gbmV3IEZsYWdMaXN0VHlwZSgweDQwLCAweDgwKTtcbmV4cG9ydCBjb25zdCBTUEFXTl9DT05ESVRJT05fRkxBR1MgPSBuZXcgRmxhZ0xpc3RUeXBlKDB4ODAsIDB4MjApO1xuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbmRlY2xhcmUgY29uc3QgaW5pdGlhbFRhZzogdW5pcXVlIHN5bWJvbDtcbmV4cG9ydCBpbnRlcmZhY2UgSW5pdGlhbCB7IFtpbml0aWFsVGFnXTogbmV2ZXI7IH1cbmV4cG9ydCB0eXBlIEluaXRpYWxQcm9wczxULFxuICAgIFggPSB7W1AgaW4ga2V5b2YgVF06IFRbUF0gZXh0ZW5kcyBJbml0aWFsID8gUCA6IG5ldmVyfT4gPSBYW2tleW9mIFhdO1xuXG4vLyBJbXBsIC0gcXVlc3Rpb24gLSBjYW4gd2UgZG8gc29tZXRoaW5nIHNpbWlsYXIgZm9yIERhdGFUdXBsZT8/P1xuXG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZXI8UCBleHRlbmRzIHJlYWRvbmx5IGFueVtdLCBUPigpOiBJbml0aWFsaXplcjxQLCBUPiB7XG4gIGNvbnN0IHRhZyA9IFN5bWJvbCgpO1xuICBmdW5jdGlvbiBmKC4uLmFyZ3M6IFApOiBUICYgSW5pdGlhbCB7XG4gICAgcmV0dXJuIHt0YWcsIGFyZ3N9IGFzIGFueTsgLy8gTk9URTogdGhpcyBpcyBhIGNvbXBsZXRlIGxpZSBmb3Igbm93LlxuICB9XG4gIGYuY29tbWl0ID0gKGluc3RhbmNlOiBhbnksIGJ1aWxkZXI6IChwcm9wOiBzdHJpbmcsIC4uLmFyZ3M6IFApID0+IFQpID0+IHtcbiAgICBmb3IgKGNvbnN0IHByb3Agb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoaW5zdGFuY2UpKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IGluc3RhbmNlW3Byb3BdO1xuICAgICAgaWYgKHZhbHVlLnRhZyAhPT0gdGFnKSBjb250aW51ZTtcbiAgICAgIGluc3RhbmNlW3Byb3BdID0gYnVpbGRlcihwcm9wLCAuLi52YWx1ZS5hcmdzKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBmO1xufVxuZXhwb3J0IGludGVyZmFjZSBJbml0aWFsaXplcjxQIGV4dGVuZHMgcmVhZG9ubHkgYW55W10sIFQ+IHtcbiAgKC4uLmFyZ3M6IFApOiBUO1xuICBjb21taXQoaW5zdGFuY2U6IGFueSwgYnVpbGRlcjogKHByb3A6IHN0cmluZywgLi4uYXJnczogUCkgPT4gVCk6IHZvaWQ7XG59XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxudHlwZSBOb25OZXZlclByb3BzPFQ+ID0gKHtbSyBpbiBrZXlvZiBUXTogVFtLXSBleHRlbmRzIG5ldmVyID8gbmV2ZXIgOiBLfSlba2V5b2YgVF07XG5leHBvcnQgdHlwZSBOb25OZXZlcjxUPiA9IFBpY2s8VCwgTm9uTmV2ZXJQcm9wczxUPj47XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuLy8gLy8gaW50ZXJmYWNlIFJlYWRvbmx5U2V0PFY+IGV4dGVuZHMgSXRlcmFibGU8Vj4ge1xuLy8gLy8gICBoYXMoZWxlbTogVik6IGJvb2xlYW47XG4vLyAvLyB9XG4vLyBpbnRlcmZhY2UgSGFzSWQge1xuLy8gICBpZDogbnVtYmVyO1xuLy8gfVxuXG4vLyB0eXBlIENvbGxlY3Rpb25CYXNlPEssIFY+ID0ge1tUIGluIGtleW9mIEtdOiBWfSAmIFJlYWRvbmx5U2V0PFY+O1xuLy8gdHlwZSBDb2xsZWN0aW9uQmFzZUluZGV4PEssIFYgZXh0ZW5kcyB7aWQ6IG51bWJlcn0+ID1cbi8vICAgICBDb2xsZWN0aW9uQmFzZTxLLCBWPiAmIHtbaWQ6IG51bWJlcl06IFZ9O1xuLy8gdHlwZSBDb2xsZWN0aW9uQmFzZUFycmF5PEssIFYgZXh0ZW5kcyB7aWQ6IG51bWJlcn0+ID1cbi8vICAgICB7W1QgaW4ga2V5b2YgS106IFZ9ICYgUmVhZG9ubHlBcnJheTxWPiAmIEl0ZXJhYmxlPFY+O1xuXG4vLyB0eXBlIENvbGxlY3Rpb25NYXBwZXI8SywgVj4gPSA8VCBleHRlbmRzIGtleW9mIEs+KGVsZW06IEtbVF0sIGtleTogVCkgPT4gVjtcbi8vIGludGVyZmFjZSBDb2xsZWN0aW9uQ3RvcjxLLCBWPiB7XG4vLyAgIG5ldyhkYXRhOiBLLCBtYXBwZXI6IENvbGxlY3Rpb25NYXBwZXI8SywgVj4pOiBDb2xsZWN0aW9uQmFzZTxLLCBWPjtcbi8vIH1cbi8vIGludGVyZmFjZSBDb2xsZWN0aW9uQ3RvckluZGV4PEssIFYgZXh0ZW5kcyB7aWQ6IG51bWJlcn0+IHtcbi8vICAgbmV3KGRhdGE6IEssIG1hcHBlcjogQ29sbGVjdGlvbk1hcHBlcjxLLCBWPik6IENvbGxlY3Rpb25CYXNlSW5kZXg8SywgVj47XG4vLyB9XG4vLyBpbnRlcmZhY2UgQ29sbGVjdGlvbkN0b3JBcnJheTxLLCBWIGV4dGVuZHMge2lkOiBudW1iZXJ9PiB7XG4vLyAgIG5ldyhkYXRhOiBLLCBtYXBwZXI6IENvbGxlY3Rpb25NYXBwZXI8SywgVj4sIGluaXRpYWxTaXplPzogbnVtYmVyKTpcbi8vICAgICAgIENvbGxlY3Rpb25CYXNlQXJyYXk8SywgVj47XG4vLyB9XG5cbi8vIC8vIGZ1bmN0aW9uIGNvbGxlY3Rpb25CYXNlPEssIFY+KCk6IHtcbi8vIC8vICAgbmV3KGRhdGE6IEssIG1hcHBlcjogQ29sbGVjdGlvbk1hcHBlcjxLLCBWPik6IENvbGxlY3Rpb25CYXNlPEssIFY+XG4vLyAvLyB9IHtcbi8vIC8vICAgcmV0dXJuIGNsYXNzIGV4dGVuZHMgU2V0PHVua25vd24+IHtcbi8vIC8vICAgICBjb25zdHJ1Y3RvcihkYXRhOiBLLCBtYXBwZXI6IDxUIGV4dGVuZHMga2V5b2YgSz4oZWxlbTogS1tUXSwga2V5OiBUKSA9PiBWKSB7XG4vLyAvLyAgICAgICBzdXBlcigpO1xuLy8gLy8gICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xuLy8gLy8gICAgICAgICBjb25zdCB2YWx1ZSA9IG1hcHBlcihkYXRhW2tleV0sIGtleSk7XG4vLyAvLyAgICAgICAgIHN1cGVyLmFkZCgodGhpcyBhcyBhbnkpW2tleV0gPSB2YWx1ZSk7XG4vLyAvLyAgICAgICAgIGlmIChpbmRleGVkKSAodGhpcyBhcyBhbnkpWyh2YWx1ZSBhcyBhbnkpLmlkXSA9IHZhbHVlO1xuLy8gLy8gICAgICAgfVxuLy8gLy8gICAgIH1cbi8vIC8vICAgICBhZGQoKTogbmV2ZXIgeyB0aHJvdyBuZXcgRXJyb3IoJ25vdCBpbXBsZW1lbnRlZCcpOyB9XG4vLyAvLyAgICAgZGVsZXRlKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gLy8gICAgIGNsZWFyKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gLy8gICB9IGFzIGFueTtcbi8vIC8vIH1cblxuLy8gZXhwb3J0IGZ1bmN0aW9uIGNvbGxlY3Rpb25CYXNlPEssIFYgZXh0ZW5kcyBIYXNJZD4oaW5kZXhlZDogdHJ1ZSk6IENvbGxlY3Rpb25DdG9ySW5kZXg8SywgVj47XG4vLyBleHBvcnQgZnVuY3Rpb24gY29sbGVjdGlvbkJhc2U8SywgVj4oaW5kZXhlZDogYm9vbGVhbik6IENvbGxlY3Rpb25DdG9yPEssIFY+IHtcbi8vICAgcmV0dXJuIGNsYXNzIGV4dGVuZHMgU2V0PHVua25vd24+IHtcbi8vICAgICBjb25zdHJ1Y3RvcihkYXRhOiBLLCBtYXBwZXI6IDxUIGV4dGVuZHMga2V5b2YgSz4oZWxlbTogS1tUXSwga2V5OiBUKSA9PiBWKSB7XG4vLyAgICAgICBzdXBlcigpO1xuLy8gICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xuLy8gICAgICAgICBjb25zdCB2YWx1ZSA9IG1hcHBlcihkYXRhW2tleV0sIGtleSk7XG4vLyAgICAgICAgIHN1cGVyLmFkZCgodGhpcyBhcyBhbnkpW2tleV0gPSB2YWx1ZSk7XG4vLyAgICAgICAgIGlmIChpbmRleGVkKSAodGhpcyBhcyBhbnkpWyh2YWx1ZSBhcyBhbnkpLmlkXSA9IHZhbHVlO1xuLy8gICAgICAgfVxuLy8gICAgIH1cbi8vICAgICBhZGQoKTogbmV2ZXIgeyB0aHJvdyBuZXcgRXJyb3IoJ25vdCBpbXBsZW1lbnRlZCcpOyB9XG4vLyAgICAgZGVsZXRlKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gICAgIGNsZWFyKCk6IG5ldmVyIHsgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTsgfVxuLy8gICB9IGFzIGFueTtcbi8vIH1cblxuLy8gZXhwb3J0IGZ1bmN0aW9uIGNvbGxlY3Rpb25CYXNlQXJyYXk8SywgViBleHRlbmRzIEhhc0lkPigpOiBDb2xsZWN0aW9uQ3RvckFycmF5PEssIFY+IHtcbi8vICAgcmV0dXJuIGNsYXNzIGV4dGVuZHMgQXJyYXk8dW5rbm93bj4ge1xuLy8gICAgIHN0YXRpYyBnZXQgW1N5bWJvbC5zcGVjaWVzXSgpIHsgcmV0dXJuIEFycmF5OyB9XG4vLyAgICAgY29uc3RydWN0b3IoZGF0YTogSyxcbi8vICAgICAgICAgICAgICAgICBtYXBwZXI6IDxUIGV4dGVuZHMga2V5b2YgSz4oZWxlbTogS1tUXSwga2V5OiBUKSA9PiBWLFxuLy8gICAgICAgICAgICAgICAgIGluaXRpYWxTaXplID0gMCkge1xuLy8gICAgICAgc3VwZXIoaW5pdGlhbFNpemUpO1xuLy8gICAgICAgZm9yIChjb25zdCBrZXkgaW4gZGF0YSkge1xuLy8gICAgICAgICBjb25zdCB2YWx1ZSA9IG1hcHBlcihkYXRhW2tleV0sIGtleSk7XG4vLyAgICAgICAgICh0aGlzIGFzIGFueSlbdmFsdWUuaWRdID0gdmFsdWU7XG4vLyAgICAgICB9XG4vLyAgICAgfVxuLy8gICB9IGFzIGFueTtcbi8vIH1cblxuLy8gLy8gZXhwb3J0IGNsYXNzIENvbGxlY3Rpb248SywgVj4gZXh0ZW5kcyBjb2xsZWN0aW9uQmFzZTxLLCBWPigpIGltcGxlbWVudHMgQ29sbGVjdGlvbkJhc2U8SywgVj4ge31cbi8vIC8vIGV4cG9ydCBjbGFzcyBJbmRleGVkQ29sbGVjdGlvbjxLLCBWIGV4dGVuZHMge2lkOiBudW1iZXJ9PlxuLy8gLy8gICAgIGV4dGVuZHMgY29sbGVjdGlvbkJhc2U8SywgVj4odHJ1ZSkge31cbi8vIC8vIGV4cG9ydCBjbGFzcyBBcnJheUNvbGxlY3Rpb248SywgViBleHRlbmRzIHtpZDogbnVtYmVyfT5cbi8vIC8vICAgICBleHRlbmRzIGNvbGxlY3Rpb25CYXNlQXJyYXk8SywgVj4oKSB7fVxuXG4vLyAvLyB0eXBlIENvbGxlY3Rpb25CYXNlPEssIFY+ID0ge1xuLy8gLy8gICByZWFkb25seSBbVCBpbiBrZXlvZiBLXTogVixcbiAgXG4vLyAvLyBleHBvcnQgZnVuY3Rpb24gY29sbGVjdGlvbkJhc2U8SywgVj4oKToge25ldygpOiB7W1QgaW4ga2V5b2YgS106IFZ9fSB7XG4vLyAvLyAgIHJldHVybiBPYmplY3QgYXMgdW5rbm93biBhcyB7bmV3KCk6IHtbVCBpbiBrZXlvZiBLXTogVn19O1xuLy8gLy8gfVxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbmNvbnN0IFBST1BfVEFHID0gU3ltYm9sKCdQUk9QX1RBRycpO1xuXG50eXBlIFNldHRlckhlbHBlcjxYLCBZLCBaLCBBPiA9XG4gIFogZXh0ZW5kcyBGdW5jdGlvbiA/IG5ldmVyIDpcbiAgKDxUPigpID0+IFQgZXh0ZW5kcyBYID8gMSA6IDIpIGV4dGVuZHNcbiAgKDxUPigpID0+IFQgZXh0ZW5kcyBZID8gMSA6IDIpID8gQSA6IG5ldmVyO1xudHlwZSBTZXR0ZXJQcm9wczxUPiA9IHtcbiAgW1AgaW4ga2V5b2YgVF0tPzogU2V0dGVySGVscGVyPHtbUSBpbiBQXTogVFtQXX0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7LXJlYWRvbmx5IFtRIGluIFBdOiBUW1BdfSwgVFtQXSwgUD5cbn1ba2V5b2YgVF07XG4vLyBOT1RFOiBUaGlzIGZvcm0gZ2l2ZXMgdGhlIGJlc3QgdG9vbHRpcCBtZXNzYWdlcy5cbnR5cGUgU2V0dGFibGU8VD4gPSBQaWNrUGFydGlhbDxULCBTZXR0ZXJQcm9wczxUPj47XG5pbnRlcmZhY2UgRGF0YVR1cGxlQ3RvcjxUIGV4dGVuZHMgRGF0YVR1cGxlPiB7XG4gIG5ldyhhcmc6IG5ldmVyKTogVDsgLy8gTk9URTogaXQncyBhY3R1YWxseSBkYXRhOiBEYXRhPG51bWJlcj5cbiAgc2l6ZTogbnVtYmVyO1xufVxudHlwZSBQaWNrUGFydGlhbDxULCBLIGV4dGVuZHMga2V5b2YgVD4gPSB7W1AgaW4gS10/OiBUW1BdfTtcblxuY29uc3QgZGF0YVR1cGxlTWFwID0gbmV3IFdlYWtNYXAoKTtcblxuZnVuY3Rpb24gZGF0YVR1cGxlQWN0dWFsQ2xhc3M8VCBleHRlbmRzIERhdGFUdXBsZUN0b3I8YW55Pj4oYXJnOiBUKTogVCB7XG4gIGxldCByZXN1bHQgPSBkYXRhVHVwbGVNYXAuZ2V0KGFyZyk7XG4gIGlmICghcmVzdWx0KSB7XG4gICAgLy8gTWFrZSBhIG5ldyBkaXJlY3Qgc3VidHlwZSBvZiBEYXRhVHVwbGUsIGJ1dCBtYWtlIGl0IGxvb2sgbGlrZSBhcmcuXG4gICAgcmVzdWx0ID0gY2xhc3MgZXh0ZW5kcyBEYXRhVHVwbGUge307XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMocmVzdWx0LCB7bmFtZToge3ZhbHVlOiBhcmcubmFtZX19KTtcbiAgICBPYmplY3QuYXNzaWduKHJlc3VsdCwgYXJnKTsgLy8gY29weSBzdGF0aWMgcHJvcGVydGllcyB0byBlbnN1cmUgY3RvciBza2lwcGVkXG4gICAgUmVmbGVjdC5zZXRQcm90b3R5cGVPZihyZXN1bHQucHJvdG90eXBlLCBhcmcucHJvdG90eXBlKTtcbiAgICAvLyBSZWZsZWN0IG9uIGFuIGFjdHVhbCBpbnN0YW5jZSB0byBmaW5kIHRoZSBwcm9wcy5cbiAgICBjb25zdCBwcm90byA9IG5ldyAoYXJnIGFzIGFueSkoKTtcbiAgICBjb25zdCBkZXNjcmlwdG9yczogYW55ID0ge307XG4gICAgZm9yIChjb25zdCBbcHJvcCwgZGVzY3JdIG9mIE9iamVjdC5lbnRyaWVzKHByb3RvKSkge1xuICAgICAgaWYgKGRlc2NyICYmIChkZXNjciBhcyB7W1BST1BfVEFHXTogYm9vbGVhbn0pW1BST1BfVEFHXSkge1xuICAgICAgICBkZXNjcmlwdG9yc1twcm9wXSA9IGRlc2NyO1xuICAgICAgfVxuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhyZXN1bHQucHJvdG90eXBlLCBkZXNjcmlwdG9ycyk7XG4gICAgLy8gRmluYWxseSBhZGQgaXQgdG8gdGhlIG1hcCBmb3IgYm90aCBhcmcgYW5kIHJlc3VsdC5cbiAgICBkYXRhVHVwbGVNYXAuc2V0KGFyZywgcmVzdWx0KTtcbiAgICBkYXRhVHVwbGVNYXAuc2V0KHJlc3VsdCwgcmVzdWx0KTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRGF0YVR1cGxlIGltcGxlbWVudHMgSXRlcmFibGU8bnVtYmVyPiB7XG4gIHN0YXRpYyBzaXplOiBudW1iZXI7XG5cbiAgcmVhZG9ubHkgZGF0YTogRGF0YTxudW1iZXI+O1xuICBjb25zdHJ1Y3Rvcihhcmc6IG5ldmVyKSB7XG4gICAgdGhpcy5kYXRhID0gYXJnO1xuICB9XG5cbiAgc3RhdGljIG9mPFQgZXh0ZW5kcyBEYXRhVHVwbGU+KHRoaXM6IERhdGFUdXBsZUN0b3I8VD4sIGluaXRzOiBTZXR0YWJsZTxUPik6XG4gIFQge1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKFxuICAgICAgICBuZXcgKGRhdGFUdXBsZUFjdHVhbENsYXNzKHRoaXMpIGFzIGFueSkobmV3IEFycmF5KHRoaXMuc2l6ZSkuZmlsbCgwKSksXG4gICAgICAgIGluaXRzKTtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tPFQgZXh0ZW5kcyBEYXRhVHVwbGU+KHRoaXM6IERhdGFUdXBsZUN0b3I8VD4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0ID0gMCk6XG4gIFQge1xuICAgIGNvbnN0IGNsczogYW55ID0gZGF0YVR1cGxlQWN0dWFsQ2xhc3ModGhpcyk7XG4gICAgY29uc3QgYXJnID1cbiAgICAgICAgIW9mZnNldCAmJiBkYXRhLmxlbmd0aCA9PT0gdGhpcy5zaXplID9cbiAgICAgICAgZGF0YSA6IHR1cGxlKGRhdGEsIG9mZnNldCwgdGhpcy5zaXplKTtcbiAgICByZXR1cm4gbmV3IGNscyhhcmcpO1xuICB9XG5cbiAgW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmF0b3I8bnVtYmVyPiB7XG4gICAgcmV0dXJuICh0aGlzLmRhdGEgYXMgbnVtYmVyW10pW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgfVxuXG4gIGhleCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZGF0YSwgaGV4KS5qb2luKCcgJyk7XG4gIH1cblxuICBjbG9uZSgpOiB0aGlzIHtcbiAgICByZXR1cm4gbmV3ICh0aGlzLmNvbnN0cnVjdG9yIGFzIGFueSkodGhpcy5kYXRhKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBwcm9wKC4uLmJpdHM6IFtudW1iZXIsIG51bWJlcj8sIG51bWJlcj9dW10pOiBudW1iZXIge1xuICAgIHJldHVybiB7XG4gICAgICBnZXQodGhpczogRGF0YVR1cGxlKTogbnVtYmVyIHtcbiAgICAgICAgbGV0IHZhbHVlID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBbaW5kZXgsIG1hc2sgPSAweGZmLCBzaGlmdCA9IDBdIG9mIGJpdHMpIHtcbiAgICAgICAgICBjb25zdCBsc2ggPSBzaGlmdCA8IDAgPyAtc2hpZnQgOiAwO1xuICAgICAgICAgIGNvbnN0IHJzaCA9IHNoaWZ0IDwgMCA/IDAgOiBzaGlmdDtcbiAgICAgICAgICB2YWx1ZSB8PSAoKHRoaXMuZGF0YVtpbmRleF0gJiBtYXNrKSA+Pj4gcnNoKSA8PCBsc2g7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfSxcbiAgICAgIHNldCh0aGlzOiBEYXRhVHVwbGUsIHZhbHVlOiBudW1iZXIpIHtcbiAgICAgICAgZm9yIChjb25zdCBbaW5kZXgsIG1hc2sgPSAweGZmLCBzaGlmdCA9IDBdIG9mIGJpdHMpIHtcbiAgICAgICAgICBjb25zdCBsc2ggPSBzaGlmdCA8IDAgPyAtc2hpZnQgOiAwO1xuICAgICAgICAgIGNvbnN0IHJzaCA9IHNoaWZ0IDwgMCA/IDAgOiBzaGlmdDtcbiAgICAgICAgICBjb25zdCB2ID0gKHZhbHVlID4+PiBsc2gpIDw8IHJzaCAmIG1hc2s7XG4gICAgICAgICAgdGhpcy5kYXRhW2luZGV4XSA9IHRoaXMuZGF0YVtpbmRleF0gJiB+bWFzayB8IHY7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBbUFJPUF9UQUddOiB0cnVlLFxuICAgIH0gYXMgdW5rbm93biBhcyBudW1iZXI7XG4gIH1cblxuICBwcm90ZWN0ZWQgYm9vbGVhblByb3AoYnl0ZTogbnVtYmVyLCBiaXQ6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiB7XG4gICAgICBnZXQodGhpczogRGF0YVR1cGxlKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiBCb29sZWFuKHRoaXMuZGF0YVtieXRlXSAmICgxIDw8IGJpdCkpO1xuICAgICAgfSxcbiAgICAgIHNldCh0aGlzOiBEYXRhVHVwbGUsIHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIGNvbnN0IG1hc2sgPSAxIDw8IGJpdDtcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5kYXRhW2J5dGVdIHw9IG1hc2s7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5kYXRhW2J5dGVdICY9IH5tYXNrO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgW1BST1BfVEFHXTogdHJ1ZSxcbiAgICB9IGFzIHVua25vd24gYXMgYm9vbGVhbjtcbiAgfVxufSAgXG5cblxuXG5cbi8vIGludGVyZmFjZSBHZXRTZXQ8VT4ge1xuLy8gICBnZXQoKTogVTtcbi8vICAgc2V0KGFyZzogVSk6IHZvaWQ7XG4vLyB9XG5cbi8vIHR5cGUgRGF0YVR1cGxlU3ViPFQ+ID1cbi8vICAgICB7W0sgaW4ga2V5b2YgVF06IFRbS10gZXh0ZW5kcyBHZXRTZXQ8aW5mZXIgVT4gPyBVIDpcbi8vICAgICAgICAgICAgICAgICAgICAgIFRbS10gZXh0ZW5kcyB7dmFsdWU6IChpbmZlciBXKX0gPyBXIDpcbi8vICAgICAgICAgICAgICAgICAgICAgIFRbS10gZXh0ZW5kcyAoLi4uYXJnczogYW55W10pID0+IHZvaWQgPyBUW0tdIDogbmV2ZXJ9ICYgRGF0YVR1cGxlO1xuXG4vLyAvLyBOb3RlOiBpdCB3b3VsZCBiZSBuaWNlIGZvciB0aGUgZmluYWwgVFtLXSBiZWxvdyB0byBiZSAnbmV2ZXInLCBidXRcbi8vIC8vIHRoaXMgZmFpbHMgYmVjYXVzZSBhbGwgb2JqZWN0cyBoYXZlIGFuIGltcGxpY2l0IHRvU3RyaW5nLCB3aGljaCB3b3VsZFxuLy8gLy8gb3RoZXJ3aXNlIG5lZWQgdG8gYmUge3RvU3RyaW5nPzogdW5kZWZpbmVkfSBmb3Igc29tZSByZWFzb24uXG4vLyB0eXBlIERhdGFUdXBsZUluaXRzPFxuLy8gICBULCBLID0ge1tQIGluIGtleW9mIFRdOiBUW1BdIGV4dGVuZHMge3NldChhcmc6IGluZmVyIFUpOiB2b2lkfSA/IFUgOiBuZXZlcn0+XG4vLyAgID0ge1tQIGluIE5vbk5ldmVyUHJvcHM8Sz5dPzogS1tQXX07XG5cbi8vIGludGVyZmFjZSBEYXRhVHVwbGVDdG9yPFQ+IHtcbi8vICAgbmV3KGRhdGE/OiBEYXRhPG51bWJlcj4pOiBEYXRhVHVwbGVTdWI8VD47XG4vLyAgIG9mPFYgZXh0ZW5kcyBEYXRhVHVwbGVDdG9yPFQ+Pih0aGlzOiBWLCBpbml0czogRGF0YVR1cGxlSW5pdHM8VD4pOiBJbnN0YW5jZVR5cGU8Vj47XG4vLyAgIGZyb208ViBleHRlbmRzIERhdGFUdXBsZUN0b3I8VD4+KGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIpOiBJbnN0YW5jZVR5cGU8Vj47XG4vLyB9XG5cbmV4cG9ydCBjb25zdCB3YXRjaEFycmF5ID0gKGFycjogRGF0YTx1bmtub3duPiwgd2F0Y2g6IG51bWJlcikgPT4ge1xuICBjb25zdCBhcnJheUNoYW5nZUhhbmRsZXIgPSB7XG4gICAgZ2V0KHRhcmdldDogYW55LCBwcm9wZXJ0eTogc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnZ2V0dGluZyAnICsgcHJvcGVydHkgKyAnIGZvciAnICsgdGFyZ2V0KTtcbiAgICAgIC8vIHByb3BlcnR5IGlzIGluZGV4IGluIHRoaXMgY2FzZVxuICAgICAgbGV0IHYgPSB0YXJnZXRbcHJvcGVydHldO1xuICAgICAgaWYgKHByb3BlcnR5ID09PSAnc3ViYXJyYXknKSB7XG4gICAgICAgIHJldHVybiAoc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIpID0+IHtcbiAgICAgICAgICBjb25zdCBzdWIgPSB0YXJnZXQuc3ViYXJyYXkoc3RhcnQsIGVuZCk7XG4gICAgICAgICAgaWYgKHN0YXJ0IDw9IHdhdGNoICYmIHdhdGNoIDwgZW5kKSByZXR1cm4gd2F0Y2hBcnJheShzdWIsIHdhdGNoIC0gc3RhcnQpO1xuICAgICAgICAgIHJldHVybiBzdWI7XG4gICAgICAgIH07XG4gICAgICB9IGVsc2UgaWYgKHByb3BlcnR5ID09PSAnc2V0Jykge1xuICAgICAgICByZXR1cm4gKHZhbDogRGF0YTx1bmtub3duPikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBTZXR0aW5nIG92ZXJsYXBwaW5nIGFycmF5ICR7d2F0Y2h9YCk7XG4gICAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCcnKTtcbiAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICB0YXJnZXQuc2V0KHZhbCk7XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIHYgPT09ICdmdW5jdGlvbicpIHYgPSB2LmJpbmQodGFyZ2V0KTtcbiAgICAgIHJldHVybiB2O1xuICAgIH0sXG4gICAgc2V0KHRhcmdldDogYW55LCBwcm9wZXJ0eTogc3RyaW5nIHwgbnVtYmVyLCB2YWx1ZTogYW55LCByZWNlaXZlcjogYW55KSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnc2V0dGluZyAnICsgcHJvcGVydHkgKyAnIGZvciAnLyogKyB0YXJnZXQqLyArICcgd2l0aCB2YWx1ZSAnICsgdmFsdWUpO1xuICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnRyaXBsZS1lcXVhbHNcbiAgICAgIGlmIChwcm9wZXJ0eSA9PSB3YXRjaCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgV3JpdGluZyAke3dhdGNoLnRvU3RyaW5nKDE2KX1gKTtcbiAgICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCcnKTtcbiAgICAgICAgZGVidWdnZXI7XG4gICAgICB9XG4gICAgICB0YXJnZXRbcHJvcGVydHldID0gdmFsdWU7XG4gICAgICAvLyB5b3UgaGF2ZSB0byByZXR1cm4gdHJ1ZSB0byBhY2NlcHQgdGhlIGNoYW5nZXNcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG4gIH07XG4gIHJldHVybiBuZXcgUHJveHkoYXJyLCBhcnJheUNoYW5nZUhhbmRsZXIpO1xufTtcbiJdfQ==