export function upperCamelToSpaces(upperCamel) {
    return upperCamel.replace(/([a-z])([A-Z0-9])/g, '$1 $2')
        .replace(/Of/g, 'of')
        .replace(/_/g, ' - ');
}
export function seq(x, f = (i) => i) {
    return new Array(x).fill(0).map((_, i) => f(i));
}
export function slice(arr, start, len) {
    return arr.slice(start, start + len);
}
export function tuple(arr, start, len) {
    return Array.from(arr.slice(start, start + len));
}
export function signed(x) {
    return x < 0x80 ? x : x - 0x100;
}
export function unsigned(x) {
    return x < 0 ? x + 0x100 : x;
}
export function varSlice(arr, start, width, sentinel, end = Infinity, func) {
    if (!func)
        func = (x) => x;
    const out = [];
    while (start + width <= end && arr[start] !== sentinel) {
        out.push(func(arr.slice(start, start + width)));
        start += width;
    }
    return out;
}
export function addr(arr, i, offset = 0) {
    return (arr[i] | arr[i + 1] << 8) + offset;
}
export function group(width, arr, func) {
    if (!func)
        func = (x) => x;
    return seq(Math.max(0, Math.floor(arr.length / width)), i => func(slice(arr, i * width, width)));
}
export function reverseBits(x) {
    return ((x * 0x0802 & 0x22110) | (x * 0x8020 & 0x88440)) * 0x10101 >>> 16 & 0xff;
}
export function countBits(x) {
    x -= x >> 1 & 0x55;
    x = (x & 0x33) + (x >> 2 & 0x33);
    return (x + (x >> 4)) & 0xf;
}
export function hex(id) {
    return id != null ? id.toString(16).padStart(2, '0') : String(id);
}
export function hex3(id) {
    return id.toString(16).padStart(3, '0');
}
export function hex4(id) {
    return id.toString(16).padStart(4, '0');
}
export function hex5(id) {
    return id.toString(16).padStart(5, '0');
}
export function concatIterables(iters) {
    const out = [];
    for (const iter of iters) {
        for (const elem of iter) {
            out.push(elem);
        }
    }
    return out;
}
export function readBigEndian(data, offset) {
    return data[offset] << 8 | data[offset + 1];
}
export function readLittleEndian(data, offset) {
    return data[offset + 1] << 8 | data[offset];
}
export function readString(arr, address, end = 0) {
    const bytes = [];
    while (arr[address] != end) {
        bytes.push(arr[address++]);
    }
    return String.fromCharCode(...bytes);
}
export function writeLittleEndian(data, offset, value) {
    data[offset] = value & 0xff;
    data[offset + 1] = value >>> 8;
}
export function writeString(arr, address, str) {
    for (let i = 0, len = str.length; i < len; i++) {
        arr[address + i] = str.charCodeAt(i);
    }
}
export function write(data, offset, values) {
    data.subarray(offset, offset + values.length).set(values);
}
export class FlagListType {
    constructor(last, clear, nonEmpty = false) {
        this.last = last;
        this.clear = clear;
        this.nonEmpty = nonEmpty;
    }
    read(data, offset = 0) {
        const flags = [];
        while (true) {
            const hi = data[offset++];
            const lo = data[offset++];
            const flag = (hi & 3) << 8 | lo;
            const signed = hi & this.clear ? ~flag : flag;
            if (signed !== ~0)
                flags.push(signed);
            if (hi & this.last)
                return flags;
        }
    }
    bytes(flags) {
        flags = flags.filter(f => f !== ~0);
        if (this.nonEmpty && !flags.length)
            flags = [~0];
        const bytes = [];
        for (let i = 0; i < flags.length; i++) {
            let flag = flags[i];
            if (flag < 0)
                flag = (this.clear << 8) | ~flag;
            if (i === flags.length - 1)
                flag |= (this.last << 8);
            bytes.push(flag >>> 8);
            bytes.push(flag & 0xff);
        }
        return bytes;
    }
    write(data, flags, offset = 0) {
        const bytes = this.bytes(flags);
        for (let i = 0; i < bytes.length; i++) {
            data[i + offset] = bytes[i];
        }
    }
}
export const DIALOG_FLAGS = new FlagListType(0x40, 0x80);
export const ITEM_GET_FLAGS = new FlagListType(0x40, 0x80, true);
export const ITEM_USE_FLAGS = new FlagListType(0x40, 0x80, true);
export const ITEM_CONDITION_FLAGS = new FlagListType(0x80, 0x20, true);
export const SPAWN_CONDITION_FLAGS = new FlagListType(0x80, 0x20);
export function initializer() {
    const tag = Symbol();
    function f(...args) {
        return { tag, args };
    }
    f.commit = (instance, builder) => {
        for (const prop of Object.getOwnPropertyNames(instance)) {
            const value = instance[prop];
            if (value.tag !== tag)
                continue;
            instance[prop] = builder(prop, ...value.args);
        }
    };
    return f;
}
export class DataTuple {
    constructor(data) {
        this.data = data;
    }
    [Symbol.iterator]() {
        return this.data[Symbol.iterator]();
    }
    hex() {
        return Array.from(this.data, hex).join(' ');
    }
    clone() {
        return new this.constructor(this.data);
    }
    static make(length, props) {
        const cls = class extends DataTuple {
            constructor(data = new Array(length).fill(0)) { super(data); }
            static of(inits) {
                const out = new cls();
                for (const [key, value] of Object.entries(inits)) {
                    out[key] = value;
                }
                return out;
            }
            static from(data, offset = 0) {
                return new cls(tuple(data, offset, length));
            }
        };
        const descriptors = {};
        for (const key in props) {
            if (typeof props[key] === 'function') {
                descriptors[key] = { value: props[key] };
            }
            else {
                descriptors[key] = props[key];
            }
        }
        Object.defineProperties(cls.prototype, descriptors);
        return cls;
    }
    static prop(...bits) {
        return {
            get() {
                let value = 0;
                for (const [index, mask = 0xff, shift = 0] of bits) {
                    const lsh = shift < 0 ? -shift : 0;
                    const rsh = shift < 0 ? 0 : shift;
                    value |= ((this.data[index] & mask) >>> rsh) << lsh;
                }
                return value;
            },
            set(value) {
                for (const [index, mask = 0xff, shift = 0] of bits) {
                    const lsh = shift < 0 ? -shift : 0;
                    const rsh = shift < 0 ? 0 : shift;
                    const v = (value >>> lsh) << rsh & mask;
                    this.data[index] = this.data[index] & ~mask | v;
                }
            },
        };
    }
    static booleanProp(bit) {
        const prop = DataTuple.prop(bit);
        return { get() { return !!prop.get.call(this); },
            set(value) { prop.set.call(this, +value); } };
    }
}
export const watchArray = (arr, watch) => {
    const arrayChangeHandler = {
        get(target, property) {
            let v = target[property];
            if (property === 'subarray') {
                return (start, end) => {
                    const sub = target.subarray(start, end);
                    if (start <= watch && watch < end)
                        return watchArray(sub, watch - start);
                    return sub;
                };
            }
            else if (property === 'set') {
                return (val) => {
                    console.log(`Setting overlapping array ${watch}`);
                    debugger;
                    target.set(val);
                };
            }
            if (typeof v === 'function')
                v = v.bind(target);
            return v;
        },
        set(target, property, value, receiver) {
            if (property == watch) {
                console.log(`Writing ${watch.toString(16)}`);
                debugger;
            }
            target[property] = value;
            return true;
        },
    };
    return new Proxy(arr, arrayChangeHandler);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxNQUFNLFVBQVUsa0JBQWtCLENBQUMsVUFBa0I7SUFDbkQsT0FBTyxVQUFVLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLE9BQU8sQ0FBQztTQUNuRCxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQztTQUNwQixPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQzVCLENBQUM7QUFPRCxNQUFNLFVBQVUsR0FBRyxDQUFDLENBQVMsRUFBRSxJQUEyQixDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNoRSxPQUFPLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNsRCxDQUFDO0FBU0QsTUFBTSxVQUFVLEtBQUssQ0FBc0IsR0FBTSxFQUFFLEtBQWEsRUFBRSxHQUFXO0lBQzNFLE9BQU8sR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZDLENBQUM7QUFNRCxNQUFNLFVBQVUsS0FBSyxDQUFJLEdBQVksRUFBRSxLQUFhLEVBQUUsR0FBVztJQUMvRCxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUVELE1BQU0sVUFBVSxNQUFNLENBQUMsQ0FBUztJQUM5QixPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztB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QUVsRCxRQUFRLENBQUM7b0JBQ1QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDbEIsQ0FBQyxDQUFDO2FBQ0g7WUFDRCxJQUFJLE9BQU8sQ0FBQyxLQUFLLFVBQVU7Z0JBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDaEQsT0FBTyxDQUFDLENBQUM7UUFDWCxDQUFDO1FBQ0QsR0FBRyxDQUFDLE1BQVcsRUFBRSxRQUF5QixFQUFFLEtBQVUsRUFBRSxRQUFhO1lBR25FLElBQUksUUFBUSxJQUFJLEtBQUssRUFBRTtnQkFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUU3QyxRQUFRLENBQUM7YUFDVjtZQUNELE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxLQUFLLENBQUM7WUFFekIsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO0tBQ0YsQ0FBQztJQUNGLE9BQU8sSUFBSSxLQUFLLENBQUMsR0FBRyxFQUFFLGtCQUFrQixDQUFDLENBQUM7QUFDNUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gR2VuZXJhbCB1dGlsaXRpZXMgZm9yIHJvbSBwYWNrYWdlLlxuXG5leHBvcnQgZnVuY3Rpb24gdXBwZXJDYW1lbFRvU3BhY2VzKHVwcGVyQ2FtZWw6IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiB1cHBlckNhbWVsLnJlcGxhY2UoLyhbYS16XSkoW0EtWjAtOV0pL2csICckMSAkMicpXG4gICAgICAucmVwbGFjZSgvT2YvZywgJ29mJylcbiAgICAgIC5yZXBsYWNlKC9fL2csICcgLSAnKTtcbn1cblxuLyoqIFJlbW92ZXMgcmVhZG9ubHkgZnJvbSBmaWVsZHMuICovXG5leHBvcnQgdHlwZSBNdXRhYmxlPFQ+ID0gey1yZWFkb25seSBbSyBpbiBrZXlvZihUKV06IFRbS119O1xuXG5leHBvcnQgZnVuY3Rpb24gc2VxKHg6IG51bWJlcik6IG51bWJlcltdO1xuZXhwb3J0IGZ1bmN0aW9uIHNlcTxUPih4OiBudW1iZXIsIGY/OiAoeDogbnVtYmVyKSA9PiBUKTogVFtdO1xuZXhwb3J0IGZ1bmN0aW9uIHNlcSh4OiBudW1iZXIsIGY6ICh4OiBudW1iZXIpID0+IG51bWJlciA9IChpKSA9PiBpKTogbnVtYmVyW10ge1xuICByZXR1cm4gbmV3IEFycmF5KHgpLmZpbGwoMCkubWFwKChfLCBpKSA9PiBmKGkpKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEYXRhPFQ+IHtcbiAgW2luZGV4OiBudW1iZXJdOiBUO1xuICBsZW5ndGg6IG51bWJlcjtcbiAgc2xpY2Uoc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIpOiB0aGlzO1xuICBbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYXRvcjxUPjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNsaWNlPFQgZXh0ZW5kcyBEYXRhPGFueT4+KGFycjogVCwgc3RhcnQ6IG51bWJlciwgbGVuOiBudW1iZXIpOiBUIHtcbiAgcmV0dXJuIGFyci5zbGljZShzdGFydCwgc3RhcnQgKyBsZW4pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHVwbGU8VD4oYXJyOiBEYXRhPFQ+LCBzdGFydDogbnVtYmVyLCBsZW46IDIpOiBbVCwgVF07XG5leHBvcnQgZnVuY3Rpb24gdHVwbGU8VD4oYXJyOiBEYXRhPFQ+LCBzdGFydDogbnVtYmVyLCBsZW46IDMpOiBbVCwgVCwgVF07XG5leHBvcnQgZnVuY3Rpb24gdHVwbGU8VD4oYXJyOiBEYXRhPFQ+LCBzdGFydDogbnVtYmVyLCBsZW46IDQpOiBbVCwgVCwgVCwgVF07XG5leHBvcnQgZnVuY3Rpb24gdHVwbGU8VD4oYXJyOiBEYXRhPFQ+LCBzdGFydDogbnVtYmVyLCBsZW46IG51bWJlcik6IFRbXTtcbmV4cG9ydCBmdW5jdGlvbiB0dXBsZTxUPihhcnI6IERhdGE8VD4sIHN0YXJ0OiBudW1iZXIsIGxlbjogbnVtYmVyKTogVFtdIHtcbiAgcmV0dXJuIEFycmF5LmZyb20oYXJyLnNsaWNlKHN0YXJ0LCBzdGFydCArIGxlbikpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2lnbmVkKHg6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiB4IDwgMHg4MCA/IHggOiB4IC0gMHgxMDA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1bnNpZ25lZCh4OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4geCA8IDAgPyB4ICsgMHgxMDAgOiB4O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFyU2xpY2U8VCBleHRlbmRzIERhdGE8bnVtYmVyPj4oYXJyOiBULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW50aW5lbDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZD86IG51bWJlcik6IFRbXTtcbmV4cG9ydCBmdW5jdGlvbiB2YXJTbGljZTxUIGV4dGVuZHMgRGF0YTxudW1iZXI+LCBVPihhcnI6IFQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbnRpbmVsOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuYzogKHNsaWNlOiBUKSA9PiBVKTogVVtdO1xuZXhwb3J0IGZ1bmN0aW9uIHZhclNsaWNlPFQgZXh0ZW5kcyBEYXRhPG51bWJlcj4sIFU+KGFycjogVCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydDogbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VudGluZWw6IG51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IG51bWJlciA9IEluZmluaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM/OiAoc2xpY2U6IFQpID0+IFUpOiBVW10ge1xuICBpZiAoIWZ1bmMpIGZ1bmMgPSAoeDogVCkgPT4geCBhcyBhbnk7XG4gIGNvbnN0IG91dCA9IFtdO1xuICB3aGlsZSAoc3RhcnQgKyB3aWR0aCA8PSBlbmQgJiYgYXJyW3N0YXJ0XSAhPT0gc2VudGluZWwpIHtcbiAgICBvdXQucHVzaChmdW5jIShhcnIuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgd2lkdGgpKSk7XG4gICAgc3RhcnQgKz0gd2lkdGg7XG4gIH1cbiAgcmV0dXJuIG91dDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZHIoYXJyOiBEYXRhPG51bWJlcj4sIGk6IG51bWJlciwgb2Zmc2V0OiBudW1iZXIgPSAwKTogbnVtYmVyIHtcbiAgcmV0dXJuIChhcnJbaV0gfCBhcnJbaSArIDFdIDw8IDgpICsgb2Zmc2V0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ3JvdXA8VCBleHRlbmRzIERhdGE8YW55Pj4od2lkdGg6IG51bWJlciwgYXJyOiBUKTogVFtdO1xuZXhwb3J0IGZ1bmN0aW9uIGdyb3VwPFQgZXh0ZW5kcyBEYXRhPGFueT4sIFU+KHdpZHRoOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyOiBULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM6IChzbGljZTogVCkgPT4gVSk6IFVbXTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdyb3VwPFQgZXh0ZW5kcyBEYXRhPGFueT4sIFU+KHdpZHRoOiBudW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJyOiBULFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmM/OiAoc2xpY2U6IFQpID0+IFUpOiBVW10ge1xuICBpZiAoIWZ1bmMpIGZ1bmMgPSAoeDogVCkgPT4geCBhcyBhbnk7XG4gIHJldHVybiBzZXEoXG4gICAgICBNYXRoLm1heCgwLCBNYXRoLmZsb29yKGFyci5sZW5ndGggLyB3aWR0aCkpLFxuICAgICAgaSA9PiBmdW5jIShzbGljZShhcnIsIGkgKiB3aWR0aCwgd2lkdGgpKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXZlcnNlQml0cyh4OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gKCh4ICogMHgwODAyICYgMHgyMjExMCkgfCAoeCAqIDB4ODAyMCAmIDB4ODg0NDApKSAqIDB4MTAxMDEgPj4+IDE2ICYgMHhmZjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvdW50Qml0cyh4OiBudW1iZXIpOiBudW1iZXIge1xuICB4IC09IHggPj4gMSAmIDB4NTU7XG4gIHggPSAoeCAmIDB4MzMpICsgKHggPj4gMiAmIDB4MzMpO1xuICByZXR1cm4gKHggKyAoeCA+PiA0KSkgJiAweGY7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoZXgoaWQ6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBpZCAhPSBudWxsID8gaWQudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICcwJykgOiBTdHJpbmcoaWQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4MyhpZDogbnVtYmVyKTogc3RyaW5nIHtcbiAgcmV0dXJuIGlkLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgzLCAnMCcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4NChpZDogbnVtYmVyKTogc3RyaW5nIHtcbiAgcmV0dXJuIGlkLnRvU3RyaW5nKDE2KS5wYWRTdGFydCg0LCAnMCcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaGV4NShpZDogbnVtYmVyKTogc3RyaW5nIHtcbiAgcmV0dXJuIGlkLnRvU3RyaW5nKDE2KS5wYWRTdGFydCg1LCAnMCcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29uY2F0SXRlcmFibGVzKGl0ZXJzOiBJdGVyYWJsZTxudW1iZXI+W10pOiBudW1iZXJbXSB7XG4gIGNvbnN0IG91dDogbnVtYmVyW10gPSBbXTtcbiAgZm9yIChjb25zdCBpdGVyIG9mIGl0ZXJzKSB7XG4gICAgZm9yIChjb25zdCBlbGVtIG9mIGl0ZXIpIHtcbiAgICAgIG91dC5wdXNoKGVsZW0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gb3V0O1xuICAvLyByZXR1cm4gW10uY29uY2F0KC4uLml0ZXJzLm1hcChBcnJheS5mcm9tKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkQmlnRW5kaWFuKGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gZGF0YVtvZmZzZXRdIDw8IDggfCBkYXRhW29mZnNldCArIDFdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZExpdHRsZUVuZGlhbihkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIGRhdGFbb2Zmc2V0ICsgMV0gPDwgOCB8IGRhdGFbb2Zmc2V0XTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlYWRTdHJpbmcoYXJyOiBEYXRhPG51bWJlcj4sIGFkZHJlc3M6IG51bWJlciwgZW5kOiBudW1iZXIgPSAwKTogc3RyaW5nIHtcbiAgY29uc3QgYnl0ZXMgPSBbXTtcbiAgd2hpbGUgKGFyclthZGRyZXNzXSAhPSBlbmQpIHtcbiAgICBieXRlcy5wdXNoKGFyclthZGRyZXNzKytdKTtcbiAgfVxuICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSguLi5ieXRlcyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3cml0ZUxpdHRsZUVuZGlhbihkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyLCB2YWx1ZTogbnVtYmVyKSB7XG4gIGRhdGFbb2Zmc2V0XSA9IHZhbHVlICYgMHhmZjtcbiAgZGF0YVtvZmZzZXQgKyAxXSA9IHZhbHVlID4+PiA4O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gd3JpdGVTdHJpbmcoYXJyOiBEYXRhPG51bWJlcj4sIGFkZHJlc3M6IG51bWJlciwgc3RyOiBzdHJpbmcpIHtcbiAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHN0ci5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIGFyclthZGRyZXNzICsgaV0gPSBzdHIuY2hhckNvZGVBdChpKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gd3JpdGUoZGF0YTogVWludDhBcnJheSwgb2Zmc2V0OiBudW1iZXIsIHZhbHVlczogRGF0YTxudW1iZXI+KSB7XG4gIGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyB2YWx1ZXMubGVuZ3RoKS5zZXQodmFsdWVzKTtcbn1cblxuZXhwb3J0IGNsYXNzIEZsYWdMaXN0VHlwZSB7XG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IGxhc3Q6IG51bWJlcixcbiAgICAgICAgICAgICAgcmVhZG9ubHkgY2xlYXI6IG51bWJlcixcbiAgICAgICAgICAgICAgcmVhZG9ubHkgbm9uRW1wdHk6IGJvb2xlYW4gPSBmYWxzZSkge31cblxuICByZWFkKGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIgPSAwKTogbnVtYmVyW10ge1xuICAgIC8vIFRPRE8gLSBkbyB3ZSBldmVyIG5lZWQgdG8gaW52ZXJ0IGNsZWFyL2xhc3Q/ICBJZiBzbywgdXNlIH4gYXMgc2lnbmFsLlxuICAgIGNvbnN0IGZsYWdzID0gW107XG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgIGNvbnN0IGhpID0gZGF0YVtvZmZzZXQrK107XG4gICAgICBjb25zdCBsbyA9IGRhdGFbb2Zmc2V0KytdO1xuICAgICAgY29uc3QgZmxhZyA9IChoaSAmIDMpIDw8IDggfCBsbztcbiAgICAgIGNvbnN0IHNpZ25lZCA9IGhpICYgdGhpcy5jbGVhciA/IH5mbGFnIDogZmxhZztcbiAgICAgIGlmIChzaWduZWQgIT09IH4wKSBmbGFncy5wdXNoKHNpZ25lZCk7XG4gICAgICBpZiAoaGkgJiB0aGlzLmxhc3QpIHJldHVybiBmbGFncztcbiAgICB9XG4gIH1cblxuICBieXRlcyhmbGFnczogbnVtYmVyW10pOiBudW1iZXJbXSB7XG4gICAgZmxhZ3MgPSBmbGFncy5maWx0ZXIoZiA9PiBmICE9PSB+MCk7XG4gICAgaWYgKHRoaXMubm9uRW1wdHkgJiYgIWZsYWdzLmxlbmd0aCkgZmxhZ3MgPSBbfjBdO1xuICAgIGNvbnN0IGJ5dGVzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmbGFncy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IGZsYWcgPSBmbGFnc1tpXTtcbiAgICAgIGlmIChmbGFnIDwgMCkgZmxhZyA9ICh0aGlzLmNsZWFyIDw8IDgpIHwgfmZsYWc7XG4gICAgICBpZiAoaSA9PT0gZmxhZ3MubGVuZ3RoIC0gMSkgZmxhZyB8PSAodGhpcy5sYXN0IDw8IDgpO1xuICAgICAgYnl0ZXMucHVzaChmbGFnID4+PiA4KTtcbiAgICAgIGJ5dGVzLnB1c2goZmxhZyAmIDB4ZmYpO1xuICAgIH1cbiAgICByZXR1cm4gYnl0ZXM7XG4gIH1cblxuICB3cml0ZShkYXRhOiBEYXRhPG51bWJlcj4sIGZsYWdzOiBudW1iZXJbXSwgb2Zmc2V0OiBudW1iZXIgPSAwKSB7XG4gICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzKGZsYWdzKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ5dGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBkYXRhW2kgKyBvZmZzZXRdID0gYnl0ZXNbaV07XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBESUFMT0dfRkxBR1MgPSBuZXcgRmxhZ0xpc3RUeXBlKDB4NDAsIDB4ODApO1xuZXhwb3J0IGNvbnN0IElURU1fR0VUX0ZMQUdTID0gbmV3IEZsYWdMaXN0VHlwZSgweDQwLCAweDgwLCB0cnVlKTtcbmV4cG9ydCBjb25zdCBJVEVNX1VTRV9GTEFHUyA9IG5ldyBGbGFnTGlzdFR5cGUoMHg0MCwgMHg4MCwgdHJ1ZSk7XG5leHBvcnQgY29uc3QgSVRFTV9DT05ESVRJT05fRkxBR1MgPSBuZXcgRmxhZ0xpc3RUeXBlKDB4ODAsIDB4MjAsIHRydWUpO1xuZXhwb3J0IGNvbnN0IFNQQVdOX0NPTkRJVElPTl9GTEFHUyA9IG5ldyBGbGFnTGlzdFR5cGUoMHg4MCwgMHgyMCk7XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuZGVjbGFyZSBjb25zdCBpbml0aWFsVGFnOiB1bmlxdWUgc3ltYm9sO1xuZXhwb3J0IGludGVyZmFjZSBJbml0aWFsIHsgW2luaXRpYWxUYWddOiBuZXZlcjsgfVxuZXhwb3J0IHR5cGUgSW5pdGlhbFByb3BzPFQsXG4gICAgWCA9IHtbUCBpbiBrZXlvZiBUXTogVFtQXSBleHRlbmRzIEluaXRpYWwgPyBQIDogbmV2ZXJ9PiA9IFhba2V5b2YgWF07XG5cbi8vIEltcGwgLSBxdWVzdGlvbiAtIGNhbiB3ZSBkbyBzb21ldGhpbmcgc2ltaWxhciBmb3IgRGF0YVR1cGxlPz8/XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0aWFsaXplcjxQIGV4dGVuZHMgcmVhZG9ubHkgYW55W10sIFQ+KCk6IEluaXRpYWxpemVyPFAsIFQ+IHtcbiAgY29uc3QgdGFnID0gU3ltYm9sKCk7XG4gIGZ1bmN0aW9uIGYoLi4uYXJnczogUCk6IFQgJiBJbml0aWFsIHtcbiAgICByZXR1cm4ge3RhZywgYXJnc30gYXMgYW55OyAvLyBOT1RFOiB0aGlzIGlzIGEgY29tcGxldGUgbGllIGZvciBub3cuXG4gIH1cbiAgZi5jb21taXQgPSAoaW5zdGFuY2U6IGFueSwgYnVpbGRlcjogKHByb3A6IHN0cmluZywgLi4uYXJnczogUCkgPT4gVCkgPT4ge1xuICAgIGZvciAoY29uc3QgcHJvcCBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhpbnN0YW5jZSkpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gaW5zdGFuY2VbcHJvcF07XG4gICAgICBpZiAodmFsdWUudGFnICE9PSB0YWcpIGNvbnRpbnVlO1xuICAgICAgaW5zdGFuY2VbcHJvcF0gPSBidWlsZGVyKHByb3AsIC4uLnZhbHVlLmFyZ3MpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGY7XG59XG5leHBvcnQgaW50ZXJmYWNlIEluaXRpYWxpemVyPFAgZXh0ZW5kcyByZWFkb25seSBhbnlbXSwgVD4ge1xuICAoLi4uYXJnczogUCk6IFQ7XG4gIGNvbW1pdChpbnN0YW5jZTogYW55LCBidWlsZGVyOiAocHJvcDogc3RyaW5nLCAuLi5hcmdzOiBQKSA9PiBUKTogdm9pZDtcbn1cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5leHBvcnQgY2xhc3MgRGF0YVR1cGxlIHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgZGF0YTogRGF0YTxudW1iZXI+KSB7fVxuICBbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYXRvcjxudW1iZXI+IHtcbiAgICByZXR1cm4gKHRoaXMuZGF0YSBhcyBudW1iZXJbXSlbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICB9XG4gIGhleCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuZGF0YSwgaGV4KS5qb2luKCcgJyk7XG4gIH1cbiAgY2xvbmUoKTogdGhpcyB7XG4gICAgcmV0dXJuIG5ldyAodGhpcy5jb25zdHJ1Y3RvciBhcyBhbnkpKHRoaXMuZGF0YSk7XG4gIH1cbiAgc3RhdGljIG1ha2U8VD4obGVuZ3RoOiBudW1iZXIsIHByb3BzOiBUKTogRGF0YVR1cGxlQ3RvcjxUPiB7XG4gICAgLy8gTk9URTogVGhlcmUncyBhIGxvdCBvZiBkeW5hbWlzbSBoZXJlLCBzbyB0eXBlIGNoZWNraW5nIGNhbid0IGhhbmRsZSBpdC5cbiAgICAvLyBUT0RPOiBHaXZlIHRoaXMgY2xhc3MgYSBuYW1lIHNvbWVob3c/XG4gICAgY29uc3QgY2xzID0gY2xhc3MgZXh0ZW5kcyBEYXRhVHVwbGUge1xuICAgICAgY29uc3RydWN0b3IoZGF0YSA9IG5ldyBBcnJheShsZW5ndGgpLmZpbGwoMCkpIHsgc3VwZXIoZGF0YSk7IH1cbiAgICAgIHN0YXRpYyBvZihpbml0czogYW55KSB7XG4gICAgICAgIGNvbnN0IG91dCA9IG5ldyBjbHMoKSBhcyBhbnk7XG4gICAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGluaXRzKSkge1xuICAgICAgICAgIG91dFtrZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICAgIH1cbiAgICAgIHN0YXRpYyBmcm9tKGRhdGE6IERhdGE8bnVtYmVyPiwgb2Zmc2V0OiBudW1iZXIgPSAwKSB7XG4gICAgICAgIHJldHVybiBuZXcgY2xzKHR1cGxlKGRhdGEsIG9mZnNldCwgbGVuZ3RoKSBhcyBudW1iZXJbXSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBkZXNjcmlwdG9yczogYW55ID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gcHJvcHMpIHtcbiAgICAgIGlmICh0eXBlb2YgcHJvcHNba2V5XSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBkZXNjcmlwdG9yc1trZXldID0ge3ZhbHVlOiBwcm9wc1trZXldfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlc2NyaXB0b3JzW2tleV0gPSBwcm9wc1trZXldO1xuICAgICAgfVxuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhjbHMucHJvdG90eXBlLCBkZXNjcmlwdG9ycyk7XG4gICAgcmV0dXJuIGNscyBhcyBhbnk7XG4gIH1cbiAgc3RhdGljIHByb3AoLi4uYml0czogW251bWJlciwgbnVtYmVyPywgbnVtYmVyP11bXSk6XG4gICAgICAoR2V0U2V0PG51bWJlcj4gJiBUaGlzVHlwZTxEYXRhVHVwbGU+KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGdldCgpIHtcbiAgICAgICAgbGV0IHZhbHVlID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBbaW5kZXgsIG1hc2sgPSAweGZmLCBzaGlmdCA9IDBdIG9mIGJpdHMpIHtcbiAgICAgICAgICBjb25zdCBsc2ggPSBzaGlmdCA8IDAgPyAtc2hpZnQgOiAwO1xuICAgICAgICAgIGNvbnN0IHJzaCA9IHNoaWZ0IDwgMCA/IDAgOiBzaGlmdDtcbiAgICAgICAgICB2YWx1ZSB8PSAoKHRoaXMuZGF0YVtpbmRleF0gJiBtYXNrKSA+Pj4gcnNoKSA8PCBsc2g7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfSxcbiAgICAgIHNldCh2YWx1ZSkge1xuICAgICAgICBmb3IgKGNvbnN0IFtpbmRleCwgbWFzayA9IDB4ZmYsIHNoaWZ0ID0gMF0gb2YgYml0cykge1xuICAgICAgICAgIGNvbnN0IGxzaCA9IHNoaWZ0IDwgMCA/IC1zaGlmdCA6IDA7XG4gICAgICAgICAgY29uc3QgcnNoID0gc2hpZnQgPCAwID8gMCA6IHNoaWZ0O1xuICAgICAgICAgIGNvbnN0IHYgPSAodmFsdWUgPj4+IGxzaCkgPDwgcnNoICYgbWFzaztcbiAgICAgICAgICB0aGlzLmRhdGFbaW5kZXhdID0gdGhpcy5kYXRhW2luZGV4XSAmIH5tYXNrIHwgdjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9O1xuICB9XG4gIHN0YXRpYyBib29sZWFuUHJvcChiaXQ6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyXSk6XG4gICAgICAoR2V0U2V0PGJvb2xlYW4+ICYgVGhpc1R5cGU8RGF0YVR1cGxlPikge1xuICAgIGNvbnN0IHByb3AgPSBEYXRhVHVwbGUucHJvcChiaXQpO1xuICAgIHJldHVybiB7Z2V0KCkgeyByZXR1cm4gISFwcm9wLmdldC5jYWxsKHRoaXMpOyB9LFxuICAgICAgICAgICAgc2V0KHZhbHVlKSB7IHByb3Auc2V0LmNhbGwodGhpcywgK3ZhbHVlKTsgfX07XG4gIH1cbiAgLy8gc3RhdGljIGZ1bmM8VD4oZnVuYzogKHg6IGFueSkgPT4gVCk6ICh7dmFsdWU6IGFueX0gJiBUaGlzVHlwZTxEYXRhVHVwbGU+KSB7XG4gIC8vICAgcmV0dXJuIHt2YWx1ZTogZnVuY3Rpb24oKSB7IHJldHVybiBmdW5jKHRoaXMpOyB9fTtcbiAgLy8gfVxufVxuXG5pbnRlcmZhY2UgR2V0U2V0PFU+IHtcbiAgZ2V0KCk6IFU7XG4gIHNldChhcmc6IFUpOiB2b2lkO1xufVxuXG50eXBlIERhdGFUdXBsZVN1YjxUPiA9XG4gICAge1tLIGluIGtleW9mIFRdOiBUW0tdIGV4dGVuZHMgR2V0U2V0PGluZmVyIFU+ID8gVSA6XG4gICAgICAgICAgICAgICAgICAgICBUW0tdIGV4dGVuZHMge3ZhbHVlOiAoaW5mZXIgVyl9ID8gVyA6XG4gICAgICAgICAgICAgICAgICAgICBUW0tdIGV4dGVuZHMgKC4uLmFyZ3M6IGFueVtdKSA9PiB2b2lkID8gVFtLXSA6IG5ldmVyfSAmIERhdGFUdXBsZTtcblxuLy8gTm90ZTogaXQgd291bGQgYmUgbmljZSBmb3IgdGhlIGZpbmFsIFRbS10gYmVsb3cgdG8gYmUgJ25ldmVyJywgYnV0XG4vLyB0aGlzIGZhaWxzIGJlY2F1c2UgYWxsIG9iamVjdHMgaGF2ZSBhbiBpbXBsaWNpdCB0b1N0cmluZywgd2hpY2ggd291bGRcbi8vIG90aGVyd2lzZSBuZWVkIHRvIGJlIHt0b1N0cmluZz86IHVuZGVmaW5lZH0gZm9yIHNvbWUgcmVhc29uLlxudHlwZSBEYXRhVHVwbGVJbml0czxUPiA9IHtcbiAgW0sgaW4ga2V5b2YgVF0/OiBUW0tdIGV4dGVuZHMge3NldChhcmc6IGluZmVyIFUpOiB2b2lkfSA/IFUgOiBUW0tdXG59O1xuXG5pbnRlcmZhY2UgRGF0YVR1cGxlQ3RvcjxUPiB7XG4gIG5ldyhkYXRhPzogRGF0YTxudW1iZXI+KTogRGF0YVR1cGxlU3ViPFQ+O1xuICBvZihpbml0czogRGF0YVR1cGxlSW5pdHM8VD4pOiBEYXRhVHVwbGVTdWI8VD47XG4gIGZyb20oZGF0YTogRGF0YTxudW1iZXI+LCBvZmZzZXQ/OiBudW1iZXIpOiBEYXRhVHVwbGVTdWI8VD47XG59XG5cblxuZXhwb3J0IGNvbnN0IHdhdGNoQXJyYXkgPSAoYXJyOiBEYXRhPHVua25vd24+LCB3YXRjaDogbnVtYmVyKSA9PiB7XG4gIGNvbnN0IGFycmF5Q2hhbmdlSGFuZGxlciA9IHtcbiAgICBnZXQodGFyZ2V0OiBhbnksIHByb3BlcnR5OiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdnZXR0aW5nICcgKyBwcm9wZXJ0eSArICcgZm9yICcgKyB0YXJnZXQpO1xuICAgICAgLy8gcHJvcGVydHkgaXMgaW5kZXggaW4gdGhpcyBjYXNlXG4gICAgICBsZXQgdiA9IHRhcmdldFtwcm9wZXJ0eV07XG4gICAgICBpZiAocHJvcGVydHkgPT09ICdzdWJhcnJheScpIHtcbiAgICAgICAgcmV0dXJuIChzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcikgPT4ge1xuICAgICAgICAgIGNvbnN0IHN1YiA9IHRhcmdldC5zdWJhcnJheShzdGFydCwgZW5kKTtcbiAgICAgICAgICBpZiAoc3RhcnQgPD0gd2F0Y2ggJiYgd2F0Y2ggPCBlbmQpIHJldHVybiB3YXRjaEFycmF5KHN1Yiwgd2F0Y2ggLSBzdGFydCk7XG4gICAgICAgICAgcmV0dXJuIHN1YjtcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSBpZiAocHJvcGVydHkgPT09ICdzZXQnKSB7XG4gICAgICAgIHJldHVybiAodmFsOiBEYXRhPHVua25vd24+KSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFNldHRpbmcgb3ZlcmxhcHBpbmcgYXJyYXkgJHt3YXRjaH1gKTtcbiAgICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoJycpO1xuICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgIHRhcmdldC5zZXQodmFsKTtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgdiA9PT0gJ2Z1bmN0aW9uJykgdiA9IHYuYmluZCh0YXJnZXQpO1xuICAgICAgcmV0dXJuIHY7XG4gICAgfSxcbiAgICBzZXQodGFyZ2V0OiBhbnksIHByb3BlcnR5OiBzdHJpbmcgfCBudW1iZXIsIHZhbHVlOiBhbnksIHJlY2VpdmVyOiBhbnkpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCdzZXR0aW5nICcgKyBwcm9wZXJ0eSArICcgZm9yICcvKiArIHRhcmdldCovICsgJyB3aXRoIHZhbHVlICcgKyB2YWx1ZSk7XG4gICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dHJpcGxlLWVxdWFsc1xuICAgICAgaWYgKHByb3BlcnR5ID09IHdhdGNoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBXcml0aW5nICR7d2F0Y2gudG9TdHJpbmcoMTYpfWApO1xuICAgICAgICAvLyB0aHJvdyBuZXcgRXJyb3IoJycpO1xuICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgIH1cbiAgICAgIHRhcmdldFtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICAgIC8vIHlvdSBoYXZlIHRvIHJldHVybiB0cnVlIHRvIGFjY2VwdCB0aGUgY2hhbmdlc1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgfTtcbiAgcmV0dXJuIG5ldyBQcm94eShhcnIsIGFycmF5Q2hhbmdlSGFuZGxlcik7XG59O1xuXG5leHBvcnQgdHlwZSBXcml0YWJsZTxUPiA9IHstcmVhZG9ubHkgW0sgaW4ga2V5b2YgVF06IFRbS119O1xuIl19