import { Entity } from './entity.js';
import { MessageId } from './messageid.js';
import { DIALOG_FLAGS, SPAWN_CONDITION_FLAGS, addr, hex, readBigEndian, readLittleEndian, tuple, writeLittleEndian } from './util.js';
export class Npc extends Entity {
    constructor(rom, id) {
        super(rom, id);
        this.spawnConditions = new Map();
        this.localDialogs = new Map();
        this.used = !UNUSED_NPCS.has(id) && (id < 0x8f || id >= 0xc0);
        const hasDialog = id <= 0xc3;
        this.dataBase = 0x80f0 | ((id & 0xfc) << 6) | ((id & 3) << 2);
        this.data = tuple(rom.prg, this.dataBase, 4);
        this.spawnPointer = 0x1c5e0 + (id << 1);
        this.spawnBase = readLittleEndian(rom.prg, this.spawnPointer) + 0x14000;
        let i = this.spawnBase;
        let loc;
        while (this.used && (loc = rom.prg[i++]) !== 0xff) {
            const flags = SPAWN_CONDITION_FLAGS.read(rom.prg, i);
            i += 2 * flags.length;
            this.spawnConditions.set(loc, flags);
        }
        this.dialogPointer = 0x1c95d + (id << 1);
        this.dialogBase = hasDialog ? addr(rom.prg, this.dialogPointer, 0x14000) : 0;
        this.globalDialogs = [];
        if (hasDialog) {
            let a = this.dialogBase;
            while (true) {
                const [dialog, last] = GlobalDialog.parse(rom.prg, a);
                a += 4;
                if (dialog.condition)
                    this.globalDialogs.push(dialog);
                if (last)
                    break;
            }
            const locations = [];
            while (true) {
                const location = rom.prg[a++];
                if (location === 0xff)
                    break;
                locations.push([location, rom.prg[a++]]);
            }
            if (!locations.length)
                locations.push([-1, 0]);
            const base = a;
            for (const [location, offset] of locations) {
                const dialogs = [];
                this.localDialogs.set(location, dialogs);
                a = base + offset;
                while (true) {
                    const [dialog, last] = LocalDialog.parse(rom.prg, a);
                    a += dialog.byteLength();
                    dialogs.push(dialog);
                    if (last)
                        break;
                }
            }
        }
        for (const i in NAMES) {
            if (!NAMES.hasOwnProperty(i))
                continue;
            const name = NAMES[i];
            if (name[0] === id) {
                this.name = name[1];
                if (name.length > 2) {
                    this.itemNames = name.slice(2, 4);
                }
            }
        }
    }
    spawnConditionsBytes() {
        const bytes = [];
        for (const [loc, flags] of this.spawnConditions) {
            bytes.push(loc, ...SPAWN_CONDITION_FLAGS.bytes(flags));
        }
        bytes.push(0xff);
        return bytes;
    }
    hasDialog() {
        return Boolean(this.globalDialogs.length || this.localDialogs.size);
    }
    *allDialogs() {
        yield* this.globalDialogs;
        for (const ds of this.localDialogs.values()) {
            yield* ds;
        }
    }
    dialogBytes() {
        if (!this.hasDialog())
            return [];
        const bytes = [];
        function serialize(ds) {
            const out = [];
            for (let i = 0; i < ds.length; i++) {
                out.push(...ds[i].bytes(i === ds.length - 1));
            }
            return out;
        }
        if (this.globalDialogs.length) {
            bytes.push(...serialize(this.globalDialogs));
        }
        else {
            bytes.push(0x80, 0, 0, 0);
        }
        const locals = [];
        const cache = new Map();
        for (const [location, dialogs] of this.localDialogs) {
            const localBytes = serialize(dialogs);
            const label = localBytes.join(',');
            const cached = cache.get(label);
            if (cached != null) {
                bytes.push(location, cached);
                continue;
            }
            cache.set(label, locals.length);
            if (location !== -1)
                bytes.push(location, locals.length);
            locals.push(...localBytes);
        }
        if (locals.length)
            bytes.push(0xff, ...locals);
        return bytes;
    }
    link(id) {
        const other = this.rom.npcs[id];
        this.spawnConditions = other.spawnConditions;
        this.linkDialog(id);
    }
    linkDialog(id) {
        const other = this.rom.npcs[id];
        this.globalDialogs = other.globalDialogs;
        this.localDialogs = other.localDialogs;
    }
    localDialog(location, index) {
        if (index == null) {
            index = location;
            location = -1;
        }
        const dialogs = this.localDialogs.get(location);
        if (dialogs == null || index >= dialogs.length) {
            throw new Error(`No local dialog ${index} for location ${hex(location)}`);
        }
        return dialogs[index];
    }
    async write(writer) {
        if (!this.used)
            return;
        const promises = [];
        writer.rom.subarray(this.dataBase, this.dataBase + 4).set(this.data);
        promises.push(writer.write(this.spawnConditionsBytes(), 0x1c000, 0x1dfff, `SpawnCondition ${hex(this.id)}`).then(address => writeLittleEndian(writer.rom, this.spawnPointer, address - 0x14000)));
        if (this.hasDialog()) {
            promises.push(writer.write(this.dialogBytes(), 0x1c000, 0x1dfff, `Dialog ${hex(this.id)}`).then(address => writeLittleEndian(writer.rom, this.dialogPointer, address - 0x14000)));
        }
        await Promise.all(promises);
    }
}
export class GlobalDialog {
    constructor(condition, message) {
        this.condition = condition;
        this.message = message;
    }
    static of(condition, message) {
        const [part, index, action = 0] = message;
        return new GlobalDialog(condition, MessageId.of({ part, index, action }));
    }
    static parse(data, offset = 0) {
        const flag = readBigEndian(data, offset);
        const message = MessageId.from(data, offset + 2);
        let condition = flag & 0x03ff;
        const last = !!(flag & 0x8000);
        const sign = flag & 0x2000;
        if (sign)
            condition = ~condition;
        return [new GlobalDialog(condition, message), last];
    }
    bytes(last) {
        let flag = this.condition;
        if (flag < 0)
            flag = (~flag) | 0x2000;
        if (last)
            flag |= 0x8000;
        return [flag >>> 8, flag & 0xff, ...this.message.data];
    }
}
export class LocalDialog {
    constructor(condition, message, update, flags) {
        this.condition = condition;
        this.message = message;
        this.update = update;
        this.flags = flags;
    }
    clone() {
        return LocalDialog.parse(this.bytes(false))[0];
    }
    static parse(data, offset = 0) {
        const word = readBigEndian(data, offset);
        const message = MessageId.from(data, offset + 2);
        const update = data[offset + 4];
        offset += 5;
        let condition = word & 0x03ff;
        const last = !!(word & 0x8000);
        const sign = word & 0x2000;
        if (sign)
            condition = ~condition;
        const flags = word & 0x4000 ? DIALOG_FLAGS.read(data, offset) : [];
        return [new LocalDialog(condition, message, update, flags), last];
    }
    static of(condition, message, flags = []) {
        const [part, index, action = 0] = message;
        return new LocalDialog(condition, MessageId.of({ part, index, action }), 0, flags);
    }
    byteLength() {
        return 5 + 2 * this.flags.length;
    }
    bytes(last) {
        let flag = this.condition;
        if (flag < 0)
            flag = (~flag) | 0x2000;
        if (last)
            flag |= 0x8000;
        if (this.flags.length)
            flag |= 0x4000;
        return [flag >>> 8, flag & 0xff, ...this.message.data, this.update,
            ...DIALOG_FLAGS.bytes(this.flags)];
    }
}
const UNUSED_NPCS = new Set([
    0x31, 0x3c, 0x6a, 0x73, 0x82, 0x86, 0x87, 0x89, 0x8a, 0x8b, 0x8c, 0x8d,
]);
export const NAMES = {
    leafElder: [0x0d, 'Leaf elder'],
    leafRabbit: [0x13, 'Leaf rabbit'],
    windmillGuard: [0x14, 'Windmill guard', 'in cave', 'in house'],
    windmillGuardSleeping: [0x15, 'Sleeping windmill guard'],
    akahanaShyron: [0x16, 'Akahana in Shyron'],
    oakElder: [0x1d, 'Oak elder'],
    oakMother: [0x1e, 'Oak mother'],
    dwarfChild: [0x1f, 'Dwarf child'],
    aryllis: [0x23, 'Aryllis'],
    portoaQueen: [0x38, 'Portoa queen'],
    fortuneTeller: [0x39, 'Fortune teller'],
    clark: [0x44, 'Clark'],
    brokahana: [0x54, 'Akahana\'s friend'],
    deo: [0x5a, 'Deo'],
    zebu: [0x5e, 'Zebu', 'in cave', 'in Shyron'],
    tornel: [0x5f, 'Tornel'],
    stom: [0x60, 'Stom'],
    mesiaShrine: [0x61, 'Mesia in Shrine'],
    asina: [0x62, 'Asina', 'in back room', ''],
    hurtDolphin: [0x63, 'Hurt dolphin'],
    fisherman: [0x64, 'Fisherman'],
    kensuCabin: [0x68, 'Kensu in cabin'],
    kensuSleeping: [0x6b, 'Sleeping kensu'],
    kensuSwan: [0x74, 'Kensu in Swan'],
    kensuSlime: [0x75, 'Slimed Kensu'],
    kensuLighthouse: [0x7e, 'Kensu in lighthouse'],
    akahanaBrynmaer: [0x82, 'Akahana in Brynmaer'],
    azteca: [0x83, 'Azteca'],
    fakeMesia: [0x84, 'Fake Mesia'],
    akahanaStoned: [0x88, 'Stoned Akahana'],
    mesia: [0x8e, 'Mesia'],
    rage: [0xc3, 'Rage'],
};
export class PortoaQueen extends Npc {
    constructor() {
        super(...arguments);
        this.id = 0x38;
        this.name = 'Portoa Queen';
    }
    get expectedSword() { return this.localDialog(3).condition & 0xff; }
    set expectedSword(id) { this.localDialog(3).condition = 0x200 | id; }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnBjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3JvbS9ucGMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLGFBQWEsQ0FBQztBQUNuQyxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDekMsT0FBTyxFQUFDLFlBQVksRUFBUSxxQkFBcUIsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUNwRCxhQUFhLEVBQUUsZ0JBQWdCLEVBQUUsS0FBSyxFQUN0QyxpQkFBaUIsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQU01QyxNQUFNLE9BQU8sR0FBSSxTQUFRLE1BQU07SUFrQjdCLFlBQVksR0FBUSxFQUFFLEVBQVU7UUFDOUIsS0FBSyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQVJqQixvQkFBZSxHQUFHLElBQUksR0FBRyxFQUFvQixDQUFDO1FBSzlDLGlCQUFZLEdBQUcsSUFBSSxHQUFHLEVBQXlCLENBQUM7UUFJOUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQWdDLENBQUMsRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLElBQUksSUFBSSxDQUFDLENBQUM7UUFDMUYsTUFBTSxTQUFTLEdBQUcsRUFBRSxJQUFJLElBQUksQ0FBQztRQUU3QixJQUFJLENBQUMsUUFBUSxHQUFHLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDOUQsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRTdDLElBQUksQ0FBQyxZQUFZLEdBQUcsT0FB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Q0FBQztJQUN4QixTQUFTLEVBQUUsQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDO0lBQy9CLGFBQWEsRUFBRSxDQUFDLElBQUksRUFBRSxnQkFBZ0IsQ0FBQztJQUN2QyxLQUFLLEVBQUUsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDO0lBQ3RCLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUM7Q0FDckIsQ0FBQztBQUVGLE1BQU0sT0FBTyxXQUFZLFNBQVEsR0FBRztJQUFwQzs7UUFFVyxPQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ1YsU0FBSSxHQUFHLGNBQWMsQ0FBQztJQUdqQyxDQUFDO0lBRkMsSUFBSSxhQUFhLEtBQWEsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzVFLElBQUksYUFBYSxDQUFDLEVBQVUsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxLQUFLLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztDQUM5RSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RW50aXR5fSBmcm9tICcuL2VudGl0eS5qcyc7XG5pbXBvcnQge01lc3NhZ2VJZH0gZnJvbSAnLi9tZXNzYWdlaWQuanMnO1xuaW1wb3J0IHtESUFMT0dfRkxBR1MsIERhdGEsIFNQQVdOX0NPTkRJVElPTl9GTEFHUywgYWRkciwgaGV4LFxuICAgICAgICByZWFkQmlnRW5kaWFuLCByZWFkTGl0dGxlRW5kaWFuLCB0dXBsZSxcbiAgICAgICAgd3JpdGVMaXR0bGVFbmRpYW59IGZyb20gJy4vdXRpbC5qcyc7XG5pbXBvcnQge1dyaXRlcn0gZnJvbSAnLi93cml0ZXIuanMnO1xuaW1wb3J0IHtSb219IGZyb20gJy4uL3JvbS5qcyc7XG5cbnR5cGUgRmxhZ0xpc3QgPSBudW1iZXJbXTtcblxuZXhwb3J0IGNsYXNzIE5wYyBleHRlbmRzIEVudGl0eSB7XG5cbiAgdXNlZDogYm9vbGVhbjtcbiAgbmFtZT86IHN0cmluZztcbiAgaXRlbU5hbWVzPzogW3N0cmluZywgc3RyaW5nXTtcblxuICBkYXRhQmFzZTogbnVtYmVyO1xuICBkYXRhOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXTsgLy8gdWludDhcbiAgc3Bhd25Qb2ludGVyOiBudW1iZXI7XG4gIHNwYXduQmFzZTogbnVtYmVyO1xuICAvLyBGbGFncyB0byBjaGVjayBwZXIgbG9jYXRpb246IHBvc2l0aXZlIG1lYW5zIFwibXVzdCBiZSBzZXRcIlxuICBzcGF3bkNvbmRpdGlvbnMgPSBuZXcgTWFwPG51bWJlciwgRmxhZ0xpc3Q+KCk7IC8vIGtleSB1aW50OFxuXG4gIGRpYWxvZ1BvaW50ZXI6IG51bWJlcjtcbiAgZGlhbG9nQmFzZTogbnVtYmVyO1xuICBnbG9iYWxEaWFsb2dzOiBHbG9iYWxEaWFsb2dbXTtcbiAgbG9jYWxEaWFsb2dzID0gbmV3IE1hcDxudW1iZXIsIExvY2FsRGlhbG9nW10+KCk7XG5cbiAgY29uc3RydWN0b3Iocm9tOiBSb20sIGlkOiBudW1iZXIpIHtcbiAgICBzdXBlcihyb20sIGlkKTtcbiAgICB0aGlzLnVzZWQgPSAhVU5VU0VEX05QQ1MuaGFzKGlkKSAvKiYmIHRoaXMuYmFzZSA8PSAweDFjNzgxKi8gJiYgKGlkIDwgMHg4ZiB8fCBpZCA+PSAweGMwKTtcbiAgICBjb25zdCBoYXNEaWFsb2cgPSBpZCA8PSAweGMzO1xuXG4gICAgdGhpcy5kYXRhQmFzZSA9IDB4ODBmMCB8ICgoaWQgJiAweGZjKSA8PCA2KSB8ICgoaWQgJiAzKSA8PCAyKTtcbiAgICB0aGlzLmRhdGEgPSB0dXBsZShyb20ucHJnLCB0aGlzLmRhdGFCYXNlLCA0KTtcblxuICAgIHRoaXMuc3Bhd25Qb2ludGVyID0gMHgxYzVlMCArIChpZCA8PCAxKTtcbiAgICAvLyBjb25zb2xlLmxvZyhgTlBDIFNwYXduICQke3RoaXMuaWQudG9TdHJpbmcoMTYpfTogJHtyb20ucHJnW3RoaXMucG9pbnRlcl0udG9TdHJpbmcoMTYpfSAke1xuICAgIC8vICAgICAgICAgICAgICByb20ucHJnW3RoaXMucG9pbnRlciArIDFdLnRvU3RyaW5nKDE2KX1gKTtcbiAgICB0aGlzLnNwYXduQmFzZSA9IHJlYWRMaXR0bGVFbmRpYW4ocm9tLnByZywgdGhpcy5zcGF3blBvaW50ZXIpICsgMHgxNDAwMDtcblxuICAgIC8vIFBvcHVsYXRlIHNwYXduIGNvbmRpdGlvbnNcbiAgICBsZXQgaSA9IHRoaXMuc3Bhd25CYXNlO1xuICAgIGxldCBsb2M7XG4gICAgd2hpbGUgKHRoaXMudXNlZCAmJiAobG9jID0gcm9tLnByZ1tpKytdKSAhPT0gMHhmZikge1xuICAgICAgY29uc3QgZmxhZ3MgPSBTUEFXTl9DT05ESVRJT05fRkxBR1MucmVhZChyb20ucHJnLCBpKTtcbiAgICAgIGkgKz0gMiAqIGZsYWdzLmxlbmd0aDtcbiAgICAgIHRoaXMuc3Bhd25Db25kaXRpb25zLnNldChsb2MsIGZsYWdzKTtcbiAgICB9XG5cbiAgICAvLyBQb3B1bGF0ZSB0aGUgZGlhbG9nIHRhYmxlXG4gICAgdGhpcy5kaWFsb2dQb2ludGVyID0gMHgxYzk1ZCArIChpZCA8PCAxKTtcbiAgICB0aGlzLmRpYWxvZ0Jhc2UgPSBoYXNEaWFsb2cgPyBhZGRyKHJvbS5wcmcsIHRoaXMuZGlhbG9nUG9pbnRlciwgMHgxNDAwMCkgOiAwO1xuICAgIHRoaXMuZ2xvYmFsRGlhbG9ncyA9IFtdO1xuICAgIGlmIChoYXNEaWFsb2cpIHtcbiAgICAgIGxldCBhID0gdGhpcy5kaWFsb2dCYXNlO1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgY29uc3QgW2RpYWxvZywgbGFzdF0gPSBHbG9iYWxEaWFsb2cucGFyc2Uocm9tLnByZywgYSk7XG4gICAgICAgIGEgKz0gNDtcbiAgICAgICAgaWYgKGRpYWxvZy5jb25kaXRpb24pIHRoaXMuZ2xvYmFsRGlhbG9ncy5wdXNoKGRpYWxvZyk7XG4gICAgICAgIGlmIChsYXN0KSBicmVhaztcbiAgICAgIH1cbiAgICAgIC8vIFJlYWQgdGhlIGxvY2F0aW9uIHRhYmxlXG4gICAgICBjb25zdCBsb2NhdGlvbnM6IFtudW1iZXIsIG51bWJlcl1bXSA9IFtdO1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgY29uc3QgbG9jYXRpb24gPSByb20ucHJnW2ErK107XG4gICAgICAgIGlmIChsb2NhdGlvbiA9PT0gMHhmZikgYnJlYWs7XG4gICAgICAgIGxvY2F0aW9ucy5wdXNoKFtsb2NhdGlvbiwgcm9tLnByZ1thKytdXSk7XG4gICAgICB9XG4gICAgICBpZiAoIWxvY2F0aW9ucy5sZW5ndGgpIGxvY2F0aW9ucy5wdXNoKFstMSwgMF0pO1xuICAgICAgLy8gTm93IGJ1aWxkIHVwIHRoZSBMb2NhbERpYWxvZyB0YWJsZXNcbiAgICAgIGNvbnN0IGJhc2UgPSBhO1xuICAgICAgZm9yIChjb25zdCBbbG9jYXRpb24sIG9mZnNldF0gb2YgbG9jYXRpb25zKSB7XG4gICAgICAgIGNvbnN0IGRpYWxvZ3M6IExvY2FsRGlhbG9nW10gPSBbXTtcbiAgICAgICAgdGhpcy5sb2NhbERpYWxvZ3Muc2V0KGxvY2F0aW9uLCBkaWFsb2dzKTtcbiAgICAgICAgYSA9IGJhc2UgKyBvZmZzZXQ7XG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgY29uc3QgW2RpYWxvZywgbGFzdF0gPSBMb2NhbERpYWxvZy5wYXJzZShyb20ucHJnLCBhKTtcbiAgICAgICAgICBhICs9IGRpYWxvZy5ieXRlTGVuZ3RoKCk7XG4gICAgICAgICAgZGlhbG9ncy5wdXNoKGRpYWxvZyk7XG4gICAgICAgICAgaWYgKGxhc3QpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBpIGluIE5BTUVTKSB7XG4gICAgICBpZiAoIU5BTUVTLmhhc093blByb3BlcnR5KGkpKSBjb250aW51ZTtcbiAgICAgIGNvbnN0IG5hbWUgPSAoTkFNRVMgYXMge30gYXMge1trZXk6IHN0cmluZ106IFtudW1iZXIsIHN0cmluZywgc3RyaW5nPywgc3RyaW5nP119KVtpXTtcbiAgICAgIGlmIChuYW1lWzBdID09PSBpZCkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lWzFdO1xuICAgICAgICBpZiAobmFtZS5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgdGhpcy5pdGVtTmFtZXMgPSBuYW1lLnNsaWNlKDIsIDQpIGFzIFtzdHJpbmcsIHN0cmluZ107XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjb25zb2xlLmxvZyhgTlBDIFNwYXduICQke3RoaXMuaWQudG9TdHJpbmcoMTYpfSBmcm9tICR7dGhpcy5iYXNlLnRvU3RyaW5nKDE2KX06IGJ5dGVzOiAkJHtcbiAgICAvLyAgICAgICAgICAgICAgdGhpcy5ieXRlcygpLm1hcCh4PT54LnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLDApKS5qb2luKCcgJyl9YCk7XG4gIH1cblxuICBzcGF3bkNvbmRpdGlvbnNCeXRlcygpOiBudW1iZXJbXSB7XG4gICAgY29uc3QgYnl0ZXMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IFtsb2MsIGZsYWdzXSBvZiB0aGlzLnNwYXduQ29uZGl0aW9ucykge1xuICAgICAgYnl0ZXMucHVzaChsb2MsIC4uLlNQQVdOX0NPTkRJVElPTl9GTEFHUy5ieXRlcyhmbGFncykpO1xuICAgIH1cbiAgICBieXRlcy5wdXNoKDB4ZmYpO1xuICAgIHJldHVybiBieXRlcztcbiAgfVxuXG4gIGhhc0RpYWxvZygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gQm9vbGVhbih0aGlzLmdsb2JhbERpYWxvZ3MubGVuZ3RoIHx8IHRoaXMubG9jYWxEaWFsb2dzLnNpemUpO1xuICB9XG5cbiAgKiBhbGxEaWFsb2dzKCk6IEl0ZXJhYmxlPExvY2FsRGlhbG9nIHwgR2xvYmFsRGlhbG9nPiB7XG4gICAgeWllbGQgKiB0aGlzLmdsb2JhbERpYWxvZ3M7XG4gICAgZm9yIChjb25zdCBkcyBvZiB0aGlzLmxvY2FsRGlhbG9ncy52YWx1ZXMoKSkge1xuICAgICAgeWllbGQgKiBkcztcbiAgICB9XG4gIH1cblxuICBkaWFsb2dCeXRlcygpOiBudW1iZXJbXSB7XG4gICAgaWYgKCF0aGlzLmhhc0RpYWxvZygpKSByZXR1cm4gW107XG4gICAgY29uc3QgYnl0ZXM6IG51bWJlcltdID0gW107XG4gICAgZnVuY3Rpb24gc2VyaWFsaXplKGRzOiBHbG9iYWxEaWFsb2dbXSB8IExvY2FsRGlhbG9nW10pOiBudW1iZXJbXSB7XG4gICAgICBjb25zdCBvdXQ6IG51bWJlcltdID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG91dC5wdXNoKC4uLmRzW2ldLmJ5dGVzKGkgPT09IGRzLmxlbmd0aCAtIDEpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuICAgIGlmICh0aGlzLmdsb2JhbERpYWxvZ3MubGVuZ3RoKSB7XG4gICAgICBieXRlcy5wdXNoKC4uLnNlcmlhbGl6ZSh0aGlzLmdsb2JhbERpYWxvZ3MpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnl0ZXMucHVzaCgweDgwLCAwLCAwLCAwKTsgLy8gXCJlbXB0eVwiXG4gICAgfVxuICAgIGNvbnN0IGxvY2FsczogbnVtYmVyW10gPSBbXTtcbiAgICBjb25zdCBjYWNoZSA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7IC8vIGFsbG93IHJldXNpbmcgbG9jYXRpb25zXG4gICAgZm9yIChjb25zdCBbbG9jYXRpb24sIGRpYWxvZ3NdIG9mIHRoaXMubG9jYWxEaWFsb2dzKSB7XG4gICAgICBjb25zdCBsb2NhbEJ5dGVzID0gc2VyaWFsaXplKGRpYWxvZ3MpO1xuICAgICAgY29uc3QgbGFiZWwgPSBsb2NhbEJ5dGVzLmpvaW4oJywnKTtcbiAgICAgIGNvbnN0IGNhY2hlZCA9IGNhY2hlLmdldChsYWJlbCk7XG4gICAgICBpZiAoY2FjaGVkICE9IG51bGwpIHtcbiAgICAgICAgYnl0ZXMucHVzaChsb2NhdGlvbiwgY2FjaGVkKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coYFNBVkVEICR7bG9jYWxCeXRlcy5sZW5ndGh9IGJ5dGVzYCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY2FjaGUuc2V0KGxhYmVsLCBsb2NhbHMubGVuZ3RoKTtcbiAgICAgIGlmIChsb2NhdGlvbiAhPT0gLTEpIGJ5dGVzLnB1c2gobG9jYXRpb24sIGxvY2Fscy5sZW5ndGgpO1xuICAgICAgbG9jYWxzLnB1c2goLi4ubG9jYWxCeXRlcyk7XG4gICAgfVxuICAgIGlmIChsb2NhbHMubGVuZ3RoKSBieXRlcy5wdXNoKDB4ZmYsIC4uLmxvY2Fscyk7XG5cbiAgICAvLyBjb25zb2xlLmxvZyhgTlBDICR7dGhpcy5pZC50b1N0cmluZygxNil9OiBieXRlcyBsZW5ndGggJHtieXRlcy5sZW5ndGh9YCk7XG5cbiAgICByZXR1cm4gYnl0ZXM7XG4gIH1cblxuICAvLyBNYWtlcyBhIFwiaGFyZGxpbmtcIiBiZXR3ZWVuIHR3byBOUENzLCBmb3Igc3Bhd24gY29uZGl0aW9ucyBhbmQgZGlhbG9nLlxuICBsaW5rKGlkOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCBvdGhlciA9IHRoaXMucm9tLm5wY3NbaWRdO1xuICAgIHRoaXMuc3Bhd25Db25kaXRpb25zID0gb3RoZXIuc3Bhd25Db25kaXRpb25zO1xuICAgIHRoaXMubGlua0RpYWxvZyhpZCk7XG4gIH1cblxuICBsaW5rRGlhbG9nKGlkOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCBvdGhlciA9IHRoaXMucm9tLm5wY3NbaWRdO1xuICAgIHRoaXMuZ2xvYmFsRGlhbG9ncyA9IG90aGVyLmdsb2JhbERpYWxvZ3M7XG4gICAgdGhpcy5sb2NhbERpYWxvZ3MgPSBvdGhlci5sb2NhbERpYWxvZ3M7XG4gIH1cblxuICBsb2NhbERpYWxvZyhpbmRleDogbnVtYmVyKTogTG9jYWxEaWFsb2c7XG4gIGxvY2FsRGlhbG9nKGxvY2F0aW9uOiBudW1iZXIsIGluZGV4PzogbnVtYmVyKTogTG9jYWxEaWFsb2cge1xuICAgIGlmIChpbmRleCA9PSBudWxsKSB7XG4gICAgICBpbmRleCA9IGxvY2F0aW9uO1xuICAgICAgbG9jYXRpb24gPSAtMTtcbiAgICB9XG4gICAgY29uc3QgZGlhbG9ncyA9IHRoaXMubG9jYWxEaWFsb2dzLmdldChsb2NhdGlvbik7XG4gICAgaWYgKGRpYWxvZ3MgPT0gbnVsbCB8fCBpbmRleCA+PSBkaWFsb2dzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBsb2NhbCBkaWFsb2cgJHtpbmRleH0gZm9yIGxvY2F0aW9uICR7aGV4KGxvY2F0aW9uKX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIGRpYWxvZ3NbaW5kZXhdO1xuICB9XG5cbiAgYXN5bmMgd3JpdGUod3JpdGVyOiBXcml0ZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMudXNlZCkgcmV0dXJuO1xuICAgIGNvbnN0IHByb21pc2VzID0gW107XG4gICAgd3JpdGVyLnJvbS5zdWJhcnJheSh0aGlzLmRhdGFCYXNlLCB0aGlzLmRhdGFCYXNlICsgNCkuc2V0KHRoaXMuZGF0YSk7XG4gICAgcHJvbWlzZXMucHVzaCh3cml0ZXIud3JpdGUodGhpcy5zcGF3bkNvbmRpdGlvbnNCeXRlcygpLCAweDFjMDAwLCAweDFkZmZmLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBTcGF3bkNvbmRpdGlvbiAke2hleCh0aGlzLmlkKX1gKS50aGVuKFxuICAgICAgICBhZGRyZXNzID0+IHdyaXRlTGl0dGxlRW5kaWFuKHdyaXRlci5yb20sIHRoaXMuc3Bhd25Qb2ludGVyLCBhZGRyZXNzIC0gMHgxNDAwMCkpKTtcblxuICAgIGlmICh0aGlzLmhhc0RpYWxvZygpKSB7XG4gICAgICBwcm9taXNlcy5wdXNoKHdyaXRlci53cml0ZSh0aGlzLmRpYWxvZ0J5dGVzKCksIDB4MWMwMDAsIDB4MWRmZmYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgRGlhbG9nICR7aGV4KHRoaXMuaWQpfWApLnRoZW4oXG4gICAgICAgICAgYWRkcmVzcyA9PiB3cml0ZUxpdHRsZUVuZGlhbih3cml0ZXIucm9tLCB0aGlzLmRpYWxvZ1BvaW50ZXIsIGFkZHJlc3MgLSAweDE0MDAwKSkpO1xuICAgIH1cbiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEdsb2JhbERpYWxvZyB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBjb25kaXRpb246IG51bWJlciwgcHVibGljIG1lc3NhZ2U6IE1lc3NhZ2VJZCkge31cblxuICBzdGF0aWMgb2YoY29uZGl0aW9uOiBudW1iZXIsXG4gICAgICAgICAgICBtZXNzYWdlOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcj9dKTogR2xvYmFsRGlhbG9nIHtcbiAgICBjb25zdCBbcGFydCwgaW5kZXgsIGFjdGlvbiA9IDBdID0gbWVzc2FnZTtcbiAgICByZXR1cm4gbmV3IEdsb2JhbERpYWxvZyhjb25kaXRpb24sIE1lc3NhZ2VJZC5vZih7cGFydCwgaW5kZXgsIGFjdGlvbn0pKTtcbiAgfVxuXG4gIC8vIFJldHVybnMgW2RpYWxvZywgbGFzdF0uXG4gIHN0YXRpYyBwYXJzZShkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyID0gMCk6IFtHbG9iYWxEaWFsb2csIGJvb2xlYW5dIHtcbiAgICBjb25zdCBmbGFnID0gcmVhZEJpZ0VuZGlhbihkYXRhLCBvZmZzZXQpO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBNZXNzYWdlSWQuZnJvbShkYXRhLCBvZmZzZXQgKyAyKTtcblxuICAgIGxldCBjb25kaXRpb24gPSBmbGFnICYgMHgwM2ZmO1xuICAgIGNvbnN0IGxhc3QgPSAhIShmbGFnICYgMHg4MDAwKTtcbiAgICBjb25zdCBzaWduID0gZmxhZyAmIDB4MjAwMDtcbiAgICBpZiAoc2lnbikgY29uZGl0aW9uID0gfmNvbmRpdGlvbjtcblxuICAgIHJldHVybiBbbmV3IEdsb2JhbERpYWxvZyhjb25kaXRpb24sIG1lc3NhZ2UpLCBsYXN0XTtcbiAgfVxuXG4gIGJ5dGVzKGxhc3Q6IGJvb2xlYW4pOiBudW1iZXJbXSB7XG4gICAgbGV0IGZsYWcgPSB0aGlzLmNvbmRpdGlvbjtcbiAgICBpZiAoZmxhZyA8IDApIGZsYWcgPSAofmZsYWcpIHwgMHgyMDAwO1xuICAgIGlmIChsYXN0KSBmbGFnIHw9IDB4ODAwMDtcbiAgICByZXR1cm4gW2ZsYWcgPj4+IDgsIGZsYWcgJiAweGZmLCAuLi50aGlzLm1lc3NhZ2UuZGF0YV07XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIExvY2FsRGlhbG9nIHtcbiAgY29uc3RydWN0b3IocHVibGljIGNvbmRpdGlvbjogbnVtYmVyLFxuICAgICAgICAgICAgICBwdWJsaWMgbWVzc2FnZTogTWVzc2FnZUlkLFxuICAgICAgICAgICAgICBwdWJsaWMgdXBkYXRlOiBudW1iZXIsXG4gICAgICAgICAgICAgIHB1YmxpYyBmbGFnczogRmxhZ0xpc3QpIHt9XG5cbiAgY2xvbmUoKTogTG9jYWxEaWFsb2cge1xuICAgIHJldHVybiBMb2NhbERpYWxvZy5wYXJzZSh0aGlzLmJ5dGVzKGZhbHNlKSlbMF07XG4gIH1cblxuICAvLyBSZXR1cm5zIFtkaWFsb2csIGxhc3RdXG4gIHN0YXRpYyBwYXJzZShkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyID0gMCk6IFtMb2NhbERpYWxvZywgYm9vbGVhbl0ge1xuICAgIGNvbnN0IHdvcmQgPSByZWFkQmlnRW5kaWFuKGRhdGEsIG9mZnNldCk7XG4gICAgY29uc3QgbWVzc2FnZSA9IE1lc3NhZ2VJZC5mcm9tKGRhdGEsIG9mZnNldCArIDIpO1xuICAgIGNvbnN0IHVwZGF0ZSA9IGRhdGFbb2Zmc2V0ICsgNF07XG4gICAgb2Zmc2V0ICs9IDU7XG5cbiAgICBsZXQgY29uZGl0aW9uID0gd29yZCAmIDB4MDNmZjtcbiAgICBjb25zdCBsYXN0ID0gISEod29yZCAmIDB4ODAwMCk7XG4gICAgY29uc3Qgc2lnbiA9IHdvcmQgJiAweDIwMDA7XG4gICAgaWYgKHNpZ24pIGNvbmRpdGlvbiA9IH5jb25kaXRpb247XG4gICAgY29uc3QgZmxhZ3MgPSB3b3JkICYgMHg0MDAwID8gRElBTE9HX0ZMQUdTLnJlYWQoZGF0YSwgb2Zmc2V0KSA6IFtdO1xuICAgIHJldHVybiBbbmV3IExvY2FsRGlhbG9nKGNvbmRpdGlvbiwgbWVzc2FnZSwgdXBkYXRlLCBmbGFncyksIGxhc3RdO1xuICB9XG5cbiAgc3RhdGljIG9mKGNvbmRpdGlvbjogbnVtYmVyLFxuICAgICAgICAgICAgbWVzc2FnZTogW251bWJlciwgbnVtYmVyLCBudW1iZXI/XSxcbiAgICAgICAgICAgIGZsYWdzOiBGbGFnTGlzdCA9IFtdKTogTG9jYWxEaWFsb2cge1xuICAgIGNvbnN0IFtwYXJ0LCBpbmRleCwgYWN0aW9uID0gMF0gPSBtZXNzYWdlO1xuICAgIHJldHVybiBuZXcgTG9jYWxEaWFsb2coY29uZGl0aW9uLCBNZXNzYWdlSWQub2Yoe3BhcnQsIGluZGV4LCBhY3Rpb259KSwgMCwgZmxhZ3MpO1xuICB9XG5cbiAgYnl0ZUxlbmd0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiA1ICsgMiAqIHRoaXMuZmxhZ3MubGVuZ3RoO1xuICB9XG5cbiAgYnl0ZXMobGFzdDogYm9vbGVhbik6IG51bWJlcltdIHtcbiAgICBsZXQgZmxhZyA9IHRoaXMuY29uZGl0aW9uO1xuICAgIGlmIChmbGFnIDwgMCkgZmxhZyA9ICh+ZmxhZykgfCAweDIwMDA7XG4gICAgaWYgKGxhc3QpIGZsYWcgfD0gMHg4MDAwO1xuICAgIGlmICh0aGlzLmZsYWdzLmxlbmd0aCkgZmxhZyB8PSAweDQwMDA7XG4gICAgcmV0dXJuIFtmbGFnID4+PiA4LCBmbGFnICYgMHhmZiwgLi4udGhpcy5tZXNzYWdlLmRhdGEsIHRoaXMudXBkYXRlLFxuICAgICAgICAgICAgLi4uRElBTE9HX0ZMQUdTLmJ5dGVzKHRoaXMuZmxhZ3MpXTtcbiAgfVxufVxuXG5jb25zdCBVTlVTRURfTlBDUyA9IG5ldyBTZXQoW1xuICAweDMxLCAweDNjLCAweDZhLCAweDczLCAweDgyLCAweDg2LCAweDg3LCAweDg5LCAweDhhLCAweDhiLCAweDhjLCAweDhkLFxuICAvLyBhbHNvIGV2ZXJ5dGhpbmcgZnJvbSA4Zi4uYzAsIGJ1dCB0aGF0J3MgaW1wbGljaXQuXG5dKTtcblxuZXhwb3J0IGNvbnN0IE5BTUVTID0ge1xuICBsZWFmRWxkZXI6IFsweDBkLCAnTGVhZiBlbGRlciddLFxuICBsZWFmUmFiYml0OiBbMHgxMywgJ0xlYWYgcmFiYml0J10sXG4gIHdpbmRtaWxsR3VhcmQ6IFsweDE0LCAnV2luZG1pbGwgZ3VhcmQnLCAnaW4gY2F2ZScsICdpbiBob3VzZSddLFxuICB3aW5kbWlsbEd1YXJkU2xlZXBpbmc6IFsweDE1LCAnU2xlZXBpbmcgd2luZG1pbGwgZ3VhcmQnXSxcbiAgYWthaGFuYVNoeXJvbjogWzB4MTYsICdBa2FoYW5hIGluIFNoeXJvbiddLCAvLyBhbHNvIGluIGNhdmVcbiAgb2FrRWxkZXI6IFsweDFkLCAnT2FrIGVsZGVyJ10sXG4gIG9ha01vdGhlcjogWzB4MWUsICdPYWsgbW90aGVyJ10sXG4gIGR3YXJmQ2hpbGQ6IFsweDFmLCAnRHdhcmYgY2hpbGQnXSxcbiAgYXJ5bGxpczogWzB4MjMsICdBcnlsbGlzJ10sXG4gIHBvcnRvYVF1ZWVuOiBbMHgzOCwgJ1BvcnRvYSBxdWVlbiddLFxuICBmb3J0dW5lVGVsbGVyOiBbMHgzOSwgJ0ZvcnR1bmUgdGVsbGVyJ10sXG4gIGNsYXJrOiBbMHg0NCwgJ0NsYXJrJ10sXG4gIGJyb2thaGFuYTogWzB4NTQsICdBa2FoYW5hXFwncyBmcmllbmQnXSxcbiAgZGVvOiBbMHg1YSwgJ0RlbyddLFxuICB6ZWJ1OiBbMHg1ZSwgJ1plYnUnLCAnaW4gY2F2ZScsICdpbiBTaHlyb24nXSxcbiAgdG9ybmVsOiBbMHg1ZiwgJ1Rvcm5lbCddLFxuICBzdG9tOiBbMHg2MCwgJ1N0b20nXSxcbiAgbWVzaWFTaHJpbmU6IFsweDYxLCAnTWVzaWEgaW4gU2hyaW5lJ10sXG4gIGFzaW5hOiBbMHg2MiwgJ0FzaW5hJywgJ2luIGJhY2sgcm9vbScsICcnXSxcbiAgaHVydERvbHBoaW46IFsweDYzLCAnSHVydCBkb2xwaGluJ10sXG4gIGZpc2hlcm1hbjogWzB4NjQsICdGaXNoZXJtYW4nXSxcbiAga2Vuc3VDYWJpbjogWzB4NjgsICdLZW5zdSBpbiBjYWJpbiddLFxuICBrZW5zdVNsZWVwaW5nOiBbMHg2YiwgJ1NsZWVwaW5nIGtlbnN1J10sXG4gIGtlbnN1U3dhbjogWzB4NzQsICdLZW5zdSBpbiBTd2FuJ10sXG4gIGtlbnN1U2xpbWU6IFsweDc1LCAnU2xpbWVkIEtlbnN1J10sXG4gIGtlbnN1TGlnaHRob3VzZTogWzB4N2UsICdLZW5zdSBpbiBsaWdodGhvdXNlJ10sXG4gIGFrYWhhbmFCcnlubWFlcjogWzB4ODIsICdBa2FoYW5hIGluIEJyeW5tYWVyJ10sIC8vIE5vdGU6IG9yaWdpbmFsbHkgJDE2XG4gIGF6dGVjYTogWzB4ODMsICdBenRlY2EnXSxcbiAgZmFrZU1lc2lhOiBbMHg4NCwgJ0Zha2UgTWVzaWEnXSxcbiAgYWthaGFuYVN0b25lZDogWzB4ODgsICdTdG9uZWQgQWthaGFuYSddLFxuICBtZXNpYTogWzB4OGUsICdNZXNpYSddLFxuICByYWdlOiBbMHhjMywgJ1JhZ2UnXSxcbn07XG5cbmV4cG9ydCBjbGFzcyBQb3J0b2FRdWVlbiBleHRlbmRzIE5wYyB7XG4gIC8vIFRPRE8gLSBleHRlbmQgTmFtZWROcGM/IGFjdHVhbGx5IGFkZCBpdCB0byB0aGUgY2xhc3MuXG4gIHJlYWRvbmx5IGlkID0gMHgzODtcbiAgcmVhZG9ubHkgbmFtZSA9ICdQb3J0b2EgUXVlZW4nO1xuICBnZXQgZXhwZWN0ZWRTd29yZCgpOiBudW1iZXIgeyByZXR1cm4gdGhpcy5sb2NhbERpYWxvZygzKS5jb25kaXRpb24gJiAweGZmOyB9XG4gIHNldCBleHBlY3RlZFN3b3JkKGlkOiBudW1iZXIpIHsgdGhpcy5sb2NhbERpYWxvZygzKS5jb25kaXRpb24gPSAweDIwMCB8IGlkOyB9XG59XG4iXX0=