import { Entity, EntityArray } from './entity.js';
import { MessageId } from './messageid.js';
import { DIALOG_FLAGS, SPAWN_CONDITION_FLAGS, Address, Segment, hex, readBigEndian, tuple, upperCamelToSpaces } from './util.js';
const { $04, $05, $0e } = Segment;
export class Npcs extends EntityArray {
    constructor(rom) {
        super(0xcd);
        this.rom = rom;
        this.GoaSoldier = new Npc(this, 0x0b);
        this.LeafElder = new Npc(this, 0x0d);
        this.LeafElderDaughter = new Npc(this, 0x11);
        this.LeafRabbit = new Npc(this, 0x13);
        this.WindmillGuard = new Npc(this, 0x14);
        this.SleepingWindmillGuard = new Npc(this, 0x15);
        this.Akahana = new Npc(this, 0x16);
        this.OakElder = new Npc(this, 0x1d);
        this.OakMother = new Npc(this, 0x1e);
        this.OakChild = new Npc(this, 0x1f);
        this.Aryllis = new Npc(this, 0x23);
        this.AmazonesGuard = new Npc(this, 0x25);
        this.AryllisRightAttendant = new Npc(this, 0x26);
        this.AryllisLeftAttendant = new Npc(this, 0x27);
        this.Nadare = new Npc(this, 0x28);
        this.SoldierGuard = new Npc(this, 0x2d);
        this.PortoaThroneRoomBackDoorGuard = new Npc(this, 0x33);
        this.PortoaPalaceFrontGuard = new Npc(this, 0x34);
        this.PortoaQueen = new Npc(this, 0x38);
        this.FortuneTeller = new Npc(this, 0x39);
        this.WaterfallCaveAdventurers = new Npc(this, 0x3a);
        this.JoelElder = new Npc(this, 0x3d);
        this.Clark = new Npc(this, 0x44);
        this.ShyronGuard = new Npc(this, 0x4e);
        this.Brokahana = new Npc(this, 0x54);
        this.SaharaBunny = new Npc(this, 0x59);
        this.Deo = new Npc(this, 0x5a);
        this.SaharaElder = new Npc(this, 0x5b);
        this.SaharaElderDaughter = new Npc(this, 0x5c);
        this.Zebu = new Npc(this, 0x5e);
        this.Tornel = new Npc(this, 0x5f);
        this.Stom = new Npc(this, 0x60);
        this.MesiaRecording = new Npc(this, 0x61);
        this.Asina = new Npc(this, 0x62);
        this.HurtDolphin = new Npc(this, 0x63);
        this.Fisherman = new Npc(this, 0x64);
        this.KensuInCabin = new Npc(this, 0x68);
        this.Dolphin = new Npc(this, 0x69);
        this.SleepingKensu = new Npc(this, 0x6b);
        this.KensuDisguisedAsDancer = new Npc(this, 0x6c);
        this.KensuDisguisedAsSoldier = new Npc(this, 0x6d);
        this.AztecaInShyron = new Npc(this, 0x6e);
        this.DeadAkahana = new Npc(this, 0x70);
        this.DeadStomsGirlfriend = new Npc(this, 0x71);
        this.DeadStom = new Npc(this, 0x72);
        this.KensuInSwan = new Npc(this, 0x74);
        this.SlimedKensu = new Npc(this, 0x75);
        this.FishermanDaughter = new Npc(this, 0x7b);
        this.Kensu = new Npc(this, 0x7e);
        this.AkahanaInBrynmaer = new Npc(this, 0x82);
        this.AztecaInPyramid = new Npc(this, 0x83);
        this.SaberaDisguisedAsMesia = new Npc(this, 0x84);
        this.StonedWaterfallCaveAdventurers = new Npc(this, 0x85);
        this.StonedAkahana = new Npc(this, 0x88);
        this.Mesia = new Npc(this, 0x8e);
        this.Vampire1 = new Npc(this, 0xc0);
        this.Insect = new Npc(this, 0xc1);
        this.Kelbesque1 = new Npc(this, 0xc2);
        this.Rage = new Npc(this, 0xc3);
        this.Kelbesque2 = new Npc(this, 0xc5);
        this.Sabera2 = new Npc(this, 0xc6);
        this.Mado2 = new Npc(this, 0xc7);
        this.Karmine = new Npc(this, 0xc8);
        this.StatueOfMoon = new Npc(this, 0xc9);
        this.StatueOfSun = new Npc(this, 0xca);
        this.Draygon = new Npc(this, 0xcb);
        this.Vampire2 = new Npc(this, 0xcc);
        for (const key in this) {
            const npc = this[key];
            if (!this.hasOwnProperty(key) || !(npc instanceof Npc))
                continue;
            this[npc.id] = npc;
            npc.name = upperCamelToSpaces(key);
        }
        for (let i = 0; i < 0xcd; i++) {
            if (!this[i]) {
                this[i] = new Npc(this, i);
            }
        }
    }
}
export class Npc extends Entity {
    constructor(npcs, id) {
        super(npcs.rom, id);
        this.npcs = npcs;
        this.spawnConditions = new Map();
        this.localDialogs = new Map();
        const rom = npcs.rom;
        if (id > 0xcc)
            throw new Error(`Unavailable: ${id}`);
        this._used = !UNUSED_NPCS.has(id) && (id < 0x8f || id >= 0xc0);
        let dialogBase = id < 0xc4 ? this.dialogPointer.readAddress(rom.prg) : null;
        if (dialogBase && dialogBase.org === 0x8b39)
            dialogBase = null;
        this.data = tuple(rom.prg, this.dataBase.offset, 4);
        const spawnBase = this.spawnPointer.readAddress(rom.prg);
        let i = spawnBase.offset;
        let loc;
        while (this.used && (loc = rom.prg[i++]) !== 0xff) {
            const flags = SPAWN_CONDITION_FLAGS.read(rom.prg, i);
            i += 2 * flags.length;
            this.spawnConditions.set(loc, flags);
        }
        this.globalDialogs = [];
        if (dialogBase) {
            let a = dialogBase.offset;
            while (true) {
                const [dialog, last] = GlobalDialog.parse(rom.prg, a);
                a += 4;
                if (dialog.condition)
                    this.globalDialogs.push(dialog);
                if (last)
                    break;
            }
            const locations = [];
            while (true) {
                const location = rom.prg[a++];
                if (location === 0xff)
                    break;
                locations.push([location, rom.prg[a++]]);
            }
            if (!locations.length)
                locations.push([-1, 0]);
            const base = a;
            for (const [location, offset] of locations) {
                const dialogs = [];
                this.localDialogs.set(location, dialogs);
                a = base + offset;
                while (true) {
                    const [dialog, last] = LocalDialog.parse(rom.prg, a);
                    a += dialog.byteLength();
                    dialogs.push(dialog);
                    if (last)
                        break;
                }
            }
        }
    }
    get dataBase() {
        const seg = this.id & 0x80 ? $05 : $04;
        const org = 0x80f0 | ((this.id & 0xfc) << 6) | ((this.id & 3) << 2);
        return Address.of(seg, org);
    }
    get spawnPointer() {
        return Address.of($0e, 0x85e0 + (this.id << 1));
    }
    get dialogPointer() {
        return Address.of($0e, 0x895d + (this.id << 1));
    }
    get used() { return this._used; }
    set used(used) {
        if (used && (this.id > 0x88 && this.id < 0xc0 && this.id !== 0x8e)) {
            throw new Error(`invalid: ${this.id}`);
        }
        this._used = used;
    }
    spawnConditionsBytes() {
        const bytes = [];
        for (const [loc, flags] of this.spawnConditions) {
            bytes.push(loc, ...SPAWN_CONDITION_FLAGS.bytes(flags));
        }
        bytes.push(0xff);
        return bytes;
    }
    dialog(location) {
        const id = location ? location.id : -1;
        const dialogs = this.localDialogs.get(id);
        if (dialogs)
            return dialogs;
        throw new Error(`No local dialog for NPC ${hex(this.id)} at ${hex(id)}`);
    }
    spawns(location) {
        const id = location.id;
        const conditions = this.spawnConditions.get(location.id);
        if (conditions)
            return conditions;
        throw new Error(`No spawn condition for NPC ${hex(this.id)} at ${hex(id)}`);
    }
    hasDialog() {
        const result = Boolean(this.globalDialogs.length || this.localDialogs.size);
        if (this.id > 0x8e && this.id !== 0xc3 && result) {
            throw new Error(`invalid: ${this.id}`);
        }
        return result;
    }
    *allDialogs() {
        yield* this.globalDialogs;
        for (const ds of this.localDialogs.values()) {
            yield* ds;
        }
    }
    dialogBytes() {
        if (!this.hasDialog())
            return [];
        const bytes = [];
        function serialize(ds) {
            const out = [];
            for (let i = 0; i < ds.length; i++) {
                out.push(...ds[i].bytes(i === ds.length - 1));
            }
            return out;
        }
        if (this.globalDialogs.length) {
            bytes.push(...serialize(this.globalDialogs));
        }
        else {
            bytes.push(0x80, 0, 0, 0);
        }
        const locals = [];
        const cache = new Map();
        for (const [location, dialogs] of this.localDialogs) {
            const localBytes = serialize(dialogs);
            const label = localBytes.join(',');
            const cached = cache.get(label);
            if (cached != null) {
                bytes.push(location, cached);
                continue;
            }
            cache.set(label, locals.length);
            if (location !== -1)
                bytes.push(location, locals.length);
            locals.push(...localBytes);
        }
        if (locals.length)
            bytes.push(0xff, ...locals);
        return bytes;
    }
    link(id) {
        const other = this.rom.npcs[id];
        this.spawnConditions = other.spawnConditions;
        this.linkDialog(id);
    }
    linkDialog(id) {
        const other = this.rom.npcs[id];
        this.globalDialogs = other.globalDialogs;
        this.localDialogs = other.localDialogs;
    }
    localDialog(location, index) {
        if (index == null) {
            index = location;
            location = -1;
        }
        const dialogs = this.localDialogs.get(location);
        if (dialogs == null || index >= dialogs.length) {
            throw new Error(`No local dialog ${index} for location ${hex(location)}`);
        }
        return dialogs[index];
    }
    isParalyzable() {
        for (let i = 0x35058; i < 0x3506c; i++) {
            if (this.rom.prg[i] === this.id)
                return false;
        }
        return true;
    }
    write() {
        if (!this.used)
            return [];
        const id = hex(this.id);
        const a = this.rom.assembler();
        this.dataBase.loc(a);
        a.byte(...this.data);
        a.segment('0e', 'fe', 'ff');
        a.reloc(`SpawnCondition_${id}`);
        const spawn = a.pc();
        a.byte(...this.spawnConditionsBytes());
        this.spawnPointer.loc(a, `SpawnCondition_${id}_Pointer`);
        a.word(spawn);
        if (this.hasDialog()) {
            a.segment('0e', 'fe', 'ff');
            a.reloc(`Dialog_${id}`);
            const dialog = a.pc();
            a.byte(...this.dialogBytes());
            this.dialogPointer.loc(a, `Dialog_${id}_Pointer`);
            a.word(dialog);
        }
        return [a.module()];
    }
}
export class GlobalDialog {
    constructor(condition, message) {
        this.condition = condition;
        this.message = message;
    }
    static of(condition, message) {
        const [part, index, action = 0] = message;
        return new GlobalDialog(condition, MessageId.of({ part, index, action }));
    }
    static parse(data, offset = 0) {
        const flag = readBigEndian(data, offset);
        const message = MessageId.from(data, offset + 2);
        let condition = flag & 0x03ff;
        const last = !!(flag & 0x8000);
        const sign = flag & 0x2000;
        if (sign)
            condition = ~condition;
        return [new GlobalDialog(condition, message), last];
    }
    bytes(last) {
        let flag = this.condition;
        if (flag < 0)
            flag = (~flag) | 0x2000;
        if (last)
            flag |= 0x8000;
        return [flag >>> 8, flag & 0xff, ...this.message.data];
    }
}
export class LocalDialog {
    constructor(condition, message, update, flags) {
        this.condition = condition;
        this.message = message;
        this.update = update;
        this.flags = flags;
    }
    clone() {
        return LocalDialog.parse(this.bytes(false))[0];
    }
    static parse(data, offset = 0) {
        const word = readBigEndian(data, offset);
        const message = MessageId.from(data, offset + 2);
        const update = data[offset + 4];
        offset += 5;
        let condition = word & 0x03ff;
        const last = !!(word & 0x8000);
        const sign = word & 0x2000;
        if (sign)
            condition = ~condition;
        const flags = word & 0x4000 ? DIALOG_FLAGS.read(data, offset) : [];
        return [new LocalDialog(condition, message, update, flags), last];
    }
    static of(condition, message, flags = []) {
        const [part, index, action = 0] = message;
        return new LocalDialog(condition, MessageId.of({ part, index, action }), 0, flags);
    }
    byteLength() {
        return 5 + 2 * this.flags.length;
    }
    bytes(last) {
        let flag = this.condition;
        if (flag < 0)
            flag = (~flag) | 0x2000;
        if (last)
            flag |= 0x8000;
        if (this.flags.length)
            flag |= 0x4000;
        return [flag >>> 8, flag & 0xff, ...this.message.data, this.update,
            ...DIALOG_FLAGS.bytes(this.flags)];
    }
}
const UNUSED_NPCS = new Set([
    0x31, 0x3b, 0x3c, 0x66, 0x67, 0x6a, 0x73, 0x74,
    0x82, 0x86, 0x87, 0x89, 0x8a, 0x8b, 0x8c, 0x8d,
    0xc4,
]);
export class PortoaQueen extends Npc {
    constructor() {
        super(...arguments);
        this.id = 0x38;
        this.name = 'Portoa Queen';
    }
    get expectedSword() { return this.localDialog(3).condition & 0xff; }
    set expectedSword(id) { this.localDialog(3).condition = 0x200 | id; }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibnBjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3JvbS9ucGMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFDLE1BQU0sRUFBRSxXQUFXLEVBQUMsTUFBTSxhQUFhLENBQUM7QUFFaEQsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ3pDLE9BQU8sRUFBQyxZQUFZLEVBQUUscUJBQXFCLEVBQ25DLE9BQU8sRUFBUSxPQUFPLEVBQ3RCLEdBQUcsRUFBRSxhQUFhLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFDLE1BQU0sV0FBVyxDQUFDO0FBR3hFLE1BQU0sRUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBQyxHQUFHLE9BQU8sQ0FBQztBQUloQyxNQUFNLE9BQU8sSUFBSyxTQUFRLFdBQWdCO0lBcUd4QyxZQUFxQixHQUFRO1FBQzNCLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQURPLFFBQUcsR0FBSCxHQUFHLENBQUs7UUFuRzdCLGVBQVUsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFakMsY0FBUyxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUVoQyxzQkFBaUIsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFeEMsZUFBVSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNqQyxrQkFBYSxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNwQywwQkFBcUIsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDNUMsWUFBTyxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUU5QixhQUFRLEdBQUcs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SUFBSSxHQUFHLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNO1lBQzFELEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUM3QyxDQUFDO0NBQ0Y7QUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLEdBQUcsQ0FBQztJQUMxQixJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtJQUM5QyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtJQUM5QyxJQUFJO0NBRUwsQ0FBQyxDQUFDO0FBRUgsTUFBTSxPQUFPLFdBQVksU0FBUSxHQUFHO0lBQXBDOztRQUVXLE9BQUUsR0FBRyxJQUFJLENBQUM7UUFDVixTQUFJLEdBQUcsY0FBYyxDQUFDO0lBR2pDLENBQUM7SUFGQyxJQUFJLGFBQWEsS0FBYSxPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDNUUsSUFBSSxhQUFhLENBQUMsRUFBVSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxHQUFHLEtBQUssR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0NBQzlFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtNb2R1bGV9IGZyb20gJy4uL2FzbS9tb2R1bGUuanMnO1xuaW1wb3J0IHtFbnRpdHksIEVudGl0eUFycmF5fSBmcm9tICcuL2VudGl0eS5qcyc7XG5pbXBvcnQge0xvY2F0aW9ufSBmcm9tICcuL2xvY2F0aW9uLmpzJztcbmltcG9ydCB7TWVzc2FnZUlkfSBmcm9tICcuL21lc3NhZ2VpZC5qcyc7XG5pbXBvcnQge0RJQUxPR19GTEFHUywgU1BBV05fQ09ORElUSU9OX0ZMQUdTLFxuICAgICAgICBBZGRyZXNzLCBEYXRhLCBTZWdtZW50LFxuICAgICAgICBoZXgsIHJlYWRCaWdFbmRpYW4sIHR1cGxlLCB1cHBlckNhbWVsVG9TcGFjZXN9IGZyb20gJy4vdXRpbC5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcblxuY29uc3QgeyQwNCwgJDA1LCAkMGV9ID0gU2VnbWVudDtcblxudHlwZSBGbGFnTGlzdCA9IG51bWJlcltdO1xuXG5leHBvcnQgY2xhc3MgTnBjcyBleHRlbmRzIEVudGl0eUFycmF5PE5wYz4ge1xuICAvLyBnZW5lcmljIDAwLi4wYVxuICBHb2FTb2xkaWVyID0gbmV3IE5wYyh0aGlzLCAweDBiKTtcbiAgLy8gZ2VuZXJpYyAwY1xuICBMZWFmRWxkZXIgPSBuZXcgTnBjKHRoaXMsIDB4MGQpO1xuICAvLyBnZW5lcmljIGxlYWYgMGUuLjEwXG4gIExlYWZFbGRlckRhdWdodGVyID0gbmV3IE5wYyh0aGlzLCAweDExKTtcbiAgLy8gZ2VuZXJpYyBsZWFmIDEyXG4gIExlYWZSYWJiaXQgPSBuZXcgTnBjKHRoaXMsIDB4MTMpO1xuICBXaW5kbWlsbEd1YXJkID0gbmV3IE5wYyh0aGlzLCAweDE0KTtcbiAgU2xlZXBpbmdXaW5kbWlsbEd1YXJkID0gbmV3IE5wYyh0aGlzLCAweDE1KTtcbiAgQWthaGFuYSA9IG5ldyBOcGModGhpcywgMHgxNik7XG4gIC8vIGdlbmVyaWMgYnJ5bm1hZXIgMTcuLjFjXG4gIE9ha0VsZGVyID0gbmV3IE5wYyh0aGlzLCAweDFkKTtcbiAgT2FrTW90aGVyID0gbmV3IE5wYyh0aGlzLCAweDFlKTtcbiAgT2FrQ2hpbGQgPSBuZXcgTnBjKHRoaXMsIDB4MWYpO1xuICAvLyBnZW5lcmljIG9hayAyMC4uMjJcbiAgQXJ5bGxpcyA9IG5ldyBOcGModGhpcywgMHgyMyk7XG4gIC8vIGdlbmVyaWMgYW1hem9uZXMgMjRcbiAgQW1hem9uZXNHdWFyZCA9IG5ldyBOcGModGhpcywgMHgyNSk7XG4gIEFyeWxsaXNSaWdodEF0dGVuZGFudCA9IG5ldyBOcGModGhpcywgMHgyNik7XG4gIEFyeWxsaXNMZWZ0QXR0ZW5kYW50ID0gbmV3IE5wYyh0aGlzLCAweDI3KTtcbiAgTmFkYXJlID0gbmV3IE5wYyh0aGlzLCAweDI4KTtcbiAgLy8gZ2VuZXJpYyBuYWRhcmUgMjkuLjJjXG4gIFNvbGRpZXJHdWFyZCA9IG5ldyBOcGModGhpcywgMHgyZCk7IC8vIHN3YW4sIG10IHNhYnJlXG4gIC8vIHNob3BrZWVwZXIgcHJpc29uZXJzIDJlLi4zMFxuICAvLyB1bnVzZWQgMzFcbiAgLy8gZ2VuZXJpYyBwb3J0b2EgcGFsYWNlIDMyXG4gIFBvcnRvYVRocm9uZVJvb21CYWNrRG9vckd1YXJkID0gbmV3IE5wYyh0aGlzLCAweDMzKTtcbiAgUG9ydG9hUGFsYWNlRnJvbnRHdWFyZCA9IG5ldyBOcGModGhpcywgMHgzNCk7XG4gIC8vIGdlbmVyaWMgcG9ydG9hIHBhbGFjZSAzNS4uMzdcbiAgUG9ydG9hUXVlZW4gPSBuZXcgTnBjKHRoaXMsIDB4MzgpO1xuICBGb3J0dW5lVGVsbGVyID0gbmV3IE5wYyh0aGlzLCAweDM5KTtcbiAgV2F0ZXJmYWxsQ2F2ZUFkdmVudHVyZXJzID0gbmV3IE5wYyh0aGlzLCAweDNhKTtcbiAgLy8gdW51c2VkIDNiLi4zY1xuICBKb2VsRWxkZXIgPSBuZXcgTnBjKHRoaXMsIDB4M2QpO1xuICAvLyBnZW5lcmljIGpvZWwgM2UuLjQzXG4gIENsYXJrID0gbmV3IE5wYyh0aGlzLCAweDQ0KTtcbiAgLy8gZ2VuZXJpYyB6b21iaWUgdG93biA0NS4uNDdcbiAgLy8gZ2VuZXJpYyBzd2FuIDQ5Li40ZFxuICBTaHlyb25HdWFyZCA9IG5ldyBOcGModGhpcywgMHg0ZSk7XG4gIC8vIGdlbmVyaWMgc2h5cm9uIDRmLi41M1xuICBCcm9rYWhhbmEgPSBuZXcgTnBjKHRoaXMsIDB4NTQpO1xuICAvLyBnZW5lcmljIGdvYSA1NS4uNThcbiAgU2FoYXJhQnVubnkgPSBuZXcgTnBjKHRoaXMsIDB4NTkpO1xuICBEZW8gPSBuZXcgTnBjKHRoaXMsIDB4NWEpO1xuICBTYWhhcmFFbGRlciA9IG5ldyBOcGModGhpcywgMHg1Yik7XG4gIFNhaGFyYUVsZGVyRGF1Z2h0ZXIgPSBuZXcgTnBjKHRoaXMsIDB4NWMpO1xuICAvLyBnZW5lcmljIDVkXG4gIFplYnUgPSBuZXcgTnBjKHRoaXMsIDB4NWUpO1xuICBUb3JuZWwgPSBuZXcgTnBjKHRoaXMsIDB4NWYpO1xuICBTdG9tID0gbmV3IE5wYyh0aGlzLCAweDYwKTtcbiAgTWVzaWFSZWNvcmRpbmcgPSBuZXcgTnBjKHRoaXMsIDB4NjEpO1xuICBBc2luYSA9IG5ldyBOcGModGhpcywgMHg2Mik7XG4gIEh1cnREb2xwaGluID0gbmV3IE5wYyh0aGlzLCAweDYzKTtcbiAgRmlzaGVybWFuID0gbmV3IE5wYyh0aGlzLCAweDY0KTtcbiAgLy8gZ2VuZXJpYy91bnNlZCA2NS4uNjdcbiAgS2Vuc3VJbkNhYmluID0gbmV3IE5wYyh0aGlzLCAweDY4KTtcbiAgRG9scGhpbiA9IG5ldyBOcGModGhpcywgMHg2OSk7XG4gIC8vIHVudXNlZCA2YVxuICBTbGVlcGluZ0tlbnN1ID0gbmV3IE5wYyh0aGlzLCAweDZiKTtcbiAgS2Vuc3VEaXNndWlzZWRBc0RhbmNlciA9IG5ldyBOcGModGhpcywgMHg2Yyk7XG4gIEtlbnN1RGlzZ3Vpc2VkQXNTb2xkaWVyID0gbmV3IE5wYyh0aGlzLCAweDZkKTtcbiAgQXp0ZWNhSW5TaHlyb24gPSBuZXcgTnBjKHRoaXMsIDB4NmUpO1xuICAvLyBnZW5lcmljIDZmXG4gIERlYWRBa2FoYW5hID0gbmV3IE5wYyh0aGlzLCAweDcwKTtcbiAgRGVhZFN0b21zR2lybGZyaWVuZCA9IG5ldyBOcGModGhpcywgMHg3MSk7XG4gIERlYWRTdG9tID0gbmV3IE5wYyh0aGlzLCAweDcyKTtcbiAgLy8gdW51c2VkIDczXG4gIEtlbnN1SW5Td2FuID0gbmV3IE5wYyh0aGlzLCAweDc0KTsgLy8gbm90ZTogdW51c2VkIGluIHZhbmlsbGEgKDdlKVxuICBTbGltZWRLZW5zdSA9IG5ldyBOcGModGhpcywgMHg3NSk7XG4gIC8vIGdlbmVyaWMgNzYuLjdhXG4gIEZpc2hlcm1hbkRhdWdodGVyID0gbmV3IE5wYyh0aGlzLCAweDdiKTtcbiAgLy8gZ2VuZXJpYyA3Yy4uN2RcbiAgS2Vuc3UgPSBuZXcgTnBjKHRoaXMsIDB4N2UpO1xuICAvLyBnZW5lcmljL3VudXNlZCA3Zi4uODJcbiAgQWthaGFuYUluQnJ5bm1hZXIgPSBuZXcgTnBjKHRoaXMsIDB4ODIpOyAvLyBub3RlOiB1bnVzZWQgaW4gdmFuaWxsYSAoMTYpXG4gIEF6dGVjYUluUHlyYW1pZCA9IG5ldyBOcGModGhpcywgMHg4Myk7XG4gIFNhYmVyYURpc2d1aXNlZEFzTWVzaWEgPSBuZXcgTnBjKHRoaXMsIDB4ODQpO1xuICBTdG9uZWRXYXRlcmZhbGxDYXZlQWR2ZW50dXJlcnMgPSBuZXcgTnBjKHRoaXMsIDB4ODUpO1xuICAvLyB1bnVzZWQgODYuLjg3XG4gIFN0b25lZEFrYWhhbmEgPSBuZXcgTnBjKHRoaXMsIDB4ODgpO1xuICAvLyB1bnVzZWQgODkuLjhkXG4gIE1lc2lhID0gbmV3IE5wYyh0aGlzLCAweDhlKTtcblxuICAvLyB1bnVzYWJsZSA4Zi4uYmYgKHdlJ3ZlIGNvLW9wdGVkIHRoYXQgUFJHIHNwYWNlIGZvciBub3cpXG5cbiAgVmFtcGlyZTEgPSBuZXcgTnBjKHRoaXMsIDB4YzApO1xuICBJbnNlY3QgPSBuZXcgTnBjKHRoaXMsIDB4YzEpO1xuICBLZWxiZXNxdWUxID0gbmV3IE5wYyh0aGlzLCAweGMyKTtcbiAgUmFnZSA9IG5ldyBOcGModGhpcywgMHhjMyk7XG4gIC8vIHVudXNlZCAtIE1hZG8xID0gbmV3IE5wYyh0aGlzLCAweGM0KTtcbiAgS2VsYmVzcXVlMiA9IG5ldyBOcGModGhpcywgMHhjNSk7XG4gIFNhYmVyYTIgPSBuZXcgTnBjKHRoaXMsIDB4YzYpO1xuICBNYWRvMiA9IG5ldyBOcGModGhpcywgMHhjNyk7XG4gIEthcm1pbmUgPSBuZXcgTnBjKHRoaXMsIDB4YzgpO1xuICBTdGF0dWVPZk1vb24gPSBuZXcgTnBjKHRoaXMsIDB4YzkpO1xuICBTdGF0dWVPZlN1biA9IG5ldyBOcGModGhpcywgMHhjYSk7XG4gIERyYXlnb24gPSBuZXcgTnBjKHRoaXMsIDB4Y2IpO1xuICBWYW1waXJlMiA9IG5ldyBOcGModGhpcywgMHhjYyk7XG5cbiAgY29uc3RydWN0b3IocmVhZG9ubHkgcm9tOiBSb20pIHtcbiAgICBzdXBlcigweGNkKTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzKSB7XG4gICAgICBjb25zdCBucGMgPSB0aGlzW2tleV07XG4gICAgICBpZiAoIXRoaXMuaGFzT3duUHJvcGVydHkoa2V5KSB8fCAhKG5wYyBpbnN0YW5jZW9mIE5wYykpIGNvbnRpbnVlO1xuICAgICAgdGhpc1tucGMuaWRdID0gbnBjO1xuICAgICAgbnBjLm5hbWUgPSB1cHBlckNhbWVsVG9TcGFjZXMoa2V5KTtcbiAgICB9XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAweGNkOyBpKyspIHtcbiAgICAgIGlmICghdGhpc1tpXSkge1xuICAgICAgICB0aGlzW2ldID0gbmV3IE5wYyh0aGlzLCBpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIE5wYyBleHRlbmRzIEVudGl0eSB7XG5cbiAgcHJpdmF0ZSBfdXNlZDogYm9vbGVhbjtcbiAgbmFtZT86IHN0cmluZztcbiAgaXRlbU5hbWVzPzogW3N0cmluZywgc3RyaW5nXTtcblxuICBkYXRhOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXTsgLy8gdWludDhcbiAgLy8gRmxhZ3MgdG8gY2hlY2sgcGVyIGxvY2F0aW9uOiBwb3NpdGl2ZSBtZWFucyBcIm11c3QgYmUgc2V0XCJcbiAgc3Bhd25Db25kaXRpb25zID0gbmV3IE1hcDxudW1iZXIsIEZsYWdMaXN0PigpOyAvLyBrZXkgdWludDhcblxuICBnbG9iYWxEaWFsb2dzOiBHbG9iYWxEaWFsb2dbXTtcbiAgbG9jYWxEaWFsb2dzID0gbmV3IE1hcDxudW1iZXIsIExvY2FsRGlhbG9nW10+KCk7XG5cbiAgY29uc3RydWN0b3IocmVhZG9ubHkgbnBjczogTnBjcywgaWQ6IG51bWJlcikge1xuICAgIHN1cGVyKG5wY3Mucm9tLCBpZCk7XG4gICAgY29uc3Qgcm9tID0gbnBjcy5yb207XG4gICAgaWYgKGlkID4gMHhjYykgdGhyb3cgbmV3IEVycm9yKGBVbmF2YWlsYWJsZTogJHtpZH1gKTtcbiAgICAvLyBUT0RPIC0gY2hlY2sgKHRoaXMuYmFzZSA8PSAweDFjNzgxKSBmb3IgdW51c2VkP1xuICAgIHRoaXMuX3VzZWQgPSAhVU5VU0VEX05QQ1MuaGFzKGlkKSAmJiAoaWQgPCAweDhmIHx8IGlkID49IDB4YzApO1xuICAgIGxldCBkaWFsb2dCYXNlID0gaWQgPCAweGM0ID8gdGhpcy5kaWFsb2dQb2ludGVyLnJlYWRBZGRyZXNzKHJvbS5wcmcpIDogbnVsbDtcbiAgICBpZiAoZGlhbG9nQmFzZSAmJiBkaWFsb2dCYXNlLm9yZyA9PT0gMHg4YjM5KSBkaWFsb2dCYXNlID0gbnVsbDtcblxuICAgIHRoaXMuZGF0YSA9IHR1cGxlKHJvbS5wcmcsIHRoaXMuZGF0YUJhc2Uub2Zmc2V0LCA0KTtcblxuICAgIGNvbnN0IHNwYXduQmFzZSA9IHRoaXMuc3Bhd25Qb2ludGVyLnJlYWRBZGRyZXNzKHJvbS5wcmcpO1xuXG4gICAgLy8gUG9wdWxhdGUgc3Bhd24gY29uZGl0aW9uc1xuICAgIGxldCBpID0gc3Bhd25CYXNlLm9mZnNldDtcbiAgICBsZXQgbG9jO1xuICAgIHdoaWxlICh0aGlzLnVzZWQgJiYgKGxvYyA9IHJvbS5wcmdbaSsrXSkgIT09IDB4ZmYpIHtcbiAgICAgIGNvbnN0IGZsYWdzID0gU1BBV05fQ09ORElUSU9OX0ZMQUdTLnJlYWQocm9tLnByZywgaSk7XG4gICAgICBpICs9IDIgKiBmbGFncy5sZW5ndGg7XG4gICAgICB0aGlzLnNwYXduQ29uZGl0aW9ucy5zZXQobG9jLCBmbGFncyk7XG4gICAgfVxuXG4gICAgLy8gUG9wdWxhdGUgdGhlIGRpYWxvZyB0YWJsZVxuICAgIHRoaXMuZ2xvYmFsRGlhbG9ncyA9IFtdO1xuICAgIGlmIChkaWFsb2dCYXNlKSB7XG4gICAgICBsZXQgYSA9IGRpYWxvZ0Jhc2Uub2Zmc2V0O1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgY29uc3QgW2RpYWxvZywgbGFzdF0gPSBHbG9iYWxEaWFsb2cucGFyc2Uocm9tLnByZywgYSk7XG4gICAgICAgIGEgKz0gNDtcbiAgICAgICAgaWYgKGRpYWxvZy5jb25kaXRpb24pIHRoaXMuZ2xvYmFsRGlhbG9ncy5wdXNoKGRpYWxvZyk7XG4gICAgICAgIGlmIChsYXN0KSBicmVhaztcbiAgICAgIH1cbiAgICAgIC8vIFJlYWQgdGhlIGxvY2F0aW9uIHRhYmxlXG4gICAgICBjb25zdCBsb2NhdGlvbnM6IFtudW1iZXIsIG51bWJlcl1bXSA9IFtdO1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgY29uc3QgbG9jYXRpb24gPSByb20ucHJnW2ErK107XG4gICAgICAgIGlmIChsb2NhdGlvbiA9PT0gMHhmZikgYnJlYWs7XG4gICAgICAgIGxvY2F0aW9ucy5wdXNoKFtsb2NhdGlvbiwgcm9tLnByZ1thKytdXSk7XG4gICAgICB9XG4gICAgICBpZiAoIWxvY2F0aW9ucy5sZW5ndGgpIGxvY2F0aW9ucy5wdXNoKFstMSwgMF0pO1xuICAgICAgLy8gTm93IGJ1aWxkIHVwIHRoZSBMb2NhbERpYWxvZyB0YWJsZXNcbiAgICAgIGNvbnN0IGJhc2UgPSBhO1xuICAgICAgZm9yIChjb25zdCBbbG9jYXRpb24sIG9mZnNldF0gb2YgbG9jYXRpb25zKSB7XG4gICAgICAgIGNvbnN0IGRpYWxvZ3M6IExvY2FsRGlhbG9nW10gPSBbXTtcbiAgICAgICAgdGhpcy5sb2NhbERpYWxvZ3Muc2V0KGxvY2F0aW9uLCBkaWFsb2dzKTtcbiAgICAgICAgYSA9IGJhc2UgKyBvZmZzZXQ7XG4gICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgY29uc3QgW2RpYWxvZywgbGFzdF0gPSBMb2NhbERpYWxvZy5wYXJzZShyb20ucHJnLCBhKTtcbiAgICAgICAgICBhICs9IGRpYWxvZy5ieXRlTGVuZ3RoKCk7XG4gICAgICAgICAgZGlhbG9ncy5wdXNoKGRpYWxvZyk7XG4gICAgICAgICAgaWYgKGxhc3QpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZm9yIChjb25zdCBpIGluIE5BTUVTKSB7XG4gICAgLy8gICBpZiAoIU5BTUVTLmhhc093blByb3BlcnR5KGkpKSBjb250aW51ZTtcbiAgICAvLyAgIGNvbnN0IG5hbWUgPSAoTkFNRVMgYXMge30gYXMge1trZXk6IHN0cmluZ106IFtudW1iZXIsIHN0cmluZywgc3RyaW5nPywgc3RyaW5nP119KVtpXTtcbiAgICAvLyAgIGlmIChuYW1lWzBdID09PSBpZCkge1xuICAgIC8vICAgICB0aGlzLm5hbWUgPSBuYW1lWzFdO1xuICAgIC8vICAgICBpZiAobmFtZS5sZW5ndGggPiAyKSB7XG4gICAgLy8gICAgICAgdGhpcy5pdGVtTmFtZXMgPSBuYW1lLnNsaWNlKDIsIDQpIGFzIFtzdHJpbmcsIHN0cmluZ107XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH1cbiAgICAvLyB9XG5cbiAgICAvLyBjb25zb2xlLmxvZyhgTlBDIFNwYXduICQke3RoaXMuaWQudG9TdHJpbmcoMTYpfSBmcm9tICR7dGhpcy5iYXNlLnRvU3RyaW5nKDE2KX06IGJ5dGVzOiAkJHtcbiAgICAvLyAgICAgICAgICAgICAgdGhpcy5ieXRlcygpLm1hcCh4PT54LnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLDApKS5qb2luKCcgJyl9YCk7XG4gIH1cblxuICBnZXQgZGF0YUJhc2UoKTogQWRkcmVzcyB7XG4gICAgY29uc3Qgc2VnID0gdGhpcy5pZCAmIDB4ODAgPyAkMDUgOiAkMDQ7XG4gICAgY29uc3Qgb3JnID0gMHg4MGYwIHwgKCh0aGlzLmlkICYgMHhmYykgPDwgNikgfCAoKHRoaXMuaWQgJiAzKSA8PCAyKTtcbiAgICByZXR1cm4gQWRkcmVzcy5vZihzZWcsIG9yZyk7XG4gIH1cblxuICBnZXQgc3Bhd25Qb2ludGVyKCk6IEFkZHJlc3Mge1xuICAgIHJldHVybiBBZGRyZXNzLm9mKCQwZSwgMHg4NWUwICsgKHRoaXMuaWQgPDwgMSkpO1xuICB9XG5cbiAgZ2V0IGRpYWxvZ1BvaW50ZXIoKTogQWRkcmVzcyB7XG4gICAgcmV0dXJuIEFkZHJlc3Mub2YoJDBlLCAweDg5NWQgKyAodGhpcy5pZCA8PCAxKSk7XG4gIH1cblxuICBnZXQgdXNlZCgpIHsgcmV0dXJuIHRoaXMuX3VzZWQ7IH1cbiAgc2V0IHVzZWQodXNlZDogYm9vbGVhbikge1xuICAgIC8vIHF1aWNrIGNoZWNrOiB3ZSBjYW4ndCB1c2Ugc29tZSBpbmRleGVzIGJlY2F1c2UgZGF0YSB0YWJsZXMgY28tb3B0ZWQuXG4gICAgLy8gMWNhNmYuLjFjYTc5LCAxY2E3Yi4uMWNhZTMgKGMwLi5jMiBhcmUgdXNlZCBidXQgaGF2ZSBubyBkaWFsb2cuLi4pXG4gICAgLy8gMWM2ZjIuLjFjNmZjLCAxYzZmZS4uMWM3NjBcbiAgICBpZiAodXNlZCAmJiAodGhpcy5pZCA+IDB4ODggJiYgdGhpcy5pZCA8IDB4YzAgJiYgdGhpcy5pZCAhPT0gMHg4ZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgaW52YWxpZDogJHt0aGlzLmlkfWApO1xuICAgIH1cbiAgICB0aGlzLl91c2VkID0gdXNlZDtcbiAgfVxuXG4gIHNwYXduQ29uZGl0aW9uc0J5dGVzKCk6IG51bWJlcltdIHtcbiAgICBjb25zdCBieXRlcyA9IFtdO1xuICAgIGZvciAoY29uc3QgW2xvYywgZmxhZ3NdIG9mIHRoaXMuc3Bhd25Db25kaXRpb25zKSB7XG4gICAgICBieXRlcy5wdXNoKGxvYywgLi4uU1BBV05fQ09ORElUSU9OX0ZMQUdTLmJ5dGVzKGZsYWdzKSk7XG4gICAgfVxuICAgIGJ5dGVzLnB1c2goMHhmZik7XG4gICAgcmV0dXJuIGJ5dGVzO1xuICB9XG5cbiAgZGlhbG9nKGxvY2F0aW9uPzogTG9jYXRpb24pOiBMb2NhbERpYWxvZ1tdIHtcbiAgICBjb25zdCBpZCA9IGxvY2F0aW9uID8gbG9jYXRpb24uaWQgOiAtMTtcbiAgICBjb25zdCBkaWFsb2dzID0gdGhpcy5sb2NhbERpYWxvZ3MuZ2V0KGlkKTtcbiAgICBpZiAoZGlhbG9ncykgcmV0dXJuIGRpYWxvZ3M7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBObyBsb2NhbCBkaWFsb2cgZm9yIE5QQyAke2hleCh0aGlzLmlkKX0gYXQgJHtoZXgoaWQpfWApO1xuICB9XG5cbiAgc3Bhd25zKGxvY2F0aW9uOiBMb2NhdGlvbik6IG51bWJlcltdIHtcbiAgICBjb25zdCBpZCA9IGxvY2F0aW9uLmlkO1xuICAgIGNvbnN0IGNvbmRpdGlvbnMgPSB0aGlzLnNwYXduQ29uZGl0aW9ucy5nZXQobG9jYXRpb24uaWQpO1xuICAgIGlmIChjb25kaXRpb25zKSByZXR1cm4gY29uZGl0aW9ucztcbiAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHNwYXduIGNvbmRpdGlvbiBmb3IgTlBDICR7aGV4KHRoaXMuaWQpfSBhdCAke2hleChpZCl9YCk7XG4gIH1cblxuICBoYXNEaWFsb2coKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVzdWx0ID0gQm9vbGVhbih0aGlzLmdsb2JhbERpYWxvZ3MubGVuZ3RoIHx8IHRoaXMubG9jYWxEaWFsb2dzLnNpemUpO1xuICAgIGlmICh0aGlzLmlkID4gMHg4ZSAmJiB0aGlzLmlkICE9PSAweGMzICYmIHJlc3VsdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkOiAke3RoaXMuaWR9YCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAqIGFsbERpYWxvZ3MoKTogSXRlcmFibGU8TG9jYWxEaWFsb2cgfCBHbG9iYWxEaWFsb2c+IHtcbiAgICB5aWVsZCAqIHRoaXMuZ2xvYmFsRGlhbG9ncztcbiAgICBmb3IgKGNvbnN0IGRzIG9mIHRoaXMubG9jYWxEaWFsb2dzLnZhbHVlcygpKSB7XG4gICAgICB5aWVsZCAqIGRzO1xuICAgIH1cbiAgfVxuXG4gIGRpYWxvZ0J5dGVzKCk6IG51bWJlcltdIHtcbiAgICBpZiAoIXRoaXMuaGFzRGlhbG9nKCkpIHJldHVybiBbXTtcbiAgICBjb25zdCBieXRlczogbnVtYmVyW10gPSBbXTtcbiAgICBmdW5jdGlvbiBzZXJpYWxpemUoZHM6IEdsb2JhbERpYWxvZ1tdIHwgTG9jYWxEaWFsb2dbXSk6IG51bWJlcltdIHtcbiAgICAgIGNvbnN0IG91dDogbnVtYmVyW10gPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgb3V0LnB1c2goLi4uZHNbaV0uYnl0ZXMoaSA9PT0gZHMubGVuZ3RoIC0gMSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG4gICAgaWYgKHRoaXMuZ2xvYmFsRGlhbG9ncy5sZW5ndGgpIHtcbiAgICAgIGJ5dGVzLnB1c2goLi4uc2VyaWFsaXplKHRoaXMuZ2xvYmFsRGlhbG9ncykpO1xuICAgIH0gZWxzZSB7XG4gICAgICBieXRlcy5wdXNoKDB4ODAsIDAsIDAsIDApOyAvLyBcImVtcHR5XCJcbiAgICB9XG4gICAgY29uc3QgbG9jYWxzOiBudW1iZXJbXSA9IFtdO1xuICAgIGNvbnN0IGNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTsgLy8gYWxsb3cgcmV1c2luZyBsb2NhdGlvbnNcbiAgICBmb3IgKGNvbnN0IFtsb2NhdGlvbiwgZGlhbG9nc10gb2YgdGhpcy5sb2NhbERpYWxvZ3MpIHtcbiAgICAgIGNvbnN0IGxvY2FsQnl0ZXMgPSBzZXJpYWxpemUoZGlhbG9ncyk7XG4gICAgICBjb25zdCBsYWJlbCA9IGxvY2FsQnl0ZXMuam9pbignLCcpO1xuICAgICAgY29uc3QgY2FjaGVkID0gY2FjaGUuZ2V0KGxhYmVsKTtcbiAgICAgIGlmIChjYWNoZWQgIT0gbnVsbCkge1xuICAgICAgICBieXRlcy5wdXNoKGxvY2F0aW9uLCBjYWNoZWQpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhgU0FWRUQgJHtsb2NhbEJ5dGVzLmxlbmd0aH0gYnl0ZXNgKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjYWNoZS5zZXQobGFiZWwsIGxvY2Fscy5sZW5ndGgpO1xuICAgICAgaWYgKGxvY2F0aW9uICE9PSAtMSkgYnl0ZXMucHVzaChsb2NhdGlvbiwgbG9jYWxzLmxlbmd0aCk7XG4gICAgICBsb2NhbHMucHVzaCguLi5sb2NhbEJ5dGVzKTtcbiAgICB9XG4gICAgaWYgKGxvY2Fscy5sZW5ndGgpIGJ5dGVzLnB1c2goMHhmZiwgLi4ubG9jYWxzKTtcblxuICAgIC8vIGNvbnNvbGUubG9nKGBOUEMgJHt0aGlzLmlkLnRvU3RyaW5nKDE2KX06IGJ5dGVzIGxlbmd0aCAke2J5dGVzLmxlbmd0aH1gKTtcblxuICAgIHJldHVybiBieXRlcztcbiAgfVxuXG4gIC8vIE1ha2VzIGEgXCJoYXJkbGlua1wiIGJldHdlZW4gdHdvIE5QQ3MsIGZvciBzcGF3biBjb25kaXRpb25zIGFuZCBkaWFsb2cuXG4gIGxpbmsoaWQ6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IG90aGVyID0gdGhpcy5yb20ubnBjc1tpZF07XG4gICAgdGhpcy5zcGF3bkNvbmRpdGlvbnMgPSBvdGhlci5zcGF3bkNvbmRpdGlvbnM7XG4gICAgdGhpcy5saW5rRGlhbG9nKGlkKTtcbiAgfVxuXG4gIGxpbmtEaWFsb2coaWQ6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IG90aGVyID0gdGhpcy5yb20ubnBjc1tpZF07XG4gICAgdGhpcy5nbG9iYWxEaWFsb2dzID0gb3RoZXIuZ2xvYmFsRGlhbG9ncztcbiAgICB0aGlzLmxvY2FsRGlhbG9ncyA9IG90aGVyLmxvY2FsRGlhbG9ncztcbiAgfVxuXG4gIGxvY2FsRGlhbG9nKGluZGV4OiBudW1iZXIpOiBMb2NhbERpYWxvZztcbiAgbG9jYWxEaWFsb2cobG9jYXRpb246IG51bWJlciwgaW5kZXg/OiBudW1iZXIpOiBMb2NhbERpYWxvZyB7XG4gICAgaWYgKGluZGV4ID09IG51bGwpIHtcbiAgICAgIGluZGV4ID0gbG9jYXRpb247XG4gICAgICBsb2NhdGlvbiA9IC0xO1xuICAgIH1cbiAgICBjb25zdCBkaWFsb2dzID0gdGhpcy5sb2NhbERpYWxvZ3MuZ2V0KGxvY2F0aW9uKTtcbiAgICBpZiAoZGlhbG9ncyA9PSBudWxsIHx8IGluZGV4ID49IGRpYWxvZ3MubGVuZ3RoKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGxvY2FsIGRpYWxvZyAke2luZGV4fSBmb3IgbG9jYXRpb24gJHtoZXgobG9jYXRpb24pfWApO1xuICAgIH1cbiAgICByZXR1cm4gZGlhbG9nc1tpbmRleF07XG4gIH1cblxuICBpc1BhcmFseXphYmxlKCk6IGJvb2xlYW4ge1xuICAgIGZvciAobGV0IGkgPSAweDM1MDU4OyBpIDwgMHgzNTA2YzsgaSsrKSB7XG4gICAgICBpZiAodGhpcy5yb20ucHJnW2ldID09PSB0aGlzLmlkKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgd3JpdGUoKTogTW9kdWxlW10ge1xuICAgIGlmICghdGhpcy51c2VkKSByZXR1cm4gW107XG4gICAgY29uc3QgaWQgPSBoZXgodGhpcy5pZCk7XG4gICAgY29uc3QgYSA9IHRoaXMucm9tLmFzc2VtYmxlcigpO1xuXG4gICAgdGhpcy5kYXRhQmFzZS5sb2MoYSk7XG4gICAgYS5ieXRlKC4uLnRoaXMuZGF0YSk7XG5cbiAgICBhLnNlZ21lbnQoJzBlJywgJ2ZlJywgJ2ZmJyk7XG4gICAgYS5yZWxvYyhgU3Bhd25Db25kaXRpb25fJHtpZH1gKTtcbiAgICBjb25zdCBzcGF3biA9IGEucGMoKTtcbiAgICBhLmJ5dGUoLi4udGhpcy5zcGF3bkNvbmRpdGlvbnNCeXRlcygpKTtcbiAgICB0aGlzLnNwYXduUG9pbnRlci5sb2MoYSwgYFNwYXduQ29uZGl0aW9uXyR7aWR9X1BvaW50ZXJgKTtcbiAgICBhLndvcmQoc3Bhd24pO1xuXG4gICAgaWYgKHRoaXMuaGFzRGlhbG9nKCkpIHtcbiAgICAgIGEuc2VnbWVudCgnMGUnLCAnZmUnLCAnZmYnKTtcbiAgICAgIGEucmVsb2MoYERpYWxvZ18ke2lkfWApO1xuICAgICAgY29uc3QgZGlhbG9nID0gYS5wYygpO1xuICAgICAgYS5ieXRlKC4uLnRoaXMuZGlhbG9nQnl0ZXMoKSk7XG4gICAgICB0aGlzLmRpYWxvZ1BvaW50ZXIubG9jKGEsIGBEaWFsb2dfJHtpZH1fUG9pbnRlcmApO1xuICAgICAgYS53b3JkKGRpYWxvZyk7XG4gICAgfVxuICAgIHJldHVybiBbYS5tb2R1bGUoKV07XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEdsb2JhbERpYWxvZyB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBjb25kaXRpb246IG51bWJlciwgcHVibGljIG1lc3NhZ2U6IE1lc3NhZ2VJZCkge31cblxuICBzdGF0aWMgb2YoY29uZGl0aW9uOiBudW1iZXIsXG4gICAgICAgICAgICBtZXNzYWdlOiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcj9dKTogR2xvYmFsRGlhbG9nIHtcbiAgICBjb25zdCBbcGFydCwgaW5kZXgsIGFjdGlvbiA9IDBdID0gbWVzc2FnZTtcbiAgICByZXR1cm4gbmV3IEdsb2JhbERpYWxvZyhjb25kaXRpb24sIE1lc3NhZ2VJZC5vZih7cGFydCwgaW5kZXgsIGFjdGlvbn0pKTtcbiAgfVxuXG4gIC8vIFJldHVybnMgW2RpYWxvZywgbGFzdF0uXG4gIHN0YXRpYyBwYXJzZShkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyID0gMCk6IFtHbG9iYWxEaWFsb2csIGJvb2xlYW5dIHtcbiAgICBjb25zdCBmbGFnID0gcmVhZEJpZ0VuZGlhbihkYXRhLCBvZmZzZXQpO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBNZXNzYWdlSWQuZnJvbShkYXRhLCBvZmZzZXQgKyAyKTtcblxuICAgIGxldCBjb25kaXRpb24gPSBmbGFnICYgMHgwM2ZmO1xuICAgIGNvbnN0IGxhc3QgPSAhIShmbGFnICYgMHg4MDAwKTtcbiAgICBjb25zdCBzaWduID0gZmxhZyAmIDB4MjAwMDtcbiAgICBpZiAoc2lnbikgY29uZGl0aW9uID0gfmNvbmRpdGlvbjtcblxuICAgIHJldHVybiBbbmV3IEdsb2JhbERpYWxvZyhjb25kaXRpb24sIG1lc3NhZ2UpLCBsYXN0XTtcbiAgfVxuXG4gIGJ5dGVzKGxhc3Q6IGJvb2xlYW4pOiBudW1iZXJbXSB7XG4gICAgbGV0IGZsYWcgPSB0aGlzLmNvbmRpdGlvbjtcbiAgICBpZiAoZmxhZyA8IDApIGZsYWcgPSAofmZsYWcpIHwgMHgyMDAwO1xuICAgIGlmIChsYXN0KSBmbGFnIHw9IDB4ODAwMDtcbiAgICByZXR1cm4gW2ZsYWcgPj4+IDgsIGZsYWcgJiAweGZmLCAuLi50aGlzLm1lc3NhZ2UuZGF0YV07XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIExvY2FsRGlhbG9nIHtcbiAgY29uc3RydWN0b3IocHVibGljIGNvbmRpdGlvbjogbnVtYmVyLFxuICAgICAgICAgICAgICBwdWJsaWMgbWVzc2FnZTogTWVzc2FnZUlkLFxuICAgICAgICAgICAgICBwdWJsaWMgdXBkYXRlOiBudW1iZXIsXG4gICAgICAgICAgICAgIHB1YmxpYyBmbGFnczogRmxhZ0xpc3QpIHt9XG5cbiAgY2xvbmUoKTogTG9jYWxEaWFsb2cge1xuICAgIHJldHVybiBMb2NhbERpYWxvZy5wYXJzZSh0aGlzLmJ5dGVzKGZhbHNlKSlbMF07XG4gIH1cblxuICAvLyBSZXR1cm5zIFtkaWFsb2csIGxhc3RdXG4gIHN0YXRpYyBwYXJzZShkYXRhOiBEYXRhPG51bWJlcj4sIG9mZnNldDogbnVtYmVyID0gMCk6IFtMb2NhbERpYWxvZywgYm9vbGVhbl0ge1xuICAgIGNvbnN0IHdvcmQgPSByZWFkQmlnRW5kaWFuKGRhdGEsIG9mZnNldCk7XG4gICAgY29uc3QgbWVzc2FnZSA9IE1lc3NhZ2VJZC5mcm9tKGRhdGEsIG9mZnNldCArIDIpO1xuICAgIGNvbnN0IHVwZGF0ZSA9IGRhdGFbb2Zmc2V0ICsgNF07XG4gICAgb2Zmc2V0ICs9IDU7XG5cbiAgICBsZXQgY29uZGl0aW9uID0gd29yZCAmIDB4MDNmZjtcbiAgICBjb25zdCBsYXN0ID0gISEod29yZCAmIDB4ODAwMCk7XG4gICAgY29uc3Qgc2lnbiA9IHdvcmQgJiAweDIwMDA7XG4gICAgaWYgKHNpZ24pIGNvbmRpdGlvbiA9IH5jb25kaXRpb247XG4gICAgY29uc3QgZmxhZ3MgPSB3b3JkICYgMHg0MDAwID8gRElBTE9HX0ZMQUdTLnJlYWQoZGF0YSwgb2Zmc2V0KSA6IFtdO1xuICAgIHJldHVybiBbbmV3IExvY2FsRGlhbG9nKGNvbmRpdGlvbiwgbWVzc2FnZSwgdXBkYXRlLCBmbGFncyksIGxhc3RdO1xuICB9XG5cbiAgc3RhdGljIG9mKGNvbmRpdGlvbjogbnVtYmVyLFxuICAgICAgICAgICAgbWVzc2FnZTogW251bWJlciwgbnVtYmVyLCBudW1iZXI/XSxcbiAgICAgICAgICAgIGZsYWdzOiBGbGFnTGlzdCA9IFtdKTogTG9jYWxEaWFsb2cge1xuICAgIGNvbnN0IFtwYXJ0LCBpbmRleCwgYWN0aW9uID0gMF0gPSBtZXNzYWdlO1xuICAgIHJldHVybiBuZXcgTG9jYWxEaWFsb2coY29uZGl0aW9uLCBNZXNzYWdlSWQub2Yoe3BhcnQsIGluZGV4LCBhY3Rpb259KSwgMCwgZmxhZ3MpO1xuICB9XG5cbiAgYnl0ZUxlbmd0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiA1ICsgMiAqIHRoaXMuZmxhZ3MubGVuZ3RoO1xuICB9XG5cbiAgYnl0ZXMobGFzdDogYm9vbGVhbik6IG51bWJlcltdIHtcbiAgICBsZXQgZmxhZyA9IHRoaXMuY29uZGl0aW9uO1xuICAgIGlmIChmbGFnIDwgMCkgZmxhZyA9ICh+ZmxhZykgfCAweDIwMDA7XG4gICAgaWYgKGxhc3QpIGZsYWcgfD0gMHg4MDAwO1xuICAgIGlmICh0aGlzLmZsYWdzLmxlbmd0aCkgZmxhZyB8PSAweDQwMDA7XG4gICAgcmV0dXJuIFtmbGFnID4+PiA4LCBmbGFnICYgMHhmZiwgLi4udGhpcy5tZXNzYWdlLmRhdGEsIHRoaXMudXBkYXRlLFxuICAgICAgICAgICAgLi4uRElBTE9HX0ZMQUdTLmJ5dGVzKHRoaXMuZmxhZ3MpXTtcbiAgfVxufVxuXG5jb25zdCBVTlVTRURfTlBDUyA9IG5ldyBTZXQoW1xuICAweDMxLCAweDNiLCAweDNjLCAweDY2LCAweDY3LCAweDZhLCAweDczLCAweDc0LFxuICAweDgyLCAweDg2LCAweDg3LCAweDg5LCAweDhhLCAweDhiLCAweDhjLCAweDhkLFxuICAweGM0LFxuICAvLyBhbHNvIGV2ZXJ5dGhpbmcgZnJvbSA4Zi4uYzAsIGJ1dCB0aGF0J3MgaW1wbGljaXQuXG5dKTtcblxuZXhwb3J0IGNsYXNzIFBvcnRvYVF1ZWVuIGV4dGVuZHMgTnBjIHtcbiAgLy8gVE9ETyAtIGV4dGVuZCBOYW1lZE5wYz8gYWN0dWFsbHkgYWRkIGl0IHRvIHRoZSBjbGFzcy5cbiAgcmVhZG9ubHkgaWQgPSAweDM4O1xuICByZWFkb25seSBuYW1lID0gJ1BvcnRvYSBRdWVlbic7XG4gIGdldCBleHBlY3RlZFN3b3JkKCk6IG51bWJlciB7IHJldHVybiB0aGlzLmxvY2FsRGlhbG9nKDMpLmNvbmRpdGlvbiAmIDB4ZmY7IH1cbiAgc2V0IGV4cGVjdGVkU3dvcmQoaWQ6IG51bWJlcikgeyB0aGlzLmxvY2FsRGlhbG9nKDMpLmNvbmRpdGlvbiA9IDB4MjAwIHwgaWQ7IH1cbn1cbiJdfQ==