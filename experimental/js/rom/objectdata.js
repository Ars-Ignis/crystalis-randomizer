import { Entity } from './entity.js';
import { readLittleEndian } from './util.js';
export class ObjectData extends Entity {
    constructor(rom, id) {
        super(rom, id);
        this.used = true;
        this.name = '';
        this.base = readLittleEndian(rom.prg, this.pointer) + 0x10000;
        this.sfx = rom.prg[this.base];
        this.data = [];
        let a = this.base + 1;
        let m = 0;
        for (let i = 0; i < 32; i++) {
            if (!(i & 7)) {
                m = rom.prg[a++];
            }
            this.data.push(m & 0x80 ? rom.prg[a++] : 0);
            m <<= 1;
        }
    }
    get pointer() {
        return 0x1ac00 + (this.id << 1);
    }
    serialize() {
        const out = [this.sfx];
        for (let i = 0; i < 4; i++) {
            const k = out.length;
            out.push(0);
            for (let j = 0; j < 8; j++) {
                if (this.data[8 * i + j]) {
                    out[k] |= (0x80 >>> j);
                    out.push(this.data[8 * i + j]);
                }
            }
        }
        return out;
    }
    write() {
        const a = this.rom.assembler();
        const label = `Object_${this.id.toString(16).padStart(2, '0')}`;
        a.segment('0d');
        a.reloc();
        a.label(label);
        a.byte(...this.serialize());
        a.org(0xac00 + (this.id << 1));
        a.word({ op: 'sym', sym: label });
        return [a.module()];
    }
    get(addr) {
        return this.data[(addr - 0x300) >>> 5];
    }
    parents() {
        return [];
    }
    locations() {
        return this.rom.locations.filter((l) => l.used && l.spawns.some(spawn => spawn.isMonster() && spawn.monsterId === this.id));
    }
    palettes(includeChildren = false) {
        if (this.action === 0x22)
            return [3];
        let metaspriteId = this.data[0];
        if (this.action === 0x2a)
            metaspriteId = this.data[31] | 1;
        if (this.action === 0x29)
            metaspriteId = 0x6b;
        if (this.action === 0x26)
            metaspriteId = 0x9c;
        const ms = this.rom.metasprites[metaspriteId];
        const childMs = includeChildren && this.child ?
            this.rom.metasprites[this.rom.objects[this.rom.adHocSpawns[this.child].objectId].data[0]] :
            null;
        const s = new Set([...ms.palettes(), ...(childMs ? childMs.palettes() : [])]);
        return [...s];
    }
    isVulnerable(element) {
        return !(this.elements & (1 << element));
    }
    isShadow() {
        return this.id === 0x7b || this.id === 0x8c;
    }
    get metasprite() { return METASPRITE.get(this.data); }
    set metasprite(x) { METASPRITE.set(this.data, x); }
    get speed() { return SPEED.get(this.data); }
    set speed(x) { SPEED.set(this.data, x); }
    get collisionPlane() { return COLLISION_PLANE.get(this.data); }
    set collisionPlane(x) { COLLISION_PLANE.set(this.data, x); }
    get hitbox() { return HITBOX.get(this.data); }
    set hitbox(x) { HITBOX.set(this.data, x); }
    get hp() { return HP.get(this.data); }
    set hp(x) { HP.set(this.data, x); }
    get atk() { return ATK.get(this.data); }
    set atk(x) { ATK.set(this.data, x); }
    get def() { return DEF.get(this.data); }
    set def(x) { DEF.set(this.data, x); }
    get level() { return LEVEL.get(this.data); }
    set level(x) { LEVEL.set(this.data, x); }
    get poison() { return !!POISON.get(this.data); }
    set poison(x) { POISON.set(this.data, x ? 1 : 0); }
    get child() { return CHILD.get(this.data); }
    set child(x) { CHILD.set(this.data, x); }
    get terrainSusceptibility() { return TERRAIN_SUSCEPTIBILITY.get(this.data); }
    set terrainSusceptibility(x) { TERRAIN_SUSCEPTIBILITY.set(this.data, x); }
    get immobile() { return !!IMMOBILE.get(this.data); }
    set immobile(x) { IMMOBILE.set(this.data, x ? 1 : 0); }
    get action() { return ACTION.get(this.data); }
    set action(x) { ACTION.set(this.data, x); }
    get replacement() { return REPLACEMENT.get(this.data); }
    set replacement(x) { REPLACEMENT.set(this.data, x); }
    get goldDrop() { return GOLD_DROP.get(this.data); }
    set goldDrop(x) { GOLD_DROP.set(this.data, x); }
    get elements() { return ELEMENTS.get(this.data); }
    set elements(x) { ELEMENTS.set(this.data, x); }
    get expReward() { return EXP_REWARD.get(this.data); }
    set expReward(x) { EXP_REWARD.set(this.data, x); }
    get attackType() { return ATTACK_TYPE.get(this.data); }
    set attackType(x) { ATTACK_TYPE.set(this.data, x); }
    get statusEffect() { return STATUS_EFFECT.get(this.data); }
    set statusEffect(x) { STATUS_EFFECT.set(this.data, x); }
}
function prop(...spec) {
    return new Stat(...spec);
}
class Stat {
    constructor(...spec) {
        this.spec = spec;
    }
    get(data) {
        let value = 0;
        for (const [addr, mask = 0xff, shift = 0] of this.spec) {
            const index = (addr - 0x300) >>> 5;
            const lsh = shift < 0 ? -shift : 0;
            const rsh = shift < 0 ? 0 : shift;
            value |= ((data[index] & mask) >>> rsh) << lsh;
        }
        return value;
    }
    set(data, value) {
        for (const [addr, mask = 0xff, shift = 0] of this.spec) {
            const index = (addr - 0x300) >>> 5;
            const lsh = shift < 0 ? -shift : 0;
            const rsh = shift < 0 ? 0 : shift;
            const v = (value >>> lsh) << rsh & mask;
            data[index] = data[index] & ~mask | v;
        }
    }
}
const METASPRITE = prop([0x300]);
const SPEED = prop([0x340, 0xf]);
const COLLISION_PLANE = prop([0x3a0, 0xf0, 4]);
const HITBOX = prop([0x420, 0x40, 2], [0x3a0, 0x0f]);
const HP = prop([0x3c0]);
const ATK = prop([0x3e0]);
const DEF = prop([0x400]);
const LEVEL = prop([0x420, 0x1f]);
const POISON = prop([0x420, 0x80, 7]);
const CHILD = prop([0x440]);
const TERRAIN_SUSCEPTIBILITY = prop([0x460]);
const IMMOBILE = prop([0x4a0, 0x80, 7]);
const ACTION = prop([0x4a0, 0x7f]);
const REPLACEMENT = prop([0x4c0]);
const GOLD_DROP = prop([0x500, 0xf0, 4]);
const ELEMENTS = prop([0x500, 0xf]);
const EXP_REWARD = prop([0x520]);
const ATTACK_TYPE = prop([0x540]);
const STATUS_EFFECT = prop([0x560, 0xf]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JqZWN0ZGF0YS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9yb20vb2JqZWN0ZGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUMsTUFBTSxFQUFDLE1BQU0sYUFBYSxDQUFDO0FBRW5DLE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLFdBQVcsQ0FBQztBQUczQyxNQUFNLE9BQU8sVUFBVyxTQUFRLE1BQU07SUFVcEMsWUFBWSxHQUFRLEVBQUUsRUFBVTtRQUM5QixLQUFLLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7UUFDZixJQUFJLENBQUMsSUFBSSxHQUFHLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLE9BQU8sQ0FBQztRQUM5RCxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2YsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7UUFDdEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUMzQixJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7Z0JBQ1osQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQzthQUNsQjtZQUNELElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdB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LE9BQU8sSUFBSSxDQUFDLEVBQUUsS0FBSyxJQUFJLElBQUksSUFBSSxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUM7SUFDOUMsQ0FBQztJQUVELElBQUksVUFBVSxLQUFhLE9BQU8sVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzlELElBQUksVUFBVSxDQUFDLENBQVMsSUFBSSxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTNELElBQUksS0FBSyxLQUFhLE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BELElBQUksS0FBSyxDQUFDLENBQVMsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRWpELElBQUksY0FBYyxLQUFhLE9BQU8sZUFBZSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZFLElBQUksY0FBYyxDQUFDLENBQVMsSUFBSSxlQUFlLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRXBFLElBQUksTUFBTSxLQUFhLE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RELElBQUksTUFBTSxDQUFDLENBQVMsSUFBSSxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRW5ELElBQUksRUFBRSxLQUFhLE9BQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzlDLElBQUksRUFBRSxDQUFDLENBQVMsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTNDLElBQUksR0FBRyxLQUFhLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hELElBQUksR0FBRyxDQUFDLENBQVMsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTdDLElBQUksR0FBRyxLQUFhLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hELElBQUksR0FBRyxDQUFDLENBQVMsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTdDLElBQUksS0FBSyxLQUFhLE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3BELElBQUksS0FBSyxDQUFDLENBQVMsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRWpELElBQUksTUFBTSxLQUFjLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6RCxJQUFJLE1BQU0sQ0FBQyxDQUFVLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFNUQsSUFBSSxLQUFLLEtBQWEsT0FBTyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7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LEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDNUIsTUFBTSxzQkFBc0IsR0FBRyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0FBQzdDLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4QyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNuQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0FBQ2xDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN6QyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUNwQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0FBQ2pDLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDbEMsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge01vZHVsZX0gZnJvbSAnLi4vYXNtL21vZHVsZS5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcbmltcG9ydCB7RW50aXR5fSBmcm9tICcuL2VudGl0eS5qcyc7XG5pbXBvcnQge0xvY2F0aW9ufSBmcm9tICcuL2xvY2F0aW9uLmpzJztcbmltcG9ydCB7cmVhZExpdHRsZUVuZGlhbn0gZnJvbSAnLi91dGlsLmpzJztcblxuLy8gTk9URTogV291bGQgYmUgbmljZSB0byBjYWxsIHRoaXMgT2JqZWN0LCBidXQgdGhhdCBzZWVtcyBjb25mdXNpbmcuLi5cbmV4cG9ydCBjbGFzcyBPYmplY3REYXRhIGV4dGVuZHMgRW50aXR5IHtcblxuICB1c2VkOiBib29sZWFuO1xuICBuYW1lOiBzdHJpbmc7XG5cbiAgYmFzZTogbnVtYmVyO1xuXG4gIHNmeDogbnVtYmVyO1xuICBkYXRhOiBudW1iZXJbXTtcblxuICBjb25zdHJ1Y3Rvcihyb206IFJvbSwgaWQ6IG51bWJlcikge1xuICAgIHN1cGVyKHJvbSwgaWQpO1xuICAgIHRoaXMudXNlZCA9IHRydWU7XG4gICAgdGhpcy5uYW1lID0gJyc7XG4gICAgdGhpcy5iYXNlID0gcmVhZExpdHRsZUVuZGlhbihyb20ucHJnLCB0aGlzLnBvaW50ZXIpICsgMHgxMDAwMDtcbiAgICB0aGlzLnNmeCA9IHJvbS5wcmdbdGhpcy5iYXNlXTtcbiAgICB0aGlzLmRhdGEgPSBbXTtcbiAgICBsZXQgYSA9IHRoaXMuYmFzZSArIDE7XG4gICAgbGV0IG0gPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMzI7IGkrKykge1xuICAgICAgaWYgKCEoaSAmIDcpKSB7XG4gICAgICAgIG0gPSByb20ucHJnW2ErK107XG4gICAgICB9XG4gICAgICB0aGlzLmRhdGEucHVzaChtICYgMHg4MCA/IHJvbS5wcmdbYSsrXSA6IDApO1xuICAgICAgbSA8PD0gMTtcbiAgICB9XG4gIH1cblxuICBnZXQgcG9pbnRlcigpOiBudW1iZXIge1xuICAgIHJldHVybiAweDFhYzAwICsgKHRoaXMuaWQgPDwgMSk7XG4gIH1cblxuICAvLyBSZXR1cm5zIGEgYnl0ZSBhcnJheSBmb3IgdGhpcyBlbnRyeVxuICBzZXJpYWxpemUoKTogbnVtYmVyW10ge1xuICAgIGNvbnN0IG91dCA9IFt0aGlzLnNmeF07XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHtcbiAgICAgIGNvbnN0IGsgPSBvdXQubGVuZ3RoO1xuICAgICAgb3V0LnB1c2goMCk7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDg7IGorKykge1xuICAgICAgICBpZiAodGhpcy5kYXRhWzggKiBpICsgal0pIHtcbiAgICAgICAgICBvdXRba10gfD0gKDB4ODAgPj4+IGopO1xuICAgICAgICAgIG91dC5wdXNoKHRoaXMuZGF0YVs4ICogaSArIGpdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb3V0O1xuICB9XG5cbiAgd3JpdGUoKTogTW9kdWxlW10ge1xuICAgIGNvbnN0IGEgPSB0aGlzLnJvbS5hc3NlbWJsZXIoKTtcbiAgICBjb25zdCBsYWJlbCA9IGBPYmplY3RfJHt0aGlzLmlkLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpfWA7XG4gICAgYS5zZWdtZW50KCcwZCcpO1xuICAgIGEucmVsb2MoKTtcbiAgICBhLmxhYmVsKGxhYmVsKTtcbiAgICBhLmJ5dGUoLi4udGhpcy5zZXJpYWxpemUoKSk7XG4gICAgYS5vcmcoMHhhYzAwICsgKHRoaXMuaWQgPDwgMSkpO1xuICAgIGEud29yZCh7b3A6ICdzeW0nLCBzeW06IGxhYmVsfSk7XG4gICAgcmV0dXJuIFthLm1vZHVsZSgpXTtcbiAgfVxuXG4gIGdldChhZGRyOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmRhdGFbKGFkZHIgLSAweDMwMCkgPj4+IDVdO1xuICB9XG5cbiAgcGFyZW50cygpOiBPYmplY3REYXRhW10ge1xuICAgIC8vIElmIHRoaXMgaXMgYSBwcm9qZWN0aWxlIHRoYXQgaXMgdGhlIHBhcmVudCBvZiBzb21lIG1vbnN0ZXIsXG4gICAgLy8gcmV0dXJuIGFuIGFycmF5IG9mIHBhcmVudHMgdGhhdCBzcGF3bmVkIGl0LlxuICAgIHJldHVybiBbXTtcbiAgICAvLyByZXR1cm4gdGhpcy5yb20ubW9uc3RlcnMuZmlsdGVyKFxuICAgIC8vICAgICAobTogT2JqZWN0RGF0YSkgPT4gbS5jaGlsZCAmJlxuICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yb20uYWRIb2NTcGF3bnNbbS5jaGlsZF0ub2JqZWN0SWQgPT09IHRoaXMuaWQpO1xuICB9XG5cbiAgbG9jYXRpb25zKCk6IExvY2F0aW9uW10ge1xuICAgIC8vIFRPRE8gLSBoYW5kbGUgbm9uLW1vbnN0ZXIgTlBDcy5cbiAgICByZXR1cm4gdGhpcy5yb20ubG9jYXRpb25zLmZpbHRlcigobDogTG9jYXRpb24pID0+XG4gICAgICAgIGwudXNlZCAmJiBsLnNwYXducy5zb21lKHNwYXduID0+XG4gICAgICAgICAgICBzcGF3bi5pc01vbnN0ZXIoKSAmJiBzcGF3bi5tb25zdGVySWQgPT09IHRoaXMuaWQpKTtcbiAgfVxuXG4gIHBhbGV0dGVzKGluY2x1ZGVDaGlsZHJlbiA9IGZhbHNlKTogbnVtYmVyW10ge1xuICAgIC8vIE5PVEU6IHRoaXMgZ2V0cyB0aGUgd3JvbmcgcmVzdWx0IGZvciBpY2Uvc2FuZCB6b21iaWVzIGFuZCBibG9icy5cbiAgICAvLyAgLSBtYXkganVzdCBuZWVkIHRvIGd1ZXNzL2Fzc3VtZSBhbmQgZXhwZXJpbWVudD9cbiAgICAvLyAgLSB6b21iaWVzIChhY3Rpb24gMHgyMikgbG9vayBsaWtlIHNob3VsZCBqdXN0IGJlIDNcbiAgICAvLyAgLSBsYXZhbWVuL2Jsb2JzIChhY3Rpb24gMHgyOSkgYXJlIDJcbiAgICAvLyAgLSB3cmFpdGggc2hhZG93cyAoYWN0aW9uIDB4MjYpIGFyZSAzXG4gICAgaWYgKHRoaXMuYWN0aW9uID09PSAweDIyKSByZXR1cm4gWzNdOyAvLyB6b21iaWVcbiAgICBsZXQgbWV0YXNwcml0ZUlkID0gdGhpcy5kYXRhWzBdO1xuICAgIGlmICh0aGlzLmFjdGlvbiA9PT0gMHgyYSkgbWV0YXNwcml0ZUlkID0gdGhpcy5kYXRhWzMxXSB8IDE7XG4gICAgaWYgKHRoaXMuYWN0aW9uID09PSAweDI5KSBtZXRhc3ByaXRlSWQgPSAweDZiOyAvLyBibG9iXG4gICAgaWYgKHRoaXMuYWN0aW9uID09PSAweDI2KSBtZXRhc3ByaXRlSWQgPSAweDljO1xuXG4gICAgY29uc3QgbXMgPSB0aGlzLnJvbS5tZXRhc3ByaXRlc1ttZXRhc3ByaXRlSWRdO1xuICAgIGNvbnN0IGNoaWxkTXMgPVxuICAgICAgICBpbmNsdWRlQ2hpbGRyZW4gJiYgdGhpcy5jaGlsZCA/XG4gICAgICAgICAgICB0aGlzLnJvbS5tZXRhc3ByaXRlc1tcbiAgICAgICAgICAgICAgICB0aGlzLnJvbS5vYmplY3RzW1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJvbS5hZEhvY1NwYXduc1t0aGlzLmNoaWxkXS5vYmplY3RJZF0uZGF0YVswXV0gOlxuICAgICAgICAgICAgbnVsbDtcbiAgICBjb25zdCBzID0gbmV3IFNldChbLi4ubXMucGFsZXR0ZXMoKSwgLi4uKGNoaWxkTXMgPyBjaGlsZE1zLnBhbGV0dGVzKCkgOiBbXSldKTtcbiAgICByZXR1cm4gWy4uLnNdO1xuICB9XG5cbiAgLy8gMCBmb3Igd2luZCwgMSBmb3IgZmlyZSwgMiBmb3Igd2F0ZXIsIDMgZm9yIHRodW5kZXJcbiAgaXNWdWxuZXJhYmxlKGVsZW1lbnQ6IG51bWJlcikge1xuICAgIHJldHVybiAhKHRoaXMuZWxlbWVudHMgJiAoMSA8PCBlbGVtZW50KSk7XG4gIH1cblxuICBpc1NoYWRvdygpIHtcbiAgICAvLyBOT1RFOiBpbnRlcm5hbGx5IHRoZSBnYW1lIGNoZWNrcyB0aGF0IHRoZSBtZXRhc3ByaXRlXG4gICAgLy8gaXMgJGE3IChzZWUgJDM1MGYzKSwgYnV0IHdlJ2xsIGp1c3QgaGFyZGNvZGUuXG4gICAgcmV0dXJuIHRoaXMuaWQgPT09IDB4N2IgfHwgdGhpcy5pZCA9PT0gMHg4YztcbiAgfVxuXG4gIGdldCBtZXRhc3ByaXRlKCk6IG51bWJlciB7IHJldHVybiBNRVRBU1BSSVRFLmdldCh0aGlzLmRhdGEpOyB9XG4gIHNldCBtZXRhc3ByaXRlKHg6IG51bWJlcikgeyBNRVRBU1BSSVRFLnNldCh0aGlzLmRhdGEsIHgpOyB9XG5cbiAgZ2V0IHNwZWVkKCk6IG51bWJlciB7IHJldHVybiBTUEVFRC5nZXQodGhpcy5kYXRhKTsgfVxuICBzZXQgc3BlZWQoeDogbnVtYmVyKSB7IFNQRUVELnNldCh0aGlzLmRhdGEsIHgpOyB9XG5cbiAgZ2V0IGNvbGxpc2lvblBsYW5lKCk6IG51bWJlciB7IHJldHVybiBDT0xMSVNJT05fUExBTkUuZ2V0KHRoaXMuZGF0YSk7IH1cbiAgc2V0IGNvbGxpc2lvblBsYW5lKHg6IG51bWJlcikgeyBDT0xMSVNJT05fUExBTkUuc2V0KHRoaXMuZGF0YSwgeCk7IH1cblxuICBnZXQgaGl0Ym94KCk6IG51bWJlciB7IHJldHVybiBISVRCT1guZ2V0KHRoaXMuZGF0YSk7IH1cbiAgc2V0IGhpdGJveCh4OiBudW1iZXIpIHsgSElUQk9YLnNldCh0aGlzLmRhdGEsIHgpOyB9XG5cbiAgZ2V0IGhwKCk6IG51bWJlciB7IHJldHVybiBIUC5nZXQodGhpcy5kYXRhKTsgfVxuICBzZXQgaHAoeDogbnVtYmVyKSB7IEhQLnNldCh0aGlzLmRhdGEsIHgpOyB9XG5cbiAgZ2V0IGF0aygpOiBudW1iZXIgeyByZXR1cm4gQVRLLmdldCh0aGlzLmRhdGEpOyB9XG4gIHNldCBhdGsoeDogbnVtYmVyKSB7IEFUSy5zZXQodGhpcy5kYXRhLCB4KTsgfVxuXG4gIGdldCBkZWYoKTogbnVtYmVyIHsgcmV0dXJuIERFRi5nZXQodGhpcy5kYXRhKTsgfVxuICBzZXQgZGVmKHg6IG51bWJlcikgeyBERUYuc2V0KHRoaXMuZGF0YSwgeCk7IH1cblxuICBnZXQgbGV2ZWwoKTogbnVtYmVyIHsgcmV0dXJuIExFVkVMLmdldCh0aGlzLmRhdGEpOyB9XG4gIHNldCBsZXZlbCh4OiBudW1iZXIpIHsgTEVWRUwuc2V0KHRoaXMuZGF0YSwgeCk7IH1cblxuICBnZXQgcG9pc29uKCk6IGJvb2xlYW4geyByZXR1cm4gISFQT0lTT04uZ2V0KHRoaXMuZGF0YSk7IH1cbiAgc2V0IHBvaXNvbih4OiBib29sZWFuKSB7IFBPSVNPTi5zZXQodGhpcy5kYXRhLCB4ID8gMSA6IDApOyB9XG5cbiAgZ2V0IGNoaWxkKCk6IG51bWJlciB7IHJldHVybiBDSElMRC5nZXQodGhpcy5kYXRhKTsgfVxuICBzZXQgY2hpbGQoeDogbnVtYmVyKSB7IENISUxELnNldCh0aGlzLmRhdGEsIHgpOyB9XG5cbiAgZ2V0IHRlcnJhaW5TdXNjZXB0aWJpbGl0eSgpOiBudW1iZXIgeyByZXR1cm4gVEVSUkFJTl9TVVNDRVBUSUJJTElUWS5nZXQodGhpcy5kYXRhKTsgfVxuICBzZXQgdGVycmFpblN1c2NlcHRpYmlsaXR5KHg6IG51bWJlcikgeyBURVJSQUlOX1NVU0NFUFRJQklMSVRZLnNldCh0aGlzLmRhdGEsIHgpOyB9XG5cbiAgZ2V0IGltbW9iaWxlKCk6IGJvb2xlYW4geyByZXR1cm4gISFJTU1PQklMRS5nZXQodGhpcy5kYXRhKTsgfVxuICBzZXQgaW1tb2JpbGUoeDogYm9vbGVhbikgeyBJTU1PQklMRS5zZXQodGhpcy5kYXRhLCB4ID8gMSA6IDApOyB9XG5cbiAgZ2V0IGFjdGlvbigpOiBudW1iZXIgeyByZXR1cm4gQUNUSU9OLmdldCh0aGlzLmRhdGEpOyB9XG4gIHNldCBhY3Rpb24oeDogbnVtYmVyKSB7IEFDVElPTi5zZXQodGhpcy5kYXRhLCB4KTsgfVxuXG4gIGdldCByZXBsYWNlbWVudCgpOiBudW1iZXIgeyByZXR1cm4gUkVQTEFDRU1FTlQuZ2V0KHRoaXMuZGF0YSk7IH1cbiAgc2V0IHJlcGxhY2VtZW50KHg6IG51bWJlcikgeyBSRVBMQUNFTUVOVC5zZXQodGhpcy5kYXRhLCB4KTsgfVxuXG4gIGdldCBnb2xkRHJvcCgpOiBudW1iZXIgeyByZXR1cm4gR09MRF9EUk9QLmdldCh0aGlzLmRhdGEpOyB9XG4gIHNldCBnb2xkRHJvcCh4OiBudW1iZXIpIHsgR09MRF9EUk9QLnNldCh0aGlzLmRhdGEsIHgpOyB9XG5cbiAgZ2V0IGVsZW1lbnRzKCk6IG51bWJlciB7IHJldHVybiBFTEVNRU5UUy5nZXQodGhpcy5kYXRhKTsgfVxuICBzZXQgZWxlbWVudHMoeDogbnVtYmVyKSB7IEVMRU1FTlRTLnNldCh0aGlzLmRhdGEsIHgpOyB9XG5cbiAgLyoqIFVucHJvY2Vzc2VkIGV4cGVyaWVuY2UgcmV3YXJkICgkNTIwLHgpLiAqL1xuICBnZXQgZXhwUmV3YXJkKCk6IG51bWJlciB7IHJldHVybiBFWFBfUkVXQVJELmdldCh0aGlzLmRhdGEpOyB9XG4gIHNldCBleHBSZXdhcmQoeDogbnVtYmVyKSB7IEVYUF9SRVdBUkQuc2V0KHRoaXMuZGF0YSwgeCk7IH1cblxuICBnZXQgYXR0YWNrVHlwZSgpOiBudW1iZXIgeyByZXR1cm4gQVRUQUNLX1RZUEUuZ2V0KHRoaXMuZGF0YSk7IH1cbiAgc2V0IGF0dGFja1R5cGUoeDogbnVtYmVyKSB7IEFUVEFDS19UWVBFLnNldCh0aGlzLmRhdGEsIHgpOyB9XG5cbiAgZ2V0IHN0YXR1c0VmZmVjdCgpOiBudW1iZXIgeyByZXR1cm4gU1RBVFVTX0VGRkVDVC5nZXQodGhpcy5kYXRhKTsgfVxuICBzZXQgc3RhdHVzRWZmZWN0KHg6IG51bWJlcikgeyBTVEFUVVNfRUZGRUNULnNldCh0aGlzLmRhdGEsIHgpOyB9XG59XG5cbmZ1bmN0aW9uIHByb3AoLi4uc3BlYzogW251bWJlciwgbnVtYmVyPywgbnVtYmVyP11bXSkge1xuICByZXR1cm4gbmV3IFN0YXQoLi4uc3BlYyk7XG59XG5cbmNsYXNzIFN0YXQge1xuICByZWFkb25seSBzcGVjOiBbbnVtYmVyLCBudW1iZXI/LCBudW1iZXI/XVtdO1xuXG4gIGNvbnN0cnVjdG9yKC4uLnNwZWM6IFtudW1iZXIsIG51bWJlcj8sIG51bWJlcj9dW10pIHtcbiAgICB0aGlzLnNwZWMgPSBzcGVjO1xuICB9XG5cbiAgZ2V0KGRhdGE6IG51bWJlcltdKSB7XG4gICAgbGV0IHZhbHVlID0gMDtcbiAgICBmb3IgKGNvbnN0IFthZGRyLCBtYXNrID0gMHhmZiwgc2hpZnQgPSAwXSBvZiB0aGlzLnNwZWMpIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gKGFkZHIgLSAweDMwMCkgPj4+IDU7XG4gICAgICBjb25zdCBsc2ggPSBzaGlmdCA8IDAgPyAtc2hpZnQgOiAwO1xuICAgICAgY29uc3QgcnNoID0gc2hpZnQgPCAwID8gMCA6IHNoaWZ0O1xuICAgICAgdmFsdWUgfD0gKChkYXRhW2luZGV4XSAmIG1hc2spID4+PiByc2gpIDw8IGxzaDtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgc2V0KGRhdGE6IG51bWJlcltdLCB2YWx1ZTogbnVtYmVyKSB7XG4gICAgZm9yIChjb25zdCBbYWRkciwgbWFzayA9IDB4ZmYsIHNoaWZ0ID0gMF0gb2YgdGhpcy5zcGVjKSB7XG4gICAgICBjb25zdCBpbmRleCA9IChhZGRyIC0gMHgzMDApID4+PiA1O1xuICAgICAgY29uc3QgbHNoID0gc2hpZnQgPCAwID8gLXNoaWZ0IDogMDtcbiAgICAgIGNvbnN0IHJzaCA9IHNoaWZ0IDwgMCA/IDAgOiBzaGlmdDtcbiAgICAgIGNvbnN0IHYgPSAodmFsdWUgPj4+IGxzaCkgPDwgcnNoICYgbWFzaztcbiAgICAgIGRhdGFbaW5kZXhdID0gZGF0YVtpbmRleF0gJiB+bWFzayB8IHY7XG4gICAgfVxuICB9XG59XG5cbmNvbnN0IE1FVEFTUFJJVEUgPSBwcm9wKFsweDMwMF0pO1xuY29uc3QgU1BFRUQgPSBwcm9wKFsweDM0MCwgMHhmXSk7XG5jb25zdCBDT0xMSVNJT05fUExBTkUgPSBwcm9wKFsweDNhMCwgMHhmMCwgNF0pO1xuY29uc3QgSElUQk9YID0gcHJvcChbMHg0MjAsIDB4NDAsIDJdLCBbMHgzYTAsIDB4MGZdKTtcbmNvbnN0IEhQID0gcHJvcChbMHgzYzBdKTtcbmNvbnN0IEFUSyA9IHByb3AoWzB4M2UwXSk7XG5jb25zdCBERUYgPSBwcm9wKFsweDQwMF0pO1xuY29uc3QgTEVWRUwgPSBwcm9wKFsweDQyMCwgMHgxZl0pO1xuY29uc3QgUE9JU09OID0gcHJvcChbMHg0MjAsIDB4ODAsIDddKTtcbmNvbnN0IENISUxEID0gcHJvcChbMHg0NDBdKTsgLy8gYWQtaG9jIHNwYXduIGluZGV4XG5jb25zdCBURVJSQUlOX1NVU0NFUFRJQklMSVRZID0gcHJvcChbMHg0NjBdKTtcbmNvbnN0IElNTU9CSUxFID0gcHJvcChbMHg0YTAsIDB4ODAsIDddKTsgLy8gd2lsbCBub3QgYmUga25vY2tlZCBiYWNrXG5jb25zdCBBQ1RJT04gPSBwcm9wKFsweDRhMCwgMHg3Zl0pO1xuY29uc3QgUkVQTEFDRU1FTlQgPSBwcm9wKFsweDRjMF0pO1xuY29uc3QgR09MRF9EUk9QID0gcHJvcChbMHg1MDAsIDB4ZjAsIDRdKTtcbmNvbnN0IEVMRU1FTlRTID0gcHJvcChbMHg1MDAsIDB4Zl0pO1xuY29uc3QgRVhQX1JFV0FSRCA9IHByb3AoWzB4NTIwXSk7XG5jb25zdCBBVFRBQ0tfVFlQRSA9IHByb3AoWzB4NTQwXSk7XG5jb25zdCBTVEFUVVNfRUZGRUNUID0gcHJvcChbMHg1NjAsIDB4Zl0pO1xuIl19