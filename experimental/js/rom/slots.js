import { seq } from './util.js';
class ChestSlot {
    constructor(slot, location, spawn) {
        this.slot = slot;
        this.location = location;
        this.spawn = spawn;
    }
    set(rom, item) {
        const spawn = rom.locations[this.location].spawns[this.spawn];
        spawn.id = item;
        if (item >= 0x70)
            spawn.patternBank = 1;
        if (rom.spoiler) {
            rom.spoiler.addSlot(this.slot, `Chest in ${rom.locations[this.location].name}`, item);
        }
    }
}
class HardcodedSlot {
    constructor(slot, address, name) {
        this.slot = slot;
        this.address = address;
        this.name = name;
    }
    set(rom, item) {
        rom.prg[this.address] = item;
        if (this.name && rom.spoiler)
            rom.spoiler.addSlot(this.slot, this.name || '', item);
    }
}
class BossDropSlot {
    constructor(slot, boss) {
        this.slot = slot;
        this.boss = boss;
    }
    set(rom, item) {
        if (item >= 0x70)
            throw new Error('no mimics on bosses');
        rom.bossKills[this.boss].itemDrop = item;
        if (rom.spoiler) {
            rom.spoiler.addSlot(this.slot, rom.bosses.fromBossKill(this.boss).name, item);
        }
    }
}
class ActionGrantSlot {
    constructor(slot, key) {
        this.slot = slot;
        this.key = key;
    }
    set(rom, item) {
        if (item >= 0x70)
            throw new Error('no mimics on action grants');
        rom.itemGets.actionGrants.set(this.key, item);
        if (rom.spoiler) {
            const names = {
                0x84: 'Whirlpool trigger',
                0xb2: 'Mt Sabre summit trigger',
                0xb4: '',
            };
            const name = this.key < 0x80 ?
                rom.items[this.key].messageName + ' trade-in' :
                names[this.key];
            if (name) {
                rom.spoiler.addSlot(this.slot, name, item);
            }
        }
    }
}
class PersonDataSlot {
    constructor(slot, person, index) {
        this.slot = slot;
        this.person = person;
        this.index = index;
    }
    set(rom, item) {
        if (item >= 0x70)
            throw new Error(`no mimics on people`);
        rom.npcs[this.person].data[this.index] = item;
        if (rom.spoiler) {
            const npc = rom.npcs[this.person];
            let name = npc && npc.name;
            if (npc && npc.itemNames) {
                const itemName = npc.itemNames[this.index];
                name = itemName ? name + ' ' + itemName : undefined;
            }
            rom.spoiler.addSlot(this.slot, name || '', item);
        }
    }
}
class Slots {
    constructor(rom) {
        this.rom = rom;
        const slots = seq(0x80, () => []);
        function addSlot(slot) {
            slots[slot.slot].push(slot);
        }
        for (const loc of rom.locations) {
            if (!loc.used)
                continue;
            for (let i = 0; i < loc.spawns.length; i++) {
                const spawn = loc.spawns[i];
                if (spawn.isChest())
                    addSlot(new ChestSlot(spawn.id, loc.id, i));
            }
        }
        for (const npc of rom.npcs) {
            if (!npc.used || !npc.hasDialog)
                continue;
            for (const ds of npc.localDialogs.values()) {
                for (const d of ds) {
                    switch (d.message.action) {
                        case 0x03:
                        case 0x0a:
                            addSlot(new PersonDataSlot(npc.data[0], npc.id, 0));
                            break;
                        case 0x11:
                            addSlot(new PersonDataSlot(npc.data[1], npc.id, 1));
                            break;
                        case 0x09:
                            if (npc.data[1] < 0x80) {
                                addSlot(new PersonDataSlot(npc.data[1], npc.id, 1));
                            }
                            break;
                    }
                }
            }
        }
        for (const boss of rom.bosses) {
            if (boss.kill === 3 || boss.kill === 13)
                continue;
            if (boss.kill != null && boss.drop != null) {
                addSlot(new BossDropSlot(boss.drop, boss.kill));
            }
        }
        for (const [key, orig] of rom.itemGets.actionGrants) {
            addSlot(new ActionGrantSlot(orig, key));
        }
        for (const [addr, name] of hardcodedItems) {
            addSlot(new HardcodedSlot(this.rom.prg[addr], addr, name));
        }
        extraSlots.forEach(addSlot);
        this.slots = slots;
    }
    update(fill) {
        for (let i = 0; i < fill.length; i++) {
            if (fill[i] == null)
                continue;
            for (const slot of this.slots[i]) {
                slot.set(this.rom, fill[i]);
            }
        }
        const flags = this.rom.itemGets.map(() => []);
        for (const itemget of this.rom.itemGets) {
            const { id } = itemget;
            for (const flag of itemget.flags) {
                if (flag === -1)
                    continue;
                const target = preservedItemGetFlags.has(flag) ? id : fill[id];
                (flags[target] || []).push(flag);
            }
        }
        for (const itemget of this.rom.itemGets) {
            itemget.flags = flags[itemget.id];
        }
    }
}
const hardcodedItems = [
    [0x367f4, 'Stom fight'],
    [0x3d18f, 'Slimed Kensu'],
    [0x3d1f9, 'Asina'],
    [0x3d2af, 'Stoned Akahana'],
    [0x3d337, 'Rage'],
];
const extraSlots = [
    new PersonDataSlot(0x36, 0x63, 1),
];
export function update(rom, fill) {
    new Slots(rom).update(fill);
}
const preservedItemGetFlags = new Set([
    0x024,
    0x08b,
    0x2f4,
    0x2f5,
    0x2f6,
    0x2f7,
    0x2f8,
    0x2f9,
    0x2fa,
    0x2fb,
    0x2fc,
    0x2fd,
    0x2fe,
    0x2ff,
]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xvdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvcm9tL3Nsb3RzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxHQUFHLEVBQUMsTUFBTSxXQUFXLENBQUM7QUFXOUIsTUFBTSxTQUFTO0lBQ2IsWUFBcUIsSUFBWSxFQUFXLFFBQWdCLEVBQVcsS0FBYTtRQUEvRCxTQUFJLEdBQUosSUFBSSxDQUFRO1FBQVcsYUFBUSxHQUFSLFFBQVEsQ0FBUTtRQUFXLFVBQUssR0FBTCxLQUFLLENBQVE7SUFBRyxDQUFDO0lBRXhGLEdBQUcsQ0FBQyxHQUFRLEVBQUUsSUFBWTtRQUN4QixNQUFNLEtBQUssR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzlELEtBQUssQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLElBQUksSUFBSSxJQUFJLElBQUk7WUFBRSxLQUFLLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztRQUV4QyxJQUFJLEdBQUcsQ0FBQyxPQUFPLEVBQUU7WUFDZixHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFlBQVksR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDdkY7SUFDSCxDQUFDO0NBQ0Y7QUFFRCxNQUFNLGFBQWE7SUFDakIsWUFBcUIsSUFBWSxFQUFXLE9BQWUsRUFBVyxJQUFhO1FBQTlELFNBQUksR0FBSixJQUFJLENBQVE7UUFBVyxZQUFPLEdBQVAsT0FBTyxDQUFRO1FBQVcsU0FBSSxHQUFKLElBQUksQ0FBUztJQUFHLENBQUM7SUFFdkYsR0FBRyxDQUFDLEdBQVEsRUFBRSxJQUFZO1FBQ3hCLEdBQUcsQ0FBQyxHQUFHLENB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QUVGLE1BQU0sVUFBVSxNQUFNLENBQUMsR0FBUSxFQUFFLElBQWM7SUFDN0MsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlCLENBQUM7QUFTRCxNQUFNLHFCQUFxQixHQUFHLElBQUksR0FBRyxDQUFDO0lBRXBDLEtBQUs7SUFHTCxLQUFLO0lBR0wsS0FBSztJQUNMLEtBQUs7SUFDTCxLQUFLO0lBQ0wsS0FBSztJQUNMLEtBQUs7SUFDTCxLQUFLO0lBQ0wsS0FBSztJQUNMLEtBQUs7SUFDTCxLQUFLO0lBQ0wsS0FBSztJQUNMLEtBQUs7SUFDTCxLQUFLO0NBQ04sQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtzZXF9IGZyb20gJy4vdXRpbC5qcyc7XG5pbXBvcnQge1JvbX0gZnJvbSAnLi4vcm9tLmpzJztcblxuaW50ZXJmYWNlIFNsb3Qge1xuICByZWFkb25seSBzbG90OiBudW1iZXI7XG4gIHNldChyb206IFJvbSwgaXRlbTogbnVtYmVyKTogdm9pZDtcbn1cblxuLy8gVE9ETyAtIGNvbnNpZGVyIGEgZnVuY3Rpb24gaW50ZXJmYWNlIGluc3RlYWQgb2YgYSBjbGFzcz9cbi8vICAgICAgLSBhcmUgd2UgZ2V0dGluZyBiZW5lZml0IGZyb20gaW5zcGVjdGlvbiBhdCBhbGw/XG5cbmNsYXNzIENoZXN0U2xvdCBpbXBsZW1lbnRzIFNsb3Qge1xuICBjb25zdHJ1Y3RvcihyZWFkb25seSBzbG90OiBudW1iZXIsIHJlYWRvbmx5IGxvY2F0aW9uOiBudW1iZXIsIHJlYWRvbmx5IHNwYXduOiBudW1iZXIpIHt9XG5cbiAgc2V0KHJvbTogUm9tLCBpdGVtOiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCBzcGF3biA9IHJvbS5sb2NhdGlvbnNbdGhpcy5sb2NhdGlvbl0uc3Bhd25zW3RoaXMuc3Bhd25dO1xuICAgIHNwYXduLmlkID0gaXRlbTtcbiAgICBpZiAoaXRlbSA+PSAweDcwKSBzcGF3bi5wYXR0ZXJuQmFuayA9IDE7IC8vIG1pbWljcyBhbHdheXMgdXNlIHBhdHRlcm4gYmFuayAxXG5cbiAgICBpZiAocm9tLnNwb2lsZXIpIHtcbiAgICAgIHJvbS5zcG9pbGVyLmFkZFNsb3QodGhpcy5zbG90LCBgQ2hlc3QgaW4gJHtyb20ubG9jYXRpb25zW3RoaXMubG9jYXRpb25dLm5hbWV9YCwgaXRlbSk7XG4gICAgfVxuICB9XG59XG5cbmNsYXNzIEhhcmRjb2RlZFNsb3QgaW1wbGVtZW50cyBTbG90IHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgc2xvdDogbnVtYmVyLCByZWFkb25seSBhZGRyZXNzOiBudW1iZXIsIHJlYWRvbmx5IG5hbWU/OiBzdHJpbmcpIHt9XG5cbiAgc2V0KHJvbTogUm9tLCBpdGVtOiBudW1iZXIpOiB2b2lkIHtcbiAgICByb20ucHJnW3RoaXMuYWRkcmVzc10gPSBpdGVtO1xuXG4gICAgaWYgKHRoaXMubmFtZSAmJiByb20uc3BvaWxlcikgcm9tLnNwb2lsZXIuYWRkU2xvdCh0aGlzLnNsb3QsIHRoaXMubmFtZSB8fCAnJywgaXRlbSk7XG4gIH1cbn1cblxuY2xhc3MgQm9zc0Ryb3BTbG90IGltcGxlbWVudHMgU2xvdCB7XG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IHNsb3Q6IG51bWJlciwgcmVhZG9ubHkgYm9zczogbnVtYmVyKSB7fVxuXG4gIHNldChyb206IFJvbSwgaXRlbTogbnVtYmVyKTogdm9pZCB7XG4gICAgLy9yb20uYm9zc2VzLmZyb21Cb3NzS2lsbCh0aGlzLmJvc3MpLmRyb3AgPSBpdGVtO1xuICAgIC8vY29uc3QgYWRkciA9IHJlYWRMaXR0bGVFbmRpYW4ocm9tLnByZywgMHgxZjk2YiArIDIgKiB0aGlzLmJvc3MpICsgMHgxNDAwMDtcbiAgICBpZiAoaXRlbSA+PSAweDcwKSB0aHJvdyBuZXcgRXJyb3IoJ25vIG1pbWljcyBvbiBib3NzZXMnKTtcbiAgICByb20uYm9zc0tpbGxzW3RoaXMuYm9zc10uaXRlbURyb3AgPSBpdGVtO1xuICAgIC8vcm9tLnByZ1thZGRyICsgNF0gPSBpdGVtO1xuXG4gICAgaWYgKHJvbS5zcG9pbGVyKSB7XG4gICAgICByb20uc3BvaWxlci5hZGRTbG90KHRoaXMuc2xvdCwgcm9tLmJvc3Nlcy5mcm9tQm9zc0tpbGwodGhpcy5ib3NzKSEubmFtZSwgaXRlbSk7XG4gICAgfVxuICB9XG59XG5cbmNsYXNzIEFjdGlvbkdyYW50U2xvdCBpbXBsZW1lbnRzIFNsb3Qge1xuICBjb25zdHJ1Y3RvcihyZWFkb25seSBzbG90OiBudW1iZXIsIHJlYWRvbmx5IGtleTogbnVtYmVyKSB7fVxuXG4gIHNldChyb206IFJvbSwgaXRlbTogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKGl0ZW0gPj0gMHg3MCkgdGhyb3cgbmV3IEVycm9yKCdubyBtaW1pY3Mgb24gYWN0aW9uIGdyYW50cycpO1xuICAgIHJvbS5pdGVtR2V0cy5hY3Rpb25HcmFudHMuc2V0KHRoaXMua2V5LCBpdGVtKTtcblxuICAgIGlmIChyb20uc3BvaWxlcikge1xuICAgICAgY29uc3QgbmFtZXM6IFJlY29yZDxudW1iZXIsIHN0cmluZz4gPSB7XG4gICAgICAgIDB4ODQ6ICdXaGlybHBvb2wgdHJpZ2dlcicsXG4gICAgICAgIDB4YjI6ICdNdCBTYWJyZSBzdW1taXQgdHJpZ2dlcicsXG4gICAgICAgIDB4YjQ6ICcnLFxuICAgICAgfVxuICAgICAgY29uc3QgbmFtZSA9XG4gICAgICAgICAgdGhpcy5rZXkgPCAweDgwID9cbiAgICAgICAgICAgICAgcm9tLml0ZW1zW3RoaXMua2V5XS5tZXNzYWdlTmFtZSArICcgdHJhZGUtaW4nIDpcbiAgICAgICAgICAgICAgbmFtZXNbdGhpcy5rZXldO1xuICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgcm9tLnNwb2lsZXIuYWRkU2xvdCh0aGlzLnNsb3QsIG5hbWUsIGl0ZW0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5jbGFzcyBQZXJzb25EYXRhU2xvdCBpbXBsZW1lbnRzIFNsb3Qge1xuICBjb25zdHJ1Y3RvcihyZWFkb25seSBzbG90OiBudW1iZXIsIHJlYWRvbmx5IHBlcnNvbjogbnVtYmVyLCByZWFkb25seSBpbmRleDogbnVtYmVyKSB7fVxuXG4gIHNldChyb206IFJvbSwgaXRlbTogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKGl0ZW0gPj0gMHg3MCkgdGhyb3cgbmV3IEVycm9yKGBubyBtaW1pY3Mgb24gcGVvcGxlYCk7XG4gICAgcm9tLm5wY3NbdGhpcy5wZXJzb25dLmRhdGFbdGhpcy5pbmRleF0gPSBpdGVtO1xuXG4gICAgaWYgKHJvbS5zcG9pbGVyKSB7XG4gICAgICBjb25zdCBucGMgPSByb20ubnBjc1t0aGlzLnBlcnNvbl07XG4gICAgICBsZXQgbmFtZSA9IG5wYyAmJiBucGMubmFtZTtcbiAgICAgIGlmIChucGMgJiYgbnBjLml0ZW1OYW1lcykge1xuICAgICAgICBjb25zdCBpdGVtTmFtZSA9IG5wYy5pdGVtTmFtZXNbdGhpcy5pbmRleF07XG4gICAgICAgIG5hbWUgPSBpdGVtTmFtZSA/IG5hbWUgKyAnICcgKyBpdGVtTmFtZSA6IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIHJvbS5zcG9pbGVyLmFkZFNsb3QodGhpcy5zbG90LCBuYW1lIHx8ICcnLCBpdGVtKTtcbiAgICB9XG4gIH1cbn1cblxuLy8gLy8gTk9URTogdGhpcyBpcyBwcmV0dHkgaW5lZmZpY2llbnQsIE8obl4yKSBpbiBpdGVtZ2V0IHNsb3RzLiAgQnV0IHdlIHJ1biBpdFxuLy8gLy8gb25jZSBhbmQgaXQncyBhIGxvdCBmYXN0ZXIgdGhhbiBvdGhlciB0aGluZ3MsIHNvIGl0J3Mgbm90IGEgYmlnIGRlYWwuXG4vLyBjbGFzcyBSZXZlcnNlRmxhZ1Nsb3QgaW1wbGVtZW50cyBTbG90IHtcbi8vICAgY29uc3RydWN0b3IocmVhZG9ubHkgZmxhZzogbnVtYmVyKSB7fVxuXG4vLyAgIC8vIFRPRE8gLSAwMTMgZGVmZWF0ZWQgc2FiZXJhIHNob3VsZCBiZSBhIHJldmVyc2UgZmxhZyBzbG90IGZvciBzYWJlcmEncyBkcm9wXG4vLyAgIC8vICAgICAgLSB0aGVuIHdlIGNhbiByZW1vdmUgYWxsIHRoZSBleHRyYSBzZXRzXG4vLyAgIHNldChyb206IFJvbSwgaXRlbTogbnVtYmVyKTogdm9pZCB7XG4vLyAgICAgZm9yIChjb25zdCBpdGVtZ2V0IG9mIHJvbS5pdGVtR2V0cykge1xuLy8gICAgICAgY29uc3QgaW5kZXggPSBpdGVtZ2V0LmZsYWdzLmluZGV4T2YodGhpcy5mbGFnKTtcbi8vICAgICAgIGlmIChpdGVtcy5oYXMoaXRlbWdldC5pZCkgJiYgaW5kZXggPCAwKSBpdGVtZ2V0LmZsYWdzLnB1c2godGhpcy5mbGFnKTtcbi8vICAgICAgIGlmICghaXRlbXMuaGFzKGl0ZW1nZXQuaWQpICYmIGluZGV4ID49IDApIGl0ZW1nZXQuZmxhZ3Muc3BsaWNlKGluZGV4LCAxKTtcbi8vICAgICB9XG4vLyAgIH1cbi8vIH1cblxuXG4vLyBNYXBzIGZyb20gc2xvdCB0byBpdGVtIGFjdHVhbGx5IGluIHRoZSBzbG90LlxuLy8gTWFuYWdlcyBhbGwgdGhlIG5lY2Vzc2FyeSB1cGRhdGVzIGZvciByZWFycmFuZ2luZyBpdGVtcy5cbmNsYXNzIFNsb3RzIHtcblxuICBwcml2YXRlIHNsb3RzOiBSZWFkb25seUFycmF5PFJlYWRvbmx5QXJyYXk8U2xvdD4+O1xuXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IHJvbTogUm9tKSB7XG5cbiAgICAvLyBUT0RPIC0gdGhpcyBuZWVkcyB0byBtb3ZlIHRvIEFGVEVSIHdlJ3ZlIGRvbmUgc29tZSBpbml0aWFsIGZpeHVwLi4uIVxuICAgIC8vIE1heWJlIHdlIHJlYWxseSBkbyBuZWVkIHRvIG1ha2UgaXQgc2VwYXJhdGUgZnJvbSB0aGUgcm9tP1xuXG4gICAgY29uc3Qgc2xvdHM6IFNsb3RbXVtdID0gc2VxKDB4ODAsICgpID0+IFtdKTtcbiAgICBmdW5jdGlvbiBhZGRTbG90KHNsb3Q6IFNsb3QpOiB2b2lkIHtcbiAgICAgIHNsb3RzW3Nsb3Quc2xvdF0ucHVzaChzbG90KTtcbiAgICB9XG5cbiAgICAvLyBGaW5kIGNoZXN0c1xuICAgIGZvciAoY29uc3QgbG9jIG9mIHJvbS5sb2NhdGlvbnMpIHtcbiAgICAgIGlmICghbG9jLnVzZWQpIGNvbnRpbnVlO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsb2Muc3Bhd25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHNwYXduID0gbG9jLnNwYXduc1tpXTtcbiAgICAgICAgaWYgKHNwYXduLmlzQ2hlc3QoKSkgYWRkU2xvdChuZXcgQ2hlc3RTbG90KHNwYXduLmlkLCBsb2MuaWQsIGkpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGaW5kIGl0ZW0gZ2l2ZXJzXG4gICAgZm9yIChjb25zdCBucGMgb2Ygcm9tLm5wY3MpIHtcbiAgICAgIGlmICghbnBjLnVzZWQgfHwgIW5wYy5oYXNEaWFsb2cpIGNvbnRpbnVlO1xuICAgICAgZm9yIChjb25zdCBkcyBvZiBucGMubG9jYWxEaWFsb2dzLnZhbHVlcygpKSB7XG4gICAgICAgIGZvciAoY29uc3QgZCBvZiBkcykge1xuICAgICAgICAgIHN3aXRjaCAoZC5tZXNzYWdlLmFjdGlvbikge1xuICAgICAgICAgIGNhc2UgMHgwMzpcbiAgICAgICAgICBjYXNlIDB4MGE6IC8vIG1vdmVkIHZlcnNpb24gb2Yga2Vuc3UgY2hlc3QgZHJvcFxuICAgICAgICAgICAgYWRkU2xvdChuZXcgUGVyc29uRGF0YVNsb3QobnBjLmRhdGFbMF0sIG5wYy5pZCwgMCkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAweDExOlxuICAgICAgICAgICAgYWRkU2xvdChuZXcgUGVyc29uRGF0YVNsb3QobnBjLmRhdGFbMV0sIG5wYy5pZCwgMSkpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAweDA5OiAvLyBvbmx5IGFkZCBzbG90IGlmIGl0J3Mgbm90IGV4cGxpY2l0bHkgZGlzYWJsZWRcbiAgICAgICAgICAgIGlmIChucGMuZGF0YVsxXSA8IDB4ODApIHtcbiAgICAgICAgICAgICAgYWRkU2xvdChuZXcgUGVyc29uRGF0YVNsb3QobnBjLmRhdGFbMV0sIG5wYy5pZCwgMSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRmluZCBib3NzIGRyb3BzXG4gICAgZm9yIChjb25zdCBib3NzIG9mIHJvbS5ib3NzZXMpIHtcbiAgICAgIGlmIChib3NzLmtpbGwgPT09IDMgfHwgYm9zcy5raWxsID09PSAxMykgY29udGludWU7IC8vIGZhbHNlIGFsYXJtc1xuICAgICAgaWYgKGJvc3Mua2lsbCAhPSBudWxsICYmIGJvc3MuZHJvcCAhPSBudWxsKSB7XG4gICAgICAgIGFkZFNsb3QobmV3IEJvc3NEcm9wU2xvdChib3NzLmRyb3AsIGJvc3Mua2lsbCkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFjdGlvbiBncmFudHNcbiAgICBmb3IgKGNvbnN0IFtrZXksIG9yaWddIG9mIHJvbS5pdGVtR2V0cy5hY3Rpb25HcmFudHMpIHtcbiAgICAgIGFkZFNsb3QobmV3IEFjdGlvbkdyYW50U2xvdChvcmlnLCBrZXkpKTtcbiAgICB9XG5cbiAgICAvLyBSZWNvcmQgaGFyZGNvZGVkIHNsb3RzXG4gICAgZm9yIChjb25zdCBbYWRkciwgbmFtZV0gb2YgaGFyZGNvZGVkSXRlbXMpIHtcbiAgICAgIGFkZFNsb3QobmV3IEhhcmRjb2RlZFNsb3QodGhpcy5yb20ucHJnW2FkZHJdLCBhZGRyLCBuYW1lKSk7XG4gICAgfVxuICAgIGV4dHJhU2xvdHMuZm9yRWFjaChhZGRTbG90KTtcblxuICAgIC8vIGNvbnNvbGUubG9nKCdzbG90cycsIHNsb3RzKTtcblxuICAgIHRoaXMuc2xvdHMgPSBzbG90cztcbiAgfVxuXG4gIC8vIE5PVEU6IHRoaXMuc2xvdHMgaXMgbm90IHJpZ2h0IC0gdGhlcmUgYXJlIG11bHRpcGxlIENoZXN0U2xvdHMgaW4gdGhlIHNhbWVcbiAgLy8gbGlzdCwgb3IgYSBDaGVzdFNsb3QgZm9yIDM0IGtleSB0byBzdHh5LCB3aGljaCBzaG91bGQgbm90IGJlLi4uP1xuICB1cGRhdGUoZmlsbDogbnVtYmVyW10pOiB2b2lkIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGwubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChmaWxsW2ldID09IG51bGwpIGNvbnRpbnVlO1xuICAgICAgZm9yIChjb25zdCBzbG90IG9mIHRoaXMuc2xvdHNbaV0pIHtcbiAgICAgICAgc2xvdC5zZXQodGhpcy5yb20sIGZpbGxbaV0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE1vdmUgYWxsIHRoZSBmbGFncy4gIEZpcnN0IHJlYWQgdGhlbS5cbiAgICBjb25zdCBmbGFnczogbnVtYmVyW11bXSA9IHRoaXMucm9tLml0ZW1HZXRzLm1hcCgoKSA9PiBbXSk7XG4gICAgZm9yIChjb25zdCBpdGVtZ2V0IG9mIHRoaXMucm9tLml0ZW1HZXRzKSB7XG4gICAgICBjb25zdCB7aWR9ID0gaXRlbWdldDtcbiAgICAgIGZvciAoY29uc3QgZmxhZyBvZiBpdGVtZ2V0LmZsYWdzKSB7XG4gICAgICAgIGlmIChmbGFnID09PSAtMSkgY29udGludWU7XG4gICAgICAgIGNvbnN0IHRhcmdldCA9IHByZXNlcnZlZEl0ZW1HZXRGbGFncy5oYXMoZmxhZykgPyBpZCA6IGZpbGxbaWRdO1xuICAgICAgICAvLyBOT1RFOiBpdCdzIHBvc3NpYmxlIHRoZSB0YXJnZXQgc2xvdCBpcyBhIG1pbWljIC0gaW4gdGhhdCBjYXNlXG4gICAgICAgIC8vIHdlJ3ZlIGFscmVhZHkgZ3VhcmFudGVlZCB0aGF0IHRoZSBmbGFnIGp1c3QgYSBjb25zdW1hYmxlIGNoZXN0XG4gICAgICAgIC8vIGZsYWcsIHNvIGl0J3Mgc2FmZSB0byBqdXN0IGRyb3AgaXQgb24gdGhlIGZsb29yLlxuICAgICAgICAoZmxhZ3NbdGFyZ2V0XSB8fCBbXSkucHVzaChmbGFnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy8gTm93IHdyaXRlIHRoZW1cbiAgICBmb3IgKGNvbnN0IGl0ZW1nZXQgb2YgdGhpcy5yb20uaXRlbUdldHMpIHtcbiAgICAgIGl0ZW1nZXQuZmxhZ3MgPSBmbGFnc1tpdGVtZ2V0LmlkXTtcbiAgICB9XG4gIH1cbn1cblxuXG5jb25zdCBoYXJkY29kZWRJdGVtczogUmVhZG9ubHlBcnJheTxyZWFkb25seSBbbnVtYmVyLCBzdHJpbmc/XT4gPSBbXG4gIFsweDM2N2Y0LCAnU3RvbSBmaWdodCddLFxuICBbMHgzZDE4ZiwgJ1NsaW1lZCBLZW5zdSddLFxuICBbMHgzZDFmOSwgJ0FzaW5hJ10sXG4gIFsweDNkMmFmLCAnU3RvbmVkIEFrYWhhbmEnXSxcbiAgLy9bMHgzZDMwZSwgJ0xpZ2h0aG91c2UgS2Vuc3UnXSxcbiAgWzB4M2QzMzcsICdSYWdlJ10sXG4gIC8vWzB4M2Q2NTUsICdNdCBTYWJyZSBzdW1taXQgdHJpZ2dlciddLCAvLyBwYXJhbHlzaXNcbiAgLy9bMHgzZDZkNiwgJ1doaXJscG9vbCB0cmlnZ2VyJ10sXG4gIC8vWzB4M2Q2ZDgsICdTd2FuIEtlbnN1J10sXG4gIC8vWzB4M2Q2ZGEsICdBcnlsbGlzJ10sXG4gIC8vWzB4M2Q2ZGNdLCAvLyByZWZyZXNoIGZyb20gdHJpZ2dlclxuICAvL1sweDNkNmRlLCAnRml4ZWQgc3RhdHVlJ10sXG5cbiAgLy8gVE9ETyAtIHRyYWRlLWlucyBhcmUgc3RpbGwgYnJva2VuISEhIVxuXG4gIC8vWzB4M2Q3ZmUsICdBa2FoYW5hIHN0YXR1ZSB0cmFkZS1pbiddLFxuICAvL1sweDNlM2EyXSwgLy8gaW52aXNpYmxlIGZsYWcgZm9yIHN0YXR1ZSBvZiBvbnl4XG4gIC8vWzB4M2UzYTZdLCAvLyBpbnZpc2libGUgZmxhZyBmb3Iga2lyaXNhIHBsYW50XG4gIC8vWzB4M2UzYWFdLCAvLyBpbnZpc2libGUgZmxhZyBmb3IgbG92ZSBwZW5kYW50XG5dO1xuXG5jb25zdCBleHRyYVNsb3RzID0gW1xuICBuZXcgUGVyc29uRGF0YVNsb3QoMHgzNiwgMHg2MywgMSksIC8vIHNoZWxsIGZsdXRlIChkb2xwaGluKVxuXTtcblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZShyb206IFJvbSwgZmlsbDogbnVtYmVyW10pOiB2b2lkIHtcbiAgbmV3IFNsb3RzKHJvbSkudXBkYXRlKGZpbGwpO1xufVxuXG5cbi8qKlxuICogQnkgZGVmYXVsdCB3aGVuIHdlIGZpbGwgYSBzbG90LCB3ZSBicmluZyB0aGUgaXRlbWdldCBmbGFncyBhbG9uZyB3aXRoLlxuICogVGhpcyBlbnN1cmVzIHRoYXQgZGlhbG9ncyB0aGF0IHRyaWdnZXIgb2ZmIG9mIGl0IGFyZW4ndCBicm9rZW4uXG4gKiBUaGUgZm9sbG93aW5nIGFyZSBub3QgbW92ZWQsIHRob3VnaCB3ZSBzaG91bGQgZml4IHRoYXQgYnkgY2hhbmdpbmcgdGhlbVxuICogaW50byB0aGUgbm9ybWFsIDJ4eCBpdGVtIGZsYWdzLlxuICovXG5jb25zdCBwcmVzZXJ2ZWRJdGVtR2V0RmxhZ3MgPSBuZXcgU2V0KFtcbiAgLy8gMHgwMGUsIC8vIHRlbGVwYXRoeSAtIHVzZWQgZm9yIHRhbGtpbmcgdG8gYW5pbWFscy9kd2FyZnNcbiAgMHgwMjQsIC8vIGdlbmVyYWxzIGRlZmVhdGVkIC0gd2lsbCBkZWFsIHdpdGggdGhpcyBsYXRlclxuICAvLyAweDAzZiwgLy8gdGVsZXBvcnQgLSB1c2VkIGZvciB0cmlnZ2VyXG4gIC8vIDB4MDVmLCAvLyBzd29yZCBvZiB0aHVuZGVyIC0gdXNlZCB0byB0cmlnZ2VyIG1hc3NhY3JlXG4gIDB4MDhiLCAvLyBzaGVsbCBmbHV0ZSAtIGNoZWNrZWQgYnkgZmlzaGVybWFuIC0tIFRPRE8gY2hhbmdlIHRvIDIzNj9cbiAgLy8gMHgwNjcsIC8vIGRlZmVhdGVkIG1hZG8gMSAoYmFsbCBvZiB0aHVuZGVyKSAtIHdhbnQgc2xvdCwgbm90IGl0ZW1cbiAgLy8gQW55IHdhcnAgcG9pbnQgZmxhZ3MgbmVlZCB0byBnZXQgcHJlc2VydmVkIChzd29yZCBvZiB0aHVuZGVyIHdhcnApXG4gIDB4MmY0LFxuICAweDJmNSxcbiAgMHgyZjYsXG4gIDB4MmY3LFxuICAweDJmOCxcbiAgMHgyZjksXG4gIDB4MmZhLFxuICAweDJmYixcbiAgMHgyZmMsXG4gIDB4MmZkLCAvLyBzaHlyb24gd2FycCBwb2ludCBmcm9tIHN3b3JkIG9mIHRodW5kZXJcbiAgMHgyZmUsXG4gIDB4MmZmLFxuXSk7XG4iXX0=