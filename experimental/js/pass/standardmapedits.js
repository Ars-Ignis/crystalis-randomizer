import { Flag, Spawn } from '../rom/locationtables.js';
import { Metalocation } from '../rom/metalocation.js';
export function standardMapEdits(rom, opts) {
    if (opts.eastCave) {
        eastCave(rom, opts.eastCave);
    }
    else if (opts.classicLimeTreeToLeaf) {
        connectLimeTreeToLeaf(rom);
    }
    addTowerExit(rom);
    reversibleSwanGate(rom);
    shrinkMado2(rom);
    removeUnusedGoaKensuExits(rom);
    adjustAbductionTrigger(rom);
}
(function (standardMapEdits) {
    function generateOptions(flags, random) {
        const options = {};
        if (flags.addEastCave()) {
            options.eastCave = {};
            const exits = ['cordel', 'lime', 'goa', 'desert'];
            let i = random.nextInt(4);
            [options.eastCave.exit1] = exits.splice(i, 1);
            options.eastCave.exit2 = random.pick(exits);
        }
        else if (flags.connectLimeTreeToLeaf()) {
            options.classicLimeTreeToLeaf = true;
        }
        return options;
    }
    standardMapEdits.generateOptions = generateOptions;
})(standardMapEdits || (standardMapEdits = {}));
function eastCave(rom, opts) {
    const { locations: { EastCave1, EastCave2, EastCave3, SealedCave1, ValleyOfWind }, metascreens: { boundaryE_cave, branchNSE, branchNWE, branchNWSE, branchNWS, branchWSE, caveEmpty, deadEndE, deadEndE_downStair, deadEndE_upStair, deadEndN_stairs, deadEndS, deadEndS_stairs, deadEndW, deadEndW_downStair, hallNE, hallNS, hallNW, hallSE, hallWS, hallWE, hallNS_entrance, hallNS_ramp, hallNS_wall, }, } = rom;
    rom.locations.allocate(EastCave1);
    rom.locations.allocate(EastCave2);
    if (opts.exit2)
        rom.locations.allocate(EastCave3);
    for (const l of [EastCave1, EastCave2, EastCave3]) {
        l.bgm = l.originalBgm = 0x17;
        l.entrances = [];
        l.exits = [];
        l.pits = [];
        l.spawns = [];
        l.flags = [];
        l.width = l.height = 1;
        l.screens = [[0x80]];
        l.tilePalettes = [0x1a, 0x1b, 0x05];
        l.originalTilePalettes = [0x1a, 0x1b, 0x05];
        l.tileset = 0x88;
        l.tileEffects = 0xb5;
        l.tilePatterns = [0x14, 0x02];
        l.spritePatterns = [...SealedCave1.spritePatterns];
        l.spritePalettes = [...SealedCave1.spritePalettes];
    }
    EastCave1.meta = new Metalocation(EastCave1.id, rom.metatilesets.cave, 5, 5);
    EastCave1.meta.set2d(0x00, [
        [deadEndE, hallWS, caveEmpty, hallSE, deadEndW],
        [caveEmpty, hallNS, hallSE, hallNW, caveEmpty],
        [hallSE, branchNWSE, branchNWS, caveEmpty, caveEmpty],
        [hallNS, hallNS_ramp, hallNE, hallWE, hallWS],
        [hallNS_entrance, hallNE, deadEndW, deadEndE_upStair, hallNW],
    ]);
    EastCave2.meta = new Metalocation(EastCave2.id, rom.metatilesets.cave, 5, 5);
    EastCave2.meta.set2d(0x00, [
        [deadEndE, hallWS, deadEndS, caveEmpty, deadEndS],
        [caveEmpty, hallNS, hallNS, caveEmpty, hallNS],
        [caveEmpty, branchNSE, branchNWE, branchWSE, hallNW],
        [caveEmpty, hallNS_ramp, caveEmpty, hallNE, hallWS],
        [deadEndE, hallNW, caveEmpty, caveEmpty, deadEndN_stairs],
    ]);
    ValleyOfWind.meta.set2d(0x33, [[boundaryE_cave]]);
    rom.tileEffects[0].effects[0xc0] = 0;
    EastCave1.meta.attach(0x43, EastCave2.meta, 0x44);
    EastCave1.meta.attach(0x40, ValleyOfWind.meta, 0x33);
    if (opts.exit1) {
        EastCave1.meta.set2d(0x04, [[deadEndW_downStair]]);
        connectEastCaveExit(EastCave1, 0x04, opts.exit1);
    }
    if (opts.exit2) {
        EastCave3.meta = new Metalocation(EastCave3.id, rom.metatilesets.cave, 3, 1);
        EastCave3.meta.set2d(0x00, [
            [deadEndS_stairs],
            [hallNS_wall],
            [hallNS_entrance],
        ]);
        EastCave3.spawns.push(Spawn.from([0x18, 0x07, 0x23, 0x00]));
        EastCave3.flags.push(Flag.of({ screen: 0x10, flag: rom.flags.alloc(0x200) }));
        EastCave2.meta.set2d(0x40, [[deadEndE_downStair]]);
        EastCave2.meta.attach(0x40, EastCave3.meta, 0x00);
        connectEastCaveExit(EastCave3, 0x20, opts.exit2);
    }
    EastCave1.spawns.push(Spawn.of({ screen: 0x21, tile: 0x87, timed: true, id: 0x2 }), Spawn.of({ screen: 0x12, tile: 0x88, timed: false, id: 0x2 }), Spawn.of({ screen: 0x13, tile: 0x89, timed: true, id: 0x2 }), Spawn.of({ screen: 0x32, tile: 0x68, timed: false, id: 0x2 }), Spawn.of({ screen: 0x41, tile: 0x88, timed: true, id: 0x2 }), Spawn.of({ screen: 0x33, tile: 0x98, timed: true, id: 0x2 }), Spawn.of({ screen: 0x03, tile: 0x88, timed: true, id: 0x2 }));
    EastCave2.spawns.push(Spawn.of({ screen: 0x01, tile: 0x88, timed: true, id: 0x2 }), Spawn.of({ screen: 0x11, tile: 0x48, timed: false, id: 0x2 }), Spawn.of({ screen: 0x12, tile: 0x77, timed: true, id: 0x2 }), Spawn.of({ screen: 0x14, tile: 0x28, timed: false, id: 0x2 }), Spawn.of({ screen: 0x23, tile: 0x85, timed: true, id: 0x2 }), Spawn.of({ screen: 0x31, tile: 0x88, timed: true, id: 0x2 }), Spawn.of({ screen: 0x33, tile: 0x8a, timed: false, id: 0x2 }), Spawn.of({ screen: 0x34, tile: 0x98, timed: true, id: 0x2 }), Spawn.of({ screen: 0x41, tile: 0x82, timed: true, id: 0x2 }), Spawn.of({ y: 0x110, x: 0x478, type: 2, id: 0x59 }), Spawn.of({ y: 0x070, x: 0x108, type: 2, id: 0x7c }));
    rom.slots.swap(0x31, 0x59);
}
function connectEastCaveExit(loc, scr, exit) {
    const { locations: { CordelPlainEast, CordelPlainWest, Desert2, GoaValley, LimeTreeValley, }, metascreens: { bendNE, bendSE, boundaryN_trees, boundaryW_cave, cornerNE, cornerNW, cornerSE, cornerSE_cave, cornerSW, } } = loc.rom;
    let dest;
    let destScr;
    switch (exit) {
        case 'lime':
            dest = LimeTreeValley;
            destScr = 0x10;
            dest.resizeScreens(0, 1, 0, 0);
            dest.meta.spliceColumns(0, 1, 2, [
                [cornerNW, boundaryN_trees],
                [boundaryW_cave, bendSE],
                [cornerSW, cornerSE],
            ]);
            break;
        case 'cordel':
            const mapEdit = [
                [boundaryW_cave, bendSE],
                [cornerSW, cornerSE],
            ];
            dest = CordelPlainEast;
            destScr = 0x55;
            dest.meta.set2d(0x55, mapEdit);
            CordelPlainWest.meta.set2d(0x55, mapEdit);
            break;
        case 'goa':
            dest = GoaValley;
            destScr = 0x11;
            dest.meta.set2d(0x01, [
                [cornerNW, cornerNE],
                [boundaryW_cave, bendNE]
            ]);
            break;
        case 'desert':
            dest = Desert2;
            destScr = 0x53;
            dest.meta.set2d(0x53, [[cornerSE_cave]]);
            break;
    }
    loc.meta.attach(scr, dest.meta, destScr);
}
function connectLimeTreeToLeaf(rom) {
    const { locations: { ValleyOfWind, LimeTreeValley }, metascreens: { exitE, exitW_southwest, overworldEmpty_alt }, } = rom;
    ValleyOfWind.meta.set2d(0x54, [[exitE]]);
    LimeTreeValley.meta.set2d(0x10, [[exitW_southwest],
        [overworldEmpty_alt]]);
    ValleyOfWind.meta.attach(0x54, LimeTreeValley.meta, 0x10);
}
function addTowerExit(rom) {
    const { TowerEntrance, Crypt_Teleporter } = rom.locations;
    Crypt_Teleporter.meta.attach(0x00, TowerEntrance.meta, 0x00, 'teleporter', 'teleporter');
}
function reversibleSwanGate(rom) {
    const { flags: { OpenedSwanGate }, locations: { SwanGate }, npcs: { SoldierGuard }, } = rom;
    SwanGate.spawns.push(Spawn.of({ xt: 0x0a, yt: 0x02, type: 1, id: 0x2d }), Spawn.of({ xt: 0x0b, yt: 0x02, type: 1, id: 0x2d }));
    SoldierGuard.localDialogs.get(SwanGate.id)[0].flags.push(OpenedSwanGate.id);
}
function shrinkMado2(rom) {
}
function removeUnusedGoaKensuExits(rom) {
    const loc = rom.locations.GoaFortress_Kensu;
    loc.exits.splice(0, loc.exits.length - 4);
    loc.meta = Metalocation.of(loc);
}
function adjustAbductionTrigger(rom) {
    rom.locations.ZebuCave.spawns.find(s => s.isTrigger()).yt += 3;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhbmRhcmRtYXBlZGl0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9wYXNzL3N0YW5kYXJkbWFwZWRpdHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsT0FBTyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUVyRCxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFjcEQsTUFBTSxVQUFVLGdCQUFnQixDQUFDLEdBQVEsRUFBRSxJQUFhO0lBQ3RELElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtRQUNqQixRQUFRLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUM5QjtTQUFNLElBQUksSUFBSSxDQUFDLHFCQUFxQixFQUFFO1FBQ3JDLHFCQUFxQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQzVCO0lBQ0QsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2xCLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNqQix5QkFBeUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMvQixzQkFBc0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUU5QixDQUFDO0FBRUQsV0FBaUIsZ0JBQWdCO0lBQy9CLFNBQWdCLGVBQWUsQ0FBQyxLQUFjLEVBQUUsTUFBYztRQUM1RCxNQUFNLE9BQU8sR0FBWSxFQUFFLENBQUM7UUFDNUIsSUFBSSxLQUFLLENBQUMsV0FBVyxFQUFFLEVBQUU7WUFDdkIsT0FBTyxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7WUFDdEIsTUFBTSxLQUFLLEdBQW1CLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDbEUsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxQixDQUFD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SUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztRQUc1RSxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25ELFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2xELG1CQUFtQixDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQ2xEO0lBR0QsU0FBUyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQ25CLEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFDLENBQUMsRUFDMUQsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUMsQ0FBQyxFQUMzRCxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBQyxDQUFDLEVBQzFELEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFDLENBQUMsRUFDM0QsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUMsQ0FBQyxFQUMxRCxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBQyxDQUFDLEVBQzFELEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FDM0QsQ0FBQztJQUNGLFNBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUNuQixLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBQyxDQUFDLEVBQzFELEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFDLENBQUMsRUFDM0QsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUMsQ0FBQyxFQUMxRCxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBQyxDQUFDLEVBQzNELEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFDLENBQUMsRUFDMUQsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUMsQ0FBQyxFQUMxRCxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBQyxDQUFDLEVBQzNELEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFDLENBQUMsRUFDMUQsS0FBSyxDQUFDLEVBQUUsQ0FBQyxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUMsQ0FBQyxFQUUxRCxLQUFLLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBQyxDQUFDLEVBRWpELEtBQUssQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FDbEQsQ0FBQztJQUNGLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztBQUk3QixDQUFDO0FBRUQsU0FBUyxtQkFBbUIsQ0FBQyxHQUFhLEVBQUUsR0FBVyxFQUFFLElBQWtCO0lBQ3pFLE1BQU0sRUFDSixTQUFTLEVBQUUsRUFDVCxlQUFlLEVBQUUsZUFBZSxFQUFFLE9B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QyxHQUFHLENBQUMsSUFBSSxHQUFHLFlBQVksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7QUFLbEMsQ0FBQztBQUVELFNBQVMsc0JBQXNCLENBQUMsR0FBUTtJQUd0QyxHQUFHLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxDQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUNsRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtGbGFnU2V0fSBmcm9tICcuLi9mbGFnc2V0LmpzJztcbmltcG9ydCB7UmFuZG9tfSBmcm9tICcuLi9yYW5kb20uanMnO1xuaW1wb3J0IHtSb219IGZyb20gJy4uL3JvbS5qcyc7XG5pbXBvcnQge0ZsYWcsIFNwYXdufSBmcm9tICcuLi9yb20vbG9jYXRpb250YWJsZXMuanMnO1xuaW1wb3J0IHtMb2NhdGlvbn0gZnJvbSAnLi4vcm9tL2xvY2F0aW9uLmpzJztcbmltcG9ydCB7TWV0YWxvY2F0aW9ufSBmcm9tICcuLi9yb20vbWV0YWxvY2F0aW9uLmpzJztcblxudHlwZSBFYXN0Q2F2ZUV4aXQgPSAnY29yZGVsJyB8ICdsaW1lJyB8ICdnb2EnIHwgJ2Rlc2VydCc7XG5cbmludGVyZmFjZSBFYXN0Q2F2ZU9wdGlvbnMge1xuICBleGl0MT86IEVhc3RDYXZlRXhpdDtcbiAgZXhpdDI/OiBFYXN0Q2F2ZUV4aXQ7XG59XG5cbmludGVyZmFjZSBPcHRpb25zIHtcbiAgZWFzdENhdmU/OiBFYXN0Q2F2ZU9wdGlvbnM7XG4gIGNsYXNzaWNMaW1lVHJlZVRvTGVhZj86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdGFuZGFyZE1hcEVkaXRzKHJvbTogUm9tLCBvcHRzOiBPcHRpb25zKSB7XG4gIGlmIChvcHRzLmVhc3RDYXZlKSB7XG4gICAgZWFzdENhdmUocm9tLCBvcHRzLmVhc3RDYXZlKTtcbiAgfSBlbHNlIGlmIChvcHRzLmNsYXNzaWNMaW1lVHJlZVRvTGVhZikge1xuICAgIGNvbm5lY3RMaW1lVHJlZVRvTGVhZihyb20pO1xuICB9XG4gIGFkZFRvd2VyRXhpdChyb20pO1xuICByZXZlcnNpYmxlU3dhbkdhdGUocm9tKTtcbiAgc2hyaW5rTWFkbzIocm9tKTtcbiAgcmVtb3ZlVW51c2VkR29hS2Vuc3VFeGl0cyhyb20pO1xuICBhZGp1c3RBYmR1Y3Rpb25UcmlnZ2VyKHJvbSk7XG4gIC8vIGNsb3NlQ2F2ZUVudHJhbmNlcyhyb20pOyAvLyBOT1RFOiBhZnRlciBvdGhlciBtYXAgZWRpdHNcbn1cblxuZXhwb3J0IG5hbWVzcGFjZSBzdGFuZGFyZE1hcEVkaXRzIHtcbiAgZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlT3B0aW9ucyhmbGFnczogRmxhZ1NldCwgcmFuZG9tOiBSYW5kb20pOiBPcHRpb25zIHtcbiAgICBjb25zdCBvcHRpb25zOiBPcHRpb25zID0ge307XG4gICAgaWYgKGZsYWdzLmFkZEVhc3RDYXZlKCkpIHtcbiAgICAgIG9wdGlvbnMuZWFzdENhdmUgPSB7fTtcbiAgICAgIGNvbnN0IGV4aXRzOiBFYXN0Q2F2ZUV4aXRbXSA9IFsnY29yZGVsJywgJ2xpbWUnLCAnZ29hJywgJ2Rlc2VydCddO1xuICAgICAgbGV0IGkgPSByYW5kb20ubmV4dEludCg0KTtcbiAgICAgIFtvcHRpb25zLmVhc3RDYXZlLmV4aXQxXSA9IGV4aXRzLnNwbGljZShpLCAxKTtcbiAgICAgIG9wdGlvbnMuZWFzdENhdmUuZXhpdDIgPSByYW5kb20ucGljayhleGl0cyk7XG4gICAgfSBlbHNlIGlmIChmbGFncy5jb25uZWN0TGltZVRyZWVUb0xlYWYoKSkge1xuICAgICAgb3B0aW9ucy5jbGFzc2ljTGltZVRyZWVUb0xlYWYgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gb3B0aW9ucztcbiAgfVxufVxuXG5mdW5jdGlvbiBlYXN0Q2F2ZShyb206IFJvbSwgb3B0czogRWFzdENhdmVPcHRpb25zKSB7XG4gIGNvbnN0IHtcbiAgICBsb2NhdGlvbnM6IHtFYXN0Q2F2ZTEsIEVhc3RDYXZlMiwgRWFzdENhdmUzLCBTZWFsZWRDYXZlMSwgVmFsbGV5T2ZXaW5kfSxcbiAgICBtZXRhc2NyZWVuczoge2JvdW5kYXJ5RV9jYXZlLFxuICAgICAgICAgICAgICAgICAgYnJhbmNoTlNFLCBicmFuY2hOV0UsIGJyYW5jaE5XU0UsIGJyYW5jaE5XUywgYnJhbmNoV1NFLFxuICAgICAgICAgICAgICAgICAgY2F2ZUVtcHR5LFxuICAgICAgICAgICAgICAgICAgZGVhZEVuZEUsIGRlYWRFbmRFX2Rvd25TdGFpciwgZGVhZEVuZEVfdXBTdGFpcixcbiAgICAgICAgICAgICAgICAgIGRlYWRFbmROX3N0YWlycywgZGVhZEVuZFMsIGRlYWRFbmRTX3N0YWlycyxcbiAgICAgICAgICAgICAgICAgIGRlYWRFbmRXLCBkZWFkRW5kV19kb3duU3RhaXIsXG4gICAgICAgICAgICAgICAgICBoYWxsTkUsIGhhbGxOUywgaGFsbE5XLCBoYWxsU0UsIGhhbGxXUywgaGFsbFdFLFxuICAgICAgICAgICAgICAgICAgaGFsbE5TX2VudHJhbmNlLCBoYWxsTlNfcmFtcCwgaGFsbE5TX3dhbGwsXG4gICAgICAgICAgICAgICAgIH0sXG4gICAgLy9mbGFnczoge0Fsd2F5c1RydWV9LFxuICB9ID0gcm9tO1xuXG4gIHJvbS5sb2NhdGlvbnMuYWxsb2NhdGUoRWFzdENhdmUxKTtcbiAgcm9tLmxvY2F0aW9ucy5hbGxvY2F0ZShFYXN0Q2F2ZTIpO1xuICBpZiAob3B0cy5leGl0Mikgcm9tLmxvY2F0aW9ucy5hbGxvY2F0ZShFYXN0Q2F2ZTMpO1xuXG4gIGZvciAoY29uc3QgbCBvZiBbRWFzdENhdmUxLCBFYXN0Q2F2ZTIsIEVhc3RDYXZlM10pIHtcbiAgICBsLmJnbSA9IGwub3JpZ2luYWxCZ20gPSAweDE3OyAvLyBtdCBzYWJyZSBjYXZlIG11c2ljP1xuICAgIGwuZW50cmFuY2VzID0gW107XG4gICAgbC5leGl0cyA9IFtdO1xuICAgIGwucGl0cyA9IFtdO1xuICAgIGwuc3Bhd25zID0gW107XG4gICAgbC5mbGFncyA9IFtdO1xuICAgIGwud2lkdGggPSBsLmhlaWdodCA9IDE7XG4gICAgbC5zY3JlZW5zID0gW1sweDgwXV07XG4gICAgbC50aWxlUGFsZXR0ZXMgPSBbMHgxYSwgMHgxYiwgMHgwNV07IC8vIHJvY2sgd2FsbFxuICAgIGwub3JpZ2luYWxUaWxlUGFsZXR0ZXMgPSBbMHgxYSwgMHgxYiwgMHgwNV07IC8vIHJvY2sgd2FsbFxuICAgIGwudGlsZXNldCA9IDB4ODg7XG4gICAgbC50aWxlRWZmZWN0cyA9IDB4YjU7XG4gICAgbC50aWxlUGF0dGVybnMgPSBbMHgxNCwgMHgwMl07XG4gICAgbC5zcHJpdGVQYXR0ZXJucyA9IFsuLi5TZWFsZWRDYXZlMS5zcHJpdGVQYXR0ZXJuc10gYXMgW251bWJlciwgbnVtYmVyXTtcbiAgICBsLnNwcml0ZVBhbGV0dGVzID0gWy4uLlNlYWxlZENhdmUxLnNwcml0ZVBhbGV0dGVzXSBhcyBbbnVtYmVyLCBudW1iZXJdO1xuICB9XG5cbiAgLy8gTk9URTogMHg5YyBjYW4gYmVjb21lIDB4OTkgaW4gdG9wIGxlZnQgb3IgMHg5NyBpbiB0b3AgcmlnaHQgb3IgYm90dG9tIG1pZGRsZSBmb3IgYSBjYXZlIGV4aXRcbiAgRWFzdENhdmUxLm1ldGEgPSBuZXcgTWV0YWxvY2F0aW9uKEVhc3RDYXZlMS5pZCwgcm9tLm1ldGF0aWxlc2V0cy5jYXZlLCA1LCA1KTtcbiAgRWFzdENhdmUxLm1ldGEuc2V0MmQoMHgwMCwgW1xuICAgIFtkZWFkRW5kRSwgICAgICAgIGhhbGxXUywgICAgICBjYXZlRW1wdHksIGhhbGxTRSwgICAgICAgICAgIGRlYWRFbmRXXSxcbiAgICBbY2F2ZUVtcHR5LCAgICAgICBoYWxsTlMsICAgICAgaGFsbFNFLCAgICBoYWxsTlcsICAgICAgICAgICBjYXZlRW1wdHldLFxuICAgIFtoYWxsU0UsICAgICAgICAgIGJyYW5jaE5XU0UsICBicmFuY2hOV1MsIGNhdmVFbXB0eSwgICAgICAgIGNhdmVFbXB0eV0sXG4gICAgW2hhbGxOUywgICAgICAgICAgaGFsbE5TX3JhbXAsIGhhbGxORSwgICAgaGFsbFdFLCAgICAgICAgICAgaGFsbFdTXSxcbiAgICBbaGFsbE5TX2VudHJhbmNlLCBoYWxsTkUsICAgICAgZGVhZEVuZFcsICBkZWFkRW5kRV91cFN0YWlyLCBoYWxsTlddLFxuICBdKTtcblxuICBFYXN0Q2F2ZTIubWV0YSA9IG5ldyBNZXRhbG9jYXRpb24oRWFzdENhdmUyLmlkLCByb20ubWV0YXRpbGVzZXRzLmNhdmUsIDUsIDUpO1xuICBFYXN0Q2F2ZTIubWV0YS5zZXQyZCgweDAwLCBbXG4gICAgW2RlYWRFbmRFLCAgaGFsbFdTLCAgICAgIGRlYWRFbmRTLCAgY2F2ZUVtcHR5LCBkZWFkRW5kU10sXG4gICAgW2NhdmVFbXB0eSwgaGFsbE5TLCAgICAgIGhhbGxOUywgICAgY2F2ZUVtcHR5LCBoYWxsTlNdLFxuICAgIFtjYXZlRW1wdHksIGJyYW5jaE5TRSwgICBicmFuY2hOV0UsIGJyYW5jaFdTRSwgaGFsbE5XXSxcbiAgICBbY2F2ZUVtcHR5LCBoYWxsTlNfcmFtcCwgY2F2ZUVtcHR5LCBoYWxsTkUsICAgIGhhbGxXU10sXG4gICAgW2RlYWRFbmRFLCAgaGFsbE5XLCAgICAgIGNhdmVFbXB0eSwgY2F2ZUVtcHR5LCBkZWFkRW5kTl9zdGFpcnNdLFxuICBdKTtcblxuICAvLyBBZGQgZW50cmFuY2UgdG8gdmFsbGV5IG9mIHdpbmRcbiAgVmFsbGV5T2ZXaW5kLm1ldGEuc2V0MmQoMHgzMywgW1tib3VuZGFyeUVfY2F2ZV1dKTtcbiAgcm9tLnRpbGVFZmZlY3RzWzBdLmVmZmVjdHNbMHhjMF0gPSAwO1xuICAvLyBUT0RPIC0gZG8gdGhpcyBvbmNlIHdlIGZpeCB0aGUgc2VhIHRpbGVzZXRcbiAgLy8gcm9tLnNjcmVlbnNbMHhjMl0udGlsZXNbMHg1YV0gPSAweDBhO1xuICAvLyByb20uc2NyZWVuc1sweGMyXS50aWxlc1sweDViXSA9IDB4MGE7XG5cbiAgLy8gQ29ubmVjdCBtYXBzXG4gIEVhc3RDYXZlMS5tZXRhLmF0dGFjaCgweDQzLCBFYXN0Q2F2ZTIubWV0YSwgMHg0NCk7XG4gIEVhc3RDYXZlMS5tZXRhLmF0dGFjaCgweDQwLCBWYWxsZXlPZldpbmQubWV0YSwgMHgzMyk7XG5cbiAgaWYgKG9wdHMuZXhpdDEpIHtcbiAgICBFYXN0Q2F2ZTEubWV0YS5zZXQyZCgweDA0LCBbW2RlYWRFbmRXX2Rvd25TdGFpcl1dKTsgLy8gZG93biBzdGFpclxuICAgIGNvbm5lY3RFYXN0Q2F2ZUV4aXQoRWFzdENhdmUxLCAweDA0LCBvcHRzLmV4aXQxKTtcbiAgfVxuXG4gIGlmIChvcHRzLmV4aXQyKSB7XG4gICAgRWFzdENhdmUzLm1ldGEgPSBuZXcgTWV0YWxvY2F0aW9uKEVhc3RDYXZlMy5pZCwgcm9tLm1ldGF0aWxlc2V0cy5jYXZlLCAzLCAxKTtcbiAgICBFYXN0Q2F2ZTMubWV0YS5zZXQyZCgweDAwLCBbXG4gICAgICBbZGVhZEVuZFNfc3RhaXJzXSxcbiAgICAgIFtoYWxsTlNfd2FsbF0sXG4gICAgICBbaGFsbE5TX2VudHJhbmNlXSxcbiAgICBdKTtcblxuICAgIC8vIEFkZCBhIHJvY2sgd2FsbCAoaWQ9MCkuXG4gICAgRWFzdENhdmUzLnNwYXducy5wdXNoKFNwYXduLmZyb20oWzB4MTgsIDB4MDcsIDB4MjMsIDB4MDBdKSk7XG4gICAgRWFzdENhdmUzLmZsYWdzLnB1c2goRmxhZy5vZih7c2NyZWVuOiAweDEwLCBmbGFnOiByb20uZmxhZ3MuYWxsb2MoMHgyMDApfSkpO1xuXG4gICAgLy8gTWFrZSB0aGUgY29ubmVjdGlvbnMuXG4gICAgRWFzdENhdmUyLm1ldGEuc2V0MmQoMHg0MCwgW1tkZWFkRW5kRV9kb3duU3RhaXJdXSk7XG4gICAgRWFzdENhdmUyLm1ldGEuYXR0YWNoKDB4NDAsIEVhc3RDYXZlMy5tZXRhLCAweDAwKTtcbiAgICBjb25uZWN0RWFzdENhdmVFeGl0KEVhc3RDYXZlMywgMHgyMCwgb3B0cy5leGl0Mik7XG4gIH1cblxuICAvLyBBZGQgbW9uc3RlcnNcbiAgRWFzdENhdmUxLnNwYXducy5wdXNoKFxuICAgIFNwYXduLm9mKHtzY3JlZW46IDB4MjEsIHRpbGU6IDB4ODcsIHRpbWVkOiB0cnVlLCBpZDogMHgyfSksXG4gICAgU3Bhd24ub2Yoe3NjcmVlbjogMHgxMiwgdGlsZTogMHg4OCwgdGltZWQ6IGZhbHNlLCBpZDogMHgyfSksXG4gICAgU3Bhd24ub2Yoe3NjcmVlbjogMHgxMywgdGlsZTogMHg4OSwgdGltZWQ6IHRydWUsIGlkOiAweDJ9KSxcbiAgICBTcGF3bi5vZih7c2NyZWVuOiAweDMyLCB0aWxlOiAweDY4LCB0aW1lZDogZmFsc2UsIGlkOiAweDJ9KSxcbiAgICBTcGF3bi5vZih7c2NyZWVuOiAweDQxLCB0aWxlOiAweDg4LCB0aW1lZDogdHJ1ZSwgaWQ6IDB4Mn0pLFxuICAgIFNwYXduLm9mKHtzY3JlZW46IDB4MzMsIHRpbGU6IDB4OTgsIHRpbWVkOiB0cnVlLCBpZDogMHgyfSksXG4gICAgU3Bhd24ub2Yoe3NjcmVlbjogMHgwMywgdGlsZTogMHg4OCwgdGltZWQ6IHRydWUsIGlkOiAweDJ9KSxcbiAgKTtcbiAgRWFzdENhdmUyLnNwYXducy5wdXNoKFxuICAgIFNwYXduLm9mKHtzY3JlZW46IDB4MDEsIHRpbGU6IDB4ODgsIHRpbWVkOiB0cnVlLCBpZDogMHgyfSksXG4gICAgU3Bhd24ub2Yoe3NjcmVlbjogMHgxMSwgdGlsZTogMHg0OCwgdGltZWQ6IGZhbHNlLCBpZDogMHgyfSksXG4gICAgU3Bhd24ub2Yoe3NjcmVlbjogMHgxMiwgdGlsZTogMHg3NywgdGltZWQ6IHRydWUsIGlkOiAweDJ9KSxcbiAgICBTcGF3bi5vZih7c2NyZWVuOiAweDE0LCB0aWxlOiAweDI4LCB0aW1lZDogZmFsc2UsIGlkOiAweDJ9KSxcbiAgICBTcGF3bi5vZih7c2NyZWVuOiAweDIzLCB0aWxlOiAweDg1LCB0aW1lZDogdHJ1ZSwgaWQ6IDB4Mn0pLFxuICAgIFNwYXduLm9mKHtzY3JlZW46IDB4MzEsIHRpbGU6IDB4ODgsIHRpbWVkOiB0cnVlLCBpZDogMHgyfSksXG4gICAgU3Bhd24ub2Yoe3NjcmVlbjogMHgzMywgdGlsZTogMHg4YSwgdGltZWQ6IGZhbHNlLCBpZDogMHgyfSksXG4gICAgU3Bhd24ub2Yoe3NjcmVlbjogMHgzNCwgdGlsZTogMHg5OCwgdGltZWQ6IHRydWUsIGlkOiAweDJ9KSxcbiAgICBTcGF3bi5vZih7c2NyZWVuOiAweDQxLCB0aWxlOiAweDgyLCB0aW1lZDogdHJ1ZSwgaWQ6IDB4Mn0pLFxuICAgIC8vIGNoZXN0OiBtZWRpY2FsIGhlcmJcbiAgICBTcGF3bi5vZih7eTogMHgxMTAsIHg6IDB4NDc4LCB0eXBlOiAyLCBpZDogMHg1OX0pLFxuICAgIC8vIGNoZXN0OiBtaW1pY1xuICAgIFNwYXduLm9mKHt5OiAweDA3MCwgeDogMHgxMDgsIHR5cGU6IDIsIGlkOiAweDdjfSksXG4gICk7XG4gIHJvbS5zbG90cy5zd2FwKDB4MzEsIDB4NTkpO1xuICAvLyBzd2FwIG91dCBhbGFybSBmbHV0ZSBmb3IgbWVkaWNhbCBoZXJiIC0gdGhpcyBtYWtlcyBpdCBhIHVuaXF1ZSBjaGVjay5cbiAgLy8gV2luZG1pbGxHdWFyZC5kYXRhWzFdID0gMHg1OTsgLy8gYWxhcm0gZmx1dGUgLT4gbWVkaWNhbCBoZXJiXG4gIC8vIFdpbmRtaWxsR3VhcmQuZGlhbG9nKExlYWZfU3R1ZGVudEhvdXNlKVswXS5jb25kaXRpb24gPSB+MHgxNTk7XG59XG5cbmZ1bmN0aW9uIGNvbm5lY3RFYXN0Q2F2ZUV4aXQobG9jOiBMb2NhdGlvbiwgc2NyOiBudW1iZXIsIGV4aXQ6IEVhc3RDYXZlRXhpdCkge1xuICBjb25zdCB7XG4gICAgbG9jYXRpb25zOiB7XG4gICAgICBDb3JkZWxQbGFpbkVhc3QsIENvcmRlbFBsYWluV2VzdCwgRGVzZXJ0MiwgR29hVmFsbGV5LCBMaW1lVHJlZVZhbGxleSxcbiAgICB9LFxuICAgIG1ldGFzY3JlZW5zOiB7XG4gICAgICBiZW5kTkUsIGJlbmRTRSxcbiAgICAgIGJvdW5kYXJ5Tl90cmVlcywgYm91bmRhcnlXX2NhdmUsXG4gICAgICBjb3JuZXJORSwgY29ybmVyTlcsIGNvcm5lclNFLCBjb3JuZXJTRV9jYXZlLCBjb3JuZXJTVyxcbiAgICB9fSA9IGxvYy5yb207XG4gIGxldCBkZXN0OiBMb2NhdGlvbjtcbiAgbGV0IGRlc3RTY3I6IG51bWJlcjtcbiAgc3dpdGNoIChleGl0KSB7XG4gICAgY2FzZSAnbGltZSc6XG4gICAgICAvLyBBZGQgZW50cmFuY2UgdG8gbGltZSB0cmVlIHZhbGxleVxuICAgICAgZGVzdCA9IExpbWVUcmVlVmFsbGV5O1xuICAgICAgZGVzdFNjciA9IDB4MTA7XG4gICAgICBkZXN0LnJlc2l6ZVNjcmVlbnMoMCwgMSwgMCwgMCk7IC8vIGFkZCBvbmUgc2NyZWVuIHRvIGxlZnQgZWRnZVxuICAgICAgZGVzdC5tZXRhLnNwbGljZUNvbHVtbnMoMCwgMSwgMiwgW1xuICAgICAgICBbY29ybmVyTlcsICAgICAgIGJvdW5kYXJ5Tl90cmVlc10sXG4gICAgICAgIFtib3VuZGFyeVdfY2F2ZSwgYmVuZFNFXSxcbiAgICAgICAgW2Nvcm5lclNXLCAgICAgICBjb3JuZXJTRV0sXG4gICAgICBdKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAnY29yZGVsJzpcbiAgICAgIGNvbnN0IG1hcEVkaXQgPSBbXG4gICAgICAgIFtib3VuZGFyeVdfY2F2ZSwgYmVuZFNFXSxcbiAgICAgICAgW2Nvcm5lclNXLCAgICAgICBjb3JuZXJTRV0sXG4gICAgICBdO1xuICAgICAgZGVzdCA9IENvcmRlbFBsYWluRWFzdDtcbiAgICAgIGRlc3RTY3IgPSAweDU1O1xuICAgICAgZGVzdC5tZXRhLnNldDJkKDB4NTUsIG1hcEVkaXQpO1xuICAgICAgLy8gQWxzbyBuZWVkIHRvIG1pcnJvciB0aGUgbWFwIGVkaXQgb24gd2VzdFxuICAgICAgQ29yZGVsUGxhaW5XZXN0Lm1ldGEuc2V0MmQoMHg1NSwgbWFwRWRpdCk7XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ2dvYSc6XG4gICAgICBkZXN0ID0gR29hVmFsbGV5O1xuICAgICAgZGVzdFNjciA9IDB4MTE7XG4gICAgICBkZXN0Lm1ldGEuc2V0MmQoMHgwMSwgW1xuICAgICAgICBbY29ybmVyTlcsICAgICAgIGNvcm5lck5FXSxcbiAgICAgICAgW2JvdW5kYXJ5V19jYXZlLCBiZW5kTkVdXSk7XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ2Rlc2VydCc6XG4gICAgICBkZXN0ID0gRGVzZXJ0MjtcbiAgICAgIGRlc3RTY3IgPSAweDUzO1xuICAgICAgZGVzdC5tZXRhLnNldDJkKDB4NTMsIFtbY29ybmVyU0VfY2F2ZV1dKTtcbiAgICAgIGJyZWFrO1xuICB9XG4gIGxvYy5tZXRhLmF0dGFjaChzY3IsIGRlc3QubWV0YSwgZGVzdFNjcik7XG59XG5cbi8vIFByb2dyYW1tYXRpY2FsbHkgYWRkIGEgaG9sZSBiZXR3ZWVuIHZhbGxleSBvZiB3aW5kIGFuZCBsaW1lIHRyZWUgdmFsbGV5XG5mdW5jdGlvbiBjb25uZWN0TGltZVRyZWVUb0xlYWYocm9tOiBSb20pIHtcbiAgY29uc3Qge1xuICAgIGxvY2F0aW9uczoge1ZhbGxleU9mV2luZCwgTGltZVRyZWVWYWxsZXl9LFxuICAgIG1ldGFzY3JlZW5zOiB7ZXhpdEUsIGV4aXRXX3NvdXRod2VzdCwgb3ZlcndvcmxkRW1wdHlfYWx0fSxcbiAgfSA9IHJvbTtcblxuICBWYWxsZXlPZldpbmQubWV0YS5zZXQyZCgweDU0LCBbW2V4aXRFXV0pO1xuICBMaW1lVHJlZVZhbGxleS5tZXRhLnNldDJkKDB4MTAsIFtbZXhpdFdfc291dGh3ZXN0XSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW292ZXJ3b3JsZEVtcHR5X2FsdF1dKTtcbiAgVmFsbGV5T2ZXaW5kLm1ldGEuYXR0YWNoKDB4NTQsIExpbWVUcmVlVmFsbGV5Lm1ldGEsIDB4MTApO1xufVxuXG5mdW5jdGlvbiBhZGRUb3dlckV4aXQocm9tOiBSb20pIHtcbiAgY29uc3Qge1Rvd2VyRW50cmFuY2UsIENyeXB0X1RlbGVwb3J0ZXJ9ID0gcm9tLmxvY2F0aW9ucztcbiAgQ3J5cHRfVGVsZXBvcnRlci5tZXRhLmF0dGFjaCgweDAwLCBUb3dlckVudHJhbmNlLm1ldGEsIDB4MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RlbGVwb3J0ZXInLCAndGVsZXBvcnRlcicpO1xufVxuXG5mdW5jdGlvbiByZXZlcnNpYmxlU3dhbkdhdGUocm9tOiBSb20pIHtcbiAgY29uc3Qge1xuICAgIGZsYWdzOiB7T3BlbmVkU3dhbkdhdGV9LFxuICAgIGxvY2F0aW9uczoge1N3YW5HYXRlfSxcbiAgICBucGNzOiB7U29sZGllckd1YXJkfSxcbiAgfSA9IHJvbTtcbiAgLy8gQWxsb3cgb3BlbmluZyBTd2FuIGZyb20gZWl0aGVyIHNpZGUgYnkgYWRkaW5nIGEgcGFpciBvZiBndWFyZHMgb24gdGhlXG4gIC8vIG9wcG9zaXRlIHNpZGUgb2YgdGhlIGdhdGUuXG4gIFN3YW5HYXRlLnNwYXducy5wdXNoKFxuICAgIC8vIE5PVEU6IFNvbGRpZXJzIG11c3QgY29tZSBpbiBwYWlycyAod2l0aCBpbmRleCBeMSBmcm9tIGVhY2ggb3RoZXIpXG4gICAgU3Bhd24ub2Yoe3h0OiAweDBhLCB5dDogMHgwMiwgdHlwZTogMSwgaWQ6IDB4MmR9KSwgLy8gbmV3IHNvbGRpZXJcbiAgICBTcGF3bi5vZih7eHQ6IDB4MGIsIHl0OiAweDAyLCB0eXBlOiAxLCBpZDogMHgyZH0pLCAvLyBuZXcgc29sZGllclxuICAgIC8vU3Bhd24ub2Yoe3h0OiAweDBlLCB5dDogMHgwYSwgdHlwZTogMiwgaWQ6IDB4YjN9KSwgLy8gbmV3IHRyaWdnZXI6IGVyYXNlIGd1YXJkc1xuICApO1xuXG4gIC8vIC8vIE5PVEU6IGp1c3QgdXNlIHRoZSBhY3R1YWwgZmxhZyBpbnN0ZWFkP1xuICAvLyAvLyBHdWFyZHMgKCQyZCkgYXQgc3dhbiBnYXRlICgkNzMpIH4gc2V0IDBlZiBhZnRlciBvcGVuaW5nIGdhdGUgPT4gY29uZGl0aW9uIGZvciBkZXNwYXduXG4gIC8vIHJvbS5ucGNzWzB4MmRdLmxvY2FsRGlhbG9ncy5nZXQoMHg3MykhWzBdLmZsYWdzLnB1c2goMHgwZWYpO1xuICAvLyAvLyBEZXNwYXduIGd1YXJkIHRyaWdnZXIgcmVxdWlyZXMgMGVmXG4gIC8vIHJvbS50cmlnZ2VyKDB4YjMpLmNvbmRpdGlvbnMucHVzaCgweDBlZik7XG4gIFNvbGRpZXJHdWFyZC5sb2NhbERpYWxvZ3MuZ2V0KFN3YW5HYXRlLmlkKSFbMF0uZmxhZ3MucHVzaChPcGVuZWRTd2FuR2F0ZS5pZCk7XG4gIC8vcm9tLnRyaWdnZXIoMHhiMykuY29uZGl0aW9ucy5wdXNoKE9wZW5lZFN3YW5HYXRlLmlkKTtcbiAgLy8gVE9ETyAtIGNhbiB3ZSBkbyBhd2F5IHdpdGggdGhlIHRyaWdnZXI/ICBKdXN0IHNwYXduIHRoZW0gb24gdGhlIHNhbWUgY29uZGl0aW9uLi4uXG59XG5cbi8qKiBNYWRvIDIncyBhcmVhIGhhcyBhIDR4NCBzZWN0aW9uIG9mIHVudXNlZCB0aWxlcyBhdCB0aGUgdG9wLiAgRGVsZXRlIHRoZW0uICovXG5mdW5jdGlvbiBzaHJpbmtNYWRvMihyb206IFJvbSkge1xuICAvLyBUT0RPIC0gaW1wbGVtZW50IHNwbGljZVJvd3NcbiAgLy8gcm9tLmxvY2F0aW9ucy5Hb2FGb3J0cmVzc19NYWRvMy5tZXRhLnNwbGljZVJvd3MoMCwgNCwgMCwgW10pO1xufVxuXG4vLyBmdW5jdGlvbiBjbG9zZUNhdmVFbnRyYW5jZXMocm9tOiBSb20pOiB2b2lkIHtcbi8vICAgLy8gRGVzdHJ1Y3R1cmUgb3V0IGEgZmV3IGxvY2F0aW9ucyBieSBuYW1lXG4vLyAgIGNvbnN0IHtcbi8vICAgICBmbGFnczoge0Fsd2F5c1RydWUsIE9wZW5lZFNlYWxlZENhdmUsIE9wZW5lZFByaXNvbn0sXG4vLyAgICAgbG9jYXRpb25zOiB7XG4vLyAgICAgICBDb3JkZWxQbGFpbkVhc3QsIENvcmRlbFBsYWluV2VzdCwgRGVzZXJ0Mixcbi8vICAgICAgIEtpcmlzYU1lYWRvdywgU2FoYXJhT3V0c2lkZUNhdmUsIFZhbGxleU9mV2luZCxcbi8vICAgICAgIFdhdGVyZmFsbFZhbGxleU5vcnRoLCBXYXRlcmZhbGxWYWxsZXlTb3V0aCxcbi8vICAgICB9LFxuLy8gICB9ID0gcm9tO1xuXG4vLyAgIC8vIC8vIFByZXZlbnQgc29mdGxvY2sgZnJvbSBleGl0aW5nIHNlYWxlZCBjYXZlIGJlZm9yZSB3aW5kbWlsbCBzdGFydGVkXG4vLyAgIC8vIFZhbGxleU9mV2luZC5lbnRyYW5jZXNbMV0ueSArPSAxNjsgLy8gdW5uZWVkZWQgYWZ0ZXIgZW50cmFuY2Ugbm9ybWFsaXphdGlvblxuXG4vLyAgIC8vIENsZWFyIHRpbGVzIDEsMiwzLDQgZm9yIGJsb2NrYWJsZSBjYXZlcyBpbiB0aWxlc2V0cyA5MCwgOTQsIGFuZCA5Y1xuXG4vLyAgIC8vIC8vIE5PVEU6IGZsYWcgMmYwIGlzIEFMV0FZUyBzZXQgLSB1c2UgaXQgYXMgYSBiYXNlbGluZS5cbi8vICAgLy8gY29uc3QgZmxhZ3NUb0NsZWFyOiBbTG9jYXRpb24sIG51bWJlcl1bXSA9IFtcbi8vICAgLy8gICBbVmFsbGV5T2ZXaW5kLCAweDMwXSwgLy8gdmFsbGV5IG9mIHdpbmQsIHplYnUncyBjYXZlXG4vLyAgIC8vICAgLy9bQ29yZGVsUGxhaW5XZXN0LCAweDMwXSwgLy8gY29yZGVsIHdlc3QsIHZhbXBpcmUgY2F2ZVxuLy8gICAvLyAgIC8vW0NvcmRlbFBsYWluRWFzdCwgMHgzMF0sIC8vIGNvcmRlbCBlYXN0LCB2YW1waXJlIGNhdmVcbi8vICAgLy8gICAvL1tXYXRlcmZhbGxWYWxsZXlOb3J0aCwgMHgwMF0sIC8vIHdhdGVyZmFsbCBub3J0aCwgcHJpc29uIGNhdmVcbi8vICAgLy8gICBbV2F0ZXJmYWxsVmFsbGV5Tm9ydGgsIDB4MTRdLCAvLyB3YXRlcmZhbGwgbm9ydGgsIGZvZyBsYW1wXG4vLyAgIC8vICAgW1dhdGVyZmFsbFZhbGxleVNvdXRoLCAweDc0XSwgLy8gd2F0ZXJmYWxsIHNvdXRoLCBraXJpc2Fcbi8vICAgLy8gICBbS2lyaXNhTWVhZG93LCAweDEwXSwgLy8ga2lyaXNhIG1lYWRvd1xuLy8gICAvLyAgIFtTYWhhcmFPdXRzaWRlQ2F2ZSwgMHgwMF0sIC8vIGNhdmUgdG8gZGVzZXJ0XG4vLyAgIC8vICAgW0Rlc2VydDIsIDB4NDFdLFxuLy8gICAvLyBdO1xuLy8gICAvLyBmdW5jdGlvbiBwdXNoRmxhZyhsb2M6IExvY2F0aW9uLCBzY3JlZW46IG51bWJlciwgZmxhZzogZmxhZ3MuRmxhZykge1xuLy8gICAvLyAgIGxvYy5mbGFncy5wdXNoKEZsYWcub2Yoe3NjcmVlbiwgZmxhZzogZmxhZy5pZH0pKTtcbi8vICAgLy8gfVxuXG4vLyAgIC8vIGZvciAoY29uc3QgW2xvYywgc2NyZWVuXSBvZiBmbGFnc1RvQ2xlYXIpIHtcbi8vICAgLy8gICBwdXNoRmxhZyhsb2MsIHNjcmVlbiwgQWx3YXlzVHJ1ZSk7XG4vLyAgIC8vIH1cblxuLy8gICAvLyBOT1RFIC0gdGhpcyB1c2VkIHRvIGJlIGNvbmZpZ3VyYWJsZS4uLlxuXG4vLyAgIC8vIGZ1bmN0aW9uIHJlcGxhY2VGbGFnKGxvYzogTG9jYXRpb24sIHl4OiBudW1iZXIsIGZsYWc6IG51bWJlcik6IHZvaWQge1xuLy8gICAvLyAgIGZvciAoY29uc3QgZiBvZiBsb2MuZmxhZ3MpIHtcbi8vICAgLy8gICAgIGlmIChmLnl4ID09PSB5eCkge1xuLy8gICAvLyAgICAgICBmLmZsYWcgPSBmbGFnO1xuLy8gICAvLyAgICAgICByZXR1cm47XG4vLyAgIC8vICAgICB9XG4vLyAgIC8vICAgfVxuLy8gICAvLyAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgZmxhZyB0byByZXBsYWNlIGF0ICR7bG9jfToke3l4fWApO1xuLy8gICAvLyB9O1xuXG4vLyAgIC8vIE5PVEU6IHdlIGNvdWxkIGFsc28gY2xvc2UgaXQgb2ZmIHVudGlsIGJvc3Mga2lsbGVkLi4uP1xuLy8gICAvLyAgLSBjb25zdCB2YW1waXJlRmxhZyA9IH5yb20ubnBjU3Bhd25zWzB4YzBdLmNvbmRpdGlvbnNbMHgwYV1bMF07XG4vLyAgIC8vICAtPiBrZWxiZXNxdWUgZm9yIHRoZSBvdGhlciBvbmUuXG4vLyAgIHB1c2hGbGFnKENvcmRlbFBsYWluV2VzdCwgMHgzMCwgT3BlbmVkU2VhbGVkQ2F2ZSk7XG4vLyAgIHB1c2hGbGFnKENvcmRlbFBsYWluRWFzdCwgMHgzMCwgT3BlbmVkU2VhbGVkQ2F2ZSk7XG4vLyAgIHB1c2hGbGFnKFdhdGVyZmFsbFZhbGxleU5vcnRoLCAweDAwLCBPcGVuZWRQcmlzb24pO1xuLy8gICBjb25zdCBleHBsb3Npb24gPSBTcGF3bi5vZih7eTogMHgwNjAsIHg6IDB4MDYwLCB0eXBlOiA0LCBpZDogMHgyY30pO1xuLy8gICBjb25zdCBrZXlUcmlnZ2VyID0gU3Bhd24ub2Yoe3k6IDB4MDcwLCB4OiAweDA3MCwgdHlwZTogMiwgaWQ6IDB4YWR9KTtcbi8vICAgV2F0ZXJmYWxsVmFsbGV5Tm9ydGguc3Bhd25zLnNwbGljZSgxLCAwLCBleHBsb3Npb24pO1xuLy8gICBXYXRlcmZhbGxWYWxsZXlOb3J0aC5zcGF3bnMucHVzaChrZXlUcmlnZ2VyKTtcbi8vIH1cblxuZnVuY3Rpb24gcmVtb3ZlVW51c2VkR29hS2Vuc3VFeGl0cyhyb206IFJvbSkge1xuICAvLyBUaGVzZSBleGl0cyBhcmUgbmV2ZXIgYWN0dWFsbHkgcmVhY2hhYmxlLCBhbmQgdGhleSBjYXVzZSBwcm9ibGVtc1xuICAvLyB3aGVuIHRoZWlyIG90aGVyIHNpZGUgZW5kcyB1cCBnZXR0aW5nIHNodWZmbGVkLiAgUG9zc2libHkgdGhlIGJlc3RcbiAgLy8gb3B0aW9uIGlzIHRvIGRldGVjdCB0aGUgdW5yZWNpcHJvY2F0ZWQgZXhpdHMgYW5kIHVwZGF0ZSB0aGVtIHdoZW5cbiAgLy8gd2UgdHJhbnNmZXIuICBCdXQgZm9yIG5vdyB0aGlzIGlzIGFsbCB0aGF0J3MgcmVhbGx5IG5lZWRlZC5cbiAgY29uc3QgbG9jID0gcm9tLmxvY2F0aW9ucy5Hb2FGb3J0cmVzc19LZW5zdTtcbiAgbG9jLmV4aXRzLnNwbGljZSgwLCBsb2MuZXhpdHMubGVuZ3RoIC0gNCk7XG4gIGxvYy5tZXRhID0gTWV0YWxvY2F0aW9uLm9mKGxvYyk7XG5cbiAgLy8gTk9URTogbWFwcyAkMjEgYW5kICRiYSBhcmUgc2VhbWxlc3MgcGFpcnMgb2YgbWFwcyB3aXRoIGZsYWdzLCBidXQgdGhleVxuICAvLyBsYWNrIHRoZSBhY3R1YWwgc2FtZSBmbGFncy4gIFdlIG5lZWQgdG8ga2VlcCB0aGVtIGluIHN5bmMuLi4/ICBQcm9iYWJseVxuICAvLyBzaG91bGRuJ3QgYWxsb2NhdGUgYSBzZXBhcmF0ZSBmbGFnIGZvciB0aGVtIC0ganVzdCByZXVzZSB0aGUgb3RoZXIgb25lLlxufVxuXG5mdW5jdGlvbiBhZGp1c3RBYmR1Y3Rpb25UcmlnZ2VyKHJvbTogUm9tKSB7XG4gIC8vIEVuc3VyZSB3ZSBjYW4gc3RlcCBvbiBpdCBldmVuIHdoZW4gdGhlcmUncyBqdXN0IGEgc29saWQgd2FsbCBiZWhpbmQgdGhlXG4gIC8vIGJyZWFrYWJsZSB3YWxsLlxuICByb20ubG9jYXRpb25zLlplYnVDYXZlLnNwYXducy5maW5kKHMgPT4gcy5pc1RyaWdnZXIoKSkhLnl0ICs9IDM7XG59XG4iXX0=