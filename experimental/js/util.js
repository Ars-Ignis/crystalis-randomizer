export class Deque {
    constructor() {
        this.buffer = new Array(16);
        this.mask = 0xf;
        this.start = 0;
        this.end = 0;
        this.size = 0;
    }
    get length() {
        return this.size;
    }
    upsize(target) {
        while (this.mask < target) {
            if (this.end <= this.start)
                this.start += this.mask + 1;
            this.mask = this.mask << 1 | 1;
            this.buffer = this.buffer.concat(this.buffer);
        }
        this.size = target;
    }
    push(...elems) {
        this.upsize(this.size + elems.length);
        for (const elem of elems) {
            this.buffer[this.end] = elem;
            this.end = (this.end + 1) & this.mask;
        }
    }
    pop() {
        if (!this.size)
            return undefined;
        this.end = (this.end - 1) & this.mask;
        this.size--;
        return this.buffer[this.end];
    }
    peek() {
        if (!this.size)
            return undefined;
        return this.buffer[(this.end - 1) & this.mask];
    }
    unshift(...elems) {
        this.upsize(this.size + elems.length);
        for (const elem of elems) {
            this.start = (this.start - 1) & this.mask;
            this.buffer[this.start] = elem;
        }
    }
    shift() {
        if (!this.size)
            return undefined;
        const result = this.buffer[this.start];
        this.start = (this.start + 1) & this.mask;
        this.size--;
        return result;
    }
    front() {
        if (!this.size)
            return undefined;
        return this.buffer[this.start];
    }
    toString() {
        const parts = new Array(this.size);
        for (let i = 0; i < this.size; i++) {
            parts[i] = this.buffer[(this.start + i) & this.mask];
        }
        return `[${parts.join(', ')}]`;
    }
}
export const breakLines = (str, len) => {
    str = str.trim();
    const out = [];
    while (str.length > len) {
        let b = str.substring(0, len).lastIndexOf(' ');
        if (b < 0)
            b = len;
        out.push(str.substring(0, b).trim());
        str = str.substring(b).trim();
    }
    out.push(str.trim());
    return out;
};
export class UsageError extends Error {
}
export class SuffixTrie {
    constructor(key = '') {
        this.key = key;
        this.next = new Map();
    }
    get(key) {
        let t = this;
        for (let i = key.length - 1; i >= 0 && t; i++) {
            t = t.next.get(key[i]);
        }
        return t && t.data;
    }
    with(c) {
        let t = this.next.get(c);
        if (!t)
            this.next.set(c, (t = new SuffixTrie(c + this.key)));
        return t;
    }
    set(key, value) {
        let t = this;
        for (let i = key.length - 1; i >= 0 && t; i++) {
            t = t.with(key[i]);
        }
        t.data = value;
    }
    *values() {
        const stack = [this];
        while (stack.length) {
            const top = stack.pop();
            if (top.data)
                yield top.data;
            stack.push(...top.next.values());
        }
    }
}
export class DefaultMap extends Map {
    constructor(supplier, init) {
        super(init);
        this.supplier = supplier;
    }
    get(key) {
        let value = super.get(key);
        if (value == null)
            super.set(key, value = this.supplier(key));
        return value;
    }
}
export class IndexedSet {
    constructor() {
        this.forward = [];
        this.reverse = new Map();
    }
    add(elem) {
        let result = this.reverse.get(elem);
        if (result == null)
            this.reverse.set(elem, result = this.forward.push(elem) - 1);
        return result;
    }
    get(index) {
        return this.forward[index];
    }
}
export var iters;
(function (iters_1) {
    function* concat(...iters) {
        for (const iter of iters) {
            yield* iter;
        }
    }
    iters_1.concat = concat;
    function* map(iter, f) {
        for (const elem of iter) {
            yield f(elem);
        }
    }
    iters_1.map = map;
    function* filter(iter, f) {
        for (const elem of iter) {
            if (f(elem))
                yield elem;
        }
    }
    iters_1.filter = filter;
    function* flatMap(iter, f) {
        for (const elem of iter) {
            yield* f(elem);
        }
    }
    iters_1.flatMap = flatMap;
    function count(iter) {
        let count = 0;
        for (const _ of iter) {
            count++;
        }
        return count;
    }
    iters_1.count = count;
})(iters || (iters = {}));
const INVALIDATED = Symbol('Invalidated');
const SIZE = Symbol('Size');
class SetMultimapSetView {
    constructor(ownerMap, ownerKey, currentSet) {
        this.ownerMap = ownerMap;
        this.ownerKey = ownerKey;
        this.currentSet = currentSet;
    }
    getCurrentSet() {
        if (!this.currentSet || this.currentSet[INVALIDATED]) {
            this.currentSet = this.ownerMap.get(this.ownerKey) || new Set();
        }
        return this.currentSet;
    }
    mutateSet(f) {
        const set = this.getCurrentSet();
        const size = set.size;
        try {
            return f(set);
        }
        finally {
            this.ownerMap[SIZE] += set.size - size;
            if (!set.size) {
                this.ownerMap.delete(this.ownerKey);
                set[INVALIDATED] = true;
            }
        }
    }
    add(elem) {
        this.mutateSet(s => s.add(elem));
        return this;
    }
    has(elem) {
        return this.getCurrentSet().has(elem);
    }
    clear() {
        this.mutateSet(s => s.clear());
    }
    delete(elem) {
        return this.mutateSet(s => s.delete(elem));
    }
    [Symbol.iterator]() {
        return this.getCurrentSet()[Symbol.iterator]();
    }
    values() {
        return this.getCurrentSet().values();
    }
    keys() {
        return this.getCurrentSet().keys();
    }
    entries() {
        return this.getCurrentSet().entries();
    }
    forEach(callback, thisArg) {
        this.getCurrentSet().forEach(callback, thisArg);
    }
    get size() {
        return this.getCurrentSet().size;
    }
    get [Symbol.toStringTag]() {
        return 'Set';
    }
}
Reflect.setPrototypeOf(SetMultimapSetView.prototype, Set.prototype);
export class SetMultimap {
    constructor(entries = []) {
        this.map = new Map();
        this.map[SIZE] = 0;
        for (const [k, v] of entries) {
            this.add(k, v);
        }
    }
    get size() {
        return this.map[SIZE];
    }
    get(k) {
        return new SetMultimapSetView(this.map, k, this.map.get(k));
    }
    add(k, v) {
        let set = this.map.get(k);
        if (!set)
            this.map.set(k, set = new Set());
        const size = set.size;
        set.add(v);
        this.map[SIZE] += set.size - size;
    }
}
export class Multiset {
    constructor(entries = []) {
        this.entries = new DefaultMap(() => 0, entries);
    }
    add(elem) {
        this.entries.set(elem, this.entries.get(elem) + 1);
    }
    delete(elem) {
        const count = this.entries.get(elem) - 1;
        if (count > 0) {
            this.entries.set(elem, count);
        }
        else {
            this.entries.delete(elem);
        }
    }
    unique() {
        return this.entries.size;
    }
    count(elem) {
        return this.entries.has(elem) ? this.entries.get(elem) : 0;
    }
    [Symbol.iterator]() {
        return this.entries.entries();
    }
}
export function assertNever(x) {
    throw new Error(`non-exhaustive check: ${x}`);
}
export function assert(x) {
    if (!x)
        throw new Error(`asserted but falsy: ${x}`);
    return x;
}
export function isNonNull(x) {
    return x != null;
}
export function assertType(actual) { }
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9qcy91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sT0FBTyxLQUFLO0lBQWxCO1FBRVUsV0FBTSxHQUFzQixJQUFJLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMxQyxTQUFJLEdBQVcsR0FBRyxDQUFDO1FBQ25CLFVBQUssR0FBVyxDQUFDLENBQUM7UUFDbEIsUUFBRyxHQUFXLENBQUMsQ0FBQztRQUNoQixTQUFJLEdBQVcsQ0FBQyxDQUFDO0lBK0QzQixDQUFDO0lBN0RDLElBQUksTUFBTTtRQUNSLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQztJQUNuQixDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQWM7UUFDbkIsT0FBTyxJQUFJLENBQUMsSUFBSSxHQUFHLE1BQU0sRUFBRTtZQUN6QixJQUFJLElBQUksQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLEtBQUs7Z0JBQUUsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztZQUN4RCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUMvQztRQUNELElBQUksQ0FBQyxJQUFJLEdBQUcsTUFBTSxDQUFDO0lBQ3JCLENBQUM7SUFFRCxJQUFJLENBQUMsR0FBRyxLQUFVO1FBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEMsS0FBSyxNQUFNLElBQUksSUFBSSxLQUFLLEVBQUU7WUFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxD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QUFNLFVBQVUsVUFBVSxDQUFJLE1BQVMsSUFBUyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIERlcXVlPFQ+IHtcblxuICBwcml2YXRlIGJ1ZmZlcjogKFQgfCB1bmRlZmluZWQpW10gPSBuZXcgQXJyYXkoMTYpO1xuICBwcml2YXRlIG1hc2s6IG51bWJlciA9IDB4ZjtcbiAgcHJpdmF0ZSBzdGFydDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBlbmQ6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgc2l6ZTogbnVtYmVyID0gMDtcblxuICBnZXQgbGVuZ3RoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuc2l6ZTtcbiAgfVxuXG4gIHVwc2l6ZSh0YXJnZXQ6IG51bWJlcikge1xuICAgIHdoaWxlICh0aGlzLm1hc2sgPCB0YXJnZXQpIHtcbiAgICAgIGlmICh0aGlzLmVuZCA8PSB0aGlzLnN0YXJ0KSB0aGlzLnN0YXJ0ICs9IHRoaXMubWFzayArIDE7XG4gICAgICB0aGlzLm1hc2sgPSB0aGlzLm1hc2sgPDwgMSB8IDE7XG4gICAgICB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLmNvbmNhdCh0aGlzLmJ1ZmZlcik7XG4gICAgfVxuICAgIHRoaXMuc2l6ZSA9IHRhcmdldDtcbiAgfVxuXG4gIHB1c2goLi4uZWxlbXM6IFRbXSkge1xuICAgIHRoaXMudXBzaXplKHRoaXMuc2l6ZSArIGVsZW1zLmxlbmd0aCk7XG4gICAgZm9yIChjb25zdCBlbGVtIG9mIGVsZW1zKSB7XG4gICAgICB0aGlzLmJ1ZmZlclt0aGlzLmVuZF0gPSBlbGVtO1xuICAgICAgdGhpcy5lbmQgPSAodGhpcy5lbmQgKyAxKSAmIHRoaXMubWFzaztcbiAgICB9XG4gIH1cblxuICBwb3AoKTogVCB8IHVuZGVmaW5lZCB7XG4gICAgaWYgKCF0aGlzLnNpemUpIHJldHVybiB1bmRlZmluZWQ7XG4gICAgdGhpcy5lbmQgPSAodGhpcy5lbmQgLSAxKSAmIHRoaXMubWFzaztcbiAgICB0aGlzLnNpemUtLTtcbiAgICByZXR1cm4gdGhpcy5idWZmZXJbdGhpcy5lbmRdO1xuICB9XG5cbiAgcGVlaygpOiBUIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAoIXRoaXMuc2l6ZSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICByZXR1cm4gdGhpcy5idWZmZXJbKHRoaXMuZW5kIC0gMSkgJiB0aGlzLm1hc2tdO1xuICB9XG5cbiAgdW5zaGlmdCguLi5lbGVtczogVFtdKSB7XG4gICAgdGhpcy51cHNpemUodGhpcy5zaXplICsgZWxlbXMubGVuZ3RoKTtcbiAgICBmb3IgKGNvbnN0IGVsZW0gb2YgZWxlbXMpIHtcbiAgICAgIHRoaXMuc3RhcnQgPSAodGhpcy5zdGFydCAtIDEpICYgdGhpcy5tYXNrO1xuICAgICAgdGhpcy5idWZmZXJbdGhpcy5zdGFydF0gPSBlbGVtO1xuICAgIH1cbiAgfVxuXG4gIHNoaWZ0KCk6IFQgfCB1bmRlZmluZWQge1xuICAgIGlmICghdGhpcy5zaXplKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuYnVmZmVyW3RoaXMuc3RhcnRdO1xuICAgIHRoaXMuc3RhcnQgPSAodGhpcy5zdGFydCArIDEpICYgdGhpcy5tYXNrO1xuICAgIHRoaXMuc2l6ZS0tO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmcm9udCgpOiBUIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAoIXRoaXMuc2l6ZSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICByZXR1cm4gdGhpcy5idWZmZXJbdGhpcy5zdGFydF07XG4gIH1cblxuICB0b1N0cmluZygpIHtcbiAgICBjb25zdCBwYXJ0cyA9IG5ldyBBcnJheSh0aGlzLnNpemUpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zaXplOyBpKyspIHtcbiAgICAgIHBhcnRzW2ldID0gdGhpcy5idWZmZXJbKHRoaXMuc3RhcnQgKyBpKSAmIHRoaXMubWFza107XG4gICAgfVxuICAgIHJldHVybiBgWyR7cGFydHMuam9pbignLCAnKX1dYDtcbiAgfVxufVxuXG4vLyAvKiogQHRlbXBsYXRlIFQgKi9cbi8vIGV4cG9ydCBjbGFzcyBEZXF1ZVNldCB7XG4vLyAgIGNvbnN0cnVjdG9yKCkge1xuLy8gICAgIC8qKiBAdHlwZSB7IUFycmF5PFR8dW5kZWZpbmVkPn0gKi9cbi8vICAgICB0aGlzLmJ1ZmZlciA9IG5ldyBBcnJheSgxNik7XG4vLyAgICAgLyoqIEB0eXBlIHtudW1iZXJ9ICovXG4vLyAgICAgdGhpcy5tYXNrID0gMHhmO1xuLy8gICAgIC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xuLy8gICAgIHRoaXMuc3RhcnQgPSAwO1xuLy8gICAgIC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xuLy8gICAgIHRoaXMuZW5kID0gMDtcbi8vICAgICAvKiogQHR5cGUge251bWJlcn0gKi9cbi8vICAgICB0aGlzLnNpemUgPSAwOyAvLyByZWFkb25seSBleHRlcm5hbGx5XG4vLyAgICAgLyoqIEB0eXBlIHshU2V0PFQ+fSAqL1xuLy8gICAgIHRoaXMuc2V0ID0gbmV3IFNldCgpO1xuLy8gICB9XG5cbi8vICAgdXBzaXplKHRhcmdldCkge1xuLy8gICAgIHdoaWxlICh0aGlzLm1hc2sgPCB0YXJnZXQpIHtcbi8vICAgICAgIHRoaXMuc3RhcnQgKz0gdGhpcy5tYXNrICsgMTtcbi8vICAgICAgIHRoaXMubWFzayA9IHRoaXMubWFzayA8PCAxIHwgMTtcbi8vICAgICAgIHRoaXMuYnVmZmVyID0gdGhpcy5idWZmZXIuY29uY2F0KHRoaXMuYnVmZmVyKTtcbi8vICAgICB9XG4vLyAgICAgdGhpcy5zaXplID0gdGFyZ2V0O1xuLy8gICB9XG5cbi8vICAgLyoqIEBwYXJhbSB7Li4uVH0gZWxlbSAqL1xuLy8gICBwdXNoKC4uLmVsZW1zKSB7XG4vLyAgICAgdGhpcy51cHNpemUodGhpcy5zaXplICsgZWxlbXMubGVuZ3RoKTtcbi8vICAgICBmb3IgKGNvbnN0IGVsZW0gb2YgZWxlbXMpIHtcbi8vICAgICAgIGlmICh0aGlzLnNldC5oYXMoZWxlbSkpIHtcbi8vICAgICAgICAgdGhpcy5zaXplLS07XG4vLyAgICAgICAgIGNvbnRpbnVlO1xuLy8gICAgICAgfVxuLy8gICAgICAgdGhpcy5idWZmZXJbdGhpcy5lbmRdID0gZWxlbTtcbi8vICAgICAgIHRoaXMuZW5kID0gKHRoaXMuZW5kICsgMSkgJiB0aGlzLm1hc2s7XG4vLyAgICAgfVxuLy8gICB9XG5cbi8vICAgLyoqIEByZXR1cm4ge1R8dW5kZWZpbmVkfSAqL1xuLy8gICBwb3AoKSB7XG4vLyAgICAgaWYgKCF0aGlzLnNpemUpIHJldHVybiB1bmRlZmluZWQ7XG4vLyAgICAgdGhpcy5lbmQgPSAodGhpcy5lbmQgLSAxKSAmIHRoaXMubWFzaztcbi8vICAgICB0aGlzLnNpemUtLTtcbi8vICAgICBjb25zdCBvdXQgPSB0aGlzLmJ1ZmZlclt0aGlzLmVuZF07XG4vLyAgICAgdGhpcy5zZXQuZGVsZXRlKG91dCk7XG4vLyAgICAgcmV0dXJuIG91dDtcbi8vICAgfVxuXG4vLyAgIC8qKiBAcmV0dXJuIHtUfHVuZGVmaW5lZH0gKi9cbi8vICAgcGVlaygpIHtcbi8vICAgICBpZiAoIXRoaXMuc2l6ZSkgcmV0dXJuIHVuZGVmaW5lZDtcbi8vICAgICByZXR1cm4gdGhpcy5idWZmZXJbKHRoaXMuZW5kIC0gMSkgJiB0aGlzLm1hc2tdO1xuLy8gICB9XG5cbi8vICAgLyoqIEBwYXJhbSB7Li4uVH0gZWxlbSAqL1xuLy8gICB1bnNoaWZ0KC4uLmVsZW1zKSB7XG4vLyAgICAgdGhpcy51cHNpemUodGhpcy5zaXplICsgZWxlbXMubGVuZ3RoKTtcbi8vICAgICBmb3IgKGNvbnN0IGVsZW0gb2YgZWxlbXMpIHtcbi8vICAgICAgIGlmICh0aGlzLnNldC5oYXMoZWxlbSkpIHtcbi8vICAgICAgICAgdGhpcy5zaXplLS07XG4vLyAgICAgICAgIGNvbnRpbnVlO1xuLy8gICAgICAgfVxuLy8gICAgICAgdGhpcy5zdGFydCA9ICh0aGlzLnN0YXJ0IC0gMSkgJiB0aGlzLm1hc2s7XG4vLyAgICAgICB0aGlzLmJ1ZmZlclt0aGlzLnN0YXJ0XSA9IGVsZW07XG4vLyAgICAgfVxuLy8gICB9XG5cbi8vICAgLyoqIEByZXR1cm4ge1R8dW5kZWZpbmVkfSAqL1xuLy8gICBzaGlmdCgpIHtcbi8vICAgICBpZiAoIXRoaXMuc2l6ZSkgcmV0dXJuIHVuZGVmaW5lZDtcbi8vICAgICBjb25zdCByZXN1bHQgPSB0aGlzLmJ1ZmZlclt0aGlzLnN0YXJ0XTtcbi8vICAgICB0aGlzLnN0YXJ0ID0gKHRoaXMuc3RhcnQgKyAxKSAmIHRoaXMubWFzaztcbi8vICAgICB0aGlzLnNpemUtLTtcbi8vICAgICB0aGlzLnNldC5yZW1vdmUocmVzdWx0KTtcbi8vICAgICByZXR1cm4gcmVzdWx0O1xuLy8gICB9XG5cbi8vICAgLyoqIEByZXR1cm4ge1R8dW5kZWZpbmVkfSAqL1xuLy8gICBmcm9udCgpIHtcbi8vICAgICBpZiAoIXRoaXMuc2l6ZSkgcmV0dXJuIHVuZGVmaW5lZDtcbi8vICAgICByZXR1cm4gdGhpcy5idWZmZXJbdGhpcy5zdGFydF07XG4vLyAgIH1cbi8vIH1cblxuLy8gZXhwb3J0IGNsYXNzIEluZGV4ZWRMaXN0IHtcbi8vICAgY29uc3RydWN0b3IoKSB7XG4vLyAgICAgdGhpcy5saXN0ID0gW107XG4vLyAgICAgdGhpcy5tYXAgPSBuZXcgTWFwKCk7XG4vLyAgIH1cblxuLy8gICBhZGQoZWxlbSkge1xuLy8gICAgIGlmICh0aGlzLm1hcC5oYXMoZWxlbSkpIHJldHVybjtcbi8vICAgICB0aGlzLm1hcC5zZXQoZWxlbSwgdGhpcy5saXN0Lmxlbmd0aCk7XG4vLyAgICAgdGhpcy5saXN0LnB1c2goZWxlbSk7XG4vLyAgIH1cblxuLy8gICBpbmRleE9mKGVsZW0pIHtcbi8vICAgICByZXR1cm4gdGhpcy5tYXAuZ2V0KGVsZW0pO1xuLy8gICB9XG5cbi8vICAgcmVtb3ZlKGVsZW0pIHtcbi8vICAgICAvLyBUT0RPIC0gdGhpcyBpc24ndCBzdXBlciBlZmZpY2llbnQuLi5cbi8vICAgICAvLyBXZSBjb3VsZCBtYWludGFpbiBhIHNtYWxsIGhhbmRmdWwgb2Ygc3BsaXQgcG9pbnRzLlxuLy8gICAgIC8vIE9yIGEgUmVtb3ZhbFRyZWUgd2hlcmUgaXQgc3RhcnRzIHdpdGggYSBmdWxseS1iYWxhbmNlZFxuLy8gICAgIC8vIGJpbmFyeSB0cmVlIChoZWlnaHQgfiBsb2cobikpIGFuZCB0aGVuIHdlIGp1c3QgcmVtb3ZlXG4vLyAgICAgLy8gZWxlbWVudHMgZnJvbSB0aGVyZSBzbyB0aGF0IHdlIG9ubHkgbmVlZCB0byB1cGRhdGVcbi8vICAgICAvLyBPKGxvZyhuKSkgXCJzaXplXCIgdmFsdWVzIG9uIHRoZSB3YXkgdXAuICBUaG91Z2ggdGhpc1xuLy8gICAgIC8vIGRvZXNuJ3QgaGVscCB0byBhY3R1YWxseSAqZmluZCogdGhlIGVsZW1lbnQuLi5cbi8vICAgICAvLyBBbm90aGVyIG9wdGlvbiB3b3VsZCBiZSB0byB1c2UgdGhlIGJpdHMgb2YgdGhlIGluZGV4XG4vLyAgICAgLy8gdG8ga2VlcCB0cmFjayBvZiB0aGUgbnVtYmVyIG9mIHJlbW92ZWQgZWxlbWVudHMgYmVmb3JlLlxuLy8gICAgIC8vIFNvIHdlIGhhdmUgYSBzYW1lLXNpemUgYXJyYXkgb2YgbnVtYmVyc1xuLy8gICAgIC8vIHdoZXJlIGVhY2ggZW50cnkgdGVsbHMgdGhlIHNpemUgdG8gYWRkIGZvciB0aGUgTnRoIG9uZS1iaXRcbi8vICAgICAvLyBhbmQgYWxsIHRoZSBoaWdoZXIgYml0cy5cbi8vICAgICAvLyAgIDAwIC0+IDBcbi8vICAgICAvLyAgIDAxIC0+IDFcbi8vICAgICAvLyAgIDEwIC0+IDJcbi8vICAgICAvLyAgIDExIC0+IDMgPSAyICsgMVxuLy8gICAgIC8vIFN0b3Jpbmdcbi8vICAgICAvLyAgIFgjICAtPiAyXG4vLyAgICAgLy8gICAxWCAgLT4gMVxuLy8gICAgIC8vICAgMFggIC0+IDFcbi8vICAgICAvLyBGb3IgYmlnZ2VyIGxpc3QsXG4vLyAgICAgLy8gICAxMVggLT4gMSAgICBzdG9yZWQgYXQgICAgMTExID0gN1xuLy8gICAgIC8vICAgMTBYIC0+IDEgICAgICAgICAgICAgICAgIDExMCA9IDZcbi8vICAgICAvLyAgIDAxWCAtPiAxICAgICAgICAgICAgICAgICAxMDEgPSA1XG4vLyAgICAgLy8gICAwMFggLT4gMSAgICAgICAgICAgICAgICAgMTAwID0gNFxuLy8gICAgIC8vICAgMVgjIC0+IDIgICAgICAgICAgICAgICAgIDAxMSA9IDNcbi8vICAgICAvLyAgIDBYIyAtPiAyICAgICAgICAgICAgICAgICAwMTAgPSAyXG4vLyAgICAgLy8gICBYIyMgLT4gNCAgICAgICAgICAgICAgICAgMDAxID0gMVxuLy8gICAgIC8vIFRoZSB1cHNob3QgaXMgdGhhdCB3aGVuIHJlbW92aW5nIGFuIGVsZW1lbnQgd2Ugb25seSBuZWVkIHRvXG4vLyAgICAgLy8gdXBkYXRlIE8obG9nKG4pKSBlbGVtZW50cy4uLlxuLy8gICAgIC8vIEFuZCB3ZSBjYW4gYXZvaWQgc3BsaWNpbmcgdGhlIGxpc3QgYW5kIGV2ZW4gZmluZCB0aGUgZmlyc3Rcbi8vICAgICAvLyBlbGVtZW50IHdpdGggYmluYXJ5IHNlYXJjaCAtIE8obG9nKG4pKVxuLy8gICAgIGNvbnN0IGluZGV4ID0gdGhpcy5tYXAuZ2V0KGVsZW0pO1xuLy8gICAgIGlmIChpbmRleCA9PSBudWxsKSByZXR1cm47XG4vLyAgICAgdGhpcy5saXN0LnNwbGljZShpbmRleCwgMSk7XG4vLyAgICAgdGhpcy5tYXAuZGVsZXRlKGVsZW0pO1xuLy8gICAgIGZvciAobGV0IGkgPSBpbmRleDsgaSA8IHRoaXMubGlzdC5sZW5ndGg7IGkrKykge1xuLy8gICAgICAgdGhpcy5tYXAuc2V0KHRoaXMubGlzdFtpXSwgaSk7XG4vLyAgICAgfVxuLy8gICB9XG5cbi8vICAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4vLyAgICAgcmV0dXJuIHRoaXMubGlzdFtTeW1ib2wuaXRlcmF0b3JdKCk7XG4vLyAgIH1cbi8vIH1cblxuZXhwb3J0IGNvbnN0IGJyZWFrTGluZXMgPSAoc3RyOiBzdHJpbmcsIGxlbjogbnVtYmVyKTogc3RyaW5nW10gPT4ge1xuICBzdHIgPSBzdHIudHJpbSgpO1xuICBjb25zdCBvdXQ6IHN0cmluZ1tdID0gW107XG4gIHdoaWxlIChzdHIubGVuZ3RoID4gbGVuKSB7XG4gICAgbGV0IGIgPSBzdHIuc3Vic3RyaW5nKDAsIGxlbikubGFzdEluZGV4T2YoJyAnKTtcbiAgICBpZiAoYiA8IDApIGIgPSBsZW47XG4gICAgb3V0LnB1c2goc3RyLnN1YnN0cmluZygwLCBiKS50cmltKCkpO1xuICAgIHN0ciA9IHN0ci5zdWJzdHJpbmcoYikudHJpbSgpO1xuICB9XG4gIG91dC5wdXNoKHN0ci50cmltKCkpO1xuICByZXR1cm4gb3V0O1xufTtcblxuZXhwb3J0IGNsYXNzIFVzYWdlRXJyb3IgZXh0ZW5kcyBFcnJvciB7fVxuXG5leHBvcnQgY2xhc3MgU3VmZml4VHJpZTxUPiB7XG4gIHJlYWRvbmx5IG5leHQgPSBuZXcgTWFwPHN0cmluZywgU3VmZml4VHJpZTxUPj4oKTtcbiAgZGF0YTogVCB8IHVuZGVmaW5lZDtcblxuICBjb25zdHJ1Y3RvcihyZWFkb25seSBrZXk6IHN0cmluZyA9ICcnKSB7fVxuXG4gIGdldChrZXk6IHN0cmluZyk6IFQgfCB1bmRlZmluZWQge1xuICAgIGxldCB0OiBTdWZmaXhUcmllPFQ+IHwgdW5kZWZpbmVkID0gdGhpcztcbiAgICBmb3IgKGxldCBpID0ga2V5Lmxlbmd0aCAtIDE7IGkgPj0gMCAmJiB0OyBpKyspIHtcbiAgICAgIHQgPSB0Lm5leHQuZ2V0KGtleVtpXSk7XG4gICAgfVxuICAgIHJldHVybiB0ICYmIHQuZGF0YTtcbiAgfVxuXG4gIHdpdGgoYzogc3RyaW5nKTogU3VmZml4VHJpZTxUPiB7XG4gICAgbGV0IHQgPSB0aGlzLm5leHQuZ2V0KGMpO1xuICAgIGlmICghdCkgdGhpcy5uZXh0LnNldChjLCAodCA9IG5ldyBTdWZmaXhUcmllPFQ+KGMgKyB0aGlzLmtleSkpKTtcbiAgICByZXR1cm4gdDtcbiAgfVxuXG4gIHNldChrZXk6IHN0cmluZywgdmFsdWU6IFQgfCB1bmRlZmluZWQpIHtcbiAgICBsZXQgdDogU3VmZml4VHJpZTxUPiA9IHRoaXM7XG4gICAgZm9yIChsZXQgaSA9IGtleS5sZW5ndGggLSAxOyBpID49IDAgJiYgdDsgaSsrKSB7XG4gICAgICB0ID0gdC53aXRoKGtleVtpXSk7XG4gICAgfVxuICAgIHQuZGF0YSA9IHZhbHVlO1xuICB9XG5cbiAgKiB2YWx1ZXMoKTogSXRlcmFibGU8VD4ge1xuICAgIGNvbnN0IHN0YWNrOiBTdWZmaXhUcmllPFQ+W10gPSBbdGhpc107XG4gICAgd2hpbGUgKHN0YWNrLmxlbmd0aCkge1xuICAgICAgY29uc3QgdG9wID0gc3RhY2sucG9wKCkhO1xuICAgICAgaWYgKHRvcC5kYXRhKSB5aWVsZCB0b3AuZGF0YTtcbiAgICAgIHN0YWNrLnB1c2goLi4udG9wLm5leHQudmFsdWVzKCkpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGVmYXVsdE1hcDxLLCBWIGV4dGVuZHMge30+IGV4dGVuZHMgTWFwPEssIFY+IHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBzdXBwbGllcjogKGtleTogSykgPT4gVixcbiAgICAgICAgICAgICAgaW5pdD86IEl0ZXJhYmxlPHJlYWRvbmx5IFtLLCBWXT4pIHtcbiAgICBzdXBlcihpbml0IGFzIGFueSk7IC8vIE5PVEU6IE1hcCdzIGRlY2xhcmF0aW9ucyBhcmUgb2ZmLCBJdGVyYWJsZSBpcyBmaW5lLlxuICB9XG4gIGdldChrZXk6IEspOiBWIHtcbiAgICBsZXQgdmFsdWUgPSBzdXBlci5nZXQoa2V5KTtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCkgc3VwZXIuc2V0KGtleSwgdmFsdWUgPSB0aGlzLnN1cHBsaWVyKGtleSkpO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSW5kZXhlZFNldDxUIGV4dGVuZHMge30+IHtcbiAgcHJpdmF0ZSBmb3J3YXJkOiBUW10gPSBbXTtcbiAgcHJpdmF0ZSByZXZlcnNlID0gbmV3IE1hcDxULCBudW1iZXI+KCk7XG5cbiAgYWRkKGVsZW06IFQpOiBudW1iZXIge1xuICAgIGxldCByZXN1bHQgPSB0aGlzLnJldmVyc2UuZ2V0KGVsZW0pO1xuICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgdGhpcy5yZXZlcnNlLnNldChlbGVtLCByZXN1bHQgPSB0aGlzLmZvcndhcmQucHVzaChlbGVtKSAtIDEpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBnZXQoaW5kZXg6IG51bWJlcik6IFQge1xuICAgIHJldHVybiB0aGlzLmZvcndhcmRbaW5kZXhdO1xuICB9XG59XG5cbmV4cG9ydCBuYW1lc3BhY2UgaXRlcnMge1xuICAvLyBDb25jYXRlbmF0ZXMgaXRlcmFibGVzLlxuICBleHBvcnQgZnVuY3Rpb24gKiBjb25jYXQ8VD4oLi4uaXRlcnM6IEFycmF5PEl0ZXJhYmxlPFQ+Pik6IEl0ZXJhYmxlSXRlcmF0b3I8VD4ge1xuICAgIGZvciAoY29uc3QgaXRlciBvZiBpdGVycykge1xuICAgICAgeWllbGQgKiBpdGVyO1xuICAgIH1cbiAgfVxuICBleHBvcnQgZnVuY3Rpb24gKiBtYXA8VCwgVT4oaXRlcjogSXRlcmFibGU8VD4sIGY6IChlbGVtOiBUKSA9PiBVKTogSXRlcmFibGVJdGVyYXRvcjxVPiB7XG4gICAgZm9yIChjb25zdCBlbGVtIG9mIGl0ZXIpIHtcbiAgICAgIHlpZWxkIGYoZWxlbSk7XG4gICAgfVxuICB9XG4gIGV4cG9ydCBmdW5jdGlvbiAqIGZpbHRlcjxUPihpdGVyOiBJdGVyYWJsZTxUPiwgZjogKGVsZW06IFQpID0+IGJvb2xlYW4pOiBJdGVyYWJsZTxUPiB7XG4gICAgZm9yIChjb25zdCBlbGVtIG9mIGl0ZXIpIHtcbiAgICAgIGlmIChmKGVsZW0pKSB5aWVsZCBlbGVtO1xuICAgIH1cbiAgfVxuICBleHBvcnQgZnVuY3Rpb24gKiBmbGF0TWFwPFQsIFU+KGl0ZXI6IEl0ZXJhYmxlPFQ+LCBmOiAoZWxlbTogVCkgPT4gSXRlcmFibGU8VT4pOiBJdGVyYWJsZUl0ZXJhdG9yPFU+IHtcbiAgICBmb3IgKGNvbnN0IGVsZW0gb2YgaXRlcikge1xuICAgICAgeWllbGQgKiBmKGVsZW0pO1xuICAgIH1cbiAgfVxuICBleHBvcnQgZnVuY3Rpb24gY291bnQoaXRlcjogSXRlcmFibGU8dW5rbm93bj4pOiBudW1iZXIge1xuICAgIGxldCBjb3VudCA9IDA7XG4gICAgZm9yIChjb25zdCBfIG9mIGl0ZXIpIHtcbiAgICAgIGNvdW50Kys7XG4gICAgfVxuICAgIHJldHVybiBjb3VudDtcbiAgfVxufVxuXG4vLyBleHBvcnQgY2xhc3MgTGFiZWxlZFNldDxUPiB7XG4vLyAgIHByaXZhdGUgbWFwOiBNYXA8U3RyaW5nLCBUPlxuLy8gfVxuXG5jb25zdCBJTlZBTElEQVRFRCA9IFN5bWJvbCgnSW52YWxpZGF0ZWQnKTtcbmNvbnN0IFNJWkUgPSBTeW1ib2woJ1NpemUnKTtcblxuY2xhc3MgU2V0TXVsdGltYXBTZXRWaWV3PEssIFY+IGltcGxlbWVudHMgU2V0PFY+IHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBvd25lck1hcDogTWFwPEssIFNldDxWPj4sXG4gICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgb3duZXJLZXk6IEssIHByaXZhdGUgY3VycmVudFNldD86IFNldDxWPikge31cbiAgcHJpdmF0ZSBnZXRDdXJyZW50U2V0KCkge1xuICAgIGlmICghdGhpcy5jdXJyZW50U2V0IHx8ICh0aGlzLmN1cnJlbnRTZXQgYXMgYW55KVtJTlZBTElEQVRFRF0pIHtcbiAgICAgIHRoaXMuY3VycmVudFNldCA9IHRoaXMub3duZXJNYXAuZ2V0KHRoaXMub3duZXJLZXkpIHx8IG5ldyBTZXQ8Vj4oKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFNldDtcbiAgfVxuICBwcml2YXRlIG11dGF0ZVNldDxSPihmOiAoczogU2V0PFY+KSA9PiBSKTogUiB7XG4gICAgY29uc3Qgc2V0ID0gdGhpcy5nZXRDdXJyZW50U2V0KCk7XG4gICAgY29uc3Qgc2l6ZSA9IHNldC5zaXplO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZihzZXQpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICAodGhpcy5vd25lck1hcCBhcyBhbnkpW1NJWkVdICs9IHNldC5zaXplIC0gc2l6ZTtcbiAgICAgIGlmICghc2V0LnNpemUpIHtcbiAgICAgICAgdGhpcy5vd25lck1hcC5kZWxldGUodGhpcy5vd25lcktleSk7XG4gICAgICAgIChzZXQgYXMgYW55KVtJTlZBTElEQVRFRF0gPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBhZGQoZWxlbTogVik6IHRoaXMge1xuICAgIHRoaXMubXV0YXRlU2V0KHMgPT4gcy5hZGQoZWxlbSkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGhhcyhlbGVtOiBWKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudFNldCgpLmhhcyhlbGVtKTtcbiAgfVxuICBjbGVhcigpOiB2b2lkIHtcbiAgICB0aGlzLm11dGF0ZVNldChzID0+IHMuY2xlYXIoKSk7XG4gIH1cbiAgZGVsZXRlKGVsZW06IFYpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5tdXRhdGVTZXQocyA9PiBzLmRlbGV0ZShlbGVtKSk7XG4gIH1cbiAgW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmFibGVJdGVyYXRvcjxWPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudFNldCgpW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgfVxuICB2YWx1ZXMoKTogSXRlcmFibGVJdGVyYXRvcjxWPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudFNldCgpLnZhbHVlcygpO1xuICB9XG4gIGtleXMoKTogSXRlcmFibGVJdGVyYXRvcjxWPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudFNldCgpLmtleXMoKTtcbiAgfVxuICBlbnRyaWVzKCk6IEl0ZXJhYmxlSXRlcmF0b3I8W1YsIFZdPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudFNldCgpLmVudHJpZXMoKTtcbiAgfVxuICBmb3JFYWNoPFQ+KGNhbGxiYWNrOiAodmFsdWU6IFYsIGtleTogViwgc2V0OiBTZXQ8Vj4pID0+IHZvaWQsIHRoaXNBcmc/OiBUKTogdm9pZCB7XG4gICAgdGhpcy5nZXRDdXJyZW50U2V0KCkuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7XG4gIH1cbiAgZ2V0IHNpemUoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5nZXRDdXJyZW50U2V0KCkuc2l6ZTtcbiAgfVxuICBnZXQgW1N5bWJvbC50b1N0cmluZ1RhZ10oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gJ1NldCc7XG4gIH1cbn1cbi8vIEZpeCAnaW5zdGFuY2VvZicgdG8gd29yayBwcm9wZXJseSB3aXRob3V0IHJlcXVpcmluZyBhY3R1YWwgc3VwZXJjbGFzcy4uLlxuUmVmbGVjdC5zZXRQcm90b3R5cGVPZihTZXRNdWx0aW1hcFNldFZpZXcucHJvdG90eXBlLCBTZXQucHJvdG90eXBlKTtcblxuZXhwb3J0IGNsYXNzIFNldE11bHRpbWFwPEssIFY+IHtcblxuICBwcml2YXRlIHJlYWRvbmx5IG1hcCA9IG5ldyBNYXA8SywgU2V0PFY+PigpO1xuXG4gIGNvbnN0cnVjdG9yKGVudHJpZXM6IEl0ZXJhYmxlPHJlYWRvbmx5IFtLLCBWXT4gPSBbXSkge1xuICAgICh0aGlzLm1hcCBhcyBhbnkpW1NJWkVdID0gMDtcbiAgICBmb3IgKGNvbnN0IFtrLCB2XSBvZiBlbnRyaWVzKSB7XG4gICAgICB0aGlzLmFkZChrLCB2KTtcbiAgICB9XG4gIH1cblxuICBnZXQgc2l6ZSgpOiBudW1iZXIge1xuICAgIHJldHVybiAodGhpcy5tYXAgYXMgYW55KVtTSVpFXTtcbiAgfVxuXG4gIGdldChrOiBLKTogU2V0PFY+IHtcbiAgICByZXR1cm4gbmV3IFNldE11bHRpbWFwU2V0Vmlldyh0aGlzLm1hcCwgaywgdGhpcy5tYXAuZ2V0KGspKTtcbiAgfVxuXG4gIGFkZChrOiBLLCB2OiBWKTogdm9pZCB7XG4gICAgbGV0IHNldCA9IHRoaXMubWFwLmdldChrKTtcbiAgICBpZiAoIXNldCkgdGhpcy5tYXAuc2V0KGssIHNldCA9IG5ldyBTZXQoKSk7XG4gICAgY29uc3Qgc2l6ZSA9IHNldC5zaXplO1xuICAgIHNldC5hZGQodik7XG4gICAgKHRoaXMubWFwIGFzIGFueSlbU0laRV0gKz0gc2V0LnNpemUgLSBzaXplO1xuICB9XG5cbiAgLy8gVE9ETyAtIGl0ZXJhdGlvbj9cbn1cblxuXG5leHBvcnQgY2xhc3MgTXVsdGlzZXQ8VD4gaW1wbGVtZW50cyBJdGVyYWJsZTxbVCwgbnVtYmVyXT4ge1xuICBwcml2YXRlIGVudHJpZXM6IERlZmF1bHRNYXA8VCwgbnVtYmVyPjtcbiAgY29uc3RydWN0b3IoZW50cmllczogSXRlcmFibGU8W1QsIG51bWJlcl0+ID0gW10pIHtcbiAgICB0aGlzLmVudHJpZXMgPSBuZXcgRGVmYXVsdE1hcCgoKSA9PiAwLCBlbnRyaWVzKTtcbiAgfVxuICBhZGQoZWxlbTogVCkge1xuICAgIHRoaXMuZW50cmllcy5zZXQoZWxlbSwgdGhpcy5lbnRyaWVzLmdldChlbGVtKSArIDEpO1xuICB9XG4gIGRlbGV0ZShlbGVtOiBUKSB7XG4gICAgY29uc3QgY291bnQgPSB0aGlzLmVudHJpZXMuZ2V0KGVsZW0pIC0gMTtcbiAgICBpZiAoY291bnQgPiAwKSB7XG4gICAgICB0aGlzLmVudHJpZXMuc2V0KGVsZW0sIGNvdW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lbnRyaWVzLmRlbGV0ZShlbGVtKTtcbiAgICB9XG4gIH1cbiAgdW5pcXVlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuZW50cmllcy5zaXplO1xuICB9XG4gIGNvdW50KGVsZW06IFQpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmVudHJpZXMuaGFzKGVsZW0pID8gdGhpcy5lbnRyaWVzLmdldChlbGVtKSA6IDA7XG4gIH1cbiAgW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmFibGVJdGVyYXRvcjxbVCwgbnVtYmVyXT4ge1xuICAgIHJldHVybiB0aGlzLmVudHJpZXMuZW50cmllcygpO1xuICB9XG59XG5cblxuLy8gZXhwb3J0IGNsYXNzIFNwYXJzZUFycmF5PFQ+IGltcGxlbWVudHMgSXRlcmFibGU8VD4ge1xuLy8gICByZWFkb25seSBbaWQ6IG51bWJlcl06IFQ7IC8vIE5PVEU6IHJlYWRvbmx5IGlzIG9ubHkgZm9yIGV4dGVybmFsIVxuLy8gICBwcml2YXRlIGVsZW1lbnRzID0gbmV3IE1hcDxudW1iZXIsIFQ+KCk7XG5cbi8vICAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7IHJldHVybiB0aGlzLmVsZW1lbnRzLnZhbHVlcygpOyB9XG5cbi8vICAgcHJvdGVjdGVkIHNldChpZDogbnVtYmVyLCB2YWx1ZTogVCkge1xuLy8gICAgICh0aGlzIGFzIHtbaWQ6IG51bWJlcl06IFR9KVtpZF0gPSB2YWx1ZTtcbi8vICAgICB0aGlzLmVsZW1lbnRzLnNldChpZCwgdmFsdWUpO1xuLy8gICB9XG4vLyAgIGRlbGV0ZShpZDogbnVtYmVyKSB7XG4vLyAgICAgZGVsZXRlICh0aGlzIGFzIHtbaWQ6IG51bWJlcl06IFR9KVtpZF07XG4vLyAgICAgdGhpcy5lbGVtZW50cy5kZWxldGUoaWQpO1xuLy8gICB9XG4vLyB9XG5cblxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydE5ldmVyKHg6IG5ldmVyKTogbmV2ZXIge1xuICB0aHJvdyBuZXcgRXJyb3IoYG5vbi1leGhhdXN0aXZlIGNoZWNrOiAke3h9YCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhc3NlcnQ8VD4oeDogVHx1bmRlZmluZWR8bnVsbCk6IFQge1xuICBpZiAoIXgpIHRocm93IG5ldyBFcnJvcihgYXNzZXJ0ZWQgYnV0IGZhbHN5OiAke3h9YCk7XG4gIHJldHVybiB4O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNOb25OdWxsPFQgZXh0ZW5kcyB7fT4oeDogVHx1bmRlZmluZWR8bnVsbCk6IHggaXMgVCB7XG4gIHJldHVybiB4ICE9IG51bGw7XG59XG4vLyBleHBvcnQgZnVuY3Rpb24gbm9uTnVsbDxUIGV4dGVuZHMge30+KHg6IFR8dW5kZWZpbmVkfG51bGwpOiBUIHtcbi8vICAgaWYgKHggIT0gbnVsbCkgcmV0dXJuIHg7XG4vLyAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgbm9uLW51bGxgKTtcbi8vIH1cblxuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydFR5cGU8VD4oYWN0dWFsOiBUKTogdm9pZCB7fVxuIl19