import { Bits } from '../bits.js';
import { hex } from '../rom/util.js';
import { Keyed, ArrayMap, MutableArrayBiMap, iters, spread } from '../util.js';
import { die } from '../assert.js';
export class Graph {
    constructor(worlds) {
        var _a;
        this.worlds = worlds;
        const provided = new Set();
        const required = new Set();
        const slots = new Map();
        const items = new Map();
        for (let i = 0; i < worlds.length; i++) {
            const world = worlds[i];
            const worldId = i << 24;
            for (const [providedId, requirement] of world.requirements) {
                provided.add(worldId | providedId);
                for (const route of requirement) {
                    for (const cond of route) {
                        required.add(worldId | cond);
                    }
                }
            }
            for (const [itemId, info] of world.items) {
                items.set((worldId | itemId), info);
            }
            for (const [slotId, info] of world.slots) {
                slots.set((worldId | slotId), info);
            }
        }
        this.itemInfos = new Map(items);
        this.slotInfos = new Map(slots);
        this.progression = new Set(required);
        for (const item of items.keys())
            required.add(item);
        const common = new Set();
        const extraProvides = new Set();
        const extraRequires = new Set();
        for (const check of required) {
            (provided.has(check) ? common : extraRequires).add(check);
        }
        for (const check of provided) {
            if (!required.has(check))
                extraProvides.add(check);
        }
        this.common = common.size;
        this.slots = new ArrayMap([...common, ...extraProvides]);
        this.items = new ArrayMap([...common, ...extraRequires]);
        const graph = [];
        const unlocks = [];
        for (let i = 0; i < worlds.length; i++) {
            const worldId = i << 24;
            for (const [slot, req] of worlds[i].requirements) {
                const slotIndex = this.slots.index((worldId | slot));
                if (slotIndex == null) {
                    throw new Error(`Provided a non-slot? ${hex(slot)}`);
                }
                for (const cs of req) {
                    const is = [...cs].map(c => { var _a; return _a = this.items.index((worldId | c)), (_a !== null && _a !== void 0 ? _a : die()); });
                    (graph[slotIndex] || (graph[slotIndex] = [])).push(Bits.from(is));
                    for (const i of is) {
                        (unlocks[i] || (unlocks[i] = new Set())).add(slotIndex);
                    }
                }
            }
        }
        for (let i = 0; i < this.slots.length; i++) {
            if (!graph[i] || !graph[i].length) {
                const id = (_a = this.slots.get(i), (_a !== null && _a !== void 0 ? _a : NaN));
                const name = this.checkName(id);
                console.error(`Nothing provided $${hex(id)}: ${name} (index ${i})`);
            }
        }
        this.graph = new Keyed(graph);
        this.unlocks = new Keyed(unlocks.map(spread));
    }
    async shuffle(flagset, random, attempts = 20, progress, spoiler) {
        if (progress)
            progress.addTasks(Math.floor(attempts / 100));
        for (let attempt = 0; attempt < attempts; attempt++) {
            if (progress && (attempt % 100 === 99)) {
                progress.addCompleted(1);
                await new Promise(requestAnimationFrame);
            }
            const fill = new MutableArrayBiMap();
            this.prefill(fill, random);
            const indexFill = this.compressFill(fill);
            const items = this.itemPool(indexFill.values(), random);
            let has = Bits.from(new Set(items));
            const backtracks = Math.floor(attempt / 5);
            if (!this.fillInternal(indexFill, items, has, random, flagset, backtracks)) {
                continue;
            }
            const path = spoiler ? [] : undefined;
            const final = this.traverse(i => indexFill.get(i), Bits.of(), path);
            if (spoiler && path) {
                for (const [target, ...deps] of path) {
                    if (target < this.common || indexFill.has(target)) {
                        spoiler.addCheck(this.slots.get(target), deps.map(d => this.items.get(d)));
                    }
                }
            }
            if (final.size !== this.slots.length) {
                const ns = (si) => this.checkName(this.slots.get(si));
                const missing = new Set([...this.slots].map(x => x[0]));
                for (const s of final)
                    missing.delete(s);
                console.error(`Initial fill never filled slots:
  ${[...missing].map(ns).sort().join('\n  ')}`, final, this);
                continue;
            }
            this.expandFill(indexFill, fill);
            const out = this.fillNonProgression(fill, flagset, random);
            if (out == null)
                continue;
            if (progress) {
                progress.addCompleted(Math.floor((attempts - attempt) / 100));
            }
            if (spoiler) {
                for (const [slot, item] of fill) {
                    const name = this.checkName(slot).replace(/^[0-9a-f]{3} /, '');
                    spoiler.addSlot(slot, name, item);
                }
            }
            return out;
        }
        return null;
    }
    fillInternal(fill, items, has, random, flagset, backsteps) {
        var _a;
        const fixed = new Set(fill.keys());
        for (let bit = items.pop(); bit != null; bit = items.pop()) {
            if (!Bits.has(has, bit))
                continue;
            const itemInfo = this.itemInfoFromIndex(bit);
            has = Bits.without(has, bit);
            const reachable = this.expandReachable(this.traverse(i => fill.get(i), has), flagset);
            random.shuffle(reachable);
            let found = false;
            const checked = new Set(fill.keys());
            for (const slot of reachable) {
                if (checked.has(slot))
                    continue;
                checked.add(slot);
                const slotInfo = this.slotInfoFromIndex(slot);
                if (!slotInfo || !this.fits(slotInfo, itemInfo, flagset))
                    continue;
                fill.set(slot, bit);
                found = true;
                break;
            }
            if (found)
                continue;
            checked.clear();
            if (backsteps-- > 0) {
                for (const slot of reachable) {
                    if (checked.has(slot) || !fill.has(slot) || fixed.has(slot))
                        continue;
                    checked.add(slot);
                    const slotInfo = this.slotInfoFromIndex(slot);
                    if (!slotInfo || !this.fits(slotInfo, itemInfo, flagset))
                        continue;
                    const previousItem = (_a = fill.replace(slot, bit), (_a !== null && _a !== void 0 ? _a : die()));
                    has = Bits.with(has, previousItem);
                    items.push(previousItem);
                    random.shuffle(items);
                    found = true;
                    break;
                }
                if (found)
                    continue;
            }
            return false;
        }
        return true;
    }
    expandReachable(slots, flagset) {
        const out = [];
        for (const slot of slots) {
            const info = this.slotInfoFromIndex(slot);
            if (!info || flagset.preserveUniqueChecks() && !info.unique)
                continue;
            addCopies(out, slot, info.weight || 1);
        }
        return out;
    }
    itemPool(exclude, random) {
        const excludeSet = new Set(exclude);
        const arr = [];
        for (const [id, info] of this.itemInfos) {
            const index = this.items.index(id);
            if (index == null)
                continue;
            if (!this.progression.has(id))
                continue;
            if (excludeSet.has(index))
                continue;
            addCopies(arr, index, info.weight || 1);
        }
        return random.shuffle(arr);
    }
    fits(slot, item, flagset) {
        if (flagset.preserveUniqueChecks() &&
            item.unique && !slot.unique) {
            return false;
        }
        if (slot.lossy && (item.losable && item.preventLoss))
            return false;
        return true;
    }
    fillNonProgression(fill, flagset, random) {
        const itemPasses = [[], [], []];
        const slotPasses = [[], []];
        for (const [itemId, info] of this.itemInfos) {
            if (fill.hasValue(itemId))
                continue;
            let index = 2;
            if (info.losable && info.preventLoss)
                index = 1;
            if (flagset.preserveUniqueChecks() && info.unique)
                index = 0;
            itemPasses[index].push(itemId);
        }
        for (const [slotId, info] of this.slotInfos) {
            if (fill.has(slotId))
                continue;
            const index = info.lossy && info.preventLoss ? 0 : 1;
            slotPasses[index].push(slotId);
        }
        for (const pass of [...itemPasses, ...slotPasses]) {
            random.shuffle(pass);
        }
        const n = (si) => this.checkName(si);
        const sc = iters.count(iters.concat(...slotPasses));
        const ic = iters.count(iters.concat(...itemPasses));
        if (ic > sc) {
            console.log(`Slots ${sc}:\n  ${[...iters.concat(...slotPasses)].map(n).join('\n  ')}`);
            console.log(`Items ${ic}:\n  ${[...iters.concat(...itemPasses)].map(n).join('\n  ')}`);
            throw new Error(`Too many items`);
        }
        for (const item of iters.concat(...itemPasses)) {
            let found = false;
            for (const slots of [...slotPasses]) {
                if (found)
                    break;
                for (let i = 0; i < slots.length; i++) {
                    if (this.fits(this.slotInfos.get(slots[i]), this.itemInfos.get(item), flagset)) {
                        fill.set(slots[i], item);
                        found = true;
                        slots.splice(i, 1);
                        break;
                    }
                }
            }
            if (!found) {
                console.log(`Slots:\n  ${[...iters.concat(...slotPasses)].map(n).join('\n  ')}`);
                console.error(`REROLL: Could not place item ${n(item)}`);
                return null;
            }
        }
        return new Map(fill);
    }
    traverse(fill, has, path) {
        has = Bits.clone(has);
        const reachable = new Set();
        const queue = new Set();
        for (let i = 0; i < this.slots.length; i++) {
            if (this.graph.get(i) == null) {
                console.dir(this);
                throw new Error(`Unreachable slot ${i}`);
            }
            queue.add(i);
        }
        for (const n of queue) {
            queue.delete(n);
            if (reachable.has(n))
                continue;
            const needed = this.graph.get(n);
            if (needed == null)
                throw new Error(`Not in graph: ${n}`);
            for (let i = 0, len = needed.length; i < len; i++) {
                if (!Bits.containsAll(has, needed[i]))
                    continue;
                if (path)
                    path.push([n, ...Bits.bits(needed[i])]);
                reachable.add(n);
                const items = [];
                if (n < this.common)
                    items.push(n);
                const filled = fill(n);
                if (filled != null)
                    items.push(filled);
                for (const item of items) {
                    has = Bits.with(has, item);
                    for (const j of this.unlocks.get(item) || []) {
                        if (this.graph.get(j) == null) {
                            console.dir(this);
                            throw new Error(`Adding bad node ${j} from unlock ${item}`);
                        }
                        queue.add(j);
                    }
                }
                break;
            }
        }
        return reachable;
    }
    expandFill(indexFill, fill) {
        for (const [slotIndex, itemIndex] of indexFill) {
            const slotId = this.slots.get(slotIndex);
            const itemId = this.items.get(itemIndex);
            if (slotId == null || itemId == null)
                throw new Error(`missing`);
            fill.replace(slotId, itemId);
        }
    }
    compressFill(fill) {
        const indexFill = new MutableArrayBiMap();
        for (const [slotId, itemId] of fill) {
            const slotIndex = this.slots.index(slotId);
            const itemIndex = this.items.index(itemId);
            if (slotIndex == null || itemIndex == null) {
                throw new Error(`Bad slot/item: ${slotId} ${slotIndex} ${itemId} ${itemIndex}`);
            }
            indexFill.set(slotIndex, itemIndex);
        }
        return indexFill;
    }
    checkName(id) {
        return this.worlds[id >>> 24].checkName(id & 0xffffff);
    }
    prefill(fill, random) {
        for (let i = 0; i < this.worlds.length; i++) {
            const worldId = i << 24;
            const worldFill = this.worlds[i].prefill(random);
            for (const [slot, item] of worldFill) {
                fill.set((worldId | slot), (worldId | item));
            }
        }
    }
    itemInfoFromIndex(item) {
        const id = this.items.get(item);
        if (id == null)
            throw new Error(`Bad item: ${item}`);
        return this.itemInfoFromId(id);
    }
    itemInfoFromId(id) {
        const info = this.itemInfos.get(id);
        if (info == null)
            throw new Error(`Missing info: ${hex(id)}`);
        return info;
    }
    slotInfoFromIndex(slot) {
        const id = this.slots.get(slot);
        if (id == null)
            throw new Error(`Bad slot: ${slot}`);
        return this.slotInfoFromId(id);
    }
    slotInfoFromId(id) {
        const info = this.slotInfos.get(id);
        if (info != null)
            return info;
        return undefined;
    }
}
function addCopies(arr, elem, copies) {
    for (let i = 0; i < copies; i++) {
        arr.push(elem);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvbG9naWMvZ3JhcGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLElBQUksRUFBQyxNQUFNLFlBQVksQ0FBQztBQUloQyxPQUFPLEVBQUMsR0FBRyxFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDbkMsT0FBTyxFQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsaUJBQWlCLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBQyxNQUFNLFlBQVksQ0FBQztBQUM3RSxPQUFPLEVBQUMsR0FBRyxFQUFDLE1BQU0sY0FBYyxDQUFDO0FBeURqQyxNQUFNLE9BQU8sS0FBSztJQW9CaEIsWUFBNkIsTUFBK0I7O1FBQS9CLFdBQU0sR0FBTixNQUFNLENBQXlCO1FBUTFELE1BQU0sUUFBUSxHQUFHLElBQUksR0FBRyxFQUFVLENBQUM7UUFDbkMsTUFBTSxRQUFRLEdBQUcsSUFBSSxHQUFHLEVBQVUsQ0FBQztRQUNuQyxNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBb0IsQ0FBQztRQUMxQyxNQUFNLEtBQUssR0FBRyxJQUFJLEdBQUcsRUFBb0IsQ0FBQztRQUMxQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUN0QyxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEIsTUFBTSxPQUFPLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUN4QixLQUFLLE1BQU0sQ0FBQyxVQUFVLEVBQUUsV0FBVyxDQUFDLElBQUksS0FBSyxDQUFDLFlBQVksRUFBRTtnQkFDMUQsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDLENBQUM7Z0JBQ25DLEtBQUssTUFBTSxLQUFLLElBQUksV0FBVyxFQUFFO29CQUMvQixLQUFLLE1BQU0sSUFB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LFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDcEMsSUFBSSxJQUFJLElBQUksSUFBSTtZQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWlCLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDOUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsaUJBQWlCLENBQUMsSUFBZTtRQUMvQixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxJQUFJLEVBQUUsSUFBSSxJQUFJO1lBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLElBQUksRUFBRSxDQUFDLENBQUM7UUFDckQsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxjQUFjLENBQUMsRUFBVTtRQUN2QixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwQyxJQUFJLElBQUksSUFBSSxJQUFJO1lBQUUsT0FBTyxJQUFJLENBQUM7UUFFOUIsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztDQUNGO0FBRUQsU0FBUyxTQUFTLENBQUksR0FBUSxFQUFFLElBQU8sRUFBRSxNQUFjO0lBQ3JELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7UUFDL0IsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUNoQjtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0JpdHN9IGZyb20gJy4uL2JpdHMuanMnO1xuaW1wb3J0IHtGbGFnU2V0fSBmcm9tICcuLi9mbGFnc2V0LmpzJztcbmltcG9ydCB7UmFuZG9tfSBmcm9tICcuLi9yYW5kb20uanMnO1xuaW1wb3J0IHtTcG9pbGVyfSBmcm9tICcuLi9yb20vc3BvaWxlci5qcyc7XG5pbXBvcnQge2hleH0gZnJvbSAnLi4vcm9tL3V0aWwuanMnO1xuaW1wb3J0IHtLZXllZCwgQXJyYXlNYXAsIE11dGFibGVBcnJheUJpTWFwLCBpdGVycywgc3ByZWFkfSBmcm9tICcuLi91dGlsLmpzJztcbmltcG9ydCB7ZGllfSBmcm9tICcuLi9hc3NlcnQuanMnO1xuXG4vKiogSW5wdXQgZm9yIHRoZSBncmFwaC4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTG9jYXRpb25MaXN0IHtcbiAgd29ybGROYW1lOiBzdHJpbmc7XG4gIGl0ZW1zOiBSZWFkb25seU1hcDxudW1iZXIsIEl0ZW1JbmZvPjtcbiAgc2xvdHM6IFJlYWRvbmx5TWFwPG51bWJlciwgU2xvdEluZm8+O1xuICByZXF1aXJlbWVudHM6IFJlYWRvbmx5TWFwPG51bWJlciwgSXRlcmFibGU8SXRlcmFibGU8bnVtYmVyPj4+O1xuICBjaGVja05hbWU6IChub2RlOiBudW1iZXIpID0+IHN0cmluZztcbiAgcHJlZmlsbDogKHJhbmRvbTogUmFuZG9tKSA9PiBNYXA8bnVtYmVyLCBudW1iZXI+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEl0ZW1JbmZvIHtcbiAgLyoqIFVuaXF1ZSBpdGVtcyBjYW4gb3B0aW9uYWxseSBiZSBzaHVmZmxlZCBzZXBhcmF0ZWx5LiAqL1xuICB1bmlxdWU/OiBib29sZWFuO1xuICAvKipcbiAgICogTG9zYWJsZSBpdGVtcyBhcmUgYXQgcmlzayBvZiBiZWluZyBsb3N0IGlmIHRoZXkgYXJlIHBsYWNlZCBpbiBhIGxvc3N5IHNsb3RcbiAgICogKGkuZS4gaWYgdGhlIGludmVudG9yeSBpcyBmdWxsKS5cbiAgICovXG4gIGxvc2FibGU/OiBib29sZWFuO1xuICAvKipcbiAgICogTG9zYWJsZSBpdGVtcyBtYXkgYmUgcHJvdGVjdGVkLCBtZWFuaW5nIHRoYXQgdGhleSB3aWxsIG5vdCBiZSBwbGFjZWQgaW4gYVxuICAgKiBsb3NzeSBzbG90LlxuICAgKi9cbiAgcHJldmVudExvc3M/OiBib29sZWFuO1xuICAvKipcbiAgICogV2VpZ2h0IGZvciBwbGFjZW1lbnQuICBIaWdoZXIgbnVtYmVycyBhcmUgbW9yZSBsaWtlbHkgdG8gYmUgcGxhY2VkIGVhcmxpZXIuXG4gICAqIERlZmF1bHQgaXMgMS4gIFBvd2VyZnVsIGFuZCBpbXBvcnRhbnQgaXRlbXMgc2hvdWxkIGJlIGdpdmVuIGxhcmdlciB3ZWlnaHRzXG4gICAqIHRvIG1ha2UgaXQgbGVzcyBsaWtlbHkgdGhhdCB0aGV5IGFsd2F5cyBlbmQgdXAgaW4gZWFybHkgc3BoZXJlcy5cbiAgICovXG4gIHdlaWdodD86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTbG90SW5mbyB7XG4gIC8qKiBXaGV0aGVyIHRoZSBzbG90IGNhbiBob2xkIGEgdW5pcXVlIGl0ZW0uICovXG4gIHVuaXF1ZT86IGJvb2xlYW47XG4gIC8qKiBXaGV0aGVyIGxvc2FibGUgaXRlbXMgaW4gdGhpcyBzbG90IGFyZSBhdCByaXNrIG9mIGJlaW5nIGxvc3QuICovXG4gIGxvc3N5OiBib29sZWFuO1xuICAvKiogV2hldGhlciB0aGUgc2xvdCBpcyBkaXNhbGxvd2VkIGZyb20gbG9zaW5nIGl0ZW1zIChlLmcuIHRyaWdnZXJzKS4gKi9cbiAgcHJldmVudExvc3M/OiBib29sZWFuO1xuICAvKipcbiAgICogV2VpZ2h0IGZvciBwbGFjaW5nIHByb2dyZXNzaW9uIGl0ZW1zLiAgRGVmYXVsdCBpcyAxLiAgVXNlZnVsIGZvciBtYWtpbmdcbiAgICogZGlzdGFudCBhbmQgb3V0LW9mLXRoZSB3YXkgY2hlY2tzIG1vcmUgd29ydGh3aGlsZS4gIEFsdGVybmF0aXZlbHksIHdlXG4gICAqIGNvdWxkIGp1c3QgYXZvaWQgZXZlciBwbGFjaW5nIG1pbWljcyBpbiB0aGVzZSBhcmVhcz9cbiAgICovXG4gIHdlaWdodD86IG51bWJlcjtcbn1cblxuZXhwb3J0IHR5cGUgU2xvdEluZGV4ID0gbnVtYmVyICYge19fc2xvdEluZGV4X186IG5ldmVyfTtcbmV4cG9ydCB0eXBlIEl0ZW1JbmRleCA9IG51bWJlciAmIHtfX2l0ZW1JbmRleF9fOiBuZXZlcn07XG5leHBvcnQgdHlwZSBTbG90SWQgPSBudW1iZXIgJiB7X19zbG90SWRfXzogbmV2ZXJ9O1xuZXhwb3J0IHR5cGUgSXRlbUlkID0gbnVtYmVyICYge19faXRlbUlkX186IG5ldmVyfTtcblxuLyoqXG4gKiBBIGdyYXBoIGRhdGEgc3RydWN0dXJlLiAgSW5pdGlhbGl6ZWQgd2l0aCBvbmUgb3IgbW9yZSBsb2NhdGlvbiBsaXN0c1xuICogKGEgc2V0IG9mIERORiBleHByZXNzaW9ucyBwcm92aWRpbmcgYSBidW5jaCBvZiBudW1lcmljIGZsYWdzKS5cbiAqL1xuZXhwb3J0IGNsYXNzIEdyYXBoIHtcblxuICAvL3ByaXZhdGUgcmVhZG9ubHkgcmV2ZXJzZVdvcmxkczogUmVhZG9ubHlNYXA8TG9jYXRpb25MaXN0LCBudW1iZXI+O1xuICBwcml2YXRlIHJlYWRvbmx5IGNvbW1vbjogbnVtYmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IHNsb3RzOiBBcnJheU1hcDxTbG90SW5kZXgsIFNsb3RJZD47XG4gIHByaXZhdGUgcmVhZG9ubHkgaXRlbXM6IEFycmF5TWFwPEl0ZW1JbmRleCwgSXRlbUlkPjtcbiAgLy8gTm90ZSB0aGF0IG5vdCBldmVyeSBpdGVtIGdldHMgYW4gaW5kZXggLSBvbmx5IHRob3NlIGluIHRoZSBncmFwaC5cbiAgcHJpdmF0ZSByZWFkb25seSBzbG90SW5mb3M6IFJlYWRvbmx5TWFwPFNsb3RJZCwgU2xvdEluZm8+O1xuICBwcml2YXRlIHJlYWRvbmx5IGl0ZW1JbmZvczogUmVhZG9ubHlNYXA8SXRlbUlkLCBJdGVtSW5mbz47XG5cbiAgLy8gSXRlbXMgdGhhdCBwcm92aWRlIHByb2dyZXNzaW9uLlxuICBwcml2YXRlIHJlYWRvbmx5IHByb2dyZXNzaW9uOiBTZXQ8SXRlbUlkPjtcblxuICAvLyAvKiogTWFwcGluZyBvZiBwcm92aWRlcyB0byB0aGUgc2FtZSByZXF1aXJlcy4gKi9cbiAgLy8gcHJpdmF0ZSByZWFkb25seSBjb21tb25GaWxsOiBBcnJheU1hcDxTbG90SW5kZXgsIEl0ZW1JbmRleD47XG5cbiAgLyoqIEJpdHNldHMga2V5ZWQgYnkgSXRlbUluZGV4LCByZXByZXNlbnQgYSBETkYgY29uZGl0aW9uLiAqL1xuICByZWFkb25seSBncmFwaDogS2V5ZWQ8U2xvdEluZGV4LCByZWFkb25seSBCaXRzW10+O1xuICByZWFkb25seSB1bmxvY2tzOiBLZXllZDxJdGVtSW5kZXgsIHJlYWRvbmx5IFNsb3RJbmRleFtdPjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHdvcmxkczogcmVhZG9ubHkgTG9jYXRpb25MaXN0W10pIHtcbiAgICAvL2NvbnN0IHJldmVyc2VXb3JsZHMgPSBuZXcgTWFwPExvY2F0aW9uTGlzdCwgbnVtYmVyPigpO1xuICAgIC8vZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZHMubGVuZ3RoOyBpKyspIHtcbiAgICAvLyAgcmV2ZXJzZVdvcmxkcy5zZXQod29ybGRzW2ldLCBpKTtcbiAgICAvL31cbiAgICAvL3RoaXMucmV2ZXJzZVdvcmxkcyA9IHJldmVyc2VXb3JsZHM7XG5cbiAgICAvLyBCdWlsZCB1cCBhIGxpc3Qgb2YgYWxsIGtub3duIHByb3ZpZGVzL3JlcXVpcmVzLlxuICAgIGNvbnN0IHByb3ZpZGVkID0gbmV3IFNldDxudW1iZXI+KCk7XG4gICAgY29uc3QgcmVxdWlyZWQgPSBuZXcgU2V0PG51bWJlcj4oKTtcbiAgICBjb25zdCBzbG90cyA9IG5ldyBNYXA8U2xvdElkLCBTbG90SW5mbz4oKTtcbiAgICBjb25zdCBpdGVtcyA9IG5ldyBNYXA8SXRlbUlkLCBJdGVtSW5mbz4oKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgd29ybGQgPSB3b3JsZHNbaV07XG4gICAgICBjb25zdCB3b3JsZElkID0gaSA8PCAyNDtcbiAgICAgIGZvciAoY29uc3QgW3Byb3ZpZGVkSWQsIHJlcXVpcmVtZW50XSBvZiB3b3JsZC5yZXF1aXJlbWVudHMpIHtcbiAgICAgICAgcHJvdmlkZWQuYWRkKHdvcmxkSWQgfCBwcm92aWRlZElkKTtcbiAgICAgICAgZm9yIChjb25zdCByb3V0ZSBvZiByZXF1aXJlbWVudCkge1xuICAgICAgICAgIGZvciAoY29uc3QgY29uZCBvZiByb3V0ZSkge1xuICAgICAgICAgICAgcmVxdWlyZWQuYWRkKHdvcmxkSWQgfCBjb25kKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gICAgICAgIFxuICAgICAgfVxuXG4gICAgICAvLyBQcm9iYWJseSBqdXN0IG1ha2UgYSBjb21tb24gaW5kZXggZmlsbCBhbmQgZG8gYSBmdWxsIGluZGlyZWN0aW9uP1xuICAgICAgLy8gIC0gaWYgaXQncyBpbiB0aGUgY29tbW9uIGZpbGwsIHVzZSBpdCwgb3RoZXJ3aXNlIGZhbGwgYmFjayBvbiB0aGVcbiAgICAgIC8vICAgIGl0ZW0gZmlsbD9cblxuICAgICAgZm9yIChjb25zdCBbaXRlbUlkLCBpbmZvXSBvZiB3b3JsZC5pdGVtcykge1xuICAgICAgICBpdGVtcy5zZXQoKHdvcmxkSWQgfCBpdGVtSWQpIGFzIEl0ZW1JZCwgaW5mbyk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IFtzbG90SWQsIGluZm9dIG9mIHdvcmxkLnNsb3RzKSB7XG4gICAgICAgIHNsb3RzLnNldCgod29ybGRJZCB8IHNsb3RJZCkgYXMgU2xvdElkLCBpbmZvKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDb3B5IHRoZSBtYXBzIGFuZCBzYXZlIHRoZW0gYmVmb3JlIHdlIHN0YXJ0IGRlbGV0aW5nIGVsZW1lbnRzLlxuICAgIHRoaXMuaXRlbUluZm9zID0gbmV3IE1hcChpdGVtcyk7XG4gICAgdGhpcy5zbG90SW5mb3MgPSBuZXcgTWFwKHNsb3RzKTtcblxuICAgIHRoaXMucHJvZ3Jlc3Npb24gPSBuZXcgU2V0KHJlcXVpcmVkIGFzIFNldDxJdGVtSWQ+KTtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMua2V5cygpKSByZXF1aXJlZC5hZGQoaXRlbSk7IC8vIG5vbi1wcm9ncmVzc2lvbiBsYXN0XG5cbiAgICBjb25zdCBjb21tb24gPSBuZXcgU2V0PG51bWJlcj4oKTtcbiAgICBjb25zdCBleHRyYVByb3ZpZGVzID0gbmV3IFNldDxudW1iZXI+KCk7XG4gICAgY29uc3QgZXh0cmFSZXF1aXJlcyA9IG5ldyBTZXQ8bnVtYmVyPigpO1xuICAgIGZvciAoY29uc3QgY2hlY2sgb2YgcmVxdWlyZWQpIHtcbiAgICAgIChwcm92aWRlZC5oYXMoY2hlY2spID8gY29tbW9uIDogZXh0cmFSZXF1aXJlcykuYWRkKGNoZWNrKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBjaGVjayBvZiBwcm92aWRlZCkge1xuICAgICAgaWYgKCFyZXF1aXJlZC5oYXMoY2hlY2spKSBleHRyYVByb3ZpZGVzLmFkZChjaGVjayk7XG4gICAgfVxuXG4gICAgdGhpcy5jb21tb24gPSBjb21tb24uc2l6ZTtcbiAgICB0aGlzLnNsb3RzID0gbmV3IEFycmF5TWFwKFsuLi5jb21tb24sIC4uLmV4dHJhUHJvdmlkZXNdIGFzIFNsb3RJZFtdKTtcbiAgICB0aGlzLml0ZW1zID0gbmV3IEFycmF5TWFwKFsuLi5jb21tb24sIC4uLmV4dHJhUmVxdWlyZXNdIGFzIEl0ZW1JZFtdKTtcblxuICAgIC8vIEJ1aWxkIHVwIHRoZSBncmFwaCBub3cgdGhhdCB3ZSBoYXZlIHRoZSBhcnJheSBtYXBzLlxuICAgIGNvbnN0IGdyYXBoOiBCaXRzW11bXSA9IFtdO1xuICAgIGNvbnN0IHVubG9ja3M6IEFycmF5PFNldDxTbG90SW5kZXg+PiA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29ybGRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCB3b3JsZElkID0gaSA8PCAyNDtcbiAgICAgIGZvciAoY29uc3QgW3Nsb3QsIHJlcV0gb2Ygd29ybGRzW2ldLnJlcXVpcmVtZW50cykge1xuICAgICAgICBjb25zdCBzbG90SW5kZXggPSB0aGlzLnNsb3RzLmluZGV4KCh3b3JsZElkIHwgc2xvdCkgYXMgU2xvdElkKTtcbiAgICAgICAgaWYgKHNsb3RJbmRleCA9PSBudWxsKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQcm92aWRlZCBhIG5vbi1zbG90PyAke2hleChzbG90KX1gKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGNzIG9mIHJlcSkge1xuICAgICAgICAgIGNvbnN0IGlzID1cbiAgICAgICAgICAgICAgWy4uLmNzXS5tYXAoYyA9PlxuICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLmluZGV4KCh3b3JsZElkIHwgYykgYXMgSXRlbUlkKSA/PyBkaWUoKSk7XG4gICAgICAgICAgKGdyYXBoW3Nsb3RJbmRleF0gfHwgKGdyYXBoW3Nsb3RJbmRleF0gPSBbXSkpLnB1c2goQml0cy5mcm9tKGlzKSk7XG4gICAgICAgICAgZm9yIChjb25zdCBpIG9mIGlzKSB7XG4gICAgICAgICAgICAodW5sb2Nrc1tpXSB8fCAodW5sb2Nrc1tpXSA9IG5ldyBTZXQoKSkpLmFkZChzbG90SW5kZXgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNhbml0eSBjaGVjayB0byBtYWtlIHN1cmUgYWxsIHNsb3RzIGFyZSBwcm92aWRlZC5cbiAgICBmb3IgKGxldCBpID0gMCBhcyBTbG90SW5kZXg7IGkgPCB0aGlzLnNsb3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIWdyYXBoW2ldIHx8ICFncmFwaFtpXS5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgaWQgPSB0aGlzLnNsb3RzLmdldChpKSA/PyBOYU4gYXMgU2xvdElkO1xuICAgICAgICBjb25zdCBuYW1lID0gdGhpcy5jaGVja05hbWUoaWQpO1xuICAgICAgICBjb25zb2xlLmVycm9yKGBOb3RoaW5nIHByb3ZpZGVkICQke2hleChpZCl9OiAke25hbWV9IChpbmRleCAke2l9KWApO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmdyYXBoID0gbmV3IEtleWVkKGdyYXBoKTtcbiAgICB0aGlzLnVubG9ja3MgPSBuZXcgS2V5ZWQodW5sb2Nrcy5tYXAoc3ByZWFkKSk7XG4gIH1cblxuICBhc3luYyBzaHVmZmxlKGZsYWdzZXQ6IEZsYWdTZXQsXG4gICAgICAgICAgICAgICAgcmFuZG9tOiBSYW5kb20sXG4gICAgICAgICAgICAgICAgYXR0ZW1wdHMgPSAyMCwgLy8gMDBcbiAgICAgICAgICAgICAgICBwcm9ncmVzcz86IFByb2dyZXNzVHJhY2tlcixcbiAgICAgICAgICAgICAgICBzcG9pbGVyPzogU3BvaWxlcik6IFByb21pc2U8TWFwPFNsb3RJZCwgSXRlbUlkPnxudWxsPiB7XG4gICAgaWYgKHByb2dyZXNzKSBwcm9ncmVzcy5hZGRUYXNrcyhNYXRoLmZsb29yKGF0dGVtcHRzIC8gMTAwKSk7XG4gICAgZm9yIChsZXQgYXR0ZW1wdCA9IDA7IGF0dGVtcHQgPCBhdHRlbXB0czsgYXR0ZW1wdCsrKSB7XG4gICAgICBpZiAocHJvZ3Jlc3MgJiYgKGF0dGVtcHQgJSAxMDAgPT09IDk5KSkge1xuICAgICAgICBwcm9ncmVzcy5hZGRDb21wbGV0ZWQoMSk7XG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlcXVlc3RBbmltYXRpb25GcmFtZSk7XG4gICAgICB9XG4gICAgICBjb25zdCBmaWxsID0gbmV3IE11dGFibGVBcnJheUJpTWFwPFNsb3RJZCwgSXRlbUlkPigpO1xuICAgICAgdGhpcy5wcmVmaWxsKGZpbGwsIHJhbmRvbSk7XG4gICAgICBjb25zdCBpbmRleEZpbGwgPSB0aGlzLmNvbXByZXNzRmlsbChmaWxsKTtcbiAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5pdGVtUG9vbChpbmRleEZpbGwudmFsdWVzKCksIHJhbmRvbSk7XG4gICAgICBsZXQgaGFzID0gQml0cy5mcm9tKG5ldyBTZXQoaXRlbXMpKTtcbiAgICAgIGNvbnN0IGJhY2t0cmFja3MgPSBNYXRoLmZsb29yKGF0dGVtcHQgLyA1KTtcbiAgICAgIGlmICghdGhpcy5maWxsSW50ZXJuYWwoaW5kZXhGaWxsLCBpdGVtcywgaGFzLCByYW5kb20sIGZsYWdzZXQsIGJhY2t0cmFja3MpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgY29uc3QgcGF0aDogbnVtYmVyW11bXXx1bmRlZmluZWQgPSBzcG9pbGVyID8gW10gOiB1bmRlZmluZWQ7XG4gICAgICBjb25zdCBmaW5hbCA9IHRoaXMudHJhdmVyc2UoaSA9PiBpbmRleEZpbGwuZ2V0KGkpLCBCaXRzLm9mKCksIHBhdGgpO1xuICAgICAgaWYgKHNwb2lsZXIgJiYgcGF0aCkge1xuICAgICAgICBmb3IgKGNvbnN0IFt0YXJnZXQsIC4uLmRlcHNdIG9mIHBhdGgpIHtcbiAgICAgICAgICBpZiAodGFyZ2V0IDwgdGhpcy5jb21tb24gfHwgaW5kZXhGaWxsLmhhcyh0YXJnZXQgYXMgU2xvdEluZGV4KSkge1xuICAgICAgICAgICAgc3BvaWxlci5hZGRDaGVjayhcbiAgICAgICAgICAgICAgICB0aGlzLnNsb3RzLmdldCh0YXJnZXQgYXMgU2xvdEluZGV4KSEsXG4gICAgICAgICAgICAgICAgZGVwcy5tYXAoZCA9PiB0aGlzLml0ZW1zLmdldChkIGFzIEl0ZW1JbmRleCkhKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBUT0RPIC0gZmxhZ3MgdG8gbG9vc2VuIHRoaXMgcmVxdWlyZW1lbnQ/XG4gICAgICBpZiAoZmluYWwuc2l6ZSAhPT0gdGhpcy5zbG90cy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgbnMgPSAoc2k6IFNsb3RJbmRleCkgPT4gdGhpcy5jaGVja05hbWUodGhpcy5zbG90cy5nZXQoc2kpISk7XG4gICAgICAgIGNvbnN0IG1pc3NpbmcgPSBuZXcgU2V0KFsuLi50aGlzLnNsb3RzXS5tYXAoeCA9PiB4WzBdKSk7XG4gICAgICAgIGZvciAoY29uc3QgcyBvZiBmaW5hbCkgbWlzc2luZy5kZWxldGUocyk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEluaXRpYWwgZmlsbCBuZXZlciBmaWxsZWQgc2xvdHM6XG4gICR7Wy4uLm1pc3NpbmddLm1hcChucykuc29ydCgpLmpvaW4oJ1xcbiAgJyl9YCwgZmluYWwsIHRoaXMpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZXhwYW5kRmlsbChpbmRleEZpbGwsIGZpbGwpO1xuICAgICAgY29uc3Qgb3V0ID0gdGhpcy5maWxsTm9uUHJvZ3Jlc3Npb24oZmlsbCwgZmxhZ3NldCwgcmFuZG9tKTtcbiAgICAgIGlmIChvdXQgPT0gbnVsbCkgY29udGludWU7XG4gICAgICBpZiAocHJvZ3Jlc3MpIHtcbiAgICAgICAgcHJvZ3Jlc3MuYWRkQ29tcGxldGVkKE1hdGguZmxvb3IoKGF0dGVtcHRzIC0gYXR0ZW1wdCkgLyAxMDApKTtcbiAgICAgIH1cbiAgICAgIGlmIChzcG9pbGVyKSB7XG4gICAgICAgIGZvciAoY29uc3QgW3Nsb3QsIGl0ZW1dIG9mIGZpbGwpIHtcbiAgICAgICAgICAvLyBUT0RPIC0gY2xlYW4gdGhpcyB1cC5cbiAgICAgICAgICBjb25zdCBuYW1lID0gdGhpcy5jaGVja05hbWUoc2xvdCkucmVwbGFjZSgvXlswLTlhLWZdezN9IC8sICcnKTtcbiAgICAgICAgICBzcG9pbGVyLmFkZFNsb3Qoc2xvdCwgbmFtZSwgaXRlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBmaWxsSW50ZXJuYWwoZmlsbDogTXV0YWJsZUFycmF5QmlNYXA8U2xvdEluZGV4LCBJdGVtSW5kZXg+LFxuICAgICAgICAgICAgICAgICAgICAgICBpdGVtczogSXRlbUluZGV4W10sXG4gICAgICAgICAgICAgICAgICAgICAgIGhhczogQml0cyxcbiAgICAgICAgICAgICAgICAgICAgICAgcmFuZG9tOiBSYW5kb20sXG4gICAgICAgICAgICAgICAgICAgICAgIGZsYWdzZXQ6IEZsYWdTZXQsXG4gICAgICAgICAgICAgICAgICAgICAgIGJhY2tzdGVwczogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZml4ZWQgPSBuZXcgU2V0KGZpbGwua2V5cygpKTtcbiAgICBmb3IgKGxldCBiaXQ6IEl0ZW1JbmRleCB8IHVuZGVmaW5lZCA9IGl0ZW1zLnBvcCgpOyBiaXQgIT0gbnVsbDsgYml0ID0gaXRlbXMucG9wKCkpIHtcbiAgICAgIGlmICghQml0cy5oYXMoaGFzLCBiaXQpKSBjb250aW51ZTsgLy8gaXRlbSBhbHJlYWR5IHBsYWNlZDogc2tpcFxuICAgICAgY29uc3QgaXRlbUluZm8gPSB0aGlzLml0ZW1JbmZvRnJvbUluZGV4KGJpdCk7XG4gICAgICBoYXMgPSBCaXRzLndpdGhvdXQoaGFzLCBiaXQpO1xuICAgICAgY29uc3QgcmVhY2hhYmxlID1cbiAgICAgICAgICB0aGlzLmV4cGFuZFJlYWNoYWJsZSh0aGlzLnRyYXZlcnNlKGkgPT4gZmlsbC5nZXQoaSksIGhhcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3NldCk7XG4gICAgICByYW5kb20uc2h1ZmZsZShyZWFjaGFibGUpO1xuICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XG4gICAgICBjb25zdCBjaGVja2VkID0gbmV3IFNldChmaWxsLmtleXMoKSk7XG4gICAgICBmb3IgKGNvbnN0IHNsb3Qgb2YgcmVhY2hhYmxlKSB7XG4gICAgICAgIGlmIChjaGVja2VkLmhhcyhzbG90KSkgY29udGludWU7XG4gICAgICAgIGNoZWNrZWQuYWRkKHNsb3QpO1xuICAgICAgICBjb25zdCBzbG90SW5mbyA9IHRoaXMuc2xvdEluZm9Gcm9tSW5kZXgoc2xvdCk7XG4gICAgICAgIGlmICghc2xvdEluZm8gfHwgIXRoaXMuZml0cyhzbG90SW5mbywgaXRlbUluZm8sIGZsYWdzZXQpKSBjb250aW51ZTtcbiAgICAgICAgZmlsbC5zZXQoc2xvdCwgYml0KTtcbiAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmIChmb3VuZCkgY29udGludWU7XG4gICAgICBjaGVja2VkLmNsZWFyKCk7XG4gICAgICBpZiAoYmFja3N0ZXBzLS0gPiAwKSB7XG4gICAgICAgIC8vIHRha2UgYSBiYWNrLXN0ZXBcbiAgICAgICAgZm9yIChjb25zdCBzbG90IG9mIHJlYWNoYWJsZSkge1xuICAgICAgICAgIGlmIChjaGVja2VkLmhhcyhzbG90KSB8fCAhZmlsbC5oYXMoc2xvdCkgfHwgZml4ZWQuaGFzKHNsb3QpKSBjb250aW51ZTtcbiAgICAgICAgICBjaGVja2VkLmFkZChzbG90KTtcbiAgICAgICAgICBjb25zdCBzbG90SW5mbyA9IHRoaXMuc2xvdEluZm9Gcm9tSW5kZXgoc2xvdCk7XG4gICAgICAgICAgaWYgKCFzbG90SW5mbyB8fCAhdGhpcy5maXRzKHNsb3RJbmZvLCBpdGVtSW5mbywgZmxhZ3NldCkpIGNvbnRpbnVlO1xuICAgICAgICAgIGNvbnN0IHByZXZpb3VzSXRlbSA9IGZpbGwucmVwbGFjZShzbG90LCBiaXQpID8/IGRpZSgpO1xuICAgICAgICAgIGhhcyA9IEJpdHMud2l0aChoYXMsIHByZXZpb3VzSXRlbSk7XG4gICAgICAgICAgaXRlbXMucHVzaChwcmV2aW91c0l0ZW0pO1xuICAgICAgICAgIHJhbmRvbS5zaHVmZmxlKGl0ZW1zKTtcbiAgICAgICAgICBmb3VuZCA9IHRydWU7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZvdW5kKSBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIC8vIGNvbnN0IG5zID0gKHNpOiBTbG90SW5kZXgpID0+IHRoaXMuY2hlY2tOYW1lKHRoaXMuc2xvdHMuZ2V0KHNpKSEpO1xuICAgICAgLy8gY29uc3QgbmkgPSAoaWk6IEl0ZW1JbmRleCkgPT4gdGhpcy5jaGVja05hbWUodGhpcy5pdGVtcy5nZXQoaWkpISk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhgUG9vbDpcXG4gICR7aXRlbXMubWFwKG5pKS5qb2luKCdcXG4gICcpfWApO1xuICAgICAgLy8gY29uc29sZS5sb2coYEZpbGw6XFxuICAke1suLi5maWxsXS5tYXAoKFtzLGldKSA9PiBgJHtucyhzKX06ICR7bmkoaSl9YCkuam9pbignXFxuICAnKX1gKTtcbiAgICAgIC8vIGNvbnNvbGUuZXJyb3IoYFJFUk9MTDogQ291bGQgbm90IHBsYWNlIGl0ZW0gaW5kZXggJHtiaXR9OiAke25pKGJpdCl9YCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gYWRkcyB3ZWlnaHRzXG4gIHByaXZhdGUgZXhwYW5kUmVhY2hhYmxlKHNsb3RzOiBJdGVyYWJsZTxTbG90SW5kZXg+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICBmbGFnc2V0OiBGbGFnU2V0KTogU2xvdEluZGV4W10ge1xuICAgIGNvbnN0IG91dDogU2xvdEluZGV4W10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHNsb3Qgb2Ygc2xvdHMpIHtcbiAgICAgIGNvbnN0IGluZm8gPSB0aGlzLnNsb3RJbmZvRnJvbUluZGV4KHNsb3QpO1xuICAgICAgLy8gZG9uJ3QgYm90aGVyIHdpdGggbm9uLXVuaXF1ZSBzbG90cyBhdCB0aGlzIHN0YWdlLlxuICAgICAgaWYgKCFpbmZvIHx8IGZsYWdzZXQucHJlc2VydmVVbmlxdWVDaGVja3MoKSAmJiAhaW5mby51bmlxdWUpIGNvbnRpbnVlO1xuICAgICAgYWRkQ29waWVzKG91dCwgc2xvdCwgaW5mby53ZWlnaHQgfHwgMSk7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICBwcml2YXRlIGl0ZW1Qb29sKGV4Y2x1ZGU6IEl0ZXJhYmxlPEl0ZW1JbmRleD4sIHJhbmRvbTogUmFuZG9tKTogSXRlbUluZGV4W10ge1xuICAgIGNvbnN0IGV4Y2x1ZGVTZXQgPSBuZXcgU2V0KGV4Y2x1ZGUpO1xuICAgIGNvbnN0IGFycjogSXRlbUluZGV4W10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IFtpZCwgaW5mb10gb2YgdGhpcy5pdGVtSW5mb3MpIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5pdGVtcy5pbmRleChpZCk7XG4gICAgICAvLyBza2lwIG5vbi1wcm9ncmVzc2lvbiBhbmQgYWxyZWFkeS1wbGFjZWQgaXRlbXNcbiAgICAgIGlmIChpbmRleCA9PSBudWxsKSBjb250aW51ZTtcbiAgICAgIGlmICghdGhpcy5wcm9ncmVzc2lvbi5oYXMoaWQpKSBjb250aW51ZTtcbiAgICAgIGlmIChleGNsdWRlU2V0LmhhcyhpbmRleCkpIGNvbnRpbnVlO1xuICAgICAgYWRkQ29waWVzKGFyciwgaW5kZXgsIGluZm8ud2VpZ2h0IHx8IDEpO1xuICAgIH1cbiAgICByZXR1cm4gcmFuZG9tLnNodWZmbGUoYXJyKTtcbiAgfVxuXG4gIC8vIFRPRE8gLSBpbnN0ZWFkIG9mIHBsdW1iaW5nIHRoZSBmbGFnc2V0IHRocm91Z2ggaGVyZSwgY29uc2lkZXJcbiAgLy8gYnVpbGRpbmcgaXQgaW50byB0aGUgU2xvdEluZm8/ICBPciB0aGUgSXRlbUluZm8sIHNpbmNlIGl0J3NcbiAgLy8gcG9zc2libGUgZm9yIGEgdW5pcXVlIHNsb3QgdG8gYWNjZXB0IGEgbm9udW5pcXVlIGl0ZW0sIGJ1dFxuICAvLyBhIHVuaXF1ZSBpdGVtIG11c3QgYmUgaW4gYSB1bmlxdWUgc2xvdC4uLiBzYW1lIGRpZmZlcmVuY2VcbiAgcHJpdmF0ZSBmaXRzKHNsb3Q6IFNsb3RJbmZvLCBpdGVtOiBJdGVtSW5mbywgZmxhZ3NldDogRmxhZ1NldCk6IGJvb2xlYW4ge1xuICAgIGlmIChmbGFnc2V0LnByZXNlcnZlVW5pcXVlQ2hlY2tzKCkgJiZcbiAgICAgICAgaXRlbS51bmlxdWUgJiYgIXNsb3QudW5pcXVlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChzbG90Lmxvc3N5ICYmIChpdGVtLmxvc2FibGUgJiYgaXRlbS5wcmV2ZW50TG9zcykpIHJldHVybiBmYWxzZTtcbiAgICAvLyBUT0RPIC0gZmxhZyBmb3IgXCJwcm90ZWN0IGFsbCBsb3NhYmxlIGl0ZW1zXCJcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGZpbGxOb25Qcm9ncmVzc2lvbihmaWxsOiBNdXRhYmxlQXJyYXlCaU1hcDxTbG90SWQsIEl0ZW1JZD4sXG4gICAgICAgICAgICAgICAgICAgICBmbGFnc2V0OiBGbGFnU2V0LFxuICAgICAgICAgICAgICAgICAgICAgcmFuZG9tOiBSYW5kb20pOiBNYXA8U2xvdElkLCBJdGVtSWQ+fG51bGwge1xuICAgIC8vIEZpZ3VyZSBvdXQgd2hhdCBzdGlsbCBuZWVkcyB0byBiZSBmaWxsZWQuICBXaWxsIGJlIG1vc3RseSBmaWxsZXJcbiAgICAvLyBpdGVtcy4gIEl0ZW1zIGFyZSBzcGxpdCBpbnRvIHRocmVlIGdyb3VwczogKDEpIGZpcnN0IGl0ZW1zIGlzIGFueVxuICAgIC8vIHVuaXF1ZXMgdGhhdCBuZWVkIHRvIGdvIGludG8gdW5pcXVlIHNsb3RzIChpLmUuIG9ubHkgaWYgYEV1YCBpc1xuICAgIC8vIHNldCksICgyKSBlYXJseSBpdGVtcyBpcyBhbnl0aGluZyB0aGF0IG5lZWRzIHNwZWNpYWwgdHJlYXRtZW50IHRvXG4gICAgLy8gcHJldmVudCBwbGFjZW1lbnQgaW4gYSBsb3NzeSBzbG90LCAoMykgb3RoZXIgaXRlbXMgaXMgZXZlcnl0aGluZyBlbHNlLlxuICAgIGNvbnN0IGl0ZW1QYXNzZXM6IEl0ZW1JZFtdW10gPSBbW10sIFtdLCBbXV07XG4gICAgLy8gU2xvdHMgYXJlIGJyb2tlbiBpbnRvIHR3byBwYXNzZXM6ICgxKSByZXN0cmljdGVkIGFuZCAoMikgdW5yZXN0cmljdGVkLlxuICAgIGNvbnN0IHNsb3RQYXNzZXM6IFNsb3RJZFtdW10gPSBbW10sIFtdXTtcblxuICAgIGZvciAoY29uc3QgW2l0ZW1JZCwgaW5mb10gb2YgdGhpcy5pdGVtSW5mb3MpIHtcbiAgICAgIGlmIChmaWxsLmhhc1ZhbHVlKGl0ZW1JZCkpIGNvbnRpbnVlO1xuICAgICAgbGV0IGluZGV4ID0gMjtcbiAgICAgIGlmIChpbmZvLmxvc2FibGUgJiYgaW5mby5wcmV2ZW50TG9zcykgaW5kZXggPSAxO1xuICAgICAgaWYgKGZsYWdzZXQucHJlc2VydmVVbmlxdWVDaGVja3MoKSAmJiBpbmZvLnVuaXF1ZSkgaW5kZXggPSAwO1xuICAgICAgaXRlbVBhc3Nlc1tpbmRleF0ucHVzaChpdGVtSWQpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtzbG90SWQsIGluZm9dIG9mIHRoaXMuc2xvdEluZm9zKSB7XG4gICAgICBpZiAoZmlsbC5oYXMoc2xvdElkKSkgY29udGludWU7XG4gICAgICBjb25zdCBpbmRleCA9IGluZm8ubG9zc3kgJiYgaW5mby5wcmV2ZW50TG9zcyA/IDAgOiAxO1xuICAgICAgc2xvdFBhc3Nlc1tpbmRleF0ucHVzaChzbG90SWQpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHBhc3Mgb2YgWy4uLml0ZW1QYXNzZXMsIC4uLnNsb3RQYXNzZXNdKSB7XG4gICAgICByYW5kb20uc2h1ZmZsZShwYXNzKTtcbiAgICB9XG5cbiAgICBjb25zdCBuID0gKHNpOiBudW1iZXIpID0+IHRoaXMuY2hlY2tOYW1lKHNpKTtcbiAgICBjb25zdCBzYyA9IGl0ZXJzLmNvdW50KGl0ZXJzLmNvbmNhdCguLi5zbG90UGFzc2VzKSk7XG4gICAgY29uc3QgaWMgPSBpdGVycy5jb3VudChpdGVycy5jb25jYXQoLi4uaXRlbVBhc3NlcykpO1xuICAgIGlmIChpYyA+IHNjKSB7XG4gICAgICBjb25zb2xlLmxvZyhgU2xvdHMgJHtzY306XFxuICAke1suLi5pdGVycy5jb25jYXQoLi4uc2xvdFBhc3NlcyldLm1hcChuKS5qb2luKCdcXG4gICcpfWApO1xuICAgICAgY29uc29sZS5sb2coYEl0ZW1zICR7aWN9OlxcbiAgJHtbLi4uaXRlcnMuY29uY2F0KC4uLml0ZW1QYXNzZXMpXS5tYXAobikuam9pbignXFxuICAnKX1gKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVG9vIG1hbnkgaXRlbXNgKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZXJzLmNvbmNhdCguLi5pdGVtUGFzc2VzKSkge1xuICAgICAgLy8gVHJ5IHRvIHBsYWNlIHRoZSBpdGVtLCBzdGFydGluZyB3aXRoIGVhcmxpZXMgZmlyc3QuXG4gICAgICAvLyBNaW1pY3MgY29tZSBiZWZvcmUgY29uc3VtYWJsZXMgYmVjYXVzZSB0aGVyZSdzIGZld2VyIHBsYWNlcyB0aGV5IGNhbiBnby5cbiAgICAgIC8vIFNpbmNlIGtleSBzbG90cyBhcmUgYWxsb3dlZCB0byBjb250YWluIGNvbnN1bWFibGVzIChldmVuIGluIGZ1bGwgc2h1ZmZsZSksXG4gICAgICAvLyB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0IHRoZSB1bmlxdWVzIGdvIGludG8gdGhvc2Ugc2xvdHMgZmlyc3QuXG4gICAgICBsZXQgZm91bmQgPSBmYWxzZTtcbiAgICAgIGZvciAoY29uc3Qgc2xvdHMgb2YgWy4uLnNsb3RQYXNzZXNdKSB7XG4gICAgICAgIGlmIChmb3VuZCkgYnJlYWs7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2xvdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAodGhpcy5maXRzKHRoaXMuc2xvdEluZm9zLmdldChzbG90c1tpXSkhLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtSW5mb3MuZ2V0KGl0ZW0pISwgZmxhZ3NldCkpIHtcbiAgICAgICAgICAgIGZpbGwuc2V0KHNsb3RzW2ldLCBpdGVtKTtcbiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIHNsb3RzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAvLyBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZmlsbCBleHRyYSBpdGVtICR7aXRlbX0uIFNsb3RzOiAke2Vhcmx5U2xvdHN9LCAke290aGVyU2xvdHN9YCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGBTbG90czpcXG4gICR7Wy4uLml0ZXJzLmNvbmNhdCguLi5zbG90UGFzc2VzKV0ubWFwKG4pLmpvaW4oJ1xcbiAgJyl9YCk7XG4gICAgICAgIC8vY29uc29sZS5sb2coYEZpbGw6XFxuICAke1suLi5maWxsXS5tYXAoKFtzLGldKSA9PiBgJHtucyhzKX06ICR7bmkoaSl9YCkuam9pbignXFxuICAnKX1gKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihgUkVST0xMOiBDb3VsZCBub3QgcGxhY2UgaXRlbSAke24oaXRlbSl9YCk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3IE1hcChmaWxsKTtcbiAgfVxuXG4gIC8vIE5PVEU6IGZvciBhbiBJbmRleEZpbGwsIHRoaXMgaXMganVzdCBnZXQoKSwgYnV0IGZvclxuICAvLyBhbiBJZEZpbGwsIHdlIG5lZWQgdG8gbWFwIGl0IGJhY2sgYW5kIGZvcnRoLi4uXG4gIHRyYXZlcnNlKGZpbGw6IChzbG90OiBTbG90SW5kZXgpID0+IEl0ZW1JbmRleHx1bmRlZmluZWQsXG4gICAgICAgICAgIGhhczogQml0cyxcbiAgICAgICAgICAgcGF0aD86IG51bWJlcltdW10pOiBTZXQ8U2xvdEluZGV4PiB7XG4gICAgaGFzID0gQml0cy5jbG9uZShoYXMpO1xuICAgIGNvbnN0IHJlYWNoYWJsZSA9IG5ldyBTZXQ8U2xvdEluZGV4PigpO1xuICAgIGNvbnN0IHF1ZXVlID0gbmV3IFNldDxTbG90SW5kZXg+KCk7XG4gICAgZm9yIChsZXQgaSA9IDAgYXMgU2xvdEluZGV4OyBpIDwgdGhpcy5zbG90cy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHRoaXMuZ3JhcGguZ2V0KGkpID09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5kaXIodGhpcyk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5yZWFjaGFibGUgc2xvdCAke2l9YCk7XG4gICAgICB9XG4gICAgICBxdWV1ZS5hZGQoaSBhcyBTbG90SW5kZXgpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IG4gb2YgcXVldWUpIHtcbiAgICAgIHF1ZXVlLmRlbGV0ZShuKTtcbiAgICAgIGlmIChyZWFjaGFibGUuaGFzKG4pKSBjb250aW51ZTtcbiAgICAgIC8vIGNhbiB3ZSByZWFjaCBpdD9cbiAgICAgIGNvbnN0IG5lZWRlZCA9IHRoaXMuZ3JhcGguZ2V0KG4pO1xuICAgICAgaWYgKG5lZWRlZCA9PSBudWxsKSB0aHJvdyBuZXcgRXJyb3IoYE5vdCBpbiBncmFwaDogJHtufWApO1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IG5lZWRlZC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICBpZiAoIUJpdHMuY29udGFpbnNBbGwoaGFzLCBuZWVkZWRbaV0pKSBjb250aW51ZTtcbiAgICAgICAgaWYgKHBhdGgpIHBhdGgucHVzaChbbiwgLi4uQml0cy5iaXRzKG5lZWRlZFtpXSldKTtcbiAgICAgICAgcmVhY2hhYmxlLmFkZChuKTtcbiAgICAgICAgLy8gVE9ETyAtLS0gbmVlZCB0byBmaWd1cmUgb3V0IHdoYXQgdG8gZG8gaGVyZS5cbiAgICAgICAgLy8gICAgICAtLS0gZmlsbCB3b3VsZCBsaWtlIHRvIGJlIHplcm8tYmFzZWQgYnV0IGRvZXNuJ3QgbmVlZCB0byBiZS5cbiAgICAgICAgLy8gICAgICAgICAgY291bGQgdXNlIGEgc2ltcGxlIHBhaXIgb2YgTWFwcywgcG9zc2libHk/XG4gICAgICAgIC8vICAgICAgICAgIG9yIGZyb250LWxvYWQgdGhlIGl0ZW1zP1xuICAgICAgICAvLyAgIHNsb3RzOiAxeHggb3RoZXJzXG4gICAgICAgIC8vICAgaXRlbXM6IDJ4eCBvdGhlcnNcbiAgICAgICAgLy8gYnV0IHdlIHdhbnQgc2FtZSBmbGFncyB0byBoYXZlIHNhbWUgaW5kZXhcbiAgICAgICAgLy8gICBzbG90czogKGZpeGVkKSAocmVxdWlyZWQgc2xvdHMpIChleHRyYSBzbG90cylcbiAgICAgICAgLy8gICBpdGVtczogKGZpeGVkKSAocmVxdWlyZWQgc2xvdHMpIChpdGVtcylcbiAgICAgICAgLy8gaWYgbiBpcyBhIHNsb3QgdGhlbiBhZGQgdGhlIGl0ZW0gdG8gaGFzLlxuICAgICAgICBjb25zdCBpdGVtczogSXRlbUluZGV4W10gPSBbXTtcbiAgICAgICAgaWYgKG4gPCB0aGlzLmNvbW1vbikgaXRlbXMucHVzaChuIGFzIG51bWJlciBhcyBJdGVtSW5kZXgpO1xuICAgICAgICBjb25zdCBmaWxsZWQgPSBmaWxsKG4pO1xuICAgICAgICBpZiAoZmlsbGVkICE9IG51bGwpIGl0ZW1zLnB1c2goZmlsbGVkKTtcbiAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICAgICAgaGFzID0gQml0cy53aXRoKGhhcywgaXRlbSk7XG4gICAgICAgICAgZm9yIChjb25zdCBqIG9mIHRoaXMudW5sb2Nrcy5nZXQoaXRlbSkgfHwgW10pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmdyYXBoLmdldChqKSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZGlyKHRoaXMpO1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEFkZGluZyBiYWQgbm9kZSAke2p9IGZyb20gdW5sb2NrICR7aXRlbX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHF1ZXVlLmFkZChqKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZWFjaGFibGU7XG4gIH1cblxuICBleHBhbmRGaWxsKGluZGV4RmlsbDogTXV0YWJsZUFycmF5QmlNYXA8U2xvdEluZGV4LCBJdGVtSW5kZXg+LFxuICAgICAgICAgICAgIGZpbGw6IE11dGFibGVBcnJheUJpTWFwPFNsb3RJZCwgSXRlbUlkPikge1xuICAgIGZvciAoY29uc3QgW3Nsb3RJbmRleCwgaXRlbUluZGV4XSBvZiBpbmRleEZpbGwpIHtcbiAgICAgIGNvbnN0IHNsb3RJZCA9IHRoaXMuc2xvdHMuZ2V0KHNsb3RJbmRleCk7XG4gICAgICBjb25zdCBpdGVtSWQgPSB0aGlzLml0ZW1zLmdldChpdGVtSW5kZXgpO1xuICAgICAgaWYgKHNsb3RJZCA9PSBudWxsIHx8IGl0ZW1JZCA9PSBudWxsKSB0aHJvdyBuZXcgRXJyb3IoYG1pc3NpbmdgKTtcbiAgICAgIGZpbGwucmVwbGFjZShzbG90SWQsIGl0ZW1JZCk7XG4gICAgfVxuICB9XG5cbiAgY29tcHJlc3NGaWxsKGZpbGw6IE11dGFibGVBcnJheUJpTWFwPFNsb3RJZCwgSXRlbUlkPik6XG4gIE11dGFibGVBcnJheUJpTWFwPFNsb3RJbmRleCwgSXRlbUluZGV4PiB7XG4gICAgY29uc3QgaW5kZXhGaWxsID0gbmV3IE11dGFibGVBcnJheUJpTWFwPFNsb3RJbmRleCwgSXRlbUluZGV4PigpO1xuICAgIGZvciAoY29uc3QgW3Nsb3RJZCwgaXRlbUlkXSBvZiBmaWxsKSB7XG4gICAgICBjb25zdCBzbG90SW5kZXggPSB0aGlzLnNsb3RzLmluZGV4KHNsb3RJZCk7XG4gICAgICBjb25zdCBpdGVtSW5kZXggPSB0aGlzLml0ZW1zLmluZGV4KGl0ZW1JZCk7XG4gICAgICBpZiAoc2xvdEluZGV4ID09IG51bGwgfHwgaXRlbUluZGV4ID09IG51bGwpIHtcbiAgICAgICAgLy8gVE9ETyAtIHRoaXMgaXMgbm90IHVucmVhc29uYWJsZSAtIHdlIGNhbiBwcmUtZmlsbCBhIHNsb3QgKGFsd2F5c1xuICAgICAgICAvLyB0cmFja2VkKSB3aXRoIGEgbm9uLXByb2dyZXNzaW9uIGl0ZW0uLi4gaG93IHRvIGhhbmRsZT8gd2hhdCB0byBtYXBcbiAgICAgICAgLy8gdG8/ICBDYW4gd2UgbWFrZSB1cCBhIGR1bW15IGluZGV4IG9yIHNvbWV0aGluZz9cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYEJhZCBzbG90L2l0ZW06ICR7c2xvdElkfSAke3Nsb3RJbmRleH0gJHtpdGVtSWR9ICR7aXRlbUluZGV4fWApO1xuICAgICAgfVxuICAgICAgaW5kZXhGaWxsLnNldChzbG90SW5kZXgsIGl0ZW1JbmRleCk7XG4gICAgfVxuICAgIHJldHVybiBpbmRleEZpbGw7XG4gIH1cblxuICBjaGVja05hbWUoaWQ6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMud29ybGRzW2lkID4+PiAyNF0uY2hlY2tOYW1lKGlkICYgMHhmZmZmZmYpO1xuICB9XG5cbiAgcHJlZmlsbChmaWxsOiBNdXRhYmxlQXJyYXlCaU1hcDxTbG90SWQsIEl0ZW1JZD4sIHJhbmRvbTogUmFuZG9tKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLndvcmxkcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgd29ybGRJZCA9IGkgPDwgMjQ7XG4gICAgICBjb25zdCB3b3JsZEZpbGwgPSB0aGlzLndvcmxkc1tpXS5wcmVmaWxsKHJhbmRvbSk7XG4gICAgICBmb3IgKGNvbnN0IFtzbG90LCBpdGVtXSBvZiB3b3JsZEZpbGwpIHtcbiAgICAgICAgZmlsbC5zZXQoKHdvcmxkSWQgfCBzbG90KSBhcyBTbG90SWQsICh3b3JsZElkIHwgaXRlbSkgYXMgSXRlbUlkKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpdGVtSW5mb0Zyb21JbmRleChpdGVtOiBJdGVtSW5kZXgpOiBJdGVtSW5mbyB7XG4gICAgY29uc3QgaWQgPSB0aGlzLml0ZW1zLmdldChpdGVtKTtcbiAgICBpZiAoaWQgPT0gbnVsbCkgdGhyb3cgbmV3IEVycm9yKGBCYWQgaXRlbTogJHtpdGVtfWApO1xuICAgIHJldHVybiB0aGlzLml0ZW1JbmZvRnJvbUlkKGlkKTtcbiAgfVxuXG4gIGl0ZW1JbmZvRnJvbUlkKGlkOiBJdGVtSWQpOiBJdGVtSW5mbyB7XG4gICAgY29uc3QgaW5mbyA9IHRoaXMuaXRlbUluZm9zLmdldChpZCk7XG4gICAgaWYgKGluZm8gPT0gbnVsbCkgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIGluZm86ICR7aGV4KGlkKX1gKTtcbiAgICByZXR1cm4gaW5mbztcbiAgfVxuXG4gIHNsb3RJbmZvRnJvbUluZGV4KHNsb3Q6IFNsb3RJbmRleCk6IFNsb3RJbmZvfHVuZGVmaW5lZCB7XG4gICAgY29uc3QgaWQgPSB0aGlzLnNsb3RzLmdldChzbG90KTtcbiAgICBpZiAoaWQgPT0gbnVsbCkgdGhyb3cgbmV3IEVycm9yKGBCYWQgc2xvdDogJHtzbG90fWApO1xuICAgIHJldHVybiB0aGlzLnNsb3RJbmZvRnJvbUlkKGlkKTtcbiAgfVxuXG4gIHNsb3RJbmZvRnJvbUlkKGlkOiBTbG90SWQpOiBTbG90SW5mb3x1bmRlZmluZWQge1xuICAgIGNvbnN0IGluZm8gPSB0aGlzLnNsb3RJbmZvcy5nZXQoaWQpO1xuICAgIGlmIChpbmZvICE9IG51bGwpIHJldHVybiBpbmZvO1xuICAgIC8vIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyBpbmZvOiAke2hleChpZCl9YCk7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZGRDb3BpZXM8VD4oYXJyOiBUW10sIGVsZW06IFQsIGNvcGllczogbnVtYmVyKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY29waWVzOyBpKyspIHtcbiAgICBhcnIucHVzaChlbGVtKTtcbiAgfVxufVxuXG5cbi8vIFRPRE8gLSBjbGVhbiB0aGlzIHVwXG5pbnRlcmZhY2UgUHJvZ3Jlc3NUcmFja2VyIHtcbiAgYWRkVGFza3ModGFza3M6IG51bWJlcik6IHZvaWQ7XG4gIGFkZENvbXBsZXRlZCh0YXNrczogbnVtYmVyKTogdm9pZDtcbn1cbiJdfQ==