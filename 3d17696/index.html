<!DOCTYPE html>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131783670-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131783670-1');
</script>
<title>Crystalis Randomizer</title>
<!--base-->
<link rel="stylesheet" href="main.css">
<script type="module" src="main.js"></script>
<script>
// Display a message if the main script hasn't already removed it.
setTimeout(function() {
  if (!document.body.classList.contains('js-works')) {
    document.body.classList.add('js-broken');
  }
}, 1000);
</script>

<nav>
  <img src="images/crystalis-sword.png">
  <a href="index">Play</a>
  <a href="track">Track</a>
  <a href="help">Help</a>
  <!-- TODO: better process for stable version numbers. -->
  <span id="version"></span>
</nav>
<div></div>

<main>
  <section>
    <h1>Introduction</h1>
    <div>
      <p>Welcome to Crystalis Randomizer.  This project seeks to
        provide fresh gameplay experiences through the class NES game
        Crystalis.  See the <a href="help">help</a> for more
        information about gameplay changes and randomization features.
    </div>
  </section>

  <section id="js-notice" class="if-js-broken warning">
    <h1>Warning</h1>
    <div>
      <p>You are attempting to use this randomizer with an unsupported browser
      (or else the JavaScript is taking an inordinately long time to load
      or has an error).  Currently only recent versions of
      <a href="https://google.com/chrome">Google Chrome</a> have been verified
      to work correctly.  Stay tuned for updates that may work in other browsers.
    </div>
  </section>

  <section id="getting-started" class="if-js-works">
    <h1>Getting Started</h1>
    <div>
      <p>Please select a standard English ROM of Crystalis.  This should only be         required the first time.  The selected image will be stored in your
         browser's cache.
      <p><label class="file-picker button">
        Select Crystalis ROM File
        <input type="file" accept=".nes" id="pick-file" style="display: none;">
      </label>
      <span class="file-picker-result"></span>
    </div>
  </section>

  <section id="checksum-warning" class="if-rom-broken warning">
    <h1>Warning</h1>
    <div>
      The selected rom image is not recognized.  The randomization may not work
      correctly, and the identification stamp will be different.  Please select
      a new rom image above.
    </div>
  </section>

  <section id="flags" class="if-rom-uploaded">
    <h1>Presets</h1>
    <div>
      <p>For a quick start, consider using one of the following presets, or else
      typing in a custom flag string.  Note that the "apply" button must be pressed
      before a selection takes effect.

      <div>
        <select id="preset">
          <option data-flags="" data-text="">--</option>
          <!-- TODO: Ex -->
          <option data-flags="Emr Mr Rf Sbk Sc Sm Tasd"
                  data-text="Basic flags for a relatively easy playthrough.">
            Casual
          </option>
          <option data-flags="Em Gt Mr Rlpt Sbk Sct Sm Tasd"
                  data-text="Slightly more challenge than Casual but still approachable." selected>
            Intermediate
          </option> <!-- TODO: Ht -->
          <option data-flags="Gfrt Hbw Mr Rlpt Sbckt Sm Tasd"
                  data-text="A balanced randomization with quite a bit more difficulty.">
            Advanced
          </option> <!-- TODO: Htx -->
          <option data-flags="Gfrstw Hbgmsw Mr Rflpt Sbckmt Tas"
                  data-text="Pulls out all the stops, and may require horrible hell runs.">
            Ludicrous
          </option>
          <option data-flags="" data-text="Clear all options">Clear all</option>
        </select>
      </div>
      <div id="preset-explanation"></div>
      <div class="flex-row">
        <input id="flagstring" spellcheck="false" type="text"
               placeholder="(enter custom flagstring here)">
        <a id="preset-apply" class="button" href="javascript:">Apply</a>
      </div>
      <!-- TODO - consider a visual warning for invalid flag strings -->
    </div>
  </section>

  <section id="select-options" class="if-rom-uploaded expandable">
    <h1>Flags</h1>
    <div>
      Please review and adjust your flag selections below. Flags in
      <span class="hard">red*</span> are considered "hard" settings
      and are not recommended for new players.

      <!-- TODO - two columns? -->
      <h2>Items</h2>
      <p>Items are broken into five pools: <i>key items</i> includes all
      swords, orbs, bracelets, and progression items (rabbit boots,
      gas mask, and all items in the third row: windmill key through
      bow of truth), as well as anything dropped by a boss (one each
      of fruit of power, opel statue, fruit of repun, sacred shield,
      and psycho armor); <i>bonus items</i> includes items that are
      never required but are nice to have, specifically the remaining
      six passive effect items in the second inventory row; <i>consumable
      items</i> includes everything else found in chests: primarily first
      row one-use items, but also includes psycho shield and battle armor;
      <i>magic</i> is the eight spells; and <i>mimics</i> are the 12 trap
      chests found in various places. These pools can be shuffled together,
      kept separate, or left unshuffled.

      <div class="flag-list">
        <div class="checkbox">Sk: Shuffle key items</div>
        <div class="checkbox">Sm: Shuffle magics</div>
        <div class="checkbox">Sb: Shuffle bonus items</div>
        <div class="checkbox">Sc: Shuffle consumables</div>
        <div class="checkbox hard">Sbc: Shuffle bonus items with consumables</div>
        <div class="checkbox">Sbk: Shuffle key items with bonus items</div>
        <div class="checkbox">Sbt: Shuffle bonus items with traps</div>
        <div class="checkbox">Sct: Shuffle consumables with traps</div>
        <div class="checkbox hard">Sbct: Shuffle bonus, consumables, and traps</div>
        <div class="checkbox">Skt: Shuffle key items with traps</div>
        <div class="checkbox">Skm: Shuffle key items with magic</div>
        <div class="checkbox">Skmt: Shuffle key items and magic with traps</div>
        <div class="checkbox">Sbkt: Shuffle bonus and key items with traps</div>
        <div class="checkbox hard">Sbckt: Shuffle bonus, key, consumables, and traps</div>
        <div class="checkbox">Sbkmt: Shuffle bonus, key, magic, and traps</div>
        <div class="checkbox hard">Sbckmt: Shuffle all items and traps together</div>
      </div>
      <!-- TODO - Ss: Shuffle shops -->

      <h2>Monsters</h2>
      <div class="flag-list">
        <div class="checkbox">Mr: Randomize monsters
          <div class="flag-body">
            Monster locations are shuffled, with the exception of sea creatures
            and tower robots.
            <!-- <div class="checkbox hard">Mr: No safety checks</div> -->
            <!-- <div class="flag-body"> -->
            <!--   Normally there are some reasonability limits on the monsters -->
            <!--   that can be shuffled (flyers only in larger areas, and at most -->
            <!--   one or two; (future: large monsters and flail swingers don't -->
            <!--   crowd out small hallways, etc), but these checks can be disabled -->
            <!--   for extra craziness and challenge. -->
            <!-- </div> -->
          </div>
        </div>
        <!-- <div class="checkbox bad">Ms: Don't scale monster difficulty</div> -->
        <!-- <div class="flag-body"> -->
        <!--   Monster difficulty normally scales with game progression rather -->
        <!--   than being hard-coded based on location to ensure that monsters -->
        <!--   stay relevant throughout the game.  The current difficulty level -->
        <!--   can be seen next to the player's experience level on the right -->
        <!--   side of the HUD.  This scaling can be turned off, but it is not -->
        <!--   recommended. -->
        <!-- </div> -->
      </div>

      <h2>Hard mode</h2>
      <div class="flag-list">
        <div class="checkbox hard">Hw: Battle magic not guaranteed
          <div class="flag-body">
            Normally, the logic will guarantee that level 3 sword charges are
            available before fighting the tetrarchs (with the exception of Karmine,
            who only requires level 2).  This disables that check.
          </div>
        </div>

        <div class="checkbox hard">Hb: Barrier not guaranteed
          <div class="flag-body">
            Normally, the logic will guarantee Barrier (or else refresh and shield
            ring) before entering Stxy, the Fortress, or fighting Karmine.  This
            disables that check.      
          </div>
        </div>

        <div class="checkbox hard">Hm: Don't buff medical herb
          <div class="flag-body">
            Medical herb is not buffed to heal 64 damage, which is helpful to make
            up for cases where Refresh is unavailable early.
          </div>
        </div>

        <div class="checkbox hard">Hg: Gas mask not guaranteed
          <div class="flag-body">
            The logic will not guarantee gas mask before needing to enter the swamp.
          </div>
        </div>

        <div class="checkbox hard">Hs: Matching sword not guaranteed
          <div class="flag-body">
            Player may be required to fight bosses with the wrong sword.
          </div>
        </div>

        <!-- <div class="checkbox hard">Ht: Max out scaling level in tower -->
        <!--   <div class="flag-body"> -->
        <!--     Scaling level immediately maxes out upon stepping into tower. -->
        <!--   </div> -->
        <!-- </div> -->

        <!-- <div class="checkbox hard">Hx: Experience scales slower -->
        <!--   <div class="flag-body"> -->
        <!--     Morw griding will be reuired for comparable level -->
        <!--   </div> -->
        <!-- </div> -->
      </div>


      <!-- <h2>Weapons, armor, and item balance</h2> -->
      <!-- <div class="checkbox">W: Normalize weapons and armor</div> -->
      <!-- <div class="flag-body"> -->
      <!--   Sword attack values no longer depend on element, but instead on the -->
      <!--   number of orb/bracelet upgrades: just the sword is 2; sword plus one -->
      <!--   upgrade is 4; sword plus both upgrades is 8.  Stab damage is always -->
      <!--   fixed at 2, rather than effectively doubling the sword's base damage. -->
      <!--   Enemies no longer have minimum player level requirements.  All sword -->
      <!--   hits will now do at least one damage (when a hit "pings", exactly one -->
      <!--   damage is dealt), so no enemy is unkillable. -->

      <!--   <p>Base armor/shield defense is halved, and capped at twice the player -->
      <!--   level, so that (a) player level has more impact, and (b) really good -->
      <!--   armors aren't overpowered in early game. -->
      <!-- </div> -->

      <!-- <div class="checkbox">Wp: Nerf power ring</div> -->
      <!-- <div class="flag-body"> -->
      <!--   TODO - don't necessarily want to require clicking through to get -->
      <!--   full list of changes, but also want to document in various places -->
      <!--   and want reasonable defaults. -->
      <!-- </div> -->

      <h2>Tweaks</h2>
      <div class="flag-list">
        <div class="checkbox">Ta: Automatically equip orbs and bracelets
          <div class="flag-body">
            Adds a quality-of-life improvement to automatically equip the
            corresponding orb/bracelet whenever changing swords.
          </div>
        </div>
        <div class="checkbox">Ts: Leather boots are speed boots
          <div class="flag-body">
            Wearing leather boots increases player walking speed.  Note that this also
            includes a slight change to routing logic, since speed boots will allow
            climbing the slope in Mt. Sabre West to reach the Tornado Bracelet chest.
          </div>
        </div>
        <div class="checkbox">Td: Deo's pendant works while moving</div>
        <div class="checkbox">Tw: Disable wild warp</div>
        <!-- TODO - options for EXP and teleport out of tower? -->
      </div>

      <h2>Routing</h2>
      <div class="flag-list">
        <div class="checkbox">Rf: Early flight
          <div class="flag-body">
            Does not directly change where flight will be, but causes the logic
            to understand all the things flight unlocks, which tends to have the
            effect of making it show up very early and obsoleting a large number
            of other items before they're even found.  By turning this off, the
            logic will only take into account spots where flight is absolutely
            required, leveling the playing field a bit compared with other magic.
          </div>
        </div>

        <div class="checkbox">Rt: Sword of Thunder teleports to Shyron
          <div class="flag-body">
            Normally when acquiring the thunder sword, the player is instantly
            teleported to Shyron. This flag maintains that behavior regardless of
            where it is found (immediately activating the warp point; talking
            to Asina will teleport back to the start, in case no other means of
            return is available).  Disabling this flag means that the Sword of
            Thunder will act like all other items and not teleport.
          </div>
        </div>

        <div class="checkbox">Rd: Require healing dolphin to return fog lamp
          <div class="flag-body">
            Normally the fog lamp cannot be returned without healing the dolphin
            to acquire the shell flute (so as not to be stranded).  Continuity
            suggests that actually healing the dolphin should also be required,
            but we've found that this makes the dolphin a lot less useful.  By
            default the fog lamp can be returned before healing the dolphin.  This
            flag adds the extra requirement for better continuity.
          </div>
        </div>

        <div class="checkbox">Rp: Wind-waterfall passage
          <div class="flag-body">
            Opens a passage between Valley of Wind (lower right side) and
            Lime Tree Valley.
          </div>
        </div>

        <div class="checkbox">Rl: No "free lunch" magic
          <div class="flag-body">
            Disables "free lunch" magics that only require stepping on a square to
            learn (specifally Barrier, TODO: Paralysis).  Instead, Barrier requires
            the seas to be calmed, and Paralysis will (once implemented) require the
            prison door to have been opened.
          </div>
        </div>
      </div>


      <h2>Glitches</h2>
      <p>The routing logic can be made aware of the following
      glitches.  If selected, it will assume that the glitch can be
      performed when verifying that a game is winnable.  Enabling
      these glitches tends to increase the randomness of the shuffle,
      since there are more valid options.
      <div class="flag-list">
        <div class="checkbox">Gf: Ghetto flight may be required
          <div class="flag-body">
            Progression may require using Rabbit Boots and the dolphin to reach Swan
            before the Angry Sea can be calmed and before Flight is available.
          </div>
        </div>

        <div class="checkbox">Gr: Rabbit skip may be required
          <div class="flag-body">
            Progression may require entering Mt. Sabre North from Cordel Plain with
            only the Teleport spell, without having triggered the Leaf villagers'
            abduction and talking to the rabbit (with Telepathy).
          </div>
        </div>

        <div class="checkbox">Gt: Talk glitch may be required
          <div class="flag-body">
            Progression may require glitching past guards without Change or Paralysis,
            or people turned to stone without a Flute of Lime.  The logic <i>hopefully</i>
            ensures that using the Flute of Lime on the two statues will not break the
            game, but we're less confident that this is always the case, so for safety
            we recommend always glitching past the statues if this option is set, even if
            the first Flute of Lime has been found.
          </div>
        </div>

        <div class="checkbox hard">Gs: Sword charge glitch may be required
          <div class="flag-body">
            Progression may require using the sword charge glitch to destroy walls or
            form bridges without actually possessing the correct orb.
          </div>
        </div>

        <div class="checkbox hard">Gw: Wild warp may be required
          <div class="flag-body">
            Progression may require using "wild warp" (holding A and B on controller 1
            and tapping A on controller 2) to travel to parts of the game that would
            otherwise be unreachable.
          </div>
        </div>
      </div>

      <h2>Easy Mode</h2>
      <p>The following options make parts of the game easier.
      <div class="flag-list">
        <div class="checkbox">Er: Guarantee refresh
          <div class="flag-body">
            Guarantees the Refresh spell will be available before fighting Tetrarchs.
          </div>
        </div>

        <div class="checkbox">Em: Extra buff medical herb
          <div class="flag-body">
            Buff medical herb to heal 96 instead of 64.
          </div>
        </div>

        <!-- <div class="checkbox">Ex: Experience scales faster -->
        <!--   <div class="flag-body"> -->
        <!--     Less grinding will be required to "keep up" with the game difficulty. -->
        <!--   </div> -->
        <!-- </div> -->
      </div>

      <h2>Debug Mode</h2>
      <p>These options are helpful for exploring or debugging.  Note
      that, while they do not directly affect any randomization,
      they <i>do</i> factor into the seed to prevent cheating.
      <div class="flag-list">
        <div class="checkbox">Ds: Generate a spoiler log</div>
        <div class="checkbox">Di: Player never dies</div>
        <!-- TODO - quick itemget/teleport options? -->
      </div>
    </div>
      
  </section>

  <section class="if-rom-uploaded">
    <h1>Generate</h1>
    <div>
      <h2>Seed</h2>
      <p>You may specify a seed for the random number generator, if
        desired.  If it is left blank, a new seed will be chosen at
        random each time.  Use the 'new' button to generate a
        shareable seed, which will be automatically added to the URL.
      <div class="flex-row">
        <input id="seed" type="text">
        <a id="new-seed" class="button">New</a>
      </div>
      <h2></h2>
      <div class="flex-row">
        <a id="generate" class="button">Generate</a>
        <a id="spoiler" class="button if-spoiled">Spoiler</a>
        <progress class="if-shuffling" id="progress" max="1"></progress>
        <!-- a id="share" class="button">Share</a -->
      </div>
      <p>
        Your flag string is <span id="flagstring-out"></span>
    </div>
  </section>

  <section class="if-spoiled expandable">
    <h1>Spoiler Log</h1>
    <div>
      <h2>Item Placement</h2>
      <ul id="spoiler-items">
        <li>Generate or seed or spoiler log to populate...
      </ul>
      <!--
      <h2>Enemy Placement</h2>
      <ul id="spoiler-enemies">
        <li>Generate or seed or spoiler log to populate...
      </ul>
      -->
      <h2>Route</h2>
      <ul id="spoiler-route">
        <li>Generate or seed or spoiler log to populate...
      </ul>
    </div>
  </section>
</main>
