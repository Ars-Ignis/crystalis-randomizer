import { Location } from '../rom/location.js';
import { DefaultMap } from '../util.js';
const connMap = new Map([
    ['stair:up', 'C'],
    ['edge:top', 'N'],
    ['edge:left', 'W'],
    ['edge:right', 'E'],
    ['cave', 'C'],
    ['door', 'C'],
    ['door2', 'C'],
    ['door3', 'C'],
    ['fortress', 'F'],
]);
const connInverse = new Map([
    ['N', 'S'],
    ['S', 'N'],
    ['E', 'W'],
    ['W', 'E'],
    ['C', 'X'],
    ['X', 'C'],
    ['F', 'O'],
    ['O', 'F'],
]);
function makeExit(loc, [pos, type, [revLocPos, revType]]) {
    let conn = connMap.get(type) || connInverse.get(connMap.get(revType));
    let shuffle = false;
    const area = loc.id.toString(16);
    const key = (loc.id << 8 | pos).toString(16) + ' ' + type;
    const revLoc = loc.rom.locations[revLocPos >>> 8];
    const revPos = revLocPos & 0xff;
    const revKey = revLocPos.toString(16) + ' ' + revType;
    const revArea = revLoc.id.toString(16);
    const reverse = {
        loc: revLoc, pos: revPos, type: revType,
        area: revArea, key: revKey, reverse: null,
        get conn() { return connInverse.get(conn); },
        set conn(c) { conn = connInverse.get(c); },
        get shuffle() { return shuffle; },
        set shuffle(s) {
            if (s && !conn)
                throw new Error(`shuffle without conn`);
            shuffle = s;
        },
    };
    const exit = {
        loc, pos, type, key, reverse, area,
        get conn() { return conn; },
        set conn(c) { conn = c; },
        get shuffle() { return shuffle; },
        set shuffle(s) {
            if (s && !conn)
                throw new Error(`shuffle without conn`);
            shuffle = s;
        },
    };
    reverse.reverse = exit;
    return exit;
}
function matchExit(exit, finder) {
    if (typeof finder === 'string')
        return exit.type === finder;
    if (typeof finder === 'number')
        return exit.pos === finder;
    if (finder instanceof Location)
        return exit.reverse.loc === finder;
    return finder.every(f => matchExit(exit, f));
}
export function shuffleAreas(rom, flags, random) {
    if (!flags.shuffleAreas())
        return;
    const { locations: loc } = rom;
    const exits = new Map();
    const exitsByLocation = new DefaultMap(() => []);
    for (const location of rom.locations) {
        for (const exitSpec of location.meta.exits()) {
            const exit = makeExit(location, exitSpec);
            if (exits.has(exit.key))
                continue;
            if (exits.has(exit.reverse.key)) {
                throw new Error(`Inconsistent exits: ${exit.key} ${exit.reverse.key}`);
            }
            exits.set(exit.key, exit);
            exits.set(exit.reverse.key, exit.reverse);
            exitsByLocation.get(exit.loc).push(exit);
            exitsByLocation.get(exit.reverse.loc).push(exit.reverse);
        }
    }
    function findExits(location, ...finders) {
        const out = [];
        for (const exit of exitsByLocation.get(location)) {
            for (const finder of finders) {
                if (matchExit(exit, finder)) {
                    out.push(exit);
                    break;
                }
            }
        }
        return out;
    }
    if (flags.shuffleHouses()) {
        for (const exit of findExits(loc.ValleyOfWind, 'door', 'windmill')) {
            exit.area = 'windmill';
        }
    }
    for (const exit of findExits(loc.AngrySea, 0x64)) {
        exit.area = 'lighthouse';
    }
    findExits(loc.Portoa_FishermanIsland, loc.Portoa)[0].oneWay = true;
    function mark(loc, ...exits) {
        for (const exit of findExits(loc, ...exits)) {
            exit.shuffle = true;
        }
    }
    function markOutside(...locs) {
        const set = new Set(locs);
        for (const loc of locs) {
            for (const exit of exitsByLocation.get(loc)) {
                if (!set.has(exit.reverse.loc))
                    exit.shuffle = true;
            }
        }
    }
    mark(loc.Leaf, loc.Leaf_OutsideStart);
    markOutside(loc.ValleyOfWind, loc.WindmillCave, loc.Windmill);
    if (flags.shuffleHouses())
        markOutside(loc.WindmillCave);
    markOutside(loc.EastCave1, loc.EastCave2, loc.EastCave3);
    markOutside(loc.ZebuCave, loc.MtSabreWest_Cave1);
    markOutside(loc.CordelPlainWest, loc.CordelPlainEast);
    markOutside(loc.WaterfallValleyNorth, loc.WaterfallValleySouth);
    markOutside(loc.KirisaMeadow);
    markOutside(loc.LimeTreeLake);
    mark(loc.Portoa_FishermanIsland, loc.Portoa);
    mark(loc.UndergroundChannel, loc.PortoaPalace_ThroneRoom);
    mark(loc.AngrySea, loc.Joel);
    markOutside(loc.JoelSecretPassage);
    markOutside(loc.EvilSpiritIsland1, loc.EvilSpiritIsland2);
    mark(loc.ZombieTown, 'cave');
    mark(loc.AngrySea, loc.Swan);
    markOutside(loc.SwanGate);
    mark(loc.GoaValley, loc.MtHydra);
    markOutside(loc.Desert1);
    markOutside(loc.GoaFortressBasement);
    markOutside(loc.DesertCave1);
    markOutside(loc.SaharaOutsideCave);
    markOutside(loc.DesertCave2);
    for (const exit of exits.values()) {
        if (!exit.shuffle)
            continue;
        console.log(`${exit.loc} => ${exit.reverse.loc} ${exit.conn}/${exit.reverse.conn}`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2h1ZmZsZWFyZWFzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2pzL3Bhc3Mvc2h1ZmZsZWFyZWFzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVdBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUc5QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBMkJ4QyxNQUFNLE9BQU8sR0FBRyxJQUFJLEdBQUcsQ0FBaUM7SUFDdEQsQ0FBQyxVQUFVLEVBQUUsR0FBRyxDQUFDO0lBQ2pCLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQztJQUNqQixDQUFDLFdBQVcsRUFBRSxHQUFHLENBQUM7SUFDbEIsQ0FBQyxZQUFZLEVBQUUsR0FBRyxDQUFDO0lBQ25CLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQztJQUNiLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQztJQUNiLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQztJQUNkLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQztJQUNkLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQztDQUNsQixDQUFDLENBQUM7QUFNSCxNQUFNLFdBQVcsR0FBRyxJQUFJLEdBQUcsQ0FBaUM7SUFDMUQsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0lBQ1YsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO0NBQ1gsQ0FBQyxDQUFDO0FBRUgsU0FBUyxRQUFRLENBQUMsR0FBYSxFQUFFLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLFNBQVMsRUFB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NUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7S0FDckY7QUFHSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gU2h1ZmZsZSBhcmVhcy5cbi8vIFRoaXMgaXMgZG9uZSBfYWZ0ZXJfIHNodWZmbGluZyBob3VzZXMuICBUaGVyZSdzIGEgZmV3IHBvc3NpYmxlXG4vLyBhcHByb2FjaGVzIHRvIHRoaXMuICBIZXJlIHdlIHNpbXBseSBlbnVtZXJhdGUgdGhlIGFyZWFzIChub3Rcbi8vIHVzaW5nIHRoZSBkYXRhIGluIHJvbS9sb2NhdGlvbiwgc2luY2Ugd2UgYWN0dWFsbHkgd2FudCB0byBiYXNlXG4vLyB0aGluZ3Mgb24gdGhlIGV4aXRzIHJhdGhlciB0aGFuIHRoZSBsb2NhdGlvbnMpIGFuZCBkbyBzd2FwcyBvblxuLy8gcGFpcnMgb2YgZXhpdHMsIG1haW50YWluaW5nIGEgZ3JhcGggb2YgYXJlYXMuICBCeSBkZWZpbmluZyB0aGVcbi8vIGFyZWFzIGNvYXJzZXIgb3IgZmluZXIsIHdlIGNhbiBjb250cm9sIHRoZSBjcmF6aW5lc3MuXG5cbmltcG9ydCB7IFJhbmRvbSB9IGZyb20gJy4uL3JhbmRvbS5qcyc7XG5pbXBvcnQgeyBSb20gfSBmcm9tICcuLi9yb20uanMnO1xuaW1wb3J0IHsgRXhpdFNwZWMsIFBvcyB9IGZyb20gJy4uL3JvbS9tZXRhbG9jYXRpb24uanMnO1xuaW1wb3J0IHsgTG9jYXRpb24gfSBmcm9tICcuLi9yb20vbG9jYXRpb24uanMnO1xuaW1wb3J0IHsgQ29ubmVjdGlvblR5cGUgfSBmcm9tICcuLi9yb20vbWV0YXNjcmVlbmRhdGEuanMnO1xuaW1wb3J0IHsgRmxhZ1NldCB9IGZyb20gJy4uL2ZsYWdzZXQuanMnO1xuaW1wb3J0IHsgRGVmYXVsdE1hcCB9IGZyb20gJy4uL3V0aWwuanMnO1xuXG5pbnRlcmZhY2UgQXJlYSB7XG4gIG5hbWU6IHN0cmluZztcbiAgZXhpdHM6IE1hcDxzdHJpbmcsIEFyZWFFeGl0PjtcbiAgLy9leHBlY3RlZEV4aXRzOiBudW1iZXI7XG59XG5pbnRlcmZhY2UgQXJlYUV4aXQge1xuICBjb25uOiBBcmVhQ29ubmVjdGlvbjtcbiAgZGVzdDogQXJlYTtcbiAgZGVzdEtleTogc3RyaW5nO1xuICBsb2NQb3M6IG51bWJlcjtcbiAgZXhpdFR5cGU6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEV4aXQge1xuICByZWFkb25seSBsb2M6IExvY2F0aW9uO1xuICByZWFkb25seSBwb3M6IFBvcztcbiAgcmVhZG9ubHkgdHlwZTogQ29ubmVjdGlvblR5cGU7XG4gIHJlYWRvbmx5IGtleTogc3RyaW5nO1xuICBjb25uOiBBcmVhQ29ubmVjdGlvbnx1bmRlZmluZWQ7IC8vIGNhbm5vdCBzaHVmZmxlIHdpdGhvdXRcbiAgcmV2ZXJzZTogRXhpdDtcbiAgc2h1ZmZsZTogYm9vbGVhbjtcbiAgYXJlYTogc3RyaW5nO1xuICBvbmVXYXk/OiBib29sZWFuOyAvLyBjYW4ndCBnbyB0aGlzIHdheVxufVxuXG5jb25zdCBjb25uTWFwID0gbmV3IE1hcDxDb25uZWN0aW9uVHlwZSwgQXJlYUNvbm5lY3Rpb24+KFtcbiAgWydzdGFpcjp1cCcsICdDJ10sXG4gIFsnZWRnZTp0b3AnLCAnTiddLFxuICBbJ2VkZ2U6bGVmdCcsICdXJ10sXG4gIFsnZWRnZTpyaWdodCcsICdFJ10sXG4gIFsnY2F2ZScsICdDJ10sXG4gIFsnZG9vcicsICdDJ10sXG4gIFsnZG9vcjInLCAnQyddLFxuICBbJ2Rvb3IzJywgJ0MnXSxcbiAgWydmb3J0cmVzcycsICdGJ10sXG5dKTtcblxudHlwZSBFeGl0RGVzY3JpcHRvciA9IHJlYWRvbmx5IFtQb3MsIENvbm5lY3Rpb25UeXBlLCBFeGl0U3BlY107XG50eXBlIEV4aXRGaW5kZXIgPSBMb2NhdGlvbnxQb3N8Q29ubmVjdGlvblR5cGV8cmVhZG9ubHkgRXhpdEZpbmRlcltdO1xudHlwZSBBcmVhQ29ubmVjdGlvbiA9ICdOJ3wnUyd8J1cnfCdFJ3wnQyd8J1gnfCdGJ3wnTyc7XG4vL3R5cGUgQXJlYUV4aXRTcGVjID0gcmVhZG9ubHkgW0FyZWFDb25uZWN0aW9uLCBFeGl0RmluZGVyLCBBcmVhLCBib29sZWFuP107XG5jb25zdCBjb25uSW52ZXJzZSA9IG5ldyBNYXA8QXJlYUNvbm5lY3Rpb24sIEFyZWFDb25uZWN0aW9uPihbXG4gIFsnTicsICdTJ10sXG4gIFsnUycsICdOJ10sXG4gIFsnRScsICdXJ10sXG4gIFsnVycsICdFJ10sXG4gIFsnQycsICdYJ10sXG4gIFsnWCcsICdDJ10sXG4gIFsnRicsICdPJ10sXG4gIFsnTycsICdGJ10sXG5dKTtcblxuZnVuY3Rpb24gbWFrZUV4aXQobG9jOiBMb2NhdGlvbiwgW3BvcywgdHlwZSwgW3JldkxvY1BvcywgcmV2VHlwZV1dOiBFeGl0RGVzY3JpcHRvcik6IEV4aXQge1xuICBsZXQgY29ubiA9IGNvbm5NYXAuZ2V0KHR5cGUpIHx8IGNvbm5JbnZlcnNlLmdldChjb25uTWFwLmdldChyZXZUeXBlKSEpO1xuICBsZXQgc2h1ZmZsZSA9IGZhbHNlO1xuICBjb25zdCBhcmVhID0gbG9jLmlkLnRvU3RyaW5nKDE2KTtcbiAgY29uc3Qga2V5ID0gKGxvYy5pZCA8PCA4IHwgcG9zKS50b1N0cmluZygxNikgKyAnICcgKyB0eXBlO1xuICBjb25zdCByZXZMb2MgPSBsb2Mucm9tLmxvY2F0aW9uc1tyZXZMb2NQb3MgPj4+IDhdO1xuICBjb25zdCByZXZQb3MgPSByZXZMb2NQb3MgJiAweGZmO1xuICBjb25zdCByZXZLZXkgPSByZXZMb2NQb3MudG9TdHJpbmcoMTYpICsgJyAnICsgcmV2VHlwZTtcbiAgY29uc3QgcmV2QXJlYSA9IHJldkxvYy5pZC50b1N0cmluZygxNik7XG4gIGNvbnN0IHJldmVyc2U6IEV4aXQgPSB7XG4gICAgbG9jOiByZXZMb2MsIHBvczogcmV2UG9zLCB0eXBlOiByZXZUeXBlLFxuICAgIGFyZWE6IHJldkFyZWEsIGtleTogcmV2S2V5LCByZXZlcnNlOiBudWxsISxcbiAgICBnZXQgY29ubigpIHsgcmV0dXJuIGNvbm5JbnZlcnNlLmdldChjb25uISk7IH0sXG4gICAgc2V0IGNvbm4oYykgeyBjb25uID0gY29ubkludmVyc2UuZ2V0KGMhKTsgfSxcbiAgICBnZXQgc2h1ZmZsZSgpIHsgcmV0dXJuIHNodWZmbGU7IH0sXG4gICAgc2V0IHNodWZmbGUocykge1xuICAgICAgaWYgKHMgJiYgIWNvbm4pIHRocm93IG5ldyBFcnJvcihgc2h1ZmZsZSB3aXRob3V0IGNvbm5gKTtcbiAgICAgIHNodWZmbGUgPSBzO1xuICAgIH0sXG4gIH07XG4gIGNvbnN0IGV4aXQ6IEV4aXQgPSB7XG4gICAgbG9jLCBwb3MsIHR5cGUsIGtleSwgcmV2ZXJzZSwgYXJlYSxcbiAgICBnZXQgY29ubigpIHsgcmV0dXJuIGNvbm47IH0sXG4gICAgc2V0IGNvbm4oYykgeyBjb25uID0gYzsgfSxcbiAgICBnZXQgc2h1ZmZsZSgpIHsgcmV0dXJuIHNodWZmbGU7IH0sXG4gICAgc2V0IHNodWZmbGUocykge1xuICAgICAgaWYgKHMgJiYgIWNvbm4pIHRocm93IG5ldyBFcnJvcihgc2h1ZmZsZSB3aXRob3V0IGNvbm5gKTtcbiAgICAgIHNodWZmbGUgPSBzO1xuICAgIH0sXG4gIH07XG4gIHJldmVyc2UucmV2ZXJzZSA9IGV4aXQ7XG4gIHJldHVybiBleGl0O1xufVxuXG5mdW5jdGlvbiBtYXRjaEV4aXQoZXhpdDogRXhpdCwgZmluZGVyOiBFeGl0RmluZGVyKTogYm9vbGVhbiB7XG4gIGlmICh0eXBlb2YgZmluZGVyID09PSAnc3RyaW5nJykgcmV0dXJuIGV4aXQudHlwZSA9PT0gZmluZGVyO1xuICBpZiAodHlwZW9mIGZpbmRlciA9PT0gJ251bWJlcicpIHJldHVybiBleGl0LnBvcyA9PT0gZmluZGVyO1xuICBpZiAoZmluZGVyIGluc3RhbmNlb2YgTG9jYXRpb24pIHJldHVybiBleGl0LnJldmVyc2UubG9jID09PSBmaW5kZXI7XG4gIHJldHVybiBmaW5kZXIuZXZlcnkoZiA9PiBtYXRjaEV4aXQoZXhpdCwgZikpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2h1ZmZsZUFyZWFzKHJvbTogUm9tLCBmbGFnczogRmxhZ1NldCwgcmFuZG9tOiBSYW5kb20pIHtcbiAgaWYgKCFmbGFncy5zaHVmZmxlQXJlYXMoKSkgcmV0dXJuO1xuICBjb25zdCB7bG9jYXRpb25zOiBsb2N9ID0gcm9tO1xuXG4gIC8vIENhdGFsb2d1ZSBhbGwgdGhlIGV4aXRzIGluIHRoZSBnYW1lXG4gIGNvbnN0IGV4aXRzID0gbmV3IE1hcDxzdHJpbmcsIEV4aXQ+KCk7XG4gIGNvbnN0IGV4aXRzQnlMb2NhdGlvbiA9IG5ldyBEZWZhdWx0TWFwPExvY2F0aW9uLCBFeGl0W10+KCgpID0+IFtdKTtcbiAgZm9yIChjb25zdCBsb2NhdGlvbiBvZiByb20ubG9jYXRpb25zKSB7XG4gICAgZm9yIChjb25zdCBleGl0U3BlYyBvZiBsb2NhdGlvbi5tZXRhLmV4aXRzKCkpIHtcbiAgICAgIGNvbnN0IGV4aXQgPSBtYWtlRXhpdChsb2NhdGlvbiwgZXhpdFNwZWMpO1xuICAgICAgaWYgKGV4aXRzLmhhcyhleGl0LmtleSkpIGNvbnRpbnVlO1xuICAgICAgaWYgKGV4aXRzLmhhcyhleGl0LnJldmVyc2Uua2V5KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEluY29uc2lzdGVudCBleGl0czogJHtleGl0LmtleX0gJHtleGl0LnJldmVyc2Uua2V5fWApO1xuICAgICAgfVxuICAgICAgZXhpdHMuc2V0KGV4aXQua2V5LCBleGl0KTtcbiAgICAgIGV4aXRzLnNldChleGl0LnJldmVyc2Uua2V5LCBleGl0LnJldmVyc2UpO1xuICAgICAgZXhpdHNCeUxvY2F0aW9uLmdldChleGl0LmxvYykucHVzaChleGl0KTtcbiAgICAgIGV4aXRzQnlMb2NhdGlvbi5nZXQoZXhpdC5yZXZlcnNlLmxvYykucHVzaChleGl0LnJldmVyc2UpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE1ha2Ugc2VwYXJhdGUgYXJlYXMgZm9yIHdpbmRtaWxsIGFuZCBsaWdodGhvdXNlXG4gIGZ1bmN0aW9uIGZpbmRFeGl0cyhsb2NhdGlvbjogTG9jYXRpb24sIC4uLmZpbmRlcnM6IEV4aXRGaW5kZXJbXSk6IEV4aXRbXSB7XG4gICAgY29uc3Qgb3V0ID0gW107XG4gICAgZm9yIChjb25zdCBleGl0IG9mIGV4aXRzQnlMb2NhdGlvbi5nZXQobG9jYXRpb24pKSB7XG4gICAgICBmb3IgKGNvbnN0IGZpbmRlciBvZiBmaW5kZXJzKSB7XG4gICAgICAgIGlmIChtYXRjaEV4aXQoZXhpdCwgZmluZGVyKSkge1xuICAgICAgICAgIG91dC5wdXNoKGV4aXQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cbiAgaWYgKGZsYWdzLnNodWZmbGVIb3VzZXMoKSkge1xuICAgIGZvciAoY29uc3QgZXhpdCBvZiBmaW5kRXhpdHMobG9jLlZhbGxleU9mV2luZCwgJ2Rvb3InLCAnd2luZG1pbGwnKSkge1xuICAgICAgZXhpdC5hcmVhID0gJ3dpbmRtaWxsJztcbiAgICB9XG4gIH1cbiAgZm9yIChjb25zdCBleGl0IG9mIGZpbmRFeGl0cyhsb2MuQW5ncnlTZWEsIDB4NjQpKSB7XG4gICAgZXhpdC5hcmVhID0gJ2xpZ2h0aG91c2UnO1xuICB9XG4gIGZpbmRFeGl0cyhsb2MuUG9ydG9hX0Zpc2hlcm1hbklzbGFuZCwgbG9jLlBvcnRvYSlbMF0ub25lV2F5ID0gdHJ1ZTtcbiAgXG4gIC8vIE1hcmsgdGhlIGV4aXRzIHRoYXQgYXJlIGVsaWdpYmxlIHRvIGJlIHNodWZmbGVkLlxuICBmdW5jdGlvbiBtYXJrKGxvYzogTG9jYXRpb24sIC4uLmV4aXRzOiBFeGl0RmluZGVyW10pOiB2b2lkIHtcbiAgICBmb3IgKGNvbnN0IGV4aXQgb2YgZmluZEV4aXRzKGxvYywgLi4uZXhpdHMpKSB7XG4gICAgICBleGl0LnNodWZmbGUgPSB0cnVlO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiBtYXJrT3V0c2lkZSguLi5sb2NzOiBMb2NhdGlvbltdKTogdm9pZCB7XG4gICAgY29uc3Qgc2V0ID0gbmV3IFNldChsb2NzKTtcbiAgICBmb3IgKGNvbnN0IGxvYyBvZiBsb2NzKSB7XG4gICAgICBmb3IgKGNvbnN0IGV4aXQgb2YgZXhpdHNCeUxvY2F0aW9uLmdldChsb2MpKSB7XG4gICAgICAgIGlmICghc2V0LmhhcyhleGl0LnJldmVyc2UubG9jKSkgZXhpdC5zaHVmZmxlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgICBcbiAgbWFyayhsb2MuTGVhZiwgbG9jLkxlYWZfT3V0c2lkZVN0YXJ0KTtcbiAgbWFya091dHNpZGUobG9jLlZhbGxleU9mV2luZCwgbG9jLldpbmRtaWxsQ2F2ZSwgbG9jLldpbmRtaWxsKTtcbiAgaWYgKGZsYWdzLnNodWZmbGVIb3VzZXMoKSkgbWFya091dHNpZGUobG9jLldpbmRtaWxsQ2F2ZSk7XG4gIG1hcmtPdXRzaWRlKGxvYy5FYXN0Q2F2ZTEsIGxvYy5FYXN0Q2F2ZTIsIGxvYy5FYXN0Q2F2ZTMpO1xuICBtYXJrT3V0c2lkZShsb2MuWmVidUNhdmUsIGxvYy5NdFNhYnJlV2VzdF9DYXZlMSk7XG4gIG1hcmtPdXRzaWRlKGxvYy5Db3JkZWxQbGFpbldlc3QsIGxvYy5Db3JkZWxQbGFpbkVhc3QpO1xuICBtYXJrT3V0c2lkZShsb2MuV2F0ZXJmYWxsVmFsbGV5Tm9ydGgsIGxvYy5XYXRlcmZhbGxWYWxsZXlTb3V0aCk7XG4gIG1hcmtPdXRzaWRlKGxvYy5LaXJpc2FNZWFkb3cpO1xuICBtYXJrT3V0c2lkZShsb2MuTGltZVRyZWVMYWtlKTtcbiAgbWFyayhsb2MuUG9ydG9hX0Zpc2hlcm1hbklzbGFuZCwgbG9jLlBvcnRvYSk7XG4gIG1hcmsobG9jLlVuZGVyZ3JvdW5kQ2hhbm5lbCwgbG9jLlBvcnRvYVBhbGFjZV9UaHJvbmVSb29tKTtcbiAgbWFyayhsb2MuQW5ncnlTZWEsIGxvYy5Kb2VsKTtcbiAgbWFya091dHNpZGUobG9jLkpvZWxTZWNyZXRQYXNzYWdlKTsgLy8gPz8/XG4gIC8vZmluZEV4aXRzKGxvYy5FdmlsU3Bpcml0SXNsYW5kMSwgbG9jLkV2aWxTcGlyaXRJc2xhbmQyKVswXS5jb25uID0gJ0MnO1xuICBtYXJrT3V0c2lkZShsb2MuRXZpbFNwaXJpdElzbGFuZDEsIGxvYy5FdmlsU3Bpcml0SXNsYW5kMik7XG4gIG1hcmsobG9jLlpvbWJpZVRvd24sICdjYXZlJyk7XG4gIG1hcmsobG9jLkFuZ3J5U2VhLCBsb2MuU3dhbik7XG4gIG1hcmtPdXRzaWRlKGxvYy5Td2FuR2F0ZSk7XG4gIG1hcmsobG9jLkdvYVZhbGxleSwgbG9jLk10SHlkcmEpO1xuICBtYXJrT3V0c2lkZShsb2MuRGVzZXJ0MSk7XG4gIG1hcmtPdXRzaWRlKGxvYy5Hb2FGb3J0cmVzc0Jhc2VtZW50KTtcbiAgbWFya091dHNpZGUobG9jLkRlc2VydENhdmUxKTtcbiAgbWFya091dHNpZGUobG9jLlNhaGFyYU91dHNpZGVDYXZlKTtcbiAgbWFya091dHNpZGUobG9jLkRlc2VydENhdmUyKTtcblxuICAvLyBUT0RPIC0gaWYgIXNodWZmbGVIb3VzZXMgdGhlbiBtYXJrIGFsbCB0aGUgZm9ydHJlc3Nlcz8/XG5cbiAgLy8gV2Ugc2hvdWxkIG1ha2Ugc3VyZSBhbGwgdGhlIHNodWZmbGVkIGV4aXRzIGhhdmUgdGhlIHJpZ2h0IHR5cGUuXG5cbiAgZm9yIChjb25zdCBleGl0IG9mIGV4aXRzLnZhbHVlcygpKSB7XG4gICAgaWYgKCFleGl0LnNodWZmbGUpIGNvbnRpbnVlO1xuICAgIGNvbnNvbGUubG9nKGAke2V4aXQubG9jfSA9PiAke2V4aXQucmV2ZXJzZS5sb2N9ICR7ZXhpdC5jb25ufS8ke2V4aXQucmV2ZXJzZS5jb25ufWApO1xuICB9XG5cbiAgLy8gTmV4dCBmaW5kIGFsbCB0aGUgbm9uLXNodWZmbGVkIGV4aXRzIGFuZCBVbmlvbkZpbmQgdGhlbSFcbn1cblxuLy8gZnVuY3Rpb24gbWF0Y2hFeGl0KGZpbmRlcjogRXhpdEZpbmRlcik6XG4vLyAgICAgICAoZTogcmVhZG9ubHkgW251bWJlciwgQ29ubmVjdGlvblR5cGUsIEV4aXRTcGVjXSkgPT4gYm9vbGVhbiB7XG4vLyAgIGlmICh0eXBlb2YgZmluZGVyID09PSAnc3RyaW5nJykgcmV0dXJuIChbLCB0XSkgPT4gdCA9PT0gZmluZGVyO1xuLy8gICBpZiAodHlwZW9mIGZpbmRlciA9PT0gJ251bWJlcicpIHJldHVybiAoW3BdKSA9PiBwID09PSBmaW5kZXI7XG4vLyAgIGlmIChmaW5kZXIgaW5zdGFuY2VvZiBMb2NhdGlvbikgcmV0dXJuIChbLCwgW2xdXSkgPT4gKGwgPj4+IDgpID09PSBmaW5kZXIuaWQ7XG4vLyAgIGNvbnN0IG1hdGNoZXJzID0gZmluZGVyLm1hcChtYXRjaEV4aXQpO1xuLy8gICByZXR1cm4gKGUpID0+IG1hdGNoZXJzLmV2ZXJ5KGYgPT4gZihlKSk7XG4vLyB9XG5cbi8vIGZ1bmN0aW9uIGV4aXRLZXkobG9jUG9zOiBudW1iZXIsIGV4aXRUeXBlOiBDb25uZWN0aW9uVHlwZSkge1xuLy8gICByZXR1cm4gbG9jUG9zLnRvU3RyaW5nKDE2KSArICcgJyArIGV4aXRUeXBlO1xuLy8gfVxuXG4vLyBmdW5jdGlvbiBhZGRFeGl0cyhmcm9tTG9jOiBMb2NhdGlvbixcbi8vICAgICAgICAgICAgICAgICAgIC4uLmV4aXRTcGVjczogQXJlYUV4aXRTcGVjW10pOiB2b2lkIHtcbi8vICAgY29uc3QgZXhpdHMgPSBbLi4uZnJvbUxvYy5tZXRhLmV4aXRzKCldO1xuLy8gICBmb3IgKGNvbnN0IFtjb25uZWN0aW9uLCBmaW5kZXIsIHRvQXJlYSwgb25lV2F5XSBvZiBleGl0U3BlY3MpIHtcbi8vICAgICBjb25zdCBbZXhpdCwgLi4ucmVzdF0gPSBleGl0cy5maWx0ZXIobWF0Y2hFeGl0KGZpbmRlcikpO1xuLy8gICAgIGlmICghZXhpdCkgdGhyb3cgbmV3IEVycm9yKGBNaXNzaW5nIGV4aXQ6ICR7ZmluZGVyfSBpbiAke2Zyb21Mb2N9YCk7XG4vLyAgICAgaWYgKHJlc3QubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoYEFtYmlndW91cyBleGl0OiAke2ZpbmRlcn0gaW4gJHtmcm9tTG9jfWApO1xuLy8gICAgIGNvbnN0IGZyb21Mb2NQb3MgPSBmcm9tTG9jLmlkIDw8IDggfCBleGl0WzBdO1xuLy8gICAgIGNvbnN0IGZyb21UeXBlID0gZXhpdFsxXTtcbi8vICAgICBjb25zdCBmcm9tS2V5ID0gZXhpdEtleShmcm9tTG9jUG9zLCBmcm9tVHlwZSk7XG4vLyAgICAgY29uc3QgW3RvTG9jUG9zLCB0b1R5cGVdID0gZXhpdFsyXTtcbi8vICAgICBjb25zdCB0b0tleSA9IGV4aXRLZXkodG9Mb2NQb3MsIHRvVHlwZSk7XG4vLyAgICAgY29uc3QgZnJvbUV4aXQgPSB7XG4vLyAgICAgICBjb25uOiBjb25uZWN0aW9uLFxuLy8gICAgICAgZGVzdDogdG9BcmVhLFxuLy8gICAgICAgZGVzdEtleTogdG9LZXksXG4vLyAgICAgICBsb2NQb3M6IGZyb21Mb2NQb3MsXG4vLyAgICAgICBleGl0VHlwZTogZnJvbVR5cGUsXG4vLyAgICAgfTtcbi8vICAgICBjb25zdCB0b0V4aXQgPSB7XG4vLyAgICAgICBjb25uOiBjb25uSW52ZXJzZS5nZXQoY29ubmVjdGlvbikhLFxuLy8gICAgICAgZGVzdDogZnJvbUFyZWEsXG4vLyAgICAgICBkZXN0S2V5OiBmcm9tS2V5LFxuLy8gICAgICAgbG9jUG9zOiB0b0xvY1Bvcyxcbi8vICAgICAgIGV4aXRUeXBlOiB0b1R5cGUsXG4vLyAgICAgfTtcbi8vICAgICBmcm9tQXJlYS5leGl0cy5zZXQoZnJvbUtleSwgZnJvbUV4aXQpO1xuLy8gICAgIGlmICghb25lV2F5KSB0b0FyZWEuZXhpdHMuc2V0KHRvS2V5LCB0b0V4aXQpO1xuLy8gICB9XG4vLyB9XG5cbi8vIGZ1bmN0aW9uIGJ1aWxkS2V5KGxvYzogTG9jYXRpb258bnVsbCxcbi8vICAgICAgICAgICAgICAgICAgIFtwb3MsIHR5cF06IHJlYWRvbmx5IFtQb3MsIENvbm5lY3Rpb25UeXBlLCAuLi51bmtub3duW11dKTogc3RyaW5nIHtcbi8vICAgcmV0dXJuICgobG9jID8gbG9jLmlkIDw8IDggOiAwKSB8IHBvcykudG9TdHJpbmcoMTYpICsgJyAnICsgdHlwO1xuLy8gfVxuXG5cbi8vIGNsYXNzIEV4aXRNYXAge1xuLy8gICBleGl0cyA9IG5ldyBNYXA8c3RyaW5nLCBFeGl0PigpO1xuXG4vLyAgIGxvY2F0aW9ucyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG4vLyAgIGV4aXRzQnlMb2NhdGlvbiA9IG5ldyBEZWZhdWx0TWFwPHN0cmluZywgU2V0PHN0cmluZz4+KCgpID0+IG5ldyBTZXQoKSk7XG4vLyAgIG9wcG9zaXRlcyA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7XG5cbi8vICAgc3BsaXRMb2NhdGlvbihsb2M6IExvY2F0aW9uLCAuLi5maW5kZXJzOiBFeGl0RmluZGVyW10pIHtcbi8vICAgICBjb25zdCBtYXRjaGVycyA9IGZpbmRlcnMubWFwKG1hdGNoRXhpdCk7XG4vLyAgICAgbGV0IGtleTogc3RyaW5nfHVuZGVmaW5lZDtcbi8vICAgICBmb3IgKGNvbnN0IGV4aXQgb2YgbG9jLm1ldGEuZXhpdHMoKSkge1xuLy8gICAgICAgZm9yIChjb25zdCBtYXRjaGVyIG9mIG1hdGNoZXJzKSB7XG4vLyAgICAgICAgIGlmICghbWF0Y2hlcihleGl0KSkgY29udGludWU7XG4vLyAgICAgICAgIGxldCBleGl0S2V5ID0gYnVpbGRLZXkobG9jLCBleGl0KTtcbi8vICAgICAgICAgaWYgKGtleSA9PSB1bmRlZmluZWQpIGtleSA9IGV4aXRLZXk7XG4vLyAgICAgICAgIHRoaXMubG9jYXRpb25zLnNldChleGl0S2V5LCBrZXkpO1xuLy8gICAgICAgICBicmVhaztcbi8vICAgICAgIH1cbi8vICAgICB9XG4vLyAgIH1cblxuLy8gICBsb2NhdGlvbktleShsb2M6IExvY2F0aW9uLCBleGl0OiBFeGl0RGVzY3JpcHRvcik6IHN0cmluZyB7XG4vLyAgICAgY29uc3Qga2V5ID0gYnVpbGRLZXkobG9jLCBleGl0KTtcbi8vICAgICBsZXQgdmFsdWUgPSB0aGlzLmxvY2F0aW9ucy5nZXQoa2V5KTtcbi8vICAgICBpZiAoIXZhbHVlKSB0aGlzLmxvY2F0aW9ucy5zZXQoa2V5LCB2YWx1ZSA9IGxvYy5pZC50b1N0cmluZygxNikpO1xuXG4vLyAgICAgLy8gVE9ETyAtIHRoaXMuZXhpdHNCeUxvY2F0aW9uXG5cbi8vICAgICByZXR1cm4gdmFsdWU7XG4vLyAgIH1cblxuLy8gICBwcml2YXRlIGFkZEV4aXRJbnRlcm5hbChmcm9tS2V5OiBzdHJpbmcsIHRvS2V5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBcbi8vICAgfVxuXG4vLyAgIGFkZEV4aXQobG9jOiBMb2NhdGlvbiwgY29ubjogQXJlYUNvbm5lY3Rpb24sIGV4aXQ/OiBFeGl0RmluZGVyKTogdm9pZCB7XG4gICAgXG4vLyAgIH1cbi8vICAgYWRkRXhpdHMobG9jOiBMb2NhdGlvbiwgLi4uZXhpdHM6IEV4aXRGaW5kZXJbXSk6IHZvaWQge1xuXG4vLyAgIH1cbi8vICAgYWRkQWxsRXhpdHMobG9jOiBMb2NhdGlvbik6IHZvaWQge1xuLy8gICAgIGZvciAoY29uc3QgZXhpdCBvZiBsb2MubWV0YS5leGl0cygpKSB7XG4gICAgICBcbi8vICAgICAgIGNvbnN0IGZyb21LZXkgPSBidWlsZEtleShsb2MsIGV4aXQpO1xuLy8gICAgICAgY29uc3QgdG9LZXkgPSBidWlsZEtleShudWxsLCBleGl0WzJdKTtcbi8vICAgICAgIHRoaXMuYWRkRXhpdEludGVybmFsKGZyb21LZXksIHRvS2V5KTtcbi8vICAgICB9XG4vLyAgIH1cbiAgXG4vLyAgIC8vIGFyZWEobG9jOiBMb2NhdGlvbiwgZmluZGVyOiBFeGl0RmluZGVyKTogc3RyaW5nIHtcbi8vICAgLy8gICAvLyBcbi8vICAgLy8gfVxuLy8gfVxuXG4vLyBmdW5jdGlvbiB1bnVzZWQoKSB7XG4vLyAgIGFkZEV4aXRzKGFyZWEuU3RhcnQsIGxvYy5MZWFmX091dHNpZGVTdGFydCwgWydXJywgbG9jLkxlYWYsIGFyZWEuTGVhZl0pO1xuLy8gICBhZGRFeGl0cyhhcmVhLldpbmRWYWxsZXksIGxvYy5WYWxsZXlPZldpbmQsXG4vLyAgICAgICAgICAgIFsnUycsIGxvYy5MZWFmLCBhcmVhLkxlYWZdLFxuLy8gICAgICAgICAgICBbJ0MnLCBsb2MuWmVidUNhdmUsIGFyZWEuWmVidV0sXG4vLyAgICAgICAgICAgIFsnQycsIGxvYy5TZWFsZWRDYXZlMSwgYXJlYS5TZWFsZWRDYXZlXSk7XG4vLyAgIGlmIChmbGFncy5zaHVmZmxlSG91c2VzKCkpIHtcbi8vICAgICBhZGRFeGl0cyhhcmVhLldpbmRWYWxsZXksIGxvYy5WYWxsZXlPZldpbmQsIFsnQycsIDB4MDIsIGFyZWEuV2luZG1pbGxDYXZlXSk7XG4vLyAgICAgYWRkRXhpdHMoYXJlYS5XaW5kbWlsbCwgbG9jLlZhbGxleU9mV2luZCwgWydDJywgJ2Rvb3InLCBhcmVhLldpbmRtaWxsQ2F2ZV0pO1xuLy8gICB9XG4vLyAgIGlmIChmbGFncy5hZGRFYXN0Q2F2ZSgpKSB7XG4vLyAgICAgYWRkRXhpdHMoYXJlYS5XaW5kVmFsbGV5LCBsb2MuVmFsbGV5T2ZXaW5kLFxuLy8gICAgICAgICAgICAgIFsnQycsIGxvYy5FYXN0Q2F2ZTEsIGFyZWEuRWFzdENhdmVdKTtcbi8vICAgICAvLyBOT1RFOiBXZSBjb3VsZCBwb3NzaWJseSBhZGQgZXhpdDEgYW5kIGV4aXQyLCBidXQgaXQnc1xuLy8gICAgIC8vIGhhcmQgdG8gZmlndXJlIG91dCBpZiAoMSkgdGhleSBldmVuIGV4aXN0LCBhbmQgKDIpIGlmXG4vLyAgICAgLy8gdGhleSBkbywgd2hpY2ggX2FyZWFfIHRoZXkgZ28gdG8uICBGb3Igbm93LCB3ZSdsbCB0cmVhdFxuLy8gICAgIC8vIGl0IGFzIGEgdGVybWluYWwsIHNpbmNlIHRoZSBvdGhlciBleGl0cyBhcmUgYWxyZWFkeVxuLy8gICAgIC8vIHNvbWV3aGF0IHJhbmRvbWl6ZWQuXG4vLyAgIH1cbi8vICAgYWRkRXhpdHMoYXJlYS5Db3JkZWxQbGFpbiwgbG9jLkNvcmRlbFBsYWluV2VzdCxcbi8vICAgICAgICAgICAgWydDJywgbG9jLlNlYWxlZENhdmU4LCBhcmVhLlNlYWxlZENhdmVdLFxuLy8gICAgICAgICAgICBbJ1cnLCBsb2MuQnJ5bm1hZXIsIGFyZWEuQnJ5bm1hZXJdLFxuLy8gICAgICAgICAgICBbJ1cnLCBsb2MuTXRTYWJyZVdlc3RfTG93ZXIsIGFyZWEuU2FicmVXZXN0XSxcbi8vICAgICAgICAgICAgWydOJywgbG9jLk91dHNpZGVTdG9tSG91c2UsIGFyZWEuU3RvbUhvdXNlXSxcbi8vICAgICAgICAgICAgWydTJywgbG9jLkFtYXpvbmVzLCBhcmVhLkFtYXpvbmVzXSk7XG4vLyAgIGFkZEV4aXRzKGFyZWEuQ29yZGVsUGxhaW4sIGxvYy5Db3JkZWxQbGFpbkVhc3QsXG4vLyAgICAgICAgICAgIFsnRScsIGxvYy5Td2FtcCwgYXJlYS5Td2FtcF0sXG4vLyAgICAgICAgICAgIFsnTicsIGxvYy5NdFNhYnJlTm9ydGhfTWFpbiwgYXJlYS5TYWJyZU5vcnRoXSk7XG4vLyAgIGFkZEV4aXRzKGFyZWEuV2F0ZXJmYWxsVmFsbGV5LCBsb2MuV2F0ZXJmYWxsVmFsbGV5Tm9ydGgsXG4vLyAgICAgICAgICAgIFsnQycsIGxvYy5NdFNhYnJlTm9ydGhfU3VtbWl0Q2F2ZSwgYXJlYS5TYWJyZU5vcnRoXSxcbi8vICAgICAgICAgICAgWydXJywgbG9jLlBvcnRvYSwgYXJlYS5Qb3J0b2FdLFxuLy8gICAgICAgICAgICBbJ0MnLCBsb2MuV2F0ZXJmYWxsQ2F2ZTEsIGFyZWEuV2F0ZXJmYWxsQ2F2ZV0sXG4vLyAgICAgICAgICAgIFsnQycsIGxvYy5Gb2dMYW1wQ2F2ZTEsIGFyZWEuRm9nTGFtcENhdmVdKTtcbi8vICAgYWRkRXhpdHMoYXJlYS5XYXRlcmZhbGxWYWxsZXksIGxvYy5XYXRlcmZhbGxWYWxsZXlTb3V0aCxcbi8vICAgICAgICAgICAgWydDJywgbG9jLktpcmlzYVBsYW50Q2F2ZTEsIGFyZWEuS2lyaXNhQ2F2ZV0sXG4vLyAgICAgICAgICAgIFsnVycsIGxvYy5MaW1lVHJlZVZhbGxleSwgYXJlYS5MaW1lVHJlZVZhbGxleV0pO1xuLy8gICBhZGRFeGl0cyhhcmVhLktpcmlzYUNhdmUsIGxvYy5LaXJpc2FQbGFudENhdmUzLFxuLy8gICAgICAgICAgICBbJ1gnLCBsb2MuS2lyaXNhTWVhZG93LCBhcmVhLktpcmlzYU1lYWRvd10pO1xuLy8gICBhZGRFeGl0cyhhcmVhLkxpbWVUcmVlTGFrZSwgbG9jLkxpbWVUcmVlTGFrZSxcbi8vICAgICAgICAgICAgWydYJywgbG9jLkxpbWVUcmVlVmFsbGV5LCBhcmVhLkxpbWVUcmVlVmFsbGV5XSxcbi8vICAgICAgICAgICAgWydDJywgbG9jLk1lc2lhU2hyaW5lLCBhcmVhLk1lc2lhU2hyaW5lXSk7XG4vLyAgIGFkZEV4aXRzKGFyZWEuQW5ncnlTZWEsIGxvYy5Qb3J0b2FfRmlzaGVybWFuSXNsYW5kLFxuLy8gICAgICAgICAgICAvLyBUT0RPIC0gaG93IHRvIG1ha2UgdGhpcyBvbmUtd2F5P1xuLy8gICAgICAgICAgICBbJ0UnLCBsb2MuUG9ydG9hLCBhcmVhLlBvcnRvYSwgdHJ1ZV0pO1xuLy8gICBhZGRFeGl0cyhhcmVhLkFuZ3J5U2VhLCBsb2MuRXZpbFNwaXJpdElzbGFuZDEsXG4vLyAgICAgICAgICAgIFsnQycsIGxvYy5FdmlsU3Bpcml0SXNsYW5kMiwgYXJlYS5FdmlsU3Bpcml0SXNsYW5kXSk7XG4vLyAgIGFkZEV4aXRzKGFyZWEuQW5ncnlTZWEsIGxvYy5BbmdyeVNlYSxcbi8vICAgICAgICAgICAgWydDJywgbG9jLkpvZWwsIGFyZWEuSm9lbF0sXG4vLyAgICAgICAgICAgIFsnTicsIGxvYy5Td2FuLCBhcmVhLlN3YW5dKTtcbi8vICAgaWYgKCFmbGFncy5zaHVmZmxlSG91c2VzKCkpIHtcbi8vICAgICAvLyBUT0RPIC0gd3JvbmcgYXJlYSBpZiB3ZSBoYXZlIGhvdXNlIHNodWZmbGUuLi4/IGhvdyB0byBmaXg/XG4vLyAgICAgYWRkRXhpdHMoYXJlYS5Kb2VsUGFzc2FnZSwgbG9jLkpvZWxTZWNyZXRQYXNzYWdlLFxuLy8gICAgICAgICAgICAgIFsnWCcsIGxvYy5Kb2VsX1NoZWQsIGFyZWEuSm9lbF0sXG4vLyAgICAgICAgICAgICAgWydYJywgbG9jLkFuZ3J5U2VhLCBhcmVhLkxpZ2h0aG91c2VdKTtcbi8vICAgfVxuLy8gICBhZGRFeGl0cyhhcmVhLlpvbWJpZVRvd24sIGxvYy5ab21iaWVUb3duLFxuLy8gICAgICAgICAgICBbJ0MnLCAnY2F2ZScsIGFyZWEuRXZpbFNwaXJpdElzbGFuZF0pO1xuLy8gICBhZGRFeGl0cyhhcmVhLlN3YW4sIGxvYy5Td2FuLCBbJ1cnLCBsb2MuU3dhbkdhdGUsIGFyZWEuU3dhbkdhdGVdKTtcbi8vICAgYWRkRXhpdHMoYXJlYS5Hb2FWYWxsZXksIGxvYy5Hb2FWYWxsZXksXG4vLyAgICAgICAgICAgIFsnRScsIGxvYy5Td2FuR2F0ZSwgYXJlYS5Td2FuR2F0ZV0sXG4vLyAgICAgICAgICAgIFsnVycsIGxvYy5NdEh5ZHJhLCBhcmVhLkh5ZHJhXSxcbi8vICAgICAgICAgICAgWydTJywgbG9jLkRlc2VydDEsIGFyZWEuRGVzZXJ0MV0pO1xuLy8gICBhZGRFeGl0cyhhcmVhLkRlc2VydDEsIGxvYy5EZXNlcnQxLFxuLy8gICAgICAgICAgICBbJ0MnLCBsb2MuT2FzaXNDYXZlX0VudHJhbmNlLCBhcmVhLk9hc2lzQ2F2ZV0sXG4vLyAgICAgICAgICAgIFsnQycsIGxvYy5EZXNlcnRDYXZlMSwgYXJlYS5EZXNlcnRDYXZlMV0pO1xuLy8gICBhZGRFeGl0cyhhcmVhLk9hc2lzQ2F2ZSwgbG9jLk9hc2lzQ2F2ZU1haW4sXG4vLyAgICAgICAgICAgIFsnQycsIGxvYy5Hb2FGb3J0cmVzc0Jhc2VtZW50LCBhcmVhLkdvYUJhc2VtZW50XSk7XG4vLyAgIGFkZEV4aXRzKGFyZWEuRGVzZXJ0Q2F2ZTEsIGxvYy5EZXNlcnRDYXZlMSxcbi8vICAgICAgICAgICAgWydYJywgbG9jLlNhaGFyYU1lYWRvdywgYXJlYS5TYWhhcmFdKTtcbi8vICAgYWRkRXhpdHMoYXJlYS5TYWhhcmFFeGl0LCBsb2MuU2FoYXJhT3V0c2lkZUNhdmUsXG4vLyAgICAgICAgICAgIFsnVycsIGxvYy5TYWhhcmEsIGFyZWEuU2FoYXJhXSxcbi8vICAgICAgICAgICAgWydDJywgbG9jLkRlc2VydENhdmUyLCBhcmVhLkRlc2VydENhdmUyXSk7XG4vLyAgIGFkZEV4aXRzKGFyZWEuRW5kLCBsb2MuRGVzZXJ0MiwgWydDJywgbG9jLkRlc2VydENhdmUyLCBhcmVhLkRlc2VydENhdmUyXSk7XG5cbi8vICAgLy8gV2UndmUgZ290IHRoZSB3aG9sZSBncmFwaCBzZXQgdXAuICBOb3cgd2UgbmVlZCBhIGZ1bmN0aW9uIHRvIHRyYXZlcnNlIHRoZVxuLy8gICAvLyBncmFwaCBhbmQgbWFrZSBzdXJlIGl0J3MgdmFsaWQuXG4vLyAgIGNvbnN0IGFsbEFyZWFzID0gT2JqZWN0LmtleXMoYXJlYSkubWFwKGsgPT4gYXJlYVtrIGFzIGtleW9mIHR5cGVvZiBhcmVhXSlcbi8vICAgICAgIC5maWx0ZXIoYSA9PiBhLmV4aXRzLnNpemUpO1xuLy8gICBmdW5jdGlvbiB0cmF2ZXJzZSgpOiBBcnJheTxNYXA8QXJlYUNvbm5lY3Rpb24sIEFyZWFFeGl0W10+PiB7XG4vLyAgICAgY29uc3Qgc2VlbiA9IG5ldyBTZXQoKTtcbi8vICAgICBjb25zdCBvdXQgPSBbXTtcbi8vICAgICBmb3IgKGNvbnN0IGEgb2YgW2FyZWEuU3RhcnQsIC4uLmFsbEFyZWFzXSkge1xuLy8gICAgICAgaWYgKHNlZW4uaGFzKGEpKSBjb250aW51ZTtcbi8vICAgICAgIGNvbnN0IHF1ZXVlID0gbmV3IFNldChbYV0pO1xuLy8gICAgICAgY29uc3QgbWFwID0gbmV3IERlZmF1bHRNYXA8QXJlYUNvbm5lY3Rpb24sIEFyZWFFeGl0W10+KCgpID0+IFtdKTtcbi8vICAgICAgIGZvciAoY29uc3QgbmV4dCBvZiBxdWV1ZSkge1xuLy8gICAgICAgICBmb3IgKGNvbnN0IGV4aXQgb2YgbmV4dC5leGl0cy52YWx1ZXMoKSkge1xuLy8gICAgICAgICAgIGlmIChzZWVuLmhhcyhleGl0LmRlc3QpKSBjb250aW51ZTtcbi8vICAgICAgICAgICBzZWVuLmFkZChleGl0LmRlc3QpO1xuLy8gICAgICAgICAgIHF1ZXVlLmFkZChleGl0LmRlc3QpO1xuLy8gICAgICAgICAgIG1hcC5nZXQoZXhpdC5jb25uKS5wdXNoKGV4aXQpO1xuLy8gICAgICAgICAgIGNvbnN0IHJldmVyc2UgPSBleGl0LmRlc3QuZXhpdHMuZ2V0KGV4aXQuZGVzdEtleSk7XG4vLyAgICAgICAgICAgaWYgKHJldmVyc2UpIG1hcC5nZXQocmV2ZXJzZS5jb25uKS5wdXNoKHJldmVyc2UpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICB9XG4vLyAgICAgICBvdXQucHVzaChtYXApO1xuLy8gICAgIH1cbi8vICAgICByZXR1cm4gb3V0O1xuLy8gICB9XG5cbi8vICAgLy8gQmFzaWMgcGxhbjogcGljayB0d28gcmFuZG9tIGV4aXRzIG9mIHRoZSBzYW1lIHR5cGUuXG4vLyAgIGxldCBpdGVycyA9IDEwMDtcbi8vICAgbGV0IHRyYXZlcnNhbCA9IHRyYXZlcnNlKCk7XG4vLyAgIHdoaWxlIChpdGVycy0tID4gMCB8fCB0cmF2ZXJzYWwubGVuZ3RoID4gMSkge1xuLy8gICAgIGlmICh0cmF2ZXJzYWwubGVuZ3RoID4gMikgcmFuZG9tLnNodWZmbGUodHJhdmVyc2FsKTtcbi8vICAgICBpZiAodHJhdmVyc2FsLmxlbmd0aCA+IDEpIHtcbi8vICAgICAgIC8vIHBpY2sgYW4gY29ubiB0eXBlIHRoYXQncyBwcmVzZW50IGluIGJvdGggc2V0c1xuLy8gICAgIH1cbi8vICAgICB0cmF2ZXJzYWwgPSB0cmF2ZXJzZSgpO1xuLy8gICB9XG4vLyB9XG4iXX0=