(function(){
const global=window;'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(d,e){function g(a){a.done?d(a.value):Promise.resolve(a.value).then(b,c).then(g,e)}g(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(c,a-b.length)+b}},"es8","es3");$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return c})}},"es8","es3");$jscomp.polyfill("String.prototype.padEnd",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,null,"padStart");return b+$jscomp.stringPadding(c,a-b.length)}},"es8","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var g=b[c];if(g===a||Object.is(g,a))return!0}return!1}},"es7","es3");const LOG$$module$6502=!0;
class Assembler$$module$6502{constructor(){this.labels={};this.allChunks=[]}assemble(a,b="input"){b=new File$$module$6502(this.labels,b);for(const c of a.split("\n"))b.ingest(c);a=b.assemble();this.allChunks.push(...a)}chunks(){return[...this.allChunks]}patch(){return Patch$$module$6502.from(this.allChunks)}patchRom(a){buildRomPatch$$module$6502(this.patch()).apply(a);this.allChunks=[]}expand(a){const [b,...c]=this.labels[a]||[];if(null==b)throw Error(`Missing label: ${a}`);if(c.length)throw Error(`Non-unique label: ${a}`);
return 0>b?~b:b}}
class File$$module$6502{constructor(a,b){this.labels=a;this.lines=[];this.pc=0;this.filename=b;this.lineNumber=-1;this.lineContents="";this.conditions=[];this.assembling=!0}addLine(a){this.lines.push(a.orig(this.filename,this.lineNumber,this.lineContents))}addLabel(a,b){if("number"!==typeof b)throw Error("Expected a number");a=this.labels[a]||(this.labels[a]=[]);const c=find$$module$6502(a,b);0>c&&a.splice(~c,0,b)}ingest(a){this.lineNumber++;this.lineContents=a;a=a.replace(/;.*/,"");a=a.replace(/\s+/g,
" ");a=a.replace(/\s$/g,"");var b;if(b=/^\s*\.if(n?)def\s+(\S+)/i.exec(a))a=b[2]in this.labels,this.conditions.push(b[1]?!a:a),this.assembling=this.conditions.every((a)=>a);else if(b=/^\s*\.else/i.exec(a))this.conditions.push(!this.conditions.pop()),this.assembling=this.conditions.every((a)=>a);else if(b=/^\s*\.endif/i.exec(a))this.conditions.pop(),this.assembling=this.conditions.every((a)=>a);else if(this.assembling)if(b=/^\s*\.org\s+(\S+)/i.exec(a))this.addLine(new OrgLine$$module$6502(this.pc=
parseNumber$$module$6502(b[1])));else if(b=/^\s*\.assert\s+(<\s*)?(\S+)/i.exec(a))this.addLine(new AssertLine$$module$6502(this.pc=parseNumber$$module$6502(b[2]),!b[1]));else if(b=/^\s*\.bank\s+(\S+)\s+(\S+)\s*:\s*(\S+)/i.exec(a)){const [,a,c,g]=b;this.addLine(new BankLine$$module$6502(parseNumber$$module$6502(a),parseNumber$$module$6502(c),parseNumber$$module$6502(g)))}else if(b=/^\s*\.(byte|word)\s+(.*)/i.exec(a))b=("word"==b[1]?WordLine$$module$6502:ByteLine$$module$6502).parse(b[2]),this.addLine(b),
this.pc+=b.size();else if(b=/^\s*\.res\s+([^,]+)(?:,\s*(.+))?/i.exec(a))b=ByteLine$$module$6502.parseRes(parseNumber$$module$6502(b[1]),parseNumber$$module$6502(b[2]||0)),this.addLine(b),this.pc+=b.size();else if(b=/^define\s+(\S+)\s+(.*)/.exec(a))this.addLabel(b[1],parseNumber$$module$6502(b[2]));else{if(b=/^(\S+?):(.*)$/.exec(a)){var c=b[1];a=" "+b[2];this.addLabel(c,~this.pc)}else if(b=/^((?:[-+]+\s+)+)(.*)$/.exec(a)){a=b[1];for(c of a.trim().split(" "))this.addLabel(c,~this.pc);a=" "+b[2]}if(b=
/^\s+([a-z]{3})(\s+.*)?$/.exec(a))b=new Opcode$$module$6502(b[1],(b[2]||"").trim(),this.pc),this.addLine(b),this.pc+=b.size();else if(/\S/.test(a))throw Error(`Could not parse line ${a} at ${this.filename}:${this.lineNumber}`);}}assemble(){var a=new Context$$module$6502(this.labels),b=[];const c=[],d=(a,b)=>{throw Error(`Collision at $${b.toString(16)}:\n  written at ${c[b].source()}\n  written at ${a.source()}`);};for(var e of this.lines){try{e.expand(a)}catch(f){throw b=f.stack.replace(`Error: ${f.message}`,
""),Error(`${f.message}${` from line ${e.origLineNumber+1}: \`${e.origContent}\``}${b}\n================`);}e instanceof OrgLine$$module$6502&&null!=b[e.pc]&&d(e,e.pc);for(const g of e.bytes())null!=b[a.pc]&&d(e,a.pc),c[a.pc]=e,b[a.pc++]=g}a=[];for(var g in b)g-1 in b||a.push(Number(g));e=[];for(const c of a){g=[];for(a=c;a in b;a++)g.push(b[a]);e.push(new Chunk$$module$6502(c,g))}if(this.conditions.length)throw Error("Unterminated .if");return e}}
class AbstractLine$$module$6502{orig(a,b,c){this.origFile=a;this.origLineNumber=b;this.origContent=c;return this}expand(){throw Error(`abstract: ${this.constructor}`);}bytes(){throw Error(`abstract: ${this.constructor}`);}source(){return`${this.origFile}:${this.origLineNumber+1}  ${this.origContent}`}}
class ByteLine$$module$6502 extends AbstractLine$$module$6502{static parse(a){const b=[];for(let c of a.split(","))c=c.trim(),(a=/^"(.*)"$/.exec(c))?b.push(...[...a[1]].map((a)=>a.charCodeAt(0))):b.push(parseNumber$$module$6502(c));return new ByteLine$$module$6502(b)}static parseRes(a,b){console.log(`res ${a}, ${b}`);return new ByteLine$$module$6502(Array(a).fill(b))}constructor(a){super();this.bytes_=a}bytes(){return[...this.bytes_]}size(){return this.bytes_.length}expand(){}}
class WordLine$$module$6502 extends AbstractLine$$module$6502{static parse(a){const b=[];for(let c of a.split(","))c=c.trim(),c=c.replace(/[()]/g,""),b.push(parseNumber$$module$6502(c,!0));return new WordLine$$module$6502(b)}constructor(a){super();this.words=a}bytes(){const a=[];for(const b of this.words)a.push(b&255),a.push(b>>>8);return a}size(){return 2*this.words.length}expand(a){for(let b=0;b<this.words.length;b++)"string"==typeof this.words[b]&&(this.words[b]=a.map(this.words[b]))}}
class OrgLine$$module$6502 extends AbstractLine$$module$6502{constructor(a){super();this.pc=a}bytes(){return[]}size(){return 0}expand(a){a.pc=this.pc}}
class AssertLine$$module$6502 extends AbstractLine$$module$6502{constructor(a,b){super();this.pc=a;this.exact=b}bytes(){return[]}size(){return 0}expand(a){if(this.exact?a.pc!=this.pc:a.pc>this.pc)throw Error(`Misalignment: expected ${this.exact?"":"< "}$${this.pc.toString(16)} but was $${a.pc.toString(16)}`);!this.exact&&LOG$$module$6502&&console.log(`Free: ${this.pc-a.pc} bytes between $${a.pc.toString(16)} and $${this.pc.toString(16)}`)}}
class BankLine$$module$6502 extends AbstractLine$$module$6502{constructor(a,b,c){super();this.prg=a;this.cpu=b;this.length=c}bytes(){return[]}size(){return 0}expand(a){a.updateBank(this.prg,this.cpu,this.length)}}
class Context$$module$6502{constructor(a){this.pc=0;this.labels=a;this.cpuToPrg=[];this.prgToCpu=[]}updateBank(a,b,c){for(var d=0;d<c;d++){var e=b+d,g=this.cpuToPrg[e];null!=g&&(this.prgToCpu[g]=null,this.cpuToPrg[e]=null)}for(d=0;d<c;d++)e=b+d,g=a+d,this.prgToCpu[g]=e,this.cpuToPrg[e]=g}mapLabel(a,b){let c=this.labels[a];if(!c)throw Error(`Label not found: ${a}`);if(null==b){if(1<c.length)throw Error(`Ambiguous label: ${a}`);return c[0]}b=~(b+2);const d=find$$module$6502(c,b);if(0<=d)return c[d];
if(-1==d)return c[0];if(d==~c.length)return c[c.length-1];c=c.slice(~d-1,~d+1);return a.startsWith("-")?c[1]:a.startsWith("+")?c[0]:b<(c[0]+c[1])/2?c[0]:c[1]}mapPrgToCpu(a){const b=this.prgToCpu[a];if(null==b)throw Error(`PRG address unmapped: $${a.toString(16)}`);return b}map(a,b=void 0){if(null==a)return a;"string"==typeof a&&(a=this.mapLabel(a,b));0>a&&(a=this.mapPrgToCpu(~a));return a}}
class Chunk$$module$6502 extends Uint8Array{constructor(a,b){super(b.length);this.set(b);this.start=a}apply(a){a.subarray(this.start,this.start+this.length).set(this)}shift(a){return new Chunk$$module$6502(this.start+a,this)}}
class Patch$$module$6502{static from(a){const b=[];var c=8;new Set;for(var d of a)a=new Uint8Array(d.length+5),a[0]=d.start>>>16,a[1]=d.start>>>8&255,a[2]=d.start&255,a[3]=d.length>>>8,a[4]=d.length&255,a.set(d,5),b.push(a),c+=a.length;c=new Uint8Array(c);d=5;c[0]=80;c[1]=65;c[2]=84;c[3]=67;c[4]=72;for(const a of b)c.subarray(d,d+a.length).set(a),d+=a.length;c[d]=69;c[d+1]=79;c[d+2]=70;return new Patch$$module$6502(c)}constructor(a){this.data=a}apply(a){for(const b of this)b.apply(a)}*[Symbol.iterator](){let a=
5;for(;a<this.data.length-3;){const b=this.data[a+3]<<8|this.data[a+4];yield new Chunk$$module$6502(this.data[a]<<16|this.data[a+1]<<8|this.data[a+2],this.data.subarray(a+5,a+5+b));a+=b+5}}toHexString(){return[...this.data].map((a)=>a.toString(16).padStart(2,0)).join("")}}
const assemble$$module$6502=(a,b="input")=>{b=new File$$module$6502({},b);let c=0;for(const d of a.split("\n"))c++,b.ingest(d);a=b.assemble();return Patch$$module$6502.from(a)},buildRomPatch$$module$6502=(a,b=void 0,c=void 0)=>{a=[...a].map((a)=>a.shift(16));b=[...b||[]].map((a)=>a.shift(16+c));return Patch$$module$6502.from([...a,...b])};
class Opcode$$module$6502 extends AbstractLine$$module$6502{constructor(a,b,c){super();this.mnemonic=a;this.arg=mode$$module$6502(a,b);this.pc=c}size(){return 1+this.arg[1]}bytes(){let a=this.arg[2];if("Relative"==this.arg[0]&&(a-=this.pc+2,!(128>a&&-128<=a)))throw Error(`Too far to branch: ${a} at input:${this.origLineNumber}`);const b=[opcodes$$module$6502[this.mnemonic][this.arg[0]]];let c=this.arg[1];for(;c--;)b.push(a&255),a>>>=8;return b}expand(a){try{this.arg[2]=a.map(this.arg[2],this.pc)}catch(b){throw console.error(this),
b;}this.pc=a.map(~this.pc)}}const find$$module$6502=(a,b)=>{let c=0,d=a.length-1;if(0>d||b<a[0])return-1;var e=a[d];if(b==e)return d;if(b>e)return~a.length;for(;1<d-c;)e=c+d>>1,b<a[e]?d=e:c=e;return b==a[c]?c:~d},mode$$module$6502=(a,b)=>{for(const [d,e]of modes$$module$6502){var c=d.exec(b);if(c){c=e(c[1]);if(!(a in opcodes$$module$6502))throw Error(`Bad mnemonic: ${a}`);if(c[0]in opcodes$$module$6502[a])return c}}throw Error(`Could not find mode for ${a} ${b}
Expected one of [${Object.keys(opcodes$$module$6502[a]).join(", ")}]`);},modes$$module$6502=[[/^$/,()=>["Implied",0]],[/^#(.+)$/,(a)=>["Immediate",1,parseNumber$$module$6502(a,!0)]],[/^(\$..)$/,(a)=>["ZeroPage",1,parseNumber$$module$6502(a,!0)]],[/^(\$..),x$/,(a)=>["ZeroPageX",1,parseNumber$$module$6502(a,!0)]],[/^(\$..),y$/,(a)=>["ZeroPageY",1,parseNumber$$module$6502(a,!0)]],[/^\((\$..),x\)$/,(a)=>["PreindexedIndirect",1,parseNumber$$module$6502(a,!0)]],[/^\((\$..)\),y$/,(a)=>["PostindexedIndirect",
1,parseNumber$$module$6502(a,!0)]],[/^\((.+)\)$/,(a)=>["IndirectAbsolute",2,parseNumber$$module$6502(a,!0)]],[/^(.+),x$/,(a)=>["AbsoluteX",2,parseNumber$$module$6502(a,!0)]],[/^(.+),y$/,(a)=>["AbsoluteY",2,parseNumber$$module$6502(a,!0)]],[/^(.+)$/,(a)=>["Absolute",2,parseNumber$$module$6502(a,!0)]],[/^(.+)$/,(a)=>["Relative",1,parseNumber$$module$6502(a,!0)]]],parseNumber$$module$6502=(a,b=!1)=>{if(a.startsWith("$"))return Number.parseInt(a.substring(1),16);if(a.startsWith("%"))return Number.parseInt(a.substring(1),
2);if(a.startsWith("0"))return Number.parseInt(a,8);const c=Number.parseInt(a,10);if(!Number.isNaN(c))return c;if(b)return a;throw Error(`Bad number: ${a}`);},opcodes$$module$6502={adc:{Immediate:105,ZeroPage:101,ZeroPageX:117,Absolute:109,AbsoluteX:125,AbsoluteY:121,PreindexedIndirect:97,PostindexedIndirect:113},and:{Immediate:41,ZeroPage:37,ZeroPageX:53,Absolute:45,AbsoluteX:61,AbsoluteY:57,PreindexedIndirect:33,PostindexedIndirect:49},asl:{Implied:10,ZeroPage:6,ZeroPageX:22,Absolute:14,AbsoluteX:30},
bcc:{Relative:144},bcs:{Relative:176},beq:{Relative:240},bit:{ZeroPage:36,Absolute:44},bmi:{Relative:48},bne:{Relative:208},bpl:{Relative:16},brk:{Implied:0},bvc:{Relative:80},bvs:{Relative:112},clc:{Implied:24},cld:{Implied:216},cli:{Implied:88},clv:{Implied:184},cmp:{Immediate:201,ZeroPage:197,ZeroPageX:213,Absolute:205,AbsoluteX:221,AbsoluteY:217,PreindexedIndirect:193,PostindexedIndirect:209},cpx:{Immediate:224,ZeroPage:228,Absolute:236},cpy:{Immediate:192,ZeroPage:196,Absolute:204},dec:{ZeroPage:198,
ZeroPageX:214,Absolute:206,AbsoluteX:222},dex:{Implied:202},dey:{Implied:136},eor:{Immediate:73,ZeroPage:69,ZeroPageX:85,Absolute:77,AbsoluteX:93,AbsoluteY:89,PreindexedIndirect:65,PostindexedIndirect:81},inc:{ZeroPage:230,ZeroPageX:246,Absolute:238,AbsoluteX:254},inx:{Implied:232},iny:{Implied:200},jmp:{Absolute:76,IndirectAbsolute:108},jsr:{Absolute:32},lda:{Immediate:169,ZeroPage:165,ZeroPageX:181,Absolute:173,AbsoluteX:189,AbsoluteY:185,PreindexedIndirect:161,PostindexedIndirect:177},ldx:{Immediate:162,
ZeroPage:166,ZeroPageY:182,Absolute:174,AbsoluteY:190},ldy:{Immediate:160,ZeroPage:164,ZeroPageX:180,Absolute:172,AbsoluteX:188},lsr:{Implied:74,ZeroPage:70,ZeroPageX:86,Absolute:78,AbsoluteX:94},nop:{Implied:234},ora:{Immediate:9,ZeroPage:5,ZeroPageX:21,Absolute:13,AbsoluteX:29,AbsoluteY:25,PreindexedIndirect:1,PostindexedIndirect:17},pha:{Implied:72},php:{Implied:8},pla:{Implied:104},plp:{Implied:40},rol:{Implied:42,ZeroPage:38,ZeroPageX:54,Absolute:46,AbsoluteX:62},ror:{Implied:106,ZeroPage:102,
ZeroPageX:118,Absolute:110,AbsoluteX:126},rti:{Implied:64},rts:{Implied:96},sbc:{Immediate:233,ZeroPage:229,ZeroPageX:245,Absolute:237,AbsoluteX:253,AbsoluteY:249,PreindexedIndirect:225,PostindexedIndirect:241},sec:{Implied:56},sed:{Implied:248},sei:{Implied:120},sta:{ZeroPage:133,ZeroPageX:149,Absolute:141,AbsoluteX:157,AbsoluteY:153,PreindexedIndirect:129,PostindexedIndirect:145},stx:{ZeroPage:134,ZeroPageY:150,Absolute:142},sty:{ZeroPage:132,ZeroPageX:148,Absolute:140},tax:{Implied:170},tay:{Implied:168},
tsx:{Implied:186},txa:{Implied:138},txs:{Implied:154},tya:{Implied:152}};var module$6502={};module$6502.Assembler=Assembler$$module$6502;module$6502.assemble=assemble$$module$6502;module$6502.buildRomPatch=buildRomPatch$$module$6502;const Bits$$module$bits_bigint={},BitsBigInt$$module$bits_bigint=Bits$$module$bits_bigint;Bits$$module$bits_bigint.of=(...a)=>{let b=ZERO$$module$bits_bigint;for(const c of a)b|=ONE$$module$bits_bigint<<BigInt(c);return b};Bits$$module$bits_bigint.from=(a)=>{let b=ZERO$$module$bits_bigint;for(const c of a)b|=ONE$$module$bits_bigint<<BigInt(c);return b};Bits$$module$bits_bigint.containsAll=(a,b)=>!(b&~a);Bits$$module$bits_bigint.with=(a,b)=>a|ONE$$module$bits_bigint<<BigInt(b);
Bits$$module$bits_bigint.without=(a,b)=>a&~(ONE$$module$bits_bigint<<BigInt(b));Bits$$module$bits_bigint.has=(a,b)=>!!(a&ONE$$module$bits_bigint<<BigInt(b));Bits$$module$bits_bigint.bits=(a)=>{const b=[];let c=0;for(;a;){let d=Number(a&MAX_UINT32$$module$bits_bigint),e=32;for(;d;){const a=Math.clz32(d)+1;e-=a;d<<=a;32==a&&(d=0);b.push(c|e)}a>>=THIRTY_TWO$$module$bits_bigint;c+=32}return b};Bits$$module$bits_bigint.clone=(a)=>a;Bits$$module$bits_bigint.empty=(a)=>!a;
Bits$$module$bits_bigint.difference=(a,b)=>a&~b;const BIGINT_OK$$module$bits_bigint="function"===typeof BigInt&&"bigint"===typeof BigInt(0),ZERO$$module$bits_bigint=BIGINT_OK$$module$bits_bigint&&BigInt(0),ONE$$module$bits_bigint=BIGINT_OK$$module$bits_bigint&&BigInt(1),MAX_UINT32$$module$bits_bigint=BIGINT_OK$$module$bits_bigint&&BigInt(4294967295),THIRTY_TWO$$module$bits_bigint=BIGINT_OK$$module$bits_bigint&&BigInt(32);var module$bits_bigint={};module$bits_bigint.BitsBigInt=Bits$$module$bits_bigint;
module$bits_bigint.BIGINT_OK=BIGINT_OK$$module$bits_bigint;const Bits$$module$bits_array={},BitsArray$$module$bits_array=Bits$$module$bits_array;Bits$$module$bits_array.of=(...a)=>{const b=[];for(const c of a)b[c>>>5]=(b[c>>>5]||0)|1<<c;return b};Bits$$module$bits_array.from=(a)=>{const b=[];for(const c of a)b[c>>>5]=(b[c>>>5]||0)|1<<c;return b};Bits$$module$bits_array.containsAll=(a,b)=>{for(let c=Math.max(a.length,b.length)-1;0<=c;c--)if((b[c]||0)&~(a[c]||0))return!1;return!0};
Bits$$module$bits_array.difference=(a,b)=>{const c=Array(Math.max(a.length,b.length));for(let d=Math.max(a.length,b.length)-1;0<=d;d--)c[d]=(a[d]||0)&~(b[d]||0);return c};Bits$$module$bits_array.with=(a,b)=>{a=[...a];a[b>>>5]=(a[b>>>5]||0)|1<<b;return a};Bits$$module$bits_array.without=(a,b)=>{a=[...a];a[b>>>5]=(a[b>>>5]||0)&~(1<<b);return a};Bits$$module$bits_array.has=(a,b)=>!!((a[b>>>5]||0)&1<<b);
Bits$$module$bits_array.bits=(a)=>{const b=[];for(let c=0;c<a.length;c++){let d=a[c],e=32;for(;d;){const a=Math.clz32(d)+1;e-=a;d<<=a;32==a&&(d=0);b.push(c<<5|e)}}return b};Bits$$module$bits_array.clone=(a)=>[...a];Bits$$module$bits_array.empty=(a)=>a.every((a)=>!a);var module$bits_array={};module$bits_array.BitsArray=Bits$$module$bits_array;const b$$module$bits=BIGINT_OK$$module$bits_bigint?Bits$$module$bits_bigint:Bits$$module$bits_array;class Bits$$module$bits{}Bits$$module$bits.of=b$$module$bits.of;Bits$$module$bits.from=b$$module$bits.from;Bits$$module$bits.containsAll=b$$module$bits.containsAll;Bits$$module$bits.with=b$$module$bits.with;Bits$$module$bits.without=b$$module$bits.without;Bits$$module$bits.has=b$$module$bits.has;Bits$$module$bits.bits=b$$module$bits.bits;Bits$$module$bits.clone=b$$module$bits.clone;
Bits$$module$bits.empty=b$$module$bits.empty;Bits$$module$bits.difference=b$$module$bits.difference;var module$bits={};module$bits.Bits=Bits$$module$bits;let table$$module$crc32;const buildTable$$module$crc32=()=>{let a;const b=Array(256);for(let c=0;256>c;c++){a=c;for(let b=0;8>b;b++)a=a&1?3988292384^a>>>1:a>>>1;b[c]=a}return b},crc32$$module$crc32=(a)=>{table$$module$crc32||(table$$module$crc32=buildTable$$module$crc32());let b=-1;for(let c=0;c<a.length;c++)b=b>>>8^table$$module$crc32[(b^a[c])&255];return(b^-1)>>>0};var module$crc32={};module$crc32.crc32=crc32$$module$crc32;const REPEATABLE_FLAGS$$module$flagset=new Set(["S"]),PRESETS$$module$flagset=[{title:"Casual",flags:"Ds Edmrsx Fw Mr Rp Sbk Sc Sm Tab",descr:"Basic flags for a relatively easy playthrough."},{title:"Intermediate",flags:"Ds Edms Fsw Gt Mr Ps Rlpt Sbkm Sct Tab",descr:"Slightly more challenge than Casual but still approachable.",default:!0},{title:"Full Shuffle",flags:"Em Fsw Gt Mr Ps Rlprt Sbckmt Tab",descr:"Slightly harder than intermediate, with full shuffle and no spoiler log."},{title:"Glitchless",
flags:"Em Fcpstw Mr Ps Rlprt Sbckmt Tab",descr:"Full shuffle but with no glitches."},{title:"Advanced",flags:"Fsw Gfprt Hbw Mr Ps Rlprt Sbckt Sm Tab",descr:"A balanced randomization with quite a bit more difficulty."},{title:"Ludicrous",flags:"Fs Gfprstw Hbgmswx Mr Ps Rlprt Sbckmt Tab",descr:"Pulls out all the stops, may require superhuman feats."}],PRESETS_BY_KEY$$module$flagset={};
for(const {title:a,flags:b}of PRESETS$$module$flagset)PRESETS_BY_KEY$$module$flagset[`@${a.replace(/ /g,"").toLowerCase()}`]=b;
const FLAGS$$module$flagset=[{section:"Items",text:"Items are broken into five pools: <i>key items</i> includes all\n      swords, orbs, bracelets, and progression items (rabbit boots,\n      gas mask, and all items in the third row: windmill key through\n      bow of truth), as well as anything dropped by a boss (one each\n      of fruit of power, opel statue, fruit of repun, sacred shield,\n      and psycho armor); <i>bonus items</i> includes items that are\n      never required but are nice to have, specifically the remaining\n      six passive effect items in the second inventory row;\n      <i>consumable items</i> includes everything else found in\n      chests: primarily first row one-use items, but also includes\n      psycho shield and battle armor; <i>magic</i> is the eight\n      spells; and <i>traps</i> are the 12 trap chests found in various\n      places. These pools can be shuffled together, kept separate, or\n      left unshuffled.",flags:[{flag:"Sk",
name:"Shuffle key items"},{flag:"Sm",name:"Shuffle magics"},{flag:"Sb",name:"Shuffle bonus items"},{flag:"Sc",name:"Shuffle consumables"},{flag:"Sbk",name:"Shuffle key items with bonus items"},{flag:"Sbm",name:"Shuffle bonus items with magic"},{flag:"Sbt",name:"Shuffle bonus items with traps"},{flag:"Sct",name:"Shuffle consumables with traps"},{flag:"Skm",name:"Shuffle key items with magic"},{flag:"Skt",name:"Shuffle key items with traps"},{flag:"Sbkm",name:"Shuffle bonus, key, and magic"},{flag:"Sbc",
hard:!0,name:"Shuffle bonus items with consumables"},{flag:"Sck",hard:!0,name:"Shuffle consumables with key items"},{flag:"Scm",hard:!0,name:"Shuffle consumables with magic"},{flag:"Sbck",hard:!0,name:"Shuffle bonus, consumables, and key items"},{flag:"Sbct",hard:!0,name:"Shuffle bonus, consumables, and traps"},{flag:"Sbkt",hard:!0,name:"Shuffle bonus, key, and traps"},{flag:"Skmt",hard:!0,name:"Shuffle key, magic, and traps"},{flag:"Sbckm",hard:!0,name:"Shuffle bonus, key, consumables, and magic"},
{flag:"Sbckt",hard:!0,name:"Shuffle bonus, key, consumables, and traps"},{flag:"Sbkmt",hard:!0,name:"Shuffle bonus, key, magic, and traps"},{flag:"Sbckmt",hard:!0,name:"Shuffle all items and traps together"}]},{section:"Monsters",text:"Monster stats are always normalized by scaling level.",flags:[{flag:"Mr",name:"Randomize monsters",text:"Monster locations are shuffled, with the exception of sea creatures\n           and tower robots."}]},{section:"Shops",text:"Prices are always normalized by scaling level: prices at tool shops\n         and inns double every 10 scaling levels, while prices at armor shops\n         halve every 12 scaling levels ",
flags:[{flag:"Ps",name:"Shuffle shop contents",text:"This includes normalizing prices via the scaling level, as well as a\n           random variance for each shop: base prices may vary \u00b150% for the same\n           item at different; inn prices may vary \u00b162.5%."}]},{section:"Hard mode",flags:[{flag:"Hw",hard:!0,name:"Battle magic not guaranteed",text:"Normally, the logic will guarantee that level 3 sword charges are\n           available before fighting the tetrarchs (with the exception of Karmine,\n           who only requires level 2).  This disables that check."},
{flag:"Hb",hard:!0,name:"Barrier not guaranteed",text:"Normally, the logic will guarantee Barrier (or else refresh and shield\n           ring) before entering Stxy, the Fortress, or fighting Karmine.  This\n           disables that check."},{flag:"Hm",hard:!0,name:"Don't buff medical herb or fruit of power",text:"Medical Herb is not buffed to heal 64 damage, which is helpful to make\n           up for cases where Refresh is unavailable early.  Fruit of Power is not\n           buffed to restore 48 MP."},
{flag:"Hg",hard:!0,name:"Gas mask not guaranteed",text:"The logic will not guarantee gas mask before needing to enter the swamp.\n           Gas mask is still guaranteed to kill the insect."},{flag:"Hs",hard:!0,name:"Matching sword not guaranteed",text:'Player may be required to fight bosses with the wrong sword, which\n           may require using "tink strats" dealing 1 damage per hit.'},{flag:"Hx",hard:!0,name:"Experience scales slower",text:'More grinding will be required to "keep up" with the difficulty.'},
{flag:"Hc",hard:!0,name:"Charge shots only",text:"Stabbing is completely ineffective.  Only charged shots work."}]},{section:"Tweaks",flags:[{flag:"Ta",name:"Automatically equip orbs and bracelets",text:"Adds a quality-of-life improvement to automatically equip the\n           corresponding orb/bracelet whenever changing swords."},{flag:"Tb",name:"Buff bonus items",text:"Leather Boots are changed to Speed Boots, which increase player walking\n           speed (this allows climbing up the slope to access the Tornado Bracelet\n           chest, which is taken into consideration by the logic).  Deo's pendant\n           restores MP while moving.  Rabbit boots enable sword charging up to\n           level 2 while walking (level 3 still requires being stationary, so as\n           to prevent wasting tons of magic)."}]},
{section:"Routing",flags:[{flag:"Rs",name:"Story Mode",text:"Draygon 2 won't spawn unless you have all four swords and have\n           defeated all major bosses of the tetrarchy."},{flag:"Rt",name:"Sword of Thunder teleports to Shyron",text:"Normally when acquiring the thunder sword, the player is instantly\n           teleported to Shyron. This flag maintains that behavior regardless of\n           where it is found (immediately activating the warp point; talking\n           to Asina will teleport back to the start, in case no other means of\n           return is available).  Disabling this flag means that the Sword of\n           Thunder will act like all other items and not teleport."},
{flag:"Rd",name:"Require healing dolphin to return fog lamp",text:"Normally the fog lamp cannot be returned without healing the dolphin\n           to acquire the shell flute (so as not to be stranded).  Continuity\n           suggests that actually healing the dolphin should also be required,\n           but we've found that this makes the dolphin a lot less useful.  By\n           default the fog lamp can be returned before healing the dolphin.  This\n           flag adds the extra requirement for better continuity."},
{flag:"Rp",name:"Wind-waterfall passage",text:"Opens a passage between Valley of Wind (lower right side) and\n           Lime Tree Valley."},{flag:"Rr",name:"Deo requires telepathy",text:"Deo's item is additionally blocked on telepathy."},{flag:"Rl",name:'No "free lunch" magic',text:'Disables "free lunch" magics that only require stepping on a square to\n           learn (specifally Barrier and Paralysis).  Instead, Barrier requires\n           the seas to be calmed, and Paralysis requires the prison key (which\n           can be used at the top of the slope in Waterfall Valley to open the\n           path in reverse).  Reverse vampire also requires the windmill to have\n           been started.'},
{flag:"Ro",name:"Orbs not required to break walls",text:"Walls can be broken and bridges formed with level 1 shots.  Orbs and\n           bracelets are no longer considered progression items (except for\n           Tornado bracelet for Tornel on Mt Sabre)."}]},{section:"Glitches",text:"The routing logic can be made aware of the following\n      glitches.  If selected, it will assume that the glitch can be\n      performed when verifying that a game is winnable.  Enabling\n      these glitches tends to increase the randomness of the shuffle,\n      since there are more valid options.",
flags:[{flag:"Gc",hard:!0,name:"Sword charge glitch may be required",text:"Progression may require using the sword charge glitch to destroy walls or\n           form bridges without actually possessing the correct orb."},{flag:"Gf",name:"Ghetto flight may be required",text:"Progression may require using Rabbit Boots and the dolphin to reach Swan\n           before the Angry Sea can be calmed and before Flight is available."},{flag:"Gp",name:"Teleport skip may be required",text:"Progression may require entering Mt. Sabre North from Cordel Plain\n           without the Teleport spell (flying over the river to avoid the\n           trigger)."},
{flag:"Gr",name:"Rabbit skip may be required",text:"Progression may require entering Mt. Sabre North from Cordel Plain\n           without talking to the rabbit in Leaf after the abduction."},{flag:"Gt",name:"Statue glitch may be required",text:"Progression may require glitching past guards without Change or Paralysis,\n           or people turned to stone without a Flute of Lime.  The logic <i>hopefully</i>\n           ensures that using the Flute of Lime on the two statues will not break the\n           game, but we're less confident that this is always the case, so for safety\n           we recommend always glitching past the statues if this option is set, even if\n           the first Flute of Lime has been found."},
{flag:"Gw",hard:!0,name:"Wild warp may be required",text:'Progression may require using "wild warp" (holding A and B on controller 1\n           and tapping A on controller 2) to travel to parts of the game that would\n           otherwise be unreachable.'}]},{section:"Glitch Fixes",text:"Alternatively, glitches may be patched out of the game and made unusable.\n         These flags are exclusive with the flags that require the glitch.",flags:[{flag:"Fs",name:"Disable shop glitch",text:"Items may no longer be purchased for neighboring prices.  This makes\n           money actually mean something.  To compensate, gold drops money\n           will be scaled up somewhat."},
{flag:"Fc",name:"Disable sword charge glitch",text:"Sword charge glitch will no longer work.  It will be impossible to\n           achieve charge levels without having correct inventory."},{flag:"Fp",name:"Disable teleport skip",text:"Mt Sabre North cannot be entered from Cordel Plans without the\n           Teleport spell, even via glitch."},{flag:"Fr",name:"Disable rabbit skip",text:"Mt Sabre North cannot be entered from Cordel Plans without talking to\n           the rabbit in leaf."},{flag:"Ft",
name:"Disable statue glitch",text:"Statues will instead always push downwards, making it impossible to\n           glitch through statues for progression."},{flag:"Fw",name:"Disable wild warp",text:"Wild warp will only teleport back to Mezame shrine (to prevent\n           game-breaking soft-locks)."}]},{section:"Easy Mode",text:"The following options make parts of the game easier.",flags:[{flag:"Ed",name:"Decrease enemy damage",text:"Enemy attack power will be significantly decreased in the early game\n           (by a factor of 3).  The gap will narrow in the mid-game and eventually\n           phase out at scaling level 40."},
{flag:"Es",name:"Guarantee starting sword",text:"The Leaf elder is guaranteed to give a sword.  It will not be\n           required to deal with any enemies before finding the first sword."},{flag:"Er",name:"Guarantee refresh",text:"Guarantees the Refresh spell will be available before fighting Tetrarchs."},{flag:"Em",name:"Extra buff medical herb",text:"Buff Medical Herb to heal 96 instead of 64 and Fruit of Power to\n           restore 64 MP instead of 48."},{flag:"Ex",name:"Experience scales faster",
text:'Less grinding will be required to "keep up" with the game difficulty.'}]},{section:"Debug Mode",text:"These options are helpful for exploring or debugging.  Note that,\n      while they do not directly affect any randomization, they\n      <i>do</i> factor into the seed to prevent cheating, and they\n      will remove the option to generate a seed for racing.",flags:[{flag:"Ds",name:"Generate a spoiler log"},{flag:"Di",name:"Player never dies"}]}],exclusiveFlags$$module$flagset=(a)=>a.startsWith("S")?
new RegExp(`S.*[${a.substring(1)}]`):FLAG_CONFLICTS$$module$flagset[a],FLAG_CONFLICTS$$module$flagset={Hm:/Em/,Hx:/Ex/,Em:/Hm/,Ex:/Hx/,Fw:/Gw/,Gw:/Fw/,Ft:/Gt/,Gt:/Ft/,Fc:/Gc/,Gc:/Fc/,Fp:/Gp/,Gp:/Fp/,Fr:/Gr/,Gr:/Fr/};
class FlagSet$$module$flagset{constructor(a="RtGftTab"){a.startsWith("@")&&(a=PRESETS_BY_KEY$$module$flagset[a.toLowerCase()]);this.flags={};a=a.replace(/[^A-Za-z0-9!]/g,"");const b=/([A-Z])([a-z0-9!]+)/g;let c;for(;c=b.exec(a);){let [,a,b]=c;REPEATABLE_FLAGS$$module$flagset.has(a)&&(b=[b]);for(const c of b)this.set(a+c,!0)}}set(a,b){const c=a[0],d=a.substring(1);b?(this.removeConflicts(a),a=(this.flags[c]||[]).filter((a)=>a!==d),a.push(d),a.sort(),this.flags[c]=a):(a=(this.flags[c]||[]).filter((a)=>
a!==d),a.length?this.flags[c]=a:delete this.flags[c])}check(a){const b=this.flags[a[0]];return!!(b&&0<=b.indexOf(a.substring(1)))}autoEquipBracelet(){return this.check("Ta")}buffDeosPendant(){return this.check("Tb")}leatherBootsGiveSpeed(){return this.check("Tb")}rabbitBootsChargeWhileWalking(){return this.check("Tb")}shuffleMonsters(){return this.check("Mr")}shuffleShops(){return this.check("Ps")}bargainHunting(){return this.shuffleShops()}doubleBuffMedicalHerb(){return this.check("Em")}buffMedicalHerb(){return!this.check("Hm")}decreaseEnemyDamage(){return this.check("Ed")}neverDie(){return this.check("Di")}chargeShotsOnly(){return this.check("Hc")}barrierRequiresCalmSea(){return this.check("Rl")}paralysisRequiresPrisonKey(){return this.check("Rl")}sealedCaveRequiresWindmill(){return this.check("Rl")}connectLimeTreeToLeaf(){return this.check("Rp")}storyMode(){return this.check("Rs")}requireHealedDolphinToRide(){return this.check("Rd")}saharaRabbitsRequireTelepathy(){return this.check("Rr")}teleportOnThunderSword(){return this.check("Rt")}orbsOptional(){return this.check("Ro")}guaranteeSword(){return this.check("Es")}guaranteeSwordMagic(){return!this.check("Hw")}guaranteeMatchingSword(){return!this.check("Hs")}guaranteeGasMask(){return!this.check("Hg")}guaranteeBarrier(){return!this.check("Hb")}guaranteeRefresh(){return this.check("Er")}disableSwordChargeGlitch(){return this.check("Fc")}disableTeleportSkip(){return this.check("Fp")}disableRabbitSkip(){return this.check("Fr")}disableShopGlitch(){return this.check("Fs")}disableStatueGlitch(){return this.check("Ft")}assumeSwordChargeGlitch(){return this.check("Gc")}assumeGhettoFlight(){return this.check("Gf")}assumeTeleportSkip(){return this.check("Gp")}assumeRabbitSkip(){return this.check("Gr")}assumeStatueGlitch(){return this.check("Gt")}assumeWildWarp(){return this.check("Gw")}nerfWildWarp(){return this.check("Fw")}allowWildWarp(){return!this.nerfWildWarp()}expScalingFactor(){return this.check("Hx")?
.25:this.check("Ex")?2.5:1}removeConflicts(a){const b=exclusiveFlags$$module$flagset(a);if(b)for(const c in this.flags)a=this.flags[c].filter((a)=>!b.test(c+a)),a.length?this.flags[c]=a:delete this.flags[c]}toStringKey(a){return REPEATABLE_FLAGS$$module$flagset.has(a)?[...this.flags[a]].sort().map((b)=>a+b).join(" "):a+[...this.flags[a]].sort().join("")}toString(){const a=Object.keys(this.flags);a.sort();return a.map((a)=>this.toStringKey(a)).join(" ")}}var module$flagset={};
module$flagset.PRESETS=PRESETS$$module$flagset;module$flagset.FLAGS=FLAGS$$module$flagset;module$flagset.FlagSet=FlagSet$$module$flagset;const generate$$module$depgraph=(a)=>{a=void 0===a?new FlagSet$$module$flagset:a;const b=new WorldGraph$$module$nodes,c=(a,c)=>new Option$$module$nodes(b,a,void 0===c?!0:c),d=(a,c)=>new Item$$module$nodes(b,a,c,a,null),e=(a,c,...d)=>new Boss$$module$nodes(b,a,c,...d);new TrackerNode$$module$nodes(b,TrackerNode$$module$nodes.OFF_ROUTE,"Off-route");const g=new TrackerNode$$module$nodes(b,TrackerNode$$module$nodes.GLITCH,"Glitch"),f=new TrackerNode$$module$nodes(b,TrackerNode$$module$nodes.HARD,"Hard"),
k=(a)=>a.value?a:g,h=c("Leather Boots grant speed",a.leatherBootsGiveSpeed()),n=k(c("Assume ghetto flight",a.assumeGhettoFlight())),m=k(c("Assume statue glitch",a.assumeStatueGlitch())),q=c("Allow statue glitch",!a.disableStatueGlitch()),p=k(c("Assume teleport skip",a.assumeTeleportSkip())),l=c("Allow teleport skip",!a.disableTeleportSkip()),r=k(c("Assume rabbit skip",a.assumeRabbitSkip())),I=k(c("Allow rabbit skip",!a.disableRabbitSkip())),C=k(c("Assume sword charge glitch",a.assumeSwordChargeGlitch())),
U=c("Allow sword charge glitch",!a.disableSwordChargeGlitch()),va=k(c("Assume wild warp",a.assumeWildWarp())),oa=c("Allow wild warp",a.allowWildWarp()),E=c("Sword magic optional",!a.guaranteeSwordMagic()),G=c("Matching sword optional",!a.guaranteeMatchingSword()),Pa=c("Gas mask optional",!a.guaranteeGasMask()),Pd=c("Healed dolphin optional",a.requireHealedDolphinToRide()),Qd=c("Calm sea optional",!a.barrierRequiresCalmSea()),Rd=c("Prison key optional",!a.paralysisRequiresPrisonKey()),Sd=c("Windmill optional",
!a.sealedCaveRequiresWindmill()),Td=c("Sword of Thunder teleports to Shyron",a.teleportOnThunderSword()),Wb=c("Barrier magic optional",!a.guaranteeBarrier()),Xb=c("Refresh magic optional",!a.guaranteeRefresh()),Ud=c("Telepathy optional for Deo",!a.saharaRabbitsRequireTelepathy()),Vd=c("Lime Tree connects to Leaf",a.connectLimeTreeToLeaf()),Wd=c("Buffed medical herb",a.buffMedicalHerb()),Qa=c("Orbs optional",a.orbsOptional()),P=d(0,"Sword of Wind").weight(a.guaranteeSword()?10:5).fromPerson("Leaf elder",
13).npcSpawn(94,16,1).dialog(13,192,2).key(),Q=d(1,"Sword of Fire").weight(a.guaranteeSword()?10:5).fromPerson("Oak elder",29).dialog(29,null,3).key(),L=d(2,"Sword of Water").weight(10).chest().key(),J=d(3,"Sword of Thunder").weight(15).chest().key(),pb=d(4,"Crystalis").fixed(),Ra=d(5,"Ball of Wind").chest().key(),Ia=d(6,"Tornado Bracelet").chest().key(),Sa=d(7,"Ball of Fire").bossDrop("Insect",1).dialog(30,null,0).dialog(32,null,0).dialog(33,null,0).dialog(34,null,0).dialog(96,30,0).dialog(29,null,
2).dialog(31,null,0).npcSpawn(193).key(),Ta=d(8,"Flame Bracelet").bossDrop("Kelbesque 1",2).npcSpawn(194).key(),Ua=d(9,"Ball of Water").weight(5).direct("Rage",250679).npcSpawn(195).key(),Va=d(10,"Blizzard Bracelet").weight(5).chest().key(),Wa=d(11,"Ball of Thunder").bossDrop("Mado 1",5).trigger(154,1).key(),Xa=d(12,"Storm Bracelet").chest().key(),Yb=d(13,"Carapace Shield").armor(),Xd=d(14,"Bronze Shield").armor(),Zb=d(15,"Platinum Shield").armor(),$b=d(16,"Mirrored Shield").armor(),Yd=d(17,"Ceramic Shield").armor(),
qb=d(18,"Sacred Shield").armor().bossDrop("Mado 2",8).npcSpawn(199).bonus(),ac=d(19,"Battle Shield").armor(),Zd=d(20,"Psycho Shield").armor(),$d=d(21,"Tanned Hide").armor(),ae=d(22,"Leather Armor").armor(),be=d(23,"Bronze Armor").armor(),bc=d(24,"Platinmum Armor").armor(),ce=d(25,"Soldier Suit").armor(),cc=d(26,"Ceramic Suit").armor(),de=d(27,"Battle Suit").armor(),ee=d(28,"Psycho Armor").armor().bossDrop("Draygon 1",10).npcSpawn(203).trigger(159).npcSpawn(131).key(),D=d(29,"Medical Herb").consumable(),
K=d(30,"Antidote").consumable(),wa=d(31,"Lysis Plant").consumable(),rb=d(32,"Fruit of Lime").consumable(),M=d(33,"Fruit of Power").consumable(),V=d(34,"Magic Ring").consumable(),sb=d(35,"Fruit of Repun").consumable().bossDrop("Sabera 2",7).npcSpawn(198).key(),R=d(36,"Warp Boots").consumable(),dc=d(37,"Statue of Onyx").chest("Cordel grass").invisible(254882).key(),tb=d(38,"Opel Statue").consumable().bossDrop("Kelbesque 2",6).npcSpawn(197).key(),ec=d(39,"Insect Flute").fromPerson("Oak mother",30).dialog(30,
null,1).key(),ub=d(40,"Flute of Lime").fromPerson("Portoa queen",56).direct(39161).dialog(56,null,4).key(),Ya=d(41,"Gas Mask").direct("Akahana in Brynmaer",251902).npcSpawn(22,24).key(),fe=d(42,"Power Ring").chest().bonus(),ge=d(43,"Warrior Ring").fromPerson("Akahana's friend",84).dialog(84,null,2).bonus(),he=d(44,"Iron Necklace").chest().bonus(),ie=d(45,"Deo's Pendant").fromPerson("Deo",90).dialog(90,null,0).bonus(),vb=d(46,"Rabbit Boots").bossDrop("Vampire 1",0).npcSpawn(192).key(),fc=d(47,a.leatherBootsGiveSpeed()?
"Speed Boots":"Leather Boots").chest().bonus(),gc=d(48,"Shield Ring").direct("Akahana in waterfall cave",250543).npcSpawn(22,87,2).bonus(),wb=d(49,"Alarm Flute").fromPerson("Zebu's student",20,1).key(),hc=d(50,"Windmill Key").fromPerson("Windmill guard",20).dialog(20,14,0).npcSpawn(20,14,1).key(),xb=d(51,"Key to Prison").chest().key(),ic=d(52,"Key to Styx").fromPerson("Zebu in Shyron",94,1).trigger(128,2).dialog(94,242,0).dialog(98,242,0).key(),jc=d(53,"Fog Lamp").chest().key(),yb=d(54,"Shell Flute").fromPerson("Dolphin",
99,1).npcSpawn(99).key(),kc=d(55,"Eye Glasses").fromPerson("Clark",68).dialog(68,233,1).key(),lc=d(56,"Broken Statue").bossDrop("Sabera 1",4).npcSpawn(127,101).npcSpawn(70).npcSpawn(71).npcSpawn(106).npcSpawn(132).npcSpawn(142).dialog(61).dialog(62).dialog(63).dialog(64).dialog(65).dialog(66).dialog(67).dialog(68,233).trigger(182).key(),mc=d(57,"Glowing Lamp").direct("Kensu in lighthouse",250638).npcSpawn(126,98,1).key(),nc=d(59,"Love Pendant").chest("Underground channel").invisible(254890).key(),
oc=d(60,"Kirisa Plant").chest("Kirisa meadow").invisible(254886).key(),zb=d(61,"Ivory Statue").bossDrop("Karmine",9).npcSpawn(200).key(),pc=d(62,"Bow of Moon").fromPerson("Aryllis",35).direct(251624).dialog(35,null,1).key(),qc=d(63,"Bow of Sun").chest().key(),rc=d(64,"Bow of Truth").fromPerson("Azteca",131).npcSpawn(131,156,1).dialog(131,null,0).key(),Za=(new Magic$$module$nodes(b,65,"Refresh",65,null)).fromPerson("Zebu at windmill",94).requireUnique().direct(251665).dialog(94,16,3).trigger(180,1),
Ja=(new Magic$$module$nodes(b,66,"Paralysis",66,null)).direct("Zebu at Mt. Sabre summit",251477).requireUnique().trigger(141).trigger(178),fa=(new Magic$$module$nodes(b,67,"Telepathy",67,null)).direct("Tornel at Stom's house",223220).npcSpawn(95,30,1).trigger(133,1),sc=(new Magic$$module$nodes(b,68,"Teleport",68,null)).fromPerson("Tornel on Mt. Sabre",95).dialog(95,33,0),je=(new Magic$$module$nodes(b,69,"Recover",69,null)).direct("Asina in Portoa",250361),tc=(new Magic$$module$nodes(b,70,"Barrier",
70,null)).direct("Asina on Angry sea",251609).requireUnique().trigger(132,0),pa=(new Magic$$module$nodes(b,71,"Change",71,null)).direct("Kensu in Swan",251614).npcSpawn(116,241,1),z=(new Magic$$module$nodes(b,72,"Flight",72,null)).weight(15).direct("Kensu in Draygonia Fortress",250255),ke=M.bossDrop("Vampire 2",12,97).npcSpawn(204).key(),N=d(112,"Mimic"),uc=(new Trigger$$module$nodes(b,"Talked to Leaf Elder")).get(P),vc=(new Trigger$$module$nodes(b,"Talked to Leaf Student")).get(wb),Ab=new Trigger$$module$nodes(b,
"Talked to Zebu in cave"),le=(new Trigger$$module$nodes(b,"Woke up Windmill Guard")).get(hc),Ka=new Trigger$$module$nodes(b,"Started Windmill"),wc=(new Trigger$$module$nodes(b,"Learned Refresh")).get(Za),me=(new Trigger$$module$nodes(b,"Gave Statue to Akahana")).get(Ya),ne=(new Trigger$$module$nodes(b,"Fought Stom")).get(fa),xc=new Trigger$$module$nodes(b,"Visited Oak"),yc=new Trigger$$module$nodes(b,"Talked to Oak Mother"),Bb=new Trigger$$module$nodes(b,"Rescued Oak Child"),oe=(new Trigger$$module$nodes(b,
"Talked to Oak Mother Again")).get(ec),pe=(new Trigger$$module$nodes(b,"Talked to Oak Elder")).get(Q),qe=(new Trigger$$module$nodes(b,"Talked to Tornel on Mt Sabre")).get(sc),zc=new Trigger$$module$nodes(b,"Villagers Abducted"),Ac=new Trigger$$module$nodes(b,"Talked to Rabbit in Leaf"),re=(new Trigger$$module$nodes(b,"Learned Paralysis")).get(Ja),Bc=new Trigger$$module$nodes(b,"Talked to Portoa Queen"),Cc=new Trigger$$module$nodes(b,"Talked to Fortune Teller"),Dc=new Trigger$$module$nodes(b,"Visited Underground Channel"),
se=(new Trigger$$module$nodes(b,"Sent to Waterfall Cave")).get(ub),te=(new Trigger$$module$nodes(b,"Cured Akahana")).get(gc),Ec=(new Trigger$$module$nodes(b,"Talked to Rage")).get(Ua),Fc=new Trigger$$module$nodes(b,"Mesia recording played"),Gc=(new Trigger$$module$nodes(b,"Talked to Asina")).get(je),Hc=(new Trigger$$module$nodes(b,"Healed Dolphin")).get(yb),Cb=new Trigger$$module$nodes(b,"Returned Fog Lamp"),Ic=new Trigger$$module$nodes(b,"Talked to Kensu in Cabin"),Jc=new Trigger$$module$nodes(b,
"Talked to Joel Elder"),ue=(new Trigger$$module$nodes(b,"Talked to Clark")).get(kc),ve=(new Trigger$$module$nodes(b,"Talked to Kensu in Lighthouse")).get(mc),Db=new Trigger$$module$nodes(b,"Calmed the Angry Sea"),we=(new Trigger$$module$nodes(b,"Learned Barrier")).get(tc),Kc=new Trigger$$module$nodes(b,"Talked to Stom in Swan Hut"),Lc=new Trigger$$module$nodes(b,"Talked to Kensu in Swan tavern"),Mc=new Trigger$$module$nodes(b,"Talked to Kensu at Swan dance"),xe=(new Trigger$$module$nodes(b,"Returned Kensu's love pendant")).get(pa),
ye=(new Trigger$$module$nodes(b,"Talked to Amazones Queen")).get(pc),Eb=new Trigger$$module$nodes(b,"Entered Shyron"),ze=(new Trigger$$module$nodes(b,"Talked to Zebu in Shyron")).get(ic),Nc=new Trigger$$module$nodes(b,"Shyron Massacre"),Ae=(new Trigger$$module$nodes(b,"Saved Kensu")).get(z),Be=(new Trigger$$module$nodes(b,"Talked to Deo")).get(ie),Ce=(new Trigger$$module$nodes(b,"Talked to Akahana's Friend")).get(ge),De=(new Trigger$$module$nodes(b,"Get Bow of Truth")).get(rc),Ee=(new Trigger$$module$nodes(b,
"Forged Crystalis")).get(pb),$a=(new Condition$$module$nodes(b,"Sword charge glitch")).option(C,U),Fe=(new Condition$$module$nodes(b,"Rabbit skip")).option(r,I),Ge=(new Condition$$module$nodes(b,"Teleport skip")).option(p,l),ab=(new Condition$$module$nodes(b,"Statue glitch")).option(m,q),He=(new Condition$$module$nodes(b,"Wild warp")).option(va,oa),bb=(new Condition$$module$nodes(b,"Any level 2 sword")).option(P,Ra).option(P,Ia).option(Q,Sa).option(Q,Ta).option(L,Ua).option(L,Va).option(J,Wa).option(J,
Xa),v=(new Condition$$module$nodes(b,"Destroy stone")).option(P,Qa).option(P,Ra).option(P,Ia).option($a,P,bb),w=(new Condition$$module$nodes(b,"Destroy ice")).option(Q,Qa).option(Q,Sa).option(Q,Ta).option($a,Q,bb),t=(new Condition$$module$nodes(b,"Cross rivers")).option(L,Qa).option(L,Ua).option(L,Va).option(z).option($a,L,bb),xa=(new Condition$$module$nodes(b,"Destroy iron")).option(J,Qa).option(J,Wa).option(J,Xa).option($a,J,bb),aa=(new Condition$$module$nodes(b,"Any sword")).option(P).option(Q).option(L).option(J),
Ie=(new Condition$$module$nodes(b,"Match insect sword (fire/water/thunder)")).option(Q).option(L).option(J).option(Ya,G.value?G:f,P),Je=(new Condition$$module$nodes(b,"Match vampire 2 sword (wind/water/thunder)")).option(P).option(L).option(J).option(G.value?G:f,Q),Oc=(new Condition$$module$nodes(b,"Speed boots")).option(fc,h),Pc=(new Condition$$module$nodes(b,"Climb slopes")).option(vb).option(z).option(Oc),Ke=(new Condition$$module$nodes(b,"Enter Mt Sabre North (rabbit)")).option(Ac).option(Fe),
Le=(new Condition$$module$nodes(b,"Enter Mt Sabre North (Teleport)")).option(sc).option(Ge,z),Qc=(new Condition$$module$nodes(b,"Asina in her room")).option(Fc),Me=(new Condition$$module$nodes(b,"Paralysis or Asina revealed")).option(Ja).option(Qc).option(ab),Rc=(new Condition$$module$nodes(b,"Ride dolphin")).option(yb,Ic),Ne=(new Condition$$module$nodes(b,"Ghetto flight")).option(n,Rc,vb),ba=(new Condition$$module$nodes(b,"Cross sea")).option(Rc).option(z),Oe=(new Condition$$module$nodes(b,"Cross whirlpool")).option(Db).option(z).option(Ne),
S=(new Condition$$module$nodes(b,"Refresh if needed")).option(Xb.value?Xb:f).option(Za),Sc=(new Condition$$module$nodes(b,"Wind magic")).option(E.value?E:f,S).option(Ra,Ia,S),Tc=(new Condition$$module$nodes(b,"Fire magic")).option(E.value?E:f,S).option(Sa,Ta,S),Uc=(new Condition$$module$nodes(b,"Water magic")).option(E.value?E:f,S).option(E,S).option(Ua,Va,S),Pe=(new Condition$$module$nodes(b,"Thunder magic")).option(E.value?E:f,S).option(E,S).option(Wa,S).option(Xa,S),Qe=(new Condition$$module$nodes(b,
"Flute of lime or glitch")).option(ub).option(ab),Re=(new Condition$$module$nodes(b,"Change or glitch")).option(pa).option(ab),Se=(new Condition$$module$nodes(b,"Change or glitch or paralysis")).option(pa).option(ab).option(Ja),Fb=(new Condition$$module$nodes(b,"Pass shooting statues")).option(tc).option(aa,Wb.value?Wb:f).option(Za,gc),Te=(new Condition$$module$nodes(b,"Healed dolphin if required")).option(Hc).option(Pd),Vc=(new Condition$$module$nodes(b,"Match sword of wind")).option(P).option(G.value?
G:f,aa),Wc=(new Condition$$module$nodes(b,"Match sword of fire")).option(Q).option(G.value?G:f,aa),Xc=(new Condition$$module$nodes(b,"Match sword of water")).option(L).option(G.value?G:f,aa),Ue=(new Condition$$module$nodes(b,"Match sword of thunder")).option(J).option(G.value?G:f,aa),Ve=(new Condition$$module$nodes(b,"Swamp run possible")).option(aa).option(Oc).option(Wd).option(Za),We=(new Condition$$module$nodes(b,"Insect possible to kill")).option(Ya),cb=(new Condition$$module$nodes(b,"Travel swamp")).option(Ya).option(Pa.value?
Pa:f,Ve),Xe=(new Condition$$module$nodes(b,"Calmed sea if required")).option(Db).option(Qd),Ye=(new Condition$$module$nodes(b,"Started windmill if required")).option(Ka).option(Sd),Ze=(new Condition$$module$nodes(b,"Telepathy if required for Deo")).option(fa).option(Ud),$e=e(0,"Vampire 1",aa).get(vb),af=e(1,"Insect",ec,Ie,We).get(Sa),bf=e(2,"Kelbesque 1",Vc,Sc).get(Ta),cf=e(12,"Vampire 2",Je).get(ke),Yc=e(4,"Sabera 1",Wc,Tc).get(lc),df=e(5,"Mado 1",Xc,Uc).get(Wa),ef=e(6,"Kelbesque 2",Vc,Sc).get(tb),
ff=e(7,"Sabera 2",Wc,Tc).get(sb),gf=e(8,"Mado 2",Xc,Uc).get(qb),hf=e(9,"Karmine",Ue,Pe).get(zb),jf=e(10,"Draygon 1",aa).get(ee),kf=e(null,"Statues",qc,pc),lf=e(11,"Draygon 2",aa,rc),mf=e(13,"Dyna",pb),nf=(new Condition$$module$nodes(b,"Opened prison if required")).option(xb).option(Rd),W=new Area$$module$nodes(b,"Leaf"),ya=new Area$$module$nodes(b,"Valley of Wind"),T=new Area$$module$nodes(b,"Sealed Cave"),qa=new Area$$module$nodes(b,"Cordel Plain"),za=new Area$$module$nodes(b,"Brynmaer"),Aa=new Area$$module$nodes(b,
"Amazones"),A=new Area$$module$nodes(b,"Mt Sabre West"),u=new Area$$module$nodes(b,"Mt Sabre North"),db=new Area$$module$nodes(b,"Nadare's"),La=new Area$$module$nodes(b,"Oak"),ha=new Area$$module$nodes(b,"Waterfall Valley"),y=new Area$$module$nodes(b,"Portoa"),ia=new Area$$module$nodes(b,"Waterfall Cave"),B=new Area$$module$nodes(b,"Fog Lamp Cave"),ja=new Area$$module$nodes(b,"Kirisa Plant Cave"),ra=new Area$$module$nodes(b,"Angry Sea"),ka=new Area$$module$nodes(b,"Joel"),H=new Area$$module$nodes(b,
"Evil Spirit Island"),la=new Area$$module$nodes(b,"Sabera's Castle"),X=new Area$$module$nodes(b,"Swan"),x=new Area$$module$nodes(b,"Mt Hydra"),ma=new Area$$module$nodes(b,"Shyron"),sa=new Area$$module$nodes(b,"Styx"),ta=new Area$$module$nodes(b,"Goa"),eb=new Area$$module$nodes(b,"Draygonia Fortress 1"),Y=new Area$$module$nodes(b,"Draygonia Fortress 2"),Ba=new Area$$module$nodes(b,"Draygonia Fortress 3"),O=new Area$$module$nodes(b,"Draygonia Fortress 4"),F=new Area$$module$nodes(b,"Oasis Cave");new Area$$module$nodes(b,
"Desert");const Z=new Area$$module$nodes(b,"Sahara"),Ca=new Area$$module$nodes(b,"Pyramid Front"),ca=new Area$$module$nodes(b,"Pyramid Back"),da=new Area$$module$nodes(b,"Tower"),Gb=(new Location$$module$nodes(b,0,W,"Start")).overworld().start(),of=(new Location$$module$nodes(b,0,W,"Mezame Shrine")).overworld().from(Gb),pf=(new Location$$module$nodes(b,1,W,"Outside Start")).overworld().connect(of),na=(new Location$$module$nodes(b,2,W,"Town")).town().connect(pf),Ma=(new Location$$module$nodes(b,3,
ya,"Main")).overworld().connect(na).trigger(wc,Ka),Zc=(new Location$$module$nodes(b,3,ya,"Outside Windmill")).overworld(),$c=(new Location$$module$nodes(b,4,T,"Tunnel 1 (entrance)")).cave().from(Ma,Ka),qf=(new Location$$module$nodes(b,5,T,"Tunnel 2 (over bridge)")).cave().connect($c),rf=(new Location$$module$nodes(b,6,T,"Tunnel 6 (herb dead end)")).cave().chest(D,15),ad=(new Location$$module$nodes(b,7,T,"Tunnel 4a (ball corridor)")).cave().chest(D,20,80).chest(Ra,21);(new Location$$module$nodes(b,
7,T,"Tunnel 4b (antidote dead end)")).cave().connect(ad,v).chest(K,19);const sf=(new Location$$module$nodes(b,8,T,"Tunnel 5 (warp boots dead end)")).cave().chest(R,14),tf=(new Location$$module$nodes(b,9,T,"Tunnel 3a (branch, front)")).cave().connect(qf).connectTo(ad).connectTo(sf),uf=(new Location$$module$nodes(b,9,T,"Tunnel 3b (branch, back)")).cave().connect(tf,v).connectTo(rf),vf=(new Location$$module$nodes(b,10,T,"Tunnel 7 (boss)")).cave().connect(uf).boss($e),wf=(new Location$$module$nodes(b,
12,T,"Tunnel 8a (exit, above wall)")).cave().connect(vf),xf=(new Location$$module$nodes(b,12,T,"Tunnel 8b (exit, below wall")).cave().connect(wf,v);(new Location$$module$nodes(b,14,ya,"Windmill Cave")).cave().connect(Ma).connectTo(Zc).trigger(le,wb,Ab);(new Location$$module$nodes(b,15,ya,"Windmill")).misc().connect(Zc).trigger(Ka,hc);const yf=(new Location$$module$nodes(b,16,ya,"Zebu's Cave Front")).cave().connect(Ma).trigger(Ab,uc,vc).trigger(wc,Ka,Ab),zf=(new Location$$module$nodes(b,16,ya,"Zebu's Cave Back")).cave().trigger(zc).connect(yf,
w),Af=(new Location$$module$nodes(b,17,A,"Tunnel 1 (to Zebu)")).cave().connect(zf),Da=(new Location$$module$nodes(b,20,qa,"West")).overworld().connect(xf,Ye),Bf=(new Location$$module$nodes(b,20,qa,"South")).overworld().connect(Da,t),bd=(new Location$$module$nodes(b,21,qa,"East")).overworld().connect(Da).chest(dc,24),Na=(new Location$$module$nodes(b,24,za,"Town")).town().connect(Da).trigger(me,dc),Cf=(new Location$$module$nodes(b,25,qa,"Outside Stom's House")).town().connect(Da),Hb=(new Location$$module$nodes(b,
26,qa,"Swamp")).overworld().connect(bd,cb).trigger(Bb,yc,cb);(new Location$$module$nodes(b,26,qa,"Swamp Insect Area")).overworld().connect(Hb,cb).boss(af);const fb=(new Location$$module$nodes(b,27,Aa,"Town")).town().connect(Bf),gb=(new Location$$module$nodes(b,28,La,"Town")).town().connect(Hb,cb).trigger(xc);(new Location$$module$nodes(b,30,qa,"Stom's House")).house().connect(Cf).trigger(ne,xc);const Ea=(new Location$$module$nodes(b,32,A,"Entrance")).overworld().connect(Da).connect(Af),Df=(new Location$$module$nodes(b,
32,A,"Up Slope")).overworld().from(Ea,Pc).to(Ea),Ef=(new Location$$module$nodes(b,32,A,"Dead End (warp boots)")).overworld().chest(R,24,106),cd=(new Location$$module$nodes(b,33,A,"Upper")).overworld().from(Ea,z).to(Ea),Ff=(new Location$$module$nodes(b,33,A,"Tornel Dead End")).overworld().trigger(qe,Ia).chest(V,23,105),dd=(new Location$$module$nodes(b,34,A,"Tunnel 2a (fork at start)")).cave().connect(Ea);(new Location$$module$nodes(b,34,A,"Tunnel 2b (left branch to dead end)")).cave().connect(dd,w).connectTo(Ef);
const Gf=(new Location$$module$nodes(b,34,A,"Tunnel 2c (right branch to upper)")).cave().connect(dd,w),Hf=(new Location$$module$nodes(b,35,A,"Tunnel 3a (tunnel to upper, with herb chest)")).cave().connect(Gf).chest(D,23,82),If=(new Location$$module$nodes(b,35,A,"Tunnel 3b (tunnel to upper, branch below ice)")).cave().connect(Hf,w).connectTo(cd),ed=(new Location$$module$nodes(b,36,A,"Tunnel 4a (branch to upper or Tornel)")).cave().connect(If);(new Location$$module$nodes(b,36,A,"Tunnel 4b (out to upper)")).cave().connect(ed,
w).connectTo(cd);const Jf=(new Location$$module$nodes(b,37,A,"Tunnel 5 (tiny connector)")).cave().connect(ed),Kf=(new Location$$module$nodes(b,38,A,"Tunnel 6a (exit to Tornel, above ice)")).cave().connect(Jf);(new Location$$module$nodes(b,38,A,"Tunnel 6b (exit to Tornel, below ice)")).cave().connect(Kf,w).connectTo(Ff);const Lf=(new Location$$module$nodes(b,39,A,"Tunnel 7a (tornado bracelet, lower)")).cave().connect(Df),Mf=(new Location$$module$nodes(b,39,A,"Tunnel 7b (tornado bracelet, middle)")).cave().connect(Lf,
w);(new Location$$module$nodes(b,39,A,"Tunnel 7c (tornado bracelet, upper)")).cave().connect(Mf,w).chest(Ia,25);const hb=(new Location$$module$nodes(b,40,u,"Entrance")).overworld().connect(bd,Le,Ke),ib=(new Location$$module$nodes(b,40,u,"Upper")).overworld().from(hb,z).to(hb),Ib=(new Location$$module$nodes(b,40,u,"Summit (boss)")).overworld().from(ib,z).to(ib).boss(bf),fd=(new Location$$module$nodes(b,41,u,"Connector")).overworld(),Jb=(new Location$$module$nodes(b,41,u,"Middle Left")).overworld(),
Nf=(new Location$$module$nodes(b,41,u,"Middle Right")).overworld().from(Jb,Pc).to(Jb),gd=(new Location$$module$nodes(b,42,u,"Tunnel 2a (from entrance to connector)")).cave().connectTo(fd);(new Location$$module$nodes(b,42,u,"Tunnel 2b (under bridge, to antidote)")).cave().connect(gd,w).chest(K,23,94);const hd=(new Location$$module$nodes(b,43,u,"Tunnel 3a (branch after connector)")).cave().connect(fd),Of=(new Location$$module$nodes(b,43,u,"Tunnel 3b (right branch)")).cave().connect(hd,w),Pf=(new Location$$module$nodes(b,
43,u,"Tunnel 3c (upper branch)")).cave().connect(hd,w);(new Location$$module$nodes(b,44,u,"Tunnel 4 (over bridge, to middle)")).cave().connect(Pf).connectTo(Jb);const id=(new Location$$module$nodes(b,45,u,"Tunnel 5a (E-shaped, from right branch)")).cave().connect(Of).connectTo(Nf);(new Location$$module$nodes(b,45,u,"Tunnel 5b (dead-end with herb)")).cave().connect(id,w).chest(D,22,83);const Qf=(new Location$$module$nodes(b,46,u,"Tunne; 6a (S-shaped hall, right)")).cave().connect(id),Rf=(new Location$$module$nodes(b,
46,u,"Tunne; 6b (S-shaped hall, middle)")).cave().connect(Qf,w),Sf=(new Location$$module$nodes(b,46,u,"Tunnel 6c (S-shaped hall, left)")).cave().connect(Rf,w),jd=(new Location$$module$nodes(b,47,u,"Prison (hallway)")).cave().connect(ib),Tf=(new Location$$module$nodes(b,48,u,"Left Cell (shopkeepers)")).cave().from(jd,w);(new Location$$module$nodes(b,49,u,"Left Cell 2 (back, with prison key)")).cave().from(Tf,w).chest(xb,13);const Uf=(new Location$$module$nodes(b,50,u,"Right Cell (villagers)")).cave().from(jd,
w),Vf=(new Location$$module$nodes(b,51,u,"Tunnel 8 (behind right cell, toward summit)")).cave().from(Uf,w);(new Location$$module$nodes(b,52,u,"Tunnel 9 (connector to summit)")).cave().connect(Vf).connectTo(Ib);const Wf=(new Location$$module$nodes(b,53,u,"Summit Cave (front)")).cave().from(Ib,xb).to(Ib),Xf=(new Location$$module$nodes(b,53,u,"Summit Cave (behind ice)")).cave().connect(Wf,w).trigger(re);(new Location$$module$nodes(b,56,u,"Tunnel 1 (leads from main entrance)")).cave().connect(hb).connectTo(gd);
(new Location$$module$nodes(b,57,u,"Tunnel 7 (to upper)")).cave().connect(Sf).connectTo(ib);const Yf=(new Location$$module$nodes(b,60,db,"Inn")).shop(),Zf=(new Location$$module$nodes(b,61,db,"Tool Shop")).shop(D,K,M,R),$f=(new Location$$module$nodes(b,62,db,"Back Room")).house(),Kb=(new Location$$module$nodes(b,64,ha,"Summit")).overworld().connect(Xf,nf),jb=(new Location$$module$nodes(b,64,ha,"Northwest")).overworld().from(Kb).to(Kb,z),ag=(new Location$$module$nodes(b,64,ha,"Northeast")).overworld().connect(jb,
t),kd=(new Location$$module$nodes(b,65,ha,"Southwest")).overworld().connect(jb),bg=(new Location$$module$nodes(b,65,ha,"Southeast")).overworld().connect(kd,t),ld=(new Location$$module$nodes(b,66,ha,"Lime Tree Valley")).overworld().connect(kd).connect(Ma,Vd),cg=(new Location$$module$nodes(b,67,ha,"Lime Tree Lake (Rage)")).cave().connect(ld).trigger(Ec,L),dg=(new Location$$module$nodes(b,68,ja,"Tunnel 1a (entrance)")).cave().connect(bg),eg=(new Location$$module$nodes(b,68,ja,"Tunnel 1b (behind wall)")).cave().connect(dg,
v),md=(new Location$$module$nodes(b,69,ja,"Tunnel 2a (main path, before wall)")).cave().connect(eg);(new Location$$module$nodes(b,69,ja,"Tunnel 2b (dead end, antidote)")).cave().connect(md,v).chest(K,25,95);const fg=(new Location$$module$nodes(b,69,ja,"Tunnel 2c (main path, after wall)")).cave().connect(md,v),gg=(new Location$$module$nodes(b,70,ja,"Tunnel 3a (last room, before wall)")).cave().connect(fg),hg=(new Location$$module$nodes(b,70,ja,"Tunnel 3b (last room, after wall)")).cave().connect(gg,
v);(new Location$$module$nodes(b,71,ja,"Meadow")).overworld().connect(hg).chest(oc,14);const ig=(new Location$$module$nodes(b,72,B,"Tunnel 1a (entrance)")).cave().connect(ag),nd=(new Location$$module$nodes(b,72,B,"Tunnel 1b (past wall)")).cave().connect(ig,v);(new Location$$module$nodes(b,72,B,"Tunnel 1c (dead end, lysisPlant)")).cave().connect(nd,v).chest(wa,24);const jg=(new Location$$module$nodes(b,73,B,"Tunnel 2 (tiny connector)")).cave().connect(nd),od=(new Location$$module$nodes(b,74,B,"Tunnel 3a (upper branch)")).cave().connect(jg);
(new Location$$module$nodes(b,74,B,"Tunnel 3b (dead end, mimic)")).cave().connect(od,v).chest(N,21,112);const pd=(new Location$$module$nodes(b,74,B,"Tunnel 3c (short passage with mimic)")).cave().connect(od,v).chest(N,22,113),kg=(new Location$$module$nodes(b,74,B,"Tunnel 3d (lower branch)")).cave().connect(pd,v);(new Location$$module$nodes(b,75,B,"Dead end loop")).cave().connect(kg);const qd=(new Location$$module$nodes(b,76,B,"Tunnel 4a (right branch over bridge)")).cave().connect(pd),lg=(new Location$$module$nodes(b,
76,B,"Tunnel 4b (past wall over bridge)")).cave().connect(qd,v),mg=(new Location$$module$nodes(b,77,B,"Tunnel 5a (from left branch)")).cave().connect(qd),ng=(new Location$$module$nodes(b,77,B,"Tunnel 5b (reconvergence)")).cave().connect(mg,v).connect(lg),og=(new Location$$module$nodes(b,77,B,"Tunnel 5c (between walls)")).cave().connect(ng,v),pg=(new Location$$module$nodes(b,77,B,"Tunnel 5d (under bridge)")).cave().connect(og,v),qg=(new Location$$module$nodes(b,78,B,"Tunnel 6a (over second bridge)")).cave().connect(pg),
rg=(new Location$$module$nodes(b,78,B,"Tunnel 6b (past wall)")).cave().connect(qg,v),sg=(new Location$$module$nodes(b,79,B,"Tunnel 7a (under second bridge)")).cave().connect(rg);(new Location$$module$nodes(b,79,B,"Tunnel 7b (fog lamp)")).cave().connect(sg,v).chest(jc,19);const ua=(new Location$$module$nodes(b,80,y,"Town")).town().connect(jb),rd=(new Location$$module$nodes(b,81,y,"Fishherman Island")).town().connect(ua);(new Location$$module$nodes(b,82,ha,"Mesia Shrine")).cave().trigger(Fc).connect(cg,
t,Ec);const sd=(new Location$$module$nodes(b,84,ia,"Tunnel 1a (entrance)")).cave().connect(jb);(new Location$$module$nodes(b,84,ia,"Tunnel 1b (dead end, mimic)")).cave().connect(sd,w).chest(N,19,114);const tg=(new Location$$module$nodes(b,84,ia,"Tunnel 1c (past ice)")).cave().connect(sd,w),ug=(new Location$$module$nodes(b,85,ia,"Tunnel 2 (stoned pair)")).cave().connect(tg),Lb=(new Location$$module$nodes(b,86,ia,"Tunnel 3 (wide medusa hallways)")).cave().connect(ug,Qe),vg=(new Location$$module$nodes(b,
87,ia,"Tunnel 4a (left entrance)")).cave().from(Lb,w).chest($b.chest().bonus(),25).trigger(te,ub);(new Location$$module$nodes(b,87,ia,"Tunnel 4b (right entrance)")).cave().from(Lb,w).connect(vg,z);(new Location$$module$nodes(b,87,ia,"Tunnel 4c (sword of water)")).cave().connect(Lb,w).chest(L,24);const td=(new Location$$module$nodes(b,88,da,"Entrance")).misc(),wg=(new Location$$module$nodes(b,89,da,"Level 1")).misc().from(td),xg=(new Location$$module$nodes(b,90,da,"Level 2")).misc().from(wg),yg=(new Location$$module$nodes(b,
91,da,"Level 3")).misc().from(xg),ud=(new Location$$module$nodes(b,92,da,"Outside Mesia Room")).misc().from(yg),zg=(new Location$$module$nodes(b,93,da,"Outside Dyna Room")).misc().from(ud,pb);(new Location$$module$nodes(b,94,da,"Mesia")).misc().connect(ud).trigger(Ee);const Ag=(new Location$$module$nodes(b,95,da,"Dyna")).misc().from(zg).boss(mf);(new Location$$module$nodes(b,95,da,"Win")).misc().from(Ag).end();const Mb=(new Location$$module$nodes(b,96,ra,"Cabin Beach")).sea().from(rd,Cb),Fa=(new Location$$module$nodes(b,
96,ra,"South")).sea().connect(Mb,ba),Bg=(new Location$$module$nodes(b,96,ra,"Joel Beach")).sea().connect(Fa,ba),vd=(new Location$$module$nodes(b,96,ka,"Outside Lighthouse")).sea();(new Location$$module$nodes(b,96,ra,"Altar")).sea().connect(Fa,ba).trigger(Db,mc,lc);const Cg=(new Location$$module$nodes(b,96,ra,"North")).sea().to(Fa,ba).from(Fa,ba,Oe).trigger(we,Xe),Dg=(new Location$$module$nodes(b,96,ra,"Swan Beach")).sea().connect(Cg,ba);(new Location$$module$nodes(b,97,ra,"Cabin")).misc().connect(Mb).trigger(Ic,
Cb);(new Location$$module$nodes(b,98,ka,"Lighthouse")).misc().connect(vd).trigger(ve,wb);const kb=(new Location$$module$nodes(b,100,y,"Underground Channel 1 (from throne room)")).sea().trigger(Dc),Eg=(new Location$$module$nodes(b,100,y,"Underground Channel 2 (to fortune teller)")).sea().connect(kb,t),wd=(new Location$$module$nodes(b,100,y,"Underground Channel 3 (from fortune teller)")).sea().connect(kb,z),xd=(new Location$$module$nodes(b,100,y,"Underground Channel 4 (asina)")).sea().connect(wd,t),
Fg=(new Location$$module$nodes(b,100,y,"Underground Channel 5 (dolphin)")).sea().connect(xd,t).trigger(Hc,D,Gc);(new Location$$module$nodes(b,100,y,"Underground Channel 6 (water)")).sea().connect(Fg,ba).connectTo(Fa,ba).chest(nc,17);const Nb=(new Location$$module$nodes(b,101,H,"Zombie Town")).town(),Gg=(new Location$$module$nodes(b,104,H,"Tunnel 1 (entrance)")).sea().connect(Fa,Jc,ba),yd=(new Location$$module$nodes(b,105,H,"Tunnel 2a (start)")).cave().connect(Gg);(new Location$$module$nodes(b,105,
H,"Tunnel 2b (dead end to left)")).cave().connect(yd,t);const Hg=(new Location$$module$nodes(b,105,H,"Tunnel 2c (across first river)")).cave().connect(yd,t),zd=(new Location$$module$nodes(b,105,H,"Tunnel 2d (across second river)")).cave().connect(Hg,t);(new Location$$module$nodes(b,105,H,"Tunnel 2e (dead end, magic ring)")).cave().connect(zd,v).chest(V,29);const Ig=(new Location$$module$nodes(b,105,H,"Tunnel 2f (stair down)")).cave().connect(zd,v),Jg=(new Location$$module$nodes(b,106,H,"Tunnel 3a (main area)")).cave().connect(Ig).connectTo(Nb).chest(wa,
25,92),Kg=(new Location$$module$nodes(b,106,H,"Tunnel 3b (left area toward items)")).cave().connect(Jg,v),Lg=(new Location$$module$nodes(b,107,H,"Tunnel 4a (right side, mimic)")).cave().connect(Kg).chest(N,14,115);(new Location$$module$nodes(b,107,H,"Tunnel 4b (left side, iron necklace)")).cave().connect(Lg,t).chest(he,15);const Ob=(new Location$$module$nodes(b,108,la,"Floor 1")).fortress().connect(Nb),Mg=(new Location$$module$nodes(b,108,la,"Miniboss")).fortress().boss(cf).connect(Ob);(new Location$$module$nodes(b,
109,la,"Floor 2a (left stair)")).fortress().connect(Ob).chest(M,19);const Ng=(new Location$$module$nodes(b,109,la,"Floor 2b (right stair)")).fortress().connect(Mg).chest(D,30,85),Og=(new Location$$module$nodes(b,110,la,"Floor 3a (toward boss)")).fortress().connect(Ng),Ad=(new Location$$module$nodes(b,110,la,"Floor 3b (boss room)")).fortress().connect(Og);(new Location$$module$nodes(b,110,la,"Boss")).fortress().boss(Yc).connect(Ad);(new Location$$module$nodes(b,110,la,"Floor 3c (back room trap)")).fortress().from(Ad).to(Ob);
const Pg=(new Location$$module$nodes(b,112,ka,"Secret Passage")).cave().connectTo(vd),lb=(new Location$$module$nodes(b,113,ka,"Town")).town().connect(Bg),ea=(new Location$$module$nodes(b,114,X,"Town")).town().connect(Dg),Qg=(new Location$$module$nodes(b,115,X,"Inside Gate")).overworld().connect(ea),Rg=(new Location$$module$nodes(b,115,X,"Outside Gate")).overworld().from(Qg,pa),mb=(new Location$$module$nodes(b,120,ta,"Valley")).overworld().connect(Rg),Pb=(new Location$$module$nodes(b,124,x,"Entrance")).overworld().connect(mb),
Sg=(new Location$$module$nodes(b,124,x,"Over first river toward Shyron")).overworld().connect(Pb,t),Bd=(new Location$$module$nodes(b,124,x,"After first tunnel")).overworld(),Cd=(new Location$$module$nodes(b,124,x,"Door to Styx")).overworld().connect(Bd,t),Tg=(new Location$$module$nodes(b,124,x,"Dead end (no item)")).overworld(),Ug=(new Location$$module$nodes(b,124,x,"Dead end (fruit of lime)")).overworld().chest(rb,26),Vg=(new Location$$module$nodes(b,124,x,"Dead end (magic ring)")).overworld().chest(V,
25,101),Dd=(new Location$$module$nodes(b,124,x,"Outside tunnel to bow")).overworld();(new Location$$module$nodes(b,124,x,"Floating island (bow of sun)")).overworld().connect(Dd,z).chest(qc,24);const Wg=(new Location$$module$nodes(b,125,x,"Tunnel 1 (to Shyron)")).cave().connect(Sg),Xg=(new Location$$module$nodes(b,126,x,"Outside Shyron")).overworld().connect(Wg);(new Location$$module$nodes(b,127,x,"Tunnel 2 (fork)")).cave().connect(Pb).connectTo(Ug).connectTo(Bd);const Ed=(new Location$$module$nodes(b,
128,x,"Tunnel 3 (caves)")).cave().connect(Cd).connect(Tg),Fd=(new Location$$module$nodes(b,129,x,"Tunnel 4 (left branch of cave)")).cave().connect(Ed);(new Location$$module$nodes(b,130,x,"Tunnel 5 (dead end, medical herb)")).cave().connect(Fd).chest(D,15,86);const Yg=(new Location$$module$nodes(b,131,x,"Tunnel 6a (left-then-right)")).cave().connect(Fd),Zg=(new Location$$module$nodes(b,131,x,"Tunnel 6b (past wall)")).cave().connect(Yg,v),$g=(new Location$$module$nodes(b,132,x,"Tunnel 7 (wide hall)")).cave().connect(Zg);
(new Location$$module$nodes(b,133,x,"Tunnel 8 (red slimes)")).cave().from($g,v).connectTo(Dd).chest(N,23,116);const ah=(new Location$$module$nodes(b,134,x,"Tunnel 9 (right branch, infinite loop)")).cave().connect(Ed),bh=(new Location$$module$nodes(b,135,x,"Tunnel 10a (toward magic ring)")).cave().connect(ah);(new Location$$module$nodes(b,135,x,"Tunnel 10b (past wall)")).cave().connect(bh,v).connectTo(Vg);const Gd=(new Location$$module$nodes(b,136,sa,"Entrance")).fortress().from(Cd,ic,Fb),ch=(new Location$$module$nodes(b,
137,sa,"Left branch")).fortress().connect(Gd).chest(N,19,117),dh=(new Location$$module$nodes(b,137,sa,"Left branch, past one bridge")).fortress().connect(ch,t),eh=(new Location$$module$nodes(b,137,sa,"Left branch, past two bridges")).fortress().connect(dh,t).chest(D,29,87),fh=(new Location$$module$nodes(b,137,sa,"Right branch")).fortress().connect(Gd);(new Location$$module$nodes(b,137,sa,"Right branch, across water")).fortress().connect(fh,z).chest(N,20,118).chest(N,21,119).chest(Zd,28);(new Location$$module$nodes(b,
138,sa,"Upper floor")).fortress().connect(eh).chest(J,27);const Ga=(new Location$$module$nodes(b,140,ma,"Town")).town().connect(Xg,Re).trigger(Eb),Oa=(new Location$$module$nodes(b,142,ta,"Town")).town().connect(mb),Hd=(new Location$$module$nodes(b,143,F,"Draygonia Fortress Basement 1 (front)")).fortress();(new Location$$module$nodes(b,143,F,"Draygonia Fortress Basement 2 (power ring)")).fortress().connect(Hd,xa).chest(fe,15);const Qb=(new Location$$module$nodes(b,144,ta,"Desert 1")).overworld().connect(mb),
nb=(new Location$$module$nodes(b,145,F,"Area 1 (from entrance)")).cave().chest(fc,26),Id=(new Location$$module$nodes(b,145,F,"Area 2 (across top bridge)")).cave().connect(nb,t);(new Location$$module$nodes(b,145,F,"Area 3 (dead-end across top-right bridge)")).cave().connect(Id,t);const gh=(new Location$$module$nodes(b,145,F,"Area 4 (left across middle-right bridge)")).cave().connect(Id,t),hh=(new Location$$module$nodes(b,145,F,"Area 5 (bottom edge)")).cave().connect(gh,t),ih=(new Location$$module$nodes(b,
145,F,"Area 6 (bottom island)")).cave().connect(hh,t),jh=(new Location$$module$nodes(b,145,F,"Area 7 (bottom inner ring)")).cave().connect(ih,t),kh=(new Location$$module$nodes(b,145,F,"Area 8 (left outer ring)")).cave().connect(jh,t).connect(nb,t).chest(M,27,100),lh=(new Location$$module$nodes(b,145,F,"Area 9 (top left inner ring)")).cave().connect(kh,t),mh=(new Location$$module$nodes(b,145,F,"Area 10 (top right inner ring)")).cave().connect(lh,t);(new Location$$module$nodes(b,145,F,"Area 11 (center)")).cave().connect(mh,
t).connectTo(Hd);(new Location$$module$nodes(b,145,F,"Area 12 (top center islands)")).cave().connect(nb,z).chest(de,28);const nh=(new Location$$module$nodes(b,146,Z,"Desert Cave 1")).cave().connect(Qb,z),Ha=(new Location$$module$nodes(b,147,Z,"Town")).town(),oh=(new Location$$module$nodes(b,148,Z,"Outside Cave")).overworld().connect(Ha),ph=(new Location$$module$nodes(b,149,Z,"Desert Cave 2")).cave().connect(oh);(new Location$$module$nodes(b,150,Z,"Meadow")).overworld().connect(nh).connectTo(Ha).trigger(Be,
pa,Ze);const Rb=(new Location$$module$nodes(b,152,Z,"Desert 2")).overworld().connect(ph),qh=(new Location$$module$nodes(b,156,Ca,"Entrance")).fortress().connect(Rb,z),rh=(new Location$$module$nodes(b,156,Ca,"Azteca")).fortress().trigger(De),sh=(new Location$$module$nodes(b,157,Ca,"Fork")).fortress().connect(qh),Jd=(new Location$$module$nodes(b,158,Ca,"Main")).fortress().connect(sh);(new Location$$module$nodes(b,158,Ca,"Treasure Chest (magic ring)")).fortress().connect(Jd).chest(V,27,108);(new Location$$module$nodes(b,
159,Ca,"Draygon")).fortress().connect(Jd).to(rh).boss(jf);const th=(new Location$$module$nodes(b,160,ca,"Entrance")).fortress().connect(Rb,z),uh=(new Location$$module$nodes(b,160,ca,"Statues")).fortress().connect(th).boss(kf),vh=(new Location$$module$nodes(b,161,ca,"Hall 1")).fortress().connect(uh),Sb=(new Location$$module$nodes(b,162,ca,"Branch")).fortress().connect(vh);(new Location$$module$nodes(b,163,ca,"Left Dead End")).fortress().connect(Sb).chest(N,13,120);(new Location$$module$nodes(b,164,
ca,"Right Dead End")).fortress().connect(Sb);const wh=(new Location$$module$nodes(b,165,ca,"Hall 2")).fortress().connect(Sb).chest(tb,26,109),xh=(new Location$$module$nodes(b,166,ca,"Draygon 2")).fortress().connect(wh).boss(lf);(new Location$$module$nodes(b,167,ca,"Teleporter")).fortress().from(xh).to(td);const Kd=(new Location$$module$nodes(b,168,eb,"Entrance")).fortress().connect(Oa,Fb).trigger(Nc,J),yh=(new Location$$module$nodes(b,169,eb,"Main")).fortress().from(Kd,xa),zh=(new Location$$module$nodes(b,
169,eb,"Boss")).fortress().connect(yh).boss(ef),Ah=(new Location$$module$nodes(b,170,eb,"Zebu")).fortress().connect(zh),ob=(new Location$$module$nodes(b,171,Y,"Entrance")).fortress().connect(Ah);(new Location$$module$nodes(b,171,Y,"Dead End Behind Iron (fruit of power)")).fortress().connect(ob,xa).chest(M,28,98);(new Location$$module$nodes(b,171,Y,"Dead End Loop Across Closer Bridges")).fortress().connect(ob,t).connect(ob,t);const Bh=(new Location$$module$nodes(b,171,Y,"Across First Bridge (fruit of repun)")).fortress().connect(ob,
t).chest(sb,30,102),Tb=(new Location$$module$nodes(b,171,Y,"Across Second Bridge")).fortress().connect(Bh,t);(new Location$$module$nodes(b,171,Y,"Dead End Across Two Bridges ()")).fortress().connect(Tb,t).connect(Tb,t).chest(wa,29,93);const Ch=(new Location$$module$nodes(b,171,Y,"Across Third Bridge")).fortress().connect(Tb,t),Dh=(new Location$$module$nodes(b,171,Y,"Exit Behind Iron Door")).fortress().connect(Ch,xa),Eh=(new Location$$module$nodes(b,172,Y,"Boss")).fortress().connect(Dh).boss(ff),Fh=
(new Location$$module$nodes(b,172,Y,"Tornel")).fortress().connect(Eh),Ld=(new Location$$module$nodes(b,173,Ba,"Lower")).fortress().connect(Fh).chest(tb,26,99).chest(V,27,111),Gh=(new Location$$module$nodes(b,174,Ba,"Upper Loop")).fortress().connect(Ld).chest(K,22,96);(new Location$$module$nodes(b,174,Ba,"Upper Loop Behind Wall (magic ring)")).fortress().connect(Gh,xa).chest(V,23,107);const Hh=(new Location$$module$nodes(b,175,Ba,"Upper Passage (toward Mado)")).fortress().connect(Ld).chest(V,27,84),
Ub=(new Location$$module$nodes(b,176,O,"Initial Fork")).fortress(),Ih=(new Location$$module$nodes(b,177,O,"Left Branch")).fortress().connect(Ub),Md=(new Location$$module$nodes(b,178,O,"Main Area (right branch, over bridges)")).fortress().connect(Ub),Jh=(new Location$$module$nodes(b,179,O,"U-shaped Passage (between floors)")).fortress().connect(Md),Kh=(new Location$$module$nodes(b,180,O,"Main Area Lower (under bridge)")).fortress().connect(Ih).connect(Md).connect(Jh),Nd=(new Location$$module$nodes(b,
180,O,"Behind Iron Wall")).fortress().connect(Kh,xa),Lh=(new Location$$module$nodes(b,181,O,"Lower")).fortress().connect(Nd).chest(N,13,121).chest(N,14,122).chest(N,15,123).chest(V,23,88).chest(R,24,110),Mh=(new Location$$module$nodes(b,182,O,"Boss Corridor")).fortress().connect(Lh),Nh=(new Location$$module$nodes(b,182,O,"Boss")).fortress().connect(Mh,Fb).boss(hf);(new Location$$module$nodes(b,182,O,"Behind Boss (stormBracelet)")).fortress().connect(Nh).chest(Xa,18);const Od=(new Location$$module$nodes(b,
183,O,"Exit Stairs")).fortress(),Oh=(new Location$$module$nodes(b,184,F,"Entrance Back (behind river)")).cave().connect(Od).chest(M,13,90);(new Location$$module$nodes(b,184,F,"Entrance Front")).cave().connect(Oh,z).connectTo(Qb).connectTo(nb);const Ph=(new Location$$module$nodes(b,185,Ba,"Boss")).fortress().connect(Hh).boss(gf);(new Location$$module$nodes(b,185,Ba,"Asina")).fortress().connect(Ph).connectTo(Ub);(new Location$$module$nodes(b,186,O,"Kensu")).fortress().connect(Nd).connectTo(Od).trigger(Ae,
zb);(new Location$$module$nodes(b,187,ta,"House")).house().connect(Oa).trigger(Ce,pa,zb);(new Location$$module$nodes(b,188,ta,"Inn")).shop().connect(Oa,Eb);(new Location$$module$nodes(b,190,ta,"Tool Shop")).shop(D,K,R,M).connect(Oa,Eb);(new Location$$module$nodes(b,191,ta,"Tavern")).shop().connect(Oa);(new Location$$module$nodes(b,192,W,"Elder House")).house().connect(na).trigger(uc);(new Location$$module$nodes(b,193,W,"Rabbit Hut")).house().connect(na).trigger(Ac,zc,fa);(new Location$$module$nodes(b,
194,W,"Inn")).shop().connect(na);(new Location$$module$nodes(b,195,W,"Tool Shop")).shop(D,K,R,M).connect(na);(new Location$$module$nodes(b,196,W,"Armor Shop")).shop($d,Yb).connect(na);(new Location$$module$nodes(b,197,W,"Student House")).house().connect(na).trigger(vc);(new Location$$module$nodes(b,198,za,"Tavern")).house().connect(Na);(new Location$$module$nodes(b,199,za,"Pawn Shop")).shop().connect(Na);(new Location$$module$nodes(b,200,za,"Inn")).shop().connect(Na);(new Location$$module$nodes(b,
201,za,"Armor Shop")).shop(ae,Yb,Xd).connect(Na);(new Location$$module$nodes(b,203,za,"Tool Shop")).shop(D,K,R).connect(Na);(new Location$$module$nodes(b,205,La,"Elder House")).house().from(gb,fa).trigger(pe,Bb);(new Location$$module$nodes(b,206,La,"Mother's House")).house().from(gb,fa).trigger(yc,fa).trigger(oe,Bb);(new Location$$module$nodes(b,207,La,"Tool Shop")).shop(D,K,M).from(gb,fa);(new Location$$module$nodes(b,208,La,"Inn")).shop().from(gb,fa);(new Location$$module$nodes(b,209,Aa,"Inn")).shop().connect(fb);
(new Location$$module$nodes(b,210,Aa,"Tool Shop")).shop(R,M,wa).connect(fb);(new Location$$module$nodes(b,211,Aa,"Armor Shop")).shop(bc,Zb,$b,qb).connect(fb);const Qh=(new Location$$module$nodes(b,212,Aa,"Queen's House")).house().from(fb,Se).trigger(ye,pa,oc);(new Location$$module$nodes(b,213,db,"Nadare's")).house().connect(hb).connectTo(Yf).connectTo(Zf).connectTo($f);(new Location$$module$nodes(b,214,y,"Fisherman's House")).house().connect(rd).trigger(Cb,jc,yb,Te);const Vb=(new Location$$module$nodes(b,
215,y,"Palace Entrance")).house().connect(ua);(new Location$$module$nodes(b,216,y,"Fortune Teller Front")).house().connect(ua).trigger(Cc,Bc);(new Location$$module$nodes(b,216,y,"Fortune Teller Back")).house().connect(Eg).connect(wd);(new Location$$module$nodes(b,217,y,"Pawn Shop")).shop().connect(ua);(new Location$$module$nodes(b,218,y,"Armor Shop")).shop(be,bc,Zb).connect(ua);(new Location$$module$nodes(b,220,y,"Inn")).shop().connect(ua);(new Location$$module$nodes(b,221,y,"Tool Shop")).shop(D,
wa,rb,R).connect(ua);(new Location$$module$nodes(b,222,y,"Palace Left")).house().connect(Vb);(new Location$$module$nodes(b,223,y,"Palace Throne Room")).house().connect(Vb).to(kb,Me).from(kb).trigger(Bc).trigger(se,Cc,Dc);(new Location$$module$nodes(b,224,y,"Palace Right")).house().connect(Vb);(new Location$$module$nodes(b,225,y,"Asina's Room")).house().connect(xd).trigger(Gc,Qc);(new Location$$module$nodes(b,226,Aa,"Queen Downstairs")).house().connect(Qh).chest(Va,13);(new Location$$module$nodes(b,
227,ka,"Elder's House")).house().connect(lb).trigger(Jc);(new Location$$module$nodes(b,228,ka,"Shed")).house().connect(lb).to(Pg,kc);(new Location$$module$nodes(b,229,ka,"Tool Shop")).shop(D,K,M,wa).connect(lb);(new Location$$module$nodes(b,231,ka,"Inn")).shop().connect(lb);const Rh=(new Location$$module$nodes(b,232,H,"Zombie Town House")).house().connect(Nb);(new Location$$module$nodes(b,233,H,"Zombie Town Basement")).house().connect(Rh).trigger(ue,Yc);(new Location$$module$nodes(b,235,X,"Tool Shop")).shop(D,
K,M,R).connect(ea);(new Location$$module$nodes(b,236,X,"Stom's Hut")).house().connect(ea).trigger(Kc);(new Location$$module$nodes(b,237,X,"Inn")).shop().connect(ea);(new Location$$module$nodes(b,238,X,"Armor Shop")).shop(ce,cc,Yd,ac).connect(ea);(new Location$$module$nodes(b,239,X,"Tavern")).house().connect(ea).trigger(Lc,Kc,Ja);(new Location$$module$nodes(b,240,X,"Pawn Shop")).shop().connect(ea);(new Location$$module$nodes(b,241,X,"Dance Hall")).house().connect(ea).trigger(Mc,Lc,Ja).trigger(xe,Mc,
nc);const Sh=(new Location$$module$nodes(b,242,ma,"Temple (pre-massacre)")).fortress().connect(Ga).from(Gb,J,Td).trigger(ze);(new Location$$module$nodes(b,242,ma,"Temple (post-massacre)")).fortress().from(Sh,Nc).boss(df);(new Location$$module$nodes(b,243,ma,"Training Hall")).house().connect(Ga);(new Location$$module$nodes(b,244,ma,"Hospital")).house().connect(Ga);(new Location$$module$nodes(b,245,ma,"Armor Shop")).shop(cc,qb,ac).connect(Ga);(new Location$$module$nodes(b,246,ma,"Tool Shop")).shop(D,
K,rb,V).connect(Ga);(new Location$$module$nodes(b,247,ma,"Inn")).shop().connect(Ga);(new Location$$module$nodes(b,248,Z,"Inn")).shop().connect(Ha);(new Location$$module$nodes(b,249,Z,"Tool Shop")).shop(K,R,sb,V).connect(Ha);(new Location$$module$nodes(b,250,Z,"Elder's House")).house().connect(Ha);(new Location$$module$nodes(b,251,Z,"Pawn Shop")).house().connect(Ha);const Th=[na,Ma,$c,Da,Hb,Ea,Kb,ld,Mb,ea,mb,Pb,Qb,Kd,Rb];for(const a of Th)a.from(Gb,He);return b},shuffle$$module$depgraph=(a,b,c,d,e)=>
$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const g=generate$$module$depgraph(d);d.shuffleShops()&&g.shuffleShops(b);const f=g.nodes.filter((a)=>a instanceof Slot$$module$nodes&&a.slots&&a.slotName);d||(d=new FlagSet$$module$flagset("Sbkm Sct"));var k={};for(var h of f)if(h instanceof Slot$$module$nodes&&h.slots){var n=h.slotType[0];(k[n]=k[n]||[]).push(h)}h=[];n=[];var m={};for(var q of d.flags.S||[]){var p=[];for(var l of q){m[l]=!0;for(var r of k[l])p.push(r),n.push([r,h.length])}h.push(p)}for(var I of"bc")if(m[I])for(q=
k[I],l=q.map((a)=>[a.item,a.itemIndex]),b.shuffle(l),r=0;r<q.length;r++)q[r].set(...l[r]);p=(a)=>f.find((b)=>b.vanillaItemName===a);k=p("Sword of Wind");I=p("Sword of Fire");q=p("Ball of Wind");l=p("Ball of Fire");r=p("Statue of Onyx");p=p("Gas Mask");m.k&&b.nextInt(2)&&(I.swap(k),l.swap(q));m.k&&!b.nextInt(3)&&r.swap(p);m=[1,1,1,1,2,2,2,3,3,3,5,5,8,13];k=[];e&&e.addTasks(10);for(I=0;1E3>I;I++){e&&0==I%100&&(yield new Promise(requestAnimationFrame),e.addCompleted(1));b.shuffle(n);for(var C of h)b.shuffle(C);
q=h.map(()=>-1);l=m[b.nextInt(m.length)];r=[];p=(a,b)=>a.itemIndex===b.itemIndex||a.isMimic()&&!b.canHoldMimic()||b.isMimic()&&!a.canHoldMimic()||a.needsChest()&&!b.isChest()||b.needsChest()&&!a.isChest()?!1:!0;for(let a=0;a<l;a++){const [b,c]=n[a],d=h[c][++q[c]];p(b,d)&&(b.swap(d),r.push([b,d]))}if(!r.length)continue;const {win:a,path:c}=g.traverse({wanted:f,dfs:!1});if(a)k=c;else for(;r.length;){const [a,b]=r.pop();a.swap(b)}}a&&g.write(a);if(c){c.items=[];c.route=[];for(const a of k){const [b,
d]=a;c.route.push(d);C=g.nodes[b];null!=C.slotName&&(h=C.slotName,0>h.indexOf(C.orig)&&(h+=` (normally ${C.vanillaItemName})`),c.items.push({slotIndex:C.slotIndex,itemIndex:C.itemIndex,origName:C.vanillaItemName,slotName:C.slotName,itemName:C.item.name,text:`${C.item.name}: ${h}`}))}}}),shuffle2$$module$depgraph=(a,b,c,d,e)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const g=generate$$module$depgraph(d);d.shuffleShops()&&g.shuffleShops(b);const f=g.integrate();e&&e.addTasks(1E3);for(let k=
0;1E3>k;k++){if(yield shuffle3$$module$depgraph(g,f,a,b,c,d,e)){console.log(`success after ${k} attempts`);return}e&&(e.addCompleted(1),0===k%50&&(yield new Promise(requestAnimationFrame)))}return shuffle$$module$depgraph(a,b,c,d,e)}),shuffle3$$module$depgraph=(a,b,c,d,e,g,f)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const f=e&&e.stats;var h=a.nodes.filter((a)=>a instanceof Slot$$module$nodes&&a.slots&&a.slotName);const n=new Map(d.shuffle(h.map((a)=>[a,[a.item,a.itemIndex]]))),m=
new Set(d.shuffle(h)),q=new Map,p={};f&&f.seeds++;g||(g=new FlagSet$$module$flagset("Sbkm Sct"));(g.flags.S||[]).forEach((a,b)=>{for(const c of a)p[c]=b});for(var l of m)q.set(l.item,l);let r=new Set;const I=(a,b)=>{if(null==p[a.slotType?a.slotType[0]:"c"])return a==b;if(b.isMimic()&&!a.canHoldMimic()||"unique"!=b.item.inventoryRow&&a.requiresUnique||"armor"==b.item.inventoryRow&&!a.isChest())return!1;if(g.guaranteeSword()){if(0===a.slotIndex)return 4>b.item.id;if(4>b.item.id&&(r.add(b),4===r.size))return 0===
a.slotIndex}return p[a.slotType?a.slotType[0]:"c"]==p[b.slotType?b.slotType[0]:"c"]};l=b.assumedFill(d,(a,b)=>I(a,q.get(b)));if(null==l){f&&f.endState.key++;return!1;throw Error("Could not fill!");}const C=new Map;for(var U=0;U<l.length;U++){var va=l[U];if(null!=va){var oa=q.get(b.item(va));va=n.get(oa);n.delete(oa);oa=b.location(U);C.set(oa,va);m.delete(oa)}}U=(a,b,c)=>{c=void 0===c?"":c;for(const c of m)if(I(c,a))return C.set(c,b),m.delete(c),n.delete(a),!0;f&&("traps"==c?f.endState.traps++:"chest"==
c?f.endState.chest++:f.endState.misc++);return!1};for(var E of n){const [a,b]=E;if(a.isMimic()&&!U(a,b,"traps"))return!1}for(const a of n){const [b,c]=a;if(b.needsChest()&&!U(b,c,"chest"))return!1}for(const a of n){const [b,c]=a;if(!U(b,c))return!1}for(const a of C){const [b,c]=a;b.set(...c)}const {win:G,path:Pa}=a.traverse({wanted:h,dfs:!1});if(!G)return f&&f.endState.no_win++,!1;c&&a.write(c);if(!e)return!0;f&&(f.endState.success++,f.analyze(a,b,l));e.items=[];e.route=[];for(const b of Pa){const [c,
d]=b;e.route.push(d);h=a.nodes[c];null!=h.slotName&&(E=h.slotName,0>E.indexOf(h.orig)&&(E+=` (normally ${h.vanillaItemName})`),e.items.push({slotIndex:h.slotIndex,itemIndex:h.itemIndex,origName:h.vanillaItemName,slotName:h.slotName,itemName:h.item.name,text:`${h.item.name}: ${E}`}))}return!0});var module$depgraph={};module$depgraph.generate=generate$$module$depgraph;module$depgraph.shuffle=shuffle$$module$depgraph;module$depgraph.shuffle2=shuffle2$$module$depgraph;module$depgraph.shuffle3=shuffle3$$module$depgraph;class FetchReader$$module$fetchreader{constructor(a){this.path=void 0===a?"js/":a}read(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){return yield(yield fetch(b.path+a)).text()})}}var module$fetchreader={};module$fetchreader.FetchReader=FetchReader$$module$fetchreader;class Deque$$module$util{constructor(){this.buffer=Array(16);this.mask=15;this.size=this.end=this.start=0}get length(){return this.size}upsize(a){for(;this.mask<a;)this.end<=this.start&&(this.start+=this.mask+1),this.mask=this.mask<<1|1,this.buffer=this.buffer.concat(this.buffer);this.size=a}push(...a){this.upsize(this.size+a.length);for(const b of a)this.buffer[this.end]=b,this.end=this.end+1&this.mask}pop(){if(this.size)return this.end=this.end-1&this.mask,this.size--,this.buffer[this.end]}peek(){if(this.size)return this.buffer[this.end-
1&this.mask]}unshift(...a){this.upsize(this.size+a.length);for(const b of a)this.start=this.start-1&this.mask,this.buffer[this.start]=b}shift(){if(this.size){var a=this.buffer[this.start];this.start=this.start+1&this.mask;this.size--;return a}}front(){if(this.size)return this.buffer[this.start]}toString(){const a=Array(this.size);for(let b=0;b<this.size;b++)a[b]=this.buffer[this.start+b&this.mask];return"["+a.join(", ")+"]"}}
class IndexedList$$module$util{constructor(){this.list=[];this.map=new Map}add(a){this.map.has(a)||(this.map.set(a,this.list.length),this.list.push(a))}indexOf(a){return this.map.get(a)}remove(a){const b=this.map.get(a);if(null!=b)for(this.list.splice(b,1),this.map.delete(a),a=b;a<this.list.length;a++)this.map.set(this.list[a],a)}[Symbol.iterator](){return this.list[Symbol.iterator]()}}var module$util={};module$util.Deque=Deque$$module$util;module$util.IndexedList=IndexedList$$module$util;const Edge$$module$graph={},EdgeT$$module$graph={};Edge$$module$graph.of=(...a)=>a.map((a)=>a.uid);class Node$$module$graph{constructor(a,b){this.graph=a;this.name=b;this.uid=a.nodes.length;a.nodes.push(this)}get nodeType(){return"Node"}toString(){return`${this.nodeType} ${this.name}`}edges(a){return[]}write(a){}}
class Graph$$module$graph{constructor(){this.nodes=[]}traverse(a={}){const {wanted:b=void 0,dfs:c=!1}=a;a=new Deque$$module$util;const d=new Map,e=new Map;for(var g of this.nodes)for(var f of g.edges()){var k=f.join(" ");for(var h=1;h<f.length;h++){const a=f[h];e.has(a)||e.set(a,new Map);e.get(a).set(k,f)}1==f.length&&(k=f[0],d.has(k)||(a.push(k),d.set(k,f)))}g=new Set((b||this.nodes).map((a)=>a instanceof Node$$module$graph?a.uid:a));for(f=new Map;g.size&&a.length;){k=c?a.pop():a.shift();g.delete(k);
a:for(const b of(e.get(k)||f).values())if(k=b[0],!d.has(k)){for(h=1;h<b.length;h++)if(!d.has(b[h]))continue a;d.set(k,b);a.push(k)}}return{win:!g.size,seen:d,path:[...d.values()].map(([a,...b])=>{const c=(a)=>[this.nodes[a]];return[a,[...c(a)," (",b.map((a)=>c(a).join("").replace(/\s+\(.*\)/,"")).join(", "),")"].join("")]})}}}
class SparseDependencyGraph$$module$graph{constructor(a){this.nodes=Array(a).fill(0).map(()=>new Map);this.finalized=Array(a).fill(!1)}addRoute(a){const b=a[0];if(this.finalized[b])throw Error(`Attempted to add a route for finalized node ${b}`);let c=new Set;for(let b=a.length-1;1<=b;b--)c.add(a[b]);for(;;){a=!1;for(var d of c){if(d===b)return[];if(this.finalized[d]){a=this.nodes[d];if(!a.size)return[];c.delete(d);if(1==a.size){for(const b of a.values().next().value)c.add(b);a=!0;break}d=new Map;
for(var e of a.values())for(var g of this.addRoute([b,...c,...e]))d.set(g.label,g);return[...d.values()]}}if(!a)break}e=[...c].sort();c=new Set(e);e=e.join(" ");g=this.nodes[b];if(g.has(e))return[];for(const [a,b]of g){if(containsAll$$module$graph(c,b))return[];containsAll$$module$graph(b,c)&&g.delete(a)}g.set(e,c);return[new SparseRoute$$module$graph(b,c,`${b}:${e}`)]}finalize(a){if(!this.finalized[a]){this.finalized[a]=!0;for(let b=0;b<this.nodes.length;b++){const c=this.nodes[b];if(c.size)for(const [d,
e]of c)if(e.has(a)){const a=this.finalized[b];this.finalized[b]=!1;c.delete(d);this.addRoute([b,...e.values()]);this.finalized[b]=a}}}}}class SparseRoute$$module$graph{constructor(a,b,c){this.target=a;this.deps=b;this.label=c}}const containsAll$$module$graph=(a,b)=>{if(a.size<b.size)return!1;for(const c of b)if(!a.has(c))return!1;return!0};var module$graph={};module$graph.Edge=Edge$$module$graph;module$graph.Node=Node$$module$graph;module$graph.Graph=Graph$$module$graph;
module$graph.SparseDependencyGraph=SparseDependencyGraph$$module$graph;class TrackerNode$$module$nodes extends Node$$module$graph{constructor(a,b,c){super(a,c);this.type=b}get nodeType(){return"Tracker"}edges({}={}){return[]}}TrackerNode$$module$nodes.OFF_ROUTE=1;TrackerNode$$module$nodes.GLITCH=2;TrackerNode$$module$nodes.HARD=3;class Option$$module$nodes extends Node$$module$graph{constructor(a,b,c){super(a,b);this.value=c}get nodeType(){return"Option"}edges(){return this.value?[Edge$$module$graph.of(this)]:[]}}
class Slot$$module$nodes extends Node$$module$graph{constructor(a,b,c,d,e=[]){super(a,b);this.slotName=b;this.slotIndex=d;this.slotType=c instanceof Magic$$module$nodes?"magic":"consumable";this.vanillaItemName=c.name;this.slots=e;this.item=c;this.itemIndex=d;this.requiresUnique=!1}get nodeType(){return"Slot"}toString(){return`${super.toString()} [${this.vanillaItemName} $${this.slotIndex.toString(16).padStart(2,0)}]`}edges(){return null!=this.item&&null!=this.itemIndex?[Edge$$module$graph.of(this.item,
this)]:[]}isMimic(){return 112<=this.itemIndex}requireUnique(){this.requiresUnique=!0;return this}canHoldMimic(){return this instanceof Chest$$module$nodes&&!this.isInvisible}needsChest(){const a=this.itemIndex;return 13<=a&&36>=a||38===a||72<a}isChest(){return(this instanceof Chest$$module$nodes||this instanceof BossDrop$$module$nodes)&&9!==this.origIndex}get name2(){return this.item==this.vanilla?this.name:`${this.item.name} [${this.vanillaItemName}]`}set(a,b){this.item=a;this.itemIndex=b}write(a){if(this.slots)for(const b of this.slots)b(a,
this)}swap(a){const b=this.item,c=this.itemIndex;this.set(a.item,a.itemIndex);a.set(b,c)}key(){this.slotType="key";return this}bonus(){this.slotType="bonus";return this}direct(a){this.slots.push((b,c)=>{write$$module$nodes(b,a,c.itemIndex)});return this}npcSpawn(a,b=null,c=0){this.slots.push((d,e)=>{let g=addr$$module$nodes(d,116192,81920,a);for(;null!=b&&d[g]!=b;){for(g++;!(d[g]&128);)g+=2,checkBounds$$module$nodes(g,d,this.name2,b);g+=2;checkBounds$$module$nodes(g,d,this.name2,b)}g+=2*c+1;d[g]&=
-2;d[g]|=2;write$$module$nodes(d,g+1,e.itemIndex)});return this}dialog(a,b=null,c=0,d=null){this.slots.push((e,g)=>{let f=addr$$module$nodes(e,117085,81920,a);for(;!(e[f]&128);)f+=4,checkBounds$$module$nodes(f,e,this.name2);f+=4;let k=0;for(;255!=e[f];)null!=b&&e[f]==b&&(k=e[f+1]),f+=2,checkBounds$$module$nodes(f,e,b);for(f+=k+1;c;){if(e[f]&64){for(f+=5;!(e[f]&64);)f+=2,checkBounds$$module$nodes(f,e,this.name2);f+=2}else f+=5;--c}if(null!=d)for(f+=5;d;)f+=2,--d;e[f]&=-2;e[f]|=2;write$$module$nodes(e,
f+1,g.itemIndex)});return this}trigger(a,b=0,c=null){this.slots.push((d,e)=>{let g=addr$$module$nodes(d,123258,81920,a&127);if(null==c)g+=2*b;else{for(;!(d[g]&128);)g+=2,checkBounds$$module$nodes(g,d,this.name2);g=g+4+2*c}d[g]&=-2;d[g]|=2;write$$module$nodes(d,g+1,e.itemIndex)});return this}}class BossDrop$$module$nodes extends Slot$$module$nodes{get nodeType(){return"BossDrop"}}
class Chest$$module$nodes extends Slot$$module$nodes{constructor(a,b,c,d){super(a,b,c,d);this.spawnSlot=null;this.isInvisible=!1}get nodeType(){return"Chest"}objectSlot(a,b){this.spawnSlot=b;this.slots.push((c,d)=>{const e=addr$$module$nodes(c,102913,65536,a)+4*(b-11);c[e-1]=112<=d.itemIndex?c[e-1]|128:c[e-1]&127;write$$module$nodes(c,e,Math.min(112,d.itemIndex))});return this}invisible(a){this.isInvisible=!0;return this.direct(a)}}const addr$$module$nodes=(a,b,c,d)=>(a[b+2*d]|a[b+2*d+1]<<8)+c;
class ItemGet$$module$nodes extends Node$$module$graph{constructor(a,b,c,d,e){super(a,c);this.id=b;this.shufflePriority=1;this.inventoryRow="unique"}get nodeType(){return"ItemGet"}chest(a=this.name+" chest",b=this.id){return new Chest$$module$nodes(this.graph,a,this,b)}fromPerson(a,b,c=0){return this.direct(a,33008|(b&-4)<<6|(b&3)<<2|c)}bossDrop(a,b,c=this.id){return new BossDrop$$module$nodes(this.graph,a,this,c,[(a,c)=>{const d=addr$$module$nodes(a,129387,81920,b)+4;write$$module$nodes(a,d,c.itemIndex)}])}direct(a,
b){return new Slot$$module$nodes(this.graph,a,this,this.id,[(a,d)=>{write$$module$nodes(a,b,d.itemIndex)}])}fixed(){return new Slot$$module$nodes(this.graph,null,this,this.id)}weight(a){this.shufflePriority=a;return this}consumable(){this.inventoryRow="consumable";return this}armor(){this.inventoryRow="armor";return this}}class Item$$module$nodes extends ItemGet$$module$nodes{get nodeType(){return"Item"}}class Magic$$module$nodes extends ItemGet$$module$nodes{get nodeType(){return"Magic"}}
class Trigger$$module$nodes extends Node$$module$graph{constructor(a,b){super(a,b);this.slot=null;this.reqs=[]}get nodeType(){return"Trigger"}edges(){const a=[...this.reqs];this.slot&&a.push(Edge$$module$graph.of(this.slot,this));return a}get(a){if(this.slot)throw Error("already have a slot");this.slot=a;return this}}
class Condition$$module$nodes extends Node$$module$graph{constructor(a,b){super(a,b);this.options=[]}get nodeType(){return"Condition"}edges(){return this.options.map((a)=>Edge$$module$graph.of(this,...a))}option(...a){this.options.push(a.map((a)=>a instanceof Slot$$module$nodes?a.item:a));return this}}class Boss$$module$nodes extends Trigger$$module$nodes{constructor(a,b,c,...d){super(a,c);this.index=b;this.deps=d.map((a)=>a instanceof Slot$$module$nodes?a.item:a)}get nodeType(){return"Boss"}}
class Area$$module$nodes extends Node$$module$graph{constructor(a,b){super(a,b);this.name=b}get nodeType(){return"Area"}}class Connection$$module$nodes{constructor(a,b,c=!1,d=[]){this.from=a;this.to=b;this.bidi=c;this.deps=d.map((a)=>a instanceof Slot$$module$nodes?a.item:a)}reverse(){return new Connection$$module$nodes(this.to,this.from,this.bidi,this.deps)}}
class Location$$module$nodes extends Node$$module$graph{constructor(a,b,c,d){super(a,c.name+": "+d);this.simpleName=d;this.id=b;this.area=c;this.connections=[];this.chests=[];this.type=this.bossNode=null;this.isEnd=this.isStart=!1;this.sells=[]}get nodeType(){return"Location"}toString(){return`Location ${this.id.toString(16).padStart(2,0)} ${this.name}`}edges(){const a=[];for(const b of this.connections)a.push(Edge$$module$graph.of(b.to,b.from,...b.deps,...b.from.bossNode?[b.from.bossNode]:[])),b.bidi&&
a.push(Edge$$module$graph.of(b.from,b.to,...b.deps,...b.to.bossNode?[b.to.bossNode]:[]));for(const b of this.chests)a.push(Edge$$module$graph.of(b,this));this.isStart&&a.push(Edge$$module$graph.of(this));return a}addConnection(a){a.from.connections.push(a);a.to.connections.push(a);return this}from(a,...b){return this.addConnection(new Connection$$module$nodes(a,this,!1,b))}to(a,...b){return this.addConnection(new Connection$$module$nodes(this,a,!1,b))}connect(a,...b){return this.addConnection(new Connection$$module$nodes(a,
this,!0,b))}connectTo(a,...b){return this.addConnection(new Connection$$module$nodes(this,a,!0,b))}chest(a,b,c=void 0){a instanceof Slot$$module$nodes&&!(a instanceof Chest$$module$nodes)&&null!=c&&(a=a.item);a instanceof ItemGet$$module$nodes&&(a=a.chest(void 0,c));b=a.objectSlot(this.id,b);this.chests.push(b);112<=b.itemIndex&&(b.slotType="trap");if(!b.slotName||b.slotName.endsWith(" chest"))b.slotName=a.name+" in "+this.area.name;return this}trigger(a,...b){b=b.map((a)=>a instanceof Slot$$module$nodes?
a.item:a);a.reqs.push(Edge$$module$graph.of(a,this,...b));return this}boss(a){this.bossNode=a;a.reqs.push(Edge$$module$graph.of(a,this,...a.deps));return this}overworld(){this.type="overworld";return this}town(){this.type="town";return this}cave(){this.type="cave";return this}sea(){this.type="sea";return this}fortress(){this.type="fortress";return this}house(){this.type="house";return this}shop(...a){this.type="house";this.sells=a.map((a)=>a instanceof Slot$$module$nodes?a.item:a);return this}misc(){this.type=
"misc";return this}start(){this.isStart=!0;return this}end(){this.isEnd=!0;return this}fullName(){const a=[this.simpleName];this.bossNode&&a.push(this.bossNode.name);return a.join("\\n")}write(a){if(this.sells.length){var b="armor"==this.sells[0].inventoryRow,c=0;for(let b=139092;139125>b;b++)if(a[b]==this.id){c=a[b+139125-139092];break}b=(b?138660:138792)+(c<<2);for(c=0;4>c;c++)a[b+c]=this.sells[c]?this.sells[c].id:255,a[b+c]||console.error(`uh oh: ${this.sells[c].id} => ${this.sells[c]}`)}}}
const checkBounds$$module$nodes=(a,b,...c)=>{if(a>b.length)throw Error("never found: "+c.map((a)=>"number"==typeof a?a.toString(16):a).join(" "));};
class WorldGraph$$module$nodes extends Graph$$module$graph{write(a){a=a.subarray(16);for(const b of this.nodes)b.write(a)}shuffleShops(a){const b={shops:[],items:[]},c={shops:[],items:[]};for(var d of this.nodes)if(d.sells&&d.sells.length){var e="armor"==d.sells[0].inventoryRow?b:c;e.shops.push(d);for(let a=0;4>a;a++)e.items.push(d.sells[a]||null);d.sells=[]}a.shuffle(b.items);a.shuffle(c.items);for(const {shops:g,items:f}of[b,c])for(a=0;f.length&&1E5>a;)d=f.pop(),e=g[a++%g.length],d&&(0<=e.sells.indexOf(d)||
4<=e.sells.length?f.push(d):e.sells.push(d));for(const {shops:a}of[b,c])for(const b of a)b.sells.sort((a,b)=>a.id-b.id)}integrate(a={}){const {tracker:b=!1}=a;var c=!b;const d=new SparseDependencyGraph$$module$graph(this.nodes.length),e=[],g=[],f=new Set,k=new Map;var h=[],n=[];const m=[];var q=[];const p=[];a=new Set;for(var l of this.nodes)if(l instanceof Location$$module$nodes){if(l.isStart){const [a]=d.addRoute([l.uid]);k.set(a.label,a)}e[l.uid]=[];g[l.uid]=[];for(const a of l.connections)f.has(a)||
(f.add(a),a.bidi&&f.add(a.reverse()));for(const a of l.chests)d.addRoute([a.uid,l.uid])}else if(l instanceof ItemGet$$module$nodes&&"Medical Herb"===l.name&&(d.addRoute([l.uid]),d.finalize(l.uid)),l instanceof Option$$module$nodes)h.push(l);else if(l instanceof TrackerNode$$module$nodes)n.push(l);else if(l instanceof Condition$$module$nodes)m.push(l);else if(l instanceof Trigger$$module$nodes)q.push(l);else if(l instanceof ItemGet$$module$nodes)p.push(l);else if(l instanceof Slot$$module$nodes)a.add(l);
else if(!(l instanceof Area$$module$nodes))throw Error(`Unknown node type: ${l.nodeType}`);for(const a of f)e[a.from.uid].push(a),g[a.to.uid].push(a);l=(a)=>{for(const c of a){for(const a of c.edges({tracker:b}))d.addRoute(a);d.finalize(c.uid)}};l(h);c&&l(n);l(q);for(c=k.values();!(h=c.next()).done;){h=h.value;n=h.target;for(var r of e[n]){n=[r.to.uid,...h.deps];for(q=r.deps.length-1;0<=q;q--)n.push(r.deps[q].uid);r.from.bossNode&&n.push(r.from.bossNode.uid);for(const a of d.addRoute(n))k.has(a.label)||
k.set(a.label,a)}}l(m);for(r=0;r<this.nodes.length;r++)this.nodes[r]instanceof ItemGet$$module$nodes||this.nodes[r]instanceof TrackerNode$$module$nodes||d.finalize(r);r=new LocationList$$module$nodes(this);for(const b of a)for(const a of d.nodes[b.uid].values())r.addRoute([b.uid,...a]);return r}}
class LocationList$$module$nodes{constructor(a){this.worldGraph=a;this.uidToLocation=[];this.locationToUid=[];this.uidToItem=[];this.itemToUid=[];this.routes=[];this.unlocks=[];this.win=null}item(a){return this.worldGraph.nodes[this.itemToUid[a]]}location(a){return this.worldGraph.nodes[this.locationToUid[a]]}addRoute(a){let b=Bits$$module$bits.of(),c;const d=[];for(let e=a.length-1;0<=e;e--){const g=e?this.uidToItem:this.uidToLocation,f=e?this.itemToUid:this.locationToUid,k=a[e];let h=g[k];null==
h&&(h=f.length,f.push(k),g[k]=h,e||null!=this.worldGraph.nodes[k].slotName||(this.win=h));e?(b=Bits$$module$bits.with(b,h),d.push(this.unlocks[h]||(this.unlocks[h]=new Set))):c=h}(this.routes[c]||(this.routes[c]=[])).push(b);for(const a of d)a.add(c)}canReach(a,b){a=this.uidToLocation(a.uid);a=this.routes[a];for(let c=0;c<a.length;c++)if(Bits$$module$bits.containsAll(b,a[c]))return!0;return!1}traverse(a=Bits$$module$bits.of(),b=[]){a=Bits$$module$bits.clone(a);const c=new Set;let d=new Set;for(var e=
0;e<this.locationToUid.length;e++)d.add(e);e=d[Symbol.iterator]();for(var g;!(g=e.next()).done;){g=g.value;d.delete(g);if(c.has(g))continue;const e=this.routes[g];for(let f=0;f<e.length;f++)if(Bits$$module$bits.containsAll(a,e[f])){c.add(g);if(b[g]){a=Bits$$module$bits.with(a,b[g]);for(let a of this.unlocks[b[g]])d.add(a)}break}}return c}traverseDepths(a){let b=Bits$$module$bits.of(),c=0;const d=[],e={};let g=new Set;for(var f=0;f<this.locationToUid.length;f++)g.add(f);g.add(e);f=g[Symbol.iterator]();
for(var k;!(k=f.next()).done;){k=k.value;g.delete(k);if(k===e){g.size&&g.add(e);c++;continue}if(null!=d[k])continue;const f=this.routes[k];for(let e=0;e<f.length;e++)if(Bits$$module$bits.containsAll(b,f[e])){d[k]=c;if(a[k]){b=Bits$$module$bits.with(b,a[k]);for(let b of this.unlocks[a[k]])g.add(b)}break}}return d}toString(){const a=[];for(let b=0;b<this.routes.length;b++){const c=this.worldGraph.nodes[this.locationToUid[b]],d=this.routes[b],e=[];for(let a=0;a<d.length;a++){const b=[];for(const c of Bits$$module$bits.bits(d[a]))b.push(this.worldGraph.nodes[this.itemToUid[c]]);
e.push("("+b.join(" & ")+")")}a.push(`${c}: ${e.join(" | ")}`)}return a.join("\n")}assumedFill(a,b=(a,b)=>!0,c=FillStrategy$$module$nodes){const d=c.shuffleItems(this.itemToUid.map((a)=>this.worldGraph.nodes[a]),a);let e=Bits$$module$bits.from(d);const g=Array(this.locationToUid.length).fill(null);for(;d.length;){const f=d.pop();if(!Bits$$module$bits.has(e,f))continue;const k=this.worldGraph.nodes[this.itemToUid[f]];e=Bits$$module$bits.without(e,f);const h=[...this.traverse(e,g)].filter((a)=>null==
g[a]);c.shuffleSlots(k,h,a);let n=!1;for(const a of h)if(null==g[a]&&a!=this.win&&b(this.worldGraph.nodes[this.locationToUid[a]],k)){if(100<a)throw Error("WTF");g[a]=f;n=!0;break}if(!n)return null}return g}}class FillStrategy$$module$nodes{shuffleSlots(a,b,c){}static shuffleSlots(a,b,c){c.shuffle(b)}shuffleItems(a,b){}static shuffleItems(a,b){const c=[];for(let b=0;b<a.length;b++){const {shufflePriority:d=1}=a[b];for(let a=0;a<d;a++)c.push(b)}b.shuffle(c);return c}}
const write$$module$nodes=(a,b,c)=>{a[b]=c};class Filling$$module$nodes{constructor(){this.data=[]}has(a){}get(a){}set(a,b){}fits(a,b){return!0}}var module$nodes={};module$nodes.TrackerNode=TrackerNode$$module$nodes;module$nodes.Option=Option$$module$nodes;module$nodes.Slot=Slot$$module$nodes;module$nodes.BossDrop=BossDrop$$module$nodes;module$nodes.Chest=Chest$$module$nodes;module$nodes.ItemGet=ItemGet$$module$nodes;module$nodes.Item=Item$$module$nodes;module$nodes.Magic=Magic$$module$nodes;
module$nodes.Trigger=Trigger$$module$nodes;module$nodes.Condition=Condition$$module$nodes;module$nodes.Boss=Boss$$module$nodes;module$nodes.Area=Area$$module$nodes;module$nodes.Connection=Connection$$module$nodes;module$nodes.Location=Location$$module$nodes;module$nodes.WorldGraph=WorldGraph$$module$nodes;module$nodes.LocationList=LocationList$$module$nodes;module$nodes.FillStrategy=FillStrategy$$module$nodes;module$nodes.Filling=Filling$$module$nodes;function seq$$module$rom$util(a,b=(a)=>a){return Array(a).fill(0).map((a,d)=>b(d))}function slice$$module$rom$util(a,b,c){return a.slice(b,b+c)}function tuple$$module$rom$util(a,b,c){return Array.from(a.slice(b,b+c))}function signed$$module$rom$util(a){return 128>a?a:a-256}function unsigned$$module$rom$util(a){return 0>a?a+256:a}function varSlice$$module$rom$util(a,b,c,d,e=Infinity,g){g||(g=(a)=>a);const f=[];for(;b+c<=e&&a[b]!=d;)f.push(g(a.slice(b,b+c))),b+=c;return f}
function addr$$module$rom$util(a,b,c=0){return(a[b]|a[b+1]<<8)+c}function group$$module$rom$util(a,b,c){c||(c=(a)=>a);return seq$$module$rom$util(Math.max(0,Math.floor(b.length/a)),(d)=>c(slice$$module$rom$util(b,d*a,a)))}function reverseBits$$module$rom$util(a){return 65793*(2050*a&139536|32800*a&558144)>>>16&255}function countBits$$module$rom$util(a){a-=a>>1&85;a=(a&51)+(a>>2&51);return a+(a>>4)&15}function hex$$module$rom$util(a){return a.toString(16).padStart(2,"0")}
function hex4$$module$rom$util(a){return a.toString(16).padStart(4,"0")}function concatIterables$$module$rom$util(a){const b=[];for(const c of a)for(const a of c)b.push(a);return b}function readBigEndian$$module$rom$util(a,b){return a[b]<<8|a[b+1]}function readLittleEndian$$module$rom$util(a,b){return a[b+1]<<8|a[b]}function readString$$module$rom$util(a,b){const c=[];for(;a[b];)c.push(a[b++]);return String.fromCharCode(...c)}
class DataTuple$$module$rom$util{constructor(a){this.data=a}[Symbol.iterator](){return this.data[Symbol.iterator]()}hex(){return Array.from(this.data,hex$$module$rom$util).join(" ")}clone(){return new this.constructor(this.data)}static make(a,b){const c=class extends DataTuple$$module$rom$util{constructor(b=Array(a).fill(0)){super(b)}static of(a){const b=new c;for(const c in a)b[c]=a[c];return b}static from(b,d=0){return new c(tuple$$module$rom$util(b,d,a))}},d={};for(const a in b)d[a]="function"===
typeof b[a]?{value:b[a]}:b[a];Object.defineProperties(c.prototype,d);return c}static prop(...a){return{get(){let b=0;for(const [c,d=255,e=0]of a)b|=(this.data[c]&d)>>>(0>e?0:e)<<(0>e?-e:0);return b},set(b){for(const [c,d=255,e=0]of a)this.data[c]=this.data[c]&~d|b>>>(0>e?-e:0)<<(0>e?0:e)&d}}}static booleanProp(a){const b=DataTuple$$module$rom$util.prop(a);return{get(){return!!b.get.call(this)},set(a){b.set.call(this,+a)}}}}var module$rom$util={};module$rom$util.seq=seq$$module$rom$util;
module$rom$util.slice=slice$$module$rom$util;module$rom$util.tuple=tuple$$module$rom$util;module$rom$util.signed=signed$$module$rom$util;module$rom$util.unsigned=unsigned$$module$rom$util;module$rom$util.varSlice=varSlice$$module$rom$util;module$rom$util.addr=addr$$module$rom$util;module$rom$util.group=group$$module$rom$util;module$rom$util.reverseBits=reverseBits$$module$rom$util;module$rom$util.countBits=countBits$$module$rom$util;module$rom$util.hex=hex$$module$rom$util;module$rom$util.hex4=hex4$$module$rom$util;
module$rom$util.concatIterables=concatIterables$$module$rom$util;module$rom$util.readBigEndian=readBigEndian$$module$rom$util;module$rom$util.readLittleEndian=readLittleEndian$$module$rom$util;module$rom$util.readString=readString$$module$rom$util;module$rom$util.DataTuple=DataTuple$$module$rom$util;class Entity$$module$rom$entity{constructor(a,b){this.rom=a;this.id=b}write(a){}toString(){return`${this.constructor.name} $${hex$$module$rom$util(this.id)}`}}var module$rom$entity={};module$rom$entity.Entity=Entity$$module$rom$entity;class Location$$module$rom$location extends Entity$$module$rom$entity{constructor(a,b){super(a,b);const c=LOCATIONS$$module$rom$location[b]||{name:""};this.mapDataPointer=82688+(b<<1);this.mapDataBase=addr$$module$rom$util(a.prg,this.mapDataPointer,49152);this.name=c.name||"";this.valid=49152<this.mapDataBase&&!!this.name;this.layoutBase=addr$$module$rom$util(a.prg,this.mapDataBase,49152);this.graphicsBase=addr$$module$rom$util(a.prg,this.mapDataBase+2,49152);this.entrancesBase=addr$$module$rom$util(a.prg,
this.mapDataBase+4,49152);this.exitsBase=addr$$module$rom$util(a.prg,this.mapDataBase+6,49152);this.flagsBase=addr$$module$rom$util(a.prg,this.mapDataBase+8,49152);this.pitsBase=this.layoutBase==this.mapDataBase+10?0:addr$$module$rom$util(a.prg,this.mapDataBase+10,49152);this.bgm=a.prg[this.layoutBase];this.layoutWidth=a.prg[this.layoutBase+1];this.layoutHeight=a.prg[this.layoutBase+2];this.animation=a.prg[this.layoutBase+3];this.extended=a.prg[this.layoutBase+4];this.screens=seq$$module$rom$util(this.height,
(b)=>tuple$$module$rom$util(a.prg,this.layoutBase+5+b*this.width,this.width));for(let a of c.replace||[]){let [b,c,d]=a;this.screens[c][b]=d}this.tilePalettes=tuple$$module$rom$util(a.prg,this.graphicsBase,3);this.tileset=a.prg[this.graphicsBase+3];this.tileEffects=a.prg[this.graphicsBase+4];this.tilePatterns=slice$$module$rom$util(a.prg,this.graphicsBase+5,2);this.entrances=group$$module$rom$util(4,a.prg.slice(this.entrancesBase,this.exitsBase),(a)=>new Entrance$$module$rom$location(a));this.exits=
varSlice$$module$rom$util(a.prg,this.exitsBase,4,255,this.flagsBase,(a)=>new Exit$$module$rom$location(a));this.flags=varSlice$$module$rom$util(a.prg,this.flagsBase,2,255,Infinity,(a)=>new Flag$$module$rom$location(a));this.pits=this.pitsBase?varSlice$$module$rom$util(a.prg,this.pitsBase,4,255,Infinity,(a)=>new Pit$$module$rom$location(a)):[];this.npcDataPointer=102913+(b<<1);this.npcDataBase=addr$$module$rom$util(a.prg,this.npcDataPointer,65536);this.spritePalettes=(this.hasSpawns=65536!=this.npcDataBase)?
slice$$module$rom$util(a.prg,this.npcDataBase+1,2):[0,0];this.spritePatterns=this.hasSpawns?slice$$module$rom$util(a.prg,this.npcDataBase+3,2):[0,0];this.spawns=this.hasSpawns?varSlice$$module$rom$util(a.prg,this.npcDataBase+5,4,255,Infinity,(a)=>new Spawn$$module$rom$location(a)):[]}get width(){return this.layoutWidth+1}set width(a){this.layoutWidth=a-1}get height(){return this.layoutHeight+1}set height(a){this.layoutHeight=a-1}write(a){const b=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(b.valid){if(b.hasSpawns){var c=
[0,...b.spritePalettes,...b.spritePatterns,...concatIterables$$module$rom$util(b.spawns),255];c=yield a.write(c,98304,114687);a.rom[b.npcDataPointer]=c&255;a.rom[b.npcDataPointer+1]=c>>8}c=[b.bgm,b.layoutWidth,b.layoutHeight,b.animation,b.extended,...concatIterables$$module$rom$util(b.screens)];var d=[...b.tilePalettes,b.tileset,b.tileEffects,...b.tilePatterns],e=concatIterables$$module$rom$util(b.entrances),g=[...concatIterables$$module$rom$util(b.exits),255],f=[...concatIterables$$module$rom$util(b.flags),
255],k=concatIterables$$module$rom$util(b.pits),[h,n,m,q,p,l]=yield Promise.all([a.write(c,81920,98303),a.write(d,81920,98303),a.write(e,81920,98303),a.write(g,81920,98303),a.write(f,81920,98303),...k.length?[a.write(k,81920,98303)]:[]]);c=[h&255,(h>>>8)-192,n&255,(n>>>8)-192,m&255,(m>>>8)-192,q&255,(q>>>8)-192,p&255,(p>>>8)-192,...l?[l&255,(l>>8)-192]:[]];c=yield a.write(c,81920,98303);a.rom[b.mapDataPointer]=c&255;a.rom[b.mapDataPointer+1]=(c>>>8)-192}})}allScreens(){const a=new Set,b=this.extended?
256:0;for(const c of this.screens)for(const d of c)a.add(this.rom.screens[d+b]);return a}}
const Entrance$$module$rom$location=DataTuple$$module$rom$util.make(4,{x:DataTuple$$module$rom$util.prop([0],[1,255,-8]),y:DataTuple$$module$rom$util.prop([2],[3,255,-8]),toString(){return`Entrance ${this.hex()}: (${hex$$module$rom$util(this.x)}, ${hex$$module$rom$util(this.y)})`}}),Exit$$module$rom$location=DataTuple$$module$rom$util.make(4,{x:DataTuple$$module$rom$util.prop([0,255,-4]),y:DataTuple$$module$rom$util.prop([1,255,-4]),xt:DataTuple$$module$rom$util.prop([0]),yt:DataTuple$$module$rom$util.prop([1]),
dest:DataTuple$$module$rom$util.prop([2]),entrance:DataTuple$$module$rom$util.prop([3]),toString(){return`Exit ${this.hex()}: (${hex$$module$rom$util(this.x)}, ${hex$$module$rom$util(this.y)}) => ${this.dest}:${this.entrance}`}}),Flag$$module$rom$location=DataTuple$$module$rom$util.make(2,{x:DataTuple$$module$rom$util.prop([1,7,-8]),y:DataTuple$$module$rom$util.prop([1,240,-4]),xs:DataTuple$$module$rom$util.prop([1,7]),ys:DataTuple$$module$rom$util.prop([1,240,4]),yx:DataTuple$$module$rom$util.prop([1]),
flag:{get(){return this.data[0]|512},set(a){if(512!==(a&-256))throw Error(`bad flag: ${hex$$module$rom$util(a)}`);this.data[0]=a&255}},toString(){return`Flag ${this.hex()}: (${hex$$module$rom$util(this.xs)}, ${hex$$module$rom$util(this.ys)}) @ ${hex$$module$rom$util(this.flag)}`}}),Pit$$module$rom$location=DataTuple$$module$rom$util.make(4,{fromXs:DataTuple$$module$rom$util.prop([1,112,4]),toXs:DataTuple$$module$rom$util.prop([1,7]),fromYs:DataTuple$$module$rom$util.prop([3,240,4]),toYs:DataTuple$$module$rom$util.prop([3,
15]),dest:DataTuple$$module$rom$util.prop([0]),toString(){return`Pit ${this.hex()}: (${hex$$module$rom$util(this.fromXs)}, ${hex$$module$rom$util(this.fromYs)}) => ${hex$$module$rom$util(this.dest)}:(${hex$$module$rom$util(this.toXs)}, ${hex$$module$rom$util(this.toYs)})`}}),Spawn$$module$rom$location=DataTuple$$module$rom$util.make(4,{y:DataTuple$$module$rom$util.prop([0,255,-4]),x:DataTuple$$module$rom$util.prop([1,127,-4],[2,64,3]),yt:DataTuple$$module$rom$util.prop([0]),xt:DataTuple$$module$rom$util.prop([1,
127]),timed:DataTuple$$module$rom$util.booleanProp([1,128,7]),type:DataTuple$$module$rom$util.prop([2,7]),id:DataTuple$$module$rom$util.prop([3]),monsterId:{get(){return this.id+80&255},set(a){this.id=a-80&255}},patternBank:DataTuple$$module$rom$util.prop([2,128,7]),isChest(){return 2===this.type&&128>this.id},isTrigger(){return 2===this.type&&128<=this.id},isMonster(){return 0===this.type},toString(){return`Spawn ${this.hex()}: (${hex$$module$rom$util(this.x)}, ${hex$$module$rom$util(this.y)}) ${this.timed?
"timed":"fixed"} ${this.type}:${hex$$module$rom$util(this.id)}`}}),LOCATIONS$$module$rom$location=(()=>{function a(a,d,e){({replace:e}=void 0===e?{}:e);d={name:d};e&&(d.replace=e);b[a]=d}const b=[];a(0,"Mezame Shrine");a(1,"Leaf - Outside Start");a(2,"Leaf");a(3,"Valley of Wind");a(4,"Sealed Cave 1");a(5,"Sealed Cave 2");a(6,"Sealed Cave 6");a(7,"Sealed Cave 4");a(8,"Sealed Cave 5");a(9,"Sealed Cave 3");a(10,"Sealed Cave 7");a(12,"Sealed Cave 8");a(14,"Windmill Cave");a(15,"Windmill");a(16,"Zebu Cave");
a(17,"Mt Sabre West - Cave 1");a(20,"Cordel Plains West");a(21,"Cordel Plains East");a(24,"Brynmaer");a(25,"Outside Stom House");a(26,"Swamp");a(27,"Amazones");a(28,"Oak");a(30,"Stom House");a(32,"Mt Sabre West - Lower");a(33,"Mt Sabre West - Upper");a(34,"Mt Sabre West - Cave 2");a(35,"Mt Sabre West - Cave 3");a(36,"Mt Sabre West - Cave 4",{replace:[[3,4,128]]});a(37,"Mt Sabre West - Cave 5");a(38,"Mt Sabre West - Cave 6");a(39,"Mt Sabre West - Cave 7");a(40,"Mt Sabre North - Main");a(41,"Mt Sabre North - Middle");
a(42,"Mt Sabre North - Cave 2");a(43,"Mt Sabre North - Cave 3");a(44,"Mt Sabre North - Cave 4");a(45,"Mt Sabre North - Cave 5");a(46,"Mt Sabre North - Cave 6");a(47,"Mt Sabre North - Prison Hall");a(48,"Mt Sabre North - Left Cell");a(49,"Mt Sabre North - Left Cell 2");a(50,"Mt Sabre North - Right Cell");a(51,"Mt Sabre North - Cave 8");a(52,"Mt Sabre North - Cave 9");a(53,"Mt Sabre North - Summit Cave");a(56,"Mt Sabre North - Cave 1");a(57,"Mt Sabre North - Cave 7");a(60,"Nadare - Inn");a(61,"Nadare - Tool Shop");
a(62,"Nadare - Back Room");a(64,"Waterfall Valley North");a(65,"Waterfall Valley South");a(66,"Lime Tree Valley",{replace:[[0,2,0]]});a(67,"Lime Tree Lake");a(68,"Kirisa Plant Cave 1");a(69,"Kirisa Plant Cave 2");a(70,"Kirisa Plant Cave 3");a(71,"Kirisa Meadow");a(72,"Fog Lamp Cave 1");a(73,"Fog Lamp Cave 2");a(74,"Fog Lamp Cave 3");a(75,"Fog Lamp Cave Dead End");a(76,"Fog Lamp Cave 4");a(77,"Fog Lamp Cave 5");a(78,"Fog Lamp Cave 6");a(79,"Fog Lamp Cave 7");a(80,"Portoa");a(81,"Portoa - Fisherman Island");
a(82,"Mesia Shrine");a(84,"Waterfall Cave 1");a(85,"Waterfall Cave 2");a(86,"Waterfall Cave 3");a(87,"Waterfall Cave 4");a(88,"Tower - Entrance");a(89,"Tower 1");a(90,"Tower 2");a(91,"Tower 3");a(92,"Tower - Outside Mesia");a(93,"Tower - Outside Dyna");a(94,"Tower - Mesia");a(95,"Tower - Dyna");a(96,"Angry Sea");a(97,"Boat House");a(98,"Joel - Lighthouse");a(100,"Underground Channel");a(101,"Zombie Town");a(104,"Evil Spirit Island 1");a(105,"Evil Spirit Island 2");a(106,"Evil Spirit Island 3");a(107,
"Evil Spirit Island 4");a(108,"Sabera Palace 1");a(109,"Sabera Palace 2");a(110,"Sabera Palace 3");a(112,"Joel - Secret Passage");a(113,"Joel");a(114,"Swan");a(115,"Swan - Gate");a(120,"Goa Valley");a(124,"Mt Hydra");a(125,"Mt Hydra - Cave 1");a(126,"Mt Hydra - Outside Shyron");a(127,"Mt Hydra - Cave 2");a(128,"Mt Hydra - Cave 3");a(129,"Mt Hydra - Cave 4");a(130,"Mt Hydra - Cave 5");a(131,"Mt Hydra - Cave 6");a(132,"Mt Hydra - Cave 7");a(133,"Mt Hydra - Cave 8");a(134,"Mt Hydra - Cave 9");a(135,
"Mt Hydra - Cave 10");a(136,"Styx 1");a(137,"Styx 2");a(138,"Styx 3");a(140,"Shyron");a(142,"Goa");a(143,"Goa Fortress - Oasis Entrance");a(144,"Desert 1");a(145,"Oasis Cave - Main",{replace:[[0,11,128],[1,11,128],[2,11,128],[3,11,128],[4,11,128],[5,11,128],[6,11,128],[7,11,128]]});a(146,"Desert Cave 1");a(147,"Sahara");a(148,"Sahara - Outside Cave");a(149,"Desert Cave 2");a(150,"Sahara Meadow");a(152,"Desert 2");a(156,"Pyramid Front - Entrance");a(157,"Pyramid Front - Branch");a(158,"Pyramid Front - Main");
a(159,"Pyramid Front - Draygon");a(160,"Pyramid Back - Entrance");a(161,"Pyramid Back - Hall 1");a(162,"Pyramid Back - Branch");a(163,"Pyramid Back - Dead End Left");a(164,"Pyramid Back - Dead End Right");a(165,"Pyramid Back - Hall 2");a(166,"Pyramid Back - Draygon Revisited");a(167,"Pyramid Back - Teleporter");a(168,"Goa Fortress - Entrance");a(169,"Goa Fortress - Kelbesque");a(170,"Goa Fortress - Zebu");a(171,"Goa Fortress - Sabera");a(172,"Goa Fortress - Tornel");a(173,"Goa Fortress - Mado 1");
a(174,"Goa Fortress - Mado 2");a(175,"Goa Fortress - Mado 3");a(176,"Goa Fortress - Karmine 1");a(177,"Goa Fortress - Karmine 2");a(178,"Goa Fortress - Karmine 3");a(179,"Goa Fortress - Karmine 4");a(180,"Goa Fortress - Karmine 5");a(181,"Goa Fortress - Karmine 6");a(182,"Goa Fortress - Karmine 7");a(183,"Goa Fortress - Exit");a(184,"Oasis Cave - Entrance");a(185,"Goa Fortress - Asina");a(186,"Goa Fortress - Kensu");a(187,"Goa - House");a(188,"Goa - Inn");a(190,"Goa - Tool Shop");a(191,"Goa - Tavern");
a(192,"Leaf - Elder House");a(193,"Leaf - Rabbit Hut");a(194,"Leaf - Inn");a(195,"Leaf - Tool Shop");a(196,"Leaf - Armor Shop");a(197,"Leaf - Student House");a(198,"Brynmaer - Tavern");a(199,"Brynmaer - Pawn Shop");a(200,"Brynmaer - Inn");a(201,"Brynmaer - Armor Shop");a(203,"Brynmaer - Item Shop");a(205,"Oak - Elder House");a(206,"Oak - Mother House");a(207,"Oak - Tool Shop");a(208,"Oak - Inn");a(209,"Amazones - Inn");a(210,"Amazones - Item Shop");a(211,"Amazones - Armor Shop");a(212,"Amazones - Elder");
a(213,"Nadare");a(214,"Portoa - Fisherman House");a(215,"Portoa - Palace Entrance");a(216,"Portoa - Fortune Teller");a(217,"Portoa - Pawn Shop");a(218,"Portoa - Armor Shop");a(220,"Portoa - Inn");a(221,"Portoa - Tool Shop");a(222,"Portoa - Palace Left");a(223,"Portoa - Palace Throne Room");a(224,"Portoa - Palace Right");a(225,"Portoa - Asina Room");a(226,"Amazones - Elder Downstairs");a(227,"Joel - Elder House");a(228,"Joel - Shed");a(229,"Joel - Tool Shop");a(231,"Joel - Inn");a(232,"Zombie Town - House");
a(233,"Zombie Town - House Basement");a(235,"Swan - Tool Shop");a(236,"Swan - Stom Hut");a(237,"Swan - Inn");a(238,"Swan - Armor Shop");a(239,"Swan - Tavern");a(240,"Swan - Pawn Shop");a(241,"Swan - Dance Hall");a(242,"Shyron - Fortress");a(243,"Shyron - Training Hall");a(244,"Shyron - Hospital");a(245,"Shyron - Armor Shop");a(246,"Shyron - Tool Shop");a(247,"Shyron - Inn");a(248,"Sahara - Inn");a(249,"Sahara - Tool Shop");a(250,"Sahara - Elder House");a(251,"Sahara - Pawn Shop");return b})();
var module$rom$location={};module$rom$location.Location=Location$$module$rom$location;module$rom$location.Entrance=Entrance$$module$rom$location;module$rom$location.Exit=Exit$$module$rom$location;module$rom$location.Flag=Flag$$module$rom$location;module$rom$location.Pit=Pit$$module$rom$location;module$rom$location.Spawn=Spawn$$module$rom$location;module$rom$location.LOCATIONS=LOCATIONS$$module$rom$location;class Hitbox$$module$rom$hitbox extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=218769+(b<<2);this.coordinates=tuple$$module$rom$util(a.prg,this.base,4)}get w(){return this.coordinates[1]}set w(a){this.coordinates[1]=a}get x0(){return signed$$module$rom$util(this.coordinates[0])}set x0(a){this.coordinates[0]=unsigned$$module$rom$util(a)}get x1(){return this.x0+this.w}get h(){return this.coordinates[3]}set h(a){this.coordinates[3]=a}get y0(){return signed$$module$rom$util(this.coordinates[2])}set y0(a){this.coordinates[2]=
unsigned$$module$rom$util(a)}get y1(){return this.y0+this.h}write(a){a.rom.subarray(this.base,this.base+4).set(this.coordinates)}}var module$rom$hitbox={};module$rom$hitbox.Hitbox=Hitbox$$module$rom$hitbox;class Npc$$module$rom$npc extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.used=!UNUSED_NPCS$$module$rom$npc.has(b)&&(143>b||192<=b);this.dataBase=33008|(b&252)<<6|(b&3)<<2;this.data=tuple$$module$rom$util(a.prg,this.dataBase,4);this.spawnPointer=116192+(b<<1);this.spawnBase=addr$$module$rom$util(a.prg,this.spawnPointer,81920);this.spawnConditions=new Map;b=this.spawnBase;let c;for(;this.used&&255!=(c=a.prg[b++]);){const d=[];this.spawnConditions.set(c,d);let e;do{e=a.prg[b]<<8|
a.prg[b+1];const c=e&4095;d.push(e&8192?~c:c);b+=2}while(!(e&32768))}}spawnConditionsBytes(){const a=[];for(const b of this.spawnConditions){const [c,d]=b;a.push(c);for(let b=0;b<d.length;b++){let c=d[b];0>c&&(c=~c|8192);b===d.length-1&&(c|=32768);a.push(c>>>8,c&255)}}a.push(255);return a}write(a,b){var {spawnConditionsBase:c=116192}=void 0===b?{}:b;const d=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const b=yield a.write(d.spawnConditionsBytes(),114688,122879);a.rom[c+2*
d.id]=b&255;a.rom[c+2*d.id+1]=(b>>>8)-64})}}const UNUSED_NPCS$$module$rom$npc=new Set([60,106,115,130,134,135,137,138,139,140,141]);var module$rom$npc={};module$rom$npc.Npc=Npc$$module$rom$npc;class Palette$$module$rom$palette extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=(b&3)<<2|(b&252)<<6|16624;this.colors=tuple$$module$rom$util(a.prg,this.base,4)}color(a){return this.colors[a]&63}}var module$rom$palette={};module$rom$palette.Palette=Palette$$module$rom$palette;class Pattern$$module$rom$pattern extends Entity$$module$rom$entity{constructor(a,b,c){super(a,b);this.pixels=c||tuple$$module$rom$util(a.chr,b<<4,16)}pixelAt(a,b){return(this.pixels[a|8]>>b&1)<<1|this.pixels[a]>>b&1}flipH(){return new Pattern$$module$rom$pattern(this.rom,-1,this.pixels.map(reverseBits$$module$rom$util))}flipV(){return new Pattern$$module$rom$pattern(this.rom,-1,seq$$module$rom$util(16,(a)=>this.pixels[a&8|~a&7]))}flip(a){let b=this;a&Flip$$module$rom$pattern.HORIZONTAL&&(b=b.flipH());
a&Flip$$module$rom$pattern.VERTICAL&&(b=b.flipV());return b}}var Flip$$module$rom$pattern;(function(a){a[a.HORIZONTAL=64]="HORIZONTAL";a[a.VERTICAL=128]="VERTICAL"})(Flip$$module$rom$pattern||(Flip$$module$rom$pattern={}));var module$rom$pattern={};module$rom$pattern.Pattern=Pattern$$module$rom$pattern;module$rom$pattern.Flip=Flip$$module$rom$pattern;class Screen$$module$rom$screen extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=(255<b?64+b:b)<<8;this.tiles=seq$$module$rom$util(15,(b)=>tuple$$module$rom$util(a.prg,this.base|b<<4,16))}allTilesSet(){const a=new Set;for(const b of this.tiles)for(const c of b)a.add(c);return a}write(a){let b=this.base;for(const c of this.tiles)for(const d of c)a.rom[b++]=d}}var module$rom$screen={};module$rom$screen.Screen=Screen$$module$rom$screen;class Tileset$$module$rom$tileset extends Entity$$module$rom$entity{constructor(a,b){super(a,b);b&=63;this.tileBase=65536|b<<8;this.attrBase=77824|b<<4;this.alternatesBase=81408|b<<3;this.tiles=seq$$module$rom$util(4,(b)=>tuple$$module$rom$util(a.prg,this.tileBase|b<<8,256));this.attrs=seq$$module$rom$util(256,(b)=>a.prg[this.attrBase|b>>2]>>((b&3)<<1)&3);this.alternates=tuple$$module$rom$util(a.prg,this.alternatesBase,32)}write(a){for(var b=0;256>b;b++){32>b&&(a.rom[this.alternatesBase+b]=this.alternates[b]);
for(var c=0;4>c;c++)a.rom[this.tileBase+(c<<8)+b]=this.tiles[c][b]}for(b=0;64>b;b++)c=b<<2,a.rom[this.attrBase+b]=this.attrs[c]&3|(this.attrs[c+1]&3)<<2|(this.attrs[c+2]&3)<<4|(this.attrs[c+3]&3)<<6}}var module$rom$tileset={};module$rom$tileset.Tileset=Tileset$$module$rom$tileset;class TileEffects$$module$rom$tileeffects extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=b<<8&8191|73728;this.effects=tuple$$module$rom$util(a.prg,this.base,256)}write(a){for(let b=0;256>b;b++)a.rom[this.base+b]=this.effects[b]}}var module$rom$tileeffects={};module$rom$tileeffects.TileEffects=TileEffects$$module$rom$tileeffects;class TileAnimation$$module$rom$tileanimation extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=255865+(b<<3);this.pages=tuple$$module$rom$util(a.prg,this.base,8)}}var module$rom$tileanimation={};module$rom$tileanimation.TileAnimation=TileAnimation$$module$rom$tileanimation;const MessageId$$module$rom$messageid=DataTuple$$module$rom$util.make(2,{action:DataTuple$$module$rom$util.prop([0,248,3]),part:DataTuple$$module$rom$util.prop([0,7,-3],[1,224,5]),index:DataTuple$$module$rom$util.prop([1,31]),toString(){const a=this.action?` (action ${hex$$module$rom$util(this.action)})`:"";return`MessageId ${this.hex()}: (${hex$$module$rom$util(this.part)}:${hex$$module$rom$util(this.index)}${a}`}});var module$rom$messageid={};module$rom$messageid.MessageId=MessageId$$module$rom$messageid;const UNUSED_TRIGGERS$$module$rom$trigger=new Set([135,136,137,143,147,150,152,155,156,157,158,159,160,181,185,190,192]);
class Trigger$$module$rom$trigger extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.used=!UNUSED_TRIGGERS$$module$rom$trigger.has(b);this.pointer=123258+((b&127)<<1);this.base=addr$$module$rom$util(a.prg,this.pointer,81920);this.conditions=[];this.message=new MessageId$$module$rom$messageid;this.flags=[];let c=this.base;do{b=readBigEndian$$module$rom$util(a.prg,c);var d=b&4095;this.conditions.push(b&8192?~d:d);c+=2}while(!(b&32768));this.message=MessageId$$module$rom$messageid.from(a.prg,
c);do c+=2,b=readBigEndian$$module$rom$util(a.prg,c),d=b&4095,this.flags.push(b&32768?~d:d);while(!(b&16384))}bytes(){const a=[];this.conditions.length||this.conditions.push(-1);for(var b=0;b<this.conditions.length;b++){var c=this.conditions[b];0>c&&(c=~c|8192);b===this.conditions.length-1&&(c|=32768);a.push(c>>>8,c&255)}a.push(...this.message.data);this.flags.length||this.flags.push(-1);for(b=0;b<this.flags.length;b++)c=this.flags[b],0>c&&(c=~c|32768),b===this.flags.length-1&&(c|=16384),a.push(c>>>
8,c&255);return a}write(a,b){b=void 0===b?123258:b;const c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const d=yield a.write(c.bytes(),122880,131071);a.rom[b+2*(c.id&127)]=d&255;a.rom[b+2*(c.id&127)+1]=(d>>>8)-64})}}var module$rom$trigger={};module$rom$trigger.Trigger=Trigger$$module$rom$trigger;class UnionFind$$module$unionfind{constructor(){this.data=new Map;this.sizes=new Map}find(a){this.data.has(a)||(this.data.set(a,a),this.sizes.set(a,1));let b;for(;(b=this.data.get(a))!=a;)this.data.set(a,a=this.data.get(b));return a}union(a){this.find(a[0]);for(let b=1;b<a.length;b++)this.unionInternal(a[0],a[b])}unionInternal(a,b){a=this.find(a);b=this.find(b);if(a!=b){var c=this.sizes.get(a),d=this.sizes.get(b);c<d?(this.sizes.set(b,c+d),this.data.set(a,b)):(this.sizes.set(a,c+d),this.data.set(b,
a))}}sets(){const a=new Map;for(const b of this.data.keys()){const c=this.find(b);a.has(c)||a.set(c,new Set);a.get(c).add(b)}return[...a.values()]}}var module$unionfind={};module$unionfind.UnionFind=UnionFind$$module$unionfind;function page$$module$rom$writer(a){return a>>>13}class Chunk$$module$rom$writer{constructor(a,b){this.start=a;this.end=b;this.page=page$$module$rom$writer(a);if(page$$module$rom$writer(b)!==this.page)throw Error("Chunk spans pages");this.pos=a}free(){return this.end-this.pos}find(a,b){for(let c=this.start;c<=this.pos-a.length;c++){let d=!0;for(let e=0;e<a.length;e++)if(b[c+e]!==a[e]){d=!1;break}if(d)return c}return-1}}
class Writer$$module$rom$writer{constructor(a){this.rom=a;this.chunks=[];this.writes=[];this.promises=[]}alloc(a,b){for(;page$$module$rom$writer(b)>page$$module$rom$writer(a);){const b=page$$module$rom$writer(a)+1<<13;this.chunks.push(new Chunk$$module$rom$writer(a,b-1));a=b}this.chunks.push(new Chunk$$module$rom$writer(a,b))}write(a,b,c){const d=page$$module$rom$writer(b),e=page$$module$rom$writer(c);b=new Promise((b,c)=>{this.writes.push({data:a,resolve:b,startPage:d,endPage:e})});this.promises.push(b);
return b}commit(){const a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){for(;a.writes.length;){var b=a.writes.sort((a,b)=>a.endPage-a.startPage-(b.endPage-b.startPage)||b.data.length-a.data.length);const c=a.promises;a.writes=[];a.promises=[];for(const c of b)b=a.find(c),0<=b?c.resolve(b):a.writeOne(c);yield Promise.all(c)}})}find(a){var {data:b,startPage:c,endPage:d}=a;for(const e of this.chunks)if(!(e.page<c||e.page>d)&&(a=e.find(b,this.rom),0<=a))return a;return-1}writeOne(a){for(const b of this.chunks)if(!(b.page<
a.startPage||b.page>a.endPage||b.free()<a.data.length)){this.rom.subarray(b.pos,b.pos+a.data.length).set(a.data);a.resolve(b.pos);b.pos+=a.data.length;return}throw Error("Could not find sufficient chunk to write");}}var module$rom$writer={};module$rom$writer.Writer=Writer$$module$rom$writer;class AdHocSpawn$$module$rom extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=(b<<2)+171008;this.lowerSlot=a.prg[this.base];this.upperSlot=a.prg[this.base+1];this.object=a.prg[this.base+2];this.count=a.prg[this.base+3]}}
class ItemGet$$module$rom extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.itemPointer=122214+b;this.item=a.prg[this.itemPointer];this.tablePointer=121600+2*b;this.tableBase=addr$$module$rom$util(a.prg,this.tablePointer,81920);b=[];let c=this.tableBase;b.push(a.prg[c++]);b.push(a.prg[c++]);b.push(a.prg[c++]);for(b.push(a.prg[c++]);;){const d=a.prg[c++];b.push(d);b.push(a.prg[c++]);if(d&64)break}b.push(a.prg[c++]);this.table=Uint8Array.from(b)}write(a){a=void 0===a?this.rom:a;a.prg[this.itemPointer]=
this.item;const b=this.table;a.prg.subarray(this.tableBase,this.tableBase+b.length).set(b)}}
class ObjectData$$module$rom extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.objectDataPointer=109568+(b<<1);this.objectDataBase=addr$$module$rom$util(a.prg,this.objectDataPointer,65536);this.sfx=a.prg[this.objectDataBase];b=this.objectDataBase+1;this.objectData=[];let c=0;for(let d=0;32>d;d++)d&7||(c=a.prg[b++]),this.objectData.push(c&128?a.prg[b++]:0),c<<=1}serialize(){const a=[this.sfx];for(let b=0;4>b;b++){let c=a.length;a.push(0);for(let d=0;8>d;d++)this.objectData[8*b+d]&&
(a[c]|=128>>>d,a.push(this.objectData[8*b+d]))}return Uint8Array.from(a)}write(a,b){b=void 0===b?109568:b;const c=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const d=yield a.write(c.serialize(),106496,114687);a.rom[b+2*c.id]=d&255;a.rom[b+2*c.id+1]=d>>>8})}get(a){return this.objectData[a-768>>>5]}static setupProps(){const a=(...a)=>({get(){let b=0;for(const c of a){const [a,d=255,f=0]=c;b|=(this.objectData[a-768>>>5]&d)>>>(0>f?0:f)<<(0>f?-f:0)}return b},set(b){for(const c of a){const [a,
d=255,f=0]=c;{const c=a-768>>>5;this.objectData[c]=this.objectData[c]&~d|b>>>(0>f?-f:0)<<(0>f?0:f)&d}}}});Object.defineProperties(this.prototype,{metasprite:a([768]),collisionPlane:a([928,240,4]),hitbox:a([1056,64,2],[928,15]),hp:a([960]),atk:a([992]),def:a([1024]),level:a([1056,31]),child:a([1088]),terrainSusceptibility:a([1120]),immobile:a([1184,128,7]),action:a([1184,127]),replacement:a([1216]),goldDrop:a([1280,240,4]),elements:a([1280,15]),expReward:a([1312]),attackType:a([1344])})}parents(){return this.rom.monsters.filter((a)=>
a.child&&this.rom.adHocSpawns[a.child].object==this.id)}locations(){return this.rom.locations.filter((a)=>a.valid&&a.spawns.some((a)=>a.isMonster()&&a.monsterId===this.id))}palettes(a){if(34==this.action)return[3];let b=this.objectData[0];42==this.action&&(b=this.objectData[31]|1);41==this.action&&(b=107);38==this.action&&(b=156);a=(void 0===a?0:a)&&this.child?this.rom.metasprites[this.rom.objects[this.rom.adHocSpawns[this.child].object].objectData[0]]:null;return[...new Set([...this.rom.metasprites[b].palettes(),
...a?a.palettes():[]])]}}ObjectData$$module$rom.setupProps();
class Metasprite$$module$rom extends Entity$$module$rom$entity{constructor(a,b){super(a,b);this.base=addr$$module$rom$util(a.prg,230492+(this.id<<1),196608);this.valid=196608<this.base;if(255==a.prg[this.base]){const c=addr$$module$rom$util(a.prg,this.base+1);for(let b=0;256>b;b++)if(addr$$module$rom$util(a.prg,230492+(b<<1))==c){this.mirrored=b;break}if(null==this.mirrored)throw Error("could not find mirrored sprite for "+b.toString(16));this.frames=this.frameMask=this.size=0;this.sprites=[]}else this.mirrored=
null,this.size=a.prg[this.base],this.frameMask=a.prg[this.base+1],this.frames=this.frameMask+1,this.sprites=seq$$module$rom$util(this.frames,(b)=>{b=this.base+2+4*b*this.size;const c=[];for(let d=0;d<this.size&&128!=a.prg[b+4*d];d++)c.push(slice$$module$rom$util(a.prg,b+4*d,4));return c})}palettes(){if(!this.valid)return[];let a=this;a.mirrored&&(a=this.rom.metasprites[a.mirrored]);const b=new Set;for(const c of a.sprites)for(let a of c){let [c,,d]=a;if(128==c)break;b.add(d&3)}return[...b]}}
class DataTable$$module$rom extends Array{constructor(a,b,c,d,e){e=void 0===e?1<d?(...a)=>a:(a)=>a:e;super(c);this.rom=a;this.base=b;this.count=c;this.width=d;for(let g=0;g<c;g++)this[g]=e(...slice$$module$rom$util(a.prg,b+g*d,d))}}
class AddressTable$$module$rom extends Array{constructor(a,b,c,d,e){e=void 0===e?(a)=>a:e;super(c);this.rom=a;this.base=b;this.count=c;this.offset=d;this.addresses=seq$$module$rom$util(this.count,(c)=>addr$$module$rom$util(a.prg,b+2*c,d));for(let a=0;a<c;a++)this[a]=e(this.addresses[a],a,this.addresses)}}
class Message$$module$rom{constructor(a,b,c,d){this.messages=a;this.part=b;this.id=c;this.addr=d;b=a.rom.prg;c=[];for(this.bytes=[];b[d];d++){let e=b[d];this.bytes.push(e);if(1!=e)if(2==e)c.push("\n");else if(3==e)c.push("\u25bc\n");else if(4==e)c.push("SIMEA");else if(8==e)c.push("ITEM");else if(5<=e&&9>=e){const g=b[++d];9==e?c.push(" ".repeat(g)):(c.push(a.extraWords[e][g]),PUNCTUATION$$module$rom[String.fromCharCode(b[d+1])]||c.push(" "))}else if(128<=e)c.push(a.basicWords[e-128]),PUNCTUATION$$module$rom[String.fromCharCode(b[d+
1])]||c.push(" ");else if(32<=e)c.push(String.fromCharCode(e));else throw Error(`Non-exhaustive switch: ${e} at ${d.toString(16)}`);}this.text=c.join("")}}const PUNCTUATION$$module$rom={"\x00":!0,".":!0,",":!0,_:!0,":":!0,"!":!0,"?":!0,"'":!0," ":!0};
class Messages$$module$rom{constructor(a){this.rom=a;const b=(b)=>readString$$module$rom$util(a.prg,b);this.basicWords=new AddressTable$$module$rom(a,166144,128,131072,b);this.extraWords={5:new AddressTable$$module$rom(a,166400,10,131072,b),6:new AddressTable$$module$rom(a,166420,36,131072,b),7:new AddressTable$$module$rom(a,166492,74,131072,b)};this.banks=new DataTable$$module$rom(a,164862,36,1);this.parts=new AddressTable$$module$rom(a,164898,34,131072,(b,d,e)=>new AddressTable$$module$rom(a,b,
33==d?3:e[d+1]-b>>>1,(this.banks[d]<<13)-40960,(a,b)=>new Message$$module$rom(this,d,b,a)))}}
class Rom$$module$rom{constructor(a){this.prg=a.subarray(16,262160);this.chr=a.subarray(262160);this.screens=seq$$module$rom$util(259,(a)=>new Screen$$module$rom$screen(this,a));this.tilesets=seq$$module$rom$util(12,(a)=>new Tileset$$module$rom$tileset(this,a<<2|128));this.tileEffects=seq$$module$rom$util(11,(a)=>new TileEffects$$module$rom$tileeffects(this,a+179));this.triggers=seq$$module$rom$util(67,(a)=>new Trigger$$module$rom$trigger(this,128|a));this.patterns=seq$$module$rom$util(this.chr.length>>
4,(a)=>new Pattern$$module$rom$pattern(this,a));this.palettes=seq$$module$rom$util(256,(a)=>new Palette$$module$rom$palette(this,a));this.locations=seq$$module$rom$util(256,(a)=>new Location$$module$rom$location(this,a));this.tileAnimations=seq$$module$rom$util(4,(a)=>new TileAnimation$$module$rom$tileanimation(this,a));this.hitboxes=seq$$module$rom$util(24,(a)=>new Hitbox$$module$rom$hitbox(this,a));this.objects=seq$$module$rom$util(256,(a)=>new ObjectData$$module$rom(this,a));this.adHocSpawns=seq$$module$rom$util(96,
(a)=>new AdHocSpawn$$module$rom(this,a));this.metasprites=seq$$module$rom$util(256,(a)=>new Metasprite$$module$rom(this,a));this.messages=new Messages$$module$rom(this);this.itemGets=seq$$module$rom$util(113,(a)=>new ItemGet$$module$rom(this,a));this.npcs=seq$$module$rom$util(205,(a)=>new Npc$$module$rom$npc(this,a))}get monsters(){let a=new Set;for(const b of this.locations)if(b.valid&&b.hasSpawns)for(const c of b.spawns)0==(c[2]&7)&&a.add(this.objects[c[3]+80&255]);a=[...a];a.sort((a,c)=>a.id-c.id);
return a}get projectiles(){let a=new Set;for(const b of this.monsters)b.child&&a.add(this.objects[this.adHocSpawns[b.child].object]);a=[...a];a.sort((a,c)=>a.id-c.id);return a}get monsterGraphics(){const a={};for(const b of this.locations)if(b.valid&&b.hasSpawns)for(const c of b.spawns)if(!(c[2]&7)){const d=c[2]&128?1:0,e=(c[3]+80).toString(16).padStart(2,0);(a[e]=a[e]||{})[`${d}:${b.spritePatterns[d].toString(16)}:${b.spritePalettes[d].toString(16)}`]={slot:d,pat:b.spritePatterns[d],pal:b.spritePalettes[d]}}return a}get locationMonsters(){const a=
{};for(const b of this.locations){if(!b.valid||!b.hasSpawns)continue;const c=a["$"+b.id.toString(16).padStart(2,0)]={};for(const a of b.spawns)if(!(a[2]&7)){const b=a[2]&128?1:0,d=a[3]+80;c[`${b}:${d.toString(16)}`]=(c[`${b}:${d.toString(16)}`]||0)+1}}return a}static load(a){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const b=yield pickFile$$module$rom();a&&(yield a(b));return new Rom$$module$rom(b)})}writeData(){const a=this;return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){const b=
new Writer$$module$rom$writer(a.prg);b.alloc(83192,97792);b.alloc(103417,113408);b.alloc(123392,123888);b.alloc(116602,117085);a.prg[246387]=a.prg[246392]=190;a.prg[246399]=a.prg[246404]=191;const c=[];for(const d of a.locations)d.valid&&c.push(d.write(b));for(const c of a.objects)c.write(b,114176);for(const c of a.hitboxes)c.write(b);for(const d of a.triggers)d.used&&c.push(d.write(b));for(const d of a.npcs)d.used&&c.push(d.write(b));for(const c of a.tilesets)c.write(b);for(const c of a.tileEffects)c.write(b);
for(const c of a.screens)c.write(b);c.push(b.commit());return Promise.all(c).then(()=>{})})}analyzeTiles(){}disjointTilesets(){var a=[];for(var b of this.locations)if(b.valid){var c=b.tileset,d=b.extended?256:0;for(const e of b.screens)for(const b of e)(a[b+d]||(a[b+d]=new Set)).add(c)}b=Array(256).fill(0).map(()=>new UnionFind$$module$unionfind);for(c=0;c<a.length;c++)if(a[c]){d=new Set;for(var e of this.screens[c].tiles)for(const a of e)d.add(a);for(const e of d)b[e].union([...a[c]])}for(a=0;a<
b.length;a++)e=b[a].sets().map((a)=>[...a].map((a)=>a.toString(16)).join(" ")).join(" | "),console.log(`Tile ${a.toString(16).padStart(2,0)}: ${e}`)}swapMetatiles(a,...b){var c=new Map,d=seq$$module$rom$util(256);const e=new Map,g=(a)=>Array.isArray(a)?a[0]:0>a?~a:a;for(var f of b){for(var k=0;k<f.length-1;k++)Array.isArray(f[k])&&(e.set(f[k][0],f[k][1]),f[k]=f[k][0]);for(k=0;k<f.length-1;k++){let a=f[k],b=f[k+1];0>a||0>b||(c.set(b,a),d[b]=a)}}f=new Set;c=new Set;a=new Set(a);for(var h of this.locations)if(h.valid&&
a.has(h.tileset)){c.add(h.tileEffects);for(const a of h.allScreens())f.add(a)}for(var n of f)for(var m of n.tiles)for(h=0;h<m.length;h++)m[h]=d[m[h]];for(var q of a){a=this.tilesets[(q&127)>>>2];for(var p of b)for(d=0;d<p.length-1;d++){n=g(p[d]);m=g(p[d+1]);for(h=0;4>h;h++)a.tiles[h][n]=a.tiles[h][m];a.attrs[n]=a.attrs[m];if(32>m&&a.alternates[m]!=m){if(32<=n)throw Error(`Cannot unflag: ${q} ${n} ${m} ${a.alternates[m]}`);a.alternates[n]=a.alternates[m]}}for(var l of e){const [b,c]=l;a.alternates[b]=
c}}for(const d of c){q=this.tileEffects[d-179];for(const c of b)for(p=0;p<c.length-1;p++)l=g(c[p]),a=g(c[p+1]),q.effects[l]=q.effects[a];for(const a of e.keys())q.effects[a]|=8}}}
const pickFile$$module$rom=()=>new Promise((a,b)=>{if("#reset"!=window.location.hash){const b=window.localStorage.getItem("rom");if(b)return a(Uint8Array.from(Array(b.length/2).fill(0).map((a,c)=>Number.parseInt(b[2*c]+b[2*c+1],16))))}const c=document.createElement("input");document.body.appendChild(c);c.type="file";c.addEventListener("change",()=>{const b=c.files[0],e=new FileReader;e.addEventListener("loadend",()=>{const b=new Uint8Array(e.result),d=Array.from(b,(a)=>a.toString(16).padStart(2,0)).join("");
window.localStorage.setItem("rom",d);c.remove();a(b)});e.readAsArrayBuffer(b)})}),EXPECTED_CRC32$$module$rom=466849842;var module$rom={};module$rom.Rom=Rom$$module$rom;module$rom.EXPECTED_CRC32=EXPECTED_CRC32$$module$rom;const IM1$$module$random=2147483563,IM2$$module$random=2147483399,AM$$module$random=1/IM1$$module$random,IMM1$$module$random=IM1$$module$random-1,IA1$$module$random=40014,IA2$$module$random=40692,IQ1$$module$random=53668,IQ2$$module$random=52774,IR1$$module$random=12211,IR2$$module$random=3791,NTAB$$module$random=32,NDIV$$module$random=1+Math.floor(IMM1$$module$random/NTAB$$module$random),EPS$$module$random=1.2E-7,RNMX$$module$random=1-EPS$$module$random;
class Random$$module$random{constructor(a=Math.floor(4294967296*Math.random())){this.seed(a)}seed(a){this.idum2=this.idum=Math.max(1,Math.floor(a));this.iy=0;this.iv=Array(NTAB$$module$random).fill(0);for(a=NTAB$$module$random+7;0<=a;a--){const b=Math.floor(this.idum/IQ1$$module$random);this.idum=IA1$$module$random*(this.idum-b*IQ1$$module$random)-b*IR1$$module$random;0>this.idum&&(this.idum+=IM1$$module$random);a<NTAB$$module$random&&(this.iv[a]=this.idum)}this.iy=this.iv[0]}next(){var a=Math.floor(this.idum/
IQ1$$module$random);this.idum=IA1$$module$random*(this.idum-a*IQ1$$module$random)-a*IR1$$module$random;0>this.idum&&(this.idum+=IM1$$module$random);a=Math.floor(this.idum2/IQ2$$module$random);this.idum2=IA2$$module$random*(this.idum2-a*IQ2$$module$random)-a*IR2$$module$random;0>this.idum2&&(this.idum2+=IM2$$module$random);a=Math.floor(this.iy/NDIV$$module$random);this.iy=this.iv[a]-this.idum2;this.iv[a]=this.idum;1>this.iy&&(this.iy+=IMM1$$module$random);return Math.min(AM$$module$random*this.iy,
RNMX$$module$random)}nextInt(a){return Math.floor(this.next()*a)}shuffle(a){for(let b=a.length;b;){const c=this.nextInt(b--);[a[b],a[c]]=[a[c],a[b]]}return a}}var module$random={};module$random.Random=Random$$module$random;const STATUS$$module$version="unstable",VERSION$$module$version="defrag",LABEL$$module$version="defrag 90db3b8",HASH$$module$version="90db3b8a6c15454135fe698328bb0972af53a48b",DATE$$module$version=new Date(1556148373E3);var module$version={};module$version.STATUS=STATUS$$module$version;module$version.VERSION=VERSION$$module$version;module$version.LABEL=LABEL$$module$version;module$version.HASH=HASH$$module$version;module$version.DATE=DATE$$module$version;var $jscompDefaultExport$$module$patch={apply(a,b,c){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){let d;b.seed||(b.seed=parseSeed$$module$patch("").toString(16),window.location.hash+="&seed="+b.seed);d=b.flags?new FlagSet$$module$flagset(b.flags):new FlagSet$$module$flagset("Em Gt Mr Rlpt Sbk Sct Sm Tasd");for(const a in b)"false"===b[a]&&(b[a]=!1);yield shuffle$$module$patch(a,parseSeed$$module$patch(b.seed),d,new FetchReader$$module$fetchreader(c))})}};
const parseSeed$$module$patch=(a)=>a?/^[0-9a-f]{1,8}$/i.test(a)?Number.parseInt(a,16):crc32$$module$crc32(a):Math.floor(4294967296*Math.random());class Reader$$module$patch{read(a){}}
const shuffle$$module$patch=(a,b,c,d,e,g)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){if("number"!==typeof b)throw Error("Bad seed");var f=crc32$$module$crc32(b.toString(16).padStart(8,0)+String(c))>>>0;const k={_ALLOW_TELEPORT_OUT_OF_TOWER:!0,_AUTO_EQUIP_BRACELET:c.autoEquipBracelet(),_BARRIER_REQUIRES_CALM_SEA:c.barrierRequiresCalmSea(),_BUFF_DEOS_PENDANT:c.buffDeosPendant(),_CHECK_FLAG0:!0,_DISABLE_SHOP_GLITCH:c.disableShopGlitch(),_DISABLE_STATUE_GLITCH:c.disableStatueGlitch(),_DISABLE_SWORD_CHARGE_GLITCH:c.disableSwordChargeGlitch(),
_DISABLE_WILD_WARP:!1,_DISPLAY_DIFFICULTY:!0,_EXTRA_PITY_MP:!0,_FIX_OPEL_STATUE:!0,_FIX_SHAKING:!0,_FIX_VAMPIRE:!0,_LEATHER_BOOTS_GIVE_SPEED:c.leatherBootsGiveSpeed(),_NERF_WILD_WARP:c.nerfWildWarp(),_NERF_FLIGHT:!0,_NEVER_DIE:c.neverDie(),_NORMALIZE_SHOP_PRICES:!0,_PITY_HP_AND_MP:!0,_PROGRESSIVE_BRACELET:!0,_RABBIT_BOOTS_CHARGE_WHILE_WALKING:c.rabbitBootsChargeWhileWalking(),_REVERSIBLE_SWAN_GATE:!0,_REQUIRE_HEALED_DOLPHIN_TO_RIDE:c.requireHealedDolphinToRide(),_SAHARA_RABBITS_REQUIRE_TELEPATHY:c.saharaRabbitsRequireTelepathy(),
_TELEPORT_ON_THUNDER_SWORD:c.teleportOnThunderSword()},h=new Assembler$$module$6502,n=(b)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){h.assemble(yield d.read(b),b);h.patchRom(a)});var m=Object.keys(k).filter((a)=>k[a]).map((a)=>`define ${a} 1\n`).join("");h.assemble(m,"flags.s");yield n("preshuffle.s");f=new Random$$module$random(f);yield shuffle2$$module$depgraph(a,f,e,c,g);rescaleShops$$module$patch(a,h,c.bargainHunting()?f:null);m=new Rom$$module$rom(a);rescaleMonsters$$module$patch(a,
m);c.shuffleMonsters()&&shuffleMonsters$$module$patch(a,m,f);identifyKeyItemsForDifficultyBuffs$$module$patch(m);c.doubleBuffMedicalHerb?(a[115996]*=2,a[115962]*=3):c.singleBuffMedicalHerb()&&(a[115996]+=16,a[115962]*=2);c.connectLimeTreeToLeaf()&&connectLimeTreeToLeaf$$module$patch(m);addCordelWestTriggers$$module$patch(m,c);c.disableRabbitSkip()&&fixRabbitSkip$$module$patch(m);c.storyMode()&&storyMode$$module$patch(m);c.chargeShotsOnly()&&disableStabs$$module$patch(m);c.orbsOptional()&&orbsOptional$$module$patch(m);
closeCaveEntrances$$module$patch(m,c);misc$$module$patch(m,c);yield n("postshuffle.s");updateDifficultyScalingTables$$module$patch(a,c,h);updateCoinDrops$$module$patch(a,c);shuffleRandomNumbers$$module$patch(a,f);yield m.writeData();return stampVersionSeedAndHash$$module$patch(a,b,c)}),misc$$module$patch=(a,b)=>{},closeCaveEntrances$$module$patch=(a,b)=>{a.swapMetatiles([144],[7,[1,0],-194],[14,[2,0],-194],[32,[3,10],-216],[33,[4,10],-216]);a.swapMetatiles([148,156],[104,[1,0],-194],[131,[2,0],-194],
[136,[3,10],-216],[137,[4,10],-216]);a.screens[10].tiles[3][8]=1;a.screens[10].tiles[3][9]=2;a.screens[10].tiles[4][8]=3;a.screens[10].tiles[4][9]=4;a.screens[21].tiles[7][9]=1;a.screens[21].tiles[7][10]=2;a.screens[21].tiles[8][9]=3;a.screens[21].tiles[8][10]=4;a.screens[25].tiles[4][8]=1;a.screens[25].tiles[4][9]=2;a.screens[25].tiles[5][8]=3;a.screens[25].tiles[5][9]=4;a.screens[62].tiles[5][6]=1;a.screens[62].tiles[5][7]=2;a.screens[62].tiles[6][6]=3;a.screens[62].tiles[6][7]=4;var c=[[3,48],
[20,48],[21,48],[64,0],[64,20],[65,116],[71,16],[148,0],[152,65]];for(const b of c){const [c,d]=b;a.locations[c].flags.push(Flag$$module$rom$location.of({yx:d,flag:751}))}c=(b,c,g)=>{for(const d of a.locations[b].flags)if(d.yx==c){d.flag=g;return}throw Error(`Could not find flag to replace at ${b}:${c}`);};b.paralysisRequiresPrisonKey()&&(c(20,48,750),c(21,48,750),c(64,0,728),b=Spawn$$module$rom$location.of({y:96,x:96,type:4,id:44}),c=Spawn$$module$rom$location.of({y:112,x:112,type:2,id:173}),a.locations[64].spawns.splice(1,
0,b),a.locations[64].spawns.push(c))},eastCave$$module$patch=(a)=>{},addCordelWestTriggers$$module$patch=(a,b)=>{for(const c of a.locations[21].spawns)(c.isChest()||b.disableTeleportSkip()&&c.isTrigger())&&a.locations[20].spawns.push(c.clone())},fixRabbitSkip$$module$patch=(a)=>{for(const b of a.locations[40].spawns)b.isTrigger()&&134===b.id&&1856===b.x&&(b.x+=16,b.y+=16)},storyMode$$module$patch=(a)=>{const b=a.npcs[203].spawnConditions[166];b.push(~a.npcs[194].spawnConditions[40][0]);b.push(~a.npcs[132].spawnConditions[110][0]);
b.push(~a.triggers[26].conditions[1]);b.push(~a.npcs[197].spawnConditions[169][0]);b.push(~a.npcs[198].spawnConditions[172][0]);b.push(~a.npcs[199].spawnConditions[185][0]);b.push(~a.npcs[200].spawnConditions[182][0]);b.push(~a.npcs[203].spawnConditions[159][0]);b.push(512);b.push(513);b.push(514);b.push(515)},disableStabs$$module$patch=(a)=>{for(const b of[8,9,39])a.objects[b].collisionPlane=0},orbsOptional$$module$patch=(a)=>{for(const b of[16,20,24,29])a.objects[b].terrainSusceptibility&=-5,a.objects[b].level=
2},connectLimeTreeToLeaf$$module$patch=(a)=>{const b=a.locations[3];a=a.locations[66];b.screens[5][4]=16;a.screens[1][0]=26;a.screens[2][0]=12;const c=b.entrances.push(Entrance$$module$rom$location.of({x:1263,y:1400}))-1,d=a.entrances.push(Entrance$$module$rom$location.of({x:16,y:448}))-1;b.exits.push(Exit$$module$rom$location.of({x:1264,y:1376,dest:66,entrance:d}),Exit$$module$rom$location.of({x:1264,y:1392,dest:66,entrance:d}));a.exits.push(Exit$$module$rom$location.of({x:0,y:432,dest:3,entrance:c}),
Exit$$module$rom$location.of({x:0,y:448,dest:3,entrance:c}))},stampVersionSeedAndHash$$module$patch=(a,b,c)=>{const d=crc32$$module$crc32(a),e=d.toString(16).padStart(8,0).toUpperCase(),g="unstable"==STATUS$$module$version?HASH$$module$version.substring(0,7).padStart(7,0).toUpperCase()+"     ":VERSION$$module$version.substring(0,12).padEnd(12," ");b=b.toString(16).padStart(8,0).toUpperCase();const f=(b,c)=>{for(let d=0;d<c.length;d++)a[b+16+d]=c.charCodeAt(d)},k=(a,b)=>{const c=[];for(let d=0;d<a.length||
d<b.length;d++)c.push(a[d]||" "),c.push(b[d]||" ");return c.join("")};f(161743,k("  VERSION     SEED      ",`  ${g}${b}`));b=String(c);let h;if(46<b.length){if(92<b.length)throw Error("Flag string way too long!");h=b.substring(46,92).padEnd(46," ");b=b.substring(0,46)}b=b.padEnd(46," ");f(161791,k(b.substring(0,23),b.substring(23)));h&&f(161839,k(h.substring(0,23),h.substring(23)));f(161925,k(e.substring(0,4),e.substring(4)));f(153366,"RANDOMIZER");"unstable"==STATUS$$module$version&&f(153404,"BETA");
return d},patchBytes$$module$patch=(a,b,c)=>{for(let d=0;d<c.length;d++)a[b+16+d]=c[d]},patchWords$$module$patch=(a,b,c)=>{for(let d=0;d<2*c.length;d+=2)a[b+16+d]=c[d>>>1]&255,a[b+17+d]=c[d>>>1]>>>8},updateCoinDrops$$module$patch=(a,b)=>{b.disableShopGlitch()?patchWords$$module$patch(a,216030,[0,5,10,15,25,40,65,105,170,275,445,600,700,800,900,1E3]):patchWords$$module$patch(a,216030,[0,1,2,4,8,16,30,50,100,200,300,400,500,600,700,800])},updateDifficultyScalingTables$$module$patch=(a,b,c)=>{const d=
Array(48).fill(0).map((a,b)=>b);patchBytes$$module$patch(a,c.expand("DiffAtk"),d.map((a)=>Math.round(40+15*a/4)));patchBytes$$module$patch(a,c.expand("DiffDef"),d.map((a)=>4*a));const e=b.decreaseEnemyDamage()?16:48,g=b.decreaseEnemyDamage()?6:5.5;patchBytes$$module$patch(a,c.expand("DiffHP"),d.map((a)=>Math.min(255,e+Math.round(a*g))));const f=b.expScalingFactor();patchBytes$$module$patch(a,c.expand("DiffExp"),d.map((a)=>{a=Math.floor(4*Math.pow(2,(16+9*a)/32)*f);return 128>a?a:Math.min(255,128+
(a>>4))}));patchBytes$$module$patch(a,216E3,[0,2,6,10,14,18,32,24,20,0,2,6,10,14,18,16,32,20])},rescaleShops$$module$patch=(a,b,c)=>{const d=b.expand("BasePrices");var e=b.expand("InnPrices");const g={prices:138836,items:138792},f={prices:138704,items:138660},k=Array(48).fill(0).map((a,b)=>b);patchBytes$$module$patch(a,b.expand("ToolShopScaling"),k.map((a)=>Math.round(8*Math.pow(2,a/10))));patchBytes$$module$patch(a,b.expand("ArmorShopScaling"),k.map((a)=>Math.round(8*Math.pow(2,(47-a)/12))));for(var h of[g,
f]){const {prices:d,items:e}=h;for(b=0;44>b;b++)a[d+b+16]=BASE_PRICES$$module$patch[a[e+b+16]]?c?c.nextInt(32)+17:32:0}for(h=0;11>h;h++)a[e+h+16]=c?c.nextInt(40)+13:32;c=(b,c)=>{a[d+2*(b-13)+16]=c&255;a[d+2*(b-13)+17]=c>>>8};for(e=13;39>e;e++)c(e,BASE_PRICES$$module$patch[e]);c(39,20)},BASE_PRICES$$module$patch={13:4,14:16,15:50,16:325,17:1E3,18:2E3,19:4E3,21:6,22:20,23:75,24:250,25:1E3,26:4800,29:25,30:30,31:45,32:40,33:36,34:200,35:150,36:80,38:300},rescaleMonsters$$module$patch=(a,b)=>{for(var c of SCALED_MONSTERS$$module$patch.keys())for(const a in b.objects){if(SCALED_MONSTERS$$module$patch.has(a))return;
b.objects[c].objectDataBase==b.objects[a].objectDataBase&&(SCALED_MONSTERS$$module$patch[a]=SCALED_MONSTERS$$module$patch[c])}for(const d of SCALED_MONSTERS$$module$patch){const [e,{sdef:g,swrd:f,hits:k,satk:h,dgld:n,sexp:m}]=d;a=b.objects[e].objectData;c=[87,94,104,125,136,151,155,158].includes(e)?1:0;a[2]|=128;a[6]=k;a[7]=h;a[8]=g|f<<4;a[9]=a[9]&224|c;a[16]=a[16]&15|n<<4;a[17]=m}b.objects[125].objectData[16]|=8},shuffleMonsters$$module$patch=(a,b,c,d)=>{a=new MonsterPool$$module$patch({});for(const c of b.locations)c.valid&&
a.populate(c);a.shuffle(c)},identifyKeyItemsForDifficultyBuffs$$module$patch=(a)=>{for(const b of a.itemGets){const c=ITEMS$$module$patch.get(b.item);if(c&&c.key){if(!b.table)throw Error(`No table for ${c.name}`);if(255==b.table[b.table.length-1])b.table[b.table.length-1]=254;else throw Error(`Expected FF at end of ItemGet table: ${b.id.toString(16)}: ${Array.from(b.table).map((a)=>a.toString(16).padStart(2,0)).join(" ")}`);b.write(a)}}},SCALED_MONSTERS$$module$patch=new Map([[63,"p","Sorceror shot",
,,,19,,,],[75,"m","wraith??",2,,2,22,4,61],[79,"m","wraith",1,,2,20,4,61],[80,"m","Blue Slime",,,1,16,2,32],[81,"m","Weretiger",,,1,21,4,40],[82,"m","Green Jelly",4,,3,16,4,36],[83,"m","Red Slime",6,,4,16,4,48],[84,"m","Rock Golem",6,,11,24,6,85],[85,"m","Blue Bat",,,,4,,32],[86,"m","Green Wyvern",4,,4,24,6,52],[87,"b","Vampire",3,,12,18,,,],[88,"m","Orc",3,,4,21,4,57],[89,"m","Red Flying Swamp Insect",3,,1,21,4,57],[90,"m","Blue Mushroom",2,,1,21,4,44],[91,"m","Swamp Tomato",3,,2,35,4,52],[92,"m",
"Flying Meadow Insect",3,,3,23,4,81],[93,"m","Swamp Plant",,,,,,36],[94,"b","Insect",,1,8,6,,,],[95,"m","Large Blue Slime",5,,3,20,4,52],[96,"m","Ice Zombie",5,,7,14,4,57],[97,"m","Green Living Rock",,,1,9,4,28],[98,"m","Green Spider",4,,4,22,4,44],[99,"m","Red/Purple Wyvern",3,,4,30,4,65],[100,"m","Draygonia Soldier",6,,11,36,4,89],[101,"m","Ice Entity",3,,2,24,4,52],[102,"m","Red Living Rock",,,1,13,4,40],[103,"m","Ice Golem",7,2,11,28,4,81],[104,"b","Kelbesque",4,6,12,29,,,],[105,"m","Giant Red Slime",
7,,40,90,4,102],[106,"m","Troll",2,,3,24,4,65],[107,"m","Red Jelly",2,,2,14,4,44],[108,"m","Medusa",3,,4,36,8,77],[109,"m","Red Crab",2,,1,21,4,44],[110,"m","Medusa Head",,,1,29,4,36],[111,"m","Evil Bird",,,2,30,6,65],[113,"m","Red/Purple Mushroom",3,,5,19,6,69],[114,"m","Violet Earth Entity",3,,3,18,6,61],[115,"m","Mimic",,,3,26,15,73],[116,"m","Red Spider",3,,4,22,6,48],[117,"m","Fishman",4,,6,19,5,61],[118,"m","Jellyfish",,,3,14,3,48],[119,"m","Kraken",5,,11,25,7,73],[120,"m","Dark Green Wyvern",
4,,5,21,5,61],[121,"m","Sand Monster",5,,8,6,4,57],[123,"m","Wraith Shadow 1",,,,9,7,44],[124,"m","Killer Moth",,,2,35,,77],[125,"b","Sabera",3,7,13,24,,,],[128,"m","Draygonia Archer",1,,3,20,6,61],[129,"m","Evil Bomber Bird",,,1,19,4,65],[130,"m","Lavaman/blob",3,,3,24,6,85],[132,"m","Lizardman (w/ flail(",2,,3,30,6,81],[133,"m","Giant Eye",3,,5,33,4,81],[134,"m","Salamander",2,,4,29,8,77],[135,"m","Sorceror",2,,5,31,6,65],[136,"b","Mado",4,8,10,30,,,],[137,"m","Draygonia Knight",2,,3,24,4,77],[138,
"m","Devil",,,1,18,4,52],[139,"b","Kelbesque 2",4,6,11,27,,,],[140,"m","Wraith Shadow 2",,,,17,4,48],[144,"b","Sabera 2",5,7,21,27,,,],[145,"m","Tarantula",3,,3,21,6,73],[146,"m","Skeleton",,,4,30,6,69],[147,"b","Mado 2",4,8,11,25,,,],[148,"m","Purple Giant Eye",4,,10,23,6,102],[149,"m","Black Knight (w/ flail)",3,,7,26,6,89],[150,"m","Scorpion",3,,5,29,2,73],[151,"b","Karmine",4,,14,26,,,],[152,"m","Sandman/blob",3,,5,36,6,98],[153,"m","Mummy",5,,19,36,6,110],[154,"m","Tomb Guardian",7,,60,37,6,
106],[155,"b","Draygon",5,6,16,41,,,],[158,"b","Draygon 2",7,6,28,40,,,],[160,"m","Ground Sentry (1)",4,,12,26,,],[161,"m","Tower Defense Mech (2)",5,,16,36,,],[162,"m","Tower Sentinel",,,2,,,],[163,"m","Air Sentry",3,,4,26,,],[164,"b","Dyna",6,5,16,,,,],[165,"b","Vampire 2",3,,12,27,,,],[180,"b","dyna pod",15,,255,26,,,],[184,"p","dyna counter",,,,26,,,],[185,"p","dyna laser",,,,26,,,],[186,"p","dyna bubble",,,,36,,,],[188,"m","vamp2 bat",,,,16,,15],[191,"p","draygon2 fireball",,,,26,,,],[193,"m",
"vamp1 bat",,,,16,,15],[195,"p","giant insect spit",,,,35,,,],[196,"m","summoned insect",4,,2,42,,98],[197,"p","kelby1 rock",,,,22,,,],[198,"p","sabera1 balls",,,,19,,,],[199,"p","kelby2 fireballs",,,,11,,,],[200,"p","sabera2 fire",,,1,6,,,],[201,"p","sabera2 balls",,,,17,,,],[202,"p","karmine balls",,,,25,,,],[203,"p","sun/moon statue fireballs",,,,39,,,],[204,"p","draygon1 lightning",,,,37,,,],[205,"p","draygon2 laser",,,,36,,,],[206,"p","draygon2 breath",,,,36,,,],[224,"p","evil bomber bird bomb",
,,,2,,,],[226,"p","summoned insect bomb",,,,47,,,],[227,"p","paralysis beam",,,,23,,,],[228,"p","stone gaze",,,,33,,,],[229,"p","rock golem rock",,,,24,,,],[230,"p","curse beam",,,,10,,,],[231,"p","mp drain web",,,,11,,,],[232,"p","fishman trident",,,,15,,,],[233,"p","orc axe",,,,24,,,],[234,"p","Swamp Pollen",,,,37,,,],[235,"p","paralysis powder",,,,17,,,],[236,"p","draygonia solider sword",,,,28,,,],[237,"p","ice golem rock",,,,20,,,],[238,"p","troll axe",,,,27,,,],[239,"p","kraken ink",,,,24,,
,],[240,"p","draygonia archer arrow",,,,12,,,],[241,"p","??? unused",,,,16,,,],[242,"p","draygonia knight sword",,,,9,,,],[243,"p","moth residue",,,,19,,,],[244,"p","ground sentry laser",,,,13,,,],[245,"p","tower defense mech laser",,,,23,,,],[246,"p","tower sentinel laser",,,,8,,,],[247,"p","skeleton shot",,,,11,,,],[248,"p","lavaman shot",,,,14,,,],[249,"p","black knight flail",,,,18,,,],[250,"p","lizardman flail",,,,21,,,],[252,"p","mado shuriken",,,,36,,,],[253,"p","guardian statue missile",,
,,23,,,],[254,"p","demon wall fire",,,,23,,,]].map((a)=>{var [b,c,d,e=0,g=0,f=0,k=0,h=0,n=0]=a;return[b,{id:b,type:c,name:d,sdef:e,swrd:g,hits:f,satk:k,dgld:h,sexp:n}]}));
class MonsterPool$$module$patch{constructor(a){this.report=a;this.monsters=[];this.used=[];this.locations=[]}populate(a){var b=MONSTER_ADJUSTMENTS$$module$patch[a.id]||{},c=Object.assign({},b);b=b.skip;c=(delete c.maxFlyers,delete c.nonFlyers,delete c.skip,delete c.fixedSlots,c);for(var d in c)throw Error(`Unexpected property '${d}' in MONSTER_ADJUSTMENTS[${a.id}]`);if(!0!==b&&a.spritePatterns&&a.spritePalettes){d=[];c=[];var e=12;for(const b of a.spawns){++e;if(!b.isMonster())continue;const h=b.monsterId;
if(h in UNTOUCHED_MONSTERS$$module$patch||!SCALED_MONSTERS$$module$patch.has(h)||"m"!=SCALED_MONSTERS$$module$patch.get(h).type)continue;var g=a.rom.objects[h];if(!g)continue;const k=b.patternBank,m=a.spritePatterns[k];var f=g.palettes(!0);g=f.includes(2)?a.spritePalettes[0]:null;f=f.includes(3)?a.spritePalettes[1]:null;d.push({id:h,pat:m,pal2:g,pal3:f,patBank:k});(this.report[`start-${h.toString(16)}`]=this.report[`start-${h.toString(16)}`]||[]).push("$"+a.id.toString(16));c.push(e)}d.length&&(b||
this.locations.push({location:a,slots:c}),this.monsters.push(...d))}}shuffle(a){this.report["pre-shuffle locations"]=this.locations.map((a)=>a.location.id);this.report["pre-shuffle monsters"]=this.monsters.map((a)=>a.id);a.shuffle(this.locations);a.shuffle(this.monsters);this.report["post-shuffle locations"]=this.locations.map((a)=>a.location.id);for(this.report["post-shuffle monsters"]=this.monsters.map((a)=>a.id);this.locations.length;){const {location:d,slots:e}=this.locations.pop();let g=this.report["$"+
d.id.toString(16).padStart(2,0)]=[];const {maxFlyers:f,nonFlyers:k={},fixedSlots:h={}}=MONSTER_ADJUSTMENTS$$module$patch[d.id]||{};let n=h.pat0||null,m=h.pat1||null,q=h.pal2||null,p=h.pal3||null,l=f,r=!1;for(const a of d.spawns)if(a.isChest()&&(r=!0),a.isMonster()){var b=a.monsterId;126==b||127==b||159==b?m=98:143==b&&(n=97)}if(21==d.id||71==d.id)r=!1;g.push(`Initial pass: ${[r,n,m,q,p].join(", ")}`);b=(a)=>{var b=FLYERS$$module$patch.has(a.id),c=MOTHS_AND_BATS$$module$patch.has(a.id);if(b){if(!l)return!1;
--l}if(null!=q&&null!=a.pal2&&q!=a.pal2||null!=p&&null!=a.pal3&&p!=a.pal3)return!1;var f=!r||TREASURE_CHEST_BANKS$$module$patch.has(a.pat);let h;if(d.rom.objects[a.id].child||RETAIN_SLOTS$$module$patch.has(a.id)){const b=(h=a.patBank)?m:n;if(null!=b&&b!=a.pat)return!1;if(h)m=a.pat;else if(f)n=a.pat;else return!1;g.push(`  Adding ${a.id.toString(16)}: pat(${h}) <-  ${a.pat.toString(16)}`)}else if(null==n&&f||n==a.pat)n=a.pat,h=0,g.push(`  Adding ${a.id.toString(16)}: pat0 <-  ${a.pat.toString(16)}`);
else if(null==m||m==a.pat)m=a.pat,h=1,g.push(`  Adding ${a.id.toString(16)}: pat1 <-  ${a.pat.toString(16)}`);else return!1;null!=a.pal2&&(q=a.pal2);null!=a.pal3&&(p=a.pal3);g.push(`    ${Object.keys(a).map((b)=>`${b}: ${a[b]&&a[b].toString(16)}`).join(", ")}`);g.push(`    pal: ${(a.pal2||0).toString(16)} ${(a.pal3||0).toString(16)}`);f=0;if(b||c)for(b=0;b<e.length;b++){if(e[b]in k){f=b;break}}else for(b=0;b<e.length;b++)if(!(e[b]in k)){f=b;break}(this.report[`mon-${a.id.toString(16)}`]=this.report[`mon-${a.id.toString(16)}`]||
[]).push("$"+d.id.toString(16));b=e[f];c=d.spawns[b-13];b in k&&(c.y+=16*k[b][0],c.x+=16*k[b][1]);c.patternBank=h;c.monsterId=a.id;g.push(`    slot ${b.toString(16)}: ${c}`);e.splice(f,1);return!0};if(l)for(var c=0;c<Math.min(40,this.monsters.length);c++)FLYERS$$module$patch.has(this.monsters[c].id)&&b(this.monsters[c])&&this.monsters.splice(c,1),a.shuffle(this.monsters);for(c=0;c<this.monsters.length&&e.length;c++)if(b(this.monsters[c])){const [a]=this.monsters.splice(c,1);FLYERS$$module$patch.has(a.id)||
this.used.push(a);c--}for(c=0;c<this.used.length&&e.length;c++)b(this.used[c])&&(this.used.push(...this.used.splice(c,1)),c--);null!=n&&(d.spritePatterns[0]=n);null!=m&&(d.spritePatterns[1]=m);null!=q&&(d.spritePalettes[0]=q);null!=p&&(d.spritePalettes[1]=p);if(e.length){g.push(`Failed to fill location ${d.id.toString(16)}: ${e.length} remaining`);for(const a of e)b=d.spawns[a-13],b.x=b.y=0}}}}
const FLYERS$$module$patch=new Set([89,92,110,111,129,138,163,196]),MOTHS_AND_BATS$$module$patch=new Set([85,93,124,188,193]),SWIMMERS$$module$patch=new Set([117,118]),STATIONARY$$module$patch=new Set([119,135]),TREASURE_CHEST_BANKS$$module$patch=new Set([94,95,96,97,100,101,102,103,104,105,106,108,109,110,111,112,116,117,118,119]),MONSTER_ADJUSTMENTS$$module$patch={[3]:{maxFlyers:2,fixedSlots:{pat1:96}},[7]:{nonFlyers:{[15]:[0,-3],[16]:[-10,0],[17]:[0,4]}},[20]:{maxFlyers:2},[21]:{maxFlyers:2},[26]:{maxFlyers:2,
fixedSlots:{pat1:79,pal3:35},nonFlyers:{[16]:[4,0],[17]:[5,0],[18]:[4,0],[19]:[5,0],[20]:[4,0],[21]:[4,0]}},[27]:{skip:!0},[32]:{maxFlyers:1},[33]:{maxFlyers:1,fixedSlots:{pat1:80}},[39]:{nonFlyers:{[13]:[0,16]}},[40]:{maxFlyers:1},[41]:{maxFlyers:1},[43]:{nonFlyers:{[20]:[32,-8]}},[64]:{maxFlyers:2,nonFlyers:{[19]:[12,-16]}},[65]:{maxFlyers:2,nonFlyers:{[21]:[0,-6]}},[66]:{maxFlyers:2,nonFlyers:{[13]:[0,8],[14]:[-8,8]}},[71]:{maxFlyers:1,nonFlyers:{[13]:[-8,-8]}},[74]:{maxFlyers:1,nonFlyers:{[14]:[4,
0],[15]:[0,-3],[16]:[0,4]}},[76]:{},[77]:{maxFlyers:1},[78]:{maxFlyers:1},[79]:{},[87]:{fixedSlots:{pat1:77}},[89]:{skip:!0},[90]:{skip:!0},[91]:{skip:!0},[96]:{skip:!0,maxFlyers:2,fixedSlots:{pat1:82,pal3:8}},[100]:{skip:!0,fixedSlots:{pat1:82,pal3:8}},[104]:{skip:!0,fixedSlots:{pat1:82,pal3:8}},[105]:{maxFlyers:1,nonFlyers:{[23]:[4,6]}},[106]:{maxFlyers:1,nonFlyers:{[21]:[0,24]}},[108]:{maxFlyers:1,nonFlyers:{[23]:[0,24]}},[109]:{maxFlyers:1,nonFlyers:{[17]:[16,0],[27]:[0,0],[28]:[6,0]}},[120]:{maxFlyers:1,
nonFlyers:{[22]:[-8,-8]}},[124]:{maxFlyers:1,nonFlyers:{[21]:[-39,84]}},[132]:{nonFlyers:{[18]:[0,-4],[19]:[0,4],[20]:[-6,0],[21]:[14,12]}},[136]:{maxFlyers:1},[137]:{maxFlyers:1},[138]:{maxFlyers:1,nonFlyers:{[13]:[7,0],[14]:[0,0],[15]:[7,3],[16]:[0,6],[17]:[11,-16]}},[143]:{skip:!0},[144]:{maxFlyers:2,nonFlyers:{[20]:[-11,-3],[21]:[0,16]}},[145]:{maxFlyers:2,nonFlyers:{[24]:[0,14],[25]:[4,-16]}},[152]:{maxFlyers:2,nonFlyers:{[20]:[-6,6],[21]:[0,-16]}},[158]:{maxFlyers:2},[162]:{maxFlyers:1,nonFlyers:{[18]:[0,
11],[19]:[6,0]}},[165]:{nonFlyers:{[23]:[6,6],[24]:[-6,0],[25]:[-1,-7]}},[166]:{skip:!0},[168]:{skip:!0},[169]:{maxFlyers:2,nonFlyers:{[22]:[26,-16],[23]:[0,32]}},[171]:{maxFlyers:2,nonFlyers:{[13]:[1,0],[14]:[2,-2]}},[173]:{maxFlyers:2,nonFlyers:{[24]:[0,8],[25]:[0,-8]}},[175]:{nonFlyers:{[13]:[0,0],[14]:[0,0],[19]:[59,-38]}},[180]:{maxFlyers:2,nonFlyers:{[17]:[6,0],[18]:[0,6]}},[215]:{skip:!0}},ITEMS$$module$patch=new Map([[0,"Sword of Wind",!0],[1,"Sword of Fire",!0],[2,"Sword of Water",!0],[3,
"Sword of Thunder",!0],[4,"Crystalis",!0],[5,"Ball of Wind",!0],[6,"Tornado Bracelet",!0],[7,"Ball of Fire",!0],[8,"Flame Bracelet",!0],[9,"Ball of Water",!0],[10,"Blizzard Bracelet",!0],[11,"Ball of Thunder",!0],[12,"Storm Bracelet",!0],[13,"Carapace Shield"],[14,"Bronze Shield"],[15,"Platinum Shield"],[16,"Mirrored Shield"],[17,"Ceramic Shield"],[18,"Sacred Shield"],[19,"Battle Shield"],[20,"Psycho Shield",!0],[21,"Tanned Hide"],[22,"Leather Armor"],[23,"Bronze Armor"],[24,"Platinum Armor"],[25,
"Soldier Suit"],[26,"Ceramic Suit"],[27,"Battle Armor",!0],[28,"Psycho Armor",!0],[29,"Medical Herb"],[30,"Antidote"],[31,"Lysis Plant"],[32,"Fruit of Lime"],[33,"Fruit of Power"],[34,"Magic Ring"],[35,"Fruit of Repun"],[36,"Warp Boots"],[37,"Statue of Onyx",!0],[38,"Opel Statue",!0],[39,"Insect Flute",!0],[40,"Flute of Lime",!0],[41,"Gas Mask",!0],[42,"Power Ring",!0],[43,"Warrior Ring",!0],[44,"Iron Necklace",!0],[45,"Deo's Pendant",!0],[46,"Rabbit Boots",!0],[47,"Leather Boots",!0],[48,"Shield Ring",
!0],[49,"Alarm Flute",!0],[50,"Windmill Key",!0],[51,"Key to Prison",!0],[52,"Key to Styx",!0],[53,"Fog Lamp",!0],[54,"Shell Flute",!0],[55,"Eye Glasses",!0],[56,"Broken Statue",!0],[57,"Glowing Lamp",!0],[58,"Statue of Gold",!0],[59,"Love Pendant",!0],[60,"Kirisa Plant",!0],[61,"Ivory Statue",!0],[62,"Bow of Moon",!0],[63,"Bow of Sun",!0],[64,"Bow of Truth",!0],[65,"Refresh",!0],[66,"Paralysis",!0],[67,"Telepathy",!0],[68,"Teleport",!0],[69,"Recover",!0],[70,"Barrier",!0],[71,"Change",!0],[72,"Flight",
!0]].map((a)=>{var [b,c,d]=a;return[b,{id:b,name:c,key:d}]})),RETAIN_SLOTS$$module$patch=new Set([80,83]),UNTOUCHED_MONSTERS$$module$patch={[126]:!0,[127]:!0,[131]:!0,[141]:!0,[142]:!0,[143]:!0,[159]:!0,[166]:!0},shuffleRandomNumbers$$module$patch=(a,b)=>{a=a.subarray(219124,219188);b.shuffle(a)};var module$patch={};module$patch.default=$jscompDefaultExport$$module$patch;module$patch.parseSeed=parseSeed$$module$patch;module$patch.Reader=Reader$$module$patch;module$patch.shuffle=shuffle$$module$patch;
module$patch.stampVersionSeedAndHash=stampVersionSeedAndHash$$module$patch;function uint1$$module$rom$ints(a){return a&1}function uint2$$module$rom$ints(a){return a&3}function uint3$$module$rom$ints(a){return a&7}function uint4$$module$rom$ints(a){return a&15}function uint5$$module$rom$ints(a){return a&31}function uint6$$module$rom$ints(a){return a&63}function uint7$$module$rom$ints(a){return a&127}function uint8$$module$rom$ints(a){return a&255}function int8$$module$rom$ints(a){a=uint8$$module$rom$ints(a);return 128>a?a:a-256}var module$rom$ints={};
module$rom$ints.uint1=uint1$$module$rom$ints;module$rom$ints.uint2=uint2$$module$rom$ints;module$rom$ints.uint3=uint3$$module$rom$ints;module$rom$ints.uint4=uint4$$module$rom$ints;module$rom$ints.uint5=uint5$$module$rom$ints;module$rom$ints.uint6=uint6$$module$rom$ints;module$rom$ints.uint7=uint7$$module$rom$ints;module$rom$ints.uint8=uint8$$module$rom$ints;module$rom$ints.int8=int8$$module$rom$ints;class ProgressTracker$$module$progress{constructor(){this.completed=this.tasks=0}addTasks(a){this.tasks+=a}addCompleted(a){this.completed+=a}value(){return this.tasks&&this.completed/this.tasks}}var module$progress={};module$progress.ProgressTracker=ProgressTracker$$module$progress;const renderPresets$$module$render=(a)=>{for(const {title:c,flags:d,descr:e,default:g}of PRESETS$$module$flagset){var b=document.createElement("h2");b.textContent=c;a.appendChild(b);b=document.createElement("p");b.innerHTML=e;a.appendChild(b);b=document.createElement("a");b.textContent=d;b.classList.add("button");b.classList.add("preset-flags");b.dataset.flags=d;g&&(b.dataset.defaultPreset="true");a.appendChild(b)}},renderOptions$$module$render=(a)=>{for(const {section:c,text:d,flags:e}of FLAGS$$module$flagset){var b=
document.createElement("h2");b.textContent=c;a.appendChild(b);d&&(b=document.createElement("p"),b.innerHTML=d,a.appendChild(b));b=document.createElement("div");b.classList.add("flag-list");a.appendChild(b);for(const {flag:a,hard:c,name:d,text:h}of e){const e=document.createElement("div");e.textContent=`${a}: ${d}`;e.classList.add("checkbox");c&&e.classList.add("hard");if(h){const a=document.createElement("div");a.classList.add("flag-body");a.innerHTML=h;e.appendChild(a)}b.appendChild(e)}}},renderRaceFlags$$module$render=
(a,b)=>{for(const {section:c,text:d,flags:e}of FLAGS$$module$flagset){let g=!1;const f=document.createElement("h2");f.textContent=c;const k=d?document.createElement("p"):null;d&&(k.innerHTML=d);const h=document.createElement("div");h.classList.add("flag-list");for(const {flag:a,hard:c,name:d,text:f}of e){if(!b.check(a))continue;g=!0;const e=document.createElement("div");e.textContent=`${a}: ${d}`;e.classList.add("checkbox");c&&e.classList.add("hard");if(f){const a=document.createElement("div");a.classList.add("flag-body");
a.innerHTML=f;e.appendChild(a)}h.appendChild(e)}g&&(a.appendChild(f),k&&a.appendChild(k),a.appendChild(h))}};var module$render={};module$render.renderPresets=renderPresets$$module$render;module$render.renderOptions=renderOptions$$module$render;module$render.renderRaceFlags=renderRaceFlags$$module$render;let flags$$module$main,seed$$module$main,rom$$module$main,romName$$module$main,race$$module$main=!1;
const ga$$module$main=window.ga||(()=>{}),initRace$$module$main=()=>{race$$module$main=!0;loadRomFromStorage$$module$main();initializeStateFromHash$$module$main(!1);updateRaceDom$$module$main();window.addEventListener("popstate",(a)=>{initializeStateFromHash$$module$main(!1)});document.body.addEventListener("click",click$$module$main);initVersion$$module$main()},main$$module$main=()=>{if(null==document.getElementById("race")){initRace$$module$main();renderRaceFlags$$module$render(document.getElementById("flags"),
flags$$module$main);for(const a of[...document.getElementsByClassName("checkbox")])makeCheckbox$$module$main(a);for(const a of document.querySelectorAll('.flag-list > input[type="checkbox"]'))a.checked=!0,a.disabled=!0}else{renderPresets$$module$render(document.getElementById("presets"));renderOptions$$module$render(document.getElementById("select-options"));loadRomFromStorage$$module$main();initializeStateFromHash$$module$main(!0);flags$$module$main||document.querySelector("[data-default-preset]").click();
for(const a of[...document.getElementsByClassName("checkbox")])makeCheckbox$$module$main(a);updateDom$$module$main();addSeedListeners$$module$main();document.body.addEventListener("click",click$$module$main);window.addEventListener("popstate",(a)=>{a.state?(flags$$module$main.flags=a.state.flags,seed$$module$main=a.state.seed):initializeStateFromHash$$module$main(!0)});initVersion$$module$main()}},initVersion$$module$main=()=>{"latest"!==HASH$$module$version&&(document.getElementById("version").textContent=
`Current version: ${LABEL$$module$version} (${DATE$$module$version.toDateString()})`);document.body.classList.add("js-works");document.body.classList.remove("js-broken");"rc"==STATUS$$module$version?(document.body.classList.add("release-candidate"),document.body.classList.add("versioned")):"stable"==STATUS$$module$version&&document.body.classList.add("versioned")},addSeedListeners$$module$main=()=>{const a=document.getElementById("seed"),b=()=>{seed$$module$main=a.value;updateDom$$module$main()};
a.addEventListener("keyup",b);a.addEventListener("change",b)},initializeStateFromHash$$module$main=(a)=>{for(const a of location.hash.substring(1).split("&")){let [b,d]=a.split("=");d=decodeURIComponent(d);"flags"===b&&(flags$$module$main=new FlagSet$$module$flagset(d));"seed"===b&&(seed$$module$main=decodeURIComponent(d));"race"===b&&document.body.classList.add("race");for(const a of document.querySelectorAll("[data-flags]"))a.addEventListener("click",()=>{flags$$module$main=new FlagSet$$module$flagset(a.dataset.flags);
"unstable"==VERSION$$module$version&&flags$$module$main.set("Ds",!0);updateDom$$module$main()})}},click$$module$main=(a)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){var b=a.target,c=`${LABEL$$module$version}: ${flags$$module$main}`;const d=(new Date).getTime();for(;b;){if("H1"===b.tagName&&b.parentElement.classList.contains("expandable")){b.parentElement.classList.toggle("expanded");break}else if("preset-apply"===b.id){ga$$module$main("send","event","custom-preset");flags$$module$main=
new FlagSet$$module$flagset(document.getElementById("flagstring").value);updateDom$$module$main();break}else if("new-seed"===b.id){ga$$module$main("send","event","Main","new-seed");seed$$module$main=Math.floor(4294967296*Math.random()).toString(16);updateDom$$module$main();break}else if("generate"===b.id){ga$$module$main("send","event","Main","generate",c);b=parseSeed$$module$patch(seed$$module$main);const [a,g]=yield shuffleRom$$module$main(b);ga$$module$main("send","timing","Main","generate",(new Date).getTime()-
d,c);c=romName$$module$main.replace(/\.nes|$/,["_",b.toString(16).padStart(8,0),"_",g.toString(16).padStart(8,0),".nes"].join(""));download$$module$main(a,c);break}else if("spoiler"===b.id){ga$$module$main("send","event","Main","spoiler",c);yield shuffleRom$$module$main(parseSeed$$module$patch(seed$$module$main));ga$$module$main("send","timing","Main","spoiler",(new Date).getTime()-d,c);break}b=b.parentElement}}),read$$module$main=(a,b,c)=>{const d=[];for(let e=0;e<c;e++)d.push(String.fromCharCode(a[b+
2*e]));return d.join("")},shuffleRom$$module$main=(a)=>$jscomp.asyncExecutePromiseGeneratorFunction(function*(){const b=document.getElementById("progress"),c=new ProgressTracker$$module$progress,d=rom$$module$main.slice();let e=!1;var g=new FlagSet$$module$flagset(String(flags$$module$main));document.body.classList.add("shuffling");const f=flags$$module$main.check("Ds")?{}:void 0,k=()=>{e||(b.value=c.value(),setTimeout(k,120))};k();g=yield shuffle$$module$patch(d,a,g,new FetchReader$$module$fetchreader,
f,c);e=!0;document.body.classList.remove("shuffling");f&&(replaceSpoiler$$module$main("spoiler-items",f.items.map((a)=>a.text)),replaceSpoiler$$module$main("spoiler-route",f.route));document.getElementById("checksum").textContent=read$$module$main(d,161941,4)+read$$module$main(d,161942,4);return[d,g]}),replaceSpoiler$$module$main=(a,b)=>{for(a=document.getElementById(a);a.children.length;)a.lastChild.remove();for(const c of b)b=document.createElement("li"),b.textContent=c,a.appendChild(b)},makeCheckbox$$module$main=
(a)=>{const b=a.getElementsByClassName("flag-body")[0];b&&b.remove();const [c,d]=a.textContent.split(/:\s*/),e=document.createElement("input");e.type="checkbox";e.id=`flag-${c}`;e.dataset.flag=c;a.parentElement.insertBefore(e,a);const g=document.createElement("label");g.textContent=c;g.htmlFor=e.id;a.parentElement.insertBefore(g,a);const f=document.createElement("div");a.parentElement.insertBefore(f,a);const k=document.createElement("label");k.textContent=d;k.htmlFor=e.id;f.appendChild(k);b&&f.appendChild(b);
a.classList.contains("hard")&&(g.classList.add("hard"),k.classList.add("hard"),k.textContent+=" *");a.remove();e.addEventListener("change",()=>{window.FLAGS=flags$$module$main;flags$$module$main.set(c,e.checked);updateDom$$module$main()})},updateDom$$module$main=()=>{for(var a of document.querySelectorAll("input[data-flag]"))a.checked=flags$$module$main.check(a.dataset.flag);a=String(flags$$module$main).replace(/ /g,"");document.getElementById("seed").value=seed$$module$main||"";var b=["#flags=",
a];seed$$module$main&&b.push("&seed=",encodeURIComponent(seed$$module$main));history.replaceState({flags:flags$$module$main.flags,seed:seed$$module$main},"",String(window.location).replace(/#.*/,"")+b.join(""));if("stable"==STATUS$$module$version||"rc"==STATUS$$module$version){b=seed$$module$main||Math.floor(4294967296*Math.random()).toString(16);const c=VERSION$$module$version;document.getElementById("race").href=`/${c}/race#flags=${a}&seed=${b}`}updateRaceDom$$module$main()},updateRaceDom$$module$main=
()=>{const a=String(flags$$module$main);document.body.classList.toggle("spoiled",flags$$module$main.check("Ds"));document.body.classList.toggle("debug-mode",/D/.test(a));document.getElementById("flagstring-out").textContent=a;document.getElementById("track-url").href=`track#flags=${a.replace(/ /g,"")}`},loadRomFromStorage$$module$main=()=>{const a=window.localStorage.getItem("name"),b=window.localStorage.getItem("rom"),c=document.getElementById("pick-file"),d=()=>{document.body.classList.add("rom-uploaded");
document.body.classList.toggle("rom-broken",crc32$$module$crc32(rom$$module$main)!=EXPECTED_CRC32$$module$rom)};a&&b&&(romName$$module$main=a,rom$$module$main=Uint8Array.from(Array(b.length/2).fill(0).map((a,c)=>Number.parseInt(b[2*c]+b[2*c+1],16))),d());c.addEventListener("change",()=>{const a=c.files[0],b=new FileReader;b.addEventListener("loadend",()=>{const c=new Uint8Array(b.result),e=Array.from(c,(a)=>a.toString(16).padStart(2,0)).join("");window.localStorage.setItem("rom",e);window.localStorage.setItem("name",
a.name);rom$$module$main=c.slice(0,393232);d();romName$$module$main=a.name});b.readAsArrayBuffer(a)})},download$$module$main=(a,b)=>{const c=document.createElement("a");document.body.appendChild(c);c.style="display: none";a=new Blob([a],{type:"octet/stream"});a=window.URL.createObjectURL(a);c.href=a;c.download=b;c.click();window.URL.revokeObjectURL(a);c.remove()};main$$module$main();var module$main={};
}).call(this)
