export function shuffleTrades(rom, flags, random) {
    if (!flags.randomizeTrades())
        return;
    const { items: { StatueOfOnyx, FogLamp, LovePendant, KirisaPlant, IvoryStatue }, locations: { Swan_DanceHall }, npcs: { KensuInSwan }, } = rom;
    const map = new Map();
    const items = [
        [StatueOfOnyx, 0, 'Akahana'],
        [FogLamp, 0, 'Fisherman'],
        [LovePendant, 0, 'Kensu'],
        [KirisaPlant, 0, 'Aryllis'],
        [IvoryStatue, 0, 'Slimed Kensu'],
    ];
    const npcs = items.map(([item, trade, npcName]) => {
        if (item.trades.indexOf(trade) < 0 || trade >= item.itemUseData.length) {
            throw new Error(`not a trade: ${item} ${trade}`);
        }
        const use = item.itemUseData[trade];
        return [use, item.id, npcName];
    });
    random.shuffle(npcs);
    for (const [item, trade] of items) {
        const [use, originalItem, npcName] = npcs.pop();
        item.itemUseData[trade] = use;
        if (rom.spoiler)
            rom.spoiler.addTrade(item.id, item.messageName, npcName);
        if (use.want === 0x123) {
            rom.prg[0x3d4b5] = item.id - 0x1c;
        }
        else if (use.want === 0x164 && flags.fogLampNotRequired()) {
            [...rom.npcs[0x64].spawnConditions.values()][0][0] = 0x200 | item.id;
        }
        map.set(originalItem, item.id);
    }
    rom.itemGets.actionGrants =
        new Map([...rom.itemGets.actionGrants]
            .map(([k, v]) => { var _a; return [(_a = map.get(k)) !== null && _a !== void 0 ? _a : k, v]; }));
    const rage = rom.items[random.nextInt(4)];
    rom.npcs[0xc3].localDialogs.get(-1)[0].condition = 0x200 | rage.id;
    if (rom.spoiler)
        rom.spoiler.addTrade(rage.id, rage.messageName, 'Rage');
    rom.npcs[0x38].localDialogs.get(-1)[3].condition = 0x200 | rage.id;
    const tornel = rom.items[random.nextInt(4) * 2 + 6];
    for (const ds of rom.npcs[0x5f].localDialogs.values()) {
        for (let i = 2; i < ds.length; i++) {
            if (ds[i].message.action === 3) {
                ds[i - 2].condition = ~(0x200 | (tornel.id - 1));
                ds[i - 1].condition = ~(0x200 | tornel.id);
                if (rom.spoiler) {
                    rom.spoiler.addTrade(tornel.id, tornel.messageName, 'Tornel');
                }
                break;
            }
        }
    }
    KensuInSwan.dialog(Swan_DanceHall)[0].message.mid = '13:00';
}
export function buildTradeInMap(rom) {
    const map = new Map();
    for (const item of rom.items) {
        for (const trade of item.trades) {
            map.set(item.itemUseData[trade].want & 0xff, item.id);
        }
    }
    return map;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2h1ZmZsZXRyYWRlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9wYXNzL3NodWZmbGV0cmFkZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBTUEsTUFBTSxVQUFVLGFBQWEsQ0FBQyxHQUFRLEVBQUUsS0FBYyxFQUFFLE1BQWM7SUFDcEUsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUU7UUFBRSxPQUFPO0lBQ3JDLE1BQU0sRUFDSixLQUFLLEVBQUUsRUFBQyxZQUFZLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFDbEMsV0FBVyxFQUFFLFdBQVcsRUFBQyxFQUNqQyxTQUFTLEVBQUUsRUFBQyxjQUFjLEVBQUMsRUFDM0IsSUFBSSxFQUFFLEVBQUMsV0FBVyxFQUFDLEdBQ3BCLEdBQUcsR0FBRyxDQUFDO0lBR1IsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQWtCLENBQUM7SUFFdEMsTUFBTSxLQUFLLEdBQW1EO1FBQzVELENBQUMsWUFBWSxFQUFFLENBQUMsRUFBRSxTQUFTLENBQUM7UUFDNUIsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxFQUFFLFdBQVcsQ0FBQztRQUN6QixDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDO1FBQ3pCLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBRSxTQUFTLENBQUM7UUFDM0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLGNBQWMsQ0FBQztLQUV4QixDQUFDO0lBQ1gsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsRUFBRSxFQUFFO1FBQ2hELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRTtZQUN0RSxNQUFNLElBQUksS0FBSyxDQUFDLGdCQUFnQixJ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RjtJQUNELE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7RmxhZ1NldH0gZnJvbSAnLi4vZmxhZ3NldC5qcyc7XG5pbXBvcnQge1JhbmRvbX0gZnJvbSAnLi4vcmFuZG9tLmpzJztcbmltcG9ydCB7Um9tfSBmcm9tICcuLi9yb20uanMnO1xuaW1wb3J0IHtJdGVtfSBmcm9tICcuLi9yb20vaXRlbS5qcyc7XG5cbi8vIFNodWZmbGUgdGhlIHBhbGV0dGVzLlxuZXhwb3J0IGZ1bmN0aW9uIHNodWZmbGVUcmFkZXMocm9tOiBSb20sIGZsYWdzOiBGbGFnU2V0LCByYW5kb206IFJhbmRvbSkge1xuICBpZiAoIWZsYWdzLnJhbmRvbWl6ZVRyYWRlcygpKSByZXR1cm47XG4gIGNvbnN0IHtcbiAgICBpdGVtczoge1N0YXR1ZU9mT255eCwgRm9nTGFtcCwgTG92ZVBlbmRhbnQsXG4gICAgICAgICAgICBLaXJpc2FQbGFudCwgSXZvcnlTdGF0dWV9LFxuICAgIGxvY2F0aW9uczoge1N3YW5fRGFuY2VIYWxsfSxcbiAgICBucGNzOiB7S2Vuc3VJblN3YW59LFxuICB9ID0gcm9tO1xuXG4gIC8vIE1hcCB0aGUgb3JpZ2luYWwgdHJhZGUgdG8gdGhlIG5ldyB0cmFkZSwgZm9yIHVwZGF0aW5nIGFjdGlvbkdyYW50cy5cbiAgY29uc3QgbWFwID0gbmV3IE1hcDxudW1iZXIsIG51bWJlcj4oKTtcblxuICBjb25zdCBpdGVtczogUmVhZG9ubHlBcnJheTxyZWFkb25seSBbSXRlbSwgbnVtYmVyLCBzdHJpbmddPiA9IFtcbiAgICBbU3RhdHVlT2ZPbnl4LCAwLCAnQWthaGFuYSddLFxuICAgIFtGb2dMYW1wLCAwLCAnRmlzaGVybWFuJ10sXG4gICAgW0xvdmVQZW5kYW50LCAwLCAnS2Vuc3UnXSxcbiAgICBbS2lyaXNhUGxhbnQsIDAsICdBcnlsbGlzJ10sXG4gICAgW0l2b3J5U3RhdHVlLCAwLCAnU2xpbWVkIEtlbnN1J10sXG4gICAgLy8gW0ZsdXRlT2ZMaW1lLCAzLCAnU3RvbmVkIEFrYWhhbmEnXSxcbiAgXSBhcyBjb25zdDtcbiAgY29uc3QgbnBjcyA9IGl0ZW1zLm1hcCgoW2l0ZW0sIHRyYWRlLCBucGNOYW1lXSkgPT4ge1xuICAgIGlmIChpdGVtLnRyYWRlcy5pbmRleE9mKHRyYWRlKSA8IDAgfHwgdHJhZGUgPj0gaXRlbS5pdGVtVXNlRGF0YS5sZW5ndGgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgbm90IGEgdHJhZGU6ICR7aXRlbX0gJHt0cmFkZX1gKTtcbiAgICB9XG4gICAgY29uc3QgdXNlID0gaXRlbS5pdGVtVXNlRGF0YVt0cmFkZV07IC8vIHVzZS53YW50ID09PSBOUEMgaWQgfCAxMDBcbiAgICByZXR1cm4gW3VzZSwgaXRlbS5pZCAvKiBvcmlnaW5hbCBpdGVtICovLCBucGNOYW1lXSBhcyBjb25zdDtcbiAgfSk7XG4gIHJhbmRvbS5zaHVmZmxlKG5wY3MpO1xuXG4gIGZvciAoY29uc3QgW2l0ZW0sIHRyYWRlXSBvZiBpdGVtcykge1xuICAgIGNvbnN0IFt1c2UsIG9yaWdpbmFsSXRlbSwgbnBjTmFtZV0gPSBucGNzLnBvcCgpITtcbiAgICBpdGVtLml0ZW1Vc2VEYXRhW3RyYWRlXSA9IHVzZTtcbiAgICBpZiAocm9tLnNwb2lsZXIpIHJvbS5zcG9pbGVyLmFkZFRyYWRlKGl0ZW0uaWQsIGl0ZW0ubWVzc2FnZU5hbWUsIG5wY05hbWUpO1xuICAgIGlmICh1c2Uud2FudCA9PT0gMHgxMjMpIHsgLy8gYXJ5bGxpcyBpdGVtIHJlcXVpcmVzIGJlaW5nIGEgZ2lybFxuICAgICAgLy8gVE9ETyAtIGNvbnNpZGVyIG1vdmluZyB0aGlzIHRvIEl0ZW0ud3JpdGU/XG4gICAgICByb20ucHJnWzB4M2Q0YjVdID0gaXRlbS5pZCAtIDB4MWM7XG4gICAgfSBlbHNlIGlmICh1c2Uud2FudCA9PT0gMHgxNjQgJiYgZmxhZ3MuZm9nTGFtcE5vdFJlcXVpcmVkKCkpIHtcbiAgICAgIC8vIGZpc2hlcm1hbiBub3cgc3Bhd25zIGJhc2VkIG9uIHRyYWRlLWluIGl0ZW1cbiAgICAgIFsuLi5yb20ubnBjc1sweDY0XS5zcGF3bkNvbmRpdGlvbnMudmFsdWVzKCldWzBdWzBdID0gMHgyMDAgfCBpdGVtLmlkO1xuICAgIH1cbiAgICBtYXAuc2V0KG9yaWdpbmFsSXRlbSwgaXRlbS5pZCk7XG4gIH1cblxuICAvLyBGaXggdXAgdGhlIGFjdGlvbkdyYW50c1xuICByb20uaXRlbUdldHMuYWN0aW9uR3JhbnRzID1cbiAgICAgIG5ldyBNYXAoWy4uLnJvbS5pdGVtR2V0cy5hY3Rpb25HcmFudHNdXG4gICAgICAgICAgICAgIC5tYXAoKFtrLCB2XSkgPT4gW21hcC5nZXQoaykgPz8gaywgdl0pKTtcblxuICAvLyBBbHNvIHJhbmRvbWl6ZSBSYWdlIGFuZCBUb3JuZWxcbiAgY29uc3QgcmFnZSA9IHJvbS5pdGVtc1tyYW5kb20ubmV4dEludCg0KV07XG4gIHJvbS5ucGNzWzB4YzNdLmxvY2FsRGlhbG9ncy5nZXQoLTEpIVswXS5jb25kaXRpb24gPSAweDIwMCB8IHJhZ2UuaWQ7XG4gIGlmIChyb20uc3BvaWxlcikgcm9tLnNwb2lsZXIuYWRkVHJhZGUocmFnZS5pZCwgcmFnZS5tZXNzYWdlTmFtZSwgJ1JhZ2UnKTtcbiAgLy8gUG9ydG9hIHF1ZWVuIDM4IHRha2VzIHRoZSBzYW1lIHN3b3JkIGFzIFJhZ2VcbiAgcm9tLm5wY3NbMHgzOF0ubG9jYWxEaWFsb2dzLmdldCgtMSkhWzNdLmNvbmRpdGlvbiA9IDB4MjAwIHwgcmFnZS5pZDtcblxuICBjb25zdCB0b3JuZWwgPSByb20uaXRlbXNbcmFuZG9tLm5leHRJbnQoNCkgKiAyICsgNl07XG4gIGZvciAoY29uc3QgZHMgb2Ygcm9tLm5wY3NbMHg1Zl0ubG9jYWxEaWFsb2dzLnZhbHVlcygpKSB7XG4gICAgZm9yIChsZXQgaSA9IDI7IGkgPCBkcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGRzW2ldLm1lc3NhZ2UuYWN0aW9uID09PSAzKSB7XG4gICAgICAgIC8vIE5PVEU6IGJyYWNlbGV0IGdvZXMgZmlyc3RcbiAgICAgICAgZHNbaSAtIDJdLmNvbmRpdGlvbiA9IH4oMHgyMDAgfCAodG9ybmVsLmlkIC0gMSkpO1xuICAgICAgICBkc1tpIC0gMV0uY29uZGl0aW9uID0gfigweDIwMCB8IHRvcm5lbC5pZCk7XG4gICAgICAgIGlmIChyb20uc3BvaWxlcikge1xuICAgICAgICAgIHJvbS5zcG9pbGVyLmFkZFRyYWRlKHRvcm5lbC5pZCwgdG9ybmVsLm1lc3NhZ2VOYW1lLCAnVG9ybmVsJyk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gS2Vuc3UgaW4gU3dhbiBzaG91bGQga2VlcCB0ZWxsaW5nIHRoZSBwbGF5ZXIgd2hhdCBoZSB3YW50cywgcmF0aGVyXG4gIC8vIHRoYW4gc3dpdGNoaW5nIHRvIFwiSSBoYXRlIHBlb3BsZSB3aG8gYXJlIHB1c2h5XCIuXG4gIEtlbnN1SW5Td2FuLmRpYWxvZyhTd2FuX0RhbmNlSGFsbClbMF0ubWVzc2FnZS5taWQgPSAnMTM6MDAnO1xuICAvLyBUT0RPIC0gbWFyayAxMzowMSBhcyB1bnVzZWQ/XG59XG5cbi8vIE5PVEUgLSB0aGlzIGlzIGNvcGllZCBmcm9tIGZpeGRpYWxvZ1xuLyoqIEJ1aWxkcyBhIG1hcCBmcm9tIE5QQyBpZCB0byB3YW50ZWQgaXRlbSBpZC4gKi9cbmV4cG9ydCBmdW5jdGlvbiBidWlsZFRyYWRlSW5NYXAocm9tOiBSb20pOiBNYXA8bnVtYmVyLCBudW1iZXI+IHtcbiAgY29uc3QgbWFwID0gbmV3IE1hcCgpO1xuICBmb3IgKGNvbnN0IGl0ZW0gb2Ygcm9tLml0ZW1zKSB7XG4gICAgZm9yIChjb25zdCB0cmFkZSBvZiBpdGVtLnRyYWRlcykge1xuICAgICAgbWFwLnNldChpdGVtLml0ZW1Vc2VEYXRhW3RyYWRlXS53YW50ICYgMHhmZiwgaXRlbS5pZCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBtYXA7XG59XG4iXX0=