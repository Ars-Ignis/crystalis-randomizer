import { Token } from './token.js';
export var Expr;
(function (Expr) {
    function traverse(expr, f) {
        function rec(e) {
            if (!e.args)
                return e;
            return { ...e, args: e.args.map(c => t(c, e)) };
        }
        ;
        function t(e, p) {
            const source = e.source;
            e = f(e, rec, p);
            if (source && !e.source)
                e.source = source;
            return e;
        }
        return t(expr);
    }
    Expr.traverse = traverse;
    function traversePost(expr, f) {
        return traverse(expr, (expr, rec) => f(rec(expr)));
    }
    Expr.traversePost = traversePost;
    function evaluate(expr) {
        var _a, _b, _c, _d;
        switch (expr.op) {
            case '.move':
            case 'im':
            case 'sym':
                return expr;
            case 'num':
                if (((_a = expr.meta) === null || _a === void 0 ? void 0 : _a.rel) && expr.meta.org != null) {
                    const { rel, ...meta } = expr.meta;
                    return { op: 'num', num: expr.num + meta.org, meta };
                }
                return expr;
            case '.max': return sameChunk(expr, Math.max);
            case '.min': return sameChunk(expr, Math.min);
            default:
        }
        if (((_b = expr.args) === null || _b === void 0 ? void 0 : _b.length) === 1) {
            switch (expr.op) {
                case '+': return expr.args[0];
                case '-': return unary(expr, x => -x);
                case '~': return unary(expr, x => ~x);
                case '!': return unary(expr, x => +!x);
                case '<': return unary(expr, x => x & 0xff);
                case '>': return unary(expr, x => (x >> 8) & 0xff);
                case '^': return (_d = num((_c = expr.args[0].meta) === null || _c === void 0 ? void 0 : _c.bank)) !== null && _d !== void 0 ? _d : expr;
                default: throw new Error(`Unknown unary operator: ${expr.op}`);
            }
        }
        switch (expr.op) {
            case '+': return plus(expr);
            case '-': return minus(expr);
            case '*': return binary(expr, (a, b) => a * b);
            case '/': return binary(expr, (a, b) => Math.floor(a / b));
            case '.mod': return binary(expr, (a, b) => a % b);
            case '&': return binary(expr, (a, b) => a & b);
            case '|': return binary(expr, (a, b) => a | b);
            case '^': return binary(expr, (a, b) => a ^ b);
            case '<<': return binary(expr, (a, b) => a << b);
            case '>>': return binary(expr, (a, b) => a >>> b);
            case '<': return binary(expr, (a, b) => +(a < b));
            case '<=': return binary(expr, (a, b) => +(a <= b));
            case '>': return binary(expr, (a, b) => +(a > b));
            case '>=': return binary(expr, (a, b) => +(a >= b));
            case '=': return binary(expr, (a, b) => +(a == b));
            case '<>': return binary(expr, (a, b) => +(a != b));
            case '&&': return binary(expr, (a, b) => a && b);
            case '||': return binary(expr, (a, b) => a || b);
            case '.xor': return binary(expr, (a, b) => !a && b || !b && a || 0);
            default: throw new Error(`Unknown operator: ${expr.op}`);
        }
    }
    Expr.evaluate = evaluate;
    function identifier(expr) {
        if (expr.op === 'sym' && expr.sym)
            return expr.sym;
        throw new Error(`Expected identifier but got op: ${expr.op}`);
    }
    Expr.identifier = identifier;
    function parseOnly(tokens, index = 0) {
        const [expr, i] = parse(tokens, index);
        if (i < tokens.length) {
            debugger;
            parse(tokens, index);
            throw new Error(`Garbage after expression: ${Token.nameAt(tokens[i])}`);
        }
        else if (!expr) {
            throw new Error(`No expression?`);
        }
        return expr;
    }
    Expr.parseOnly = parseOnly;
    function parse(tokens, index = 0) {
        const ops = [];
        const exprs = [];
        function popOp() {
            const [op, [, , arity]] = ops.pop();
            const args = exprs.splice(exprs.length - arity, arity);
            if (args.length !== arity)
                throw new Error('shunting parse failed?');
            exprs.push(fixSize({ op, args }));
        }
        let val = true;
        let i = index;
        for (; i < tokens.length; i++) {
            const front = tokens[i];
            if (val) {
                if (front.token === 'cs' || front.token === 'op') {
                    const mapped = NAME_MAP.get(front.str);
                    const prefix = PREFIXOPS.get(mapped !== null && mapped !== void 0 ? mapped : front.str);
                    if (prefix) {
                        ops.push([front.str, prefix]);
                    }
                    else if (front.token === 'cs') {
                        const op = front.str;
                        if (!FUNCTIONS.has(op)) {
                            throw new Error(`No such function: ${Token.nameAt(front)}`);
                        }
                        const next = tokens[i + 1];
                        if ((next === null || next === void 0 ? void 0 : next.token) !== 'lp') {
                            throw new Error(`Bad funcall: ${Token.nameAt(next !== null && next !== void 0 ? next : front)}`);
                        }
                        const close = Token.findBalanced(tokens, i + 1);
                        if (close < 0) {
                            throw new Error(`Never closed: ${Token.nameAt(next)}`);
                        }
                        const args = [];
                        for (const arg of Token.parseArgList(tokens, i + 2, close)) {
                            args.push(parseOnly(arg));
                        }
                        i = close;
                        exprs.push(fixSize({ op, args }));
                        val = false;
                    }
                    else if (Token.eq(front, Token.STAR)) {
                        exprs.push({ op: 'sym', sym: '*' });
                        val = false;
                    }
                    else {
                        throw new Error(`Unknown prefix operator: ${Token.nameAt(front)}`);
                    }
                }
                else if (front.token === 'lp') {
                    const close = Token.findBalanced(tokens, i);
                    if (close < 0) {
                        throw new Error(`No close paren: ${Token.nameAt(front)}`);
                    }
                    const e = parseOnly(tokens.slice(i + 1, close));
                    exprs.push(e);
                    i = close;
                    val = false;
                }
                else if (front.token === 'ident') {
                    exprs.push({ op: 'sym', sym: front.str });
                    val = false;
                }
                else if (front.token === 'num') {
                    const num = front.num;
                    exprs.push({ op: 'num', num, meta: size(num) });
                    val = false;
                }
                else {
                    throw new Error(`Bad expression token: ${Token.nameAt(front)}`);
                }
            }
            else {
                if (Token.eq(front, Token.COMMA)) {
                    break;
                }
                if (front.token === 'cs' || front.token === 'op') {
                    const mapped = NAME_MAP.get(front.str);
                    const op = BINOPS.get(mapped !== null && mapped !== void 0 ? mapped : front.str);
                    if (!op)
                        break;
                    while (ops.length) {
                        const top = ops[ops.length - 1];
                        const cmp = compareOp(top[1], op);
                        if (cmp < 0)
                            break;
                        if (cmp === 0) {
                            throw new Error(`Mixing ${top[0]} and ${front.str} needs explicit parens.${Token.at(front)}`);
                        }
                        popOp();
                    }
                    ops.push([front.str, op]);
                    val = true;
                }
                else {
                    break;
                }
            }
        }
        while (ops.length)
            popOp();
        if (exprs.length !== 1)
            throw new Error(`shunting parse failed?`);
        if (tokens[index].source)
            exprs[0].source = tokens[index].source;
        return [exprs[0], i];
    }
    Expr.parse = parse;
    function sameChunk(expr, f) {
        throw new Error();
    }
    function num(num) {
        if (num == null)
            return undefined;
        return { op: 'num', num, meta: size(num) };
    }
    function unary(expr, f) {
        const arg = expr.args[0];
        if (!isAbs(arg))
            return expr;
        const num = f(arg.num);
        return { op: 'num', num, meta: size(num) };
    }
    function binary(expr, f) {
        const [a, b] = expr.args;
        if (!isAbs(a) || !isAbs(b))
            return expr;
        const num = f(a.num, b.num);
        return { op: 'num', num, meta: size(num) };
    }
    function plus(expr) {
        var _a, _b, _c, _d, _e, _f;
        const [a, b] = expr.args;
        if (a.op !== 'num' || b.op !== 'num')
            return expr;
        const out = { op: 'num', num: a.num + b.num };
        if (a.meta || b.meta) {
            if (((_a = a.meta) === null || _a === void 0 ? void 0 : _a.rel) && ((_b = b.meta) === null || _b === void 0 ? void 0 : _b.rel))
                return expr;
            if ((_c = a.meta) === null || _c === void 0 ? void 0 : _c.rel) {
                out.meta = a.meta;
            }
            else if ((_d = b.meta) === null || _d === void 0 ? void 0 : _d.rel) {
                out.meta = b.meta;
            }
        }
        if (!((_e = out.meta) === null || _e === void 0 ? void 0 : _e.rel) && ((_f = out.meta) === null || _f === void 0 ? void 0 : _f.size) == null) {
            (out.meta || (out.meta = {})).size = size(out.num).size;
        }
        return out;
    }
    function minus(expr) {
        var _a, _b, _c, _d, _e;
        const [a, b] = expr.args;
        if (a.op !== 'num' || b.op !== 'num')
            return expr;
        const out = { op: 'num', num: a.num - b.num };
        if ((_a = b.meta) === null || _a === void 0 ? void 0 : _a.rel) {
            return ((_b = a.meta) === null || _b === void 0 ? void 0 : _b.rel) && a.meta.chunk === b.meta.chunk ? out : expr;
        }
        if ((_c = a.meta) === null || _c === void 0 ? void 0 : _c.rel)
            out.meta = a.meta;
        if (!((_d = out.meta) === null || _d === void 0 ? void 0 : _d.rel) && ((_e = out.meta) === null || _e === void 0 ? void 0 : _e.size) == null) {
            (out.meta || (out.meta = {})).size = size(out.num).size;
        }
        return out;
    }
    function isAbs(expr) {
        var _a;
        return expr.op === 'num' && !((_a = expr.meta) === null || _a === void 0 ? void 0 : _a.rel);
    }
})(Expr || (Expr = {}));
function compareOp(top, next) {
    if (top[0] > next[0])
        return 1;
    if (top[0] < next[0])
        return -1;
    if (top[1] !== next[1])
        return 0;
    return top[1];
}
const BINARY = 2;
const UNARY = 1;
export const BINOPS = new Map([
    ['*', [5, 4, BINARY]],
    ['/', [5, 4, BINARY]],
    ['.mod', [5, 3, BINARY]],
    ['&', [5, 2, BINARY]],
    ['^', [5, 1, BINARY]],
    ['<<', [5, 0, BINARY]],
    ['>>', [5, 0, BINARY]],
    ['+', [4, 2, BINARY]],
    ['-', [4, 2, BINARY]],
    ['|', [4, 1, BINARY]],
    ['<', [3, 0, BINARY]],
    ['<=', [3, 0, BINARY]],
    ['>', [3, 0, BINARY]],
    ['>=', [3, 0, BINARY]],
    ['=', [3, 0, BINARY]],
    ['<>', [3, 0, BINARY]],
    ['&&', [2, 3, BINARY]],
    ['.xor', [2, 2, BINARY]],
    ['||', [2, 1, BINARY]],
]);
const PREFIXOPS = new Map([
    ['+', [9, -1, UNARY]],
    ['-', [9, -1, UNARY]],
    ['~', [9, -1, UNARY]],
    ['<', [9, -1, UNARY]],
    ['>', [9, -1, UNARY]],
    ['^', [9, -1, UNARY]],
    ['!', [2, -1, UNARY]],
]);
const FUNCTIONS = new Set([
    '.byteat',
    '.wordat',
    '.max', '.min',
]);
const NAME_MAP = new Map([
    ['.bitand', '&'],
    ['.bitxor', '^'],
    ['.bitor', '|'],
    ['.shl', '<<'],
    ['.shr', '>>'],
    ['.and', '&&'],
    ['.or', '||'],
    ['.bitnot', '~'],
    ['.lobyte', '<'],
    ['.hibyte', '>'],
    ['.bankbyte', '^'],
    ['.not', '!'],
]);
const SIZE_TRANSFORMS = new Map([
    ['^', (...args) => args.length === 1 ? 1 : Math.max(...args)],
    ['<', () => 1],
    ['>', () => 1],
    ['!', () => 1],
    ['<=', () => 1],
    ['>=', () => 1],
    ['<>', () => 1],
    ['=', () => 1],
    ['&', Math.max],
    ['&&', Math.max],
    ['|', Math.max],
    ['||', Math.max],
    ['.xor', Math.max],
    ['.max', Math.max],
    ['.min', Math.max],
]);
function fixSize(expr) {
    const xform = SIZE_TRANSFORMS.get(expr.op);
    const size = xform === null || xform === void 0 ? void 0 : xform(...expr.args.map(e => { var _a; return Number((_a = e.meta) === null || _a === void 0 ? void 0 : _a.size); }));
    if (size)
        (expr.meta || (expr.meta = {})).size = size;
    return expr;
}
function size(num) {
    return { size: 0 <= num && num < 256 ? 1 : 2 };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9qcy9hc20vZXhwci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQWEsS0FBSyxFQUFDLE1BQU0sWUFBWSxDQUFDO0FBa0I3QyxNQUFNLEtBQVcsSUFBSSxDQTZUcEI7QUE3VEQsV0FBaUIsSUFBSTtJQXNCbkIsU0FBZ0IsUUFBUSxDQUFDLElBQVUsRUFBRSxDQUFZO1FBQy9DLFNBQVMsR0FBRyxDQUFDLENBQU87WUFDbEIsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJO2dCQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3RCLE9BQU8sRUFBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQztRQUNoRCxDQUFDO1FBQUEsQ0FBQztRQUNGLFNBQVMsQ0FBQyxDQUFDLENBQU8sRUFBRSxDQUFRO1lBQzFCLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFDeEIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLElBQUksTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU07Z0JBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFDM0MsT0FBTyxDQUFDLENBQUM7UUFDWCxDQUFDO1FBQ0QsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakIsQ0FBQztJQVplLGFBQVEsV0FZdkIsQ0FBQTtJQUVELFNBQWdCLFlBQVksQ0FBQyxJQUFVLEVBQUUsQ0FBTTtRQUM3QyxPQUFPLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxD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TSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0QsS0FBSyxNQUFNLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDL0MsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbEQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxHQUFHLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxJQUFJLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakQsS0FBSyxNQUFNLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FB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QUFNLENBQUMsQ0FBQztJQUVyQixDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDckIsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3RCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyQixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDdEIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUV0QixDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDdEIsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3hCLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztDQUd2QixDQUFDLENBQUM7QUFFSCxNQUFNLFNBQVMsR0FBRyxJQUFJLEdBQUcsQ0FBdUI7SUFFOUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckIsQ0FBQyxHQUFHLEVBQUUs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SUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3RELE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELFNBQVMsSUFBSSxDQUFDLEdBQVc7SUFDdkIsT0FBTyxFQUFDLElBQUksRUFBRSxDQUFDLElBQUksR0FBRyxJQUFJLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUM7QUFDL0MsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7U291cmNlSW5mbywgVG9rZW59IGZyb20gJy4vdG9rZW4uanMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEV4cHIge1xuICAvLyBvcGVyYXRvciAoZS5nLiAnKycgb3IgJy5tYXgnKSBvciAnc3ltJywgJ251bScsIG9yICdpbSdcbiAgLy8gIC0gc3ltOiBhbiBvZmZzZXQgaW50byB0aGUgc3ltYm9scyBhcnJheSAob3IgdGhlIG5hbWUgaW4gJ3N5bScpXG4gIC8vICAtIG51bTogYSBudW1iZXIgbGl0ZXJhbCwgb3IgYW4gb2Zmc2V0IGludG8gdGhlIHN5bWJvbHMgYXJyYXkuXG4gIC8vICAtIGltOiBhbiBpbXBvcnQgZnJvbSBhbm90aGVyIG9iamVjdCBmaWxlICh1c2VzICdzeW0nKS5cbiAgLy8gVE9ETyAtIHdoYXQgYWJvdXQgZGlmZmVyZW50IGFkZHJlc3MgdHlwZXM/IGJhbmsgaGludC9ldGM/XG4gIC8vICAgICAgLSBkb2VzIGJhbmsgaGludCBuZWVkIHRvIGdldCBzdG9yZWQgaW4gdGhlIG9iamVjdCBmaWxlP1xuICAvLyAgICAgICAgLSBwcm9iYWJseSBub3QuLi4/XG4gIG9wOiBzdHJpbmc7XG4gIGFyZ3M/OiBFeHByW107XG4gIG51bT86IG51bWJlcjtcbiAgbWV0YT86IEV4cHIuTWV0YTtcbiAgc3ltPzogc3RyaW5nO1xuICBzb3VyY2U/OiBTb3VyY2VJbmZvO1xufVxuXG5leHBvcnQgbmFtZXNwYWNlIEV4cHIge1xuXG4gIC8qKiBFeHRyYSBpbmZvcm1hdGlvbiBmb3IgJ251bScgdmFsdWVzLiAqL1xuICBleHBvcnQgaW50ZXJmYWNlIE1ldGEge1xuICAgIC8qKiBXaGV0aGVyIHRoaXMgaXMgcmVsYXRpdmUgdG8gdGhlIHN0YXJ0IG9mIHRoZSBjaHVuay4gKi9cbiAgICByZWw/OiBib29sZWFuO1xuICAgIC8qKiBSZWxhdGl2ZSBjaHVuayB0aGUgdmFsdWUgaXMgZGVmaW5lZCBpbi4gKi9cbiAgICBjaHVuaz86IG51bWJlcjtcbiAgICAvKiogT3JnIHZhbHVlIG9mIGNodW5rLCBpZiBrbm93bi4gKi9cbiAgICBvcmc/OiBudW1iZXI7XG4gICAgLyoqIEJhbmsgdmFsdWUgb2YgY2h1bmssIGlmIGtub3duLiAqL1xuICAgIGJhbms/OiBudW1iZXI7XG4gICAgLyoqIE9mZnNldCB2YWx1ZSBvZiBjaHVuaywgaWYga25vd24uICovXG4gICAgb2Zmc2V0PzogbnVtYmVyO1xuICAgIC8qKiBTaXplIGhpbnQgZm9yIG51bWJlci4gKi9cbiAgICBzaXplPzogbnVtYmVyO1xuICB9XG5cbiAgdHlwZSBSZWMgPSAoZXhwcjogRXhwcikgPT4gRXhwcjsgLy8gcmVjdXJzZXMgaW50byBjaGlsZHJlblxuICB0eXBlIFRyYXZlcnNlciA9IChleHByOiBFeHByLCByZWM6IFJlYywgcGFyZW50PzogRXhwcikgPT4gRXhwcjtcblxuICAvKiogUGVyZm9ybXMgYSBwb3N0LW9yZGVyIHRyYXZlcnNhbC4gKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIHRyYXZlcnNlKGV4cHI6IEV4cHIsIGY6IFRyYXZlcnNlcikge1xuICAgIGZ1bmN0aW9uIHJlYyhlOiBFeHByKSB7XG4gICAgICBpZiAoIWUuYXJncykgcmV0dXJuIGU7XG4gICAgICByZXR1cm4gey4uLmUsIGFyZ3M6IGUuYXJncy5tYXAoYyA9PiB0KGMsIGUpKX07XG4gICAgfTtcbiAgICBmdW5jdGlvbiB0KGU6IEV4cHIsIHA/OiBFeHByKSB7XG4gICAgICBjb25zdCBzb3VyY2UgPSBlLnNvdXJjZTtcbiAgICAgIGUgPSBmKGUsIHJlYywgcCk7XG4gICAgICBpZiAoc291cmNlICYmICFlLnNvdXJjZSkgZS5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgcmV0dXJuIHQoZXhwcik7XG4gIH1cblxuICBleHBvcnQgZnVuY3Rpb24gdHJhdmVyc2VQb3N0KGV4cHI6IEV4cHIsIGY6IFJlYyk6IEV4cHIge1xuICAgIHJldHVybiB0cmF2ZXJzZShleHByLCAoZXhwciwgcmVjKSA9PiBmKHJlYyhleHByKSkpO1xuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIGV2YWx1YXRlKGV4cHI6IEV4cHIpOiBFeHByIHtcbiAgICBzd2l0Y2ggKGV4cHIub3ApIHsgLy8gdmFyLWFyZyBmdW5jdGlvbnNcbiAgICAgIGNhc2UgJy5tb3ZlJzpcbiAgICAgIGNhc2UgJ2ltJzpcbiAgICAgIGNhc2UgJ3N5bSc6XG4gICAgICAgIHJldHVybiBleHByO1xuICAgICAgY2FzZSAnbnVtJzpcbiAgICAgICAgaWYgKGV4cHIubWV0YT8ucmVsICYmIGV4cHIubWV0YS5vcmcgIT0gbnVsbCkge1xuICAgICAgICAgIC8vIFJlbW92ZSB0aGUgJ3JlbCcgdGFnIHNpbmNlIGl0J3Mgbm8gbG9uZ2VyIHJlbGF0aXZlLlxuICAgICAgICAgIGNvbnN0IHtyZWwsIC4uLm1ldGF9ID0gZXhwci5tZXRhO1xuICAgICAgICAgIC8vIFRPRE8gLSBwdWxsIHNpemUgZnJvbSBtZXRhP1xuICAgICAgICAgIHJldHVybiB7b3A6ICdudW0nLCBudW06IGV4cHIubnVtISArIG1ldGEub3JnISwgbWV0YX07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGV4cHI7XG4gICAgICBjYXNlICcubWF4JzogcmV0dXJuIHNhbWVDaHVuayhleHByLCBNYXRoLm1heCk7XG4gICAgICBjYXNlICcubWluJzogcmV0dXJuIHNhbWVDaHVuayhleHByLCBNYXRoLm1pbik7XG4gICAgICBkZWZhdWx0OiAvLyBmYWxsIHRocm91Z2ggdG8gbGF0ZXIgY2hlY2tzXG4gICAgfVxuXG4gICAgLy8gU3BlY2lhbCBjYXNlIGZvciB1bmFyaWVzXG4gICAgaWYgKGV4cHIuYXJncz8ubGVuZ3RoID09PSAxKSB7XG4gICAgICBzd2l0Y2ggKGV4cHIub3ApIHtcbiAgICAgICAgY2FzZSAnKyc6IHJldHVybiBleHByLmFyZ3MhWzBdO1xuICAgICAgICBjYXNlICctJzogcmV0dXJuIHVuYXJ5KGV4cHIsIHggPT4gLXgpO1xuICAgICAgICBjYXNlICd+JzogcmV0dXJuIHVuYXJ5KGV4cHIsIHggPT4gfngpO1xuICAgICAgICBjYXNlICchJzogcmV0dXJuIHVuYXJ5KGV4cHIsIHggPT4gKyF4KTtcbiAgICAgICAgY2FzZSAnPCc6IHJldHVybiB1bmFyeShleHByLCB4ID0+IHggJiAweGZmKTtcbiAgICAgICAgY2FzZSAnPic6IHJldHVybiB1bmFyeShleHByLCB4ID0+ICh4ID4+IDgpICYgMHhmZik7XG4gICAgICAgIGNhc2UgJ14nOiByZXR1cm4gbnVtKGV4cHIuYXJncyFbMF0ubWV0YT8uYmFuaykgPz8gZXhwcjtcbiAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHVuYXJ5IG9wZXJhdG9yOiAke2V4cHIub3B9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgc3dpdGNoIChleHByLm9wKSB7XG4gICAgICBjYXNlICcrJzogcmV0dXJuIHBsdXMoZXhwcik7XG4gICAgICBjYXNlICctJzogcmV0dXJuIG1pbnVzKGV4cHIpO1xuICAgICAgY2FzZSAnKic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgKiBiKTtcbiAgICAgIGNhc2UgJy8nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBNYXRoLmZsb29yKGEgLyBiKSk7XG4gICAgICBjYXNlICcubW9kJzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSAlIGIpO1xuICAgICAgY2FzZSAnJic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgJiBiKTtcbiAgICAgIGNhc2UgJ3wnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhIHwgYik7XG4gICAgICBjYXNlICdeJzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gYSBeIGIpO1xuICAgICAgY2FzZSAnPDwnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhIDw8IGIpO1xuICAgICAgY2FzZSAnPj4nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiBhID4+PiBiKTtcbiAgICAgIGNhc2UgJzwnOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgPCBiKSk7XG4gICAgICBjYXNlICc8PSc6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICsoYSA8PSBiKSk7XG4gICAgICBjYXNlICc+JzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gKyhhID4gYikpO1xuICAgICAgY2FzZSAnPj0nOiByZXR1cm4gYmluYXJ5KGV4cHIsIChhLCBiKSA9PiArKGEgPj0gYikpO1xuICAgICAgY2FzZSAnPSc6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICsoYSA9PSBiKSk7XG4gICAgICBjYXNlICc8Pic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+ICsoYSAhPSBiKSk7XG4gICAgICBjYXNlICcmJic6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgJiYgYik7XG4gICAgICBjYXNlICd8fCc6IHJldHVybiBiaW5hcnkoZXhwciwgKGEsIGIpID0+IGEgfHwgYik7XG4gICAgICBjYXNlICcueG9yJzogcmV0dXJuIGJpbmFyeShleHByLCAoYSwgYikgPT4gIWEgJiYgYiB8fCAhYiAmJiBhIHx8IDApO1xuICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIG9wZXJhdG9yOiAke2V4cHIub3B9YCk7XG4gICAgfVxuICB9XG5cbiAgZXhwb3J0IGZ1bmN0aW9uIGlkZW50aWZpZXIoZXhwcjogRXhwcik6IHN0cmluZyB7XG4gICAgaWYgKGV4cHIub3AgPT09ICdzeW0nICYmIGV4cHIuc3ltKSByZXR1cm4gZXhwci5zeW07XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCBpZGVudGlmaWVyIGJ1dCBnb3Qgb3A6ICR7ZXhwci5vcH1gKTtcbiAgfVxuXG4gIC8vIC8qKiBSZXR1cm5zIHRoZSBpZGVudGlmaWVyLiAqL1xuICAvLyBleHBvcnQgZnVuY3Rpb24gaWRlbnRpZmllcihleHByOiBFeHByKTogc3RyaW5nIHtcbiAgLy8gICBjb25zdCB0ZXJtczogc3RyaW5nW10gPSBbXTtcbiAgLy8gICBhcHBlbmQoZXhwcik7XG4gIC8vICAgcmV0dXJuIHRlcm1zLmpvaW4oJzo6Jyk7XG4gIC8vICAgZnVuY3Rpb24gYXBwZW5kKGU6IEV4cHIpIHtcbiAgLy8gICAgIGlmIChlLm9wID09PSAnaWRlbnQnKSB7XG4gIC8vICAgICAgIHRlcm1zLnB1c2goZS5zeW0hKTtcbiAgLy8gICAgIH0gZWxzZSBpZiAoZS5vcCA9PT0gJzo6Jykge1xuICAvLyAgICAgICBpZiAoZS5hcmdzIS5sZW5ndGggPT09IDEpIHRlcm1zLnB1c2goJycpO1xuICAvLyAgICAgICBlLmFyZ3MhLmZvckVhY2goYXBwZW5kKTtcbiAgLy8gICAgIH0gZWxzZSB7XG4gIC8vICAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgaWRlbnRpZmllciBidXQgZ290IG9wOiAke2Uub3B9YCk7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgLyoqIFBhcnNlIGEgc2luZ2xlIGV4cHJlc3Npb24sIG11c3Qgb2NjdXB5IHRoZSByZXN0IG9mIHRoZSBsaW5lLiAqL1xuICBleHBvcnQgZnVuY3Rpb24gcGFyc2VPbmx5KHRva2VuczogVG9rZW5bXSwgaW5kZXggPSAwKTogRXhwciB7XG4gICAgY29uc3QgW2V4cHIsIGldID0gcGFyc2UodG9rZW5zLCBpbmRleCk7XG4gICAgaWYgKGkgPCB0b2tlbnMubGVuZ3RoKSB7XG4gICAgICBkZWJ1Z2dlcjsgcGFyc2UodG9rZW5zLCBpbmRleCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEdhcmJhZ2UgYWZ0ZXIgZXhwcmVzc2lvbjogJHtUb2tlbi5uYW1lQXQodG9rZW5zW2ldKX1gKTtcbiAgICB9IGVsc2UgaWYgKCFleHByKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGV4cHJlc3Npb24/YCk7XG4gICAgfVxuICAgIHJldHVybiBleHByO1xuICB9XG5cbiAgLy8gUmV0dXJucyBbdW5kZWZpbmVkLCAtMV0gaWYgYSBiYWQgcGFyc2UuXG4gIC8vIEdpdmUgdXAgb24gbm9ybWFsIHBhcnNpbmcsIGp1c3QgdXNlIGEgc2h1bnRpbmcgeWFyZCBhZ2Fpbi4uLlxuICAvLyAgLSBidXQgaGFuZGxlIHBhcmVucyByZWN1cnNpdmVseS5cbiAgZXhwb3J0IGZ1bmN0aW9uIHBhcnNlKHRva2VuczogVG9rZW5bXSwgaW5kZXggPSAwKTogW0V4cHJ8dW5kZWZpbmVkLCBudW1iZXJdIHtcbi8vY29uc29sZS5sb2coJ1BBUlNFOiB0b2tlbnM9JywgdG9rZW5zLCAnaW5kZXg9JywgaW5kZXgpO1xuLy90cnkgeyB0aHJvdyBuZXcgRXJyb3IoKTsgfSBjYXRjaCAoZSkgeyBjb25zb2xlLmxvZyhlLnN0YWNrKTsgfVxuICAgIGNvbnN0IG9wczogW3N0cmluZywgT3BlcmF0b3JNZXRhXVtdID0gW107XG4gICAgY29uc3QgZXhwcnM6IEV4cHJbXSA9IFtdO1xuXG4gICAgZnVuY3Rpb24gcG9wT3AoKSB7XG4gICAgICBjb25zdCBbb3AsIFssLCBhcml0eV1dID0gb3BzLnBvcCgpITtcbi8vY29uc29sZS5sb2coJ3BvcCcsIG9wLCBhcml0eSk7XG4gICAgICBjb25zdCBhcmdzID0gZXhwcnMuc3BsaWNlKGV4cHJzLmxlbmd0aCAtIGFyaXR5LCBhcml0eSk7XG4gICAgICBpZiAoYXJncy5sZW5ndGggIT09IGFyaXR5KSB0aHJvdyBuZXcgRXJyb3IoJ3NodW50aW5nIHBhcnNlIGZhaWxlZD8nKTtcbiAgICAgIGV4cHJzLnB1c2goZml4U2l6ZSh7b3AsIGFyZ3N9KSk7XG4gICAgfVxuXG4gICAgbGV0IHZhbCA9IHRydWU7XG4gICAgbGV0IGkgPSBpbmRleDtcbiAgICBmb3IgKDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZnJvbnQgPSB0b2tlbnNbaV07XG4vL2NvbnNvbGUubG9nKCdleHByczonLGV4cHJzLCdvcHM6JyxvcHMsJ3RvazonLGZyb250KTtcbiAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgLy8gbG9va2luZyBmb3IgYSB2YWx1ZTogbGl0ZXJhbCwgYmFsYW5jZWQgcGFyZW5zLCBvciBwcmVmaXggb3AuXG4gICAgICAgIGlmIChmcm9udC50b2tlbiA9PT0gJ2NzJyB8fCBmcm9udC50b2tlbiA9PT0gJ29wJykge1xuICAgICAgICAgIGNvbnN0IG1hcHBlZCA9IE5BTUVfTUFQLmdldChmcm9udC5zdHIpO1xuICAgICAgICAgIGNvbnN0IHByZWZpeCA9IFBSRUZJWE9QUy5nZXQobWFwcGVkID8/IGZyb250LnN0cik7XG4gICAgICAgICAgaWYgKHByZWZpeCkge1xuICAgICAgICAgICAgb3BzLnB1c2goW2Zyb250LnN0ciwgcHJlZml4XSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChmcm9udC50b2tlbiA9PT0gJ2NzJykge1xuICAgICAgICAgICAgY29uc3Qgb3AgPSBmcm9udC5zdHI7XG4gICAgICAgICAgICBpZiAoIUZVTkNUSU9OUy5oYXMob3ApKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gc3VjaCBmdW5jdGlvbjogJHtUb2tlbi5uYW1lQXQoZnJvbnQpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmV4dCA9IHRva2Vuc1tpICsgMV07XG4gICAgICAgICAgICBpZiAobmV4dD8udG9rZW4gIT09ICdscCcpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBCYWQgZnVuY2FsbDogJHtUb2tlbi5uYW1lQXQobmV4dCA/PyBmcm9udCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjbG9zZSA9IFRva2VuLmZpbmRCYWxhbmNlZCh0b2tlbnMsIGkgKyAxKTtcbiAgICAgICAgICAgIGlmIChjbG9zZSA8IDApIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBOZXZlciBjbG9zZWQ6ICR7VG9rZW4ubmFtZUF0KG5leHQpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYXJnczogRXhwcltdID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGFyZyBvZiBUb2tlbi5wYXJzZUFyZ0xpc3QodG9rZW5zLCBpICsgMiwgY2xvc2UpKSB7XG4gICAgICAgICAgICAgIGFyZ3MucHVzaChwYXJzZU9ubHkoYXJnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpID0gY2xvc2U7XG4gICAgICAgICAgICBleHBycy5wdXNoKGZpeFNpemUoe29wLCBhcmdzfSkpO1xuICAgICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIGlmIChUb2tlbi5lcShmcm9udCwgVG9rZW4uU1RBUikpIHtcbiAgICAgICAgICAgIGV4cHJzLnB1c2goe29wOiAnc3ltJywgc3ltOiAnKid9KTtcbiAgICAgICAgICAgIHZhbCA9IGZhbHNlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gcHJlZml4IG9wZXJhdG9yOiAke1Rva2VuLm5hbWVBdChmcm9udCl9YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZyb250LnRva2VuID09PSAnbHAnKSB7XG4gICAgICAgICAgLy8gZmluZCBiYWxhbmNlZCBwYXJlbnNcbiAgICAgICAgICBjb25zdCBjbG9zZSA9IFRva2VuLmZpbmRCYWxhbmNlZCh0b2tlbnMsIGkpO1xuICAgICAgICAgIGlmIChjbG9zZSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gY2xvc2UgcGFyZW46ICR7VG9rZW4ubmFtZUF0KGZyb250KX1gKTtcbiAgICAgICAgICB9IC8vIHJldHVybiBbdW5kZWZpbmVkLCAtMV07XG4gICAgICAgICAgY29uc3QgZSA9IHBhcnNlT25seSh0b2tlbnMuc2xpY2UoaSArIDEsIGNsb3NlKSk7XG4gICAgICAgICAgZXhwcnMucHVzaChlKTtcbiAgICAgICAgICBpID0gY2xvc2U7XG4gICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoZnJvbnQudG9rZW4gPT09ICdpZGVudCcpIHtcbiAgICAgICAgICAvLyBhZGQgc3ltYm9sXG4gICAgICAgICAgZXhwcnMucHVzaCh7b3A6ICdzeW0nLCBzeW06IGZyb250LnN0cn0pO1xuICAgICAgICAgIC8vIFRPRE8gLSB1c2Ugc2NvcGUgaW5mb3JtYXRpb24gdG8gZGV0ZXJtaW5lIHNpemU/XG4gICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSBpZiAoZnJvbnQudG9rZW4gPT09ICdudW0nKSB7XG4gICAgICAgICAgLy8gYWRkIG51bWJlclxuICAgICAgICAgIGNvbnN0IG51bSA9IGZyb250Lm51bTtcbiAgICAgICAgICBleHBycy5wdXNoKHtvcDogJ251bScsIG51bSwgbWV0YTogc2l6ZShudW0pfSk7XG4gICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gYmFkIHRva2VuPz9cbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEJhZCBleHByZXNzaW9uIHRva2VuOiAke1Rva2VuLm5hbWVBdChmcm9udCl9YCk7XG4gICAgICAgICAgLy8gcmV0dXJuIFt1bmRlZmluZWQsIC0xXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbG9va2luZyBmb3IgYW4gaW5maXggb3BlcmF0b3Igb3IgRU9MLlxuICAgICAgICBpZiAoVG9rZW4uZXEoZnJvbnQsIFRva2VuLkNPTU1BKSAvKiB8fCBUb2tlbi5lcShmcm9udCwgVG9rZW4uUlApICovKSB7XG4gICAgICAgICAgLy8gVE9ETyAtIGlzIHJwYXJlbiBva2F5PyB1c3VhbGx5IHNob3VsZCBoYXZlIGV4dHJhY3RlZCB0aGUgYmFsYW5jZWRcbiAgICAgICAgICAvLyBwYXJlbiBvdXQgZmlyc3Q/XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZyb250LnRva2VuID09PSAnY3MnIHx8IGZyb250LnRva2VuID09PSAnb3AnKSB7XG4gICAgICAgICAgY29uc3QgbWFwcGVkID0gTkFNRV9NQVAuZ2V0KGZyb250LnN0cik7XG4gICAgICAgICAgY29uc3Qgb3AgPSBCSU5PUFMuZ2V0KG1hcHBlZCA/PyBmcm9udC5zdHIpO1xuICAgICAgICAgIGlmICghb3ApIGJyZWFrOyAvLyB3ZSdyZSBhdCB0aGUgZW5kLi4uPyAgb3IgaWYgbm8gb3AuXG4gICAgICAgICAgLy8gc2VlIGlmIGFueXRoaW5nIHRvIHRoZSBsZWZ0IGlzIGZhc3Rlci5cbiAgICAgICAgICB3aGlsZSAob3BzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgdG9wID0gb3BzW29wcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIGNvbnN0IGNtcCA9IGNvbXBhcmVPcCh0b3BbMV0sIG9wKTtcbiAgICAgICAgICAgIGlmIChjbXAgPCAwKSBicmVhaztcbiAgICAgICAgICAgIGlmIChjbXAgPT09IDApIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAgICAgYE1peGluZyAke3RvcFswXX0gYW5kICR7ZnJvbnQuc3RyfSBuZWVkcyBleHBsaWNpdCBwYXJlbnMuJHtcbiAgICAgICAgICAgICAgICAgICBUb2tlbi5hdChmcm9udCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwb3BPcCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBvcHMucHVzaChbZnJvbnQuc3RyLCBvcF0pO1xuICAgICAgICAgIHZhbCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy90aHJvdyBuZXcgRXJyb3IoYEdhcmJhZ2UgYWZ0ZXIgZXhwcmVzc2lvbjogJHtUb2tlbi5uYW1lQXQoZnJvbnQpfWApO1xuLy9jb25zb2xlLmxvZygnYmFkIHZhbHVlJywgaSwgZnJvbnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuLy9jb25zb2xlLmxvZygnZXhwcnM6JyxleHBycywnb3BzOicsb3BzKTtcbiAgICAvLyBOb3cgcG9wIGFsbCB0aGUgb3BzXG4gICAgd2hpbGUgKG9wcy5sZW5ndGgpIHBvcE9wKCk7XG4vL2NvbnNvbGUubG9nKCdwb3N0LXBvcDonLCBleHBycyk7XG4gICAgaWYgKGV4cHJzLmxlbmd0aCAhPT0gMSkgdGhyb3cgbmV3IEVycm9yKGBzaHVudGluZyBwYXJzZSBmYWlsZWQ/YCk7XG4gICAgaWYgKHRva2Vuc1tpbmRleF0uc291cmNlKSBleHByc1swXS5zb3VyY2UgPSB0b2tlbnNbaW5kZXhdLnNvdXJjZTtcbiAgICByZXR1cm4gW2V4cHJzWzBdLCBpXTtcbiAgfVxuXG5cbiAgLy8gd29ya3Mgb24gYWJzb2x1dGUgbnVtYmVycywgb3IgcmVsYXRpdmUgbnVtYmVycyBpZiBhbGwgaW4gc2FtZSBjaHVuay5cbiAgLy8gbWF5IG5vdCBtaXggcmVsYXRpdmUgKyBhYnNvbHV0ZS5cbiAgZnVuY3Rpb24gc2FtZUNodW5rKGV4cHI6IEV4cHIsIGY6ICguLi5udW1zOiBudW1iZXJbXSkgPT4gbnVtYmVyKTogRXhwciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCk7XG4gIH1cblxuICBmdW5jdGlvbiBudW0obnVtOiBudW1iZXJ8dW5kZWZpbmVkKTogRXhwcnx1bmRlZmluZWQge1xuICAgIGlmIChudW0gPT0gbnVsbCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICByZXR1cm4ge29wOiAnbnVtJywgbnVtLCBtZXRhOiBzaXplKG51bSl9O1xuICB9XG5cbiAgZnVuY3Rpb24gdW5hcnkoZXhwcjogRXhwciwgZjogKHg6IG51bWJlcikgPT4gbnVtYmVyKTogRXhwciB7XG4gICAgLy8gcmVxdWlyZSBhYnNvbHV0ZVxuICAgIGNvbnN0IGFyZyA9IGV4cHIuYXJncyFbMF07XG4gICAgaWYgKCFpc0FicyhhcmcpKSByZXR1cm4gZXhwcjtcbiAgICBjb25zdCBudW0gPSBmKGFyZy5udW0hKTtcbiAgICByZXR1cm4ge29wOiAnbnVtJywgbnVtLCBtZXRhOiBzaXplKG51bSl9O1xuICB9XG5cbiAgZnVuY3Rpb24gYmluYXJ5KGV4cHI6IEV4cHIsIGY6ICh4OiBudW1iZXIsIHk6IG51bWJlcikgPT4gbnVtYmVyKTogRXhwciB7XG4gICAgLy8gcmVxdWlyZSBib3RoIHRvIGJlIGFic29sdXRlXG4gICAgY29uc3QgW2EsIGJdID0gZXhwci5hcmdzITtcbiAgICBpZiAoIWlzQWJzKGEpIHx8ICFpc0FicyhiKSkgcmV0dXJuIGV4cHI7XG4gICAgY29uc3QgbnVtID0gZihhLm51bSEsIGIubnVtISk7XG4gICAgcmV0dXJuIHtvcDogJ251bScsIG51bSwgbWV0YTogc2l6ZShudW0pfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsdXMoZXhwcjogRXhwcik6IEV4cHIge1xuICAgIC8vIGFsbG93IHNvbWUgcmVsYXRpdmUsIGJ1dCBvbmx5IGlmIGFkZGluZyBhIG5vbi1hZGRyZXNzP1xuICAgIGNvbnN0IFthLCBiXSA9IGV4cHIuYXJncyE7XG4gICAgaWYgKGEub3AgIT09ICdudW0nIHx8IGIub3AgIT09ICdudW0nKSByZXR1cm4gZXhwcjtcbiAgICBjb25zdCBvdXQ6IEV4cHIgPSB7b3A6ICdudW0nLCBudW06IGEubnVtISArIGIubnVtIX07XG4gICAgaWYgKGEubWV0YSB8fCBiLm1ldGEpIHtcbiAgICAgIGlmIChhLm1ldGE/LnJlbCAmJiBiLm1ldGE/LnJlbCkgcmV0dXJuIGV4cHI7IC8vIGJhc2ljYWxseSBub25zZW5zZVxuICAgICAgaWYgKGEubWV0YT8ucmVsKSB7XG4gICAgICAgIG91dC5tZXRhID0gYS5tZXRhO1xuICAgICAgfSBlbHNlIGlmIChiLm1ldGE/LnJlbCkge1xuICAgICAgICBvdXQubWV0YSA9IGIubWV0YTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFvdXQubWV0YT8ucmVsICYmIG91dC5tZXRhPy5zaXplID09IG51bGwpIHtcbiAgICAgIChvdXQubWV0YSB8fCAob3V0Lm1ldGEgPSB7fSkpLnNpemUgPSBzaXplKG91dC5udW0hKS5zaXplO1xuICAgIH1cbiAgICByZXR1cm4gb3V0O1xuICB9XG5cbiAgZnVuY3Rpb24gbWludXMoZXhwcjogRXhwcik6IEV4cHIge1xuICAgIC8vIGFsbG93IHJlbCAtIHJlbCBmb3IgZGVsdGFcbiAgICBjb25zdCBbYSwgYl0gPSBleHByLmFyZ3MhO1xuICAgIGlmIChhLm9wICE9PSAnbnVtJyB8fCBiLm9wICE9PSAnbnVtJykgcmV0dXJuIGV4cHI7XG4gICAgY29uc3Qgb3V0OiBFeHByID0ge29wOiAnbnVtJywgbnVtOiBhLm51bSEgLSBiLm51bSF9O1xuICAgIGlmIChiLm1ldGE/LnJlbCkge1xuICAgICAgcmV0dXJuIGEubWV0YT8ucmVsICYmIGEubWV0YS5jaHVuayA9PT0gYi5tZXRhLmNodW5rID8gb3V0IDogZXhwcjtcbiAgICB9XG4gICAgaWYgKGEubWV0YT8ucmVsKSBvdXQubWV0YSA9IGEubWV0YTtcbiAgICBpZiAoIW91dC5tZXRhPy5yZWwgJiYgb3V0Lm1ldGE/LnNpemUgPT0gbnVsbCkge1xuICAgICAgKG91dC5tZXRhIHx8IChvdXQubWV0YSA9IHt9KSkuc2l6ZSA9IHNpemUob3V0Lm51bSEpLnNpemU7XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICBmdW5jdGlvbiBpc0FicyhleHByOiBFeHByKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGV4cHIub3AgPT09ICdudW0nICYmICFleHByLm1ldGE/LnJlbDtcbiAgfVxufVxuXG5cblxuLy8gUmV0dXJucyA+MCBpZiB0b3AgaXMgZmFzdGVyLCA8MCBpZiB0b3AgaXMgc2xvd2VyLCBhbmQgMCBpZiBjYW4ndCBtaXhcbmZ1bmN0aW9uIGNvbXBhcmVPcCh0b3A6IE9wZXJhdG9yTWV0YSwgbmV4dDogT3BlcmF0b3JNZXRhKTogbnVtYmVyIHtcbiAgaWYgKHRvcFswXSA+IG5leHRbMF0pIHJldHVybiAxO1xuICBpZiAodG9wWzBdIDwgbmV4dFswXSkgcmV0dXJuIC0xO1xuICBpZiAodG9wWzFdICE9PSBuZXh0WzFdKSByZXR1cm4gMDtcbiAgcmV0dXJuIHRvcFsxXTtcbn1cblxuXG4vLyBwcmVjZWRlbmNlLCBhc3NvY2lhdGl2aXR5LCBhcml0eVxudHlwZSBPcGVyYXRvck1ldGEgPSByZWFkb25seSBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl07XG5jb25zdCBCSU5BUlkgPSAyO1xuY29uc3QgVU5BUlkgPSAxO1xuZXhwb3J0IGNvbnN0IEJJTk9QUyA9IG5ldyBNYXA8c3RyaW5nLCBPcGVyYXRvck1ldGE+KFtcbiAgLy8gU2NvcGluZyBvcGVyYXRvclxuICAvLyBbJzo6JywgWzgsIDEsIEJJTkFSWV1dLFxuICAvLyBNZW1vcnkgaGludHNcbiAgLy9bJzonLCBbNiwgMF1dLFxuICAvLyBNdWx0aXBsaWNhdGl2ZSBvcGVyYXRvcnM6IG5vdGUgdGhhdCBiaXR3aXNlIGFuZCBhcml0aG1ldGljIGNhbm5vdCBhc3NvY2lhdGVcbiAgWycqJywgWzUsIDQsIEJJTkFSWV1dLFxuICBbJy8nLCBbNSwgNCwgQklOQVJZXV0sXG4gIFsnLm1vZCcsIFs1LCAzLCBCSU5BUlldXSxcbiAgWycmJywgWzUsIDIsIEJJTkFSWV1dLFxuICBbJ14nLCBbNSwgMSwgQklOQVJZXV0sXG4gIFsnPDwnLCBbNSwgMCwgQklOQVJZXV0sXG4gIFsnPj4nLCBbNSwgMCwgQklOQVJZXV0sXG4gIC8vIEFyaXRobWV0aWMgb3BlcmF0b3JzOiBub3RlIHRoYXQgYml0d2lzZSBhbmQgYXJpdGhtZXRpYyBjYW5ub3QgYXNzb2NpYXRlXG4gIFsnKycsIFs0LCAyLCBCSU5BUlldXSxcbiAgWyctJywgWzQsIDIsIEJJTkFSWV1dLFxuICBbJ3wnLCBbNCwgMSwgQklOQVJZXV0sXG4gIC8vIENvbXBhcmlzb24gb3BlcmF0b3JzXG4gIFsnPCcsIFszLCAwLCBCSU5BUlldXSxcbiAgWyc8PScsIFszLCAwLCBCSU5BUlldXSxcbiAgWyc+JywgWzMsIDAsIEJJTkFSWV1dLFxuICBbJz49JywgWzMsIDAsIEJJTkFSWV1dLFxuICBbJz0nLCBbMywgMCwgQklOQVJZXV0sXG4gIFsnPD4nLCBbMywgMCwgQklOQVJZXV0sXG4gIC8vIExvZ2ljYWwgb3BlcmF0b3JzOiBkaWZmZXJlbnQga2luZHMgY2Fubm90IGFzc29jaWF0ZVxuICBbJyYmJywgWzIsIDMsIEJJTkFSWV1dLFxuICBbJy54b3InLCBbMiwgMiwgQklOQVJZXV0sXG4gIFsnfHwnLCBbMiwgMSwgQklOQVJZXV0sXG4gIC8vIENvbW1hXG4gIC8vWycsJywgWzEsIDFdXSxcbl0pO1xuXG5jb25zdCBQUkVGSVhPUFMgPSBuZXcgTWFwPHN0cmluZywgT3BlcmF0b3JNZXRhPihbXG4gIC8vIFsnOjonLCBbOSwgLTEsIFVOQVJZXV0sIC8vIGdsb2JhbCBzY29wZVxuICBbJysnLCBbOSwgLTEsIFVOQVJZXV0sXG4gIFsnLScsIFs5LCAtMSwgVU5BUlldXSxcbiAgWyd+JywgWzksIC0xLCBVTkFSWV1dLFxuICBbJzwnLCBbOSwgLTEsIFVOQVJZXV0sXG4gIFsnPicsIFs5LCAtMSwgVU5BUlldXSxcbiAgWydeJywgWzksIC0xLCBVTkFSWV1dLFxuICBbJyEnLCBbMiwgLTEsIFVOQVJZXV0sXG5dKTtcblxuLy8gVE9ETyAtIHNraXAxIGFuZCBza2lwMiBtYWNyb3Ncbi8vIC5tYWNybyBza2lwMVxuLy8gICAuYnl0ZSAkMmNcbi8vIC5lbmRtYWNyb1xuLy8gLm1hY3JvIHNraXAyXG4vLyAgIC5ieXRlICQ0Y1xuLy8gICAuYXNzZXJ0IC5ieXRlYXQoKiArIDIpIDwgJDIwIC5vciBcXFxuLy8gICAgICAgICAgIC5ieXRlYXQoKiArIDIpID49ICQ2MCAub3IgXFxcbi8vICAgICAgICAgICAuYnl0ZWF0KCogKyAxKSAmICQwNyAuaW4gWzIsMyw0XVxuLy8gLmVuZG1hY3JvXG4vLyBOT1RFOiBkYW5nZXJvdXMgcmVhZHMgYXJlIDIwMDIsIDIwMDQsIDIwMDcgKHBsdXMgbWlycm9ycyksIDQwMTVcbi8vIFRoZW4gdGhlIGFzc2VtYmxlciBuZWVkcyB0byB1bmRlcnN0YW5kIHRoZSBmbG93IG9mIHRoZXNlIHR3byBvcHMuLi5cbi8vIG9yIGp1c3QgZGlzYXNzZW1ibGUgaXQgb24gdGhlIGZseT9cbmNvbnN0IEZVTkNUSU9OUyA9IG5ldyBTZXQ8c3RyaW5nPihbXG4gICcuYnl0ZWF0JyxcbiAgJy53b3JkYXQnLFxuICAnLm1heCcsICcubWluJyxcbl0pO1xuXG5jb25zdCBOQU1FX01BUCA9IG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KFtcbiAgWycuYml0YW5kJywgJyYnXSxcbiAgWycuYml0eG9yJywgJ14nXSxcbiAgWycuYml0b3InLCAnfCddLFxuICBbJy5zaGwnLCAnPDwnXSxcbiAgWycuc2hyJywgJz4+J10sXG4gIFsnLmFuZCcsICcmJiddLFxuICBbJy5vcicsICd8fCddLFxuICBbJy5iaXRub3QnLCAnfiddLFxuICBbJy5sb2J5dGUnLCAnPCddLFxuICBbJy5oaWJ5dGUnLCAnPiddLFxuICBbJy5iYW5rYnl0ZScsICdeJ10sIC8vID8/PyBob3cgdG8gaW1wbGVtZW50IG9uIG51bWJlcj9cbiAgWycubm90JywgJyEnXSxcbl0pO1xuXG5jb25zdCBTSVpFX1RSQU5TRk9STVMgPSBuZXcgTWFwPHN0cmluZywgKC4uLmFyZ3M6IG51bWJlcltdKSA9PiBudW1iZXI+KFtcbiAgLy8gdW5hcnk6IGJhbmsgYnl0ZTsgYmluYXJ5OiBiaXR4b3JcbiAgWydeJywgKC4uLmFyZ3MpID0+IGFyZ3MubGVuZ3RoID09PSAxID8gMSA6IE1hdGgubWF4KC4uLmFyZ3MpXSxcbiAgWyc8JywgKCkgPT4gMV0sIC8vIHVuYXJ5IChsb2J5dGUpIGFuZCBiaW5hcnkgKGNtcCkgYm90aCBzaW5nbGUtYnl0ZVxuICBbJz4nLCAoKSA9PiAxXSwgLy8gdW5hcnkgKGhpYnl0ZSkgYW5kIGJpbmFyeSAoY21wKSBib3RoIHNpbmdsZS1ieXRlXG4gIFsnIScsICgpID0+IDFdLCAvLyBub3QgYWx3YXlzIDAgb3IgMVxuICBbJzw9JywgKCkgPT4gMV0sIC8vIGNtcFxuICBbJz49JywgKCkgPT4gMV0sIC8vIGNtcFxuICBbJzw+JywgKCkgPT4gMV0sIC8vIGNtcFxuICBbJz0nLCAoKSA9PiAxXSwgLy8gY21wXG4gIC8vIGJpdHdpc2UgYW5kIGxvZ2ljYWwgb3BlcmF0b3IgcmV0dXJuIG1heFxuICBbJyYnLCBNYXRoLm1heF0sXG4gIFsnJiYnLCBNYXRoLm1heF0sXG4gIFsnfCcsIE1hdGgubWF4XSxcbiAgWyd8fCcsIE1hdGgubWF4XSxcbiAgWycueG9yJywgTWF0aC5tYXhdLFxuICBbJy5tYXgnLCBNYXRoLm1heF0sXG4gIFsnLm1pbicsIE1hdGgubWF4XSwgLy8gY291bGQgdXNlIG1pbiwgYnV0IG1heSBub3QgYmUgc2FmZSB3LyBuZWdhdGl2ZXNcbl0pO1xuICBcbmZ1bmN0aW9uIGZpeFNpemUoZXhwcjogRXhwcik6IEV4cHIge1xuICBjb25zdCB4Zm9ybSA9IFNJWkVfVFJBTlNGT1JNUy5nZXQoZXhwci5vcCk7XG4gIGNvbnN0IHNpemUgPSB4Zm9ybT8uKC4uLmV4cHIuYXJncyEubWFwKGUgPT4gTnVtYmVyKGUubWV0YT8uc2l6ZSkpKTtcbiAgaWYgKHNpemUpIChleHByLm1ldGEgfHwgKGV4cHIubWV0YSA9IHt9KSkuc2l6ZSA9IHNpemU7XG4gIHJldHVybiBleHByO1xufVxuXG5mdW5jdGlvbiBzaXplKG51bTogbnVtYmVyKTogRXhwci5NZXRhIHtcbiAgcmV0dXJuIHtzaXplOiAwIDw9IG51bSAmJiBudW0gPCAyNTYgPyAxIDogMn07XG59XG5cbi8vIGZ1bmN0aW9uIGZhaWwobXNnOiBzdHJpbmcpOiBuZXZlciB7XG4vLyAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuLy8gfVxuIl19